---

title: Color management for web server based applications
abstract: Method and apparatus for color management of documents retrieved and manipulated by a server based application and displayed on a client device through a browser application. Page elements of documents are manipulated to provide consistent and/or accurate color reproduction on the client device. Pages include untagged images, images tagged with color profiles, and tagged or untagged page elements specified by hex color values. Color values for images and untagged page elements specified by hex color values are adjusted by the server application before transmission to the client device to account for properties of browser applications and operating systems of different client devices.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09076367&OS=09076367&RS=09076367
owner: Apple Inc.
number: 09076367
owner_city: Cupertino
owner_country: US
publication_date: 20120907
---
The described embodiments generally relate to methods and apparatuses for managing colors for applications operating on a server and accessed through a web browser on a client device. More particularly the present embodiments describe modifications at a server to elements of pages documents retrieved by the client device to manage colors when the pages documents are displayed on the client device.

Portable computing devices have enabled users to carry a suite of applications and associated documents from office to home to vacation spots. For documents and applications co resident on a given computing device and associated locally connected storage device a document can be processed on the computing device to display on one or more displays integrated with or linked to the computing device. The user can achieve consistent and accurate color reproduction for the documents using applications and operating systems that support color management of elements contained in the documents e.g. applications for processing digital images generated by digital cameras or by film scanners and presented on a calibrated display monitor or printer system. Color management can provide a method to reproduce a document consistently and accurately across different computing devices typically through the use of a combination of operating system software application software standardized generic color profiles and device specific color profiles for source devices and display devices. Accurate color can require generating and maintaining the device specific color profiles for a particular display device or printing system. An approximation of accurate color can be achieved by using generic color profiles to which display devices can be calibrated by a manufacturer such as to the well known International Color Consortium ICC standardized sRGB color profile. Different elements of a document can by handled differently by a software application and or operating system so that portions of the document can be color managed through specific color profiles while other elements can be unmanaged and sent to the display directly. Color profiles embedded with elements of a document e.g. an image can inform a color management system how to display a color while stripping embedded color profiles can result in the element being displayed based on a default profile. Achieving color consistency among several different elements in a document can prove frustrating for a user as the same document can appear differently in different applications through different operating systems and on different computing devices. Meanwhile the rise of the internet and World Wide Web has promoted the sharing of documents among multiple users across a broad variety of computing devices and cloud based storage and computing introduces the complication that a single document can include elements generated by one user uploaded to the web for storage manipulated by another user on a local or remote device and downloaded for display by an additional user. Color management for elements of documents when the generation manipulation and display can occur on multiple different computing devices can prove quite challenging. Thus there exists a need for a method to color manage documents that can be stored and manipulated by applications on a server while being accessed by a remote client device through a web browser.

In one embodiment a method of managing colors at a server for page elements of a page to be displayed on a client device is described. The method includes at least the following steps performed at the server. In a first step the server receives a command from the client device to retrieve the page. The server converts page elements in the page to a common color profile the page elements including at least an image tagged with a color profile and a page element specified by a numerical color value without a color profile. After conversion the server transmits a modified page to the client device the modified page including the converted page elements to display on the client device. In an embodiment the common color profile is a standardized ICC sRGB color profile and the numerical color value of the page element is a W3C CSS RGB triple of hexadecimal values.

In another embodiment an apparatus for color management of page elements displayed on a client device is described. The apparatus includes at least a receiving module a processing module and a transmitting module. The receiving module is configured to receive a command from the client device to retrieve a page. The processing module is configured to convert page elements in the page to a common color profile the page elements including at least an image tagged with a color profile and a page element specified by a numerical color value without a color profile. The transmitting module is configured to transmit a modified page to the client device the modified page including the converted page elements. In an embodiment the processing module is further configured to append the common color profile to an untagged image page element in the page before transmitting the modified page to the client device.

In a further embodiment a computer program product encoded in a non transitory computer readable medium for managing colors at a server for displaying a page on a client device is described. The computer program product in the mobile wireless device includes the following computer program code. Computer program code for receiving a command from the client device to retrieve the page. Computer program code for converting page elements in the page to a common color profile the page elements including at least an image tagged with a color profile and a page element specified by a numerical color value without a color profile. Computer program code for transmitting a modified page that includes the converted page elements to the client device for displaying on the client device. In an embodiment the computer program product further includes computer program code for preserving the original color profile of tagged images in the page before transmission to the client device when determined color management settings indicate that the browser supports color management of images and computer program code for converting the color profile of tagged images in the page to the common color profile before transmission to the client device only when the color management settings indicate that the browser does not support color management of images.

In the following description numerous specific details are set forth to provide a thorough understanding of the concepts underlying the described embodiments. It will be apparent however to one skilled in the art that the described embodiments may be practiced without some or all of these specific details. In other instances well known process steps have not been described in detail in order to avoid unnecessarily obscuring the underlying concepts.

The examples and embodiments provided below describe various methods and apparatuses for color management of elements of a page document processed at a server and displayed on a client device connected to the server through the internet. The terms document and page are used interchangeably in this patent application to indicate a file or portion thereof that can be generated manipulated retrieved and displayed by a computing device connected to a server. Color management within an application executing on a server in the internet can differ from color management within an application executing on a local computer. The document can be viewed at the client device through a web browser that accesses the server through the internet and thus the document can be processed for color management twice once at the server before transmission to the client device and a second time at the client device in preparation for display at the client device. The document can include multiple elements such as images which can be tagged with generic or specific color profiles or can be untagged and graphical elements that can be specified as RGB values again with or without an accompanying color profile. Document elements tagged with a color profile can be treated differently from untagged elements and images can also be handled differently from graphical elements both within the application at the server and by the web browser at the client device. Achieving consistent and accurate color reproduction for the diverse set of elements in a document viewed through a web browser can prove challenging.

With web based storage and processing of documents a document can be generated retrieved and or processed at one computing device and transferred to a separate computing device to be displayed. Each computing device can use a different application for processing and or viewing the document and operating systems and displays on each computing device can also vary. The same document stored at and retrieved from a server can be viewed by different users on different computing devices having different configurations of hardware and software. Rather than transmit the document unaltered to each client device which can result in significant variability in how the document displays on the client device the application on the server can account for specific characteristics or assume a set of general characteristics for the client device and process the documents accordingly before transmitting the document for display to the client device. Viewing the document through a web browser can change the document s appearance depending on the color management capabilities and settings of the web browser used at the client device. In some embodiments the server application can determine or estimate color management actions that the web browser application and or the operating system of the client device can perform on the transmitted document. The server application can account for these operations in advance and convert the document at the server before transmission to the client device. The original unconverted document can be retained at the server so that specific information associated with the document remains unaltered. One or more processed versions of the document can also be stored at the server for quick retrieval and transmission to client devices having specific known or assumed color management and display characteristics.

Different web browsers including different revisions or configurations of the same web browser can handle color management of elements in documents differently. Some web browsers use no color management other web browsers implement partial color management e.g. for images tagged with color profiles only while other web browsers implement a form of full color management including both images with color profiles and graphical elements within the document. Typically web browsers do not color manage graphical elements e.g. blocks or text specified by a World Wide Web Consortium W3C cascading style sheet CSS color coding even though these colors are specified to be interpreted according to the International Color Consortium ICC standardized sRGB color profile. When a document that includes both images and graphical elements is displayed through a web browser matching colors between the image and the graphical element can prove difficult to achieve. If the image and the graphical element are displayed according to different color profiles then identical RGB values in the image and graphical element can display as different colors. If the image and the graphical elements are specified and displayed according to the same color profile then color matching between them can occur. When the image is specified by a color profile other than a common reference color profile e.g. other than the sRGB color profile then the application at the server can convert the image to the common color profile used by the graphical elements to ensure that when viewed together at the client device the graphical elements and images can be color matched.

Conversion of images between color profiles can change the RGB values for the images. Rather than change the stored version of the image at the server the original image and its attached color profile can be retained while the converted image and common reference color profile can be transmitted to the client device for display. Untagged images in the document can also be tagged with the common color profile generally the sRGB profile can be used as a default standard color profile for displaying documents distributed through the internet. Graphical elements can also be tagged or left untagged prior to transmission. Standardizing the display of a document to a common color profile such as the sRGB profile can improve color consistency when displaying the documents on a variety of computing devices.

The source document can be uploaded from the computer to a network server and downloaded from the network server to another computing device across a World Wide Web internet connection. At the network server the stored remote document can correspond exactly to the source document or can be a variant of the source document that includes changes added by an application at the network server . In a representative embodiment the source document can be processed by an application at the network server to create the remote document . For example a user of the computer can initially create the source document upload the source document to the network server and then manipulate the source document at the network server through a web based application thereby creating a new remote document .

Any of the computing devices shown in can download the remote document from the network server . Each of the computing devices can include a different set of hardware and software e.g. operating system display technology and viewing application. The display on the computing device that views the remote document can differ from the display on the originating computer . Without color management images and graphical elements in the remote document displayed on one of the computing devices e.g. the tablet can differ in appearance from the same images and graphical elements displayed on the originating computer . An image and a graphical element in the remote document that can be color matched to each other when displayed at the computer can be color mismatched when appearing on the tablet . To provide consistent appearance of images and graphical elements of documents when displayed on different computing devices an application at the network server can convert select elements of the remote document before transmitting a retrieved modified document to display on the computing devices. In some embodiments the application at the network server can be aware of color management processing characteristics of an application and or operating system and or display capabilities used at the computing device on which the retrieved document is displayed. The network server can account for these color management characteristics when converting the remote document for display on a target computing device that receives the retrieved document .

Standard color profiles can specify color spaces that define representations for RGB color values relative to an absolute color reference. illustrates on a single diagram two dimensional representations for several different standard color profiles. Each color profile is shown relative to a visible spectrum of colors that can be perceived by an average person and plotted according to the standardized CIE 1931 XYZ color space created by the International Commission on Illumination CIE . Colors in the visible spectrum range from a shortest wavelength highest frequency at the violet end of the color spectrum to a longest wavelength lowest frequency at the red end of the color spectrum. Colors of light outside the visible spectrum can include ultra violet UV light values and infra red IR light values. Within a computer system color values are represented typically as a triple of red green and blue RGB values having eight or more bits for each value. Each RGB color space defined by a color profile can be illustrated as a triangle of RGB values as shown in the diagram with the lower left triangle vertex representing a pure blue 0 0 X color value the lower right triangle vertex representing a pure red X 0 0 color value and the upper triangle vertex representing a pure green 0 X 0 color value. An RGB color value having equal amounts of red green and blue X X X can represent a neutral color from black to grey to white depending on light intensity 0 0 0 corresponding to black and max max max corresponding to white. As shown in the sRGB color space covers a smaller portion of the visible spectrum than the Adobe RGB color space . A particular RGB value r g b can be associated with a different absolute color in the different color spaces represented by the different color profiles. For example the pure green color 0 X 0 at the upper vertex of the sRGB color space corresponds to a different absolute color in the visible spectrum than the same RGB value at the upper vertex of the Adobe RGB color space . The ProPhoto RGB color space can represent a much wider array of colors than the sRGB color space and the Adobe RGB color space including some colors that fall outside of the visible spectrum. When an image in a document is defined by a color profile that encompasses a different set of colors from the color profile associated with the output display the RGB values of the image can be transformed using the color management system including mapping out of gamut colors in one color space into in gamut colors in the other color space. If the application and or operating system in the computing device that displays the image does not use color management then significant visible color shifts can occur and the resulting image displayed without color management can differ from an intended color representation.

Conversion of original tagged images and original tagged CSS graphical elements can provide a modified document that uses a common color profile for all tagged elements. Untagged images and untagged CSS graphical elements can also be tagged with the same common color profile. With a single common color profile for the modified document variations in color representation through the browser application can be minimized. As different browser applications can use different color management schemes the selection of a common color profile that is standardized and capable of being displayed on the vast majority of displays for various computing devices can prove beneficial. In an embodiment the common color profile can be the sRGB profile to which most computing device displays can conform.

Table in illustrates several different transformations of RGB color values that can occur for different combinations of color management and color profiles. In the first transformation when no color management is used color profiles associated with an element in a document are ignored. In this case the source color profile associated with the source RGB color value and the display color profile associated with the display RGB color value are not applicable N A . Without color management the source RGB color value Rs1 Gs1 Bs1 can be presented on the display unchanged as the display RGB color value Rs1 Gs1 Bs1 . As the original source color profile if it exists is ignored the intended absolute color value cannot be determined and the displayed RGB color value can vary based on the display on which it is presented by the client device . Neither accurate nor consistent color can be achieved without color management. In the second transformation and the third transformation color management is used to convert the source RGB color value Rs1 Gs1 Bs1 according to the sRGB color profile to an absolute PCS CIEXYZ color value x1 y1 z1 . The absolute color value x1 y1 z1 can then be converted according to the appropriate display color profile to produce a displayed RGB color value that matches to the intended color value as well as possible accounting for variations and color gamuts of different color displays . In the second transformation the display color profile is the sRGB color profile and the display RGB color values Rs1 Gs1 Bs1 are the same as the source RGB color values. In the third transformation however the display color profile is a device specific color profile labeled Device RGB and the resulting display RGB values are Rd1 Gd1 Bd1 that can differ in numerical value from the source RGB color values Rs1 Gs2 Bs2 . Even though the display RGB values for the two transformations and are different the displayed color is intended to be the same i.e. as close as possible to the absolute color value x1 y1 z1 . Color management with the second and third transformations illustrate that the same source RGB color value can be adjusted to produce the same intended color across different displays.

In the fourth transformation a source RGB value Rs2 Gs2 Bs2 is associated with an Adobe RGB source color profile and is mapped to the same absolute color value x1 y1 z1 as the second and third transformations . With an sRGB display color profile the resulting display RGB color values Rs1 Gs1 Bs1 from the color management transformation can match those produced by the color transformation even though the source color RGB values are different. Color management accounts for the different source color spaces in which the source RGB values are defined. Without color management the source RGB color value Rs2 Gs2 Bs2 would be sent to the display unchanged as the display RGB values Rs2 Gs2 Bs2 . Unless the display color profile exactly matched the source color profile i.e. the Adobe RGB profile the resulting colors would differ from the intended color values. In order to compensate for inadequate color management at the client device the source RGB color values can be converted at the server to a common color profile e.g. sRGB. Thus the Adobe RGB source RGB color values Rs2 Gs2 Bs2 can be converted to the sRGB source RGB color values Rs1 Gs1 Bs1 before transmission to the client device . If there is color management at the client device the color values can be reproduced as accurately as possible within the more limited sRGB color space compared against the larger Adobe RGB color space . The conversion from the Adobe RGB color space to the sRGB color space at the server can affect in gamut colors minimally and out of gamut colors can be mapped using a defined intent e.g. perceptual intent to minimize differences when displayed. For the case when there is no color management at the client device the color values can also be reproduced accurately and consistently when the display at the client device conforms to the sRGB color profile as the server performs the appropriate conversion to the common sRGB color space to which the display conforms. When the display conforms to the sRGB color profile the same color value can be displayed using the first second or fourth transformations both with and without color management. Without conversion of color values at the server however the source RGB color values Rs2 Gs2 Bs2 will display incorrectly as the display RGB color values Rs2 Gs2 Bs2 as indicated by the sixth transformation no color management rather than as intended and indicated by the fourth transformation .

The fifth transformation illustrates that the same source RGB color value Rs1 Gs1 Bs1 can correspond to different absolute color values when associated with different source color profiles. When the source RGB color value Rs1 Gs1 Bs1 is associated with the sRGB color profile the absolute color value x1 y1 z1 is specified. When the source RGB color value Rs2 Gs2 Bs2 is associated with the Adobe RGB color profile a different absolute color value x2 y2 z2 is specified. With color management as provided by the transformation the source RGB value Rs1 Gs1 Bs1 results in the display RGB color value Rd2 Gd2 Bd2 where the display color profile uses the sRGB color profile. Without color management however the display RGB color value will correspond to the source RGB color value i.e. Rs1 Gs1 Bs1 as indicated by the transformation and a different color can be displayed accordingly.

The various aspects embodiments implementations or features of the described embodiments can be used separately or in any combination. Various aspects of the described embodiments can be implemented by software hardware or a combination of hardware and software.

The foregoing description for purposes of explanation used specific nomenclature to provide a thorough understanding of the described embodiments. However it will be apparent to one skilled in the art that the specific details are not required in order to practice the described embodiments. Thus the foregoing descriptions of the specific embodiments described herein are presented for purposes of illustration and description. They are not target to be exhaustive or to limit the embodiments to the precise forms disclosed. It will be apparent to one of ordinary skill in the art that many modifications and variations are possible in view of the above teachings.

The advantages of the embodiments described are numerous. Different aspects embodiments or implementations can yield one or more of the following advantages. Many features and advantages of the present embodiments are apparent from the written description and thus it is intended by the appended claims to cover all such features and advantages of the invention. Further since numerous modifications and changes will readily occur to those skilled in the art the embodiments should not be limited to the exact construction and operation as illustrated and described. Hence all suitable modifications and equivalents can be resorted to as falling within the scope of the invention.

