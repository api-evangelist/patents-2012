---

title: Reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally
abstract: Reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally, the hybrid computing environment including a host computer and a plurality of accelerators, the host computer and the accelerators each having local memory shared remotely with the other, including writing to the shared memory of the host computer packets of data representing changes in accelerator memory values, incrementing, in local memory and in remote shared memory on the host computer, a counter value representing the total number of packets written to the host computer, reading by the host computer from the shared memory in the host computer the written data packets, moving the read data to application memory, and incrementing, in both local memory and in remote shared memory on the accelerator, a counter value representing the total number of packets read by the host computer.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08539166&OS=08539166&RS=08539166
owner: International Business Machines Corporation
number: 08539166
owner_city: Armonk
owner_country: US
publication_date: 20120309
---
This application is a continuation application of and claims priority from U.S. patent application Ser. No. 12 537 377 filed on Aug. 7 2009.

The field of the invention is data processing or more specifically methods apparatus and products for reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally.

The development of the EDVAC computer system of 1948 is often cited as the beginning of the computer era. Since that time computer systems have evolved into extremely complicated devices. Today s computers are much more sophisticated than early systems such as the EDVAC. Computer systems typically include a combination of hardware and software components application programs operating systems processors buses memory input output I O devices and so on. As advances in semiconductor processing and computer architecture push the performance of the computer higher and higher more sophisticated computer software has evolved to take advantage of the higher performance of the hardware resulting in computer systems today that are much more powerful than just a few years ago.

Computer systems today have advanced such that some computing environments now include core components of different architectures which operate together to complete data processing tasks. Such computing environments are described in this specification as hybrid environments denoting that such environments include host computers and accelerators having different architectures. Although hybrid computing environments are more computationally powerful and efficient in data processing than many non hybrid computing environments such hybrid computing environments still present substantial challenges to the science of automated computing machinery.

Methods apparatus and products for reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally the hybrid computing environment including a host computer having a host computer architecture a plurality of accelerators having an accelerator architecture the accelerator architecture optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions the host computer and the accelerators adapted to one another for data communications by a system level message passing module the host computer having local memory shared remotely with the accelerators each accelerator having local memory shared remotely with the host computer the shared memory on both the host and the accelerators each configured as a predefined number of individual memory segments including writing by an accelerator when one or more memory values in accelerator application memory change through the system level message passing module to the shared memory of the host computer beginning at a next available memory segment one or more packets of data representing the changes in accelerator memory values including incrementing in both local shadow memory on the accelerator and in remote shared memory on the host computer a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer and reading by the host computer asynchronously with respect to the writing from the shared memory in the host computer beginning with a next unread memory segment the packets of data written by the accelerator to the shared memory in the host computer including moving the read data to application memory of the host computer and incrementing in both local shadow memory on the host computer and in remote shared memory on the accelerator a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

The foregoing and other objects features and advantages of the invention will be apparent from the following more particular descriptions of example embodiments of the invention as illustrated in the accompanying drawings wherein like reference numbers generally represent like parts of example embodiments of the invention.

Example methods apparatus and products for reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally according to embodiments of the present invention are described with reference to the accompanying drawings beginning with . sets forth a diagram of an example hybrid computing environment that reduces remote reads of memory by maintaining remote memory values locally according to embodiments of the present invention. A hybrid computing environment as the term is used in this specification is a computing environment in that it includes computer processors operatively coupled to computer memory so as to implement data processing in the form of execution of computer program instructions stored in the memory and executed on the processors.

The hybrid computing environment in the example of also includes at least one host computer having a host architecture that operates in cooperation with an accelerator having an accelerator architecture where the host architecture and accelerator architecture are different architectures. The host and accelerator architectures in this example are characterized by architectural registers registers that are accessible by computer program instructions that execute on each architecture registers such as for example an instruction register a program counter memory index registers stack pointers and the like. That is the number type structure and relations among the architectural registers of the two architectures are different so different that computer program instructions compiled for execution on the host computer of a hybrid computing environment typically cannot be executed natively by any associated accelerator of the hybrid computing environment. Examples of hybrid computing environments include a data processing system that in turn includes one or more host computers each having an x86 processor and accelerators whose architectural registers implement the PowerPC instruction set. Computer program instructions compiled for execution on the x86 processors in the host computers cannot be executed natively by the PowerPC processors in the accelerators. Readers will recognize in addition that some of the example hybrid computing environments described in this specification are based upon the Los Alamos National Laboratory LANL supercomputer architecture developed in the LANL Roadrunner project named for the state bird of New Mexico the supercomputer architecture that famously first generated a petaflop a million billion floating point operations per second. The LANL supercomputer architecture includes many host computers with dual core AMD Opteron processors coupled to many accelerators with IBM Cell processors the Opteron processors and the Cell processors having different architectures.

The example hybrid computing environment of includes a plurality of compute nodes I O nodes and a service node . The compute nodes are coupled through network for data communications with one another and with the I O nodes and the service node . The data communications network may be implemented as an Ethernet Internet Protocol In PCIe Infiniband Fibre Channel or other network as will occur to readers of skill in the art.

In the example hybrid computing environment of the compute nodes carry out principal user level computer program execution accepting administrative services such as initial program loads and the like from the service application executing on the service node and gaining access to data storage and I O functionality through the I O nodes . In the example of the I O nodes are connected for data communications to I O devices through a local area network LAN implemented using high speed Ethernet or a data communications fabric of another fabric type as will occur to those of skill in the art. I O devices in the example hybrid computing environment of include non volatile memory for the computing environment in the form of data storage device an output device for the hybrid computing environment in the form of printer and a user I O device in the form of computer terminal that executes a service application interface that provides to a user an interface for configuring compute nodes in the hybrid computing environment and initiating execution by the compute nodes of principal user level computer program instructions.

In the example of each compute node includes a host computer having a host computer architecture and one or more accelerators having an accelerator architecture. A host computer is a host in the sense that it is the host computer that carries out interface functions between a compute node and other components of the hybrid computing environment external to any particular compute node. That is it is the host computer that executes initial boot procedures power on self tests basic I O functions accepts user level program loads from service nodes and so on. An accelerator is an accelerator in that each accelerator has an accelerator architecture that is optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions. Such accelerated computing functions include for example vector processing floating point operations and others as will occur to those of skill in the art.

Because each of the compute nodes in the example of includes a host computer and an accelerator readers of skill in the art will recognize that each compute node represents a smaller separate hybrid computing environment within the larger hybrid computing environment of . That is not only may the combination of the compute nodes form a hybrid computing environment but it is also the case that each individual compute node may also be viewed as a separate smaller hybrid computing environment. The hybrid computing environment in the example of then properly may be viewed as composed of nine separate smaller hybrid computing environments one for each compute node which taken together form the hybrid computing environment of .

Within each compute node of a host computer and one or more accelerators are adapted to one another for data communications by a system level message passing module SLMPM and by two or more data communications fabrics of at least two different fabric types. An SLMPM is a module of automated computing machinery typically including a library of computer program instructions that exposes an application programming interface API to user level applications for carrying out message based data communications between the host computer and the accelerator . The SLMPM may be viewed as messaging middleware or a messaging layer in the overall architecture of a hybrid computing environment. Examples of message based data communications libraries that may be improved for use as an SLMPM according to embodiments of the present invention include 

A data communications fabric is a configuration of data communications hardware and software that implements a data communications coupling between a host computer and an accelerator. Examples of data communications fabric types include Peripheral Component Interconnect PCI PCI express PCIe Ethernet Infiniband Fibre Channel Small Computer System Interface SCSI External Serial Advanced Technology Attachment eSATA Universal Serial Bus USB and so on as will occur to those of skill in the art.

The example hybrid computing environment of is configured for reducing remote reads of memory by maintaining remote memory values locally in accordance with embodiments of the present invention. A remote read is a read of memory values from remote shared memory and whether shared memory is local or remote is a matter of perspective. A read of a memory value by a host computer from shared memory on an accelerator is a remote read and a read of a memory value by an accelerator from shared memory on a host computer is a remote read. At the same time a read of a memory value by a host computer from shared memory on the host computer is a local read and a read of a memory value by an accelerator from shared memory on the acclerator is a local read. It is generally very desirable to avoid remote reads. In typical hybrid computing environments a remote read requires both a transmission of a request for data as well as a return transmission of the data itself two messages through an SLMPM while a remote write typically requires only one such message transmitting the data to be written in remote shared memory. While a remote read so described may superficially appear to require merely twice the data processing resources of a remote write two messages instead of one in fact because of the additional processing required by the request for data not linear in proportion to a remote write such a remote read in many embodiments can require an order of magnitude more data processing resources than a remote write.

Each host computer in this example has local memory some portion of which is shared remotely with the accelerators and each accelerator has local memory some portion of which is shared remotely with the host computer. The shared memory on both the host and the accelerators is each configured as a predefined number of individual memory segments. The hybrid computing environment in this example reduces remote reads of memory as follows. When one or more memory values in accelerator application memory changes the accelerator writes through the SLMPM to the shared memory of the host computer beginning at a next available memory segment one or more packets of data representing the changes in accelerator memory values. The accelerator then increments in both local shadow memory on the accelerator and also in remote shared memory on the host computer a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer. The host computer having received data packets reads from the shared memory in the host computer beginning with a next unread memory segment the packets of data written by the accelerator to the shared memory in the host computer. The host s reading of the written data is carried out asynchronously with respect to the writing by the accelerator. Having read the data the host computer then moves the read data to application memory of the host computer and increments in both local shadow memory on the host computer and in remote shared memory on the accelerator a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

The function of reducing remote reads of memory in the example of is effectively bi directional. When one or more memory values in a host computer s application memory changes the host computer writes through the SLMPM to the shared memory of the accelerator beginning at a next available memory segment one or more packets of data representing the changes in host computer memory values. The host computer then increments in both local shadow memory on the host computer and also in remote shared memory on the accelerator a counter value representing the total number of packets written by the host computer to the shared memory in the accelerator. The accelerator having received data packets reads from the shared memory in the accelerator beginning with a next unread memory segment the packets of data written by the host computer to the shared memory in the accelerator. The accelerator s reading of the written data is carried out asynchronously with respect to the writing by the host computer. Having read the data the accelerator then moves the read data to application memory of the accelerator and increments in both local shadow memory on the accelerator and also in remote shared memory on the host computer a counter value representing the total number of packets read by the accelerator from the shared memory in the accelerator.

The arrangement of compute nodes data communications fabrics networks I O devices service nodes I O nodes and so on making up the hybrid computing environment as illustrated in are for explanation only not for limitation of the present invention. Hybrid computing environments capable of reducing remote reads of memory by maintaining remote memory values locally according to embodiments of the present invention may include additional nodes networks devices and architectures not shown in as will occur to those of skill in the art. Although the hybrid computing environment in the example of includes only nine compute nodes readers will note that hybrid computing environments according to embodiments of the present invention may include any number of compute nodes. The LANL supercomputer taken as an example of a hybrid computing environment with multiple compute nodes contains as of this writing more than 12 000 compute nodes. Networks and data communications fabrics in such hybrid computing environments may support many data communications protocols including for example TCP Transmission Control Protocol IP Internet Protocol and others as will occur to those of skill in the art. Various embodiments of the present invention may be implemented on a variety of hardware platforms in addition to those illustrated in .

For further explanation sets forth a block diagram of an example hybrid computing environment reduces remote reads of memory by maintaining remote memory values locally according to embodiments of the present invention. The hybrid computing environment of includes four compute nodes . Similar to the compute nodes of each of the compute nodes in the example of may represent a small separate hybrid computing environment which taken together make up a larger hybrid computing environment. One compute node in the example of is illustrated in an expanded view to aid a more detailed explanation of such a hybrid computing environment . As shown in the expanded view of compute node each of the compute nodes in the example of includes a host computer . The host computer includes a computer processor operatively coupled to computer memory Random Access Memory RAM through a high speed memory bus . The processor in each host computer has a set of architectural registers that defines the host computer architecture.

Each of the compute nodes also includes one or more accelerators . Each accelerator includes a computer processor operatively coupled to RAM through a high speed memory bus . Stored in RAM of the host computer and the accelerators is an operating system . Operating systems useful in host computers and accelerators of hybrid computing environments according to embodiments of the present invention include UNIX Linux Microsoft XP Microsoft Vista Microsoft NT AIX IBM s i5 OS and others as will occur to those of skill in the art. There is no requirement that the operating system in the host computers should be the same operating system used on the accelerators.

The processor of each accelerator has a set of architectural registers that defines the accelerator architecture. The architectural registers of the processor of each accelerator are different from the architectural registers of the processor in the host computer . With differing architectures it would be uncommon although possible for a host computer and an accelerator to support the same instruction sets. As such computer program instructions compiled for execution on the processor of an accelerator generally would not be expected to execute natively on the processor of the host computer and vice versa. Moreover because of the typical differences in hardware architectures between host processors and accelerators computer program instructions compiled for execution on the processor of a host computer generally would not be expected to execute natively on the processor of an accelerator even if the accelerator supported the instruction set of the host. The accelerator architecture in example of is optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions. That is for the function or functions for which the accelerator is optimized execution of those functions will proceed faster on the accelerator than if they were executed on the processor of the host computer.

In the example of the host computer and the accelerators are adapted to one another for data communications by a system level message passing module SLMPM and two data communications fabrics of at least two different fabric types. In this example to support message based data communications between the host computer and the accelerator both the host computer and the accelerator have an SLMPM so that message based communications can both originate and be received on both sides of any coupling for data communications. Also in the example of the host computer and the accelerators are adapted to one another for data communications by a PCIe fabric through PCIe communications adapters and an Ethernet fabric through Ethernet communications adapters . The use of PCIe and Ethernet is for explanation not for limitation of the invention. Readers of skill in the art will immediately recognize that hybrid computing environments according to embodiments of the present invention may include fabrics of other fabric types such as for example PCI Infiniband Fibre Channel SCSI eSATA USB and so on.

The SLMPM in this example operates generally for data processing in a hybrid computing environment by monitoring data communications performance for a plurality of data communications modes between the host computer and the accelerators receiving a request to transmit data according to a data communications mode from the host computer to an accelerator determining whether to transmit the data according to the requested data communications mode and if the data is not to be transmitted according to the requested data communications mode selecting another data communications mode and transmitting the data according to the selected data communications mode. In the example of the monitored performance is illustrated as monitored performance data stored by the SLMPM in RAM of the host computer during operation of the compute node .

A data communications mode specifies a data communications fabric type a data communications link and a data communications protocol . A data communications link is data communications connection between a host computer and an accelerator. In the example of a link between the host computer and the accelerator may include the PCIe connection or the Ethernet connection through the Ethernet network . A link between the host computer and the accelerator in the example of may include the PCIe connection or the Ethernet connection through the Ethernet network . Although only one link for each fabric type is illustrated between the host computer and the accelerator in the example of readers of skill in the art will immediately recognize that there may any number of links for each fabric type.

A data communications protocol is a set of standard rules for data representation signaling authentication and error detection required to send information from a host computer to an accelerator . In the example of the SLMPM may select one of several protocols for data communications between the host computer and the accelerator. Examples of such protocols include shared memory transfers SMT executed with a send and receive operations and direct memory access DMA executed with PUT and GET operations .

Shared memory transfer is a data communications protocol for passing data between a host computer and an accelerator into shared memory space allocated for such a purpose such that only one instance of the data necessarily resides in memory at any particular time. Consider the following as an example shared memory transfer between the host computer and the accelerator of . An application requests a transmission of data from the host computer to the accelerator in accordance with the SMT protocol. Such a request may include a memory address allocated for such shared memory. In this example the shared memory segment is illustrated in a memory location on the accelerator but readers will recognize that shared memory segments may be located on the accelerator on the host computer on both the host computer and the accelerator or even off the local compute node entirely so long as the segment is accessible as needed by the host and the accelerator. To carry out a shared memory transfer the SLMPM on the host computer establishes a data communications connection with the SLMPM executing on the accelerator by a handshaking procedure similar to that in the TCP protocol. The SLMPM then creates a message that includes a header and payload data and inserts the message into a message transmit queue for a particular link of a particular fabric. In creating the message the SLMPM inserts in the header of the message an identification of the accelerator and an identification of a process executing on the accelerator. The SLMPM also inserts the memory address from the request into the message either in the header or as part of the payload data. The SLMPM also inserts the data to be transmitted in the message as part of the message payload data. The message is then transmitted by a communications adapter across a fabric to the SLMPM executing on the accelerator where the SLMPM stores the payload data the data that was transmitted in shared memory space in RAM in accordance with the memory address in the message.

Direct memory access DMA is a data communications protocol for passing data between a host computer and an accelerator with reduced operational burden on the computer processor . A DMA transfer essentially effects a copy of a block of memory from one location to another typically from a host computer to an accelerator or vice versa. Either or both a host computer and accelerator may include DMA engine an aggregation of computer hardware and software for direct memory access. Direct memory access includes reading and writing to memory of accelerators and host computers with reduced operational burden on their processors. A DMA engine of an accelerator for example may write to or read from memory allocated for DMA purposes while the processor of the accelerator executes computer program instructions or otherwise continues to operate. That is a computer processor may issue an instruction to execute a DMA transfer but the DMA engine not the processor carries out the transfer.

In the example of only the accelerator includes a DMA engine while the host computer does not. In this embodiment the processor on the host computer initiates a DMA transfer of data from the host to the accelerator by sending a message according to the SMT protocol to the accelerator instructing the accelerator to perform a remote GET operation. The configuration illustrated in the example of in which the accelerator is the only device containing a DMA engine is for explanation only not for limitation. Readers of skill in the art will immediately recognize that in many embodiments both a host computer and an accelerator may include a DMA engine while in yet other embodiments only a host computer includes a DMA engine.

To implement a DMA protocol in the hybrid computing environment of some memory region is allocated for access by the DMA engine . Allocating such memory may be carried out independently from other accelerators or host computers or may be initiated by and completed in cooperation with another accelerator or host computer. Shared memory regions allocated according to the SMA protocol for example may be memory regions made available to a DMA engine. That is the initial setup and implementation of DMA data communications in the hybrid computing environment of may be carried out at least in part through shared memory transfers or another out of band data communications protocol out of band with respect to a DMA engine. Allocation of memory to implement DMA transfers is relatively high in latency but once allocated the DMA protocol provides for high bandwidth data communications that requires less processor utilization than many other data communications protocols.

A direct PUT operation is a mode of transmitting data from a memory location on an origin device to a memory location on a target device through a DMA engine. A direct PUT operation allows data to be transmitted and stored on the target device with little involvement from the target device s processor. To effect minimal involvement from the target device s processor in the direct PUT operation the DMA engine transfers the data to be stored on the target device along with a specific identification of a storage location on the target device. The DMA engine knows the specific storage location on the target device because the specific storage location for storing the data on the target device has been previously provided by the target device.

A remote GET operation sometimes denominated an rGET is another mode of transmitting data from a memory location on an origin device to a memory location on a target device through a DMA engine. A remote GET operation allows data to be transmitted and stored on the target device with little involvement from the origin device s processor. To effect minimal involvement from the origin device s processor in the remote GET operation the DMA engine stores the data in a storage location accessible one the target device notifies the target device directly or out of band through a shared memory transmission of the storage location and the size of the data ready to be transmitted and the target device retrieves the data from the storage location.

Monitoring data communications performance for a plurality of data communications modes may include monitoring a number of requests in a message transmit request queue for a data communications link . In the example of each message transmit request queue is associated with one particular data communications link . Each queue includes entries for messages that include data to be transmitted by the communications adapters along a data communications link associated with queue.

Monitoring data communications performance for a plurality of data communications modes may also include monitoring utilization of a shared memory space . In the example of shared memory space is allocated in RAM of the accelerator. Utilization is the proportion of the allocated shared memory space to which data has been stored for sending to a target device and has not yet been read or received by the target device monitored by tracking the writes and reads to and from the allocated shared memory. In the hybrid computing environment of shared memory space any memory in fact is limited. As such a shared memory space may be filled during execution of an application program such that transmission of data from the host computer to an accelerator may be slowed or even stopped due to space limitations in the shared memory space.

In some embodiments of the present invention the hybrid computing environment of may be configured to operate as a parallel computing environment in which two or more instances the application program executes on two or more host computers in the parallel computing environment. In such embodiments monitoring data communications performance across data communications modes may also include aggregating data communications performance information across a plurality of instances of the application program executing on two or more host computers in a parallel computing environment. The aggregated performance information may be used to calculate average communications latencies for data communications modes average number of requests in data communications links of a particular fabric type average shared memory utilization among the plurality of host computers and accelerators in the parallel computing environment and so on as will occur to those of skill in the art. Any combination of such measures may be used by the SLMPM for both determining whether to transmit the data according to requested data communications mode and selecting another data communications mode for transmitting the data if the data is not to be transmitted according to the requested data communications mode.

The SLMPM of functions in part by receiving from an application program on the host computer a request to transmit data according to a data communications mode from the host computer to the accelerator . Such data may include computer program instructions compiled for execution by the accelerator work piece data for an application program executing on the accelerator or some combination of computer program instructions and work piece data. Receiving a request to transmit data according to a data communications mode may include receiving a request to transmit data by a specified fabric type receiving a request to transmit data through a specified data communications link from the host computer to the accelerator or receiving a request to transmit data from the host computer to the accelerator according to a protocol.

A request to transmit data according to a data communications mode may be implemented as a user level application function call through an API to the SLMPM a call that expressly specifies a data communications mode according to protocol fabric type and link. A request implemented as a function call may specify a protocol according to the operation of the function call itself. A dacs put function call for example may represent a call through an API exposed by an SLMPM implemented as a DACS library to transmit data in the default mode of a DMA PUT operation. Such a call from the perspective of the calling application and the programmer who wrote the calling application represents a request to the SLMPM library to transmit data according to the default mode known to the programmer to be default mode associated with the express API call. The called function in this example dacs put may be coded according to embodiments of the present invention to make its own determination whether to transmit the data according to the requested data communications mode that is according to the default mode of the called function. In a further example a dacs send instruction may represent a call through an API exposed by an SLMPM implemented as a DACS library to transmit data in the default mode of an SMT send operation where the called function dacs send is again coded according to embodiments of the present invention to make its own determination whether to transmit the data according to the requested mode.

An identification of a particular accelerator in a function call may effectively specify a fabric type. Such a function call may include as a call parameters an identification of a particular accelerator. An identification of a particular accelerator by use of a PCIe ID for example effectively specifies a PCI fabric type. In another similar example an identification of a particular accelerator by use of a media access control MAC address of an Ethernet adapter effectively specifies the Ethernet fabric type. Instead of implementing the accelerator ID of the function call from an application executing on the host in such a way as to specify a fabric type the function call may only include a globally unique identification of the particular accelerator as a parameter of the call thereby specifying only a link from the host computer to the accelerator not a fabric type. In this case the function called may implement a default fabric type for use with a particular protocol. If the function called in the SLMPM is configured with PCIe as a default fabric type for use with the DMA protocol for example and the SLMPM receives a request to transmit data to the accelerator according to the DMA protocol a DMA PUT or DMA remote GET operation the function called explicitly specifies the default fabric type for DMA the PCIe fabric type.

In hybrid computing environments in which only one link of each fabric type adapts a single host computer to a single accelerator the identification of a particular accelerator in a parameter of a function call may also effectively specify a link. In hybrid computing environments where more than one link of each fabric type adapts a host computer and an accelerator such as two PCIe links connecting the host computer to the accelerator the SLMPM function called may implement a default link for the accelerator identified in the parameter of the function call for the fabric type specified by the identification of the accelerator.

The SLMPM in the example of also functions in part by determining in dependence upon the monitored performance whether to transmit the data according to the requested data communications mode. Determining whether to transmit the data according to the requested data communications mode may include determining whether to transmit data by a requested fabric type whether to transmit data through a requested data communications link or whether to transmit data according to a requested protocol.

In hybrid computing environments where monitoring data communications performance across data communications modes includes monitoring a number of requests in a message transmit request queue for a data communications link determining whether to transmit the data according to the requested data communications mode may be carried out by determining whether the number of requests in the message transmit request queue exceeds a predetermined threshold. In hybrid computing environments where monitoring data communications performance for a plurality of data communications modes includes monitoring utilization of a shared memory space determining whether to transmit the data according to the requested data communications mode may be carried out by determining whether the utilization of the shared memory space exceeds a predetermined threshold.

If the data is not to be transmitted according to the requested data communications mode the SLMPM selects in dependence upon the monitored performance another data communications mode for transmitting the data and transmits the data according to the selected data communications mode. Selecting another data communications mode for transmitting the data may include selecting in dependence upon the monitored performance another data communications fabric type by which to transmit the data selecting a data communications link through which to transmit the data and selecting another data communications protocol. Consider as an example that the requested data communications mode is a DMA transmission using a PUT operation through link of the PCIe fabric to the accelerator . If the monitored data performance indicates that the number of requests in transmit message request queue associated with the link exceeds a predetermined threshold the SLMPM may select another fabric type the Ethernet fabric and link through which to transmit the data . Also consider that the monitored performance indicates that current utilization of the shared memory space is less than a predetermined threshold while the number of outstanding DMA transmissions in the queue exceeds a predetermined threshold. In such a case the SLMPM may also select another protocol such as a shared memory transfer by which to transmit the data .

Selecting by the SLMPM another data communications mode for transmitting the data may also include selecting a data communications protocol in dependence upon data communications message size . Selecting a data communications protocol in dependence upon data communications message size may be carried out by determining whether a size of a message exceeds a predetermined threshold. For larger messages the DMA protocol may be a preferred protocol as processor utilization in making a DMA transfer of a larger message is typically less than the processor utilization in making a shared memory transfer of a message of the same size.

As mentioned above the SLMPM may also transmit the data according to the selected data communications mode. Transmit the data according to the selected data communications mode may include transmitting the data by the selected data communications fabric type transmitting the data through the selected data communications link or transmitting the data according to the selected protocol. The SLMPM may effect a transmission of the data according to the selected data communications mode by instructing through a device driver the communications adapter for the data communications fabric type of the selected data communications mode to transmit the message according to a protocol of the selected data communications mode where the message includes in a message header an identification of the accelerator and in the message payload the data to be transmitted.

The example hybrid computing environment of depicts only two accelerators adapted to one host computer for clarity of explanation not limitation. Readers of skill in the art will recognize that host computers in hybrid computing environments configured for reducing remote reads of memory according to embodiments of the present invention may be adapted to many more accelerators. Hybrid computing environments according to embodiments of the present invention that include a host computer adapted to multiple accelerators may be configured to carry out one or more collective operations. A collective operation as the term is used in this specification refers to an operation one or more computer program instructions that is executed simultaneously that is at approximately the same time by a number of accelerators adapted to a host computer at the behest of the host computer. Examples of collective operations include broadcast operations reduction operations allgather operations alltoall operations allreduce operations scatter operations barrier operations and so on as will occur to those of skill in the art.

To support execution of collective operations in the hybrid computing environment of the host computer is configured with local memory shared remotely with the accelerators the shared local memory depicted in this example as shared memory space of RAM . The accelerators of in a similar fashion are also configured with local memory shared remotely with the host computer. The shared local memory for the accelerators is depicted in the example of as a shared memory space in RAM of the accelerator . Memory local to a number of accelerators is computer memory capable of being accessed by each of the accelerators directly without use of message passing through an SLMPM . Such local memory may be described by contrast to shared memory space on the host computer where access by either accelerator to the shared memory space requires message passing according to a DMA or SMT protocol through the SLMPM adapting the accelerator to the host computer . In some embodiments of the present invention the shared local memory for the accelerators may be implemented as a RAM module directly accessible by the processors of each accelerator through a memory bus where the RAM module is contained within one of the accelerators as depicted in the example of or external to the accelerators.

The host computer and accelerators in the example of function generally so as to reduce remote reads of memory in the hybrid computing environment in accordance with embodiments of the present invention. Each host computer has local memory shared remotely with the accelerators and each accelerator has local memory shared remotely with a host computer. The shared memory on both the hosts and the accelerators is configured as a predefined number of individual memory segments . Both accelerator and host run data processing application programs that use application memory for storage of values of user level memory variables strings and so on. Both accelerators and the host computer maintain counters in memory both remotely and locally that count respecively 

In this example all of the counters are configured with sufficient storage capacity so as to require no resets. All of the totals stored in the counters no doubt initialized to zero at some point in the past such as for example at the time when the hybrid computing environment was first powered on accumulate continuously always reflecting the entire history of reads and writes to and from shared memory on the host computers and the accumulators from the time when the hybrid computing environment was first powered on until the present.

Host computers and accelerators may reduce remote reads according to embodiments of the present invention by maintaining all remote memory values locally or maintaining a subset of remote memory values locally. In some embodiments where all remote memory values are maintained locally an SLMPM can be configured to track all changes in memory values in application memory. In other embodiments an SLMPM is configured with information indicating a subset of memory values in application memory to be tracked and maintained locally and remotely. In the example of the application programs and the operating systems are configured to notify the SLMPMs through their memory access functions of changes in application memory values. Memory access functions include any data processing function that affects a memory value writes puts moves and so on. In this example memory access functions of an accelerator notify an SLMPM of changes in accelerator application memory values and memory access functions of a host computer notify an SLMPM of changes in host computer application memory values .

When one or more memory values in accelerator application memory changes an accelerator writes through an SLMPM to the shared memory of its associated host computer beginning at a next available memory segment one or more packets of data representing the changes in accelerator memory values. The accelerator then increments in both local shadow memory on the accelerator and also in remote shared memory on the host computer a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer. The local counter value is referred to as a shadow value because it effectively shadows or tracks the counter value written remotely. The host computer having received data packets reads from the shared memory in the host computer beginning with a next unread memory segment the packets of data written by the accelerator to the shared memory in the host computer. The host s reading of the written data is carried out asynchronously with respect to the writing by the accelerator. Having read the data the host computer then moves the read data to application memory of the host computer and increments in both local shadow memory on the host computer and in remote shared memory on the accelerator a counter value representing the total number of packets read by the host computer from the shared memory in the host computer. Moving the read data to application memory effectively maintains as local memory values that are in fact administered or affected remotely. From the point of view of the host computer in this example every remote data value of interest is always available by a local read of local application memory with little or no need for remote reads. In fact if all remote values of interest to the host computer are maintained locally in this manner the host computer will never be required to execute a remote read.

The reduction of remote reads of memory in the example of is effectively bi directional. When one or more memory values in a host computer s application memory changes the host computer writes through an SLMPM to the shared memory of the accelerator beginning at a next available memory segment one or more packets of data representing the changes in host computer memory values. The host computer then increments in both local shadow memory on the host computer and also in remote shared memory on the accelerator a counter value representing the total number of packets written by the host computer to the shared memory in the accelerator. The accelerator having received data packets reads from the shared memory in the accelerator beginning with a next unread memory segment the packets of data written by the host computer to the shared memory in the accelerator. The accelerator s reading of the written data is carried out asynchronously with respect to the writing by the host computer. Having read the data the accelerator then moves the read data to application memory of the accelerator and increments in both local shadow memory on the accelerator and also in remote shared memory on the host computer a counter value representing the total number of packets read by the accelerator from the shared memory in the accelerator.

A host computer can increment a counter value representing the total number of packets read by the host computer from the shared memory in the host computer by incrementing the counter value in both places upon every such read. As an alternative however the host computer can increment a counter value representing the total number of packets read by the host computer from the shared memory in the host computer by incrementing the counter value in local shadow memory in the host computer every time the host computer reads packets of data from the shared memory in the host computer and incrementing the counter value in remote shared memory on the accelerator only when the number of unread memory segments in the shared memory in the host computer reaches a predetermined unread memory threshold. Similarly an accelerator can increment a counter value representing the total number of packets read by the accelerator from the shared memory in the accelerator by incrementing the counter value in local shadow memory in the accelerator every time the accelerator reads packets of data from the shared memory in the accelerator and incrementing the counter value in remote shared memory on the host computer only when the number of unread memory segments in the shared memory in the accelerator reaches a predetermined unread memory threshold.

Each accelerator in the example of is configured to determine using only counter values stored in local memory on the accelerator a number of unread memory segments in the shared memory of the host computer in dependence upon the total number of packets written by the accelerator to the shared memory in the host computer and the total number of packets read by the host computer from the shared memory in the host computer. The accelerators can make such a determination by calculating the number of unread memory segments in the shared memory of the host computer by subtracting from the total number of packets written by the accelerator to the shared memory in the host computer the total number of packets read by the host computer from the shared memory in the host computer. Making this determination of the number of unread memory segments in the shared memory of the host computer using only counter values stored in local memory on the accelerator means that the determination is made with no remote reads of memory.

Each accelerator in the example of is further configured to determine using only counter values stored in local memory on the accelerator a number of memory segments in the shared memory of the host computer available to receive data packets in dependence upon the predetermined number of individual memory segments in the shared memory of the host computer and the number of unread memory segments in the shared memory of the host computer. The accelerators can make such a determination by calculating the number of memory segments in the shared memory of the host computer available to receive data packets by subtracting from the predetermined number of individual memory segments in the shared memory of the host computer the number of unread memory segments in the shared memory of the host computer. The number of memory segments in the shared memory of the host computer is configured into the accelerators as a local operating parameter stored in local memory on each accelerator not shown in . The number of unread memory segments in the shared memory of the host computer is calculated as described just above and again making this determination of the number of memory segments in the shared memory of the host computer available to receive data packets using only counter values stored in local memory on the accelerator means that the determination is made with no remote reads of memory.

Each accelerator in the example of is further configured to identify the next available memory segment in the shared memory of the host computer that is where in the shared memory of the host computer to start writing according to J 1 modulo N where J is the total number of packets written by the accelerator to the shared memory of the host computer and N is the predetermined number of individual memory segments. As mentioned above the counter values representing the total number of packets written by an accelerator to the shared memory of a host computer are always increasing no wraps no resets so that their values become arbitrarily large with respect to N. J 1 modulo N however is always a value between 0 and N 1 always indicating the next memory segment in the shared memory of a host computer that is available to receive packets of data from an accelerator.

Each host computer in the example of is configured to determine using only counter values stored in local memory on the host computer the number of unread memory segments in the shared memory of the host computer in dependence upon the total number of packets written by the accelerator to the shared memory in the host computer and the total number of packets read by the host computer from the shared memory in the host computer. A host computer can make this determination by calculating the number of unread memory segments in the shared memory of the host computer by subtracting from the total number of packets written by the accelerator to the shared memory in the host computer the total number of packets read by the host computer from the shared memory in the host computer. Each host computer in this example is also configured to identify the next unread memory segment according to K 1 modulo N where K is the total number of packets read by the host computer from the shared memory in the host computer and N is the predetermined number of individual memory segments in the shared memory of the host computer. Having so identified the next unread memory segment a host computer then reads from the shared memory in the host computer by reading unread data from the determined number of unread memory memory segments beginning with the identified next unread memory segment. These reads are local reads by the host computer from shared local memory on the host computer.

As mentioned above having read the data the host computer then moves the read data to application memory of the host computer. Moving the read data to application memory effectively maintains as local memory values that are in fact administered or affected remotely. Readers will recognize that this is a variance of the general use as described above of shared memory such that only one instance of any particular item of data necessarily resides in memory at any particular time because data values used to reduce remote reads according to embodiments of the present invention typically reside in memory in at least two places both in application memory of an accelerator and also in application memory of a host computer. And this dual storage of memory values used to reduce remote reads presists according to embodiments of the present invention regardless whether the accelerator or the host functions as local or remote.

For further explanation sets forth a block diagram of a further example hybrid computing environment that reduces remote reads of memory by maintaining remote memory values locally according to embodiments of the present invention. The hybrid computing environment of is similar the hybrid computing environment of including as it does four compute nodes each of which includes a host computer having a host computer architecture and an accelerator having an accelerator architecture where the accelerator architecture is optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions. The host computer and the accelerator are adapted to one another for data communications by a system level message passing module and two or more data communications fabrics of at least two different fabric types. In the example of the host computer is adapted to accelerator by an Ethernet fabric and a PCIe fabric .

The host computer as illustrated in the expanded view of the compute node includes an x86 processor. An x86 processor is a processor whose architecture is based upon the architectural register set of the Intel x86 series of microprocessors the 386 the 486 the 586 or Pentium and so on. Examples of x86 processors include the Advanced Micro Devices AMD Opteron the AMD Phenom the AMD Athlon XP the AMD Athlon 64 Intel Nehalam Intel Pentium 4 Intel Core 2 Duo Intel Atom and so on as will occur to those of skill in the art. The x86 processor in the example of Figure illustrates a set of a typical architectural registers found in many x86 processors including for example an accumulator register AX a base register BX a counter register CX a data register DX a source index register for string operations SI a destination index for string operations DI a stack pointer SP a stack base pointer for holding the address of the current stack frame BP and an instruction pointer that holds the current instruction address IP .

The accelerator in the example of is illustrated as a Cell Broadband Engine CBE having a Cell Broadband Engine Architecture CBEA . A CBEA is a microprocessor architecture jointly developed by Sony Computer Entertainment Toshiba and IBM an alliance known as STI. Microprocessors implemented according to the CBEA are sometimes referred to as Cell processors or simply as CBEs. The CBEA combines a general purpose POWER architecture core a Power Processing Element PPE of modest performance with streamlined co processing elements called Synergistic Processing Elements SPEs which greatly accelerate multimedia and vector processing applications as well as many other forms of dedicated computation. The CBE architecture emphasizes efficiency watt prioritizes bandwidth over latency and favors peak computational throughput over simplicity of program code.

The accelerator of implemented as a CBE includes a main processor that in this example is a Power Processing Element PPE eight fully functional co processors called SPEs and a high bandwidth circular data bus connecting the PPE and the SPEs called the Element Interconnect Bus EIB . The PPE is a POWER architecture processor with a two way multithreaded core acting as a controller for the eight SPEs . The term POWER architecture here refers to IBM s different generations of processor architectures a broad term including all products based on POWER PowerPC and Cell architectures. The architectural registers of the PPE of the CBE accelerator therefore are different from those of the x86 processor of the host computer . The PPE of includes an example set of architectural registers of the POWER architecture including 32 general purpose registers GPRs 32 floating point registers FPRs a fixed point exception register XER a count register CTR a Condition register CR an instruction address register IAR a link register LR and a processor version register PVR .

The SPEs handle most of the computational workload of the CBE . While the SPEs are optimized for vectorized floating point code execution the SPEs also may execute operating systems such as for example a lightweight modified version of Linux with the operating system stored in local memory on the SPE. Each SPE in the example of includes a Synergistic Processing Unit SPU and a Memory Flow Controller MFC . An SPU is a Reduced Instruction Set Computing RISC processor with 128 bit single instruction multiple data SIMD organization for single and double precision instructions. In some implementations an SPU may contain a 256 KB embedded Static RAM for instructions and data called local storage which is visible to the PPE and can be addressed directly by software. Each SPU can support up to 4 Gigabyte GB of local store memory. The local store does not operate like a conventional CPU cache because the local store is neither transparent to software nor does it contain hardware structures that predict which data to load. The SPUs also implement architectural registers different from those of the PPE which include a 128 bit 128 entry register file . An SPU can operate on 16 8 bit integers 8 16 bit integers 4 32 bit integers or 4 single precision floating point numbers in a single clock cycle as well as execute a memory operation.

The MFC integrates the SPUs in the CBE . The MFC provides an SPU with data transfer and synchronization capabilities and implements the SPU interface to the EIB which serves as the transportation hub for the CBE . The MFC also implements the communication interface between the SPE and PPE and serves as a data transfer engine that performs bulk data transfers between the local storage of an SPU and CBE system memory RAM through DMA. By offloading data transfer from the SPUs onto dedicated data transfer engines data processing and data transfer proceeds in parallel supporting advanced programming methods such as software pipelining and double buffering. Providing the ability to perform high performance data transfer asynchronously and in parallel with data processing on the PPE and SPEs the MFC eliminates the need to explicitly interleave data processing and transfer at the application level.

The SLMPM in the example of processes data in the hybrid computing environment according to embodiments of the present invention by monitoring data communications performance for a plurality of data communications modes between the host computer and the accelerator receiving from an application program on the host computer a request to transmit data according to a data communications mode from the host computer to the accelerator determining in dependence upon the monitored performance whether to transmit the data according to the requested data communications mode and if the data is not to be transmitted according to the requested data communications mode selecting in dependence upon the monitored performance another data communications mode for transmitting the data and transmitting the data according to the selected data communications mode.

The hybrid computing environment in the example of includes only one accelerator adapted to a host computer for clarity of explanation not limitation. As mentioned above hybrid computing environments configured for reducing remote reads of memory by maintaining remote memory values locally according to embodiments of the present invention may include any number of accelerators adapted to a host computer . The example hybrid computing environment of is configured for reducing remote reads of memory by maintaining remote memory values locally in accordance with embodiments of the present invention. Each host computer in this example has local memory some portion of which is shared remotely with accelerators and each accelerator has local memory some portion of which is shared remotely with a host computer. The shared memory on both the host and the accelerators is each configured as a predefined number of individual memory segments. The hybrid computing environment in this example reduces remote reads of memory as follows. When one or more memory values in accelerator application memory changes the accelerator writes through the SLMPM to the shared memory of the host computer beginning at a next available memory segment one or more packets of data representing the changes in accelerator memory values. The accelerator then increments in both local shadow memory on the accelerator and also in remote shared memory on the host computer a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer. The host computer having received data packets reads from the shared memory in the host computer beginning with a next unread memory segment the packets of data written by the accelerator to the shared memory in the host computer. The host s reading of the written data is carried out asynchronously with respect to the writing by the accelerator. Having read the data the host computer then moves the read data to application memory of the host computer and increments in both local shadow memory on the host computer and in remote shared memory on the accelerator a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

The function of reducing remote reads of memory in the example of is effectively bi directional. When one or more memory values in a host computer s application memory changes the host computer writes through the SLMPM to the shared memory of the accelerator beginning at a next available memory segment one or more packets of data representing the changes in host computer memory values. The host computer then increments in both local shadow memory on the host computer and also in remote shared memory on the accelerator a counter value representing the total number of packets written by the host computer to the shared memory in the accelerator. The accelerator having received data packets reads from the shared memory in the accelerator beginning with a next unread memory segment the packets of data written by the host computer to the shared memory in the accelerator. The accelerator s reading of the written data is carried out asynchronously with respect to the writing by the host computer. Having read the data the accelerator then moves the read data to application memory of the accelerator and increments in both local shadow memory on the accelerator and also in remote shared memory on the host computer a counter value representing the total number of packets read by the accelerator from the shared memory in the accelerator.

For further explanation sets forth a block diagram of a further example hybrid computing environment that reduces remote reads of memory by maintaining remote memory values locally according to embodiments of the present invention. The hybrid computing environment of is similar the hybrid computing environment of including as it does four compute nodes each of which includes a host computer having a host computer architecture and one or more accelerators each having an accelerator architecture where the accelerator architecture is optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions. The host computer and the accelerator in the example of are adapted to one another for data communications by a system level message passing module and two or more data communications fabrics of at least two different fabric types. In the example of the host computer is adapted to accelerator by an Ethernet fabric and a PCIe fabric .

Each x86 processor core in the example of is adapted through an Ethernet and PCIe fabric to a separate accelerator implemented as a CBE as described above with respect to . Each core of each AMD Opteron processor in the host computer in this example is connected to at least one CBE. Although in this example the ratio of cores of the Opteron processors to CBEs is one to one readers of skill in the art will recognize that other example embodiments may implement different ratios of processor cores to accelerators such as for example one to two one to three and so on.

Each instance of the SLMPM executing on each x86 processor core in the example of processes data in the hybrid computing environment according to embodiments of the present invention by monitoring data communications performance across data communications modes between the host computer and the accelerator connected to the processor core receiving from the instance of the application program executing on the processor core of the host computer a request to transmit data according to a data communications mode from the host computer to the accelerator connected to the processor core determining in dependence upon the monitored performance whether to transmit the data according to the requested data communications mode and if the data is not to be transmitted according to the requested data communications mode selecting in dependence upon the monitored performance another data communications mode for transmitting the data and transmitting the data according to the selected data communications mode.

The example hybrid computing environment of also may be configured as described above for reducing remote reads of memory by maintaining remote memory values locally in accordance with embodiments of the present invention. Each host computer can have some portion of its local memory shared remotely with accelerators and each accelerator can have some portion of its local memory shared remotely with a host computer. The shared memory on both the host and the accelerators is to be configured as a predefined number of individual memory segments. The hybrid computing environment in this example then can be configured to reduces remote reads of memory as follows. When one or more memory values in accelerator application memory changes the accelerator writes through an SLMPM to the shared memory of the host computer beginning at a next available memory segment one or more packets of data representing the changes in accelerator memory values. The accelerator then increments in both local shadow memory on the accelerator and also in remote shared memory on the host computer a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer. The host computer having received data packets reads from the shared memory in the host computer beginning with a next unread memory segment the packets of data written by the accelerator to the shared memory in the host computer. The host s reading of the written data is carried out asynchronously with respect to the writing by the accelerator. Having read the data the host computer then moves the read data to application memory of the host computer and increments in both local shadow memory on the host computer and in remote shared memory on the accelerator a counter value representing the total number of packets read by the host computer from the shared memory in the host computer. Just as the functionality described above in this paragraph reduces remote reads of memory on an accelerator by maintaining remote data values from the accelerator locally on a host computer so also the functionality can be adapted bi directionally to also reduce remote reads of memory on a host computer by maintaining remote data values from the host computer locally on an accelerator.

For further explanation sets forth a flow chart illustrating an example method of reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally according to embodiments of the present invention. The method of is implemented in and upon a hybrid computing environment similar to the hybrid computing environments described above in this specification with regard to . Such a hybrid computing environment includes a host computer having a host computer architecture and a number of accelerators having an accelerator architecture the accelerator architecture optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions the host computer and the accelerators adapted to one another for data communications by an SLMPM and optionally by two or more data communications fabrics on of at least two different fabric types. The host computer has local memory shared remotely with the accelerators and each accelerator has local memory on shared remotely with the host computer. The shared memory on both the host and the accelerators are each configured as a predefined number of individual memory segments .

The method of includes notifying by memory access functions of the accelerator the SLMPM of changes in accelerator application memory values . The method of also includes writing by an accelerator when one or more memory values in accelerator application memory change through the SLMPM to the shared memory of the host computer beginning at a next available memory segment one or more packets of data representing the changes in accelerator memory values. In this example writing the data packets further includes incrementing in both local shadow memory on the accelerator and in remote shared memory on the host computer a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer.

The method of also includes reading by the host computer from the shared memory in the host computer beginning with a next unread memory segment the packets of data written by the accelerator to the shared memory in the host computer. In the method of the reading of the data packets is carried out asynchronously with respect to the writing . In the method of the reading of the data packets further includes moving the read data to application memory of the host computer and incrementing in both local shadow memory on the host computer and in remote shared memory on the accelerator a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

For further explanation sets forth a flow chart illustrating a further example method of reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally according to embodiments of the present invention. The method of is implemented in and upon a hybrid computing environment similar to the hybrid computing environments described above in this specification with regard to . Such a hybrid computing environment includes a host computer having a host computer architecture and a number of accelerators having an accelerator architecture the accelerator architecture optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions the host computer and the accelerators adapted to one another for data communications by an SLMPM and optionally by two or more data communications fabrics on of at least two different fabric types. The host computer has local memory shared remotely with the accelerators and each accelerator has local memory on shared remotely with the host computer. The shared memory on both the host and the accelerators are each configured as a predefined number of individual memory segments . The method of is similar to the method of including as it does writing by an accelerator to the shared memory of the host computer packets of data representing changes in accelerator memory values incrementing a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer asynchronously reading by the host computer the packets of data written by the accelerator to the shared memory in the host computer moving the read data to application memory of the host computer and incrementing a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

In the method of however incrementing a counter value representing the total number of packets read by the host computer from the shared memory in the host computer includes incrementing the counter value in local shadow memory in the host computer every time the host computer reads packets of data from the shared memory in the host computer and incrementing the counter value in remote shared memory on the accelerator only when the number of unread memory segments in the shared memory in the host computer reaches a predetermined unread memory threshold . The threshold can be expressed as a proportion of fullness so that for example when the number of unread memory segments in the shared memory of the host computer indicates that one third one half or two thirds or any proportion as may occur to those of skill in the art of the memory segments in the shared memory of the host computer are occupied by unread data packets then the host computer increments the counter value in remote shared memory on the accelerator representing the total number of packets read by the host computer from the shared memory in the host computer. This procedure has the benefit of reducing the number of remote writes of the counter value in remote shared memory on the accelerator and results in a harmless temporary inaccuracy in the counter value in remote shared memory on the accelerator.

For further explanation sets forth a flow chart illustrating a further example method of reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally according to embodiments of the present invention. The method of is implemented in and upon a hybrid computing environment similar to the hybrid computing environments described above in this specification with regard to . Such a hybrid computing environment includes a host computer having a host computer architecture and a number of accelerators having an accelerator architecture the accelerator architecture optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions the host computer and the accelerators adapted to one another for data communications by an SLMPM and optionally by two or more data communications fabrics on of at least two different fabric types. The host computer has local memory shared remotely with the accelerators and each accelerator has local memory on shared remotely with the host computer. The shared memory on both the host and the accelerators are each configured as a predefined number of individual memory segments . The method of is similar to the method of including as it does writing by an accelerator to the shared memory of the host computer packets of data representing changes in accelerator memory values incrementing a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer asynchronously reading by the host computer the packets of data written by the accelerator to the shared memory in the host computer moving the read data to application memory of the host computer and incrementing a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

The method of however also includes determining by the accelerator using only counter values stored in local memory on the accelerator the number of unread memory segments in the shared memory of the host computer in dependence upon the total number of packets written by the accelerator to the shared memory in the host computer and the total number of packets read by the host computer from the shared memory in the host computer. The accelerator can make this determination calculating the number of unread memory segments in the shared memory of the host computer by subtracting from the total number of packets written by the accelerator to the shared memory in the host computer the total number of packets read by the host computer from the shared memory in the host computer.

The method of also includes determining by the accelerator using only counter values stored in local memory on the accelerator a number of memory segments in the shared memory of the host computer available to receive data packets in dependence upon the predetermined number N of individual memory segments in the shared memory of the host computer and the number of unread memory segments in the shared memory of the host computer. The accelerator can make this determination calculating the number of memory segments in the shared memory of the host computer available to receive data packets by subtracting from the predetermined number of individual memory segments in the shared memory of the host computer here represented as N the number of unread memory segments in the shared memory of the host computer calculated as described just above by subtracting from the total number of packets written by the accelerator to the shared memory in the host computer the total number of packets read by the host computer from the shared memory in the host computer.

The method of also includes identifying by the accelerator the next available memory segment in the shared memory of the host computer that is available to receive data packets according to J 1 modulo N where J is the total number of packets written by the accelerator to the shared memory of the host computer and N is the predetermined number of individual memory segments. Then in this example writing packets of data representing changes in accelerator memory value can be carried out by writing the packets of data to the number of memory segments so determined to be available to receive data packets beginning with the next memory segment so identified as available to receive data packets.

For further explanation sets forth a flow chart illustrating a further example method of reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally according to embodiments of the present invention. The method of is implemented in and upon a hybrid computing environment similar to the hybrid computing environments described above in this specification with regard to . Such a hybrid computing environment includes a host computer having a host computer architecture and a number of accelerators having an accelerator architecture the accelerator architecture optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions the host computer and the accelerators adapted to one another for data communications by an SLMPM and optionally by two or more data communications fabrics on of at least two different fabric types. The host computer has local memory shared remotely with the accelerators and each accelerator has local memory on shared remotely with the host computer. The shared memory on both the host and the accelerators are each configured as a predefined number of individual memory segments . The method of is similar to the method of including as it does writing by an accelerator to the shared memory of the host computer packets of data representing changes in accelerator memory values incrementing a counter value representing the total number of packets written by the accelerator to the shared memory in the host computer asynchronously reading by the host computer the packets of data written by the accelerator to the shared memory in the host computer moving the read data to application memory of the host computer and incrementing a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

The method of however also includes determining by the host computer using only counter values stored in local memory on the host computer the number of unread memory segments in the shared memory of the host computer in dependence upon the total number of packets written by the accelerator to the shared memory in the host computer and the total number of packets read by the host computer from the shared memory in the host computer. The host computer can make this determination calculating the number of unread memory segments in the shared memory of the host computer by subtracting from the total number of packets written by the accelerator to the shared memory in the host computer the total number of packets read by the host computer from the shared memory in the host computer.

The method of also includes identifying by the host computer the next unread memory segment in the shared memory on the host computer according to K 1 modulo N where K is the total number of packets read by the host computer from the shared memory in the host computer and N is the predetermined number of individual memory segments in the shared memory of the host computer. In the example of reading data packets from the shared memory in the host computer includes reading unread data from the determined number of unread memory memory segments beginning with the identified next unread memory segment .

For further explanation sets forth a flow chart illustrating a further example method of reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally according to embodiments of the present invention. The method of is implemented in and upon a hybrid computing environment similar to the hybrid computing environments described above in this specification with regard to . Such a hybrid computing environment includes a host computer having a host computer architecture and a number of accelerators having an accelerator architecture the accelerator architecture optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions the host computer and the accelerators adapted to one another for data communications by an SLMPM and optionally by two or more data communications fabrics on of at least two different fabric types. The host computer has local memory on shared remotely with the accelerators and each accelerator has local memory shared remotely with the host computer. The shared memory on both the host and the accelerators are each configured as a predefined number of individual memory segments .

The method of includes notifying by memory access functions of the host computer the SLMPM of changes in host computer application memory values . Having been made aware of changes in tracked values the host computer then ascertains how much data currently can be written to the shared memory of the accelerator and where in the shared memory of the accelerator it can write the data That is the method of also includes determining by the host computer using only counter values stored in local memory on the host computer a number of unread memory segments in the shared memory of the accelerator in dependence upon the total number of packets written by the host computer to the shared memory in the accelerator and the total number of packets read by the accelerator from the shared memory in the accelerator. The host computer makes this determination calculating the number of unread memory segments in the shared memory of the accelerator by subtracting from the total number of packets written by the host computer to the shared memory in the accelerator the total number of packets read by the accelerator from the shared memory in the accelerator.

The method of also includes determining by the host computer using only counter values stored in local memory on the host computer the number of memory segments in the shared memory of the accelerator available to receive data packets in dependence upon the predetermined number N of individual memory segments in the shared memory of the accelerator and the number of unread memory segments in the shared memory of the accelerator. This determination calculating the number of memory segments in the shared memory of the accelerator available to receive data packets can be made by subtracting from the predetermined number N of individual memory segments in the shared memory of the accelerator the number of unread memory segments in the shared memory of the accelerator with the number of unread memory segments in the shared memory of the accelerator calculated as described just above subtracting from the total number of packets written by the host computer to the shared memory in the accelerator the total number of packets read by the accelerator from the shared memory in the accelerator.

The method of also includes identifying by the host computer the next available memory segment in the shared memory of the accelerator according to L 1 modulo N where L is the total number of packets written by the host computer to the shared memory of the accelerator and N is the predetermined number of individual memory segments.

The method of also includes writing by the host computer when one or more memory values in host computer application memory change through the SLMPM to the shared memory of an accelerator beginning at the next available memory segment one or more packets of data representing the changes in host computer memory values. Such writing in this example includes incrementing in both local shadow memory on the host computer and in remote shared memory on the accelerator a counter value representing the total number of packets written by the host computer to the shared memory in the accelerator.

The method of also includes reading by the accelerator asynchronously with respect to the writing from the shared memory in the accelerator beginning with a next unread memory segment the packets of data written by the host computer to the shared memory in the accelerator. In this example such reading includes moving the read data to application memory of the accelerator and incrementing in both local shadow memory on the accelerator and in remote shared memory on the host computer a counter value representing the total number of packets read by the accelerator from the shared memory in the accelerator.

For further explanation sets forth a flow chart illustrating a further example method of reducing remote reads of memory in a hybrid computing environment by maintaining remote memory values locally according to embodiments of the present invention. The method of is implemented in and upon a hybrid computing environment similar to the hybrid computing environments described above in this specification with regard to . Such a hybrid computing environment includes a host computer having a host computer architecture and a number of accelerators having an accelerator architecture the accelerator architecture optimized with respect to the host computer architecture for speed of execution of a particular class of computing functions the host computer and the accelerators adapted to one another for data communications by an SLMPM and optionally by two or more data communications fabrics on of at least two different fabric types. The host computer has local memory shared remotely with the accelerators and each accelerator has local memory on shared remotely with the host computer. The shared memory on both the host and the accelerators are each configured as a predefined number of individual memory segments . The method of is similar to the method of including as it does writing by a host computer to the shared memory of an accelerator packets of data representing changes in host computer memory values incrementing a counter value representing the total number of packets written by the host computer to the shared memory in the accelerator asynchronously reading by the accelerator the packets of data written by the host computer to the shared memory in the accelerator moving the read data to application memory of the host computer and incrementing a counter value representing the total number of packets read by the host computer from the shared memory in the host computer.

The method of however also includes determining by the accelerator using only counter values stored in local memory on the accelerator the number of unread memory segments in the shared memory of the accelerator in dependence upon the total number of packets written by the host computer to the shared memory in the accelerator and the total number of packets read by the accelerator from the shared memory in the accelerator. This determination calculating the number of unread memory segments in the shared memory of the accelerator can be carried out by subtracting from the total number of packets written by the host computer to the shared memory in the accelerator the total number of packets read by the accelerator from the shared memory in the accelerator. The method of also includes identifying by the accelerator the next unread memory segment according to M 1 modulo N where M is the total number of packets read by the accelerator from the shared memory in the accelerator and N is the predetermined number of individual memory segments in the shared memory of the accelerator. In the method of reading from the shared memory in the host computer includes reading unread data from the determined number of unread memory memory segments beginning with the identified next unread memory segment .

Example embodiments of the present invention are described largely in the context of reducing remote reads of memory by maintaining remote memory values locally in a fully functional hybrid computing environment. Readers of skill in the art will recognize however that method aspects of the present invention also may be embodied in a computer program product disposed on recordable media for machine readable information including magnetic media optical media or other suitable media. Examples of recordable media include magnetic disks in hard drives or diskettes compact disks for optical drives magnetic tape and others as will occur to those of skill in the art. Persons skilled in the art will immediately recognize that any computer system having suitable programming means will be capable of executing the steps of the method of the invention as embodied in a program product. Persons skilled in the art will recognize immediately that although some of the example embodiments described in this specification are oriented to software installed and executing on computer hardware nevertheless alternative embodiments implemented as firmware or as hardware are well within the scope of the present invention.

It will be understood from the foregoing description that modifications and changes may be made in various embodiments of the present invention without departing from its true spirit. The descriptions in this specification are for purposes of illustration only and are not to be construed in a limiting sense. The scope of the present invention is limited only by the language of the following claims.

