---

title: Method and apparatus for performing granular restoration of data objects from machine images stored on sequential backup media
abstract: A method and apparatus for performing granular restoration from machine images stored on sequential backup media is disclosed. In one embodiment, the method for performing granular restoration from machine images stored on sequential backup media includes processing at least one machine image file to identify at least one database file and at least one data object that is arranged within the at least one database file and generating mapping information regarding the at least one data object within the at least one machine image file, wherein the at least one machine image is to be stored on the sequential backup media.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09529806&OS=09529806&RS=09529806
owner: Veritas Technologies LLC
number: 09529806
owner_city: Mountain View
owner_country: US
publication_date: 20120928
---
The present patent application is a divisional of U.S. patent application Ser. No. 12 277 264 filed on Nov. 24 2008 entitled METHOD AND APPARATUS FOR PERFORMING GRANULAR RESTORATION OF DATA OBJECTS FROM MACHINE IMAGES STORED ON SEQUENTIAL BACKUP MEDIA and is incorporated by reference herein in its entirety and for all purposes as if completely and fully set forth herein.

Embodiments of the present invention generally relate to data recovery techniques and more particularly to a method and apparatus for performing granular restoration of data objects from virtual and non virtual machine images stored on sequential backup media.

In a typical computing environment an organization may employ any number of technologies to process store protect recover produce and secure mission critical data. For example the organization may employ one or more data protection systems to backup and recover the mission critical data after a disaster or data corruption. Furthermore the organization may employ one or more virtualization techniques to create one or more abstract computer resources e.g. virtual machines virtual applications virtual desktops virtual hardware devices and or the like from physical computer resources. Moreover the typical computing environment may include one or more data storage systems for facilitating permanent storage retrieval and transmission of the mission critical data throughout a computer network.

In addition the typical computing environment may include one or more database management systems for organizing and retrieving structured data e.g. tables within one or more databases. For example the one or more databases may include various data objects e.g. emails word documents spreadsheets and or the like which are regularly backed up through the one or more data storage systems e.g. magnetic tape drives as one or more machine image i.e. virtual machine or non virtual machine image files arranged in a format such as .VHD .VMDK or .V2I . As the amount of data to be backed up increases the number of backup volumes e.g. magnetic tapes also increases significantly.

The typical computing environment may provide granular restoration to facilitate data recovery of individual data objects within a volume. Furthermore system information for the volume may be brought back online and available to users at the expense of processing overhead. Currently granular restoration is achieved by staging an entire machine image i.e. files from a tape drive onto a disk. Then the machine image is mounted in order to extract individual data objects. Such a conventional approach requires a significant amount of resources e.g. processing time and storage space for the staging process even when there is a very small amount of data to be restored. Furthermore such a conventional approach does not apply to Virtual MICROSOFT Exchange Server protection.

Therefore there is a need in the art for a method and apparatus for performing granular restoration of data objects from virtual and non virtual machine images that are stored on sequential backup media.

Embodiments of the present invention comprise a method and apparatus for performing granular restoration from machine images stored on sequential backup media. In one embodiment the method for performing a granular restoration of data objects from machine images stored on sequential backup media includes processing at least one machine image to identify at least one database and at least one data object that is arranged within the at least one database and generating mapping information regarding the at least one data object within the at least one machine image wherein the at least one machine image is to be stored on the sequential backup media.

The application server is a type of computing device e.g. a laptop a desktop a Personal Digital Assistant PDA and or the like such as those generally known in the art. The application server hosts an application for one or more client computers. In one embodiment the application server includes a database i.e. a database management system for one or more files in an aggregate data type format such as .EDB files for MICROSOFT Exchange . Generally the database includes a collection of files organized in such a manner that database software may easily and quickly retrieve one or more files. In some embodiments the database includes multiples segments of equal size where each segment is commonly referred to as a page.

The database may be a system that manages various files e.g. emails word documents spreadsheets and or the like which are regularly backed up through the one or more data storage systems e.g. magnetic tape drives as the machine image files . In one embodiment the database stores data that may be utilized by the application . For example the database may be a MICROSOFT Exchange database that stores various data objects e.g. emails journal entries notes mailboxes calendar events and or the like to be provided to the one or more client computers by MICROSOFT Exchange Server.

The storage generally includes various components i.e. hardware and software that are configured to manage storage resources within a computing environment. The storage includes one or more data storage devices e.g. hard disk drives optical drives magnetic tape drives and or the like and storage management software that provides an interface e.g. Integrated Drive Electronics AT Attachment IDE ATA Small Computer Systems Interface SCSI and or the like to the one or more data storage devices for the application server and or the backup server . According to one or more embodiments the storage facilitates permanent storage i.e. backup of critical computer data on sequential backup media . For example one or more machine image files and mapping information may be streamed to the sequential backup media . As explained further below the machine image files further include one or more database files and one or more log files . The database files further include one or more data objects e.g. documents emails journal entries notes mailboxes calendar events and or the like .

The backup server is a type of computing device e.g. a laptop a desktop a Personal Digital Assistant PDA and or the like such as those generally known in the art. The backup server includes a CPU support circuits and a memory . The CPU may comprise one or more commercially available microprocessors or microcontrollers that facilitate data processing and storage. The support circuits facilitate the operation of the CPU and include one or more clock circuits power supplies cache input output circuits and the like. The memory comprises at least one of a Read Only Memory ROM a Random Access Memory RAM disk drive storage an optical storage a removable storage and the like. The memory includes various software packages such as data protection software . The memory further includes various data such as a catalog . The memory further includes a staging area . In one embodiment the data protection software includes backup software programs data recovery software programs and or the like. In one or more embodiments the data protection software mounts the machine image files in order to facilitate access to the data blocks that comprise the data objects .

The network comprises a communication system that connects computers by wire cable fiber optic and or wireless link facilitated by various types of well known network elements such as hubs switches routers and the like. The network may employ various well known protocols to communicate information amongst the network resources. For example the network may be a part of the internet or intranet using various communications infrastructure such as Ethernet WiFi WiMax General Packet Radio Service GPRS and the like.

The machine image files may be one or more files of various formats for encapsulating and representing a hard disk a block device and or a physical machine in a proprietary format. As an example the machine image files may include one or more virtual machine image files such as virtual hard disk .VHD files VMDK files and or the like. As another example the machine image files may include one or more non virtual machine image files such as a disk image .V2I file created by SYMANTEC BackupExec software products. As yet another example the machine image files may include one or more snapshots of the application server and or the database .

The machine image files may be stored as one or more backups e.g. a full backup an incremental backup a differential backup and or the like . In one or more embodiments a particular machine image file of the machine image files may be a full backup or an incremental backup of the application server . For example the machine image files may include a full backup and one or more incremental backups of the application server which are stored sequentially on magnetic tape. As such the full backup and the one or more incremental backups may form a backup chain in which one or more storage states of the database are maintained. Furthermore a particular incremental backup of the application server includes one or more modified and or added data blocks and indicates any deleted data blocks since a previous backup e.g. a previous incremental backup or a base full backup .

As explained below the machine image files may be mounted to access the database files and the data objects . The machine image files include application data for the application which is stored in the database files according to various embodiments. The machine image files may include preprocessed application data. For example the preprocessed application may be flushed from memory to disk on the application server by a Volume Shadow Copy Service VSS writer.

The database files represent one or more storage states of the database at one or more particular points in time according to one or more embodiments of the present invention. As such application data managed by the database is arranged into an aggregate data file format and stored as the database files . In one embodiment the database files may be encrypted. For example the database files may include one or more MICROSOFT Exchange Database files e.g. EDB files that store various emails mailboxes notes journals and or the like for one or more MICROSOFT Exchange Servers. The database files further include the data objects i.e. various files and or data items such as emails documents settings journal entries and or the like which may be disseminated over one or more extents i.e. one or more contiguous data blocks in a computer memory . As explained further below one or more data objects of the data objects are selected for granular restoration and or disaster recovery of the database .

The log files include information regarding input output activity associated with the database files e.g. file system and or storage operations . In one embodiment the log files enumerate input output activity performed during a backup. In one embodiment the log files include records of one or more write attempts to the database files . In one or more embodiments the log files are applied to the database files by the data protection software in order to facilitate point in time consistency among the database files .

According to various embodiments of the present invention the catalog stores object hierarchy information e.g. information regarding directories and files of the file system . The object hierarchy information provides classifications for data i.e. files within the database . The object hierarchy information indicates a category or a collection of categories that correspond with each data object of the data objects . Furthermore the catalog specifies dependencies and other relationships between ones of the objects . In one embodiment the catalog is examined to select a data object e.g. a file an email and or the like for granular restoration and or disaster recovery. In addition the catalog include a pointer to the mapping information e.g. a reference to a location on the sequential backup media 

According to various embodiments of the present invention the staging area is a portion of the memory that may be utilized to store one or more data objects of the data objects that are transmitted from sequential storage media e.g. a magnetic tape drive and or the like . In one embodiment one or more pages of the database files that include the one or more data objects are copied to the staging area. For example if an email is to be restored to the database of the application server then each and every page that includes one or more data blocks that form the email are copied to the staging area . Finally the one or more data blocks are communicated to the application server where the email is restored to the database . Subsequently the one or more data blocks are formatted in accordance with the Messaging Application Programming Interface MAPI that corresponds with MICROSOFT Exchange technologies. In one embodiment one or more MAPI functions may be used to perform the restoration of the email.

According to various embodiments of the present invention the data protection software is configured to generate the mapping information to enable granular restoration of the data objects . In one embodiment the data protection software applies a mapping technique to the machine image files to generate the mapping information . In one embodiment the data protection software generates one or more mappings between one or more extents e.g. one or more contiguous portions of computer memory of the machine image files and the database files . Subsequently the data protection software streams the mapping information to the sequential backup media along with the machine image files . For example the data protection software may utilize a mapping service such as VERITAS Mapping Services VxMS to determine locations i.e. offsets of the one or more extents that form the database files . As such the mapping information may indicate an offset of five hundred and twelve bytes for a particular database file having a size of ten megabytes. Hence the particular database file resides in a ten megabyte block of computer memory that begins at an address that is five hundred and twelve bytes from a beginning of a particular machine image file.

In one or more embodiments the mapping information further includes database layout information that defines an arrangement of the application data i.e. the data objects within the database files . For example the database layout information may be used to determine one or more mappings between one or more extents and the data objects . Furthermore the data protection software utilizes the database layout information to determine a hierarchy of the data objects within the database files . Subsequently the data protection software stores information regarding the hierarchy of the data objects in the catalog .

The data protection software is configured to enable disaster recovery granular object recovery and or granular file recovery from virtual and or non virtual machine images stored in sequential storage devices e.g. magnetic tape drives . In one embodiment the data protection software creates the machine image files i.e. the virtual and or non virtual machine images for the application server and or the database using various virtualization and non virtualization technologies. Subsequently the data protection software streams the machine image files as backups to the sequential backup media as well as the mapping information as explained herein. Notably only database pages that include application data that is to be restored are copied to the staging area instead of the virtual and non virtual machine images in entirety.

The data protection software may store a full backup for which one or more incremental backups use as a base full backup in a backup chain. In one embodiment the data protection software synthesizes a full backup for a later point in time from the base full backup and the one or more incremental backups. As such the data protection software may apply a mapping technique to the synthesized full backup to generate the mapping information. Furthermore the one or more incremental backups are streamed to the sequential backup media in chronological order to facilitate future granular restoration. In one embodiment object creation time information within the database files may be utilized to determine one or more mappings between one or more extents on the sequential backup media and one or more modified data objects.

In operation the data protection software generates the mapping information to facilitate data object restoration using locations i.e. addresses of one or more extents that form the data objects . After mounting the machine image files the data protection software utilizes the mapping information to locate and extract a data object of the data objects . The data object may be selected by user using the object hierarchy information stored in the catalog . In operation the data protection software accesses one or more data blocks that form the data object from the machine image files . Subsequently the data protection software stores the one or more data blocks in the staging area to be restored to the database of the application server . As such the data object restoration may be performed without extracting the database files or staging the machine image files off the sequential backup media .

In one embodiment the data protection software copies one or more pages of the database files that include the one or more data blocks to the staging area . Once the one or more pages are stored the data protection software formats the one or more data blocks to be restored to the application server . In one embodiment the one or more data blocks are formatted in accordance with an Application Programming Interface API that corresponds with the application . Subsequently the data protection software uses one or more API functions to restore the data object to the database . For example a particular data object e.g. an email a journal entry and or the like in a MICROSOFT Exchange database file is formatted for restoration through MAPI as explained above.

In another embodiment the data protection software accesses the one or more data blocks that form the data object from a full backup and or one or more incremental backups. As explained above the machine image files may be streamed to sequential backup media e.g. the sequential backup media of by the data protection software as a backup chain. In reverse chronological order the data protection software processes the one or more incremental backups and accesses the one or more data blocks. The data protection software halts when each and every data block of the one or more data blocks is extracted or after the full backup is processed according to one embodiment.

At step database files e.g. the database files of are identified. In an embodiment the machine images are processed to identify the database files. At step a determination is made as to whether the database files are point in time consistent. If it is determined that the database files are point in time consistent option YES then the method proceeds to step . If at step it is determined that the database files are not point in time consistent option NO then the method proceeds to step . At step the log files are applied to the database files. At step mapping information e.g. the mapping information of is generated. In one embodiment the mapping information indicates one or more mappings between one or more extents of the machine image files and the database files. In another embodiment the mapping information further includes one or more mappings between one or more extents of the machine image files and the data objects.

The method proceeds to step at which object hierarchy information is stored in a catalog e.g. the catalog of . In an embodiment the object hierarchy information provides classifications for data i.e. files within the database . At step the machine image files e.g. the machine image files of and the mapping information are streamed to a sequential backup media. The method proceeds to step at which the method ends.

At step a mapping technique is applied to the machine image files e.g. the machine image files of . At step mappings are determined between extents and the database files e.g. the database files of . At step the database files are examined. The method proceeds to step at which mappings are determined between the extents and the data objects e.g. the data objects of . The method proceeds to step at which the method ends.

At step a full backup is synthesized. At step the mapping information e.g. the mapping information of is generated. In one embodiment data object creation information is examined to determine one or more mappings for modified data blocks. Subsequently the mapping information is streamed to the sequential backup media. At step a pointer to the mapping information is stored in the catalog. The method proceeds to step at which the machine image files are streamed to the sequential backup media. At optional step the synthesized full backup is deleted. Then the method proceeds to step at which the method ends. In one embodiment after step the method proceeds to step at which the method ends.

At step object hierarchy information is examined. In an embodiment the object hierarchy information provides classifications for data i.e. data objects within the database and is stored in the catalog. At step one or more data objects e.g. the objects of are selected for restoration. At step mapping information e.g. the mapping information of is processed. At step a determination is made as to whether a full backup is required. If it is determined that the full backup is required option YES then the method proceeds to step . At step the data blocks are extracted from the full backup. If at step it is determined that the full backup is not required option NO then the method proceeds to step . At step the data blocks are extracted from an incremental backup.

At step a determination is made as to whether more data blocks are to be extracted. If it is determined that more data blocks are to be extracted option YES then the method proceeds to step . If at step it is determined that no more data blocks are to be extracted option NO then the method proceeds to step . At step the data blocks are copied to a staging area e.g. the staging area of . In one embodiment the staging area stores the machine image files e.g. the machine image files of . At step the data blocks are formatted. The method proceeds to step at which the data objects are restored. The method proceeds to step at which the method ends.

The various embodiments of methods and apparatus advantageously provide an efficient and rapid data backup and restoration solution. Further various embodiments of the present invention provide recovery out of both the virtual machine image as well as the non virtual machine image. The embodiments of the present invention provide disaster recovery of the virtual machine full recovery of the database and granular recovery of individual objects out of a single image through a single backup.

While the foregoing is directed to embodiments of the present invention other and further embodiments of the invention may be devised without departing from the basic scope thereof and the scope thereof is determined by the claims that follow.

