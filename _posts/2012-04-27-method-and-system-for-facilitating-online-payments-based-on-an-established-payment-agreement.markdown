---

title: Method and system for facilitating online payments based on an established payment agreement
abstract: A method and system for facilitating online payments are disclosed. According to one aspect of the present invention, a payment agreement is established at a payment service provider that defines terms of a payment relationship between a merchant and a user. The establishing of the payment agreement includes linking the payment agreement with a payment account of the merchant or user stored at the payment service provider. After establishing the payment agreement, a payment request associated with a transaction is received, whereby the payment request includes a unique identifier to identify the payment agreement stored at the payment service provider. Based on a verification that the payment request complies with terms of the payment agreement, the payment request is processed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09317841&OS=09317841&RS=09317841
owner: PayPal, Inc.
number: 09317841
owner_city: San Jose
owner_country: US
publication_date: 20120427
---
This application is a continuation of U.S. application Ser. No. 10 873 704 filed Jun. 21 2004 now U.S. Pat. No. 8 175 938 and claims the benefit of the filing date of U.S. Provisional Patent Application No. 60 562 065 filed Apr. 13 2004 which applications are incorporated in their entirety herein by reference.

The present invention relates generally to commerce automation. More particularly the present invention relates to a method and system for facilitating online payments based on an established payment agreement.

Electronic commerce e commerce has been increasing in popularity as more people are becoming accustomed to purchasing products online via the Internet. Such purchases can be facilitated through the use of a third party online payment service such as the PayPal online payment service provided by PayPal of San Jose Calif. One problem with existing online payment services is that the customer must navigate away from the merchant s website to make a payment. For example the customer must login to the payment service provider s website for each online payment the customer makes. The extra time spent logging into and navigating the payment service provider s website to make a payment is inconvenient particularly when the purchase involves a small amount of money.

A method and system for facilitating merchant initiated online payments are described. In the following description for purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the present invention. It will be evident however to one skilled in the art that the present invention may be practiced without these specific details.

The present invention provides several advantages over prior payment methods and systems. In particular the present invention provides a customer with a simpler and faster way to transact with merchants. According to one embodiment of the present invention a customer initiates a merchant initiated payment relationship with a merchant by navigating a series of web pages and providing the necessary information to establish the payment relationship. Once the payment relationship is in place the customer can purchase goods and or services from the merchant with the ease and simplicity of a single click to authorize a payment. Other features and advantages of the present invention will be apparent from the detailed description that follows.

The merchant server executes Internet server software including but not limited to web server software and Application Program Interface API server software. The web server software executing on merchant server serves web pages to web clients such as a web browser executing on client . The web pages provide an interface to a virtual store that customers can browse with the web browser software. While browsing the virtual store customers can select items to purchase. The merchant server temporarily stores items selected for purchase which can be accessed for checkout by selecting a link to a virtual shopping cart.

The payment service provider s server is connected to the client PC and the merchant server via the Internet . Like the merchant server the payment service provider s server also executes Internet server software including but not limited to web server software and API server software. For one embodiment of the present invention to process a payment for the customer s selected items the merchant server interacts with the payment service provider s server via an API protocol. For example the API server software provides a programmatic interface allowing the merchant server and the payment service provider s server to communicate using standardized API calls. According to one embodiment of the present invention a software development kit may be provided to each merchant that offers its customers the option to pay via the payment service provider. Consequently before a customer enters into a payment relationship with a merchant the merchant will generally already have established a relationship of its own with the payment service provider and the merchant will have integrated the API functionality into its merchant server to communicate with the payment service provider s server .

For purposes of the invention a merchant is any person or entity that is set up to receive payments in exchange for goods or services. For example a merchant may include any seller vendor retailer or person initiating an auction for goods or services. Once a customer has established an account or signed up with the merchant and has selected goods and or services to purchase the customer may be presented with several payment options. For example if the customer has a pre existing merchant initiated payment relationship with the merchant the customer may be presented with the option to make a payment via the payment service provider using a merchant initiated payment the details of which will be described in detail below. However if the customer does not yet have an existing merchant initiated payment relationship with the merchant the customer will be presented with an option to establish a merchant initiated payment relationship with the merchant by selecting a sign up button or link directing the customer to the website of the payment service provider.

For one embodiment of the present invention the communication between the merchant server and the payment service provider server is via API calls with standardized variables. For example when the customer selects to establish a merchant initiated payment relationship with the merchant by clicking a sign up link on the merchant s website an API call is made from the merchant server to the payment service provider server requesting the establishment of a merchant initiated payment relationship. In connection with the request one or more data items may be communicated to the payment service provider server . The data items may include but are not limited to the following 

For one embodiment of the invention the merchant server may encrypt the data items before communicating the data items to the payment service provider s server . Additionally for security reasons the merchant server may digitally sign the message associated with the API call so that the payment service provider s server can verify the authenticity of the message when it is received.

After the customer has selected to establish a merchant initiated payment relationship with the merchant the customer is redirected to a payment relationship initiation web page hosted by the payment service provider s server . If for example the customer has a pre existing account with the payment service provider the customer may be asked to verify his identity by submitting the user credentials e.g. username and or password associated with the customer s existing account. However if the customer does not have a pre existing account with the payment service provider the customer may be asked to provide a username and password as well as other information to establish an account and to identify the customer as the holder of the account with the payment service provider.

In either case the customer is presented with information about the merchant and the terms of the merchant initiated payment relationship agreement with the payment service provider. For example the terms of the agreement may be directly related to the data items communicated from the merchant server to the payment service provider server . The terms may include the name of the payee to which payments will be made on behalf of the customer and the exact nature of the goods and or service for which the customer authorizes the payment service provider to make payments. In addition the agreement terms may include a default maximum or minimum amount that the customer authorizes to be paid to the merchant over a particular time period. For example the agreement underlying the payment relationship may dictate that the payment service provider on behalf of the customer is authorized to pay merchant initiated payment requests for a particular dollar amount per month. If the customer agrees with the terms of the agreement the customer may indicate so by clicking on a particular link or button. In response the customer may be presented with a web page confirming the establishment of the merchant initiated payment relationship .

As will be discussed in greater detail below the customer may be presented with the option to add delete or customize funding sources for the merchant initiated payment relationship. For example the customer may be given the option to add a new account e.g. bank account or credit card account to the customer s virtual wallet. In addition the customer may be presented with the option to customize the terms of the payment relationship.

For one embodiment of the present invention the merchant may process a test transaction against a customer s account e.g. the customer s online wallet during the establishment of the merchant initiated payment relationship or alternatively at later time for example when the customer requests a payment. For example for one embodiment of the invention the merchant server may communicate a test amount variable to the payment service provider server along with a request to establish a merchant initiated payment relationship. The payment service provider server receives the test amount variable and processes a verification payment using the payment service model. As a verification payment the payment is processed for test purposes only and not actually charged to the customer s account.

For one embodiment of the invention the payment service provider server communicates a response to the merchant server indicating whether or not the test amount was successfully processed. For example the response may be binary in nature indicating a simple yes or no. For one embodiment of the invention if the test amount failed for some reason an explanation for the failure is communicated to the merchant server along with the response. For example if the test fails because the customer s account has been restricted or if the test amount exceeds the customer s available funds or for any other reason an explanation indicating the reason for the failure may be included in the response to the merchant server .

One advantage of the account verification procedure is that it allows a merchant to receive a simple binary response for example success or failure. This reduces the complexity of the logic required by other more complicated fraud scoring models. Additionally in contrast to sonic credit card account verification procedures a successful verification of the test amount is not synonymous with a guarantee of payment. The verification procedure is time sensitive in the sense that success or failure depends on the status of the customer s account at the time the test is run.

After a customer has established a merchant initiated payment relationship with a particular merchant the customer can transact with the merchant with the simple click of a button or link. For example once a customer has selected one or more goods and or services to purchase from a merchant s online store the customer may select a link to pay via the payment service provider using the established merchant initiated payment relationship.

When the customer selects the link to use the merchant initiated payment method the merchant server makes an API call to the payment service provider server requesting a payment . For one embodiment of the invention the request may include a number of data items related to the transaction. For example for one embodiment of the invention the data items may include but not be limited to 

For one embodiment of the invention the merchant server may encrypt the data items related to the transaction before communicating the data items to the payment service provider s server . Additionally for security reasons the merchant server may digitally sign the message associated with the API call so that the payment service provider s server can verify the authenticity of the message when it is received.

In response to the payment request the payment service provider server validates and processes the request. For one embodiment of the invention the payment service provider server performs several validation routines when it receives a payment request. For example the payment service provider server may validate the variables passed in by the merchant server to ensure that all the required data has been received and is in the proper format. In addition the payment service provider server may ensure that the payment request is within the scope of the merchant initiated payment relationship. For example the payment service provider server may ensure that the amount billed does not exceed a maximum amount that the customer has authorized for merchant initiated payments under a merchant initiated payment relationship with that particular merchant.

After validating the request the payment service provider server processes the request. For one embodiment of the invention the payment service provider server performs several routines when processing the request. For example the payment service provider server may analyze or calculate a shipping profile and or tax profile for the transaction. Additionally the payment service provider server may perform a funding source analysis to select the proper funding source for the transaction. For example the customer may have selected a preferred funding source for the particular merchant initiated payment relationship. If so the payment service provider server may attempt to process the transaction using the preferred funding source before falling back to a default funding source.

For one embodiment of the invention the payment service provider server always attempts to process the transaction with funds held in an account with the payment service provider e.g. an internally held account and only uses a customer selected preferred or secondary account e.g. an externally linked account such as a bank or credit card account if there are insufficient funds in the internally held account. For one embodiment of the invention the payment service provider server will continue attempting to process the payment if the transaction is unsuccessful using one or more accounts. For example the payment service provider server will proceed to use accounts in a default order or an order specified by the customer to attempt processing the transaction until it has been unsuccessful with every account in the customer s virtual wallet. At that time the payment service provider server will communicate a failure message to the merchant server via an API call. The API call may specify the reason for the failure.

In an alternative embodiment the payment service provider server will report a failure to the merchant server after a first attempt to process the transaction has failed. The message to the merchant server may indicate a reason for the failure and the merchant server may request a second attempt using a different account or combination of accounts in the virtual wallet.

In any case the response communicated to the merchant server is synchronous in nature. In addition to a synchronous response the payment service provider server may communicate an asynchronous response. For example an instant payment notification IPN may be communicated to the merchant server at a later time if for example the synchronous response was not communicated due to a network problem or if there was a delay in processing the payment using a particular account.

Another advantage of the API is the ease with which it can be implemented by a third party. For example for one embodiment of the invention a third party may implement the API to provide payment processing on behalf of the merchant. The API allows the third party to seamlessly integrate payment processing for the merchant with limited work and adaptation from the merchant.

One of the advantages of the present invention is that the customer is provided with significant flexibility in customizing funding sources for payments on a per merchant basis. For example for each merchant initiated payment relationship the customer enters into the customer has the ability to customize the funding source to be used for paying that particular merchant. This flexibility allows the customer to 1 select different funding sources for different merchants 2 select preferred funding sources for particular merchants and or 3 disable funding sources for particular merchants.

For one embodiment of the invention the customer may be presented with a funding source customization web page such as the example web page illustrated in . The funding source customization web page may be presented to the customer at the time the merchant initiated payment relationship is established as illustrated by the web based action with reference number in . Alternatively the funding source customization web page may be accessed via the payment service provider s home website at a later time as part of a profile setting for the customer.

The funding source customization web page allows the customer to select a preferred funding source e.g. bank credit card or other account from which payments should be processed for transactions with the merchant that are associated with the merchant initiated payment relationship. In addition the customer may disable certain funding sources for a particular merchant initiated payment relationship. For one embodiment of the invention the customer is given the option of ranking or ordering all the accounts in the customer s virtual wallet. Furthermore for one embodiment the payment service provider server may select a certain account as the default account and always attempt to use this default account first.

One advantage of the present invention is the control that the customer is provided in relation to customizing the payment relationship. For example not only can the customer control the funding sources on a per merchant basis as described above but the customer is also given the ability to set maximum payment amounts on a per merchant basis. For example the customer may set a maximum payment amount that a particular merchant can charge under a merchant initiated payment relationship.

For one embodiment of the invention the customer may be presented with a payment relationship customization web page such as the example web page illustrated in . The payment relationship customization web page may be presented to the customer at the time the merchant initiated payment relationship is established as illustrated by the web based action with reference number in . Alternatively the payment relationship customization web page may be accessed via the payment service provider s home website at a later time as part of a profile setting for the customer.

For one embodiment of the present invention the customer is able to set maximum payment amounts on a monthly basis per merchant initiated relationship as illustrated in . For example for one embodiment of the invention the customer is able to set a maximum dollar amount that the payment service provider is authorized to pay a particular merchant in a given month on behalf of the customer. Alternatively the maximum amount could be for a given time period other than a month for example a maximum per week quarter or year. In addition for one embodiment of the invention the customer is able to set a maximum payment amount for a single transaction and or a maximum number of transactions for a given time period. For example for a specific merchant initiated payment relationship the customer might select to set the maximum number of transactions in a given month to five the maximum payment amount for any single transaction to 50 and the maximum payment amount for a single month to 200. Consequently the customer is given great flexibility

For one embodiment of the invention each merchant determines whether the customer should have control over setting any maximum amounts. For example as illustrated in merchant does not allow a maximum amount to be controlled by the customer.

Another advantage of the present invention is the merchant notifications that are communicated asynchronously from the payment service provider s server to each merchant server . For example as illustrated in the payment service provider server may on occasion communicate messages to a merchant server with updates on the status of a particular merchant initiated payment relationship. Additionally the merchant server may request verification of a particular notification message that the merchant server receives. For example if a customer closes his account with the payment service provider the payment service provider server may notify the merchant server . Consequently the merchant server will be able to discontinue presenting the payment service provider as a payment option at the merchant s checkout web page for the customer. In addition notifications may be sent to the merchant server if for example a linked account e.g. a credit card account in the customer s virtual wallet expires or is otherwise cancelled.

Using one of a variety of standardized protocols the API communications module receives API messages from a merchant server. The API messages may include any number of pre defined data items such as those in the charts shown above with respect to the description of . For one embodiment of the invention after receiving an API message the API communications module authenticates decrypts and verifies the message.

For example for one embodiment of the invention the API communications module includes an authentication and encryption module that may authenticate and decrypt the message. For example the authentication and encryption module may check a digital signature included with the message to determine whether the message is from a trusted source such as a merchant server with a proper digital signature key. Next the authentication and encryption module may decrypt the message if the merchant server that sent the message originally encrypted it.

Next a data verification module may verify the data items included in the message. For example if the message is a request to establish a merchant initiated payment relationship then the data verification module may verify that the request includes all of the data items required for such a request. Furthermore the data verification module may verify that the data items received with the request are of the proper type and format. For example the data verification module may check a data item to determine whether it is a number or character and whether it has the proper length. If a data field is invalid for any reason the API communications module may reject the message and or send a reply message notifying the sender of the original message that one or more data items were invalid.

For one embodiment of the present invention the merchant initiated payment relationship management module manages the formation and administration of merchant initiated payment relationships and accounts to which each relationship is linked. For example the management module processes requests to establish new merchant initiated payment relationships and links each established relationship to the account of a payment service provider account holder. For example as illustrated in an account holder may establish several merchant initiated payment relationships with a wide variety of merchants. The management module establishes each merchant initiated payment relationship and links the data associated with each relationship to the account data associated with the user s account held in an accounts database .

In addition for one embodiment of the invention the management module includes a funding source customization module and a payment customization module . The funding source customization module allows a user to customize a funding source for a particular merchant initiated payment relationship. For example for one embodiment of the invention the funding source customization module facilitates the adding and deleting of funding sources for a user account or merchant initiated payment relationship. Furthermore the funding source customization module may facilitate the presentation of funding sources to a user and the reception of funding source selections from the user including a preferred funding source e.g. a particular bank account or credit card account selected by a user. Consequently when a payment request is received under a particular merchant initiated payment relationship and processed the payment processing module will attempt to use funding sources in the order specified by the user.

For one embodiment of the invention the management module also includes a payment customization module . The payment customization module facilitates the customization of terms of the merchant initiated payment relationships. For example the payment customization module provides the logic to present users with the option of setting maximum payment amounts. For one embodiment of the invention the payment customization module customizes the payment relationship on a per merchant basis by providing the user with the ability to set a maximum payment amount per transaction or a maximum payment amount for a predetermined period of time e.g. maximum total payments per a given month . Additionally the payment customization module may provide the user with the ability to limit the total number of payment requests that are processed for a particular merchant in a given time period. For example the user may be able to limit a merchant to making one payment request per month.

Prior to processing a payment in connection with a payment request the payment processing module may perform a verification process to verify that the user has properly authorized a payment in connection with the particular terms of a payment request. For example the authorization verification module of the payment processing module may verify that the payment processor has been property authorized by the user to make a payment in connection with the payment request. In addition to checking or verifying payment limits set by the user using the payment customization module the authorization verification module may verify that the particular product or service associated with the payment request received from the merchant is a product or service that has been authorized for merchant initiated payments under the merchant initiated payment relationship.

The exemplary computer system includes a processor e.g. a central processing unit CPU a graphics processing unit GPU or both a main memory and a static memory which communicate with each other via a bus . The computer system may further include a video display unit e.g. a liquid crystal display LCD or a cathode ray tube CRT . The computer system also includes an alphanumeric input device e.g. a keyboard a cursor control device e.g. a mouse a disk drive unit a signal generation device e.g. a speaker and a network interface device .

The disk drive unit includes a machine readable medium on which is stored one or more sets of instructions e.g. software embodying any one or more of the methodologies or functions described herein. The software may also reside completely or at least partially within the main memory and or within the processor during execution thereof by the computer system the main memory and the processor also constituting machine readable media. The software may further be transmitted or received over a network via the network interface device .

While the machine readable medium is shown in an exemplary embodiment to be a single medium the term machine readable medium should be taken to include a single medium or multiple media e.g. a centralized or distributed database and or associated caches and servers that store the one or more sets of instructions. The term machine readable medium shall also be taken to include any medium that is capable of storing encoding or carrying a set of instructions for execution by the machine and that cause the machine to perform any one or more of the methodologies of the present invention. The term machine readable medium shall accordingly be taken to include but not be limited to solid state memories optical and magnetic media and carrier wave signals.

Thus the present invention provides a method and system for facilitating merchant initiated online payments. Accordingly a merchant is provided with the means to pull funds from a customer s account with a payment service provider on an as needed basis as opposed to a regular schedule as with a subscription type service. Before the merchant is allowed to pull funds from the customer s account the customer will first indicate that the customer would like to establish the merchant initiated payment relationship with the merchant via a series of web pages hosted by the payment service provider. The ability to customize the payment relationship agreement on a per merchant basis provides the customer with a certain level of security and protection. For example the customer is allowed to set preferred funding sources and set maximum payment amounts e.g. maximum dollars per month or per transaction on a per merchant basis. This customization is advantageous to the customer because it protects the customer from potential funds overdrafts and credit limit overruns. Additionally the customization feature is beneficial to the merchants because it limits the likelihood of disputes and chargebacks.

Thus a method and system are provided with reference to specific exemplary embodiments. It will be evident that various modifications and changes may be made to theses embodiments without departing from the broader spirit and scope of the invention. Accordingly the specification and drawings are to be regarded in an illustrative rather than a restrictive sense.

