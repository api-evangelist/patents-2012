---

title: Methods and systems for tracking of user interactions with content in social networks
abstract: Techniques to track interactions with content on a social network. In one embodiment, references are embedded within content to be presented to a user. At least one identifying reference from among the references is received in response to an interaction by the user with the content. The identifying reference is stored in a memory caching system as a record of the interaction. The references may comprise a key and a type. The key may be associated with the content and the type may be associated with components in the content. The interaction may involve selection by the user of a component within a story.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09508102&OS=09508102&RS=09508102
owner: FACEBOOK, INC.
number: 09508102
owner_city: Menlo Park
owner_country: US
publication_date: 20120725
---
The present invention relates to the field of social networking. More particularly the present invention provides a process for tracking interactions with content items.

Internet social networks have become a compelling social phenomenon. Internet social networks allow users to for example maintain profiles grant other users access to their profiles interact with each other s profiles post media on their profiles and perform other actions. Users may create content or interact with content posted on the profiles of their friends within the network. In a social network an Internet user typically builds a group of friends or followers who receive updates of the user s activity. Each instance of user activity generates a story that is visible to other users on their homepages most notably the user s friends. For example the action of a user posting a link to an article on his profile may generate a story. Other users in turn may comment on the link click the link or select an option indicating that they like the link. The stories generated by a user s creation of content and his interactions with the profiles of other users summarize the user s activity on the social network.

As the volume of users of a social network grows the number of user interactions and content items created by users increases exponentially. Social networks employ increasingly sophisticated techniques for classifying user actions and content items such that patterns in user activity may be identified. Determining these patterns enables operators of social networks to not only monetize the social networking platform through the placement of targeted advertising but to optimize and enhance the user experience. For example many users have a high number of friends whose activity generates upwards of hundreds of stories a day. Rather than simply displaying all of these stories in chronological order on a user s homepage the social network may wish to selectively display only those stories with which the user is likely to interact.

As the variety of content that social networks allow their users to post and the manner in which that content is displayed evolve the mechanisms for tracking user interactions must also evolve. For example a story may contain a link to an article a profile picture with an embedded link to the user s profile and a text link to the user s profile. If one of the user s friends clicks a link to the user s profile the social network may wish to know whether the friend clicked the profile picture or the text link. Similarly if the friend clicks on the link to the article the social network may wish to know whether it was clicked from within the user s profile or from the news feed within the friend s homepage. If the links within the story contain no information other than the uniform resource locator URL of the user s profile or the article the social network may not know exactly which link the friend has clicked.

To track user interactions with content within a social network a social networking system embeds references within content for presentation to a user. At least one identifying reference from among the references is received by the social networking system in response to an interaction with the content by the user. The identifying reference is stored in a memory caching system as a record of the interaction.

In an embodiment of the invention the references may include a key associated with the content and a type associated with components in the content. The content may comprise a story describing a user activity. The key may identify the story with which the user interacted and the type may identify the component of the story with which the user interacted. The references may be organized in a hierarchical structure. The interaction may be recorded in an interaction log.

In an embodiment of the invention the content may be designed by the social networking system to include hypertext markup language elements. The content may be represented as a document object model. The references in the content may be provided to a client device and the identifying reference may be written to a cookie on the client device.

In an embodiment of the invention the content may be provided by the social networking system as an advertisement. An encrypted impression may be embedded within the content. The encrypted impression may include advertising data and may be received by the social networking system with the identifying reference.

Many other features and embodiments of the invention will be apparent from the accompanying drawings and from the following detailed description.

The figures depict various embodiments of the present invention for purposes of illustration only wherein the figures use like reference numerals to identify like elements. One skilled in the art will readily recognize from the following discussion that alternative embodiments of the structures and methods illustrated herein may be employed without departing from the principles of the invention described herein.

The user device comprises one or more computing devices that can receive input from a user and can transmit and receive data via the network . In one embodiment the user device is a conventional computer system executing for example a Microsoft Windows compatible operating system OS Apple OS X and or a Linux distribution. In another embodiment the user device can be a device having computer functionality such as a smart phone a tablet a personal digital assistant PDA a mobile telephone etc. The user device is configured to communicate via the network . The user device can execute an application for example a browser application that allows a user of the user device to interact with the social networking system . In another embodiment the user device interacts with the social networking system through an application programming interface API that runs on the native operating system of the user device such as iOS and ANDROID. The user device is configured to communicate with the external system and the social networking system via the network which may comprise any combination of local area and or wide area networks using wired and or wireless communication systems.

In one embodiment the network uses standard communications technologies and or protocols. Thus the network can include links using technologies such as Ethernet 802.11 worldwide interoperability for microwave access WiMAX 3G 4G CDMA GSM LTE digital subscriber line DSL etc. Similarly the networking protocols used on the network can include multiprotocol label switching MPLS transmission control protocol Internet protocol TCP IP User Datagram Protocol UDP hypertext transport protocol HTTP simple mail transfer protocol SMTP and file transfer protocol FTP . The data exchanged over the network can be represented using technologies and or formats including hypertext markup language HTML and extensible markup language XML . In addition all or some links can be encrypted using conventional encryption technologies such as secure sockets layer SSL transport layer security TLS and Internet Protocol security IPsec .

In one embodiment the user device may display content from the external system and or from the social networking system by processing a markup language document received from the external system and from the social networking system using a browser application . The markup language document identifies content and one or more instructions describing formatting or presentation of the content. By executing the instructions included in the markup language document the browser application displays the identified content using the format or presentation described by the markup language document . For example the markup language document includes instructions for generating and displaying a web page having multiple frames that include text and or image data retrieved from the external system and the social networking system . In various embodiments the markup language document comprises a data file including extensible markup language XML data extensible hypertext markup language XHTML data or other markup language data. Additionally a markup language document may include JavaScript Object Notation JSON data JSON with padding JSONP and JavaScript data to facilitate data interchange between the external system and the user device . The browser application on the user device may use a JavaScript compiler to decode such a markup language document .

In one embodiment the user device also includes one or more cookies including data indicating whether a user of the user device is logged into the social networking system which may enable customization of the data communicated from the social networking system to the user device .

The external system includes one or more web servers including one or more web pages which are communicated to the user device using the network . The external system is separate from the social networking system . For example the external system is associated with a first domain while the social networking system is associated with a separate social networking domain. Web pages included in the external system comprise markup language documents identifying content and including instructions specifying formatting or presentation of the identified content.

The social networking system comprises one or more computing devices storing a social network or a social graph including a plurality of users and providing users of the social network with the ability to communicate and interact with other users of the social network. Users may join the social networking system and then add connections to any number of other users of the social networking system to whom they desire to be connected. As used herein the term friend refers to any other user of the social networking system to whom a user has formed a connection association or relationship via the social networking system .

Connections may be added explicitly by a user or may be automatically created by the social networking systems based on common characteristics of the users e.g. users who are alumni of the same educational institution . For example a first user specifically selects a particular other user to be a friend. Connections in the social networking system are usually in both directions but need not be so the terms user and friend depend on the frame of reference. Connections between users of the social networking system are usually bilateral two way or mutual but connections may also be unilateral or one way. For example if Bob and Joe are both users of the social networking system and connected to each other Bob and Joe are each other s connections. If on the other hand Bob wishes to connect to Joe to view data communicated to the social networking system by Joe but Joe does not wish to form a mutual connection a unilateral connection may be established. The connection between users may be a direct connection however some embodiments of a social networking system allow the connection to be indirect via one or more levels of connections or degrees of separation.

In addition to establishing and maintaining connections between users and allowing interactions between users the social networking system provides users with the ability to take actions on various types of items supported by the social networking system . These items may include groups or networks where networks here refer not to physical communication networks but rather social networks of people entities and concepts to which users of the social networking system may belong events or calendar entries in which a user might be interested computer based applications that a user may use via the social networking system transactions that allow users to buy or sell items via the service and interactions with advertisements that a user may perform on or off the social networking system . These are just a few examples of the items upon which a user may act on a social networking system and many others are possible. A user may interact with anything that is capable of being represented in the social networking system or in the external system separate from the social networking system coupled to the social networking system via the network .

The social networking system is also capable of linking a variety of entities. For example the social networking system enables users to interact with each other as well as external systems or other entities through an API or other communication channels. The social networking system generates and maintains the social graph comprising a plurality of nodes interconnected by a plurality of edges. Each node in the social graph may represent an entity that can act on another node and or that can be acted on by another node. The social graph may include various types of nodes. Examples of types of nodes include users non person entities content items web pages groups activities messages concepts and any other things that can be represented by an object in the social networking system . An edge between two nodes in the social graph represents a particular kind of connection or association between the two nodes which may result from node relationships or from an action that was performed by one of the nodes on the other node. For example when a first user identifies a second user as a friend an edge in the social graph is generated connecting a node representing the first user and a second node representing the second user. As various nodes relate or interact with each other the social networking system modifies edges connecting the various nodes to reflect the relationships and interactions.

The social networking system also includes user generated content which enhances a user s interactions with the social networking system . User generated content may include anything a user can add upload send or post to the social networking system . For example a user communicates posts to the social networking system from a user device . Posts may include data such as status updates or other textual data location information images such as photos videos links music or other similar data and or media. Content may also be added to the social networking system by a third party. Content items are represented as objects in the social networking system . Each instance of a user posting or creating a content item generates a story which is visible to the user s friends or followers within their respective news feeds. In this way users of the social networking system are encouraged to communicate with each other by posting text and content items of various types of media through various communication channels. Such communication increases the interaction of users with each other and increases the frequency with which users interact with the social networking system .

The social networking system includes a web server an API request server a user profile store a connection store an action logger an activity log an authorization server a memory caching system or other suitable memory device an advertisement module and a cookie management module . In an embodiment of the invention the social networking system may include additional fewer or different components for various applications. Other components such as network interfaces security mechanisms load balancers failover servers management and network operations consoles and the like are not shown so as to not obscure the details of the system.

The user profile store maintains user profiles including biographic demographic and other types of descriptive information such as work experience educational history hobbies or preferences location and the like that has been declared by users or inferred by the social networking system . This information is stored in the user profile store such that each user is uniquely identified. The social networking system also stores data describing one or more connections between different users in the connection store . The connection information may indicate users who have similar or common work experience group memberships hobbies or educational history. Additionally the social networking system includes user defined connections between different users allowing users to specify their relationships with other users. For example user defined connections allow users to generate relationships with other users that parallel the users real life relationships such as friends co workers partners and so forth. Users may select from predefined types of connections or define their own connection types as needed. Connections with other nodes in the social networking system such as non person entities buckets cluster centers images interests pages external systems concepts and the like are also stored in the connection store .

The social networking system maintains data about objects with which a user may interact. To maintain this data the user profile store and the connection store store instances of the corresponding type of objects maintained by the social networking system . Each object type has information fields that are suitable for storing information appropriate to the type of object. For example the user profile store contains data structures with fields suitable for describing a user s profile. When a new object of a particular type is created the social networking system initializes a new data structure of the corresponding type assigns a unique object identifier to it and begins to add data to the object as needed. This might occur for example when a user becomes a user of the social networking system and the social networking system generates a new instance of a user profile in the user profile store assigns a unique identifier to the user profile and begins to populate the fields of the user profile with information provided by the user.

The connection store includes data structures suitable for describing a user s connections to other users connections to external systems or connections to other entities. The connection store may also associate a connection type with a user s connections which may be used in conjunction with the user s privacy setting to regulate access to information about the user. In an embodiment of the invention the user profile store and the connection store may be implemented as a federated database.

Data stored in the connection store the user profile store and the activity log enables the social networking system to generate the social graph that uses nodes to identify various objects and edges connecting nodes to identify relationships between different objects. For example if a first user establishes a connection with a second user in the social networking system user profiles of the first user and the second user from the user profile store may act as nodes in the social graph. The connection between the first user and the second user stored by the connection store is an edge between the nodes associated with the first user and the second user. Continuing this example the second user may then send the first user a message within the social networking system . The action of sending the message which may be stored is another edge between the two nodes in the social graph representing the first user and the second user. Additionally the message itself may be identified and included in the social graph as another node connected to the nodes representing the first user and the second user.

In another example a first user may tag a second user in an image that is maintained by the social networking system or alternatively in an image maintained by another system outside of the social networking system . The image may itself be represented as a node in the social networking system . This tagging action may create edges between the first user and the second user as well as create an edge between each of the users and the image which is also a node in the social graph. In yet another example if a user confirms attending an event the user and the event are nodes obtained from the user profile store where the attendance of the event is an edge between the nodes that may be retrieved from the activity log . By generating and maintaining the social graph the social networking system includes data describing many different types of objects and the interactions and connections among those objects providing a rich source of socially relevant information.

The web server links the social networking system to one or more user devices and or one or more external systems via the network . The web server serves web pages as well as other web related content such as Java JavaScript Flash XML and so forth. The web server may include a mail server or other messaging functionality for receiving and routing messages between the social networking system and one or more user devices . The messages can be instant messages queued messages e.g. email text and SMS messages or any other suitable messaging format.

The API request server allows one or more external systems and user devices to access information from the social networking system by calling one or more APIs. The API request server may also allow external systems to send information to the social networking system by calling APIs. The external system in one embodiment sends an API request to the social networking system via the network and the API request server receives the API request. The API request server processes the request by calling an API associated with the API request to generate an appropriate response which the API request server communicates to the external system via the network . For example responsive to an API request the API request server collects data associated with a user such as the user s connections that have logged into the external system and communicates the collected data to the external system . In another embodiment the user device communicates with the social networking system via APIs in the same manner as external systems .

The action logger is capable of receiving communications from the web server about user actions on and or off the social networking system . The action logger populates the activity log with information about user actions enabling the social networking system to discover various actions taken by its users within the social networking system and outside of the social networking system . Any action that a particular user takes with respect to another node on the social networking system is associated with each user s profile through information maintained in the activity log or in a similar database or other data repository. Examples of actions taken by a user within the social networking system that are identified and stored may include for example adding a connection to another user sending a message to another user reading a message from another user viewing content associated with another user attending an event posted by another user posting an image attempting to post an image or other actions interacting with another user or another object. When a user takes an action within the social networking system the action is recorded in the activity log . In one embodiment the social networking system maintains the activity log as a database of entries. When an action is taken within the social networking system an entry for the action is added to the activity log . The activity log may be referred to as an action log.

Additionally user actions may be associated with concepts and actions that occur within an entity outside of the social networking system such as an external system that is separate from the social networking system . For example the action logger may receive data describing a user s interaction with an external system from the web server . In this example the external system reports a user s interaction according to structured actions and objects in the social graph.

Other examples of actions where a user interacts with an external system include a user expressing an interest in an external system or another entity a user posting a comment to the social networking system that discusses an external system or a web page within the external system a user posting to the social networking system a Uniform Resource Locator URL or other identifier associated with an external system a user attending an event associated with an external system or any other action by a user that is related to an external system . Thus the activity log may include actions describing interactions between a user of the social networking system and an external system that is separate from the social networking system .

The authorization server enforces one or more privacy settings of the users of the social networking system . A privacy setting of a user determines how particular information associated with a user can be shared. The privacy setting comprises the specification of particular information associated with a user and the specification of the entity or entities with whom the information can be shared. Examples of entities with which information can be shared may include other users applications external systems or any entity that can potentially access the information. The information that can be shared by a user comprises user profile information like profile photo phone numbers associated with the user user s connections actions taken by the user such as adding a connection changing user profile information and the like.

The privacy setting specification may be provided at different levels of granularity. For example the privacy setting may identify specific information to be shared with other users. For example the privacy setting identifies a work phone number or a specific set of related information such as personal information including profile photo home phone number and status. Alternatively the privacy setting may apply to all the information associated with the user. The specification of the set of entities that can access particular information can also be specified at various levels of granularity. Various sets of entities with which information can be shared may include for example all friends of the user all friends of friends all applications or all external systems . One embodiment allows the specification of the set of entities to comprise an enumeration of entities. For example the user may provide a list of external systems that are allowed to access certain information. Another embodiment allows the specification to comprise a set of entities along with exceptions that are not allowed to access the information. For example a user may allow all external systems to access the user s work information but specify a list of external systems that are not allowed to access the work information. Certain embodiments call the list of exceptions that are not allowed to access certain information a block list . External systems belonging to a block list specified by a user are blocked from accessing the information specified in the privacy setting. Various combinations of granularity of specification of information and granularity of specification of entities with which information is shared are possible. For example all personal information may be shared with friends whereas all work information may be shared with friends of friends.

The authorization server contains logic to determine if certain information associated with a user can be accessed by a user s friends external systems and or other applications and entities. The external system may need authorization from the authorization server to access the user s more private and sensitive information such as the user s work phone number. Based on the user s privacy settings the authorization server determines if another user the external system an application or another entity is allowed to access information associated with the user including information about actions taken by the user.

As described above each user activity within the social network may generate a story a discrete representation of the activity that may appear on a user s profile and in other users feeds or news feeds. The operator of the social networking system may wish to keep track of story impressions and user interactions with each story in order to implement optimizations and enhancements. By identifying which stories were displayed to a user and which stories the user interacted with the social network may customize the user s news feed to include only those stories with which the user is likely to interact. In addition determining exactly which element of a story a user interacted with may allow the social network to further optimize the user experience both for specific users and for the user base at large.

According to an embodiment of the invention the social networking system may implement a server side scripting language such as PHP to produce dynamic web pages. Stories may be generated in a markup language using PHP or other suitable scripting language. In an embodiment of the invention data pertaining to a story may be recorded in a variety of logs. For example a data log may record the story type and classification information e.g. article link photo upload status update etc . As another example an impression log may record the various users who see the story. As yet another example an interaction log may record the various user interactions with the story and the manner in which the interactions occurred. The logs may be implemented as arrays matrices or any data structure. Any number of logs and processes for modeling the logs may be used.

According to an embodiment of the invention the social networking system may receive an indication about an activity from a first user of a social network. The activity may be an article posting a status update a like a comment a share a photo upload a new friendship or any other interaction activity or event that may occur or be known to the social networking system . A story for the activity is then created. The story may include links to the first user s profile a link to the content items being posted a link to the pictures being uploaded or any other items that can be interacted with by another user who views the story. The story may include any type of data pertaining to the activity. A second user of the social network may log into his account on the social networking system . The second user may be a friend of the first user or any user who has access to the first user s profile. The social networking system may then receive an indication that the second user has accessed a resource including at least one story related to the first user. According to one embodiment of the invention the resource may be the second user s news feed which may be presented to the second user upon logging in to the social networking system or accessing a home screen. The news feed may comprise stories summarizing the activity of the first user and others who are friends of the second user. Other implementations of the news feed are possible. According to an embodiment of the invention the resource may be the first user s profile which may list the stories generated by the first user s activity within the social network. Any resource may be used. Upon request the resource including the story may then be transmitted to the second user and displayed within the resource. The appearance of the story to the second user may be recorded as an impression in an impression log. In an embodiment of the invention this process may be performed entirely or partially by the social networking system .

While the process described above tracks story impressions an operator of the social networking system may wish to track user interactions with stories and other content in order to optimize the user experience monetize the user s activity or otherwise achieve a goal of the social networking system . For example the stories may be categorized by the social networking system according to various criteria. The operator of the social networking system may wish to determine which types of stories the user typically interacts with and which types of stories the user typically ignores in order to selectively display within the user s news feed only those stories with which the user is likely to interact. Moreover the operator of the social networking system may wish to discern which element of the story the user has interacted with and the context within which the interaction occurred. For example if the user accessed a friend s profile from a story the operator of the social networking system may wish to determine whether the user clicked the friend s name or clicked the friend s profile picture both of which may be included in the story as links to the friend s profile. Data pertaining to which types of stories users interact with the most and how the users interact with them may be gathered and used for various optimizations enhancements and user specific customizations. For example the social networking system may use the data to train machine learning models that predict various user preferences. As another example the data may be used for performance counters that enable the social networking system to track advanced metrics pertaining to user activity and the popularity of different types of content. The operator of the social networking system may also wish to determine what type of story should be generated about a particular event. For example a user may often interact with stories about comments on his friend s photos but may ignore earlier stories about the friend having uploaded the photos. The operator of the social networking system may use this information to decide that stories about comments on friends photos should be displayed within the user s news feed in preference to stories about the friends having uploaded the photos. Although the underlying activity that forms the basis for a story may be the same e.g. a user s friend uploading new photos the type and appearance of a story that is generated for the activity may vary based on the types of stories with which the user typically interacts.

Thus according to one embodiment of the invention the stories may be designed and implemented such that the content of each story is divided into parts. Each part may be represented as a discrete item such as an HTML element. Multiple elements may link to the same resource but may be distinguished so that the social networking system may determine how the user accessed that resource. illustrates an example implementation of a story in accordance with an embodiment of the invention. The story is associated with an article posted by user Jane Doe. The story includes components that link to Jane Doe s profile the article and options to like or comment on the link. The component which corresponds to Jane s profile picture and the component which corresponds to Jane s name link to Jane s profile. The component which corresponds to the word link the component which corresponds to a thumbnail accompanying the article the component which corresponds to the title of the article the component which corresponds to a brief synopsis of the article and the component which corresponds to the URL of the article link to the article. The component which corresponds to the timestamp of the story and the component which corresponds to a comment box link to commenting functionality. The component which corresponds to the word like and the component which corresponds to a thumbs up icon link to like functionality. The component which corresponds to the X links to functionality for hiding the story. Other components not shown in may also be included in a story.

According to one embodiment of the invention each story may be uniquely identified using a reference such as a key. The various components comprising the story may be embedded within each other and identified using other references such as a type. Thus each component within a story may be uniquely identified using a combination of that story s key and the element s type. This structure may be implemented using a document object model DOM hierarchy. DOM is a convention for representing and interacting with elements in documents particularly those written using a markup language for display within a web browser. According to one embodiment the components may be modeled as elements within a DOM formatted using a markup language such as the hypertext markup language HTML . Any format for the DOM may be used.

In the example illustrated in a key may be embedded within the start tag of the element . A multitude of types that describe each component of the story may be embedded within a corresponding element s start tag. Both the key and the type may be assigned to an attribute. In an embodiment the attribute may be referred to as data ft . Each story may be uniquely identified by its key whereas each component element may be uniquely identified by its type and the key or type of any other elements within which it may be embedded. For example the element is uniquely identified by key which is embedded within start tag of the element . The value of the key is set to AAA . The element is uniquely identified by the key of the element and type embedded within start tag of the element . The value of the type is set to 3. The element is uniquely identified by the key of the element the type of the element and type embedded within start tag of the element .

Links to the respective resources that each element represents e.g. user profile article link comment functionality like functionality may also be embedded within the elements. These links along with other content and data that may be embedded within an element are not shown but suggested by the ellipses shown below each element s start tag in the DOM which are included to simplify depiction. In this example the story and its constituent parts are modeled as custom user defined markup language elements. However generic HTML elements such as the element may also be used. For example the like functionality may be represented as the HTML element wherein the attributes identify the story to which the like option corresponds. Any other suitable technique for modeling the elements of a story may be used.

Each element corresponding to a component in a story may be uniquely identified by a key and at least one type. According to an embodiment of the invention the key and type may be the only data items transmitted to the social networking system upon the occurrence of a user interaction. Using the key and the type the social networking system can look up which element within the story with which the user has interacted.

In this manner conventional implementations in which multiple variables corresponding to various classifications of an element are transmitted to the user s client device when the story is generated can be avoided. In such conventional implementations the data is then transmitted back to a server when an interaction occurs in order to convey all of the information about precisely which element within a story the user interacted with. Due to the sheer volume of requests handled by a social network with hundreds of millions of active users the transmission of such large amounts of data in conventional implementations is undesirable.

In an embodiment of the invention when a story is created the data describing that story may be recorded in a data log and the transmission of the story to a user may be recorded in an impression log. The impression log along with the various other logs that accompany a story may be stored in the memory caching system . According to one embodiment of the invention the memory caching system is kept as a separate storage component from the databases where stories and user profile data is stored for archival and later retrieval. Because database queries are time and resource intensive operations it would be desirable for a social network with hundreds of millions of active users to minimize the number of database queries performed. According to an embodiment the logs may be maintained in the memory caching system for a fixed discrete length of time after the story is created and transmitted. According to an embodiment the logs may be stored elsewhere. Thus the identifying data that the social networking system transmits with a story may be the story s key and the type information of each element within the story and this information is used to identify the appropriate logs within the memory caching system corresponding to the relevant story. The amount of data transmitted during a request and the number of database queries required to retrieve this data are thereby minimized.

In addition the hierarchical model and the memory caching system may limit the amount of data describing the internal implementation of the social networking system that is exposed to the public. Without the hierarchical model and the memory caching system more explicit tracking data would have to be included in the page source and transmitted back to the social networking system in order to specify the particular element within a story with which a user had interacted. Because a web page is a text document formatted in a markup language the page source of a web page is readily available to a user. If the page source includes explicit tracking data that specifies classes variables or other information revealing the internal details of the social networking system malicious users may attempt to write scripts that exploit this information to for example spam impersonate or otherwise hack the accounts of other users. Thus it is desirable to limit the amount of data pertaining to the internal implementation of the social networking system that is exposed to the user.

According to an embodiment of the invention processes discussed in relation to may be used and adapted based on how the user has accessed the social networking system to interact with web content such as stories. For example the social networking system may provide portals and applications that enable access to the social networking system from a variety of devices including desktop PCs tablets and smartphones. However because each type of device may have different tools and technical capabilities the implementation details may vary according to device. For example on desktop computers the processes may be implemented with JavaScript a scripting language that can be accommodated by most major desktop web browsers. However JavaScript capability may be less common on mobile devices and the processes may therefore be implemented on mobile devices in a manner that obviates the need for JavaScript. Similarly certain devices may have additional technical features that allow for further adaptations. Any suitable implementation of the procedure may be used.

Web browsing technologies may involve the ability of a server to store data on the client computer in the form of a cookie. A cookie is a data file saved by a web server on a client computer that uniquely identifies the client user to the web server. In most instances each cookie may be associated with one website and may be read or written by the web server that created it. Upon a user s first visit to a website the web server may create a cookie on the hard drive of the client computer. The web server may save information pertaining to the user s activity on the website to the cookie periodically throughout the user s browsing session. The web server can automatically identify the user each time the user returns to the website during subsequent browsing sessions.

According to an embodiment of the invention on devices that support cookie functionality the number of requests and the amount of data transmitted from a user s client device to the social networking system may be further minimized. Instead of generating a separate request to a server within the social networking system for each user interaction data pertaining to user interactions may be saved to the cookie and transmitted along with a subsequent request. Because tracking data is typically not mission critical transmission to the server can be delayed without disrupting operation of the social networking system or detracting from the goal of optimizing user experience.

As noted above some client devices may support JavaScript functionality which further allows the number of requests and the amount of data transmitted from a user s client device to the social networking system to be minimized. Because JavaScript is a client side technology it allows for certain interactive functionality to be implemented on a web page without requiring a request to the server or the transmission of data over the network. A web page may incorporate JavaScript elements to enable the browser to react to certain types of user interactions with the web page. For example a web page may include JavaScript event listeners which detect events such as clicks and trigger certain functionality in response.

One such event listener may retrieve data from a document s DOM upon the occurrence of a click. In an embodiment the event listener may be referred to as click ref . On platforms that support JavaScript click ref may be used to traverse the DOM hierarchy of a story and retrieve the identifying key and the identifying type of the element or elements corresponding to the component or components with which the user has interacted. For example in if a user viewing the story clicks on the link corresponding to the element click ref may be triggered at the element . Click ref retrieves the type of the element and traverses the hierarchy retrieving the identifier at each level until it reaches the top most level. Thus click ref retrieves the type of the element the type of the element and the key of the element before terminating. Click ref thereby retrieves enough information to provide to the social networking system to determine that the user has interacted with the story by accessing Jane Doe s profile via the text link.

According to one embodiment of the invention JavaScript functionality may be used to respond to certain types of user interactions with stories without triggering a request or the transmission of data to a server. In one such embodiment of the invention a lengthy story may be displayed in truncated form in a user s news feed. For example an article link or a status update associated with a story may have several long comments attached to it. Displaying the entire comment thread would take up excessive amounts of space on the user s screen and require him to scroll repeatedly to reach the next story. Thus the entire text of the story may be transmitted to the client at the outset but hidden and made accessible via a See more link. According to this embodiment rather than triggering a request to a server in the social networking system to retrieve the remaining text the See more link activates a JavaScript function that un hides it. Thus an interaction with the story may occur without triggering a request to the server. However because the operator of the social networking system may wish to know that the user clicked on the See more link the click may be recorded in a cookie for later transmission as described above.

Using a hierarchical DOM structure reduces the size of the DOM of a story. According to one embodiment of the invention the stories themselves may be embedded within other elements such as elements corresponding to different types of pages e.g. home page profile page etc. and the operator of the social networking system may wish to determine the specific location within the portal at which a user interacted with a story. For example the operator may wish to determine whether the user accessed the story from within his news feed or from within the profile of the user who created the story. As discussed above using a hierarchical model reduces complexity in formatting the underlying DOM of the story. If the elements were represented separately in a non hierarchical fashion a story s key along with identifiers of elements higher up within the hierarchy would have had to be embedded within each element of the DOM which would increase the size of the underlying page source of the news feed significantly.

In an embodiment of the invention involving client devices that do not support JavaScript functionality a hierarchical model for the story s DOM may not be feasible. In such contexts the underlying DOM element of each story may need to include the story s key in order to uniquely identify the element. On mobile platforms the additional data requirements of repetitively including the key in each element are mitigated by the more compact size of mobile media portals. According to one embodiment of the invention the elements of a story on a mobile platform are uniquely identified by a concatenation of the story s key and the element s type. depicts a DOM of the story shown in modeled in a non hierarchical manner in accordance with an embodiment of the invention. The unique identifier of each element may be a combination of the story s key and the element s type separated by two ampersands . For example element is uniquely identified by a concatenation of a key and a type . Alternatively the story s key may be included in a URL corresponding to the story.

For some types of stories it may be desirable for the social networking system to track a user interaction as it occurs rather than after minutes hours or another duration has passed. This may be particularly true for sponsored stories. A sponsored story may include an advertisement that is displayed to a user as a story. Sponsored stories may promote a product service or brand at the behest of any third party. In some implementations the operator of the social networking system may charge the third party for displaying the advertisement on a per click basis. Thus the operator of the social networking system may seek to ensure that the data collected regarding user clicks is reliable and up to date. A process similar to the one illustrated in may not be suited to these goals since a cookie can be deleted or manipulated by a user before the data in that cookie is transmitted to the server. Moreover the social networking system may need to include more data in the DOM for sponsored stories. In addition to the key of the story and the type of the constituent elements the social networking system may be required to include other data on behalf of the advertiser or information that is specific to the advertising context.

According to one embodiment of the invention a story may be accompanied by an encrypted impression. In an embodiment the story accompanied by an encrypted impression may be a sponsored story. The encrypted impression may include advertising data that is based on the particular advertisement the advertiser the user the advertising context in general or any other information. Because the social network and the advertiser may not wish to expose this data to the user the information may be encrypted. Encryption increases the size of data substantially. For example according to one embodiment of the invention an encrypted impression may be as large as 600 bytes or more. This amount of data may be too large or inappropriate to be stored in a cookie. To address these issues the operator of the social networking system may implement functionality that does not rely on cookies and reliably tracks the number of clicks as they happen.

According to one embodiment of the invention the identifying references may be provided from a client device both to the memory caching system of the social networking system to record user interactions and to the advertisement module of the social networking system to for example keep track of clicks for advertising purposes. In one embodiment of the invention data from a sponsored story interaction may be stored in a cookie and transmitted later for interaction tracking purposes in relation to the social networking system or transmitted immediately for advertisement tracking purposes or both. The encrypted impression containing the advertising specific information may not be included in the data written to the cookie but may be transmitted to a separate module dedicated to tracking advertising impressions and clicks. For example referring to the identifying key and the identifying type may be received by the memory caching system while the encrypted impression is received by the advertisement module . Transmission of the encrypted impression to the advertisement module may be initiated before writing of the key and type to the cookie is initiated or completed e.g. asynchronously . Any suitable process for processing the encrypted impression may be used.

The user s client device then receives an interaction with the sponsored story from the user. Upon receiving the interaction the user s client device retrieves at least the key of the sponsored story and the type of the element within the story that the user interacted with from the DOM of the story. The user s client device records the key and the type in a cookie. The user s client device then retrieves the encrypted impression from the DOM of the story and transmits the encrypted impression to the social networking system . At block the social networking system or the advertisement module in particular receives the encrypted impression. At block the social networking system or the memory caching system in particular receives the cookie. As with process the transmission of the cookie from the client device to the social networking system may be performed immediately on the next request after a fixed number of requests or after the amount of data in the cookie reaches a threshold level. At block the identifying key and type associated with the sponsored story interaction are extracted from the cookie by the cookie management module .

The foregoing processes and features can be implemented by a wide variety of machine and computer system architectures and in a wide variety of network and computing environments. illustrates an example of a computer system that may be used to implement one or more of the computing devices identified above. The computer system includes sets of instructions for causing the computer system to perform the processes and features discussed herein. The computer system may be connected e.g. networked to other machines. In a networked deployment the computer system may operate in the capacity of a server machine or a client machine in a client server network environment or as a peer machine in a peer to peer or distributed network environment. In an embodiment of the invention the computer system may be the social networking system the user device and the external system or a component thereof. In an embodiment of the invention the computer system may be one server among many that constitutes all or part of the social networking system .

The computer system includes a processor a cache and one or more executable modules and drivers stored on a computer readable medium directed to the processes and features described herein. Additionally the computer system includes a high performance input output I O bus and a standard I O bus . A host bridge couples processor to high performance I O bus whereas I O bus bridge couples the two buses and to each other. A system memory and one or more network interfaces couple to high performance I O bus . The computer system may further include video memory and a display device coupled to the video memory not shown . Mass storage and I O ports couple to the standard I O bus . The computer system may optionally include a keyboard and pointing device a display device or other input output devices not shown coupled to the standard I O bus . Collectively these elements are intended to represent a broad category of computer hardware systems including but not limited to computer systems based on the x86 compatible processors manufactured by Intel Corporation of Santa Clara Calif. and the x86 compatible processors manufactured by Advanced Micro Devices AMD Inc. of Sunnyvale Calif. as well as any other suitable processor.

An operating system manages and controls the operation of the computer system including the input and output of data to and from software applications not shown . The operating system provides an interface between the software applications being executed on the system and the hardware components of the system. Any suitable operating system may be used such as the LINUX Operating System the Apple Macintosh Operating System available from Apple Computer Inc. of Cupertino Calif. UNIX operating systems Microsoft Windows operating systems BSD operating systems and the like. Other implementations are possible.

The elements of the computer system are described in greater detail below. In particular the network interface provides communication between the computer system and any of a wide range of networks such as an Ethernet e.g. IEEE 802.3 network a backplane etc. The mass storage provides permanent storage for the data and programming instructions to perform the above described processes and features implemented by the respective computing systems identified above whereas the system memory e.g. DRAM provides temporary storage for the data and programming instructions when executed by the processor . The I O ports may be one or more serial and or parallel communication ports that provide communication between additional peripheral devices which may be coupled to the computer system .

The computer system may include a variety of system architectures and various components of the computer system may be rearranged. For example the cache may be on chip with processor . Alternatively the cache and the processor may be packed together as a processor module with processor being referred to as the processor core . Furthermore certain embodiments of the invention may neither require nor include all of the above components. For example peripheral devices coupled to the standard I O bus may couple to the high performance I O bus . In addition in some embodiments only a single bus may exist with the components of the computer system being coupled to the single bus. Furthermore the computer system may include additional components such as additional processors storage devices or memories.

In general the processes and features described herein may be implemented as part of an operating system or a specific application component program object module or series of instructions referred to as programs . For example one or more programs may be used to execute specific processes described herein. The programs typically comprise one or more instructions in various memory and storage devices in the computer system that when read and executed by one or more processors cause the computer system to perform operations to execute the processes and features described herein. The processes and features described herein may be implemented in software firmware hardware e.g. an application specific integrated circuit or any combination thereof.

In one implementation the processes and features described herein are implemented as a series of executable modules run by the computer system individually or collectively in a distributed computing environment. The foregoing modules may be realized by hardware executable modules stored on a computer readable medium or machine readable medium or a combination of both. For example the modules may comprise a plurality or series of instructions to be executed by a processor in a hardware system such as the processor . Initially the series of instructions may be stored on a storage device such as the mass storage . However the series of instructions can be stored on any suitable computer readable storage medium. Furthermore the series of instructions need not be stored locally and could be received from a remote storage device such as a server on a network via the network interface . The instructions are copied from the storage device such as the mass storage into the system memory and then accessed and executed by the processor .

Examples of computer readable media include but are not limited to recordable type media such as volatile and non volatile memory devices solid state memories floppy and other removable disks hard disk drives magnetic media optical disks e.g. Compact Disk Read Only Memory CD ROMS Digital Versatile Disks DVDs other similar non transitory or transitory tangible or non tangible storage medium or any type of medium suitable for storing encoding or carrying a series of instructions for execution by the computer system to perform any one or more of the processes and features described herein.

For purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the description. It will be apparent however to one skilled in the art that embodiments of the disclosure can be practiced without these specific details. In some instances modules structures processes features and devices are shown in block diagram form in order to avoid obscuring the description. In other instances functional block diagrams and flow diagrams are shown to represent data and logic flows. The components of block diagrams and flow diagrams e.g. modules blocks structures devices features etc. may be variously combined separated removed reordered and replaced in a manner other than as expressly described and depicted herein.

Reference in this specification to one embodiment an embodiment other embodiments one series of embodiments or the like means that a particular feature design structure or characteristic described in connection with the embodiment is included in at least one embodiment of the disclosure. The appearances of for example the phrase in one embodiment or in an embodiment in various places in the specification are not necessarily all referring to the same embodiment nor are separate or alternative embodiments mutually exclusive of other embodiments. Moreover whether or not there is express reference to an embodiment or the like various features are described which may be variously combined and included in some embodiments but also variously omitted in other embodiments. Similarly various features are described that may be preferences or requirements for some embodiments but not other embodiments.

The language used herein has been principally selected for readability and instructional purposes and it may not have been selected to delineate or circumscribe the inventive subject matter. It is therefore intended that the scope of the invention be limited not by this detailed description but rather by any claims that issue on an application based hereon. Accordingly the disclosure of the embodiments of the invention is intended to be illustrative but not limiting of the scope of the invention which is set forth in the following claims.

