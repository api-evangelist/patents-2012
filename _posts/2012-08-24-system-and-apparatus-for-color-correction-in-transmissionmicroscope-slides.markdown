---

title: System and apparatus for color correction in transmission-microscope slides
abstract: The present invention concerns a system and method for calibration and adjustment of the pixel color values represented within a digital image of a sample by a transmission microscope. Furthermore the present invention is directed to providing sufficient color information in order to generate a color mapping matrix that allows for the creation of a synthetic image to depict the sample under a desired illumination. The system and method provides a solution that generates a destination-device independent image that is configurable to any calibrated display device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08976239&OS=08976239&RS=08976239
owner: Datacolor Holding AG
number: 08976239
owner_city: Luzern
owner_country: CH
publication_date: 20120824
---
The present invention is directed to a system and method for color correcting images of samples placed on a transmission microscope slide. More particularly the present invention is directed to a system and method that uses a microscope slide with an integrated color filter array to assist in obtaining the proper color values necessary to generate a synthetic image of a sample. Through the present invention color values of a sample under one illumination condition are accurately converted in order to generate a new image having the correct color values of the same sample under the same or a different illuminant.

Currently digital imaging has allowed for unprecedented levels of collaboration between technicians researchers and scientists. In part this collaboration is due to the relatively inexpensive nature of current digital imaging technology. Image capture devices and associated software platforms combined with improved computer screens and monitors have also allowed for the rapid analysis and review of images where accurate color fidelity is essential. The proliferation of different styles models and technical complexity of digital imaging technology can be readily seen in the digital microscopy market. In the field of digital imaging there are many microscope systems that provide custom digital images. Unfortunately there is no system or method currently available that ensures color accuracy and consistency from one system to another.

Additionally recording images of hard to detail specimens requires diligence. A fortuitous imaging of a sample might not be replicable under subsequent conditions. However once the image is recorded modifying it in imagine editing suites can alter the desired appearance. Therefore what is needed is the ability to calibrate an image of a sample so as to render the sample in different lighting conditions. In order to accurately modify the RGB values of a digital image various data points regarding illumination and transmittance spectra need to be known beforehand. Thus what is needed is a system and apparatus that incorporates the various illuminant data into a synthetic device independent image which is modifiable given a desired illuminant type.

Co owned U.S. patent application Ser. No. 13 211 875 titled System and Apparatus for the Calibration and Management of Color in Microscope Slides filed on Aug. 17 2011 herein incorporated by reference in its entirety describes the use of color calibrated slides to determine the color values of biological samples under various lighting conditions. However the system described in the 875 Application does not describe embodiments particular to a transmission microscope system.

What is needed is a system and method that simplifies and standardizes the calibration of a slide with an integrated color filter array. In particular the integrated color filter array is easiest to manufacture when the filters are interference filters whereupon measures must be taken to compensate for the angle dependence of the spectrum of light transmitted through an interference filter. What is also needed is a system and method for calculating CIE tristimulus values within the array using real or idealized spectral power distributions known transmission spectra and CIE color matching functions. What is also needed is a system and method for measuring real spectral power distribution of the microscope light through the optical train of the microscope itself and integrating such a measurement into the color management system. What is also needed is a system that produces images of microscope slides that have been transformed so that the color values present the anticipated color values of the sample under a specified lighting condition. The subject invention is addressed to these deficiencies in the art.

In accordance with a broad aspect of the present invention a system and method disclosed herein provide for the calibration and analysis of images taken of a sample and its associated microscope slide. In more particular aspects the present invention provides for the analysis of images taken of a microscope slide with an integrated color filter array. In part the present invention enables the capture modification and distribution of images that have been color value modified so as to represent images of the sample under various desired lighting conditions and microscope settings. The filter array transmission spectra are used to color manage the image but such spectra are usefully known only if they are conditioned on numerical aperture settings for the microscope so numerical aperture conditioned calibration is ah aspect of the invention. The system and method described provide at least a microscope slide with an integrated color filter array a microscope with known or controllable numerical aperture an imaging device configured to output the RGB camera values to a processor system and a processor system that is capable of generating linear or non linear mapping of RGB to C.I.E. tristimulus XYZ values. Furthermore the present system and method include the use of an optional spectrophotometer or colorimeter in order to generate spectral power distribution SPD of the real microscope illuminant for use in the color calibration system.

Additionally the present method is directed to a series of steps for using a system generally as described. These steps include determining a spatial uniformity calibration value by using a blank field image and a step for selecting the desired destination illumination. The method also includes calculating the CIE tristimulus values of the plurality of color elements of the slide array by using real or ideal illuminant spectral power distribution known color filter transmission spectra values and the 2 CIE color matching functions. A further step is provided for mapping the RGB pixel values of the color filter array to C.I.E. tristimulus values through a color mapping matrix. An additional step includes generating device independent CIE tristimulus values for each pixel of the sample image through the application of the color mapping matrix. The method also provides a step for outputting the CIE tristimulus image to a calibrated output device.

By way of overview and introduction the present invention concerns a system and method for calibration and adjustment of the pixel color values represented within a digital image of a sample. Furthermore the present invention is directed to providing sufficient color information in order to generate a color mapping matrix that allows for the creation of a synthetic image depicting the sample under a desired illuminate. The system and method provides a solution to scientists and other technical professionals which enables them to obtain a sample under a given lighting condition and generate a synthetic image that represents the accurate color pixel values of that sample under the actual microscope light or a different lighting scheme.

As seen in the principles behind the present invention are applicable to and can be used in conjunction with multiple types of microscopes. For example the illustrated arrangement employs the use of a transmission microscope. However those skilled in the art will recognize that the principles behind the present system can be used with different microscope types such as reflectance or fluorescent microscopes.

A transmission microscope is a device or apparatus in which the light source and the viewer are on opposite sides of the plane of the slide specimen and in which transmitted light is passed through the specimen. The light is transmitted to an image recording device designed to record images of a sample. When using a transmission microscope those images are the product of the incident illumination of the light source and the transmittance spectrum of the specimen. illustrates an imaging device configured to record images of a slide in a transmission microscope. The light directed from the light source is conditioned by the condenser and illuminates the sample on the slide . The objective collects the light shown as a light path arrow passing through the sample and delivers that light to either the eyepiece or imaging device through a flip mirror . The imaging device is configured to output the images to a processor such as a computer . The computer is optionally equipped with an output device such as a calibrated monitor.

In the illustrated arrangement the imaging device is a CCD Charged Coupled Detector or CMOS Complementary metal oxide semiconductor having sufficient components to record images to a temporary or permanent storage device. In a specific arrangement the CCD sensor of the imaging device is a frame pixel recording device. Furthermore the imaging device is configured to record images having at least three 3 independent color channels tri chromatic characteristics .

The imaging device is also configured to transmit recorded images to the computer for analysis or processing. Those skilled in the art will appreciate that the data connection between the imaging device and the computer is any standard wired or wireless connection. For example the imaging device and the computer of are connected via a data cable. However in an alternative arrangement of elements the data connection is supplied by a local area network LAN or short range wireless network using protocols such as Wi Fi Bluetooth or RFID.

The imaging device is any device capable of capturing the required spectral data in sufficient detail necessary for the calibration functions to proceed. For example a digital still camera digital motion picture camera portable computer camera desktop computer camera PDA with equipped camera imaging device equipped smart phone camera phone web camera and so on having sufficient resolution for capturing color information are suitable imaging devices. Likewise any device may be used as an imaging device so long as it is capable of capturing optical data through a lens or plurality of lenses and transmitting an image file that includes the captured data. As one non limiting example a digital single lens reflex camera and microscope adaptor is a suitable image capture device.

In the given arrangement the light source is an incandescent light source such as a halogen based light source. In an alternative arrangement the light source is formed of multiple elements each capable of providing a steady source of specific spectrum illumination such as ultraviolet infrared daylight CIE standard D65 tungsten light fluorescent light or other specific visible light frequencies. Further the light source is positioned such that the reference illuminations emitted by the light sources are incident upon the microscope stage and the slide itself. In an alternative embodiment these light sources are actively filtered so as to produce specific illumination characteristics.

Those skilled in the art will appreciate that other light sources so long as their spectral power distributions SPD cover the visible wavelength range are suitable for use in the described system.

In a further arrangement the color filter array contains a plurality of sections with different transmission spectra necessary to replicate the complete range of transmission spectra likely to appear in the slide image. In the preferred embodiment at least one portion of the array contains achromatic black white and grey elements.

The color filter array is affixed to the slide through standard production techniques. For example the color calibration array is printed onto the slide substrate by photolithographic printing or other similar techniques. In the color filter array contains a plurality of color elements with different transmission spectra that when combined provide a complete coverage of the visible spectrum. While the color filter array is depicted within the center of the slide it is possible to position the color array at any position on the slide substrate that is visible to an imaging device .

In the described system the specific transmission characteristics such as transmission percentage at each wavelength for a variety of settings of the microscope numerical aperture of each element of the color filter array is known and stored within a database accessible by the computer . The slide substrate is formed of standard optical slide materials that are commercially available for the given purpose. The slide substrate is composed of any suitable material for inclusion with the given microscope type. For example the slide substrate is composed of glass plastics composite materials and other standard transparent materials used for transmission microscopy slide production. The slide can be formed of material suitable for photolithography. Such photolithography based slides are composed of materials that are commonly used in the art for photolithography techniques. Alternatively one can also fuse using optical glue the color elements on a regular microscope slide.

To minimize the impact from the global fluctuations of the light source all of the elements of the color filter array are captured in a single image. Because test specimens most often fill the microscope s field of view even at low magnification the color filter array will most likely have to reside on a different area on the same slide or on a slide that is different from the test specimen. Although calibration accuracy would be greater if the color filter array were on the same slide as the test specimen having a color filter array on each test specimen slide would be cost prohibitive. Accordingly in a preferred embodiment the described system uses at least two slides for color calibration. The first slide contains a specified integrated color array while the second slide contains the sample under investigation. Due to magnification constraints the color array and the portion of the sample under investigation may not be resolvable in the same image. For example illustrates a preferred embodiment of the slide substrate within integrated color array that is not configured with a sample. Likewise illustrates a slide substrate with a sample under analysis.

In an alternative arrangement the imaging device is configured to record an image of the slide that captures both the sample and the color filter array . The slide is optionally configured to incorporate enhancements capable of providing information to an end user. For example the slide incorporates visual source identifiers such as serial numbers bar codes q codes or other visual identifiers.

As shown in the slide is equipped with a 5 5 filter array equipped with both narrow band pass filters and neutral density filters. Those skilled in the art will appreciate that any combination of filters that are suitable for the given illumination source e.g. incandescent UV etc. is envisioned. In the given arrangement a slide not affixed with a sample is used as a calibration slide for in order to determine the proper values for use in color correction.

As shown a biological sample is placed on the substrate slide and is illuminated. As seen in the field of view the color calibration target is visible within the same frame as the biological sample . This ensures that the correct calibration processes are preformed on the colors located within the sample. In the present system knowledge of the calibrated values found within the color filter array allows for the determination of the correct chromatic values for the biological sample .

Each of the arrays depicted in provides a plurality of narrow band color filters with peak wavelengths covering the visible spectrum e.g. ranging from 400 to 700 nm and neutral density filters with optical density OD from 0.04 to 2.0. As shown in the transmission spectrum of each filter is pre measured using a spectrophotometer that is temporarily mounted at the same position as the imaging device . The measurement of the transmission spectra is accomplished using industry standard techniques and instruments. Once the values of the elements of the array are known they are stored in a database or look up table for future reference.

Those skilled in the art will appreciate that the light spectra transmitted by the filter elements comprising the color filter array may be sensitive to viewing and illumination angle. Thus the light transmission values of the color filter array change as the numerical aperture N.A. of the microscope system is altered. To compensate for this change the transmission spectra of the filter elements are recorded at several N.A. settings. These values are also stored within a database for future reference during the color calibration processing. If the test N.A. setting is one of the recorded values the transmission spectra for that N. A. value are used. If not the transmission spectra may be adopted as either the spectra for the closest tabulated N. A. or obtained through interpolation.

The illustrated system also provides a processor configured to generate the tristimulus values from the pixels of the images without human intervention. The processing duties and functions of the computer are in one arrangement performed by a local microprocessor configured to execute instructions stored in a storage medium. The local computer or processor is further configured to possess a database in which reference data values are stored and accessed.

In an alternative arrangement the computer is part of a remote processing appliance accessible via a network. This reduces the need for complex computational hardware on site. Furthermore this allows for specific calibration and maintenance issues to be performed on a centrally located computer and software system and ensures that there is less variance between users.

It is further expected that the computer is fully capable of connecting to external and internal networks so as to distribute processing tasks or exchange data related to each slide. The computer is configured to connect to networks and databases using commonly understood programming interfaces and interface modules e.g. Media Server Pro Java Mysql Apache Ruby on Rails and other similar application programming interfaces and database management solutions. The illustrated computer system is characterized in part by its broad adaptability to user configurations multiple user inputs and hardware configurations.

The computer is configured to allow selection of a series of color correction options. For example the computer is configured to select one of a series of pre defined destination illuminants for the resulting synthetic image. These destination illuminants SPD vector in part configure the color values of the sample in the resulting synthetic image. For example the destination illuminant selected is configured such that the resulting synthetic image matches the view of the sample as seen through the eyepiece of a microscope. In one example the computer provides access to a database which stores various pre determined SPD vectors. Each stored SPD vector corresponds to a particular known lighting condition.

In the event that the light source SPD vector corresponding to the destination illuminant is not stored in the database that SPD must be pre measured by a spectroradiometer such as is made by Konica Minolta CS 1000a coupled to the eye piece of the microscope and configured to output the SPD vector for use in the present system.

The processor is configured to generate a CIE tristimulus vector of each filter element incorporating the real or ideal illuminant spectral power distribution values known color filter transmission spectra values and the 2 CIE color matching functions into a 3 by K matrix where K is the number of filter elements and the dimension 3 represents the X Y Z tristimulus coordinates. The given numerical aperture N.A. setting of the microscope determines which of the stored transmission spectra of each filter element is used.

The computer is further configured to accept images of the slide that incorporate pixels corresponding to the color filter array and the pixels corresponding to the sample . The computer is further configured to generate a matrix of all the RGB pixel values from each filter k such that the RGB vector is

The database is configured to store this color mapping matrix M for use with any subsequent test sample under the same illuminant with the same microscope settings.

Upon recording a raw image of the actual sample under study the computer transforms the raw image to generate device independent C.I.E. tristimulus values of each pixel on the image such that the pixels are transformed according to the following the equation of

The computer is configured to output these corrected images as either a device independent C.I.E. value image or as an image of device dependent RGB values for use with a color calibrated output device such as a monitor. For example a calibrated monitor is configured with a display profile that determines the proper display of RGB color values. The device independent C.I.E. value image is converted by sending the values through the proper display profile. Once converted through the display profile the RGB values are properly configured for accurate display on the display device. Furthermore a user is able to retrieve these images for further analysis or distribution.

The present invention also incorporates a sequence of steps for using the system so described to carry out and achieve the function of providing a color calibrated image to a display or storing the color calibrated image for later retrieval. Such a method involves but is not limited to an instrument selection step in which the settings such as N.A. light source intensity light source CCT objective and camera white balance and exposure time gain are set to the desired levels before the color correction procedure.

The method includes a calibrating step in which a spatial uniformity calculation is performed on a blank microscope field. A calculating step is provided in order to determine the CIE tristimulus values of the plurality of color filters comprising the color filter array using a real or ideal illuminant spectral power distribution the known transmission spectra and the 2 CIE color matching functions. An image recording step is also provided in which an image of the color filter array is recorded and sent to a processor for processing. The method also provides for an extracting step in which the computer extracts the corresponding camera RGB pixel values of each color filter to a matrix and maps that matrix to the CIE tristimulus value matrix of the color filters. A transformation step is provided in which the computer extracts the corresponding camera RGB pixel values for the entire sample image and converts those values into corresponding device independent C.I.E. tristimulus values using the color mapping matrix.

The method also includes a step for generating device dependent RGB images for delivery to a calibrated monitor or printer. The present method also provides an optimization step for increased accuracy through the use of extended size matrices. In a further arrangement the present method also includes an optional step of determining the spectral power distribution of the current illuminant through the use of a spectrophotometer or colorimeter.

Each of the steps described are performed and executed as a series of modules operating on a computer. Each of these modules can comprise hardware code executing in a processor or both that configures a machine such as the computing system to implement the functionality described herein. The functionality of these modules can be combined or further separated as understood by persons of ordinary skill in the art in analogous implementations of embodiments of the invention.

The calibration module is further configured to include a series of sub modules for recording the microscope and digital imager settings including the numerical aperture values and image settings. Furthermore a sub module is provided for recording an image of a blank microscope field and storing the resulting pixels intensities as I i j b . In this module i j denote the spatial position of a pixel and b denotes the spectral band within the digital imaging device. A normalizing sub module is provided for dividing any subsequent image pixels I i j b by the respective blank field values I i j b to generate a normalized pixel value for use in the color calibration or in color rendering modules.

The color selection step includes a sub module for allowing a user to select a specific destination illumination of the resulting synthetic image. The destination illumination spectrum is determined according to the illumination spectrum desired for the synthetic image. The user may select a pre defined illuminant to render the image in which case the software retrieves one of the SPD vectors S for known or common illuminants that have been pre stored in the database accessible by the computer. Alternatively the user may activate a sub module configured to record the light spectrum values from a spectroradiometer positioned in place of the eyepiece.

The calculating step includes a sub module for obtaining the CIE tristimulus values of the color filters. In one particular instance the instruction set uses specific algorithms to calculate the CIE value vector

Where T k is the transmission spectrum of the color filter at a specific numerical aperture NA . The T k of each color filter is calibrated prior the color correction and saved in a storage such as a database connected to the computer . S is the spectral power distribution SPD of the either a standard illuminant such as D65 A and F11 or the actual SPD of the microscope light source.

In the above formulas x y z are 2 CIE color matching functions. The C.I.E. tristimulus values of all the color filters are combined into a 3 by K matrix X where K is the number of color filters and 3 refers to the X Y Z values.

The calculating module also includes a sub module for generating a matrix from the RGB pixel values of the color filter array such that a 3 by K matrix D where the kcolumn of D

The optimization module also includes a sub module for extending the linear 3 by 3 matrix to larger matrices in order to yield improved accuracy. In one example the vectors Dis extended from R G M to R G B RGBRG RB GB . As a result the matrix D is extended from 3 by K to 9 by K and the color mapping matrix M is extended from 3 by 3 to 3 by 9. This provides better color accuracy at the cost of less tolerance to the nonlinearity of the camera response. In the alternative the sub module is equipped to extend the linear 3 by 3 matrix into larger matrices by extending vector Dfrom R G B to R G B RG BG RB . . . . An additional sub module is directed to transforming the RGB values on each pixel of the sample image so as to match anticipated color values under the destination illuminant. For example the transformation sub module is configured to transform the pixels according to the following the equation

A display module is provided that processes the XYZ values through a display profile thus creating a device dependent image of display RGB inputs to drive a calibrated display device such as a monitor.

It should be understood that various combination alternatives and modifications of the present invention could be devised by those skilled in the art. The present invention is intended to embrace all such alternatives modifications and variances that fall within the scope of the appended claims.

While the invention has been particularly shown and described with reference to a preferred embodiment thereof it will be understood by those skilled in the art that various changes in form and details may be made therein without departing from the spirit and scope of the invention.

