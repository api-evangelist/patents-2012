---

title: Methods and devices for determining orientation
abstract: Methods and electronic devices for determining orientation are described. In one aspect, a processor-implemented method of determining a corrected orientation of a gyroscope on an electronic device includes: generating a gyroscope reading using the gyroscope; determining, by the processor, a first orientation estimate based on the gyroscope reading and a past corrected orientation; determining, by the processor, whether the gyroscope was saturated when the gyroscope reading was generated; adjusting, by the processor, a saturation correction learning rate for the gyroscope based on the result of the determination of whether the gyroscope was saturated; and calculating, by the processor, the corrected orientation based on the first orientation estimate, a second orientation estimate and the saturation correction learning rate.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09279680&OS=09279680&RS=09279680
owner: BlackBerry Limited
number: 09279680
owner_city: Waterloo, Ontario
owner_country: CA
publication_date: 20120315
---
The present disclosure relates generally to electronic device orientation and more particularly to methods and devices for determining an orientation of an electronic device.

A gyroscope is a device which may be used for measuring rotation rate. Gyroscopes are sometimes included in electronic devices such as handheld electronic devices in order to provide information about the orientation of such electronic devices. Such orientation information allows the electronic device to know information about its own physical position. For example the gyroscope may allow for recognition of movement within a three dimensional space. The electronic device may use such orientation information as an input signal. That is the electronic device may be operated in a mode in which gyroscope measurements affect the operation of the electronic device.

Gyroscope readings may be useful for determining an estimate of the orientation of an electronic device. Orientation estimates which are determined based on gyroscope readings are particularly accurate when the electronic device is rotating slowly. However when an electronic device begins to rotate quickly orientation estimates which are determined based on gyroscope readings may become more inaccurate since the gyroscope may be unable to determine an accurate measure of the speed of rotation if the electronic device rotates too quickly. That is the electronic device may be rotated at a speed which is beyond the gyroscope s measurement capabilities. At such a point the gyroscope may become saturated and may output gyroscope readings which do not accurately reflect the rotation of the electronic device.

In one aspect the present disclosure provides a processor implemented method of determining a corrected orientation of a gyroscope on an electronic device. The method includes obtaining a gyroscope reading determining a first orientation estimate based on the gyroscope reading and a past corrected orientation determining whether the gyroscope was saturated when the gyroscope reading was obtained adjusting a saturation correction learning rate for the gyroscope based on the result of the determination of whether the gyroscope was saturated and determining a corrected orientation based on the first orientation estimate a second orientation estimate and the saturation correction learning rate.

In another aspect the present disclosure describes an electronic device. The electronic device includes a memory and a gyroscope. The electronic device also includes a processor coupled to the memory and the gyroscope. The processor is configured to determine a corrected orientation of the gyroscope by obtaining a gyroscope reading determining a first orientation estimate based on the gyroscope reading and a past corrected orientation determining whether the gyroscope was saturated when the gyroscope reading was obtained adjusting a saturation correction learning rate for the gyroscope based on the result of the determination of whether the gyroscope was saturated and determining a corrected orientation based on the first orientation estimate a second orientation estimate and the saturation correction learning rate.

In another aspect the present disclosure describes a computer readable storage medium including computer executable instructions for determining a corrected orientation for a gyroscope by obtaining a gyroscope reading determining a first orientation estimate based on the gyroscope reading and a past corrected orientation determining whether the gyroscope was saturated when the gyroscope reading was obtained adjusting a saturation correction learning rate for the gyroscope based on the result of the determination of whether the gyroscope was saturated and determining a corrected orientation based on the first orientation estimate a second orientation estimate and the saturation correction learning rate.

Electronic devices may sometimes benefit from knowledge about their own orientation. For example electronic devices are sometimes configured to operate based on the orientation of the electronic device. That is the orientation of the electronic device may act as an input to an application system or process whose actions depend on the orientation of the electronic device. For example a display screen on a display of the electronic device may depend on the orientation of the electronic device. By way of example the display screen may toggle between landscape and portrait orientations based on the orientation of the electronic device.

Thus in at least some embodiments the electronic device may benefit from knowledge about the orientation of the electronic device.

Referring first to an example electronic device is illustrated. In the embodiment illustrated the electronic device is a handheld mobile communication device. However the electronic device may take a variety of forms. By way of example the electronic device may be a global positioning system GPS unit an inertial navigation system INS a mobile communication device such as a mobile phone or smartphone a tablet computer a laptop computer a wearable computer such as a watch a camera or an electronic device of another type.

In some embodiments the electronic device includes a display such as a liquid crystal display LCD and an input interface such as a keyboard or keypad or a navigation tool such as a clickable scroll wheel also referred to as a track wheel or thumbwheel or trackball. In some embodiments the display may be a touchscreen display which permits a user to provide input to the electronic device by touching the display . That is the display may act as an input interface to the electronic device providing the electronic device with an electronic signal generated in response to user contact with the touchscreen display.

The electronic device includes one or more sensors which may be used by the electronic device to determine the orientation of the electronic device . In the example embodiment illustrated the electronic device includes a gyroscope . The gyroscope measures rotational velocity of the gyroscope . In the embodiment illustrated since the gyroscope is integrated within the electronic device the gyroscope effectively measures rotational velocity of the electronic device . In the illustrated embodiment the gyroscope is illustrated using a circle which is shown using a broken line to reflect the fact that the gyroscope may be internally mounted within the electronic device . While the circular gyroscope is useful for the purposes of illustration the gyroscope will typically take other forms. For example the gyroscope may have a standard electronic chip form factor.

The gyroscope includes one or more sensing axis. In the embodiment illustrated the gyroscope includes three orthogonal sensing axes denoted Gx to represent the gyroscope s x sensing axis Gy to represent the gyroscope s y sensing axis and Gz to represent the gyroscope s z sensing axis Each sensing axis is orthogonal to the other sensing axes. For example the x sensing axis Gx is orthogonal to the y and z sensing axes Gy and Gz respectively the y sensing axis Gy is orthogonal to the x and z sensing axes Gx and Gz respectively and the z sensing axis Gz is orthogonal to the x and y sensing axes Gx and Gy respectively .

The gyroscope may produce a gyroscope reading for each of the sensing axes Gx Gy Gz. For example a gyroscope reading wmay be produced by the gyroscope based on gyroscope measurements associated with the x sensing axis such as a rotation about the x sensing axis a gyroscope reading wmay be produced by the gyroscope based on gyroscope measurements associated with the y sensing axis such as a rotation about the y sensing axis and a gyroscope reading wmay be produced by the gyroscope based on gyroscope measurements associated with the z sensing axis such as a rotation about the z sensing axis . These gyroscope readings collectively form the gyroscope output. That is the gyroscope output is an electronic signal which is representative of the gyroscope readings w w wfor the sensing axes Gx Gy Gz of the gyroscope . The electronic signal may for example provide the gyroscope readings w w wfor the sensing axes Gx Gy Gz of the gyroscope as measures of an amount of rotation per unit time about each sensing axis. For example the gyroscope may produce an output in terms of radians per second or degrees per second. The gyroscope output may in some embodiments be an analog output. In other embodiments the gyroscope output may be digital. A gyroscope reading captured at a point in time may be referred to as a gyroscope sample. Such samples may be obtained for example at regular intervals.

The gyroscope output may separate the gyroscope readings for each sensing axis at a signal level or at an output interface level or both. For example in some embodiments the gyroscope may have a separate output interface such as a separate pad or pin associated with each sensing axis. Each output interface associated with a sensing axis may provide an output signal representing gyroscope readings for its associated sensing axis thus separating the gyroscope readings for the sensing axes at an output interface level . In other example embodiments a common output interface such as a common pad or pin may be associated with a plurality of sensing axes. That is gyroscope readings for a plurality of sensing axes may be provided on a common output interface such as a common pad or pin .

In some embodiments the gyroscope may be a digital gyroscope provided in an integrated circuit IC having a memory such as Electrically Erasable Programmable Read Only Memory EEPROM or flash memory analog to digital A D converter and a controller such as a suitably programmed microprocessor or Field Programmable Gate Array FPGA . The IC may provide an industry standard interface such as an SPI Serial Peripheral Interface or I2C Inter Integrated Circuit interface for connecting to a printed circuit board PCB of the electronic device .

The sensing axes Gx Gy Gz of the gyroscope may be aligned with the form factor of the electronic device . For example in the embodiment illustrated the axes are aligned such that when the electronic device is oriented on a flat surface such as a table the x and y sensing axes are parallel to the table and the z sensing axis is perpendicular to the table. It is contemplated that the sensing axes x y z may be aligned with different features of the electronic device in other embodiments.

The gyroscope may be limited in its ability to accurately estimate a rate of rotation. More particularly the gyroscope may have an operating range. When the gyroscope is operated within its operating range it may produce an output which accurately reflects the rate at which it is being rotated. However when the gyroscope is operated outside of its operating range e.g. when it is rotated at a speed which is faster than it is equipped to handle then it may produce an output which does not accurately reflect the rotation rate of the gyroscope . When the gyroscope is operated outside of its operating range the gyroscope is referred to as being saturated.

In some embodiments when the gyroscope is saturated the gyroscope may generate an output which may be referred to as a saturated output. The saturated output may be a common output which is produced irrespective of the degree to which the gyroscope is saturated. That is whenever the gyroscope is saturated it may produce the same output. If the gyroscope is rotating at a rate which is slightly above its operating range it will produce the same saturated output which is produced when the gyroscope is rotating at a rate which is well above its operating range. In some embodiments the saturated output may be the highest output that the gyroscope generates. That is the saturated output may be the highest gyroscope reading generated by the gyroscope . In such embodiments the electronic device may determine whether the gyroscope is saturated by monitoring gyroscope readings and by determining whether a current reading reflects the highest gyroscope reading for the gyroscope . That is if the electronic device determines that the gyroscope reading is the highest reading observed for the gyroscope then the electronic device may determine that the gyroscope is saturated. The evaluation as to whether the gyroscope reading represents the highest reading observed may in at least some embodiments be performed on a per axis basis. That is the electronic device may store the highest reading observed for each axis and may determine whether the gyroscope is saturated by comparing the current gyroscope reading for each axis to the highest reading observed for that axis.

The electronic device may also include an accelerometer . An accelerometer is a device which generates an output signal in dependence on the acceleration of the accelerometer . That is the accelerometer produces an output which reflects the acceleration of the accelerometer. More particularly the accelerometer may generate an output which specifies the magnitude and or direction of acceleration. In the embodiment illustrated since the accelerometer is integrated within the electronic device the accelerometer effectively measures the acceleration of the electronic device .

In the illustrated embodiment the accelerometer is illustrated using a circle which is shown using a broken line to reflect the fact that the accelerometer may be internally mounted within the electronic device . While the circular accelerometer is useful for the purposes of illustration the accelerometer will typically take other forms. For example the accelerometer may have a standard electronic chip form factor.

In some embodiments the accelerometer may be a digital accelerometer provided in an integrated circuit IC having a memory such as Electrically Erasable Programmable Read Only Memory EEPROM or flash memory analog to digital A D converter and a controller such as a suitably programmed microprocessor or Field Programmable Gate Array FPGA . The IC may provide an industry standard interface such as an SPI Serial Peripheral Interface or I2C Inter Integrated Circuit interface for connecting to a printed circuit board PCB of the electronic device .

The accelerometer includes one or more sensing axis. In the embodiment illustrated the accelerometer includes three orthogonal sensing axes denoted Ax to represent the accelerometer s x sensing axis Ay to represent the accelerometer s y sensing axis and Az to represent the accelerometer s z sensing axis Each sensing axis is orthogonal to the other sensing axes. For example the x sensing axis Ax is orthogonal to the y and z sensing axes Ay and Az respectively the y sensing axis Ay is orthogonal to the x and z sensing axes Ax and Az respectively and the z sensing axis Az is orthogonal to the x and y sensing axes Ax and Ay respectively .

The accelerometer may produce an accelerometer reading for each of the sensing axes Ax Ay Az. For example an accelerometer reading amay be produced by the accelerometer based on accelerometer measurements associated with the x sensing axis such as an acceleration along the x sensing axis an accelerometer reading amay be produced by the accelerometer based on accelerometer measurements associated with the y sensing axis such as an acceleration along the y sensing axis and an accelerometer reading amay be produced by the accelerometer based on accelerometer measurements associated with the z sensing axis such as an acceleration along the z sensing axis . These accelerometer readings collectively form the accelerometer output. That is the accelerometer output is an electronic signal which is representative of the accelerometer readings a a afor the sensing axes Ax Ay Az of the accelerometer .

As shown in the sensing axes Ax Ay Az of the accelerometer may be aligned with the form factor of the electronic device . In the embodiment illustrated the x and y sensing axes Ax and Ay are generally parallel to the front face of the electronic device and the z sensing axis Az is generally perpendicular to the front face of the electronic device. One or more of the sensing axes Ax Ay Az of the accelerometer may be aligned with one or more of the sensing axes Gx Gy Gz of the gyroscope .

The electronic device may also include a magnetometer . The magnetometer which may also be referred to as a digital compass is a measuring instrument which is used to measure the strength and or direction of magnetic fields. That is the magnetometer generates an electronic signal which reflects the direction and or strength of a magnetic field in the vicinity of the magnetometer . Since the magnetometer is mounted within the electronic device the magnetometer effectively reflects the direction and or strength of a magnetic field acting on the electronic device .

In the illustrated embodiment the magnetometer is illustrated using a circle which is shown using a broken line to reflect the fact that the magnetometer may be internally mounted within the electronic device . While the circular magnetometer is useful for the purposes of illustration the magnetometer will typically take other forms. For example the magnetometer may have a standard electronic chip form factor.

In some embodiments the magnetometer may be a digital magnetometer provided in an integrated circuit IC having a memory such as Electrically Erasable Programmable Read Only Memory EEPROM or flash memory analog to digital A D converter and a controller such as a suitably programmed microprocessor or Field Programmable Gate Array FPGA . The IC may provide an industry standard interface such as an SPI Serial Peripheral Interface or I2C Inter Integrated Circuit interface for connecting to a printed circuit board PCB of the electronic device .

The magnetometer is in at least some embodiments a three axis magnetometer which includes three sensing axes Mx My Mz. In the embodiment illustrated the magnetometer includes three orthogonal sensing axes denoted Mx to represent the magnetometer s x sensing axis My to represent the magnetometer s y sensing axis and Mz to represent the magnetometer s z sensing axis Each sensing axis is orthogonal to the other sensing axes. For example the x sensing axis Mx is orthogonal to the y and z sensing axes My and Mz respectively the y sensing axis My is orthogonal to the x and z sensing axes Mx and Mz respectively and the z sensing axis Mz is orthogonal to the x and y sensing axes Mx and My respectively .

The magnetometer may produce a magnetometer reading for each of the sensing axes Mx My Mz. For example a magnetometer reading mmay be produced by the magnetometer based on magnetometer measurements associated with the x sensing axis such as a magnetic field along the x sensing axis a magnetometer reading mmay be produced by the magnetometer based on magnetometer measurements associated with the y sensing axis such as a magnetic field along the y sensing axis and a magnetometer reading mmay be produced by the magnetometer based on magnetometer measurements associated with the z sensing axis such as a magnetic field along the z sensing axis . These magnetometer readings collectively form the magnetometer output. That is the magnetometer output is an electronic signal which is representative of the magnetometer readings m m mfor the sensing axes Mx My Mz of the magnetometer .

As shown in the sensing axes Mx My Mz of the magnetometer may be aligned with the form factor of the electronic device . In the embodiment illustrated the x and y sensing axes Mx and My are generally parallel to the front face of the electronic device and the z sensing axis Mz is generally perpendicular to the front face of the electronic device . One or more of the sensing axes Mx My Mz of the magnetometer may be aligned with one or more of the sensing axes Gx Gy Gz of the gyroscope and or one or more sensing axes Ax Ay Az of the accelerometer .

While illustrates three separate sensors e.g. a gyroscope an accelerometer and a magnetometer in some embodiments two or more of these sensors may be provided in a common packaging such as a common electronic chip. For example in some embodiments a single electronic chip may include both an accelerometer and a magnetometer .

Referring now to a block diagram of an example electronic device is illustrated. The electronic device of may include a housing which houses components of the electronic device . Internal components of the electronic device may be constructed on a printed circuit board PCB . The electronic device includes a controller including at least one processor such as a microprocessor which controls the overall operation of the electronic device . The processor interacts with device subsystems such as a wireless communication subsystem for exchanging radio frequency signals with a wireless network to perform communication functions. The processor interacts with additional device subsystems including one or more input interfaces such as a keyboard one or more control buttons one or more microphones one or more cameras a gyroscope an accelerometer a magnetometer and or a touch sensitive overlay associated with a touchscreen display flash memory random access memory RAM read only memory ROM auxiliary input output I O subsystems a data port which may be a serial data port such as a Universal Serial Bus USB data port one or more output interfaces such as a display which may be a liquid crystal display LCD one or more speakers or other output interfaces a short range communication module and other device subsystems generally designated as . Some of the subsystems shown in perform communication related functions whereas other subsystems may provide resident or on device functions.

The electronic device may include a touchscreen display in some example embodiments. The touchscreen display may be constructed using a touch sensitive input surface connected to an electronic controller. The touch sensitive input surface overlays the display and may be referred to as a touch sensitive overlay. The touch sensitive overlay and the electronic controller provide a touch sensitive input interface and the processor interacts with the touch sensitive overlay via the electronic controller. That is the touchscreen display acts as both an input interface and an output interface .

The communication subsystem includes a receiver a transmitter and associated components such as one or more antenna elements and local oscillators LOs and a processing module such as a digital signal processor DSP . The antenna elements and may be embedded or internal to the electronic device and a single antenna may be shared by both receiver and transmitter as is known in the art. The particular design of the wireless communication subsystem depends on the wireless network in which the electronic device is intended to operate.

The electronic device may communicate with any one of a plurality of fixed transceiver base stations of the wireless network within its geographic coverage area. The electronic device may send and receive communication signals over the wireless network after the required network registration or activation procedures have been completed. Signals received by the antenna through the wireless network are input to the receiver which may perform such common receiver functions as signal amplification frequency down conversion filtering channel selection etc. as well as analog to digital A D conversion. A D conversion of a received signal allows more complex communication functions such as demodulation and decoding to be performed in the DSP . In a similar manner signals to be transmitted are processed including modulation and encoding for example by the DSP . These DSP processed signals are input to the transmitter for digital to analog D A conversion frequency up conversion filtering amplification and transmission to the wireless network via the antenna . The DSP not only processes communication signals but may also provide for receiver and transmitter control. For example the gains applied to communication signals in the receiver and the transmitter may be adaptively controlled through automatic gain control algorithms implemented in the DSP .

In some example embodiments the auxiliary input output I O subsystems may include an external communication link or interface for example an Ethernet connection. The electronic device may include other wireless communication interfaces for communicating with other types of wireless networks for example a wireless network such as an orthogonal frequency division multiplexed OFDM network.

In some example embodiments the electronic device also includes a removable memory module typically including flash memory and a memory module interface . Network access may be associated with a subscriber or user of the electronic device via the memory module which may be a Subscriber Identity Module SIM card for use in a GSM network or other type of memory module for use in the relevant wireless network type. The memory module may be inserted in or connected to the memory module interface of the electronic device .

The electronic device may store data in an erasable persistent memory which in one example embodiment is the flash memory . In various example embodiments the data may include service data having information required by the electronic device to establish and maintain communication with the wireless network . The data may also include user application data such as email messages address book and contact information calendar and schedule information notepad documents images and other commonly stored user information stored on the electronic device by its user and other data.

The data may in at least some embodiments include a saturation correction learning rate . As will be described in greater detail in the discussion of the orientation determination application and the method of the saturation correction learning rate may be used to control the amount of correction which will be applied to an orientation estimate obtained based on a gyroscope reading. As will be further discussed below the saturation correction learning rate may be determined to depend at least in part on whether the gyroscope is saturated and or whether it was saturated in the past . That is the saturation correction learning rate which will be used to correct an orientation estimate obtained based on a gyroscope reading may be increased if the gyroscope is saturated. If the gyroscope remains saturated for an extended period of time the saturation correction learning rate may be iteratively increased over time. That is during a period of uninterrupted saturation the saturation correction learning rate which will be used to correct an orientation estimate determined from a gyroscope reading obtained early in the period of saturation will be less than the saturation correction learning rate which will be used to correct an orientation estimate determined from a gyroscope reading obtained later in the period of saturation. That is during a period of uninterrupted saturation of the gyroscope the saturation correction learning rate will be iteratively increased so that the degree of correction becomes greater over time.

The data may also include a past corrected orientation . The past corrected orientation may be an orientation estimate for the electronic device which was previously determined. The past corrected orientation may be an orientation which was previously determined and which was previously corrected for gyroscope saturation and or other sources of errors. The past corrected orientation may be used for example to allow the electronic device to determine an orientation of the electronic device from the gyroscope readings obtained from the gyroscope . That is the past corrected orientation may serve as a reference point for determining orientation from gyroscope readings. Gyroscope readings may not taken alone provide the electronic device with enough information to determine the electronic device s orientation. However gyroscope readings when coupled with a reference point such as the past corrected orientation may provide the electronic device with information which allows the electronic device to determine the orientation.

The data stored in the persistent memory e.g. flash memory of the electronic device may be organized at least partially into a number of databases or data stores each containing data items of the same data type or associated with the same application. For example email messages contact records and task items may be stored in individual databases within the electronic device memory.

Since the past corrected orientation and or the saturation correction learning rate may be current i.e. representative of a current orientation and or representative of an accurate learning rate for only a short period of time in some embodiments the past corrected orientation and or the saturation correction learning rate are stored in a temporary storage. For example the past corrected orientation and or the saturation correction learning rate may be stored in an area of memory which is reserved for storing transient data.

The data port may be used for synchronization with a user s host computer system. The data port enables a user to set preferences through an external device or software application and extends the capabilities of the electronic device by providing for information or software downloads to the electronic device other than through the wireless network . The alternate download path may for example be used to load an encryption key onto the electronic device through a direct reliable and trusted connection to thereby provide secure device communication.

In some example embodiments the electronic device is provided with a service routing application programming interface API which provides an application with the ability to route traffic through a serial data i.e. USB or BLUETOOTH BLUETOOTH is a registered trademark of Bluetooth SIG Inc. connection to the host computer system using standard connectivity protocols. When a user connects their electronic device to the host computer system via a USB cable or BLUETOOTH connection traffic that was destined for the wireless network is automatically routed to the electronic device using the USB cable or BLUETOOTH connection. Similarly any traffic destined for the wireless network is automatically sent over the USB cable BLUETOOTH connection to the host computer for processing.

The electronic device also includes a battery as a power source which is typically one or more rechargeable batteries that may be charged for example through charging circuitry coupled to a battery interface such as the serial data port . The battery provides electrical power to at least some of the electrical circuitry in the electronic device and the battery interface provides a mechanical and electrical connection for the battery . The battery interface is coupled to a regulator not shown which provides power V to the circuitry of the electronic device .

The short range communication module provides for communication between the electronic device and different systems or devices which need not necessarily be similar devices. For example the short range communication module may include an infrared device and associated circuits and components or a wireless bus protocol compliant communication mechanism such as a Bluetooth communication module to provide for communication with similarly enabled systems and devices.

The electronic device includes a gyroscope which is configured to sense rotation of the electronic device . The gyroscope may in at least some embodiments be a three axis gyroscope of the type described above with reference to . The electronic device also includes an accelerometer and or a magnetometer which may be of the types described above with reference to .

A predetermined set of applications that control basic device operations including data and possibly voice communication applications may be installed on the electronic device during or after manufacture. Additional applications and or upgrades to an operating system or software applications may also be loaded onto the electronic device through the wireless network the auxiliary I O subsystem the data port the short range communication module or other suitable device subsystems . The downloaded programs or code modules may be permanently installed for example written into the program memory e.g. the flash memory or written into and executed from the RAM for execution by the processor at runtime.

In some example embodiments the electronic device may provide two principal modes of communication a data communication mode and a voice communication mode. In the data communication mode a received data signal such as a text message an email message or webpage download will be processed by the communication subsystem and input to the processor for further processing. For example a downloaded webpage may be further processed by a web browser or an email message may be processed by the email messaging application and output to the display . A user of the electronic device may also compose data items such as email messages for example using an input interface in conjunction with the display . These composed items may be transmitted through the communication subsystem over the wireless network .

In the voice communication mode the electronic device provides telephony functions and may operate as a typical cellular phone. The overall operation is similar to the data communication mode except that the received signals would be output to the speaker and signals for transmission would be generated by a transducer such as the microphone . The telephony functions are provided by a combination of software firmware i.e. a voice communication module and hardware i.e. the microphone the speaker and input devices . Alternative voice or audio I O subsystems such as a voice message recording subsystem may also be implemented on the electronic device . Although voice or audio signal output may be accomplished primarily through the speaker the display may also be used to provide an indication of the identity of a calling party duration of a voice call or other voice call related information.

The processor operates under stored program control and executes software modules stored in memory such as persistent memory for example in the flash memory . As illustrated in the software modules may include operating system software and one or more additional applications or modules such as for example an orientation determination application .

In the example embodiment of the orientation determination application is illustrated as being implemented as a stand alone application . However in other example embodiments the orientation determination could be provided by another application or module such as for example the operating system software . Furthermore while the orientation determination application is illustrated with a single block the functions or features provided by the orientation determination application could in at least some embodiments be divided up and implemented by a plurality of applications and or modules.

Furthermore while in the example embodiment of the orientation determination application is illustrated as being associated with the main processor of the electronic device in other embodiments the orientation determination application could be associated with another processor or group of processors. For example in some embodiments the gyroscope accelerometer and or magnetometer may include or be connected to a secondary processor. The secondary processor may provide a narrow set of functions or features and may be used to offload some processing from the main processor . For example in some embodiments the secondary processor is a sensor specific processor which is configured to provide sensor related functions such as those provided by the orientation determination application . For example the secondary processor may be configured to determine an orientation of the electronic device.

The orientation determination application is in at least some embodiments configured to determine a corrected orientation for the electronic device . The corrected orientation is an orientation which accounts for gyroscope saturation. The orientation determination application may be configured to determine the orientation in the manner described below with reference to .

Accordingly further functions and features of the orientation determination application will be described in greater detail below with reference to .

The electronic device may include a range of additional software applications including for example a notepad application voice communication i.e. telephony application mapping application a media player application or any combination thereof. Each of the software applications may include layout information defining the placement of particular fields and graphic elements e.g. text fields input fields icons etc. in the user interface i.e. the display according to the application.

The software modules or parts thereof may be temporarily loaded into volatile memory such as the RAM . The RAM is used for storing runtime data variables and other types of data or information. Although specific functions are described for various types of memory this is merely one example and a different assignment of functions to types of memory could also be used.

In the description which follows reference will be made to which illustrates in flowchart form a method of determining a corrected orientation of a gyroscope on an electronic device . The method may include features which may be provided by an electronic device such as the electronic device of . For example one or more applications or modules associated with an electronic device such as the orientation determination application may contain processor readable instructions for causing a processor associated with the electronic device to perform the method of . That is in at least some example embodiments the electronic device may be configured to perform the method . For example the method may be implemented by a processor of an electronic device .

In at least some embodiments one or more of the functions or features of one or the method may be performed in whole or in part by another system software application module component or device apart from those specifically listed above. For example in some embodiments the method may be performed by a processor associated with the gyroscope the accelerometer and or the magnetometer . That is in at least some embodiments the method or a portion thereof may be performed by a processor other than the main processor the electronic device . For example a separate processor may be configured for the specific purpose of performing the method or a portion thereof.

At a gyroscope reading is obtained from the gyroscope . In at least some embodiments gyroscope readings for each axis of the gyroscope may be obtained. For example a gyroscope reading wmay be obtained from the gyroscope based on gyroscope measurements associated with the x sensing axis such as a rotation about the x sensing axis a gyroscope reading wmay be obtained from the gyroscope based on gyroscope measurements associated with the y sensing axis such as a rotation about the y sensing axis and a gyroscope reading wmay be obtained from the gyroscope based on gyroscope measurements associated with the z sensing axis such as a rotation about the z sensing axis .

Similarly at an accelerometer reading is obtained from the accelerometer . In at least some embodiments accelerometer readings for each axis of the accelerometer may be obtained at . For example an accelerometer reading amay obtained from the accelerometer based on accelerometer measurements associated with the x sensing axis such as an acceleration along the x sensing axis an accelerometer reading amay be obtained from the accelerometer based on accelerometer measurements associated with the y sensing axis such as an acceleration along the y sensing axis and an accelerometer reading amay be obtained from the accelerometer based on accelerometer measurements associated with the z sensing axis such as an acceleration along the z sensing axis .

Similarly at a magnetometer reading may be obtained from the magnetometer . In at least some embodiments magnetometer readings for each axis of the magnetometer may be obtained at . For example a magnetometer reading mmay be obtained from the magnetometer based on magnetometer measurements associated with the x sensing axis such as a magnetic field along the x sensing axis a magnetometer reading mmay be obtained from the magnetometer based on magnetometer measurements associated with the y sensing axis such as a magnetic field along the y sensing axis and a magnetometer reading mmay be obtained from the magnetometer based on magnetometer measurements associated with the z sensing axis such as a magnetic field along the z sensing axis .

While operations and have been illustrated in to occur sequentially in other embodiments these operations may be performed in another order. For example in some embodiments any two or more of these operations may be performed in parallel so that the electronic device is in the same orientation or approximately the same orientation when the measurements are obtained. For example in some embodiments the gyroscope magnetometer and accelerometer may be sampled at the same time.

At a first orientation estimate is determined based on the gyroscope readings obtained at and based on an orientation reference point such as a past corrected orientation . The past corrected orientation may be an orientation estimate for the electronic device which was previously determined. The past corrected orientation may have been previously corrected for gyroscope saturation and or other sources of errors. The past corrected orientation may in at least some embodiments be retrieved from memory at and used to determine the first orientation estimate. As will be described in greater detail below with reference to operation the past corrected orientation may have been saved during a previous iteration of the method .

Accordingly the past corrected orientation may be used to allow the electronic device to determine an orientation of the electronic device from the gyroscope readings obtained from the gyroscope . That is the past corrected orientation may serve as a reference point for determining orientation from the gyroscope readings. Gyroscope readings may not taken alone provide the electronic device with enough information to determine the electronic device s orientation. However gyroscope readings when coupled with a reference point such as the past corrected orientation may provide the electronic device with information which allows the electronic device to determine the first orientation estimate.

The first orientation estimate may in some circumstances suffer from an error due at least in part to the effects of gyroscope saturation. When the electronic device is rotating relatively slowly the first orientation estimate may be an accurate representation of the orientation of the electronic device . However if the electronic device is rotated more rapidly the gyroscope may become saturated. Saturation occurs when the electronic device is rotated outside of the operating range of the gyroscope . That is saturation occurs when the electronic device is rotated at a rate at which the gyroscope is unable to accurately measure the rate of rotation. Thus in at least some circumstances the first orientation estimate may suffer from an error due at least in part to the saturation of the gyroscope . As will now be described the method includes operations to which may be used to account for saturation of the gyroscope to obtain a corrected orientation.

In at least some embodiments at the electronic device may determine a second orientation estimate. The second orientation estimate is in at least some embodiments determined without using the gyroscope readings. That is the second orientation estimate may be determined based on other information such as information obtained from one or more other sensors. In the example embodiment of the second orientation estimate is determined based on one or more accelerometer readings obtained at and also based on one or more magnetometer readings obtained at . The second orientation estimate may provide a good measure of the orientation of the electronic device when the electronic device is rotating rapidly.

In at least some embodiments at the electronic device may determine whether the gyroscope was saturated when the gyroscope readings were obtained. That is the electronic device may determine whether the gyroscope readings obtained at indicate that the gyroscope was saturated. In at least some embodiments at the electronic device may compare the gyroscope readings obtained to a gyroscope saturation value which reflects the saturation output for the gyroscope. The gyroscope saturation value is in at least some embodiments retrieved from memory.

In some embodiments when the gyroscope is saturated the gyroscope may generate an output which may be referred to as a saturated output. The saturated output may be a common output which is produced irrespective of the degree to which the gyroscope is saturated. That is whenever the gyroscope is saturated it may always produce an output which indicates that it is saturated such as an output which corresponds to the stored gyroscope saturation value . If the gyroscope is rotating at a rate which is slightly above its operating range it may produce the same saturated output which is produced when the gyroscope is rotating at a rate which is well above its operating range. In at least some embodiments the saturated output may be stored in memory as the gyroscope saturation value.

In at least some embodiments at the electronic device determines whether the gyroscope reading equals and or exceeds the gyroscope saturation value. If so then the electronic device may determine that the gyroscope is saturated.

The gyroscope saturation value may in some embodiments be static. In some embodiments the gyroscope saturation value may be stored based on specific operating characteristics of the gyroscope .

In other embodiments the electronic device may be configured to dynamically determine the gyroscope saturation value. In some embodiments the saturated output may be the highest output that the gyroscope generates. That is the saturated output may be the highest gyroscope reading generated by the gyroscope . The highest gyroscope reading may be stored as the gyroscope saturation value. That is the electronic device may determine whether a current gyroscope reading exceeds a stored gyroscope saturation value and if the gyroscope reading exceeds the gyroscope saturation value the electronic device may replace the gyroscope saturation value with the gyroscope reading so that the gyroscope reading becomes the new gyroscope saturation value. Over time the gyroscope saturation value will converge on the correct saturated output.

The evaluation as to whether the gyroscope reading represents the saturation output may in at least some embodiments be performed on a per axis basis. For example the electronic device may store the highest reading observed for each axis and may determine whether the gyroscope is saturated by comparing the current gyroscope reading for each axis to the highest reading observed for that axis.

At the electronic device adjusts a saturation correction learning rate for the gyroscope based on the result of the determination of whether the gyroscope was saturated. The saturation correction learning rate controls a rate of correction which will be used to correct the first orientation estimate. That is the saturation correction learning rate is a parameter which controls how quickly the electronic device will correct the first orientation estimate. In at least some embodiments a relatively higher saturation correction learning rate results in a greater amount of correction than a relatively lower saturation correction learning rate.

In at least some embodiments the saturation correction learning rate balances the relative importance of the first orientation estimate and the second orientation estimate when determining a corrected orientation. In at least some embodiments a relatively higher saturation correction learning rate indicates greater importance of the second orientation estimate and lesser importance of the first orientation estimate than would be indicated by a relatively lower saturation correction learning rate. That is a higher saturation correction learning rate indicates that the orientation estimate determined based on the gyroscope readings should be given less weight when determining the corrected orientation than the weight given when there is a lower saturation correction learning rate.

Similarly in at least some embodiments a relatively lower saturation correction learning rate indicates greater importance of the first orientation estimate and lesser importance of the second orientation estimate than would be indicated by a relatively higher saturation correction learning rate. That is a lower saturation correction learning rate indicates that the orientation estimate determined based on the gyroscope readings should be given greater weight when determining the corrected orientation than the weight given when there is a higher saturation correction learning rate.

The saturation correction learning rate may in at least some embodiments be adjusted using a previously determined saturation correction learning rate as a starting point. For example the electronic device may retrieve from memory a saturation correction learning rate which was determined during a previous iteration of the method . The electronic device may then adjust this saturation correction learning rate . The nature of the adjustment depends on the result of the determination at regarding whether the gyroscope is saturated. Operation will be described in greater detail below with reference to .

The saturation correction learning rate may at be stored in memory of the electronic device . The stored saturation correction learning rate may be used in a subsequent iteration of the method at when adjusting the saturation correction learning rate. That is the stored saturation correction learning rate may provide a starting point for the saturation correction learning rate during the next iteration of the method and may be further adjusted at during the next iteration of the method .

In at least some embodiments at the electronic device determines an orientation error. The orientation error may be determined as the difference between the first orientation estimate and the second orientation estimate. That is the orientation error may indicate the amount by which the first orientation estimate and the second orientation estimate differ.

In at least some embodiments at a saturation correction adjustment amount may be determined based on the orientation error and the saturation correction learning rate. In at least some embodiments the saturation correction adjustment amount may be determined as the product of the orientation error and the saturation correction learning rate.

At a corrected orientation is determined. The corrected orientation is determined based on the first orientation estimate from and also based on the saturation correction learning rate which was obtained from the adjustment of . In at least some embodiments the corrected orientation is determined by using the saturation correction learning rate to balance a relative importance of the second orientation estimate and the first orientation estimate. That is the saturation correction learning rate is used to control the relative effect of the first orientation estimate with the second orientation estimate when determining the corrected orientation.

In at least some embodiments the relative importance of the second orientation estimate and the first orientation estimate may be balanced by determining the corrected orientation based on the saturation correction adjustment amount which was determined at . That is since the saturation correction adjustment amount is determined based on the first orientation estimate the second orientation estimate and also the saturation correction learning rate the saturation correction adjustment amount strikes a balance between the first orientation estimate and the second orientation estimate using the saturation correction learning rate. That is a higher saturation correction learning rate will result in a higher saturation correction adjustment amount. Similarly a lower saturation correction learning rate will result in a relatively lower saturation correction adjustment amount. In some embodiments the corrected orientation may be determined by adding the saturation correction adjustment amount to the first orientation estimate. Thus by using the saturation correction adjustment amount to determine the corrected orientation the corrected orientation strikes a suitable balance between the first orientation estimate and the second orientation estimate.

It will be appreciated that in at least some embodiments some of the intermediate steps of the method may be omitted. For example rather than determining the orientation error at and the saturation correction adjustment amount at the electronic device could instead perform analogous operations at when determining the corrected orientation. For example at rather than calculating the corrected orientation based on the saturation correction adjustment amount and the first orientation estimate the electronic device could determine the corrected orientation based on the first orientation estimate the second orientation estimate and the saturation correction learning rate. Accordingly one or more of the intermediate determination steps of the method could effectively be performed at .

In at least some embodiments at the corrected orientation may be stored in memory and may be designated as a past corrected orientation for a future iteration of the method . That is the corrected orientation may be used in a subsequent iteration of the method to determine a future first orientation estimate at of a future iteration of the method .

The method may be repeated. That is further iterations of the method may be performed. In a subsequent iteration of the method the electronic device may rely on one or more values obtained during the iteration of the method discussed above. For example as noted above the corrected orientation which was stored during this iteration of the method may be subsequently used as a reference point when calculating the first orientation estimate in a future iteration of the method . Similarly the saturation correction learning rate which was stored during this iteration of the method may be subsequently used as a starting point when determining a saturation correction learning rate during the future iteration of the method .

Accordingly a subsequent gyroscope reading which may be referred to as a second gyroscope reading may be obtained during the next iteration of the method . During this next iteration of the method the saturation correction learning rate may be further adjusted based on a determination regarding whether the gyroscope was saturated when the second gyroscope reading was obtained.

Since information such as the saturation correction learning rate is passed between iterations of the method if the gyroscope was saturated during two sequential iterations of the method then the saturation correction learning rate may be increased during the first iteration of the method and then further increased during the second iteration of the method . As a result the saturation correction learning rate is related to the duration of a period of saturation. Thus for the purposes of determining a corrected orientation as the period of saturation grows the relative importance of the second orientation estimate is increased and the relative importance of the first orientation estimate is decreased.

Referring now to operation of and its relation to the result from of will be discussed in greater detail. That is illustrates the adjustment of the saturation correction learning rate based on the determination at regarding whether the gyroscope is saturated.

At the electronic device determines whether the gyroscope was saturated in the manner described above with reference to .

At the electronic device adjusts the saturation correction learning rate based on the determination regarding whether the gyroscope is saturated. At the saturation correction learning rate may be increased at or decreased at .

If at the electronic device determines that the gyroscope is saturated then at the saturation correction learning rate may be increased. In at least some embodiments the saturation correction learning rate may be increased by a fixed predetermined amount.

In at least some embodiments the saturation correction learning rate may be constrained by a predetermined upper threshold. That is the saturation correction learning rate may only be increased so that the saturation correction learning rate is beneath a predetermined upper threshold. When the saturation correction learning rate reaches the upper threshold no further upward adjustments are permitted. In some embodiments the upper threshold is one.

If at the electronic device determines that the gyroscope is not saturated then at the saturation correction learning rate may be decreased. In at least some embodiments the saturation correction learning rate may be decreased by a fixed predetermined amount. The fixed predetermined amount may in some embodiments be the same fixed predetermined amount used in when increasing the saturation correction learning rate. However in other embodiments the amount may be different than the amount used in .

In at least some embodiments the saturation correction learning rate may be constrained by a predetermined lower threshold. That is the saturation correction learning rate may only be decreased so that the saturation correction learning rate is above a predetermined lower threshold. When the saturation correction learning rate reaches the lower threshold no further downward adjustments are permitted. In some embodiments the lower threshold is zero.

While the present disclosure is primarily described in terms of methods a person of ordinary skill in the art will understand that the present disclosure is also directed to various apparatus such as a handheld electronic device including components for performing at least some of the aspects and features of the described methods be it by way of hardware components software or any combination of the two or in any other manner. Moreover an article of manufacture for use with the apparatus such as a pre recorded storage device or other similar computer readable storage medium including program instructions recorded thereon which may for example cause a processor to perform one or more of the methods described herein or a computer data signal carrying computer readable program instructions may direct an apparatus to facilitate the practice of the described methods. It is understood that such apparatus articles of manufacture and computer data signals also come within the scope of the present disclosure.

The term computer readable storage medium as used herein means any medium which can store instructions for use by or execution by a computer or other computing device including but not limited to a portable computer diskette a hard disk drive HDD a random access memory RAM a read only memory ROM an erasable programmable read only memory EPROM or flash memory an optical disc such as a Compact Disc CD Digital Versatile Video Disc DVD or BLU RAY Disc and a solid state storage device e.g. NAND flash or synchronous dynamic RAM SDRAM .

The embodiments of the present disclosure described above are intended to be examples only. Those of skill in the art may effect alterations modifications and variations to the particular embodiments without departing from the intended scope of the present disclosure. In particular features from one or more of the above described embodiments may be selected to create alternate embodiments comprised of a sub combination of features which may not be explicitly described above. In addition features from one or more of the above described embodiments may be selected and combined to create alternate embodiments comprised of a combination of features which may not be explicitly described above. Features suitable for such combinations and sub combinations would be readily apparent to persons skilled in the art upon review of the present disclosure as a whole. The subject matter described herein and in the recited claims intends to cover and embrace all suitable changes in technology.

