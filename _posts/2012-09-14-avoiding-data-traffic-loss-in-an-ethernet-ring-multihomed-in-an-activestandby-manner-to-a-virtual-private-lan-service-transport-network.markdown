---

title: Avoiding data traffic loss in an ethernet ring multihomed, in an active-standby manner, to a virtual private LAN service transport network
abstract: Data traffic loss in a an Ethernet Ring that is multihomed, in an active-standby manner, to a VPLS transport network (such as a Border Gateway Protocol (BGP) multihomed Ethernet Ring, an MC-LAG multihomed Ethernet Ring, or some other type of active-standby multihomed Ethernet Ring, etc.) (ring) is avoided. The exemplary multihomed ring running Ethernet Ring Protection (ERP) protocol includes a Ring Protection Link (RPL), a first node and a second node linked with a designated border router and a standby border router of the network, respectively. The data traffic loss in the multihomed ring is avoided by (i) receiving an indication that the link between the first node and the designated border router has failed; and (ii) invoking, responsive to the received indication, an ERP Media Access Control (MAC)-flush in the ring, even in the absence of a failed link in the ring and without activating the specified RPL. The ERP MAC-flush causes subsequent data packets from each of the plurality of nodes in the ring to be forwarded to the standby border router via the second node.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09264348&OS=09264348&RS=09264348
owner: Juniper Networks, Inc.
number: 09264348
owner_city: Sunnyvale
owner_country: US
publication_date: 20120914
---
The present invention concerns avoiding data traffic loss in an Ethernet Ring multihomed in an active standby manner to a virtual private LAN service VPLS transport network. Thus the present invention may be used for example to prevent data losses in Border Gateway Protocol BGP multihomed Ethernet Rings multi chassis lag MC LAG multihomed Ethernet Rings and other types of active standby multihomed Ethernet Rings.

Link failure may often be an unavoidable part of networking. However there are techniques for improving the reliability of a router or bridge network even when link failures occur. For example SONET SDH seal healing rings may be used to add a level of robustness to communications networks. Such ring protection switching has been extended to Ethernet links. Ethernet Ring Protection ERP may be configured for a series of two or more systems so that if one link fails traffic is rerouted around the failure on the Ethernet Ring ring . ERP switching architectures avoid loops and use learning forwarding and Filtering Database FDB mechanisms. Each of these aspects of ERP switching architectures are introduced below.

Loop avoidance in the ring may be achieved by permitting data traffic flow on all but one of the links in the ring at any point in time. The particular link avoided may be referred to as the Ring Protection Link RPL . Under normal conditions this RPL may be blocked or otherwise disabled i.e. not used for data traffic . A designated ring node referred to as the RPL Owner Node may be responsible for blocking traffic through the RPL under normal conditions. Under a ring failure condition the RPL Owner Node is responsible for unblocking i.e. activating the RPL unless the RPL has failed allowing the RPL to be used for data traffic.

Thus ERP uses one specific link for example the RPL to protect the whole ring. As illustrated in the example Ethernet Ring includes an RPL to protect it. When all links in the ring are up and active data traffic through the RPL is blocked. Therefore the RPL remains idle. Referring to although the physical topology of the Ethernet Ring includes a physical RPL in the logical topology of Ethernet Ring the RPL is not seen between Node 2 and the RPL Owner node . illustrates the condition of the RPL being idle under which no data traffic is allowed to pass through the RPL. In this example the RPL is controlled by a designated RPL owner node . The RPL owner node may be responsible for blocking the RPL under normal operating conditions.

Referring to if a link failure occurs on the ring e.g. if the link between Nodes 4 and 5 fails the RPL owner node automatically protects the ring by unblocking the RPL so that the data traffic can be forwarded on an alternate path around the ring. For example as shown in logical topology of Ethernet Ring in when the link between Node 4 and Node 5 fails the RPL is activated by the RPL Owner node and data traffic is allowed to pass through the RPL . If the link between Node 4 and Node 5 recovers from failure the RPL owner node may responsive to this recovery revert the ring to the normal condition Recall logical topology of . by deactivating the RPL and blocking the data traffic through the RPL .

Enhanced ring protection ERP works on the basis of a filtering data base FDB flush. More specifically upon protection switching for a failure or a failure recovery that is when the ring switches from normal condition to failure condition or vice versa all nodes of the ring remove all learned Media Access Control MAC addresses in their FDBs for a changed ring topology. Then each ring node of the ring may broadcast data frames until MAC address learning of nodes of a newly configured ring is completed.

 Multihoming is a technique used to increase the reliability of an Internet connection for an IP network. There are various techniques that provide active standby multihoming of an Ethernet Ring to a VPLS transport network. As one example Border Gateway Protocol BGP multihoming enables a customer site to be connected with a service provider network via two or more peer Provider Edge PE routers for example border routers running BGP . Multi Chassis Lag MC LAG is another example of a VPLS multihoming technique that provides Active Standby multihoming. In either case or in some other type active standby multihoming of an Ethernet Ring to a transport network the service provider may be a network that provides Virtual Private LAN Service VPLS for example. Connecting the customer site to two or more Provider Edge PE routers provides redundant connectivity that maintains the VPLS and traffic forwarding to and from the multihomed site in the event of PE router to Consumer Edge CE device link failure the failure of a PE router the failure of a CE device or a Multi Protocol Label Switching MPLS reachability failure between a local PE router and a remote PE router. A redundant backup CE device to PE edge router path may begin providing service to the customer site responsive to the detection of one of the foregoing failures.

 1.2.3 Challenges Protecting Network Communications when an Ethernet Protection Ring Uses Multihoming

Referring to consider an architecture in which a customer site accesses PE routers and via CE routers CE 1 and CE 2 that are arranged in an Ethernet Protection Ring topology . More specifically in the example architecture the customer site may be multihomed by connecting one of the CE routers e.g. CE 1 referred to as a first node in the Ethernet Ring to a primary PE router e.g. PE 1 and another one of the CE routers e.g. CE 2 referred to as a second node to a standby PE router e.g. PE 2 . Under such an arrangement a failure of the link between the primary PE router and the first node CE router CE 1 PE 1 will not cause the Ethernet Ring to switch to a mode in which a protection link is activated because there is no failure sensed in the Ethernet Ring. As an unfortunate consequence the Ethernet Ring likely will not forward the data traffic to the second CE router which is connected to the standby PE router PE 2 . This may cause black holing of the data packets sent to the primary PE router. That is the data packets may be lost or dropped without the sender knowing.

In view of the foregoing it would be useful to extend ERP to an Ethernet Ring that is multihomed in an active standby manner to a VPLS transport network such as to a BGP multihomed Ethernet Ring an MC LAG multihomed Ethernet Ring or some other type of active standby multihomed Ethernet Ring etc. that protects both the Ethernet Ring and the connection to the service provider e.g. providing a VPLS thereby avoiding data traffic loss in the multihomed Ethernet Ring.

Exemplary embodiments consistent with the present invention extend Ethernet Ring Protection ERP to an Ethernet Ring that is multihomed in an active standby manner to a VPLS transport network such as a Border Gateway Protocol BGP multihomed Ethernet Ring an MC LAG multihomed Ethernet Ring or some other type of active standby multihomed Ethernet Ring etc. such that data traffic loss in the multihomed Ethernet Ring is avoided. Such exemplary embodiments may avoid data traffic loss in the multihomed Ethernet Ring running an Ethernet Ring Protection ERP protocol including a specified Ring Protection Link RPL in which a first node of the Ethernet Ring in a first portion of a network is linked with a designated border router of a second portion of the network and in which a second node of the Ethernet Ring in the first portion of the network is linked with a standby border router of the second portion of the network by i receiving an indication that the link between the first node and the designated border router of the network has failed and ii invoking responsive to the received indication an ERP Media Access Control MAC flush in the Ethernet Ring even in the absence of a failed link in the Ethernet Ring and without activating the specified RPL.

In at least some example embodiments consistent with the present invention the ERP MAC flush causes subsequent data packets from each of the plurality of nodes in the Ethernet Ring to be forwarded to the standby border router via the second node.

In at least some example embodiments consistent with the present invention each of the plurality of nodes in the Ethernet Ring is a router.

In at least some exemplary embodiments consistent with the present invention the first portion of the network is an access portion of a transport network and the second portion of the network is a core portion of the transport network. In at least some example embodiments consistent with the present invention the core portion of the transport network provides a Virtual Private Local Area Network Service VPLS to a customer that accesses the access network via a node of the Ethernet Ring.

The present invention may involve novel methods apparatus message formats and or data structures for extending Ethernet Ring Protection ERP to a an Ethernet Ring that is multihomed in an active standby manner to a VPLS transport network such as to a Border Gateway Protocol BGP multihomed Ethernet Ring to an MC LAG multihomed Ethernet Ring or to some other type of active standby multihomed Ethernet Ring etc. ring to avoid traffic loss in the multihomed ring. The following description is presented to enable one skilled in the art to make and use the invention and is provided in the context of particular applications and their requirements. Thus the following description of embodiments consistent with the present invention provides illustration and description but is not intended to be exhaustive or to limit the present invention to the precise form disclosed. Various modifications to the disclosed embodiments will be apparent to those skilled in the art and the general principles set forth below may be applied to other embodiments and applications. For example although a series of acts may be described with reference to a flow diagram the order of acts may differ in other implementations when the performance of one act is not dependent on the completion of another act. Further non dependent acts may be performed in parallel. No element act or instruction used in the description should be construed as critical or essential to the present invention unless explicitly described as such. Also as used herein the article a is intended to include one or more items. Where only one item is intended the term one or similar language is used. Thus the present invention is not intended to be limited to the embodiments shown and the inventors regard their invention as any patentable subject matter described.

In the environment the border router PE 1 may be a designated border router and PE 2 may be a standby border router. The customer site obtains access to the service provider network through the designated border router PE 1 . In an example embodiment consistent with the present invention if the customer cannot access the service provider network through designated border PE 1 for example due to a failure of designated border router PE 1 or a failure of the link between Ethernet Ring and designated border router PE 1 or a failure of the customer device CE 1 etc. the customer site may gain access to the service provider network through standby border router PE 2 . Thus in the example arrangement the customer site may obtain access to the service provider network either through designated border PE 1 or standby border router PE 2 .

In the environment the multihomed Ethernet Ring includes a plurality of Customer Edge CE devices CE 1 to CE 6 as nodes of the Ethernet Ring . In an example embodiment consistent with the present invention each of the CE devices may be a router. The multihomed Ethernet Ring may be connected to two or more border routers of the service provider network via different nodes of the Ethernet Ring . In the example environment the multihomed Ethernet Ring is connected to the designated border router PE 1 via node CE 1 and to the standby border router PE 2 via node CE 2. In the example environment under a normal condition that is for example when all the links and nodes between customer site and PE 1 are active and are working customer site may obtain access to the service provider network through the designated border router PE 1 via the node CE 1 of the Ethernet Ring . In the example environment under a failure condition that is for example when a link between the Ethernet Ring and designated border router PE 1 has failed or when the designated border router PE 1 has failed customer site may obtain access to the service provider network through the standby border router PE 2 via the node CE 2 of the Ethernet Ring .

Sometimes in multihomed network sites a single node may be connected to two or more border routers that provide access to the service provider network. However in such an architecture the single node which connects to two or more border routers would act as a single point of failure. That is if the node which is connecting to two or more border routers fails access to the service provider network might not be possible through any of the border routers since they are all connected to the failed node. By contrast in the above exemplary multihomed Ethernet Ring two different nodes of the Ethernet Ring are connected to two or more border routers. For example node CE 1 is connected to the designated border router PE 1 while another node CE 2 is connected to the standby border router PE2 . Such an architecture of the multihomed Ethernet Ring avoids a situation in which a single node in the ring connected to two or more border routers can become a single point of failure.

Naturally the example environment may also include additional customer sites customer site 2 to customer site n . The customer sites may be connected to a corresponding border router in various ways. For example in the customer site 2 is connected to the border router PE 3 via single homed Ethernet Ring while customer site n is connected to the border router PE n via a direct link. Further in an example embodiment consistent with the present invention each of the customer sites may communicate with each other via a VPLS supported by the service provider network .

In the exemplary environment the multihomed Ethernet Ring may run the ERP protocol. The ERP protocol as described above 1.2.1 protects the ring in case of a link failure in the ring by rerouting data traffic around the failure on the ring. However the ERP may not protect the ring against failure of links outside of the ring. For example in the environment the ERP may not protect communications between the multihomed Ethernet Ring and the service provider network if a link between the node CE 1 and designated border router PE1 fails or if one or both of the peer devices fail . Such a scenario might cause data packets sent to the designated border router PE 1 to be lost for example at node CE 1. More specifically the ERP running in the Ethernet Ring might not be aware of the failure of the link between the node CE 1 and designated border router PE 1 unless the peer device CE 1 itself fails . Consequently the Ethernet Ring might continue to forward the data packets to node CE1 to be transmitted to the designated border router PE1 .

The above problem of data packet loss may be solved by sending the data packets to the service provider network via the standby border router PE 2 instead of the designated border router PE 1 . The data packets may be sent to the standby router PE 2 by rerouting in the Ethernet Ring the data packets to node CE 2 which connects to the standby router PE 2 . In an example Ethernet Ring running ERP data packets may be rerouted to new nodes by performing an ERP Media Access Control MAC flush. The ERP MAC flush causes all ring nodes to remove learned layer 2 MAC addresses in their database tables for a changed ring topology and learn new layer 2 MAC addresses of the nodes to which the data packets have to be forwarded. However in an example Ethernet Ring the ERP MAC flush is typically invoked when there is a link failure or failure recovery within the ring but not when the link failure is outside the protected ring. Further the ERP MAC flush is invoked as part of protection switching in the Ethernet Ring which also includes activating a Ring Protection Link RPL in the ring in order to route data packets around the link failure in the ring. So to reroute the data packets in a scenario where the link failure is outside the Ethernet Ring for example between the node CE 1 and designated border router PE 1 in the environment the ERP MAC flush may have to be explicitly invoked in the Ethernet Ring while the RPL remains inactive.

Referring back to block responsive to received indication that the link between the first node of the Ethernet Ring and the designated border router has failed a message containing instructions to invoke an ERP MAC flush may be generated. In an exemplary embodiment consistent with the present invention the ERP MAC flush command causes each of the plurality of nodes of the Ethernet Ring to 1 remove all the MAC addresses of the nodes corresponding to the previous forwarding route and 2 store the MAC addresses of the nodes corresponding to the new forwarding path which forwards data packets to the standby designated router via the second node of the Ethernet Ring. Still referring back to block the specified RPL of the Ethernet Ring is not activated when the ERP MAC flush is invoked since there is no link failure within the Ethernet Ring .

As just discussed above and referring to some example routers include a control component e.g. routing engine and a packet forwarding component e.g. a packet forwarding engine .

The control component may include an operating system OS kernel routing protocol process es label based forwarding protocol process es interface process es user interface e.g. command line interface process es and chassis process es and may store routing table s label forwarding information and forwarding e.g. route based and or label based table s . As shown the routing protocol process es may support routing protocols such as the routing information protocol RIP the intermediate system to intermediate system protocol IS IS the open shortest path first protocol OSPF the enhanced interior gateway routing protocol EIGRP and the boarder gateway protocol BGP and the label based forwarding protocol process es may support protocols such as BGP the label distribution protocol LDP and the resource reservation protocol RSVP . One or more components not shown may permit a user to interact with the user interface process es . Similarly one or more components not shown may permit an external device to interact with one or more of the router protocol process es the label based forwarding protocol process es the interface process es and the chassis process es via SNMP and such processes may send information to an external device via SNMP .

The packet forwarding component may include a microkernel interface process es distributed ASICs chassis process es and forwarding e.g. route based and or label based table s .

In the example router of the control component handles tasks such as performing routing protocols performing label based forwarding protocols control packet processing etc. which frees the packet forwarding component to forward received packets quickly. That is received control packets e.g. routing protocol packets and or label based forwarding protocol packets are not fully processed on the packet forwarding component itself but are passed to the control component thereby reducing the amount of work that the packet forwarding component has to do and freeing it to process packets to be forwarded efficiently. Thus the control component is primarily responsible for running routing protocols and or label based forwarding protocols maintaining the routing tables and or label forwarding information sending forwarding table updates to the packet forwarding component and performing system management. The example control component may handle routing protocol packets provide a management interface provide configuration management perform accounting and provide alarms. The processes and may be modular and may interact with the OS kernel . That is nearly all of the processes communicate directly with the OS kernel . Using modular software that cleanly separates processes from each other isolates problems of a given process so that such problems do not impact other processes that may be running. Additionally using modular software facilitates easier scaling.

Still referring to the example OS kernel may incorporate an application programming interface API system for external program calls and scripting capabilities. The control component may be based on an Intel PCI platform running the OS from flash memory with an alternate copy stored on the router s hard disk. The OS kernel is layered on the Intel PCI platform and establishes communication between the Intel PCI platform and processes of the control component . The OS kernel also ensures that the forwarding tables in use by the packet forwarding component are in sync with those in the control component . Thus in addition to providing the underlying infrastructure to control component software processes the OS kernel also provides a link between the control component and the packet forwarding component .

Referring to the routing protocol process es of this process es provides routing and routing control functions within the platform. In this example the RIP ISIS OSPF and EIGRP and BGP protocols are provided. Naturally other routing protocols may be provided in addition or alternatively. Similarly the label based forwarding protocol process es provides label forwarding and label control functions. In this example the LDP and RSVP and BGP protocols are provided. Naturally other label based forwarding protocols e.g. MPLS may be provided in addition or alternatively. In the example router the routing table s is produced by the routing protocol process es while the label forwarding information is produced by the label based forwarding protocol process es .

Still referring to the interface process es performs configuration of the physical interfaces Recall e.g. and of . and encapsulation.

The example control component may provide several ways to manage the router. For example it may provide a user interface process es which allows a system operator to interact with the system through configuration modifications and monitoring. The SNMP allows SNMP capable systems to communicate with the router platform. This also allows the platform to provide necessary SNMP information to external agents. For example the SNMP may permit management of the system from a network management station running software such as Hewlett Packard s Network Node Manager HP NNM through a framework such as Hewlett Packard s OpenView. Accounting of packets generally referred to as traffic statistics may be performed by the control component thereby avoiding slowing traffic forwarding by the packet forwarding component .

Although not shown the example router may provide for out of band management RS 232 DB9 ports for serial console and remote management access and tertiary storage using a removable PC card. Further although not shown a craft interface positioned on the front of the chassis provides an external view into the internal workings of the router. It can be used as a troubleshooting tool a monitoring tool or both. The craft interface may include LED indicators alarm indicators control component ports and or a display screen. Finally the craft interface may provides interaction with a command line interface CLI via a console port an auxiliary port and or a management Ethernet port

The packet forwarding component is responsible for properly outputting received packets as quickly as possible. If there is no entry in the forwarding table for a given destination or a given label and the packet forwarding component cannot perform forwarding by itself it may send the packets bound for that unknown destination off to the control component for processing. The example packet forwarding component is designed to perform Layer 2 and Layer 3 switching route lookups and rapid packet forwarding.

As shown in the example packet forwarding component has an embedded microkernel interface process es distributed ASICs and chassis process es and stores a forwarding e.g. route based and or label based table s . The microkernel interacts with the interface process es and the chassis process es to monitor and control these functions. The interface process es has direct communication with the OS kernel of the control component . This communication includes forwarding exception packets and control packets to the control component receiving packets to be forwarded receiving forwarding table updates providing information about the health of the packet forwarding component to the control component and permitting configuration of the interfaces from the user interface e.g. CLI process es of the control component . The stored forwarding table s is static until a new one is received from the control component . The interface process es uses the forwarding table s to look up next hop information. The interface process es also has direct communication with the distributed ASICs . Finally the chassis process es may communicate directly with the microkernel and with the distributed ASICs .

Referring back to distributed ASICs of is an example of how the ASICS may be distributed in the packet forwarding component to divide the responsibility of packet forwarding. As shown in the ASICs of the packet forwarding component may be distributed on physical interface cards PICs flexible PIC concentrators FPCs a midplane or backplane and a system control board s for switching and or forwarding . Switching fabric is also shown as a system switch board SSB or a switching and forwarding module SFM . Each of the PICs includes one or more PIC I O managers . Each of the FPCs includes one or more I O managers each with an associated memory . The midplane backplane includes buffer managers . Finally the system control board includes an internet processor and an instance of the forwarding table Recall e.g. of .

Still referring to the PICs contain the interface ports. Each PIC may be plugged into an FPC . Each individual PIC may contain an ASIC that handles media specific functions such as framing or encapsulation. Some example PICs provide SDH SONET ATM Gigabit Ethernet Fast Ethernet and or DS3 E3 interface ports.

An FPC can contain from one or more PICs and may carry the signals from the PICs to the midplane backplane as shown in .

The midplane backplane holds the line cards. The line cards may connect into the midplane backplane when inserted into the example router s chassis from the front. The control component e.g. routing engine may plug into the rear of the midplane backplane from the rear of the chassis. The midplane backplane may carry electrical or optical signals and power to each line card and to the control component .

The system control board may perform forwarding lookup. It may also communicate errors to the routing engine. Further it may also monitor the condition of the router based on information it receives from sensors. If an abnormal condition is detected the system control board may immediately notify the control component .

Referring to A and B in some exemplary routers each of the PICs contains at least one I O manager ASIC responsible for media specific tasks such as encapsulation. The packets pass through these I O ASICs on their way into and out of the router. The I O manager ASIC on the PIC is responsible for managing the connection to the I O manager ASIC on the FPC managing link layer framing and creating the bit stream performing cyclical redundancy checks CRCs and detecting link layer errors and generating alarms when appropriate. The FPC includes another I O manager ASIC . This ASIC takes the packets from the PICs and breaks them into e.g. 64 byte memory blocks. This FPC I O manager ASIC sends the blocks to a first distributed buffer manager DBM decoding encapsulation and protocol specific information counting packets and bytes for each logical circuit verifying packet integrity and applying class of service CoS rules to packets. At this point the packet is first written to memory. More specifically the example DBM ASIC manages and writes packets to the shared memory across all FPCs . In parallel the first DBM ASIC also extracts information on the destination of the packet and passes this forwarding related information to the Internet processor . The Internet processor performs the route lookup using the forwarding table and sends the information over to a second DBM ASIC . The Internet processor ASIC also collects exception packets i.e. those without a forwarding table entry and sends them to the control component . The second DBM ASIC then takes this information and the 64 byte blocks and forwards them to the I O manager ASIC of the egress FPC or multiple egress FPCs in the case of multicast for reassembly. Thus the DBM ASICs and are responsible for managing the packet memory distributed across all FPCs extracting forwarding related information from packets and instructing the FPC where to forward packets. 

The I O manager ASIC on the egress FPC may perform some value added services. In addition to incrementing time to live TTL values and re encapsulating the packet for handling by the PIC it can also apply class of service CoS rules. To do this it may queue a pointer to the packet in one of the available queues each having a share of link bandwidth before applying the rules to the packet. Queuing can be based on various rules. Thus the I O manager ASIC on the egress FPC may be responsible for receiving the blocks from the second DBM ASIC incrementing TTL values queuing a pointer to the packet if necessary before applying CoS rules re encapsulating the blocks and sending the encapsulated packets to the PIC I O manager ASIC .

Referring back to block the packet may be queued. Actually as stated earlier with reference to a pointer to the packet may be queued. The packet itself may remain in the shared memory. Thus all queuing decisions and CoS rules may be applied in the absence of the actual packet. When the pointer for the packet reaches the front of the line the I O manager ASIC may send a request for the packet to the second DBM ASIC . The DBM ASIC reads the blocks from shared memory and sends them to the I O manager ASIC on the FPC which then serializes the bits and sends them to the media specific ASIC of the egress interface. The I O manager ASIC on the egress PIC may apply the physical layer framing perform the CRC and send the bit stream out over the link.

Referring back to block of as well as regarding the transfer of control and exception packets the system control board handles nearly all exception packets. For example the system control board may pass exception packets to the control component .

Although example embodiments consistent with the present invention may be implemented on the example routers of or embodiments consistent with the present invention may be implemented on communications network nodes e.g. routers switches etc. having different architectures. More generally embodiments consistent with the present invention may be implemented on an example system as illustrated on .

In some embodiments consistent with the present invention the processors may be one or more microprocessors and or ASICs. The bus may include a system bus. The storage devices may include system memory such as read only memory ROM and or random access memory RAM . The storage devices may also include a hard disk drive for reading from and writing to a hard disk a magnetic disk drive for reading from or writing to a e.g. removable magnetic disk an optical disk drive for reading from or writing to a removable magneto optical disk such as a compact disk or other magneto optical media or solid state non volatile storage.

Some example embodiments consistent with the present invention may also be provided as a machine readable medium for storing the machine executable instructions. The machine readable medium may be non transitory and may include but is not limited to flash memory optical disks CD ROMs DVD ROMs RAMs EPROMs EEPROMs magnetic or optical cards or any other type of machine readable media suitable for storing electronic instructions. For example example embodiments consistent with the present invention may be downloaded as a computer program which may be transferred from a remote computer e.g. a server to a requesting computer e.g. a client by way of a communication link e.g. a modem or network connection and stored on a non transitory storage medium. The machine readable medium may also be referred to as a processor readable medium.

Example embodiments consistent with the present invention might be implemented in hardware such as one or more field programmable gate arrays FPGA s one or more integrated circuits such as ASICs one or more network processors etc. Alternatively or in addition embodiments consistent with the present invention might be implemented as stored program instructions executed by a processor. Such hardware and or software might be provided in an addressed data e.g. packet cell etc. forwarding device e.g. a switch a router etc. a laptop computer desktop computer a tablet computer a mobile phone or any device that has computing and networking capabilities.

An example illustrating operations of an example method of avoiding data traffic loss in a multihomed Ethernet Ring is now described with reference to . In the example environment when the link between a designated border router PE 1 and a first node CE 1 of Ethernet Ring is active all data packets from each of the nodes CE2 CE6 of the Ethernet Ring destined for transport via the VPLS may be routed to the designated border router PE 1 via the first node CE 1. Recall e.g. and of . Thus in such a case information from the customer site 1 to an ingress point of the service provider network would normally proceed as follows CE 5 CE 6 CE 1 PE 1. In the example environment if a link between the node CE 1 of Ethernet Ring and designated border router PE 1 fails an indication that the link has failed may be received. Recall e.g. of . Each type of active standby multihoming technique has its own signaling mechanism to communicate such a failure. For example in case of BGP multihoming the failure indication is communicated between the multihomed PEs using a BGP message. As another example in case of MC LAG multihoming the failure indication is communicated using Inter Chassis Communication Protocol ICCP signaling.

Responsive to the received indication that the link between the node CE 1 and designated border router PE 1 has failed an ERP MAC flush is invoked without activating the RPL of the Ethernet Ring . Recall e.g. of . The ERP MAC flush command causes each of the nodes CE1 CE6 in the Ethernet Ring to remove all previously learned MAC addresses from their database tables and learn the MAC addresses of the nodes along the new forwarding routes paths. In the exemplary environment the new forwarding route in the Ethernet Ring includes a path route forwarding data packets to the standby border router PE 2 via node CE 2 of the Ethernet Ring . The subsequent data packets from each of the nodes CE1 CE6 destined for transport via VPLS are forwarded to the standby border router PE 2 via node CE 2 of the Ethernet Ring . Recall e.g. of . Thus in such a case information from the customer site 1 to an ingress point of the service provider network would proceed as follows CE 5 CE 4 CE 3 CE 2 PE 2.

In an exemplary embodiment consistent with the present invention if the link between the node CE 1 of Ethernet Ring and designated border router PE 1 recovers from failure the ERP MAC flush is invoked again which causes each of the nodes CE1 CE6 to remove the MAC address of the nodes along a new forwarding path rout and revert to the MAC address of the nodes along the previous forwarding path route which includes the route to the designated border router PE 1 via node CE 1.

As can be appreciated from the foregoing exemplary embodiments consistent with the present invention provide methods and apparatus for avoiding data traffic loss in an Ethernet Ring that is multihomed in an active standby manner to a VPLS transport network such as a Border Gateway Protocol BGP multihomed Ethernet Ring an MC LAG multihomed Ethernet Ring or some other type of active standby multihomed Ethernet Ring etc. . The exemplary methods i extend ERP functionality to multihomed Ethernet Rings ii do not interfere with or require any change in the existing ERP mechanisms iii do not require any special knowledge of the e.g. BGP or MC LAG multihoming configuration iv do not require any change in VPLS multihoming techniques and v provide full redundancy in both the Ethernet Ring and the core portion of the transport network in the multihomed Ethernet Rings.

