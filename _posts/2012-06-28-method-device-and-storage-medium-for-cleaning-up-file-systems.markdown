---

title: Method, device and storage medium for cleaning up file systems
abstract: Examples of the present disclosure may provide a method, device and storage medium for clearing up a file system. A volume may be opened and locked according to a clearing-up instruction. The clearing-up instruction may indicate the volume which is to be cleared up. Garbage information on a disk corresponding to the volume may be cleared up. The volume may be unlocked after the garbage information is cleared up. The device may include a locking module, a clearing-up module and an unlocking module. With the example of the present disclosure, when the clearing-up instruction is received, the garbage information on the disk corresponding to the volume may be cleared up. Therefore, the privacy of the user remained in the file system may be thoroughly cleared up, the leakage of the privacy of the user may be avoided and the security of the file system may be enhanced.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09104685&OS=09104685&RS=09104685
owner: TENCENT TECHNOLOGY (SHENZHEN) COMPANY LIMITED
number: 09104685
owner_city: Shenzhen
owner_country: CN
publication_date: 20120628
---
The present disclosure relates to a file system field and more particularly to a method device and storage medium for cleaning up a file system.

Various temporary files may be generated when the windows is operated. The temporary files may include user information kept in a web browser and records relating to privacy of the user such as traces of office software. In the conventional method the privacy of the user generated by using the web browser and a variety of software may be cleaned up.

However in the conventional Operating System OS privacy information of the user may also be generated in a process of using the file system of the windows except for privacy information of the user generated in the process of using the web browser and the variety of software. For instance a large amount of personal files may be stored in a disk of a computer and the personal files may include a large amount of privacy information of the user. If a computer used by a user is used by another person for some reasons such as reassignment in a work unit files stored in the computer may be deleted or the disk of the computer may be formatted. However the files may not be thoroughly cleaned up by these operations. File data and data relating to the files may be hidden in the disk and a large amount of privacy information of the user may reside in the data. If data recovery software is used all or partial of the data of the deleted file may be restored. Therefore the privacy of the user in the data of the file may be likely to be leaked and file system may be insecure.

Examples of the present disclosure may provide a method device and storage medium for clearing up a file system to enhance the security of the file system.

An example of the present disclosure may provide a method for clearing up a file system. The method may include 

opening and locking a volume according to a clearing up instruction wherein the clearing up instruction indicates the volume which is to be cleared up 

unlocking the volume after clearing up the garbage information on the disk corresponding to the volume.

Another example of the present disclosure may provide a storage medium storing a data processing program to execute the method the examples of the present disclosure.

Another example of the present disclosure may provide a device for clearing up a file system. The device may include 

a locking module to open and lock a volume according to a clearing up instruction wherein the clearing up instruction indicates the volume which is to be cleared up 

an unlocking module to unlock the volume after the clearing up module clears up the garbage information.

Compared with the conventional method in examples of the present disclosure when the clearing up instruction is received the garbage information on the disk corresponding to the volume may be cleared up. Since the garbage information on the disk may include the deleted file or data relating to formatted volume the data of the file including the privacy of the user remained in the file system may be thoroughly cleared up by clearing up the garbage information on the disk corresponding to the volume. The leakage of the privacy of the user may be avoided and the security of the file system may be enhanced.

The technical scheme in examples of the present disclosure may be described clearly and completely accompanying with figures of the examples of the present disclosure. The examples described hereinafter may be partial of examples in the present disclosure but not be all the examples. According to the examples in the present disclosure other examples obtained by an ordinary skilled in the art of the present disclosure without creative works may be protected by the present disclosure.

In order to make objectives technical solutions and advantages of the present invention more apparent the present invention will be described in detail hereinafter with reference to accompanying drawings.

Before introducing a method for clearing up a file system in an example of the present disclosure some knowledge relating to the present disclosure may be described hereinafter.

First a byte in the MFT may be marked to denote that a file may have been deleted and MFT space may be released.

Third disk space occupied by the data of the file may be released from a bit table. The release of the disk space may not really clear up the disk space occupied by the data of the file but may inform the file system to write new data in the disk space occupied by the file. The newly written data may overwrite the original data.

In can be seen from the above that in the NTFS file system user data which is not be cleared up by the windows may include information occupied by a deleted file and the data of the file. The information occupied by the deleted file may include data stored in the MFT such as a name of the file time of the file and size of the file. The data stored in the MFT may include privacy of the user and may be likely to cause privacy leakage. The data of the file may include data in the DATA and the data of the file stored in the MFT. The data of the file may kept in the disk without being overwritten by new data and may be likely to cause the privacy leakage.

Since the file has been deleted the user data which may not be cleared up may still be kept in the disk but may not be used again the user data which may not be cleared up by the windows may also be called disk garbage information.

First a directory entry of the file and the first byte of a long name of the file may be recorded as E5 to indicate that the file may be released.

It can be seen from the above that in the FAT file system the user data which may not be cleared up by the windows may include information occupied by the deleted file and data of the file. The information occupied by the deleted file may include data stored in the directory entry in the FAT such as the name of the file time of the file and size of the file. Since the file has been deleted the data of the user which may not be cleared up may still be kept in the disk but may not be used again the data of the user which may not be cleared up by the windows may also be called disk garbage information.

In the NTFS file system or the FAT file system data of a file may not be cleared up from the disk if the file is deleted. Instead a mark may be added to the directory entry of the MFT or the FAT in a sector table to denote that the file may have been deleted. If new data is written in the disk the system may overwrite the marked file with the new data. Therefore when a file is deleted the windows system may not thoroughly clear up the file resulting in that the privacy of the user may be likely to be leaked.

In order to thoroughly clear up the data including the privacy of the user remained in the file system and avoid the leakage of the privacy of the user an example of the present disclosure may provide a method for clearing up a file system. Referring to the method may include following blocks.

In block a volume may be opened and locked according to a clearing up instruction. The clearing up instruction may indicate the volume.

In block garbage information on a disk corresponding to the volume may be cleared up and the volume may be unlocked after the volume is cleared up.

It may be well known by an ordinary skilled in the art that the volume may be a storage area on a hard disk. A drive may format the volume with a file system such as the FAT or NTFS and allocate a drive number for the drive. One hard disk may include many volumes. One volume may include many sub volumes on many disks. The clearing up operation in this example of the present disclosure may be performed for a volume in the computer. A user may designate the volume for which the clearing up operation may be performed. In this example of the present disclosure when the user sends out the clearing up instruction selection options may be popped out and displayed to the user and the user may be asked to select a volume to clear up the volume.

In this example of the present disclosure the file system may be changed. Therefore when a volume is cleared up the volume may be locked to ensure that no other file operation may be performed for the volume and avoid damage of the file system.

According to an example of the present disclosure if the clearing up instruction is sent out after a file in the volume is deleted the method for clearing up the garbage information of the disk corresponding to the volume may include clearing up the information occupied by the deleted file on the disk corresponding to the volume and erasing volume free space in the disk corresponding to the volume.

According to another example of the present disclosure if the clearing up instruction is sent out after the user performs a format operation on a volume since the file system may clear up metadata in the file system after the file system formats the disk the volume free space in the file system may be cleared up. Therefore a method for clearing up the garbage information on the disk corresponding to the volume may include 

determining whether the volume specified by the clearing up instruction is formatted and whether no file is added or deleted after the volume is formatted 

clearing up the volume free space in the disk corresponding to the volume if the volume specified by the clearing up instruction is formatted and no file is added or deleted after the volume is formatted 

clearing up the information occupied by the deleted file on the disk corresponding to the volume and clearing up the volume free space in the disk corresponding to the volume if the volume specified by the clearing up instruction is not formatted or a file is added or deleted.

The information occupied by the deleted file on the disk corresponding to the volume may include privacy of the user or trace of the user. In order to enhance the security the information may need to be cleared up.

As for different file systems the methods for clearing up the information occupied by the deleted file on the disk corresponding to the volume may be different.

In the NTFS file system the information occupied by the deleted file may be stored in the MFT. The MFT may be an index of each file on the volume. The MFT may store a record called attribute for each file. Each attribute may store a different type of information. The information may include a name of a file time of the file and content of the file etc. The time of the file may include creation time modification time and last access time. The attribute may include the privacy of the user and trace of the user.

Therefore in the NTFS file system the method for clearing up the information occupied by the deleted file on the disk corresponding to the volume may include traversing the MFT of the volume and clearing up the information occupied by the deleted file in the MFT. Since a mark may be added to a byte of the MFT corresponding to the file after the file is deleted to indicate that the file may be deleted MFT information occupied by the deleted file may be found according to the mark in the MFT. The MFT information may include the name of the file time of the file and content of the file etc.

In the FAT file system each file may correspond to a directory entry. The directory entry may include attribute information such as the name of the file time of the file and size of the file. The information occupied by the deleted file may be stored in the directory entry. When a FAT file is deleted by the windows the directory entry of the file and the first byte of a long name of the file may be recorded as 0xE5. Therefore an entry in which the first byte of the name of the entry is 0xE5 in the directory entry may be information occupied by the deleted file.

Therefore in the FAT file system the method for clearing up the information occupied by the deleted file on the disk corresponding to the volume may include traversing the directory entry of the volume and clearing up the entry in which the first byte of the name of the entry is 0xE5 in the directory entry.

In the volume free space of the disk corresponding to the volume whether the file is deleted or the volume is formatted the deleted file may not be thoroughly cleared up. In the contrary a mark may be added to the directory entry of the MFT or the FAT of the file in the sector table to denote that the file may be deleted. However the data of the file may be still stored in the disk. The space occupied by the file may be marked as free space. When a new file is written in the free space the data in the free space may be overwritten by the new file. Therefore when a file is deleted or a file is formatted the data of the file in the free space may not be really cleared up resulting in that the privacy of the user may be likely to be leaked.

Therefore as noted above in order to thoroughly clear up the data of the file including the privacy of the user in the file system and avoid the leakage of the privacy of the user the volume free space in the disk corresponding to the volume may need to be cleared up. The volume free space may also be the garbage information on the disk. There may be two methods for clearing up the volume free space.

A first method for clearing up a volume free space may include searching for a bit table of the volume in the file system and erasing disk space marked as free in the bit table. The bit table may indicate the free space of the volume. The space marked as free in the bit table may be the volume free space.

A second method for clearing up the volume free space may include continuously creating temporary files on the disk corresponding to the volume until a failure occurs and clearing up the created temporary files. The created temporary files may overwrite the original data on the volume to avoid the leakage of the privacy of the user. It should be noted that due to the limit of the size of the temporary file such as the size of the maximum file in the FAT32 file system is 4G if the volume free space is larger than the limit of the file the temporary file may need to be written in many times until a written in operation may be failed. After the written in operation may be completed the effect may be achieved after all the written in temporary files may be deleted.

Furthermore in order to prevent the leakage of the privacy of the user when the volume is a system disk the method may further include clearing up pagefile.sys. The method for clearing up the pagefile.sys may include setting a value of a registry key HKLM SYSTEM CurrentControlSet Control Session Manager Memory Management ClearPageFileAtShutdown as 1 restarting the system and deleting the value of the key. It may be well known by an ordinary skilled in the art that the pagefile.sys may be virtual memory paging file created in an installation process. The pagefile.sys may save trace of the user which may relate to the privacy of the user. The size of the pagefile.sys may be a minimum value set according to the system virtual memory. It may be assumed that the virtual memory may be set as 800MB 1600MB there may be the pagefile.sys of 800MB in a local drive disk.

It should be noted that the process for clearing up the pagefile.sys may be performed before the volume is unlocked or after the volume is unlocked which may not be affected by the locking of the volume.

According to the method provided by this example of the present disclosure the privacy of the user in the file system may be thoroughly cleared up via clearing up the garbage information on the disk corresponding to the volume after receiving the clearing up instruction. Therefore the leakage of the privacy of the user may be avoided and the security of the file system may be enhanced.

In block a clearing up instruction may be received. The clearing up instruction may indicate a volume.

The clearing up instruction may be triggered by a user triggered by a file system at preset time intervals when an application is operated automatically triggered after the user formats the volume or triggered by the user after the user formats the volume and the user is prompted to trigger the clearing up instruction.

In block it may be determined whether the volume specified by the clearing up instruction may be opened. If the volume may be opened following blocks may be performed. If the volume may not be opened the flow may be terminated.

The volume may be a volume which is to be cleared up. It may be well known by an ordinary skilled in the art that if the volume has been opened an open failure occurs if an operation for opening the volume is performed.

It should be noted that since changes may be performed on the file system in the example of the present disclosure the volume should be locked before the subsequent deletion operation to ensure that no other file operation may be performed on the volume and avoid the damage of the file system.

It may be well known by an ordinary skilled in the art that the locking operation or unlocking operation performed on the file may be implemented by FSCTL LOCK VOLUME FSCTL UNLOCK VOLUME control codes.

In block whether the volume specified by the clearing up instruction is formatted and no file is added or deleted after the volume is formatted may be determined. Block may be performed if the volume specified by the clearing up instruction is formatted and no file is added or deleted after the volume is formatted. Block is performed if the volume specified by the clearing up instruction is not formatted or a file is added or deleted.

There may be multiple determination methods in block . For instance the formatting operation of the user may be monitored. A prompt of formatting and clearing up instruction may be popped out after the volume is formatted by the user. The operation on the volume may be locked before the user triggers the formatting and clearing up instruction. That is the user may not add a new file to or delete a file from the volume. If the clearing up instruction triggered by the user in block may be the formatting and clearing up instruction it may be determined in block that the volume specified by the clearing up instruction may not be formatted and no file is added or deleted after the volume is formatted. It may be well known by an ordinary skilled in the art of the present disclosure that there may be other determination methods according to the description of block . For instance the determination may be performed according to an inherent Application Programming Interface API of the OS which may not be repeated here.

In block information occupied by a deleted file on the disk corresponding to the volume may be cleared up.

In block in the NTFS file system the method for deleting the information may include traversing the MFT of the volume and clearing up the information occupied by the deleted file in the MFT. In the FAT file system the method for deleting the information may include traversing a directory entry of the volume and clearing up an entry in which the first byte of the name of the entry is 0xE5 in the directory entry.

A first method for clearing up the volume free space may include querying a bit table of the volume in the file system and erasing disk space marked as free in the bit table.

A second method for clearing up the volume free space may include continuously creating temporary files on the disk corresponding to the volume until a failure occurs and clearing up the created temporary files.

After the clearing up operation is finished the unlocking operation may be performed on the volume to perform the subsequent operation.

According to the example provided by the present disclosure when the clearing up instruction is received the information occupied by the deleted file of the volume and the volume free space may be cleared up. Therefore the privacy of the user in the file system may be thoroughly cleared up the leakage of the privacy of the user may be avoided and the security of the file system may be enhanced.

In order to thoroughly clear up trace of a user and avoid leakage of privacy of the user an example of the present disclosure may further provide a device for clearing up a file system. Referring to the device may include 

an unlocking module to unlock the volume after the clearing up module clears up the garbage information. The clearing up instruction may indicate the volume which is to be cleared up 

The garbage information on the disk corresponding to volume may include information occupied by a deleted file in volume free space of the volume and the volume free space in the disk corresponding to the volume.

a first clearing up module to clear information occupied by the deleted file in the disk corresponding to the volume and

According to another example referring to in order to distinguish clearing up methods on the basis of the clearing up module may further include 

a determination module to determine whether the volume specified by the clearing up instruction is formatted and no file is added or deleted after the volume is formatted instruct the second clearing up module to clear up the volume free space in the disk corresponding to the volume if the volume specified by the clearing up instruction is formatted and no file is added or deleted after the volume is formatted and instruct the first clearing up module to clear up the information occupied by the deleted file on the disk corresponding to the volume and instruct the second clearing up module to clear up the volume free space in the disk corresponding to the volume if the volume specified by the clearing up instruction is not formatted or a file is added or deleted.

a NTFS clearing up sub module to traverse a MFT of the volume in a NTFS file system and clear up the information occupied by the deleted file in the MFT and

an FAT clearing up sub module to traverse a directory entry of the volume in a FAT file system and clear up an entry in which the first byte of a name of the entry is 0xE5 in the directory entry.

The second clearing up module may be implemented with two modes. is a schematic diagram illustrating structure of the second clearing up module. Referring to the second clearing up module may include 

a free space determination sub module to search for a bit table of the volume in a file system and determine disk space marked as free in the bit table and

a temporary file creation sub module to continuously create temporary files on the volume free space until a failure occurs and

The devices provided by examples of the present disclosure may be designed according to the same idea as that of the methods provided by the example of the present disclosure which may not be repeated here.

According to the devices provided by the examples of the present disclosure after the clearing up instruction is received the information occupied by the deleted file of the volume and the volume free space may be cleared up the leakage of the privacy of the user may be avoided and the security of the file system may be enhanced.

All or partial of the above technical schemes provided by examples of the present disclosure may be implemented by instructing hardware such as a processor of a computer by instructions of a data processing program. The data processing program may be stored in a readable storage medium. The storage medium may include a medium capable of storing program codes such as a Read Only Memory ROM a Random Access Memory RAM a disk or a Compact Disk CD .

Furthermore each function module in each embodiment of the present disclosure may be integrated in a processing unit or may be each independently physical module. In the alternative two or more than two modules may be integrated in a unit. The integrated unit may be implemented with hardware or implemented by software function units. The function modules in each example may be set on a terminal device or a network node or respectively set on more than two terminal devices or network nodes.

What has been described and illustrated herein are examples of the disclosure along with some variations. The terms descriptions and figures used herein are set forth by way of illustration only and are not meant as limitations. Many variations are possible within the scope of the disclosure which is intended to be defined by the following claims and their equivalents in which all terms are meant in their broadest reasonable sense unless otherwise indicated.

