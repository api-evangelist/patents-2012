---

title: Restricting access to hardware for which a driver is installed on a computer
abstract: Users of a computer are prevented from directly accessing certain hardware for which a driver is installed on the computer. The users are provided a limited, indirect manner to access the hardware for a specific purpose or to do a specific job. One example of such hardware is a wireless hardware communication interface. The wireless activity of the computer may be restricted so that the wireless hardware communication interface is prevented from communicating with any devices compatible with the wireless hardware communication interface other than one or more specific devices.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08839370&OS=08839370&RS=08839370
owner: BlackBerry Limited
number: 08839370
owner_city: Waterloo, Ontario
owner_country: CA
publication_date: 20121217
---
Wireless communication technology provides a way for a wide range of computers and other electronic devices to communicate with each other without the need for wires cables and connectors. Unfortunately wireless communication technology also forms a potential security hazard since wireless communication signals can be monitored and a wireless interface of an electronic device can be used to access the electronic device.

Bluetooth BT is one example of wireless communication technology. Bluetooth is an industrial standard for short range wireless communications using radio frequency RF data transmission. BT technology uses the portion of the RF spectrum near the 2.4 GHz frequency that is reserved for industrial scientific and medical devices. BT enabled devices are able to communicate without wires over an air interface of up to 100 feet. BT is increasingly taking the place of direct communications links between computers and peripheral devices such as printers keyboards and mice. Additionally BT may be used for other communication purposes such as communication between electronic devices.

It will be appreciated that for simplicity and clarity of illustration elements shown in the figures have not necessarily been drawn to scale. For example the dimensions of some of the elements may be exaggerated relative to other elements for clarity.

In the following detailed description numerous specific details are set forth in order to provide a thorough understanding of embodiments. However it will be understood by those of ordinary skill in the art that the embodiments may be practiced without these specific details. In other instances well known methods procedures components and circuits have not been described in detail so as not to obscure the embodiments.

In embodiments of the present invention users of a computer are prevented from directly accessing certain hardware for which a driver is installed on the computer. The users are provided a limited indirect manner to access the hardware for a specific purpose or to do a specific job.

One example of such hardware is a wireless hardware communication interface. The wireless activity of the computer may be restricted so that the wireless hardware communication interface is prevented from communicating with any devices compatible with the wireless hardware communication interface other than one or more specific devices.

Although the following description uses Bluetooth communications as an example embodiments of the invention are applicable to other wireless communications including other wireless personal area network WPAN communication technologies. ZigBee and ultra wideband UWB are non limiting examples of other WPAN communication technologies.

In this description and claims the term computer is used inclusively to mean any electronic device having an operating system. This includes for example personal computers server computers client computers laptops notebooks personal digital assistants PDAs pocket personal computers smartphones email devices and the like.

For security reasons or for any other reason it may be desirable to enable computer to communicate using BT communication with BT enabled devices of a group while preventing computer from communicating using BT communication with any other BT enabled devices including the devices of a group .

As known in the art peripheral devices that authenticate a user s identity may be used to enhance security for a computer. One example of such an authentication device is a smart card and smart card reader combination. Smart cards are devices that are compatible with personal authentication protocols as defined by the ISO7816 standard and its derivatives published by the International Organization for Standardization. A smart card resembles a credit card in size and shape but also comprises a memory and a microprocessor and or dedicated logic. The smart card owner s identity and other personal information may be stored in the smart card s memory access to which is controlled by the microprocessor and or dedicated logic. The smart card may prevent unauthorized access to its memory by requiring that a secret such as a personal identification number PIN be supplied before allowing the access to proceed. Smart cards may be inserted into a smart card reader that is in communication with a computer over a wireless communication link. The computer may communicate with the smart card via the smart card reader and may use the smart card and information stored in the smart card for different purposes. For example the smart card may authenticate a user to the computer may enable unlocking and booting the computer and may be used for encryption and decryption of information used by applications on the computer.

In one non limiting example group comprises a BT enabled smart card reader shown with a smart card inserted . It may be desirable for computer to communicate with smart card reader for security purposes and it may be desirable for security reasons to prevent computer from communicating with any other device using BT technology. Of course there may be many other reasons to enable computer to communicate with only a selected group of one or more BT enabled devices and the devices in such a group may be of any type.

The restrictions on wireless activity in the computer may be applied to a specific group of users of computer for example to a group of users. Others for example a system administrator may be exempt from the restrictions. System administrator may be able to configure computer so that the restrictions are imposed on the users of group . The users of group may be prevented from modifying the restrictions.

Computer comprises a processor and a memory coupled to processor . Computer comprises a user input interface a user output interface and a wireless communication interface all coupled to processor . Wireless communication interface comprises an antenna and a radio and may optionally comprise a microprocessor P . Radio is a wireless hardware communication interface the use of which is restricted according to the methods described herein. Alternatively radio is a software defined radio comprising a programmable wireless hardware communication interface the use of which is restricted according to the methods described herein and comprising software that controls the programmable hardware. Memory stores a radio driver to control radio or the hardware portion thereof. For simplicity the following description and claims refer to a radio as a wireless hardware communication interface.

Memory stores a communication stack compatible with a wireless communication standard for example Bluetooth . Stack may be executable by processor . Alternatively portions of stack may be executable by processor and the other portions may be executable by microprocessor . For example portions of stack that are defined below the HCI Host Control Interface layer may be executable by microprocessors . Stack may comprise an RFCOMM Radio Frequency Communication module to emulate serial ports for use with communications via radio .

Memory may store one or more serial port definitions and an application for communicating control information related to the wireless communications with a user through interfaces and interfaces . In Microsoft operating systems application for BT communications is typically found with the following pathname WINDIR System32 bthprops.cpl where WINDIR indicates the directory where the operating system files are installed.

Memory may also store an authentication agent to interact with a user through interfaces and to report to the user that a device is attempting to connect to computer using radio and to receive from the user permission or refusal for the request for connection. Memory may also store a cache . Cache may store information about previous BT pairings of computer with other BT enabled devices. This information may comprise for example one or more BT encryption keys one or more BT device addresses and or one or more BT device names. More generally cache may store encryption keys previously used to encrypt communications conducted via radio .

Memory stores a database for operating system that comprises entries having information settings and options for software applications and drivers of hardware devices that are installed in computer . In Microsoft Windows operating systems for example database is known as the registry. Some entries comprise ClassGUID parameters that characterize classes to which the installed drivers of hardware devices belong. For example drivers of BT enabled hardware devices such as radios are characterized in Microsoft Windows using the ClassGUID e0cbf06c cd8b 4647 bb8a 263b43f0f974.

Computer is described for the purpose of a non limiting example as adapted to communicate with a BT enabled smart card reader such as smart card reader . Memory may therefore store a smart card driver library that resides in kernel space and that comprises a set of routines that standardize most of the functions that a smart card reader driver must perform and a smart card reader driver that resides in kernel space and accesses routines of smart card driver library . Memory may store a smart card resource manager that communicates with smart card reader driver via input output control IOCTL calls a smart card service provider SCSP that provides access to smart card capabilities and an authentication interface that performs identification and authentication user interactions. In Windows XP for example authentication interface is compatible with a Graphical Identification and Authentication GINA model and in Windows Vista for example authentication interface is compatible with a Credential Provider model. More detail about how these software components work together is provided hereinbelow.

As known in the art one or more users are able to use a computer by setting up accounts. Accounts are associated with security contexts. An administrator account assigned to a system administrator of the computer has more privileges than a user account. A system account able to be assigned to certain processes running on the computer also has more privileges than a user account. Applications run by a user who has logged on to the computer and any processes started by those applications will inherit the security context of the user s user account.

In one embodiment restricting wireless activity of computer is achieved by preventing any process running on computer under any user account from directly accessing radio driver . Since access to radio driver is essential for using radio use of radio for communications is restricted. Likewise since access to radio driver is essential for altering the configuration for the wireless communications and for using any of the wireless communication functionality those activities are also restricted. This is explained in more detail as those activities are discussed hereinbelow.

For example access to radio driver may be controlled via an access control list ACL that permits only administrative accounts and system accounts to access radio driver . As known in the art an ACL is a list of permissions attached to an object. The list specifies who or what is allowed to access the object and what operations are allowed to be performed on the object. When a subject requests to perform an operation on an object the operating system first checks the ACL for an applicable entry in order to decide whether or not to proceed with the operation.

If drivers of two or more radios for the same type of wireless communications are installed in computer ACL once applied may affect all such radio drivers since operating system may apply ACL to all drivers for devices of a certain class. In Microsoft Windows operating systems for example BT radio drivers all have the same class ID. In addition if a new radio is installed after ACL is already activated operating system may install a new radio driver and may automatically apply ACL to the new radio driver. Consequently applying ACL ensures that wireless functionality will be restricted even for wireless hardware communication interfaces that are not yet installed in computer . Furthermore applying ACL ensures that the restriction cannot be altered in the future by processes running under a user account.

Limited indirect access to radio is provided to the user as follows. Memory stores a smart card reader service application SCR SA which acts as a middle man between smart card reader driver and smart card reader . SCR SA communicates with smart card reader driver via IOCTL calls. As part of its functionality SCR SA manages all of the wireless communication with smart card reader . When installed on computer SCR SA is configured to run under a system account every time that operating system is running Since ACL permits system accounts to access radio driver SCR SA is able to conduct wireless communications with smart card reader via radio to access smart card .

Memory also stores a smart card user interface UI proxy application that communicates with SCR SA via inter process communication IPC for example named pipes. Smart card UI proxy application delegates UI requests to a smart card UI library which shows all of the UI. Smart card UI proxy application is started when a user logs onto computer and is stopped when the user logs off and provides UI for SCR SA . Since smart card UI proxy application is run under a user account it is prevented by ACL from directly accessing radio driver . However using IPC smart card UI proxy application sends commands to SCR SA which is able to directly access radio driver and therefore conduct wireless communications with smart card reader via radio to access smart card .

The indirect access to radio provided to the user in this fashion is limited because SCR SA has specific functions that it performs in order to do a specific job. The result is that the user can use radio to communicate with smart card reader but is prevented from using radio to communicate with any other devices compatible with radio . Instead of smart card UI proxy application any other process accessible to the user that is able to send commands via IPC to SCR SA may be used. For example authentication interface via authentication interface filter which is run under the system account is able to send commands via IPC to SCR SA and may be used to provide indirect access to radio to the user. It will be obvious to persons of ordinary skill in the art how to modify the embodiments described herein to restrict use of a wireless hardware communication interface to communications with one or more specific devices none of which are necessarily a smart card reader.

ACL may also be applied to RFCOMM module thus preventing any process running on computer under any user account from directly accessing RFCOMM module . SCR SA which runs under a system account is permitted to directly access RFCOMM module and indirect access to RFCOMM module is provided to the user via smart card UI proxy application as described hereinabove with respect to radio driver . As explained hereinabove RFCOMM module is used to emulate serial ports for use in communications via radio . Without the ability to emulate serial ports communication via radio is blocked to processes running under a user account.

The interaction of the various software components to enable wireless communications between computer and smart card reader will now be described.

1 A user runs smart card US proxy application or authentication interface and indicates a desire to have computer connect to a smart card reader. These applications communicate with SCR SA via IPC to inform SCR SA that the user wants to connect to a smart card reader. Communications between SCR SA and authentication interface are conducted via an authentication interface filter which catches function calls made to authentication interface and is able to change their behavior.

2 If the user is not logged into computer or is at a lock screen SCR SA communicates to authentication interface to tell it to display a window that the user can enter the address of smart card reader . If the user is logged in SCR SA communicates to smart card UI proxy application to tell it to display the same window.

3 The user types in an identifier of smart card reader for example its BT device address or a device name. This identifier is transferred to SCR SA via IPC which then communicates with BT radio driver to start pairing with the identified reader. Communication between SCR SA and BT radio driver is conducted via stack and communication between SCR SA and stack is conducted via a secure channel module stored in memory . Secure channel module provides a protocol to establish a session key during secure pairing as well as a secure communication channel thereafter. A library stored in memory provides encryption and decryption functionality for use by the secure channel.

4 If smart card reader and computer have not previously paired or have previously paired but cache has been erased then SCR SA will negotiate with smart card reader to determine whether they already have a BT pairing key and if not will take the appropriate steps to establish a BT pairing key.

5 If smart card reader and computer do not already have a shared secure pairing key SCR SA and smart card reader will negotiate whether a secure pairing key is needed and if so will take the appropriate steps to establish a secure pairing key. SCR SA comprises a key store to store the secure pairing key and any other keys generated for securing wireless communications with smart card reader .

6 Once pairing has completed SCR SA communicates with smart card reader driver via IOCTL calls to inform it of events such as a card being inserted or removed. SCR SA receives this information from smart card reader via the BT communications. Smart card reader driver then communicates this information via smart card resource manager to SCSP which will then relay the information to any applications which may be interested in accessing smart card . For example an email application may wish to decrypt an email using a private key stored on smart card .

When any of applications wishes to send a command to smart card it sends the command via SCSP to smart card resource manager which will then communicate it to smart card reader driver which will in turn relay the command to SCR SA which will then communicate the command to smart card reader over the BT communication link.

In addition to restricting access to radio driver or in addition to restricting access to radio driver and to RFCOMM module other actions may be taken to restrict the wireless communication functionality of computer . These actions may be performed by executing code which is stored in memory . Any suitable format for code is acceptable. For example code may be an executable program that must be run under an administrator account. If it is run under a user account the program will information the user that it is not running in administrator mode and quit without performing further action. The program may accept a single command line argument either lock or unlock . If the program is run with the lock option it restricts the use of the hardware. To remove the restrictions the program is run with the unlock option.

For example running the program with the lock option may place ACL on radio driver and RFCOMM module and running the program with the unlock option may remove ACL .

The typical operational mode of a BT enabled device is to be connected to other Bluetooth devices for example in a piconet and exchanging data with that BT enabled device. As BT is an ad hoc wireless communications technology there are also a number of operational procedures that enable piconets to be formed so that the subsequent communications can take place. BT enabled devices use the inquiry procedure to discover nearby devices or to be discovered by devices in their locality. The inquiry procedure is asymmetrical. A BT enabled device that tries to find other nearby devices is known as an inquiring device and actively sends inquiry requests. BT enabled devices that are available to be found are known as discoverable devices and listen for these inquiry requests and send responses.

In order to discover other devices an inquiring device such as any of the devices in group enters the inquiry substate. In this substate it repeatedly transmits inquiry messages at different hop frequencies. With respect to inquiry a BT enabled device such as computer may be either in non discoverable mode or in a discoverable mode. A discoverable device that allows itself to be discovered i.e. in a discoverable mode regularly enters the inquiry scan substate to detect inquiry messages. If an inquiry message is detected the device may optionally enter the inquiry response substate to respond to the inquiry messages. When a device is in non discoverable mode it does not respond to inquiries and never enters the inquiry response state. During the inquiry substate the inquiring device collects the BT device addresses of all discoverable devices that respond to the inquiry messages. It can then if desired make a connection to any one of them by means of the page procedure.

Page procedure the procedure for forming connections is asymmetrical and requires that one BT enabled device carries out the page connection procedure while the other BT enabled device is connectable page scanning The procedure is targeted by use of a BT device address so that the page procedure is responded to only by one specified BT enabled device. The device carrying out the page connection procedure enters the page substate and repeatedly transmits paging messages. The device that is connectable enters the page scan substate and listens to paging messages. If a page message is successfully received by the connectable device the connectable device enters the slave response substate and transmits a reply to the device that carries out the page connection procedure. If the response is successfully received by the device that carries out the page connection procedure it may enter the master response substate to complete forming the connection.

BT connectability and discoverability of computer are handled by BT stack . Being in a discoverable mode and or being connectable may impose potential security threats on computer . In discoverable mode BT stack may cause computer to advertise its existence by transmitting inquiry responses and if computer is connectable stack may cause computer to advertise its existence by replies to paging messages or by paging other devices. Moreover if computer can be in discoverable mode and can be connectable BT stack may cause computer to accept an incoming request to connect to another BT enabled device.

To reduce security risks computer may be prevented from being in discoverable mode and or may prevent computer from being connectable. A scan enable parameter of BT stack that is defined by the BT specifications may be modified to disable inquiry scans and to disable page scans. Running the program for code with the lock option may directly modify the scan enable parameter using the Write scan enable command defined by the BT specifications. Alternatively running the program for code with the lock option may modify a Write scan enable parameter of an appropriate entry in database so that operating system modifies the scan enable parameter of BT stack . In order to determine which entry corresponds to BT radio code may examine ClassGUID entries of database . In Microsoft operating systems Write scan enable parameters may have the following form HKEY LOCAL MACHINE SYSTEM CurrentControlSet Enum USB Vid XXX X PidYYYY ZZZZZZZZZZZZZZ DeviceParameters Write Scan Enable where XXXX YYYY and ZZZZZZZZZZZZZZ are variable.

Other methods may be used to prevent computer from being connectable and or from being in discoverable mode.

In general use of authentication agent may be toggled on and off by any user of computer . In Microsoft Windows operating systems for example toggling of a BT authentication agent can be accomplished by changing Control Panel Bluetooth Options Alert me when a new Bluetooth device wants to connect . If it is turned on a command is sent to BT radio driver which adds an entry to database having the following form 

Authentication agent is used to alert users of computer that a device is attempting to connect with computer using wireless communications via radio . If authentication agent recognizes such an attempt it may alert the user via user output interface and may prompt the user to provide permission or to deny the incoming connection via user input interface .

Running the program for code with the lock option may disable authentication agent . If a user cannot interact with authentication agent computer may be prevented from completing a connection with a device that has attempted to connect using wireless communications via radio to computer . Code may be able to disable BT authentication agent for example by removing the entry of database that was added when the setting was turned on.

Even if BT authentication agent is not disabled ACL prevents processes running under a user account from enabling BT discoverability and connectability and or from allowing incoming connections because the toggling of the BT authentication agent requires access to BT radio driver which is blocked by ACL .

Running the program for code with the lock option may be able to remove information that is stored in cache including but not limited to one or more encryption keys that were previously used to encrypt communications conducted via radio . In the case of a BT pairing cache the information removed may include for example one or more BT pairing keys one or more BT encryption keys one or more BT device addresses and or one or more BT device names.

In general a user of computer can add BT serial ports . In Microsoft Windows operating systems for example this can be accomplished via Control Panel Bluetooth COM Ports Add. Typically COM ports for BT are added or removed via the BT control panel which in turn communicates with BT radio drivers which in turn change or add or remove the ports.

Running the program for code with the lock option may programmatically disable existing serial ports by making calls to operating system requesting it to disable the serial ports. Once disabled processes running under user accounts may not be able to enable serial ports due to the restrictions on radio drivers implemented via ACL .

Running the program for code with the unlock option may programmatically enable existing serial ports by making calls to operating system requesting it to enable the serial ports.

In general if operating system being run under an administrator account detects that a new BT radio has been installed in computer operating system may typically install an additional BT personal area network PAN driver if it receives permission to do so from system administrator . Operating system will not install BT PAN driver under user accounts .

Running the program for code with the lock option may disable or remove existing BT PAN drivers by calling a function which tells operating system to disable or remove the BT PAN drivers. Likewise running the program for code with the unlock option may enable disabled BT PAN drivers by calling a different function which tells operating system to enable the BT PAN drivers.

Memory may store various files related to the wireless communication standard with which radio is compatible. In the case of BT for example memory may store BT control panel application BT library function modules not shown a BT file transfer application not shown and BT API not shown . Running the program for code with the lock option may place an ACL on the files where the ACL permits only administrative accounts and system accounts to access the files. BT control panel application for example may include libraries needed for using BT stack and therefore it is not desirable to remove it entirely. Running the program for code with the unlock option may remove ACL .

It should be noted that to bypass ACL one might try to copy any of the files from another computer to memory since ACL applies only to the specific files as originally found on computer . However the BT file transfer application and BT control panel application need to send commands to BT radio drivers which are locked by ACL . Therefore new copies of such files will not give processes run under a user account access to any of BT radios .

Rebooting computer will cause the changes described hereinabove to take effect. Alternatively code may stop and restart any radios so that the changes described hereinabove can take effect immediately without rebooting computer . Code may stop and restart any radios both upon locking and unlocking

Computer executable instructions for execution of the above described method may be stored on a form of computer readable media. Computer readable media includes volatile and nonvolatile removable and non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Computer readable media includes but is not limited to random access memory RAM read only memory ROM electrically erasable programmable ROM EEPROM flash memory or other memory technology compact disk ROM CD ROM digital versatile disks DVD or other optical storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired instructions and which can be accessed by computer including by the Internet or other computer network forms of access.

A non exhaustive list of examples for antenna includes dipole antennae monopole antennae multilayer ceramic antennae planar inverted F antennae loop antennae slot antennae dual antennae omnidirectional antennae and any other suitable antennae.

A non exhaustive list of examples for processors and includes a central processing unit CPU a digital signal processor DSP a reduced instruction set computer RISC a complex instruction set computer CISC and the like. Furthermore processors and may be part of application specific integrated circuits ASICs or may be a part of application specific standard products ASSPs .

A non exhaustive list of examples for user input interface includes a touch screen a keyboard a track ball a microphone and the like. A non exhaustive list of examples for user output interface includes a display a touch screen a speaker and the like.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

