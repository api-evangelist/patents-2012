---

title: Automated service discovery in computer networks
abstract: In general, techniques are described for automatically discovering services in computer networks. A service node comprising a control unit and an interface may implement the techniques. The control unit determines services provided by the service node and generates a routing protocol message that includes service discovery information related to the services. The interface transmits the routing protocol message to enable network devices of the network to discover the services provided by the service node based on the service discovery information. The interface then receives traffic via a path established based on the service discovery information included in the routing protocol message and configured so that the service node applies at least one of the services to the traffic received via the path. The control unit then applies the one or more services to the traffic received via the path.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09178801&OS=09178801&RS=09178801
owner: Juniper Networks, Inc.
number: 09178801
owner_city: Sunnyvale
owner_country: US
publication_date: 20120627
---
The invention relates to computer networks and more particularly to service discovery within computer networks.

Recently network devices that form computer networks have been adapted to enable a form of networking referred to as software defined networking. In software defined networking the forwarding plane of a network switch router or other network device is made available via a communication protocol such that this forwarding plane may be configured via the communication protocol rather than a routing protocol. In many implementations the network devices may execute software to enable communications with other network devices in the network via this communication protocol so as to configure paths through the network. One example of a communication protocol that facilitates software defined networking is the so called OpenFlow communication protocol. OpenFlow is an open standard that allows users e.g. researchers to install software on the routers to run experimental or proprietary protocols to control packet routing or switching within a network.

The software controlled path setup may then orchestrate the configuration and deployment of paths on an as needed basis to suit a particular service. To illustrate orchestrating software that controls path setup may be manually configured with information identifying a network address translation NAT service operated by a first network device service node . A second network device that does not provide a NAT service may communicate with the orchestrating software learn of this NAT service and subscribe to this service whereupon the orchestrating software may configure a path through the network from the second network device to the first network device. The second network device may then push traffic requiring NAT service through the path where the first network device may apply the NAT traffic. When establishing the path the orchestrating software may configure one or more filters on the second network device controlling admission of network traffic into the path. These paths having been engineered for a particular service i.e. NAT service in this example having filters controlling admission to the path may be referred to as service engineered paths or SEPs . In this respect the orchestrating software may define these SEPs to suit a particular service in terms of defining filters tailored for that service.

While SEPs may provide for service sharing and enable other network devices to forward traffic via a path that meets the needs of the service application e.g. in terms of quality of service QoS provided bandwidth etc. often network administrations must statically configure or otherwise specify the location of the service and various parameters associated with the service. Thus when deploying new services within a network the network administrator must update this database of service related information so that the orchestrating software may configure SEPs through the network directing traffic to these services. Manual entry of this data is both time consuming and prone to human error. Moreover network administrators may not update this data as various service parameters change over time potentially resulting in inefficient utilization of the service.

In general the disclosure describes techniques for automated discovery of services in computer networks. Rather than require network administrators to manually specify the services and service related parameters the techniques described in this disclosure may enable a service node which may refer to a device that provides one or more services such as a network address translation NAT service a firewall service a secure socket layer SSL service or any other service to advertise services provided by the service node as well as service related parameters associated with those services provided by the service node within a computer network. The service node may advertise these services in accordance with the techniques described in this invention using as one example a type length value TLV field of a routing protocol message to store what may be referred to as service discovery information. 

The orchestrating software of a software defined network in which the service node operates may receive these routing protocol messages and automatically update a service directory which may refer to a database associated with the orchestrating software that stores information concerning services to include the service discovery information. The orchestrating software after learning of this service may then configure one or more service engineered paths SEPs through the software defined network that utilize the advertised service. Moreover routers and other network devices may receive these routing protocol messages that include the service discovery information and independently configure paths through the network that utilize the advertised service. In this way the techniques may avoid manual entry of service related information and thereby potentially reduce administrative burdens and occurrence of incorrectly entered service data.

In one embodiment a method comprises determining with a service node of a network one or more services provided by the service node generating with the service node a routing protocol message that includes service discovery information related to the one or more services provided by the service node and transmitting with the service node the routing protocol message to enable network devices of the network to discover the one or more services to be provided by the service node based on the service discovery information included in the routing protocol message. The method further comprises receiving traffic with the service node via a path established based on the service discovery information included in the routing protocol message and configured so that the service node applies at least one of the services to the traffic received via the path and applying with the service node the one or more services to the traffic received via the path.

In another embodiment a service node of a network comprises a control unit configured to determine one or more services provided by the service node and generate a routing protocol message that includes service discovery information related to the one or more services provided by the service node. The service node also comprises at least one interface configured to transmit the routing protocol message to enable network devices of the network to discover the one or more services provided by the service node based on the service discovery information included in the routing protocol message and receive traffic with the service node via a path established based on the service discovery information included in the routing protocol message and configured so that the service node applies at least one of the services to the traffic received via the path. The control unit is further configured to apply the one or more services to the traffic received via the path.

In another embodiment a non transitory computer readable medium comprises instructions that when executed cause one or more processors of a service node in a network to determine one or more services provided by the service node generate a routing protocol message that includes service discovery information related to the one or more services provided by the service node transmit the routing protocol message to enable network devices of the network to discover the one or more services provided by the service node based on the service discovery information included in the routing protocol message receive traffic via a path established based on the service discovery information included in the routing protocol message and configured so that the service node applies at least one of the services to the traffic received via the path and apply the one or more services to the traffic received via the path.

In another embodiment a method comprises receiving with the network device of a network a routing protocol message that includes service discovery information describing one or more services provided by a service node in the network and configuring with the network device a path through the network from an ingress network device requesting at least one of the services described by the service discovery information to the service node such that the service node applies the at least one of the services to network traffic received via the path.

In another embodiment a network device of a network comprises at least one interface configured to receive a routing protocol message that includes service discovery information describing one or more services provided by a service node in the network and a control unit configured to configure a path through the network from an ingress network device requesting at least one of the services described by the service discovery information to the service node such that the service node applies the at least one of the services to network traffic received via the path.

In another embodiment a non transitory computer readable medium comprises instructions that when executed cause one or more processors of a network device included within a network to receive a routing protocol message that includes service discovery information describing one or more services provided by a service node in the network and configure a path through the network from an ingress network device requesting at least one of the services described by the service discovery information to the service node such that the service node applies the at least one of the services to network traffic received via the path.

In another embodiment a network system comprises a service node that includes a control unit configured to determine one or more services provided by the service node and generate a routing protocol message that includes service discovery information related to the one or more services provided by the service node and at least one interface configured to transmit the routing protocol message. The network system also includes an orchestrating network device and a network device operated by a user that interfaces with the orchestrating network device to request at least one of the services provided by the service node. The orchestrating network device comprises at least one interface configured to receive the routing protocol message that includes the service discovery information and a control unit configured to automatically based on the service discovery information configure a path through the network from the network device operated by the user requesting the at least one of the services described by the service discovery information and provided by the service node to the service node. The at least one interface of the service node receives traffic via the path and the control unit of the service node is further configured to apply the one or more services to the traffic received via the path.

The details of one or more embodiments of the techniques are set forth in the accompanying drawings and the description below. Other features objects and advantages of the techniques will be apparent from the description and drawings and from the claims.

Enterprise network may represent a network owned and operated by an enterprise or business. Service node may represent a service card or so called service blade installed within or otherwise coupled to a network device such as network switch B a virtual network device executing within a network device or a separate physical network device. In any event service node may apply one or more services to network traffic such as Network Address Translation NAT or other firewall services intrusion detection and prevention IDP services anti virus services anti malware services parental control services or any other type of service. While described with respect to enterprise network establishing a path to service node the techniques may generally be applied with respect to any two network entities such as networks service nodes devices etc. and should not be limited to the examples described in this disclosure.

In any event a base network layer of network or base network includes network switches A B collectively network switches arranged in a physical topology. Network switches receive and forward packet data units PDUs for network flows according to forwarding information programmed into the switches by an administrator or external entity e.g. overlay controller or multi topology path computation element and or according to forwarding information learned by the switches whether by operation of one or more protocols e.g. interior gateway protocols IGPs or by recording information learned during PDU forwarding. Each of network switches may represent a router a layer three L3 switch a layer three L2 switch an L2 L3 switch or another network device that switches traffic according to forwarding information. Accordingly PDUs forwarded by network switches A may include for example L3 network packets e.g. Internet Protocol packets and or L2 packets e.g. Ethernet datagrams or Asynchronous Transfer Mode ATM cells . PDUs may be unicast multicast anycast and or broadcast.

An overlay network layer of network includes overlay switches A B collectively overlay switches arranged in a virtual topology over a physical topology defined by network switches . For example each of network switches may include a data plane and typical routing and or switching protocols for controlling packet forwarding but may also expose the data plane to other software installed on the device to control packet forwarding within this overlay network using propriety or third party protocols. Individual links of the virtual topology of the overlay network or overlay links may be established paths through the base network and or physical links connecting overlay switches . The overlay network may represent a virtual private network VPN an OpenFlow network consisting of one or more OpenFlow switches or an application layer network with selection functionality built in to endpoint devices for example. Accordingly each of overlay switches may represent a router or routing instance e.g. a virtual routing and forwarding VRF instance a Virtual Private Local Area Network LAN Service VPLS instance a dedicated L2 L3 or L2 L3 switch or a virtual or soft switch e.g. an OpenFlow switch implemented by a router or by a dedicated switch for example. Overlay switch A for instance represents a dedicated overlay switch i.e. a physical switch that performs switching and or routing in response to control plane software configured to control the data plane of the switch. Overlay switch B in contrast is implemented by network switch A and may represent for instance a soft switch that utilizes the underlying data plane of network switch A. Network may include multiple overlay network layers of different or similar types e.g. multiple VPNs and or OpenFlow networks .

Topology server receives topology information from network switches for the base network of multi topology network . For example topology server may execute one or more IGPs or Exterior Gateway Protocols e.g. the Border Gateway Protocol BGP to listen to routing protocol advertisements sent by network switches . Topology server collects and stores the base network topology information then provides the base network topology information to multi topology path computation element PCE in base topology update messages . Topology information may include traffic engineering information for the network links such as the links administrative attributes and bandwidth at various priority levels available for use by label switched paths LSPs . In some examples network switches may send topology update messages to topology server that specify L2 link information for L2 links connecting the network switches. In some examples topology server is a component of PCE .

Overlay controller receives topology information for the overlay network of multi topology network in topology update messages sent by overlay switches in respective communication sessions . Topology update messages sent by overlay switches may include virtual and physical switch port information PDUs and associated metadata specifying respective ports and or interfaces on which PDUs are received. In some examples overlay controller is a routing protocol listener that executes one or more routing protocols to receive routing protocol advertisements sent by overlay switches . Such routing protocol advertisements may be associated with one or more VRFs for instance. Overlay controller collects and stores the overlay topology information then provides the overlay topology information to PCE in overlay topology update messages . In some examples overlay controller is a component of PCE .

Network switches may be configured to or otherwise be directed to establish paths through the base network of multi topology network . Such paths may include for instance IP tunnels such as Generic Route Encapsulation GRE tunnels General Packet Radio Service GPRS Tunneling Protocol GTP tunnels LSPs or a simple route through the base network or a VPN identified by a static route with a route target for instance . Network switches provide path status information for paths established through the base network of multi topology network to PCE in communication sessions . Path status alternatively path state or LSP state information may include descriptors for existing operational paths as well as indications that an established path or path setup operation has failed. For example network switch A may attempt establish an LSP using a reservation protocol such as Resource reSerVation Protocol RSVP but fail due to insufficient network resources along a path specified by an Explicit Route Object ERO . As a result network switch A may provide an indication that the path setup operation failed to PCE in a communication session . PCE receives path status information and adds established paths through the base network of network as links in the overlay network topology.

PCE presents an interface by which clients A N collectively clients may request a dedicated path often for a specific time between any combination of network entities such as enterprise network and service node . Generally clients may request paths that conform to bandwidth host and time path parameters quality of service QoS path request parameters such as latency and jitter and may further specify additional associated classifiers to identify a flow between the specified endpoints. Example flow classifiers or parameters are provided below. Moreover PCE may present an interface by which client may request services to be applied to network traffic originating from networks owned and operated by respective ones of clients .

PCE uses base network topology information for network received from topology server overlay network topology information for network received from overlay controller and path status information received from network switches to compute and schedule paths between network entities through network that satisfy the parameters for the paths requested by clients . PCE may receive multiple path requests from clients that overlap in time. PCE reconciles these requests by scheduling corresponding paths for the path requests that traverse different parts of network and increase capacity utilization for example or by denying some of the path requests.

At the scheduled time for a scheduled path PCE installs forwarding information to network nodes e.g. overlay switches and network switches to cause the nodes to forward traffic in a manner that satisfies the requested path parameters. A requested path may traverse either or both domains of network . That is a requested path may traverse either or both of the base network and overlay network of multi topology network . For example a requested path for traffic may traverse only the base network domain as a simple network route for instance from network switch A to network switch B. However some paths may traverse multiple domains. For example any requested path for traffic between a network entity coupled to overlay switch B such as enterprise network and a network entity coupled to network switch B such as service node first traverses the overlay network domain and then traverses the base network domain.

PCE installs forwarding information to overlay switches using overlay controller . Overlay controller presents a programming interface by which PCE may add delete and modify forwarding information in overlay switches . Forwarding information of overlay switches may include a flow table having one or more entries that specify field values for matching PDU properties and a set of forwarding actions to apply to matching PDUs. A set of one or more PDUs that match a particular flow entries represent a flow. Flows may be broadly classified using any parameter of a PDU such as source and destination MAC and IP addresses a Virtual Local Area Network VLAN tag transport layer information a Multiprotocol Label Switching MPLS or Generalized MPLS GMPLS label and an ingress port of a network device receiving the flow. For example a flow may be all PDUs transmitted in a Transmission Control Protocol TCP connection all PDUs sourced by a particular MAC address or IP address all PDUs having the same VLAN tag or all PDUs received at the same switch port.

PCE invokes the programming interface of overlay controller by sending overlay network path setup messages directing overlay controller to establish paths in the overlay network of network and or steer flows from hosts onto established paths. Overlay controller responds to overlay network path setup messages by installing to overlay switches using communication sessions forwarding information that implements the paths and or directs flows received from hosts onto established paths.

PCE installs forwarding information to network switches using communication sessions . Each of network switches may present a programming interface in the form of a management interface configuration interface and or a path computation client PCC . PCE may invoke the programming interface of network switches to configure a tunnel e.g. an LSP install static routes configure a VPLS instance configure an Integrated Routing and Bridging IRB interface and to otherwise configure network switches to forward packet flows in a specified manner. In some instances PCE directs one or more of networks switches to signal a traffic engineered LSP TE LSP through the base network of network to establish a path. In this way PCE may program a scheduled path through network by invoking a programming interface of only the head network device for the path.

PCE may in some instances remove a path invoking the programming interfaces of network switches and overlay switches to remove forwarding information implementing the requested paths. In this way PCE frees resources for future paths.

Because PCE has an enhanced view of the current state of the network at both the overlay network layer and base network PCE may identify paths that are not visible to any one of network switches or overlay switches having a more limited view. PCE may additionally by virtue of having access to this enhanced view steer traffic to underutilized portions of network to increase capacity utilization of network including to those service nodes that are underutilized. In addition centralizing the path computation and establishment with PCE may allow network operators to reconcile multiple possibly conflicting application path requests and may reduce first in time first in right access to network resources in favor of explicit centralized prioritization of application requests for dedicated paths. More information regarding path computation and establishment PCEs OpenFlow and other aspects related to the formation of paths within network by external orchestrating or coordinating devices may be found in U.S. patent application Ser. No. 13 339 983 entitled MULTI TOPOLOGY RESROURCE SCHEDULING WITHIN A COMPUTER NETWORK filed Dec. 29 2011 the entire contents of which are hereby incorporated by reference.

To illustrate an example path configured for enterprise network client A which may represent a network administrator of enterprise network or of a service provider network to which enterprise network subscribes to gain access to a public network e.g. the Internet may establish a path to service node in response to enterprise purchasing URL filtering services for enterprise network . Service node may in this example represent a service node that performs a URL filtering service to filter uniform resource locators URLs based on the content associated with requested URLs. PCE may orchestrate path by first computing path from overlay switch B through network switch B to service node and then configuring overlay switches B and network switch B to support delivery of traffic from enterprise network to service node via path . PCE may install filters that have admit and or deny criteria for traffic entering path via overlay switch B. In this example PCE may install filters associated with path that only admit and or deny traffic from enterprise network . The association of filters to control admission of traffic to path effectively limits admission of traffic to application of parental control services performed by service node . As a result these paths may be referred to as service engineered paths which is commonly abbreviated as SEP in the sense that these paths are engineered to steer traffic in an efficient manner so that one or more services may be applied to this traffic. In this sense path in this example is engineered to provide parental control services to traffic originated form enterprise network .

In this sense PCE acts as an orchestrating device and or software driving network which may be characterized as a software defined network in the sense that PCE performs path computation and directs configuration of the computed paths or SEPs rather than switches and themselves. That is network is configured externally via software executing on a device removed from network i.e. PCE in this example. In this respect the orchestrating software may define these SEPs to suit a particular service in terms of defining filters tailored for that service. In the previous example PCE configured SEP to promote utilization of service node . Typically switches or other network devices in order to provide a service included a service node that directly coupled to the switches or other network devices that also coupled to the network entity requiring the service application. Thus in the example of the service provider would have updated overlay switch B to include a service blade or node that performs parental control services in response to enterprise network requesting such services. However using software defined network PCE may configure SEP to service node coupled to network switch B which is a different switch to which enterprise network connects thereby promoting increased utilization of service node through service sharing.

While SEPs may provide for service sharing and enable other network devices to forward traffic via a path that meets the needs of the service application e.g. in terms of quality of service QoS provided bandwidth etc. often network administrations must statically configure or otherwise specify the location of the service and various parameters associated with the service. Thus when deploying new services within a network the network administrator must update this database of service related information so that the orchestrating software may configure SEPs through the network directing traffic to these services. Manual entry of this data is both time consuming and prone to human error. Moreover network administrators may not update this data as various service parameters change over time potentially resulting in inefficient utilization of the service.

In accordance with the techniques described in this disclosure rather than require network administrators to manually specify the services and service related parameters the techniques described in this disclosure may enable service node to advertise services provided by service node as well as service related parameters associated with those services provided by service node within network . Service node may advertise these services in accordance with the techniques described in this invention using as one example a type length value TLV field of a routing protocol message to store what may be referred to as service discovery information. Service node may in some examples flood this routing protocol message throughout network where topology server may receive this message and parse the service discovery information from message .

Service node may also in some instances generate a label mapping message mapping each service or instance of the same service to a different label and forward this label mapping message to network . This label mapping message may enable PCE to establish path such that overlay switch B pushes this label onto the label stack before pushing on the label associated with path . This inner label associating the traffic with the service may enable service node to determine to which service the traffic is associated.

The orchestrating software e.g. PCE of software defined network may receive this service discovery information via topology update messages sent by topology server and automatically update a service directory which may refer to a database associated with the orchestrating software that stores information concerning services to include the service discovery information that is the information describing the services and service parameters of those services provided by service node . PCE may also receive this label mapping message via topology server and update the appropriate entries in the service directory to associate the various services with the labels. PCE after learning of the services may then receive requests from clients requesting this service and configure one or more service engineered paths SEPs such as path through software defined network that utilize the advertised service provided by service node .

For example in the above illustration where client A requests a URL filtering service to be applied to all traffic originating from enterprise network PCE may access the service directory and identify those service nodes in network that provide a URL filtering services. Assuming service discovery information sent by service node via routing protocol message identifies a URL filtering service PCE may select service node as the service node that services traffic from enterprise network . PCE may then interface with overlay switch B network switch B and service node to configure path through network . PCE may also install one or more filters in overlay switch B to restrict access to path such that only traffic originating from enterprise network may enter path . These filters may also specify actions such as pushing labels onto the label stack appended to each packet admitted to path . These filters may specify that the inner service identifying label is first pushed onto the label stack and the second outer label associating the traffic with path is to be pushed onto the label stack second. In this way service node may automatically meaning without requiring any user or administrator intervention advertise service discovery information for consumption by an orchestrating device that configures paths through network .

In addition while not shown in the example of routers and other network devices may receive routing protocol message and label mapping message and independently configure paths through the network that utilize the advertised service. In this way the techniques may avoid manual entry of service related information and thereby potentially reduce administrative burdens and occurrence of incorrectly entered service data.

In operation service node determines one or more services provided by the service node . Often service node performs this determination after being powered up or otherwise activated or enabled. Alternatively service node may monitor service modules that perform these services to identify which of the services are activated or otherwise enabled and continually perform this determination generating the routing protocol message not just upon start up or powering up but in response to any changes in the operational status of the one or more services. In any event service node may generate routing protocol message that includes service discovery information related to the one or more services provided by service node transmitting routing protocol message to enable network devices of network to discover the one or more services to be provided by service node based on the service discovery information included in routing protocol message . Service node may also generate and transmit the above noted label mapping message .

In the example of topology server receives this routing protocol message parses routing protocol message to retrieve the service discovery information and provides this service discovery information to PCE via one of topology update messages . PCE which as noted above may include topology server receives routing protocol message that includes service discovery information describing the one or more services provided by service node . PCE may similarly receive this label mapping message and update the service directory to associate the corresponding services with the mapped label. PCE then configures path in the manner described above through network from an ingress network device i.e. switch B in the example of requesting at least one of the services described by the service discovery information to service node such that service node applies the at least one of the services to network traffic received via path .

Service node then receives traffic via path established based on the service discovery information included in routing protocol message and label mapping information . Service node then applies the at least one of the services to the traffic received via path based on the inner label which may be referred to as a service label . In this manner service node may automatically advertise services provided by service node using service discovery information so as to enable another network device e.g. PCE to establish paths through network to utilize these services without requiring an administrator of network to manually update a service directory in PCE to include services provided by service node .

While described above as being performed by an orchestrating device and or software the techniques may also be implemented with respect to a more distributed network in which the network devices of the network independently form paths through the network to service node . In this respect the ingress network device i.e. overlay switch B in this example to path may receive routing protocol message especially when routing protocol message is a link state routing protocol message that is flooded throughout network . Overlay switch B may then establish path itself using RSVP TE or another multi protocol label switching MPLS protocol and install filters restricting access to path to traffic originating from enterprise network . In signaling path overlay switch may signal that traffic sent via path is to require one or more of the services specified as being provided by service node such that service node configures the switching or forwarding elements to direct this traffic to the appropriate one or more of the services. Consequently the techniques should not be limited strictly to the examples provided above but may be implemented with respect to other non software defined networks.

PCE includes a control unit and a network interface not shown to exchange packets with other network devices. Control unit may include one or more processors not shown in that execute software instructions such as those used to define a software or computer program stored to a computer readable storage medium again not shown in such as non transitory computer readable mediums including a storage device e.g. a disk drive or an optical drive or a memory such as Flash memory or random access memory RAM or any other type of volatile or non volatile memory that stores instructions to cause the one or more processors to perform the techniques described herein. Alternatively or additionally control unit may comprise dedicated hardware such as one or more integrated circuits one or more Application Specific Integrated Circuits ASICs one or more Application Specific Special Processors ASSPs one or more Field Programmable Gate Arrays FPGAs or any combination of one or more of the foregoing examples of dedicated hardware for performing the techniques described herein.

Clients such as clients shown in the example of request paths through a network using client interface . In general a path request includes a requested date time a required bandwidth or other constraint and at least two endpoints. Client interface may also represent an interface with which clients may request a service such as any of the services listed above provided by service node . In some instances the path request noted above may be expressed in the form of a service request where client requests a service and PCE establishes a path to direct traffic to the service node that provides the requested service. In this sense a service request may represent a service engineered path request or a SEP request . Client interface may be a command line interface CLI or graphical user interface GUI for instance. Client may also or alternatively provide an application programming interface API such as a web service. A user uses a client application to invoke client interface to input path request parameters and submit the request to PCE . Client interface receives path requests from clients and pushes the path requests to path request queue a data structure that stores path requests for computation distribution by path manager .

To compute and schedule paths through a network intelligently PCE receives topology information describing available resources at multiple layers of the network. Topology server interface illustrated as topology server IF executed by control unit of PCE communicates with a topology server to receive topology information for a base network layer of the network while overlay controller interface communicates with an overlay controller to receive topology information for an overlay network layer of the network. Topology server interface may include a routing protocol daemon that executes a routing protocol to receive routing protocol advertisements such as Open Shortest Path First OSPF or Intermediate System to Intermediate System IS IS link state advertisements LSAs or BGP UPDATE messages. Topology server interface may in some instances be a passive listener that neither forwards nor originates routing protocol advertisements.

In this example topology server interface receives topology information that includes traffic engineering TE information. Topology server interface may for example execute Intermediate System to Intermediate System with TE extensions IS IS TE or Open Shortest Path First with TE extensions OSPF TE to receive TE information for advertised links. Such TE information includes one or more of the link state administrative attributes and metrics such as bandwidth available for use at various LSP priority levels of links connecting routers of the domain. In some instances topology server interface executes Border Gateway Protocol to receive advertised TE information for inter AS and other out of network links. Additional details regarding executing BGP to receive TE info are found in U.S. patent application Ser. No. 13 110 987 filed May 19 2011 and entitled DYNAMICALLY GENERATING APPLICATION LAYER TRAFFIC OPTIMIZATION PROTOCOL MAPS which is incorporated herein by reference in its entirety.

Topology server interface may in some instances receive a digest of topology information collected by a topology server rather than executing a routing protocol to receive routing protocol advertisements directly. Topology server interface stores base network topology information with TE information in multi topology traffic engineering database illustrated as multi topology TED hereinafter MT TED which is stored by a computer readable storage medium of control unit for use in path computation. MT TED is described in further detail below.

Overlay controller interface illustrated as overlay controller IF represents a module that may implement a standardized interface such as OpenFlow to receive topology information from an overlay controller such as an OpenFlow controller that describes overlay network links connecting overlay switches. In general overlay network links are not advertised by network switches e.g. routers of the base network for the overlay network and so will not be described by topology information received by topology server interface . An overlay controller augments the base network topology with overlay network topology links by providing overlay network topology information to overlay controller interface which stores the overlay network topology information to MT TED . Overlay controller interface may receive topology information for multiple different overlay networks including VPNs and or OpenFlow networks. Different overlay networks may require different instances of overlay controller interface that communicate with network switches of the overlay network or with a topology server for example to receive overlay network topology information for respective overlay networks.

Multi topology traffic engineering database stores topology information for a base network layer and one or more overlay network layers of a network that constitutes a path computation domain for PCE . MT TED may organize topology information for respective network layers hierarchically with the base network topology information supporting the topology information for one or more overlay networks. Paths in a lower layer topology may appear as links in a higher layer topology. For example tunnels e.g. TE LSPs created in the base network layer can appears as links in an overlay network TE topology. PCE may then correlate overlay network links with paths established in the base network layer to efficiently compute paths that cross multiple overlay topologies. MT TED may include one or more link state databases LSDBs where link and node data is received in routing protocol advertisements received from a topology server and or discovered by link layer entities such as an overlay controller and then provided to PCE via overlay controller interface . In some instances an operator may configure traffic engineering or other topology information within MT TED via operator interface .

Topology server interface may also receive from a topology server or by execution of routing protocols to receive routing protocol advertisements that include reachability information endpoint information that describes endpoints reachable by specified nodes in any of the network topologies. Topology server interface may receive endpoint information for a base layer of the network as well as for one or more services e.g. VPNs provided by the network that may correspond to overlay networks of the network. Endpoint information may associate network address prefixes with a nodes of the multi topology network layers where network address prefixes may be e.g. IPv4 or IPv6. For example topology server interface may receive a BGP UPDATE message advertising a particular subnet as reachable from a particular node of the base network. As another example topology server interface may receive an Application Layer Traffic Optimization ALTO map that includes PIDs associating respective nodes of a multi topology network layer with network address prefixes reachable from the nodes. Endpoints that have network addresses that are members of the subnet are therefore reachable from the node and PCE may calculate paths for those endpoints to terminate i.e. begin or end at the node. Topology server interface stores endpoint information received for a layer to a corresponding one of endpoint databases A K illustrated as endpoint DB A K and collectively referred to as endpoint databases where K refers to a number of layers of the multi topology network that constitutes a path computation domain for PCE . Some of endpoint databases may therefore be associated with respective service instances e.g. respective VPNs that constitute overlay network layers of a multi topology network. PCE may therefore use endpoint databases to locate and validate endpoints specified in path requests received from clients.

Each of service path engines A K collectively SPEs compute requested paths through a layer of the multi topology network with which it is associated and for which it is responsible. Control unit may execute multiple SPEs concurrently e.g. as separate processes. Each of SPEs is associated with a corresponding one of generated path databases A K illustrated as generated path DB A K and collectively referred to as generated path databases . Path manager dequeues path requests from path request queue and assigns path requests to SPEs based on the layer of the multi topology network in which the endpoints reside as determined by path manager from endpoint databases . That is endpoints reachable by layers of a multi topology network that is a path computation domain for PCE are stored by at least one of endpoint databases and path manager determines the one or more endpoint databases that include endpoints specified for a dequeued path request.

Paths are unidirectional. If a client requests a bidirectional path path manager triggers two path requests for the requested path one for each direction. In some cases a path may cross multiple layers of the network e.g. at a gateway to the base layer that is implemented by one of the overlay network nodes or at a network node that participates in multiple overlay networks. In such cases multiple SPEs may cooperate to compute segments of the multi layer path that path manager stitches together at the gateway. Upon computing paths SPEs schedule the paths by storing the paths to respective generated path databases . A scheduled path stored in one of generated path databases includes path information used by path manager to establish the path in the network and may include scheduling information used by scheduler to trigger path manager to establish the path. As described in further detail below path scheduling may require locking generated path databases to perform path validation prior to committing the path.

When servicing a path request received from path manager an SPE may initially validate the request by determining from endpoint databases that the endpoints for the requested path whether expressed as logical interfaces or network addresses are known to PCE i.e. exist within the path computation domain of PCE . SPE may additionally validate flow classifiers to ensure that the flow classifiers specified for a requested path exist. If initial validation fails for either both of these reasons SPE rejects the requested path and path manager sends a path rejection message detailing the reasons to the requesting client via client interface .

To compute a requested path at a layer of a multi topology network a service path engine for the layer uses MT TED and the corresponding one of generated path databases for the layer to determine whether there exists a path in the layer that satisfies the TE specifications for the requested path for the duration of the requested time. SPEs may use the Djikstra constrained SPF CSPF and or the Bhandari Edge disjoint shortest pair for determining disjointed main and backup paths path computation algorithms for identifying satisfactory paths though the multi topology network. If a satisfactory computed path for the requested path exists the computing service path engine for the layer re validates the computed path and if validation is successful schedules the computed path by adding the computed path to the one of generated path databases for the layer. In addition the computing one of SPE adds the requested path start complete times to scheduler if any . A computed path added to one of generated path databases is referred to as a scheduled path until such time as path manager programs the scheduled path into the multi topology network whereupon the scheduled path becomes an active path. A scheduled or active path is a temporarily dedicated bandwidth channel for the scheduled time in which the path is or is to become operational to transport flows.

As noted above generated path databases store path information for scheduled and active paths. Path information may include an ERO that specifies a list of overlay or base network nodes for a TE LSP routes or tunnels to be configured in one or more overlay network or base network nodes forwarding information for overlay network nodes specifying respective sets of forwarding actions which may also be referred to as forwarding filters or filters to apply to PDUs inbound to the overlay network nodes and or any other information usable by any of topology node interfaces to establish and steer flows onto scheduled paths in a multi topology network.

SPEs compute scheduled paths based upon a current state or snapshot of the multi topology network as represented by MT TED and generated path databases . Because multiple SPEs execute simultaneously in this example to compute and schedule paths through the multi topology network multiple SPEs may attempt to update generated path databases simultaneously which could in some cases result in network resource oversubscription and failure by PCE to satisfy requested paths. One of SPEs may therefore having computed a path execute a transaction that conforms to the ACID properties atomicity consistency isolation durability or another type of atomic transaction to both re validate and update generated path databases with a scheduled path. That is the SPE may first lock generated path databases to prevent other SPEs from modifying generated path databases . The SPE may then validate the computed path against the locked generated path databases as well as MT TED . If the computed path is valid the SPE updates generated path databases by adding the computed path as a scheduled path. The SPE then unlocks generated path databases . In this way all affected links are updated in the same transaction and subsequent path validations by other SPEs account for the updates. SPEs may use any suitable data structure locking mechanism such as monitors mutexes or semaphores to lock generated path databases .

If the SPE fails to validate a previously computed path the SPE attempts to re compute the path. Upon identifying a satisfactory path against the current snapshot of the multi topology network the SPE again attempts to validate the computed path and update generated path databases .

In some cases SPEs may be unable to identify a path through an overlay network with which to satisfy a path request. This failure may be due to any of a number of factors. For example sufficient network resources with which to satisfy the path request may be unavailable for the scheduled time due for instance to previously scheduled paths that include one or more links of the base network layer for any possible paths between the endpoints of the path request at an overlapping time. In this example path computation fails. In other words one or more paths between the endpoints of the path request exist but the paths are already sufficiently subscribed to prevent the additional reservation of adequate resources for the requested path. As another example SPEs may be unable to identify any paths through an overlay network between the endpoints of the path request because the computation failed due to a missing link in the overlay network. In other words the computed overlay network graph after removing unusable edges unable to satisfy path request constraints includes two disjoint subgraphs of the overlay network. However in this case a suitable path may be generated by creating a tunnel through the base layer between the subgraphs for the overlay network.

Where path computation fails because sufficient network resources do not exist at the requested time the computing SPE may consider policies set by an operator via operator interface that establish priorities among clients of PCE and or among path request parameters including bandwidth hosts time and QoS parameters as well as flow classifiers. A policy of policies may prioritize the requested path for which path computation failed over and against one or more scheduled paths of generated path databases . In such instances the computing SPE may preempt one or more of these scheduled paths by removing again in accordance with policies the paths from generated path databases and scheduler . In addition the computing SPE in such instances enqueues the removed paths as path requests to path request queue . Components of PCE may then again attempt to compute satisfactory paths for the path requests corresponding to paths removed from generated path databases . Where SPEs are unable to identify a satisfactory path for such a path request SPEs direct path manager to send a path rejection message to a requesting client that issued the path request via client interface . In effect PCE revokes a grant of scheduled multi topology network resources made to the requesting client.

Where path computation fails due to a missing link between disjoint subgraphs of an overlay network each providing reachability to respective endpoints for a requested path the computing SPE requests one of tunnel managers A K collectively tunnel managers to establish a tunnel in a lower layer of the multi topology network. For example one of SPEs for an overlay network may request a tunnel in a lower layer overlay network or in the base network layer. Each of tunnel managers is associated with one of the layers of the multi topology network and with one of generated path databases . In other words each of tunnel managers manages tunnels for one of the topologies.

Tunnel managers operate as intermediaries between generated path databases and SPEs . A higher layer SPE of SPEs may request a lower layer one of tunnel managers to establish a tunnel between two nodes of the lower layer to create a link in the higher layer. Because a tunnel traverses two layers of the multi topology network each of the two nodes may straddle the two layers by having an ingress and egress interface coupling the two layers. That is a first one of the two nodes may be an ingress network switch having an ingress interface to the base network layer while a second one of the two nodes may be an egress network switch having an egress interface from the base network layer. The tunnel manager in response may enqueue a path request specifying the two nodes in the lower layer of the multi topology network to path request queue . If a lower layer SPE is able to schedule a path for the path request this path becomes a link in the lower layer generated path database and the lower layer SPE notifies the requesting one of tunnel managers with link tunnel information for the link. The tunnel manager propagates this tunnel information to MT TED which triggers the higher layer SPE that a new link is available in the higher layer topology and prompts the higher layer SPE to reattempt computing a satisfactory path for the original requested path. Tunnel managers may also validate tunnel setup at their respective layer of a multi topology network.

Scheduler instigates path setup by tracking scheduled start times for scheduled paths in generated path databases and triggering path manager to establish the scheduled paths at their respective start times. Path manager establishes each scheduled path using one or more of topology node interfaces including overlay controller interface device management interface and network switch interface . Different instances of PCE may have different combinations of topology node interfaces .

Path manager may invoke the overlay controller interface to sending overlay network path setup messages e.g. overlay network path setup messages of directing an overlay controller to establish paths in an overlay network and or steer flows from hosts onto established paths in accordance with path information for scheduled paths in generated path databases . In this way PCE may program paths according to a permanent virtual circuit PVC or hop by hop model by programming forwarding state in network and or overlay switches to execute the paths being programmed. As noted above one or more of these paths may include filters that admit or deny traffic to the path. SPEs may provide these filters to path manager which may install these filters in the ingress switches.

Device management interface may represent a Simple Network Management Protocol SNMP interface a Device Management Interface DMI a CLI or any other network device configuration interface. Path manager may invoke device management interface to configure network switches e.g. routers with static routes TE LSPs or other tunnels in accordance with path information for scheduled paths in generated path databases . Network switch interface establishes communication sessions such as communication sessions of with network switches to receive and install path state information and to receive path setup event information. Network switch interface may be a PCE protocol PCEP interface a DMI or SNMP interface for example.

Path manager may invoke device management interface and or network switch interface to configure and direct network switches to establish paths in a base network layer or overlay network layer of a multi topology network. For example path manager may first configure a TE LSP within a network switch at a network edge then direct the network switch to signal a path for the TE LSP using RSVP with traffic engineering extensions RSVP TE or another signaling protocol. In this way PCE may program paths including TE LSPs into the network according to a soft PVC SPVC model. In this model the network presents a programming interface that PCE invokes to dynamically set up the SPVCs. In some examples PCE may use a combination of PVC and SPVC models to program paths into a multi topology network.

Upon receiving confirmation from topology node interfaces that a scheduled path setup is successful path manager transitions a status of the scheduled path in generated path databases to active. At the scheduled end time if any for an active path scheduler notifies path manager to tear down the active path using topology node interfaces . After tearing down the path path manager removes the path from generated paths .

In accordance with the techniques described in this disclosure topology server interface executed by control unit of PCE may receive routing protocol messages such as routing protocol message that include service discovery information where this service discovery information may include information describing service provided by service nodes and service parameters related to the services provided by the service nodes. Topology server interface may parse this service discovery information and store this information to endpoint DBes effectively forming what may be referred to as a service directory. In some instances topology server interface may receive routing protocol messages that include service discovery information from newly installed or deployed service nodes. As a result no entry in endpoint DBs may be associated with the service node identified by the routing protocol message and topology server interface may create a new entry in endpoint DBes storing the service discovery information to this newly created entry in endpoint DBes .

Topology server interface may also receive label mapping messages such as label mapping message mapping labels to one or more services advertised by service nodes. Topology server interface may parse this label mapping and update service directory .

After updating this service directory PCE may receive SEP requests from clients via client interface . These SEP requests as noted above may request a particular service without providing any of the other data normally associated with a path request. Client interface may enter this path request to path request queue which when processed may cause PCE to resolve the client to a particular endpoint device associated with the client. In the example of the client is assumed to own and operate enterprise network which interfaces with overlay switch B. Path manager may provide this path request to one of service path engines which may resolve the path request by determining from which client this path request was entered. Referring back to the example of the one of service path engines e.g. service path engine A handling this SEP request may determine that client A is associated with overlay switch B and determine the first endpoint device for the to be established SEP as overlay switch B. Service path engine A may next resolve the second endpoint of SEP by accessing service directory to identify one of service nodes in network that provides the service specified in the service request. Service path engine A may then establish SEP in the manner described above. In this way PCE may automatically receive service discovery information and label mapping information update service directory and establish SEPs based on the automatically updated service directory .

Some examples of router may not include the full functionality described and illustrated. For instance some examples of router may include different combinations of PCC B OpenFlow switch and IRB interface rather than all such components. Moreover while described with respect to a particular network device e.g. a router aspects of the techniques may be implemented by any network device or combination of network devices. The techniques should therefore not be limited to the exemplary embodiments described in this disclosure.

Router includes a control unit and interface cards A N collectively IFCs coupled to control unit via internal links. Control unit may include one or more processors not shown in that execute software instructions such as those used to define a software or computer program stored to a computer readable storage medium again not shown in such as non transitory computer readable mediums including a storage device e.g. a disk drive or an optical drive or a memory such as Flash memory random access memory or RAM or any other type of volatile or non volatile memory that stores instructions to cause the one or more processors to perform the techniques described herein. Alternatively or additionally control unit may comprise dedicated hardware such as one or more integrated circuits one or more Application Specific Integrated Circuits ASICs one or more Application Specific Special Processors ASSPs one or more Field Programmable Gate Arrays FPGAs or any combination of one or more of the foregoing examples of dedicated hardware for performing the techniques described herein.

In this example control unit is divided into two logical or physical planes to include a first control or routing plane A control plane A and a second data or forwarding plane B data plane B . That is control unit implements two separate functionalities e.g. the routing control and forwarding data functionalities either logically e.g. as separate software instances executing on the same set of hardware components or physically e.g. as separate physical dedicated hardware components that either statically implement the functionality in hardware or dynamically execute software or a computer program to implement the functionality.

Control plane A of control unit executes the routing functionality of router . In this respect control plane A represents hardware or a combination of hardware and software of control unit that implements routing protocols. In this example routing protocol daemon RPD is a process executed by control unit that executes routing protocols B illustrated as RPs B by which routing information stored in routing information base RIB and traffic engineering information stored in traffic engineering database TED may be determined. In addition RPD may establish peering sessions for one or more routing protocols B with another router route reflector or routing protocol listener e.g. an application layer traffic optimization ALTO server and send L3 topology and or traffic engineering in RIB and or TED to the peers.

Routing protocols B may include for example IGPs such as OSPF TE or IS IS TE and or exterior gateway protocols such as BGP TE. RIB and TED may include information defining a topology of a network such as the base network layer of multi topology network of . Routing protocol daemon may resolve the topology defined by routing information in RIB to select or determine one or more routes through the network. Control plane A may then update data plane B with these routes where data plane B maintains these routes as forwarding information .

Forwarding or data plane B represents hardware or a combination of hardware and software of control unit that forwards network traffic in accordance with forwarding information . RIB may in some aspects comprise one or more routing instances implemented by router with each instance including a separate routing table and other routing information. Control plane A in such aspects updates forwarding information with forwarding information for each of routing instances . In this respect routing instances each include separate forwarding information for use by data plane B in forwarding traffic in accordance with the corresponding routing instance. Further details of one example embodiment of a router can be found in U.S. patent application Ser. No. 12 182 619 filed Jul. 30 2008 and entitled STREAMLINED PACKET FORWARDING USING DYNAMIC FILTERS FOR ROUTING AND SECURITY IN A SHARED FORWARDING PLANE which is incorporated herein by reference.

Control plane A further includes management interface by which a network management system or in some instances an administrator using a command line or graphical user interface configures in VPN module one or more VPN instances for a network to interconnect combinations of L2 networks into a single Ethernet domain. For example an administrator may configure router as a participant in a particular VPN instance such as VPN instance . VPN module may perform auto discovery or other techniques to determine additional routers participating in a VPN instance and additionally performing signaling techniques to establish a full mesh of pseudowires between router and each of the additional routers.

Data plane B includes one or more forwarding units such as packet forwarding engines PFEs that provide high speed forwarding of network traffic received by interface cards via inbound links A N to outbound links A N. Integrated routing and bridging interface IRB interface of data plane B processes and forwards network traffic received on interfaces associated with the IRB interface . An administrator may configure IRB interface via management interface to map routing interface of IRB interface to one of routing instances of router . Routing interface may represent a next hop or other reference of a logical interface IFL of IRB interface for example. In some embodiments aspects of data plane B are distributed to a number of distributed forwarding units such as packet forwarding engines each associated with a different one or more IFCs . In these embodiments IRB interface may be may be distributed to the distributed forwarding units to enable high speed integrated routing and bridging within the data plane.

Router implements VPN instance associated with IRB interface to operate as a virtual switch to interconnect multiple L2 networks. VPN instance maps a gateway L2 address e.g. a gateway MAC address to routing interface which maps to one of routing instances . In this respect the gateway L2 address maps to the routing instance. IRB interface classifies L2 PDUs received on an interface associated with VPN instance and destined for a gateway L2 addresses of VPN instance as L3 packets for routing using the one of routing instances mapped to routing interface . In other words when router receives an L2 PDU on an interface associated with VPN instance IRB interface determines the destination L2 address of the L2 PDU. When the destination L2 address matches the gateway L2 address mapped to routing interface IRB interface classifies the L2 PDU as an L3 packet and provides the L2 PDU to the mapped one of routing instances for L3 forwarding by data plane B. IRB interface may decapsulate the L2 PDU of the L2 header and footer. When a destination L2 address of an L2 PDU does not match the gateway L2 address VPN instance may switch the L2 PDU according to a matching flow entry of flow table . As a result router may operate as a gateway between an L2 overlay network layer and an L3 base network layer of multi topology network . In some instances IRB interface performs a prior logical operation to classify L2 PDU as either routing traffic or bridging traffic and then bridges the traffic or provides the traffic to a routing interface based on the result of classification.

Router implements OpenFlow switch to control switching of L2 PDUs among the set of virtual and or physical interfaces of router that are associated with VPN instance . Such interfaces may include attachment circuits for attaching L2 networks to VPN instance . OpenFlow protocol interface IF of control plane A establishes an OpenFlow protocol session with an OpenFlow controller to provide L2 topology information and to receive forwarding information. OpenFlow protocol IF installs flow entries received in the OpenFlow protocol session to flow table to direct forwarding of PDUs received on interfaces associated with the VPN instance . In some instances VPN instance includes a L2 learning table and performs L2 learning with respect to interfaces of router associated with VPN instance .

A network management system or in some instances an administrator using a command line or graphical user interface may invoke management interface to configure label switched paths described in LSP database illustrated as LSP DB . LSP database includes LSP configuration data for example an LSP destination path e.g. a Reported Route Object and LSP attributes such as setup priority and hold priority number of hops the reserved bandwidth and or a metric that has been optimized for the LSP e.g. an IGP metric a TE metric or hop counts . LSP database may also include information designating zero or more attributes of each configured LSP as delegable parameters that may be set modified by a PCE using extended PCEP to modify the operation of the LSP when set up in the network. LSP attributes may be divided into three categories 1 non delegable parameters that RPD applies immediately using RSVP A and that are neither re signalled nor overridden by a PCE 2 delegable parameters that RPD applies when the LSP is re signaled due e.g. to LSP failure and 3 delegable parameters that may be overridden by a PCE and trigger re signaling by RPD . All delegable LSP parameters may include a configured default value that RPD applies when for example a PCEP session terminates the PCE otherwise becomes unavailable or the PCE returns a delegation.

RPD sets up LSP described in LSP database by executing a resource reservation protocol which in this instance is RSVP B that signals other routers in the network to reserve resources and provide MPLS forwarding information to RPD for use in forwarding MPLS packets. Various instances of router may also or alternatively use RSVP TE or another Label Distribution Protocol LDP to signal LSPs. In addition RPD executes RPs B to receive traffic engineering information that affects the state of LSPs such as failed links and preempted resources that may result in a down state for LSPs. RPD may associate such LSP state information with corresponding LSPs in LSP database and may further directs path computation client B to send one or more LSP state reports to a PCE in response as described in further detail below.

Path computation client PCC B of control plane A mediates communication between RPD and a path computation element e.g. PCE of or . PCC B includes a PCE interface not shown that implements PCE communication protocol PCEP extensions to receive and send extended PCEP messages. The PCE interface also implements functionality for the operation of conventional PCEP such as path computation request reply messages.

Path computation client B establishes extended PCEP sessions with a PCE and sends via the extended PCEP sessions LSP state reports that include up to date LSP state for LSPs described in LSP state information. LSP state reports may be included in PCRpt messages. In this way PCC B maintains strict LSP state synchronization between router and the PCE which the PCE may use when computing paths for an overlay network that make use of the LSPs.

In addition PCC B may advertise router as allowing modification of delegable parameters. As a result LSP state reports sent by PCC B may in some case include a delegation that provides access rights to a PCE to modify parameters of the target LSP. In some instances the delegation may specify the particular parameters of the target LSP that are exposed for modification. PCC B may after delegating LSPs receive LSP update requests that specify LSP parameter modifications for one or more of the LSPs. LSP update requests may be included in PCUpd messages. PCC B in response notifies RPD of new parameters for target LSPs identified in LSP update requests. RPD may re signal the target LSPs in turn and as new LSPs are established switch traffic over to the new LSPs and send a notification to PCC B that the new LSPs have been successfully signaled. PCC B provides this updated LSP state in LSP status reports to a PCE with which router has extended PCEP sessions. Router thus extends existing RSVP TE functionality with an extended PCEP protocol that enables a PCE to set parameters for a TE LSP configured within the router. In this way router may implement an SPVC like model to allow a PCE to signal computed paths through a multi topology network thereby dynamically setting up end to end paths as requested by clients.

For example PCE may configure router to forward traffic along a path from an ingress network device e.g. router in this example to a service node such as service node in accordance with configuration data specified by PCE which may represent an external orchestrating device that computes and configures paths through the network and that does not forward any traffic through the network other than that used to compute and configure the paths through the network. The configuration data may be stored to various databases such as RIB TED and LSP DB to provide a few examples. The configuration data may define filters and other parameters that admit or deny traffic to path as described above including a label associated with a service to be applied by as one example service node . These filters may then be installed in flow table of VPN instance as filters . Filters may be associated with individual entries or may represent catch all filters to be applied for making classification decisions as noted above. In this sense flow table may represent a collection of filters for making decisions with respect to flows as to whether to admit or deny flows to VPN instance and perform other actions such as push a label onto a label stack. Data plane B which includes at least one interface e.g. IFCs then forwards the traffic along path to enable the service node to apply one or more services to the traffic.

While not shown explicitly in the example of router may also function outside of the context of a software defined network where RPS B may receive routing protocol messages such as IS IS messages OSPF messages and or BGP messages to provide a few examples. These messages may include routing information regarding the state of various links and or paths through network . RPS B may parse this routing information from the messages and store the routing information to RIB . RPS B may then resolve the routing information including any routing information received via the routing protocol messages to generate forwarding information for one or more routing instances. RPS B may then install this forwarding information as one or more routing instances . Data plane B may receive packets corresponding to these non software defined network routing instances as represented by one or more of routing instances and forward these packets in accordance with these ones of routing instances . Thus while described above as performing aspects related to the configuration and operation of a path in a software defined network router may also operate according to standard routing protocols where router resolves routing information itself and configure one or more routing instances of forwarding information as opposed to an orchestrating device external from router configuring one or more of routing instances .

Additionally RPS B of router may receive routing protocol message and label mapping messages . Router may itself without being directed by PCE establish a path similar to path for forwarding traffic originating from enterprise network to service node so that one or more services advertised or identified by the service discovery information are applied by service node to the traffic originating from enterprise network . In this respect ingress network device may be the same as the network device that receives the routing protocol message that includes the service discovery information and configure path through network to service node . To configure path router may configure a label switched path or establish a VPN through network to service node . The techniques should therefore not be limited to software defined networks but may be implemented with respect to any type of network in which network devices may establish paths through a network so that services are applied to traffic sent via the path.

Additionally router may receive service specific information related to the application of the one or more services to the traffic received via the path from service node where this service specific information may be received via what may be referred to as a feedback loop. Router may then adapt path based on this service specific information in a number of ways. More information regarding this feedback look the service specific information and the ways in which paths may be adapted is described in co pending U.S. patent application Ser. No. 13 534 121 entitled FEEDBACK LOOP FOR SERVICE ENGINEERED PATHS filed Jun. 27 2012 the entire contents of which are incorporated by reference herein.

Some examples of service node may not include the full functionality described and illustrated. For instance some examples of service node may include different combinations of PCC B OpenFlow switch B and IRB interface rather than all such components. Moreover while described with respect to a particular network device e.g. a router aspects of the techniques may be implemented by any network device or combination of network devices. The techniques should therefore not be limited to the exemplary embodiments described in this disclosure.

Service node includes a control unit and interface cards A N collectively IFCs coupled to control unit via internal links. Control unit may include similar to control unit of router one or more processors not shown in that execute software instructions such as those used to define a software or computer program stored to a computer readable storage medium again not shown in such as non transitory computer readable mediums including a storage device e.g. a disk drive or an optical drive or a memory such as Flash memory random access memory or RAM or any other type of volatile or non volatile memory that stores instructions to cause the one or more processors to perform the techniques described herein. Alternatively or additionally control unit may again similar to control unit of router comprise dedicated hardware such as one or more integrated circuits one or more Application Specific Integrated Circuits ASICs one or more Application Specific Special Processors ASSPs one or more Field Programmable Gate Arrays FPGAs or any combination of one or more of the foregoing examples of dedicated hardware for performing the techniques described herein.

In this example and different from router described above with respect to the example of control unit is divided into three logical or physical planes to include a first control or routing plane A control plane A a second data or forwarding plane B data plane B and a third service plane C. That is control unit implements three separate functionalities e.g. the routing control forwarding data and service functionalities either logically e.g. as separate software instances executing on the same set of hardware components or physically e.g. as separate physical dedicated hardware components that either statically implement the functionality in hardware or dynamically execute software or a computer program to implement the functionality.

Service plane C executes or otherwise provides one or more service modules . Service modules may each perform the same service or different services depending on the configuration of service plane C. These services may include a firewall service a NAT service an IDP service an URL filtering service an encryption service and any other type of service that may be performed in a network. In accordance with the techniques described in this disclosure control plane A includes a service monitoring module that monitors these service modules determining the services provided by service modules and service related parameters such as an operational state of service modules capacity information of service modules e.g. a number of flows that each of service modules may service types of transport supported by service modules and the like. Service monitoring module may generate service discovery information that includes the services provided by service modules and the service related parameters describing various aspects of the services provided by service modules .

Upon determining or otherwise generating this service discovery information service monitoring module may then pass this information to routing protocol daemon which may invoke one or more of RPS B. The invoked one or more of RPS B may process service discovery information generating a routing protocol message that includes this service discovery information. The invoked one or more of RPS B may then forward often flooding these messages to other routers and or switches that also implement the corresponding routing protocol thereby effectively advertising the service provided by service node to any device in network including PCE by way of topology server that snoops routing protocol messages sent within network .

RPS B may also generate a label mapping message mapping services to MPLS labels using service discovery information . For example each instance of a service may be identified by a service name e.g. IDP or Firewall and a service instance identifier which may comprise a number uniquely identifying this instance with respect to a given service node. Service discovery information may provide this service name and service instance identifier. The label mapping message may map a label provided by an MPLS protocol to this service instance such that service node associates the service instance with the label. The label may then be used to indicate to service node which traffic is associated with the particular service instance.

The MPLS protocol that provides the label may comprise a label distribution protocol LDP . That is LDP module C may associate a label with each service instance and generate a label mapping message. Alternatively one of RPS B such as a border gateway protocol BGP may carry label mapping information mapping the service instance to a label. IN any event service node may transmit this label mapping message to network where topology server may forward this label mapping information to PCE . In this manner PCE may learn of this mapping between service instance and label based on the label mapping message.

After advertising these services service node may receive forwarding information from PCE configuring a SEP such as SEP to terminate or otherwise traverse service node so that one or more of the services provided and advertised by service node is applied to the traffic received via SEP . The path may be configured in a manner generally consistent with that described above with respect to PCE and router . Service node may then receive traffic via this path re directing the traffic received via path to one or more of service modules which then apply the corresponding one or more services to the traffic. The traffic received via SEP may include the label service node advertised as being associated with the corresponding service instance. Based on this label service node may redirect the traffic to the corresponding one of service modules which may apply the service to the traffic. Service node may then forward the traffic to its intended destination or possibly another service node via another SEP which may apply additional services to the traffic.

While not shown explicitly in the example of service node may also function outside of the context of a software defined network where RPS B may receive routing protocol messages such as IS IS messages OSPF messages and or BGP messages to provide a few examples. These messages may include routing information regarding the state of various links and or paths through network . RPS B may parse this routing information from the messages and store the routing information to RIB . RPS B may then resolve the routing information including any routing information received via the routing protocol messages to generate forwarding information for one or more routing instances. RPS B may then install this forwarding information as one or more routing instances . Data plane B may receive packets corresponding to these non software defined network routing instances as represented by one or more of routing instances and forward these packets in accordance with these ones of routing instances . Thus while described above as performing aspects related to the configuration and operation of a path in a software defined network router may also operate according to standard routing protocols where router resolves routing information itself and configure one or more routing instances of forwarding information as opposed to an orchestrating device external from router configuring one or more of routing instances .

The routing protocol message may conform to one of any number of routing protocols. In some instances the routing protocol message may comprise an Intermediate System to Intermediate System IS IS routing protocol message that includes a type length value TLV field generally referred to as a generic information GENINFO TLV which is described in more detail in an Internet Draft provided by the Network Working Group of the Internet Engineering Task Force IETF entitled Advertising Generic Information in IS IS dated Nov. 10 2010 the entire contents of which are hereby incorporate by reference. The IS IS routing protocol message may include this GENINFO TLV which is partitioned into a set of APP sub TLVs for specifying the service service related parameters and operational state of the service.

In some instances the routing protocol message may comprise an Open Shortest Path First OSPF routing protocol message referred to as an opaque link state advertisement LSA . The opaque LSA may include a TLV that stores the service discovery information. Again this TLV may include additional sub TLVs for specifying the service service related parameters and operational state of the service. The opaque LSA may be advertised through an OSPF service discovery transport instance using the methods described in Internet Drafts provided by the Network Working Group of the Internet Engineering Task Force IETF entitled OSPF Transport Instance Extensions dated Oct. 10 2011 and OSPF Multi Instance Extensions dated Oct. 29 2011 the entire contents of each are hereby incorporate by reference as if both were set forth in their entirety herein.

RPS B may also generate a label mapping message mapping services to MPLS labels using service discovery information . For example each instance of a service may be identified by a service name e.g. IDP or Firewall and a service instance identifier which may comprise a number uniquely identifying this instance with respect to a given service node. The service discovery information may provide this service name and service instance identifier. The label mapping message may map a label provided by an MPLS protocol to this service instance such that service node associates the service instance with the label. The label may then be used to indicate to service node which traffic is associated with the particular service instance.

The MPLS protocol that provides the label may comprise a label distribution protocol LDP . That is LDP module C may associate a label with each service instance and generate a label mapping message in accordance with Request for Comments RFC 5036 provided by the Network Working Group of the IETF entitled LDP Specification dated October 2007 the entire contents of which are incorporated by reference. Alternatively one of RPS B such as a border gateway protocol BGP may carry label mapping information mapping the service instance to a label. More information concerning BGP and carrying label mapping information may be found in RFC 3107 of the IETF Network Working Group entitled Carrying Label Information in BGP 4 dated May 2001 the entire contents of which are hereby incorporated by reference.

In any event RPS B and or LDP C may transmit the RPM and label mapping message to network . For some interior gateway protocol IGP such as OSPF IS IS or other flooding or link state protocols transmitting RPM may involve flooding the RPM to every device in a portion of network or every device in network . In this way topology server may receive RPM and relay this RPM or at least the service discovery information to PCE such that PCE may receive RPM. Moreover label mapping messages may be forwarded throughout network where again topology server may provide this label mapping message to PCE . In this manner PCE may receive both the RPM and the label mapping message .

PCE may extract the service discovery information from the RPM and update service directory with the extracted service discovery information . Likewise PCE may extract the label mapping from the label mapping message and update service directory with the extracted label mapping . That is for each service instance PCE may associate a label with the service instance in service directory . At some point after receiving the RPM and label mapping message PCE may receive a request for one of the services advertised via the RPM from one of clients . PCE may then configure a SEP to service node from the ingress network device to which the client network connects to network i.e. overlay switch B in the example of . PCE may in configuring this SEP provide the label to overlay switch B so that overlay switch B may push the label onto a label stack appended to each packet of the network traffic originating from enterprise network . Overlay switch B may also be configured to push the label associated with SEP onto the stack which is used to switch the traffic to service node . Because the service label associating the packet with the service to be applied by service node is pushed onto the label stack first this label may be referred to as an inner label while the label associating the traffic with SEP may be referred to as the outer label because it is pushed onto the stack after the inner label.

Service node may then receive traffic via SEP and apply the requested service to the traffic receive via SEP . Service node may determine that one or more services provided by service modules are to be applied to the traffic received via SEP using the inner label appended to each packet of the network traffic. Service node may be configured to associate this inner label with one of service modules and forward packets having inner labels to one or more of service modules . The service module may then apply the requested services to the network traffic. Service node may then forward the traffic to its intended destination or possibly via another SEP to another service node .

Service node may continue to monitor service modules and generate RPMs having updated service discovery information. This updated service discovery information may contain updates about operational state and parameters. Service node may transmit these RPMs to network devices of network which may update their service directories accordingly and configure SEPs to service node to make use of the services provided by service node in view of the updated service discovery information.

PDU length field L stores a value indicating the entire length of the PDU including variable fields in octets. Remaining lifetime field M stores a value indicating a number of seconds before the link state protocol data unit LSP is considered expired. LSP ID field N stores a value identifying the system ID of the source of the LSP. Sequence number field O stores a sequence number of the LSP. Checksum field P stores a value defining a checksum of the contents of the LSP from the source ID to the end. P ATT LSPDBOL IS type fields Q T store a number of bits that are used to signal various functionalities and attributes of the source of the routing protocol message. More information regarding IS IS and IS IS PDUs is described in more detail in International Standard ISO IEC 10589 entitled Information Technology Telecommunications and Information Exchange Between Systems Intermediate System to Intermediate System Intra domain Routeing Information Exchange Protocol for Providing the Connectionaless Mode Network Service ISO 8473 dated Nov. 15 2002 the entire contents of which are hereby incorporated by reference.

While IS IS provides for extensions to the PDU in the form of variable length fields specified in accordance with a type length value TLV field format these extensible fields are reserved for communicating information related to the IS IS routing protocol. An extension to the IS IS routing protocol adapts IS IS for communicating generic information GENINFO that is not directly related to the operation of the IS IS protocol. This GENINFO extension is defined in a Network Working Group Internet Draft entitled Advertising Generic Information in IS IS dated Nov. 10 2010 which was incorporated by reference above. Using this extension to IS IS as one example the service discovery information described above may be encoded in a TLV denoted as service discovery information field . Service discovery information field may include sub fields defining a service name a service instance identifier an optional service instance VPN identifier a service instance parameter length a service instance parameters and a service instance operational state. Using this information routers switches and other network devices and orchestrating devices may automatically determine services provided by a service node parameters related to the services provided by the service node and operational state of the services provided by the service node.

While described above with respect to IS IS routing protocol the techniques may be implemented with respect to other routing protocols that provide for TLV or other fields to which service specific information may be stored. These other routing protocols may include OSPF and BGP to name a few examples. In this respect the techniques should not be limited to the IS IS routing protocol described above.

With respect to OSPF an opaque LSA may be defined that is referred to as a service enabling technology SET Discovery Opaque LSA having a SET discovery TLV. The SET discovery TLV may include sub TLVs defining the service name the service instance identifier the optional service instance VPN identifier the service instance parameter length the service instance parameters and the service instance operational state.

Various embodiments of the invention have been described. These and other embodiments are within the scope of the following claims.

