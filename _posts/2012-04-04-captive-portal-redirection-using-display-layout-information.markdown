---

title: Captive portal redirection using display layout information
abstract: According to one embodiment of the invention, a method for controlling access to a network by a network device comprises returning a message prompting connectivity to a captive portal that is different from a HTTP Source Code redirect. The message is an HTML document such as a frameset.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09332054&OS=09332054&RS=09332054
owner: ARUBA NETWORKS, INC.
number: 09332054
owner_city: Sunnyvale
owner_country: US
publication_date: 20120404
---
Embodiments of the present disclosure relate to the field of wireless communications and in particular a network device that is adapted to establish connectivity between the network device and an external captive portal without reliance on Hypertext Transfer Protocol HTTP Status Code redirects.

Recently wireless networks are being adapted to support Bring Your Own Device BYOD environments where all users are able to access a targeted wireless network through their personal devices such as laptop computers tablets or smartphones for example. As a result the number of devices per network user has grown from a one to one relationship to a one to many relationship as a network user may simultaneously or interchangeably connect multiple devices to a particular network.

Granting enterprise access to personal devices has direct implications on security and network control. Security challenges range from understanding who and what is connected to the network to ensuring that those connected unauthenticated devices have restricted for access to network resources. One way to handle such security issues is through the use of a captive portal.

 Captive portal is a technique that forces a HTTP client on a network to display a special web page usually for authentication purposes before normal access to the Internet or another network resource is permitted. Generally all messages from a client in a non authenticated state are intercepted regardless of the targeted address or port. Once the user opens a browser and tries to access the Internet through a HTTP Request message e.g. HTTP GET Request this prompts a HTTP redirect namely a response is returned with a status code e.g. 30 that induces the browser to access another domain as shown in Table 1.

For instance a HTTP Status Code 302 redirect is a temporarily redirect of access from one domain e.g. www.domain1.com to another domain e.g. wwww.domain2.com . At that time the browser is redirected to a web page at the second domain www.domain2.com which may require authentication and or payment or simply display an acceptable use policy and require the user to agree.

Hence while it is important to properly route communications from the devices in a non authenticated state to an external captive portal in some cases HTTP Status Code redirects may not be desired.

In the following description several specific details are presented to provide a thorough understanding of the invention. One aspect of the disclosure is to avoid Hypertext Transfer Protocol HTTP Status Code redirects by a network device such as an access point AP for example. Instead the network device provides signaling that causes an unauthenticated client device to establish communications with an external captive portal during data fetch operations.

More specifically upon detecting an incoming HTTP Request message from a client device operating in a non authenticated state a network device e.g. an AP with transparent HTTP proxy functionality returns a response message to that client device. The response message comprises display layout information for a browser window where a portion of the display layout information is configured to prompt the client device to access the external captive portal when retrieving content to populate its browser window.

As a result the network device avoids the use of HTTP Status Code redirects by returning display layout information such as a Hypertext Markup Language HTML frameset for example. The HTML frameset features a frame element that is coded to prompt the client device to access the external captive portal in lieu of accessing content from a web page normally identified by frame tags.

One skilled in the relevant art may recognize however that the concepts and techniques disclosed herein can be practiced without certain details such as the exclusion of one or more operations certain logic or the like.

Herein certain terminology is used to describe features for embodiments of the disclosure. For example the term network device generally refers to any device that includes logic adapted to communicate with a network and or process information related to such communications. Different categories of network devices may include but are not limited or restricted to 1 a client device being any consumer electronics with network connectivity e.g. tablet laptop desktop netbook television set top box video gaming control mobile handset with cellular and or wireless connectivity such as a smartphone personal digital assistant PDA etc. 2 an access point 3 a data transfer device e.g. network switch router controller brouter etc. 4 an authentication server or the like.

It is contemplated that a network device comprises hardware logic which includes one or more of the following i processing circuitry e.g. a controller a processor a programmable gate array an application specific integrated circuit etc. ii one or more communication interfaces such as radios e.g. component that handles the wireless data transmission reception and or physical connectors to support wired connectivity and or iii a non transitory computer readable storage media e.g. a programmable circuit a semiconductor memory such as a volatile memory such as random access memory RAM or non volatile memory such as read only memory power backed RAM flash memory phase change memory or the like a hard disk drive an optical disc drive etc. or any connector for receiving a portable memory device such as a Universal Serial Bus USB flash drive portable hard disk drive or the like.

Additionally the term logic is generally defined as hardware and or software. As hardware logic may include processing circuitry semiconductor memory combinatorial logic or the like. As software logic may be one or more software modules such as executable code in the form of an executable application an application programming interface API a subroutine a function a procedure an object method implementation an applet a servlet a routine a source code an object code a shared library dynamic load library or one or more instructions. These software modules may be stored in any type of a suitable non transitory storage medium described above or transitory computer readable transmission media e.g. electrical optical acoustical or other form of propagated signals such as carrier waves infrared signals digital signals .

The term interconnect is broadly defined as a logical or physical communication path such as for instance electrical wire optical fiber cable bus trace or a wireless channel using infrared radio frequency RF or any other wireless signaling mechanism. The term message constitutes any grouping of data in prescribed format such as a packet a frame an Asynchronous Transfer Mode ATM cell an HTML document or the like.

Lastly the terms or and and or as used herein are to be interpreted as an inclusive or meaning any one or any combination. Therefore A B or C or A B and or C mean any of the following A B C A and B A and C B and C A B and C. An exception to this definition will occur only when a combination of elements functions operations steps or acts are in some way inherently mutually exclusive.

Certain details are set forth below in order to provide a thorough understanding of various embodiments of the invention albeit the invention may be practiced through many embodiments other that those illustrated. Well known logic and operations may not be set forth in detail in order to avoid unnecessarily obscuring this description. Moreover the illustrated embodiments of the disclosure and the description associated therewith should be considered as examples of the principles of the invention and not intended to limit the disclosure to those specific embodiments. It should be understood that this disclosure covers all modifications equivalents and alternatives falling within the spirit and scope of the present disclosure.

Referring to a general block diagram of a network servicing multiple Basic Service Set Identifiers BSSIDs and supporting access to an external captive portal is shown. According to this embodiment of the disclosure network is a local area network LAN using captive portal for authentication. Such access control is adapted to provide security against a network device gaining unauthorized access to various network resources e.g. Internet internal databases etc. .

More specifically captive portal authentication involves communications between i a network device e.g. client device seeking to utilize resources provided by network and ii certain components forming network namely network infrastructure and an external captive portal operating in a remotely located network device .

As illustrated network infrastructure is a collection of one or more network devices that are adapted to support communications between external captive portal and client device . More specifically network infrastructure is adapted to initially restrict access to network resources until the identity of client device has been authenticated. According to one embodiment of the disclosure such restriction may be accomplished by network infrastructure returning a Hypertext Markup Language HTML document in response to receipt of a Hypertext Transfer Protocol HTTP Request message from client device being in a non authenticated state. The HTML document is adapted to reference at least Uniform Resource Locators URLs for both external captive portal and the targeted destination of HTTP Request message .

The network devices formulating network infrastructure may vary depending on the selected network architecture.

For instance as shown in an exemplary embodiment of network operating as a wireless local area network WLAN is shown. According to this embodiment of the disclosure network infrastructure comprises an access point AP that virtualizes controller capabilities thereon. As an example AP e.g. an Aruba Instant AP features a transparent HTTP proxy which is adapted to intercept one or more incoming messages such as HTTP Request message of e.g. HTTP Get Request HTTP Post Request etc. without requiring any special configuration of client device .

Upon detecting that incoming message originated from client device currently operating in a non authenticated state i.e. client device has not been authenticated to access on network AP returns a message e.g. HTML document of to client device in lieu of a HTTP Status Code redirect. Message triggers client device during operations to obtain content for its web browser to establish communications with external captive portal operating in a remote network device . According to one embodiment of the disclosure message is an HTML document such as a Frameset.

Generally a Frameset is an HTML document that is responsible for dividing a browser window into rectangular areas. Some of these areas may be reserved for frame elements . A frame element defines a rectangular area reserved for content e.g. image video clip etc. retrieved from a uniform resource locator URL assigned to that subspace. Herein however one of the frame elements includes an absolute URL for the external captive portal web login page that is accessed without user intervention as content is retrieved to populate those frame elements in accordance with the layout provided by Frameset.

Alternatively as shown in where network is a local area network LAN supporting wired connectivity with client device network infrastructure comprises a data transfer device such as manageable switch e.g. 802.1X switch router etc. for example that also is adapted with transparent HTTP proxy . Data transfer device is adapted to intercept incoming messages such as HTTP Request messages for example without requiring any special client configuration.

Similar to as described above after detecting that incoming message originated from client device that is in a non authenticated state and is connected to data transfer device over a wired interconnect data transfer device returns a message e.g. HTML document to client device in lieu of a HTTP Status Code redirect. Message is an HTML document such as a Frameset where the operations conducted in response to receipt of message are described above.

As shown in an exemplary sequence diagram of communications between client device network infrastructure e.g. AP and external captive portal is shown. Herein at time t0 client device transmits a HTTP Request message that is received by AP . Implemented with transparent HTTP proxy AP analyzes the HTTP Request message to determine that this message originated from client device being in a non authenticated state.

As shown in an exemplary embodiment of HTTP Request message is shown. HTTP Request message comprises a plurality of information fields including but not limited or restricted to 1 request line and 2 one or more headers . Herein request line serves a number of purposes. More specifically request line indicates an action to be performed specifies a resource upon which the action should be taken and indicates to the network infrastructure e.g. AP with transparent HTTP proxy what version of HTTP protocol is being used by the client device. As illustrated in the formal syntax for request line includes the following elements 

METHOD element identifies a type of action requested by client device to be undertaken. There are a few standard methods defined in the HTTP 1.1 protocol of which three are widely used GET HEAD and POST. In particular as set forth in Request For Comment RFC 2616 entitled Hyperlink Transfer Protocol HTTP 1.1 1999 incorporated herewith a HTTP GET Request message is directed to retrieval of information identified by Request URI .

REQUEST URI element is the uniform resource identifier URI for a resource to which the HTTP Request message applies. While URIs can theoretically refer to either uniform resource locators URLs or uniform resource names URNs URI is normally a HTTP URL that follows the standard syntax rules of Web URLs.

It is noted that the exact form of the HTTP URL may not be used in HTTP Request line . Instead a path and or file name may be included in HTTP Request line while the host may be specifying in a Host header field of HTTP Request message .

Since the http is implied the client device parses the remaining information so that REQUEST URI element constitutes aruba partners while Host header field contains www.arubanetworks.com . Thus the start of HTTP Request message may be the following 

Host header field e.g. Host specifies the Internet host and port number of the resource being requested as obtained from the original URI given by the user or referring resource. The Host field value represents the naming authority of the network device given by the original URL. Where host header field is without any trailing port information as shown above in HTTP Request message this implies the default port for the service requested e.g. 80 for a HTTP URL .

HTTP VERSION element identifies what HTTP version the source initiating the HTTP Request message is using in order to accurately interpret the message. For example a HTTP Request message using HTTP version 1.0 will assume that a transitory connection is being used rather than a persistent one and also will avoid using HTTP version 1.1 headers in its reply.

Besides Host header described above a HTTP User Agent header may be used to identify a source of the HTTP GET Request e.g. client device . HTTP User Agent header comprises a number of subfields including but not limited or restricted to i device type and or OS ii browser information e.g. web browser type version number etc. or the like.

Referring back to once AP determines that client device is in a non authenticated state at time t1 AP returns message e.g. HTML document to client device in lieu of returning a HTTP Status Code redirect message. As described above message is an HTML document such as a frameset as illustrated in .

As shown in frameset is used to divide the browser window into one or more rectangular areas where at least one of these areas corresponds to a frame element that features a hypertext link to the external captive portal. More specifically upon review of its syntax frameset comprises a frame element with a source attribute src that normally specifies the location of contents to be contained in the frame element. However in accordance with this disclosure source attribute provides an absolute URL to the external captive portal so that the client device accesses the external captive portal in lieu of fetching content to be rendered in frame element .

It is contemplated that frameset may include additional attributes. For instance as illustrated by the syntax representation frameset comprises a URL of the targeted destination device for the HTTP Request message through the combination of REQUEST URI element and Host header field as shown in . Other additional information may be provided within frameset including but are not limited or restricted to 1 MAC address of AP AP name Service Set Identifier SSID or the like.

Returning back to upon receiving the frameset at time t2 client device issues a login request message to external captive portal based on a source attribute contained within a frame element of the frameset. Login request message upon receipt by external captive portal causes return of a login page to client device at time t3 .

According to one embodiment of the disclosure login page includes field entries to receive input from the user of client device . These entries may merely include an entry to acknowledge rules of conduct by users of the network or release of liability. According to another embodiment of the disclosure login page may include one or more modifiable fields for insertion of login information either by the user or automatically by client device followed by selection of an ACCEPT button. As illustrative examples the login information may be an alphanumeric value code shared between client device and remote network featuring external captive portal . Alternatively the login information may be a username and password corresponding to client device .

It is contemplated that the ACCEPT button may be associated with hyperlink with a target  top attribute which causes the target of the form submission namely the returned login page to display at a top level of the browser window. In other words the top level of the browser window constitutes replacing the entire frameset not just the frame from which navigation control ACCEPT button click was launched.

Thereafter after completion by user at t4 the login information is routed to external captive portal . At this time external captive portal performs pre authentication operations by checking whether the user credentials are recognized as valid credentials. This may be accomplished by external captive portal maintaining a list of user names and passwords that have been assigned by a network administrator and are still authorized. Of course other mechanisms may be used for such access control operations.

At time t5 external captive portal provides a login progress page that identifies progress of the device login as well as an auto submit form that may be transmitted concurrently or subsequently from progress page . According to one embodiment of the invention auto submit form is encoded within login process page to cause client device to automatically submit its user credentials e.g. username and password for authentication to AP for authentication at time t6 . Additional parameters may be returned by external captive portal for use in producing a displayable image while user authentication is requested by AP . These parameters may include information contained in one or more fields to identify an intended use of auto submit form e.g. command field to identify authentication process will be conducted login field to identify that user log in is being conducted or the like .

Although not shown auto submit form is an HTML document that includes a target attribute target  top that identifies a loading position of a content that will be returned if the user credential automatically supplied by client device after receipt of auto submit form are authenticated. This further allows a URL bar located by the top of the browser window to be updated.

At t7 after AP performs an authentication process and confirms that client device is authenticated and authorized to access network resources AP triggers an internal mechanism that alters the current operating state of client device thereby permitting client device to access network resources without triggering captive portal . Furthermore at this time AP provides a success message to client device that prompts the user of a status change.

For instance as illustrative examples success message may be an HTML web page that welcomes client device and indicates that the user of such device is now permitted to access network resources such as the Internet. Alternatively success message may be a message that simply redirects the browser to a web page for the targeted destination such as http www.arubanetworks.com aruba partners in accordance with the illustrative example of the HTTP Get message of .

However upon determining that client device has failed to be authenticated AP returns a failure message and access to network resources by client device remains restricted. Thus any subsequent HTTP Request messages from client device will still trigger external captive portal before access to a network resource can be granted.

Referring now to an exemplary embodiment of the operations performed by a network device to restrict access to network resources by a client device operating in a non authenticated state thereby forcing the client device to communication with captive portal is shown. Herein the network device with HTTP proxy functionality receives a HTTP Request message from a network device block . For this HTTP Request message a determination is made whether the source of the HTTP Request message namely the client device is operating in a non authenticated state block . If not the client device is permitted access to resources provided by the network block . However if the client device is in a non authenticated state the network device returns a message including display layout information to the client device block . According to one embodiment of the disclosure display layout information may be a HTML document such as a frameset which comprises a frame element that provides linking to the external captive portal.

Thereafter during the captive portal process the network device receives user credentials for the client device block . Such user credentials are provided based on an exchange of information between the client device and the external captive portal. In particular after receipt of the frameset the client device is forced to access the external captive portal which performs login operations and acquires the user credentials that are routed to the network device at which time the frameset is effectively altered by use of a target attribute top .

In the event that the user credentials are authenticated by AP the client device is provided access to the network resources blocks and . Otherwise the client device is not authenticated and access restrictions to network resources still apply blocks and .

Referring to an exemplary embodiment of network device adapted to control access to network resources by returning display layout information that precludes an access requested network resources until after communications with an external captive portal have concluded is shown. Operating as a node in network network device includes at least one or more radio antennas capable of either transmitting or receiving radio signals or both a network interface capable of communicating to a wired or wireless network a processor capable of processing computing instructions and a memory capable of storing instructions and data.

Moreover network device further includes a transparent HTTP proxy logic which is coupled to processor and memory in network device . Network device may be used as a client system or a server system or may serve both as a client and a server in a distributed or a cloud computing environment.

Radio antenna may be any combination of known or conventional electrical components for receipt of signaling including but not limited to transistors capacitors resistors multiplexers wiring registers diodes or any other electrical components known or later become known.

Network interface can be any communication interface which includes but is not limited to a modem token ring interface Ethernet interface wireless IEEE 802.11 interface cellular wireless interface satellite transmission interface or any other interface for coupling network devices.

Processor can include one or more microprocessors and or network processors. Memory can include storage components such as Dynamic Random Access Memory DRAM Static Random Access Memory SRAM etc. In some embodiments memory stores one or more aggregated numbers of wireless client stations associated with one or more access points and or controllers on one or more specific wireless communication channels.

HTTP proxy logic receives an incoming HTTP Request message and determines if the client device initiating the HTTP Request message is authenticated. If not the HTTP proxy message includes a frameset to the client device where the frameset is adapted to prompt the client device to access an external captive portal. Thereafter the external captive portal and client device have sufficient information to exchange information that prompts client device to forward its user credentials to network device for authentication.

It is to be understood that the above description is intended to be illustrative and not restrictive. Many other embodiments will be apparent to those of skill in the art upon reading and understanding the above description. The scope of the invention should therefore be determined with reference to the appended claims along with the full scope of equivalents to which such claims are entitled.

