---

title: Advertising, discovering, and using services through virtual access point interfaces
abstract: The disclosed embodiments provide a system that provides a service on a first electronic device. During operation, the system uses a virtual access point interface and a discovery protocol to advertise the service on the first electronic device. The virtual access point interface may enable discovery of the service by a second electronic device without an infrastructure connection between the first and second electronic devices. Next, the system uses the virtual access point interface to establish a wireless peer-to-peer connection between the first electronic device and a second electronic device. Finally, the system provides the service to the second electronic device through the wireless peer-to-peer connection.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09418372&OS=09418372&RS=09418372
owner: Apple Inc.
number: 09418372
owner_city: Cupertino
owner_country: US
publication_date: 20120525
---
The disclosed embodiments relate to wireless networks. More specifically the disclosed embodiments relate to techniques for advertising and using services on electronic devices through virtual access point interfaces on the electronic devices.

Recent improvements in computing power and wireless networking technology have significantly increased the capabilities of electronic devices. For example laptop computers tablet computers portable media players smartphones digital media receivers video game consoles and or other modern electronic devices are typically equipped with WiFi capabilities that allow the electronic devices to retrieve webpages stream audio and or video share desktops and or user interfaces UIs and or transfer files wirelessly among one another.

However conventional wireless networking technology may require the use of preexisting access points cellular radio towers and or other structured networks to connect electronic devices to each other and or the Internet. As a result network traffic and or communication between two electronic devices may be limited by the availability bandwidth signal strength latencies and or capabilities of structured network components used to transmit the network traffic.

On the other hand modern electronic devices may be capable of forming wireless ad hoc networks that bypass the use of access points cellular towers and or structured networks to transmit network traffic among nodes of the wireless ad hoc networks. Instead the electronic devices may use the wireless ad hoc networks to communicate directly with one another thereby increasing throughput and or removing limitations associated with transmitting data through the access points and or structured networks. Consequently communication among electronic devices may be facilitated by mechanisms for increasing the use of wireless ad hoc networks by the electronic devices.

The disclosed embodiments provide a system that provides a service on a first electronic device. During operation the system uses a virtual access point interface and a discovery protocol to advertise the service on the first electronic device. The virtual access point interface may enable discovery of the service by a second electronic device without an infrastructure connection between the first and second electronic devices. Next the system uses the virtual access point interface to establish a wireless peer to peer connection between the first electronic device and a second electronic device. Finally the system provides the service to the second electronic device through the wireless peer to peer connection.

In some embodiments the system also disables the virtual access point interface upon detecting a termination of advertising for the service.

In some embodiments the system also uses the infrastructure connection to provide the service to the second electronic device if the infrastructure connection is more robust e.g. has higher signal strength greater bandwidth etc. than the wireless peer to peer connection.

In some embodiments the system also scans for one or more electronic devices in proximity to the first electronic device. Upon detecting the one or more electronic devices in proximity to the first electronic device the system uses the discovery protocol to obtain a set of services advertised by the one or more electronic devices. For example the system may browse for and or discover services advertised by nearby electronic devices while advertising the service on the first electronic device.

In some embodiments using the discovery protocol and the virtual access point interface to advertise the service on the first electronic device includes 

In some embodiments the advertising request includes a request to advertise the service using a non infrastructure mechanism.

In some embodiments the discovery request includes one or more service offerings e.g. advertised services on the second electronic device. Each of the service offerings may include an advertised identifier for the service offering and data associated with the service offering. The discovery request may enable discovery of the service offering s by the first electronic device without requiring the first electronic device to transmit a separate discovery request to the second electronic device and receiving a discovery response from the second electronic device.

The following description is presented to enable any person skilled in the art to make and use the embodiments and is provided in the context of a particular application and its requirements. Various modifications to the disclosed embodiments will be readily apparent to those skilled in the art and the general principles defined herein may be applied to other embodiments and applications without departing from the spirit and scope of the present disclosure. Thus the present invention is not limited to the embodiments shown but is to be accorded the widest scope consistent with the principles and features disclosed herein.

The data structures and code described in this detailed description are typically stored on a computer readable storage medium which may be any device or medium that can store code and or data for use by a computer system. The computer readable storage medium includes but is not limited to volatile memory non volatile memory magnetic and optical storage devices such as disk drives magnetic tape CDs compact discs DVDs digital versatile discs or digital video discs or other media capable of storing code and or data now known or later developed.

The methods and processes described in the detailed description section can be embodied as code and or data which can be stored in a computer readable storage medium as described above. When a computer system reads and executes the code and or data stored on the computer readable storage medium the computer system performs the methods and processes embodied as data structures and code and stored within the computer readable storage medium.

Furthermore methods and processes described herein can be included in hardware modules or apparatus. These modules or apparatus may include but are not limited to an application specific integrated circuit ASIC chip a field programmable gate array FPGA a dedicated or shared processor that executes a particular software module or a piece of code at a particular time and or other programmable logic devices now known or later developed. When the hardware modules or apparatus are activated they perform the methods and processes included within them.

The disclosed embodiments provide a method and system for advertising discovering and or using a service on an electronic device. As shown in a number of electronic devices are connected to a network through network links provided by devices such as wireless access points cellular towers and or routers. Electronic devices may correspond to personal computers laptop computers tablet computers mobile phones portable media players digital media receivers video game consoles printers scanners and or other network enabled electronic devices. Network may include a local area network LAN wide area network WAN personal area network PAN virtual private network intranet mobile phone network e.g. a cellular network WiFi network Ethernet network and or other type of network with existing infrastructure e.g. network links that facilitates communication among electronic devices e.g. electronic devices connected to network .

Electronic devices may communicate with one another and or with other electronic devices or servers through network . For example electronic device may use a discovery protocol such as Bonjour Bonjour is a registered trademark of Apple Inc. to advertise services on electronic device to electronic device and or other electronic devices on network . In turn electronic device may use the discovery protocol and network to discover e.g. detect the services on electronic device . Finally electronic device may use the services by connecting to electronic device through network and accessing the services. For example electronic device may use the discovery protocol and network to access services for transferring files streaming media printing collaborating on documents and or sharing desktops on electronic device .

However communication between electronic devices may be limited by the availability bandwidth and or capabilities of network links and or network . For example each electronic device may be unable to discover and or use services on other electronic devices in the absence of a structured network e.g. network connecting the electronic device to the other electronic devices.

In one or more embodiments electronic devices include functionality to advertise discover and or use services with one another in the absence of network links and or other existing network infrastructure between electronic devices . As shown in a set of electronic devices may be connected through one or more network links e.g. access points routers cellular towers etc. of a structured network such as network of . Conversely network links may not be available e.g. out of range secured etc. to one or both electronic devices and electronic devices may be unable to connect to one another through the structured network.

To enable use of a service provided by an application on electronic device by an application on electronic device without communicating through network links and or other existing network infrastructure electronic device may advertise service through a virtual access point interface and a discovery protocol e.g. Bonjour . In turn electronic device may discover and use service through discovery protocol and virtual access point interface .

In particular a discovery apparatus on electronic device may receive an advertising request for service from application . The advertising request may include a request to advertise service using a non infrastructure mechanism. For example the advertising request may include a flag and or indicator for advertising service through virtual access point interface and or another ad hoc peer to peer mechanism. Alternatively application may be unaware of the availability of virtual access point interface on electronic device and the advertising request may omit the request to advertise service using virtual access point interface .

In response to the advertising request discovery apparatus and or a communication apparatus on electronic device may enable virtual access point interface . For example communication apparatus may activate virtual access point interface after receiving the advertising request and or a request to activate virtual access point interface from discovery apparatus . To create virtual access point interface communication apparatus may configure a radio on electronic device to operate as a lightweight access point and or provide a wireless ad hoc network.

Communication apparatus may also include functionality to connect to a structured network e.g. through network links while providing virtual access point interface . For example communication apparatus may concurrently provide network connectivity through a connection with a WiFi network and an ad hoc mechanism for advertising service through virtual access point interface .

To advertise service discovery apparatus and or communication apparatus may enable the detection of virtual access point interface and or service by other electronic devices e.g. electronic device in proximity to electronic device . For example discovery apparatus and or communication apparatus may periodically transmit a beacon frame containing information about virtual access point interface and or service . The beacon frame may specify a set of capabilities supported data rates and or an identifier e.g. an 802.11 service set identifier SSID for virtual access point interface . The beacon frame may also include one or more information elements describing service support for discovery protocol and or other unique attributes of virtual access point interface . Discovery apparatus and or communication apparatus may also receive probe request frames from the other electronic devices and transmit probe response frames containing the same information as the beacon frame to the other electronic devices.

As shown in electronic device may also include a discovery apparatus and a communication apparatus . Discovery apparatus and or communication apparatus may include functionality to detect virtual access point interface even if discovery apparatus and or communication apparatus do not include functionality to provide a separate virtual access point interface on electronic device . For example discovery apparatus may receive a browse request from application to browse and or scan for services advertised on nearby electronic devices such as electronic device . Communication apparatus may scan for the nearby electronic devices by transmitting a probe request frame on each channel of one or more 802.11 bands supported by communication apparatus . During the scan communication apparatus may receive a beacon frame and or a probe response frame on the channel used by communication apparatus . Moreover the beacon frame and or probe response frame may include information about virtual access point and or service as described above.

Next discovery apparatus and or communication apparatus may perform discovery of service using information obtained during the scan for nearby electronic devices. To initiate discovery of service discovery apparatus and or communication apparatus may use discovery protocol to transmit a discovery request for service to electronic device . For example discovery apparatus and or communication apparatus may transmit discovery request as a Generic Advertisement Service GAS frame containing a browsed identifier for service . The browsed identifier may be provided by application in the browse request to discovery apparatus . In other words the browsed identifier may identify service as a service that application is interested in using.

In one or more embodiments discovery request also includes one or more service offerings on electronic device . For example discovery request may include advertised identifiers e.g. service types for the service offerings data associated with the service offerings and or other information that enables discovery of the service offerings by electronic device . In other words discovery request may provide information about services advertised on electronic device and request information about services advertised on electronic device at the same time. Discovery request may thus facilitate mutual and or symmetric discovery of services between electronic devices as discussed in further detail below with respect to .

In response to discovery request discovery apparatus and or communication apparatus may generate a discovery response to discovery request . Discovery response may include data associated with service . For example discovery response may include the browsed identifier e.g. service type for service a unique name for service and or other information that allows electronic device to sufficiently discover service . Discovery apparatus and or communication apparatus may then complete discovery of service by electronic device by transmitting discovery response to electronic device .

While service is being advertised and or discovered discovery apparatus and or communication apparatus may also perform discovery of services advertised by electronic devices in proximity to electronic device such as electronic device . For example application may send a browse request to discovery apparatus and discovery apparatus and or communication apparatus may scan for nearby electronic devices by sending probe request frames over a range of 802.11 channels and receiving probe response frames for the probe request frames from the nearby electronic devices. Discovery apparatus and or communication apparatus may then use information from the browse request probe response frames and or discovery protocol to transmit discovery requests to the nearby electronic devices and receive discovery responses to the discovery requests from the nearby electronic devices.

Once a service e.g. service is discovered by an electronic device e.g. electronic device the service may be used by the electronic device. For example communication apparatus may use the unique name for service from discovery response to perform a Domain Name System DNS lookup of the network address port number and or other configuration information for accessing service on electronic device . Alternatively communication apparatus may obtain the configuration information directly from discovery response . Communication apparatus may subsequently use the configuration information and virtual access point interface to establish a wireless peer to peer connection with electronic device and electronic device may use service through wireless peer to peer connection .

As mentioned above electronic devices may also be connected through an infrastructure connection provided by network links and or other existing network infrastructure. If the infrastructure connection is available and associated with a more robust connection e.g. higher signal strength more bandwidth etc. than wireless peer to peer connection communication apparatuses may use the infrastructure connection to provide service to electronic device . Conversely if no infrastructure connection is available and or the infrastructure connection is less robust than wireless peer to peer connection electronic device may continue to use wireless peer to peer connection to access service until use of service by electronic device is complete.

Discovery apparatus and or communication apparatus may also continue advertising service and or providing virtual access point interface until a termination of advertising for service is received from application . For example application may transmit a request to terminate advertising for service to discovery apparatus and discovery apparatus may discontinue advertising of service through virtual access point interface . Communication apparatus may also disable virtual access point interface if no other services are being advertised through virtual access point interface .

Consequently virtual access point interface may allow electronic devices to advertise discover and use services e.g. service with one another in the absence of an infrastructure connection between electronic devices . In addition advertising of services on each electronic device may be streamlined by enabling a virtual access point interface e.g. virtual access point interface upon receiving advertising requests for the services instead of after negotiating with other electronic devices to select a provider of the virtual access point interface. Finally transmission of discovery requests e.g. discovery request containing service offerings may enable the symmetric discovery of services between electronic devices and reduce delays associated with conventional asymmetric service discovery that requires the transmission of discovery requests and discovery responses by both electronic devices to mutually discover services on electronic devices .

Those skilled in the art will appreciate that the system of may be implemented in a variety of ways. First discovery apparatuses and communication apparatuses on each electronic device may be provided by the same software and or hardware component or discovery apparatuses and communication apparatuses may execute independently from one another. For example discovery apparatuses and communication apparatuses may be implemented using different combinations of an application processor a baseband processor a multi core processor a single core processor an operating system kernel a standalone application and or a driver.

Second electronic devices may use various techniques to advertise and discover services. For example electronic devices may use different types and or sequences of 802.11 frames and or other networking mechanisms to scan for other electronic devices discover services on the other electronic devices and or advertise services to the other electronic devices.

As shown in discovery request may also include a set of advertised identifiers and a set of data . As mentioned above advertised identifiers and data may specify one or more service offerings e.g. advertised services on the second electronic device. For example advertised identifiers may be service types for the service offerings and data may include unique names for the service offerings descriptions of the service offerings and or other information that enables discovery of the service offerings by the first electronic device and or other nearby electronic devices. Furthermore advertised identifiers and data may apply to service offerings that are analogous and or related to the service or advertised identifiers and data may describe a variety of service offerings on the second electronic device including those not related to the service.

The first electronic device may generate discovery response in response to discovery request and transmit discovery response to the second electronic device. Because discovery request contains advertised identifiers and data the first electronic device may omit the transmission of a different discovery request to the second electronic device to discover services e.g. the service offerings advertised by the second electronic device.

Like discovery request discovery response may include browsed identifier to identify the service being discovered. Discovery response may also include data associated with the service. For example discovery response may include a unique name for the service a description of the service a graphic e.g. icon related to the service and or other information related to discovery of the service. Once discovery response is received by the second electronic device each electronic device will have discovered one or more services on the other electronic device.

The first and or second electronic devices may use information in discovery request and or discovery response to use the service. More specifically the second electronic device may use data from discovery response to establish a network connection e.g. wireless peer to peer connection infrastructure connection etc. with the first electronic device. Alternatively the first electronic device may use data from discovery request to initiate the network connection with the second electronic device. Once the network connection is initiated the first electronic device may provide the service to the second electronic device through the network connection or the first electronic device may initiate use of an analogous and or related service on the second electronic device.

For example the first and second electronic devices may both advertise a peer to peer file transfer service and use discovery request and discovery response to perform symmetric discovery of the peer to peer file transfer service. Each electronic device may then use information from discovery request and or discovery response to establish a peer to peer connection with the other electronic device and transfer a file over the peer to peer connection to the other electronic device.

Initially a virtual access point interface and a discovery protocol are used to advertise the service on the first electronic device. To advertise the service the virtual access point interface is enabled in response to an advertising request for the service from an application providing the service operation . The virtual access point interface may be enabled by configuring a radio on the electronic device to operate as a lightweight access point and or provide a wireless ad hoc network. The advertising request may include a request to advertise the service using a non infrastructure mechanism.

A browse request may also be received operation from the application. If the browse request is received a scan for one or more electronic devices in proximity to the first electronic device is performed operation . The scan may occur in response to a browse request from the application to the first electronic device. In addition the scan may be performed independently of advertising of the service for the application. During the scan a probe request frame may be transmitted on each channel of one or more bands used for wireless communication by the first electronic device. Probe response frames to the probe request frame may then be received from one or more electronic devices in proximity to the first electronic device. Once the electronic device s are detected by the scan a discovery protocol is used to obtain a set of services advertised by the electronic device s operation as discussed in further detail below with respect to . In other words discovery of services on other electronic devices may be performed by the first electronic device at the same time as advertising of the service to the other electronic devices. If no browse request is received scanning and or browsing of services on other electronic devices may not be performed by the first electronic device.

A discovery request may be received operation from a second electronic device through the virtual access point interface. If a discovery request is not received discovery of the service may not be performed. If a discovery request is received a discovery response to the discovery request is transmitted operation . The discovery response may contain information that allows the second electronic device to discover the service. In addition the discovery request may include one or more service offerings on the second electronic device thus enabling discovery of the service offering s on the first electronic device without transmitting a separate discovery request to the second electronic device and receiving a discovery response from the second electronic device.

Next the virtual access point interface is used to establish a wireless peer to peer connection between the first and second electronic devices operation and the service is provided to the second electronic device through the wireless peer to peer connection operation . For example the second electronic device may establish the wireless peer to peer connection by connecting to the virtual access point interface using information in a probe response frame from the first electronic device. The second electronic device may then use information from the discovery response and the wireless peer to peer connection to transfer files share desktops collaborate on documents stream audio and or video and or perform a print job with the first electronic device.

An infrastructure connection between the first and second electronic devices may be available and more robust operation than the wireless peer to peer connection. For example the first and second electronic devices may be connected through a WiFi access point with higher signal strength and or greater bandwidth than the wireless peer to peer connection. If the infrastructure connection is more robust than the wireless peer to peer connection the infrastructure connection is used to provide the service to the second electronic device operation . If the infrastructure connection is not more robust than the wireless peer to peer connection the wireless peer to peer connection may continue to be used to provide the service to the second electronic device.

A termination of advertising for the service may be detected operation . For example the termination of advertising may be detected upon receiving a request from the application to discontinue advertising the service. If termination of advertising for the service is not detected scanning and service discovery may continue to be performed on nearby electronic devices operations in conjunction with advertising of the service to the electronic devices operations and use of the service by the other electronic devices operations . If termination of advertising for the service is detected the virtual access point interface is disabled operation and the service is no longer advertised and or offered through the virtual access point interface. Scanning and or browsing of services from nearby electronic devices operations may continue until browsing of services is also disabled on the first electronic device.

First a browse request containing a browsed identifier for the service is obtained on the second electronic device operation . For example the second electronic device may obtain the browse request from an application on the second electronic device interested in using the service on nearby electronic devices including the first electronic device.

Next a scan for one or more electronic devices in proximity to the second electronic device is used to detect the first electronic device operation . For example the first electronic device may be detected by transmitting a probe request on a channel used by the first electronic device and receive a probe response to the probe request from the first electronic device.

After the first electronic device is detected a discovery protocol is used to transmit a discovery request containing the browsed identifier and one or more service offerings on the second electronic device to the first electronic device operation . Each service offering may include an advertised identifier for the service offering and data associated with the service offering. The service offering s may allow the first electronic device to discover services advertised by the second electronic device e.g. the service offering s without transmitting a separate discovery request to the second electronic device and obtaining a discovery response from the second electronic device unlike existing and or conventional service discovery techniques. In other words the service offering s may facilitate symmetric discovery of services on the first and second electronic devices whereas other discovery mechanisms may utilize slower asymmetric discovery mechanisms.

A discovery response to the discovery request is then received from the first electronic device operation and used to access the service on the first electronic device from the second electronic device operation . For example the discovery response may include the browsed identifier and data associated with the service. The data may allow the second electronic device to establish a network connection e.g. wireless peer to peer connection infrastructure connection with the first electronic device and access the service through the network connection. The first electronic device may also use the data from the second electronic device s discovery request to connect to the second electronic device and use services on the second electronic device.

Computer system may include functionality to execute various components of the present embodiments. In particular computer system may include an operating system not shown that coordinates the use of hardware and software resources on computer system as well as one or more applications that perform specialized tasks for the user. To perform tasks for the user applications may obtain the use of hardware resources on computer system from the operating system as well as interact with the user through a hardware and or software framework provided by the operating system.

In one or more embodiments computer system provides a system for providing a service on a first electronic device. The system may include a discovery apparatus that uses a virtual access point interface and a discovery protocol to advertise the service on the first electronic device. The virtual access point interface may enable discovery of the service by a second electronic device without an infrastructure connection between the first and second electronic devices. The system may also include a communication apparatus that provides the virtual access point interface and uses the virtual access point interface to establish a wireless peer to peer connection between the first electronic device and a second electronic device. The communication apparatus may also provide the service to the second electronic device through the wireless peer to peer connection.

In addition one or more components of computer system may be remotely located and connected to the other components over a network. Portions of the present embodiments e.g. discovery apparatus communication apparatus electronic devices etc. may also be located on different nodes of a distributed system that implements the embodiments. For example the present embodiments may be implemented using a number of electronic devices connected to one another through a set of wireless peer to peer connections and or infrastructure connections.

Application may provide advertising request to a multicast Domain Name System mDNS responder that enables advertising of services by applications and mDNS responder may use a plugin to transmit advertising request to a peer to peer P2P supervisor . Application mDNS responder and P2P supervisor may all reside in user space on the electronic device.

Next P2P supervisor may transmit a message through a vendor abstraction layer e.g. an application programming interface API to a vendor specific 802.11 driver and 802.11 driver may create a new virtual access point interface . For example 802.11 driver may configure an 802.11 radio on the electronic device to provide virtual access point interface by acting as a lightweight access point to nearby electronic devices. 802.11 driver may also configure the radio to connect to a structured WiFi network while providing virtual access point interface . Vendor abstraction layer and 802.11 driver may reside in kernel space on the electronic device.

P2P supervisor may then advertise the service through beacon frames and or probe response frames that are transmitted from virtual access point interface to nearby electronic devices. P2P supervisor may also receive discovery requests from the electronic devices through virtual access point interface generate discovery responses to the discovery requests and send the discovery responses to the discovery requests through 802.11 driver and or virtual access point interface . Finally P2P supervisor may send discovery requests to the electronic devices and receive discovery responses containing services advertised by the electronic devices.

To use the service provided by application a second electronic device may establish a wireless P2P connection with the electronic device through virtual access point interface and transmit packets through virtual access point interface and a network stack on the electronic device to application . Application may also use the wireless P2P connection network stack and virtual access point interface to transmit packets to the second electronic device thus providing the service to the second electronic device. Finally an infrastructure connection between the two electronic devices may be used to provide the service to the second electronic device if the infrastructure connection is available and more robust than the wireless P2P connection.

The foregoing descriptions of various embodiments have been presented only for purposes of illustration and description. They are not intended to be exhaustive or to limit the present invention to the forms disclosed. Accordingly many modifications and variations will be apparent to practitioners skilled in the art. Additionally the above disclosure is not intended to limit the present invention.

