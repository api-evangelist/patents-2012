---

title: Determining contours of a vessel using an active contouring model
abstract: Systems and methods for determine a centerline of a tubular structure from volumetric data of vessels where a contrast agent was injected into the blood stream to enhance the imagery for centerline. An active contour model may be applied to determine contours of the vessel defined within image data by normalizing the image data about a starting point. A snake may be initialized a first time, where the snake defines a set of points that represent a spline within the vessel. Image forces that act on the snake to pull the snake toward a contour of the vessel may be calculated and iteratively applied in a minimization process to determine the contour of the vessel. Optionally, a Gaussian smoothing operation may be performed.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08755576&OS=08755576&RS=08755576
owner: Calgary Scientific Inc.
number: 08755576
owner_city: 
owner_country: CA
publication_date: 20120508
---
This application claims priority to U.S. Provisional Patent Application No. 61 532 700 filed Sep. 9 2011 and U.S. Provisional Patent Application No. 61 561 582 filed Nov. 18 2011 each entitled Image Display of a Centerline of Tubular Structure. This application also claims priority to U.S. Provisional Patent Application No. 61 535 034 filed Sep. 15 2011 and U.S. Provisional Patent Application No. 61 561 569 filed Nov. 18 2011 each entitled Method of Determining Contours of a Vessel Using an Active Contouring Model. This application also claims priority to U.S. Provisional Patent Application No. 61 539 429 filed Sep. 26 2011 U.S. Provisional Patent Application No. 61 556 496 filed Nov. 7 2011 and U.S. Provisional Patent Application No. 61 561 576 filed Nov. 18 2011 each entitled Active Vessel Contouring Tool Using Gaussian Smoothing Operation. Each of the above applications is incorporated herein by reference.

With the advent of sophisticated medical imaging modalities such as magnetic resonance computed tomography ultrasound and cone beam X ray imaging three dimensional 3D volumetric data sets can be reconstructed from a series of two dimensional 2D X ray slices of an anatomical structure taken around an axis of rotation. Such 3D volumetric data may be displayed using volume rendering techniques so as to allow a physician to view any point inside the anatomical structure without the need to insert an instrument inside the patient s body.

To detect diagnose and treat blood vessel pathologies physicians and other healthcare professionals rely on the visual examination of 3D images and multiple 2D projection or cross sectional images. Recent advances in the medical image processing field have made available some software tools for semi automated quantification of vascular diseases. Software tools for semi automated quantification of the severity of blood vessel stenosis and the size of aneurysms are available for use today on some clinical image processing workstations. These tools typically analyze blood vessels through an idealized model of a blood vessel such as a tubular model with possible branching. One of general steps for analyzing the shape of blood vessels is the extraction of the centerline of these vessels. For diseases like aneurysms or stenosis the profile of the blood vessel diameter along the centerline abnormally expands or shrinks respectively.

Disclosed herein are systems and methods for determining a centerline and contours of a tubular structure. The systems may include a computing device and the methods may be performed by a processor executing within the computing device. An active contour model may be applied to determine contours of the tubular structure such as a vessel defined within image data by normalizing the image data about a starting point. A snake may be initialized a first time where the snake defines a set of points that represent a spline within the vessel. Image forces that act on the snake to pull the snake toward a contour of the vessel may be calculated and iteratively applied in a minimization process to transform the snake in order to determine the contour of the vessel. Optionally a Gaussian smoothing operation may be performed.

In accordance with some implementations there is provided a method for applying an active contour model to a vessel analysis. The method may include receiving at a computing device image data representative of an image of at least one vessel normalizing the image data about a starting point initializing a snake a first time the snake defining a set of points that represent a spline within the vessel calculating image forces that act on the snake to pull the snake toward a contour of the vessel and iteratively applying a minimization process to determine the contour of the vessel.

In accordance with some implementations the method for applying an active contour model to a vessel analysis may include receiving at a computing device image data representative of an image of at least one vessel initializing a snake a first time the snake defining a set of points that represent a spline within the vessel calculating image forces that act on the snake to pull the snake toward a contour of the vessel the image forces being determined from magnitudes of first and second derivatives of image intensities at points in the image iteratively applying a minimization process to determine the contour of the vessel and applying a Gaussian smoothing operation using the contour from the iteratively applying the minimization process.

Other systems methods features and or advantages will be or may become apparent to one with skill in the art upon examination of the following drawings and detailed description. It is intended that all such additional systems methods features and or advantages be included within this description and be protected by the accompanying claims.

Unless defined otherwise all technical and scientific terms used herein have the same meaning as commonly understood by one of ordinary skill in the art. Methods and materials similar or equivalent to those described herein can be used in the practice or testing of the present disclosure. While implementations will be described for determining a centerline of a tubular vessel defecting branches and contouring of a tubular vessel and for determining a location of an aneurysm it will become evident to those skilled in the art that the implementations are not limited thereto.

The imaging scanner is operably connected to a computer system that controls the operation of the scanner and via a communication channel to an image processing system that processes the image data signals utilizing appropriate image processing software applications. The communication channel may be a direct peer to peer connection a network connection such as LAN a WAN or the Internet a wired or wireless connection etc. The image processing system has an image data archive or database an application server and a user workstation . The components of the image processing system are interconnected via a communications network that may be implemented by physical connections wireless communications or a combination. The image data archive or database is adapted to store the image data signals that are produced by the image scanner as well as the results of any additional operations on the image data signals by the other components of the image processing system . The image data archive or database may be a Picture Archiving and Communications System PACS . Other types of image data archives or databases may also be used.

The user workstation is adapted to control the operation of the imaging processing system and its various components. The user workstation may interact with the application server and the various image processing software applications that are stored in or are accessible by the application server . The user workstation may be any computing device such as a desktop computer dedicated workstation laptop notebook table computing device mobile device e.g. wireless handheld smartphone etc. The user workstation communicates via either a wired or wireless connection.

The application server also manages and coordinates the image data sets among the image processing applications. The image processing applications may include for example visualization applications computer aided diagnosis CAD applications medical image rendering applications anatomical segmentation applications or any other type of medical image processing application. The image processing applications may also include the methods of the present invention. The image data archive or database applications server and the user workstation may also each be connected to a remote computer network or computing device e.g. a remote device having the characteristics of the workstation as noted above for communication purposes or to access additional data or functionality. The workstation may comprise appropriate user interfaces like displays storage media input output devices etc.

The various components of the imaging system are conventional and well known components and may be configured and interconnected in various ways as necessary or as desired. The imaging system and in particular the image processing system is adapted to permit the imaging system to operate and to implement methods in accordance with the present disclosure for example as shown in .

The operational flow begins when a 3D array of scalar values i.e. the volume data S is provided and two input points or seed points within the volume vessel are selected as a first point and a second point S . The scalar values provided at S are pixel intensity values. A user may be presented with a 2D display of the 3D array where the 2D display is slice along the axial sagittal or coronal planes three orthogonal views . From the 2D display the user may indicate the two input points at S when viewing the imagery using e.g. a mouse in some implementations the two input points may be provided automatically by another system.

At S the algorithm is initialized by evaluating statistics focal to the two input points. In particular at S at the first point and the second point the area of the tubular structure at that point and the associated range of data values are determined by detecting the steep gradient at the wall of the tubular structure. For example the cross section area may be measured for increasing values of data range. The correct cross sectional area and associated range is selected by locating the range of values that provides an appropriate minimum in the expansion of the area with changes in the range. Other metrics such as a standard deviation of the data values may be used to examine the data values. From these statistics an initial range of values pixel intensities is calculated that will be considered part of the tubular structure.

The range may be constrained so that it will initially be very small with respect to the full range of the data in order to reduce errors where a vessel is near another structure of potentially overlapping pixel intensities such as bones the base of the skull etc. As described below this enables the methods of the present disclosure to track a centerline that is parallel or adjacent to a bony structure e.g. the carotid siphon . In addition a smaller range of values will help ensure that if the process does not succeed it fails quickly. Throughout the process described below the range may be expanded or limited as necessary.

At S the flow enters an iterative loop that executes so long as the range has changed less than a configurable number of times see below . The process attempts to generate two discrete curves represented as Non Uniform Rational B Spline NURBS curves that start at the two input points and join at some position within the volume. The two curves are used to increase the likelihood of finding a curve that connects the two points when there are bifurcations trifurations or more complex branches. For example if one of the curves goes down a wrong branch then the curve starting at the other point will join at the point where the first curve branches. In yet other circumstances the curves may not join indicating that both curves may have traveled down different branches of the tubular structure.

At S for each range the curves are initialized to start at the input points i.e. one from the first point and one from the second point. At S the initial direction vector for each curve is towards the other input point. Using the initial point and direction a plane is defined in the volume perpendicular to the direction and passing through the point a current point . This plane describes a cross section of the tubular structure. In order to choose the next point to add to the curve the direction is perturbed slightly in several directions. For example the direction may be perturbed in e.g. sixteen directions. Each of the perturbed directions results in another cross section. For each of these cross sections the area of the tubular structure is measured. The area is measured based on the requirement that values be connected and within the current range. The direction normal to the cross section with the smallest area is chosen as the direction to move.

At S a local search may be performed to determine and move to a pixel having a highest intensity. For example in the case of magnetic resonance MR data where the vessel is narrow it is likely that the pixel with the highest intensity value in the local region is the center of the vessel. To account for instances where a path defined by the above process is not passing through that pixel the local search looks for a pixel having a more intense value. The locality of the search may be limited to 2 minimum spacing units from the current point. If a pixel or pixels is found having a higher intensity the path is moved to the pixel having the highest intensity.

At S it is determined if the curves have terminated. This may be tested by determining if the intensity value at this new position is not within the current range if so the curve is terminated. For example if the intensity at the new position was greater it is possible that the new position is in bone. If at S the curves have not terminated then the intensity value at this position is within the current range. As such the point is added to the curve. The curves are then tested at S to see if they have joined. If the curves are not joined the process of measuring the smallest cross sectional area to determine the next direction at S is repeated using the new position and direction.

If the curves are joined at S it is possible that the resulting curve may not follow the center of the tubular structure rather it may follow a tortuous path inside the tubular structure. To alleviate this condition the result may be cached at S passing through S in a first loop and the range increased at S to run the process again S . The amount that the range is increased depends on the initial range the full range of the values in the dataset how much the range was increased the last time the range was increased etc. As will be shown in and A D changing the range enables the process of to take advantage of the principal that a curve following the center of a tubular structure is guaranteed to be shorter than one that follows a tortuous path inside the tubular structure. Thus after running through the process S S a subsequent time if the result of the process is better at S then the result may cached at S and so on. A better result is when the length of the curve is shorter than the length of the curve as determined in the previous pass through the loop. The process continues until it fails to find a curve connecting the two points or the resulting curve is longer than a previous result which likely means the range has become too large S .

Returning back to S if both curves are terminated the process flows to S where the range is increased and the curves are reinitialized to start over at S. At S it is determined if the range is no longer okay then it is determined if there is a result at S. The test at S determines if the range has grown to greater than five times the initial range or if more than 20 iterations of the loop have been performed. If so then the process will halt with a failure at S. If there is a result then the process halts with a success at S.

Thus to summarize the operational flow of an optimal result may be found when the curve connecting the two points is along the shortest path length constrained by the smallest range used to determine cross sectional areas. It is noted that sampling associated with the processes herein may be performed using trilinear interpolation.

Once the centerline of a vessel is determined contouring may be performed by taking cross sections of the vessel at regular intervals. With the cross sections the edge of the tubular structure may be determined. Finding high quality contours that outline a tubular structure from a collection of cross sections may be problematic as tubular structures may not exhibit a large gradient magnitude at their borders. In addition tubular structures may contain bifurcations trifurcations or more complex branch structures that make finding high quality contours difficult. In using the results from contouring it is possible that the contour produced at a branching of the vessel may be identified as a false positive for an aneurysm or stenosis or may otherwise obscure important details.

In the active contour model a snake is a set of points. The snake may be visualized as a rubber band of arbitrary shape that is deforming over time to get as close as possible to the object contour. Snakes depend on other mechanisms to solve the problem of finding contours such as interaction with a user or information from image data adjacent in time or space to points of interest. As understood by those of ordinary skill in the art a snake is an energy minimizing deformable spline influenced by constraint and image forces that pull it toward object contours. A snake is initialized near the target about the selected point and is iteratively refined such that it is attracted toward the salient contour. The snake in the image can be represented as a set of n points 

The external forces are derived from the image itself and are dependent on what is being looked at in the image. For example if the edges or boundaries of a vessel are of interest an edge functional force may be used. The edge functional force is based on the magnitude of the first derivative of intensity values of the image and may be defined as follows In accordance with the result of the edge functional force points in the image may be moved to locations such that a minimum value for energy is obtained. As will be described below an external force based on a second derivative of the image intensities at points in the image is determined in accordance with the following 

In some implementations the internal energy forces may be defined using Cand Ccontinuity. Ccontinuity is the continuity of the tangent vector of a curve where Ccontinuity is the continuity of the acceleration vector associated with a curve. The stronger the internal forces the more stiff the curve will be i.e. it will have less kinks or bends . The stronger the edge functional force the more likely a point will be trapped in a local minima i.e. where a gradient magnitude is relatively high . Thus the selection of the starting point will affect the results of the calculations.

In some implementations a balloon snake maybe used wherein the balloon is initially within the vessel walls. A balloon snake is a snake that behaves like a balloon which is blown up. When it passes by edges it is stopped if the contour is strong or passes through if the contour if the contour is too weak. Balloon forces are applied to make the snake grow. When the gradient magnitude is significant enough to prevent the balloon forces from expanding further then it will ultimately converge there.

With the above introduction the operational flow diagram of will now be described. At S the image is normalized. Normalizing the image data changes the range of pixel intensity values such that they are within a predetermined range. From the normalized data a starting point is provided where the energy is minimized. This may be provided by a user input or automatically as noted above. For example a center of the image may be used as a starting point based on an assumption that the vessel or tubular structure is centered within the image. If that is the case from the center of the image a middle twenty five pixel values are averaged to be used to normalize the image pixel intensities. Other numbers of pixel values may be used. Averaging of the middle pixel values reduces the likelihood of an abnormally high or low pixel value from being used in the normalization process. Using the average value the entire image is normalized by dividing the pixel values by the average value.

At S snake casting rays are initialized. The snake may be initialized as circle having e.g. thirty two points at a radius of one pixel. Other numbers of points may be used. Rays may be cast from the middle through each of the points and outward into the image to search for a pixel along the ray having a change in intensity of at least 10 e.g. 0.1 greater or less than the middle value . When such a point is found along a particular ray the initial point of that ray is moved from the circle radius to the new point where the intensity change was found. When such a point is found for all points the snake is initialized at those points i.e. the snake is initialized as a closed curve encompassing the e.g. thirty two points . Ray casting at S addresses dependencies that snakes have on external mechanisms in finding contours.

At S the force multipliers are initialized. In particular a balloon force may be set such that it converges at that a predetermined radius. This selection is based on a principal that if there are no external forces acting on the balloon snake then for a selected magnitude of the balloon force the balloon will converge at a specific radius. In implementations using the balloon snake the constants chosen to define the balloon force has an opposite effect on the continuity forces Cand C. For example if Cand Care 0.05 the balloon force to converge at a radius of five may be 0.8. The relationship follows a linear correlation. As such various combinations of the balloon force and the Cand Ccontinuity forces may be selected in accordance with a desired radius of convergence.

In some implementations the magnitude of the balloon force may be set such that it converges at radius that is an average distance of the points determined at S where intensity changes were located. The average distance may be computed from an area defined by the points where the area that is assumed to be substantially circular.

At S the image forces are calculated. For example the magnitudes of the first and second derivatives of the image intensities at points in the image may be determined. In some implementations where a vessel is small an external force based on the second derivative of the image intensities maybe used. This serves to push the contour out such that it lies just outside the vessel wall.

The results from S may be used at S where a gradient descent minimization is performed. Gradient descent minimization is an optimization which can be used to minimize snake energy. For example the minimization may be performed by taking the second and fourth derivatives of the curve itself for the internal forces and taking the second derivative of the intensity of the image.

The points vector vmay be iteratively adjusted by using gradient descent minimization. Applying the derivative to energy function gives The above can be approximated using finite differences i.e. the second derivative with respect to s can be calculated using three adjacent points on the snake and the fourth derivative with respect to s can be calculated using five adjacent points. Thus the final equations are 

As described above the process at S is performed iteratively. Iterations may be performed until the is less than 0.001 pixel or until some maximum number of iterations is reached e.g. 1000 after which the minimization is stopped wherein the snake substantially approximates the contour of the vessel of interest.

Optionally at S a flood fill is performed that is constrained by the contour. This may be used where the image data is CT data. Where the image data is MR data the snake may be used directly to determine the contour. With CT data the snake constrains the flood fill which is done to exclude calcifications that appear in the data. Among other things the constraint prevents the contour from being pulled into neighboring bone.

The aforementioned operational flow provides improved results when there is low contrast between the edge of the vessel and the surrounding tissue. In addition the flow will determine a contour around a branch where conventional methods would flood fill info the branch.

In accordance with implementations of the present disclosure branches and bifurcations may be detected. The first property used to detect a branch is curvature. Normally with a tubular structure the curvature of the cross section contour will not change sign. Typically a vessel has a positive curvature. If the sign of the curvature changes that will often indicate a potential branch. This is shown in which has a cross section with negative curvature. The next property used to detect branches is the change in circularity. A tubular structure will not normally have sudden changes in circularity. When a significant change in circularity occurs that can also indicate a potential branch demonstrates this note the location of the centerline. The other property that may be measured to detect branches is the change in area inside the contour. A sudden change in the area inside a contour can also indicate a potential branch. shows a branch completing the area inside the contour around where the centerline lies will have changed significantly. Often when these measurements indicate a branch multiple consecutive cross section contours are identified as potential branches. Combinations of the above properties may be used to identify a bifurcation.

To address this situation the operational flow begins with the operations at S S as described above with regard to . The operations at S S may be a first pass to determine the contour of the vessel of interest. Next at S it is determined if this is a first pass through the operational flow . If so then a second pass through all the contours may be made beginning with a change on how the snake is initialized. For example a smoothing operation may be performed on all points of the contour at S to push the snake past the local minima in which it is stuck so that the operation flow can find the correct contour.

For example the initialization may be based on e.g. a 50 50 mix of the ray casting initialization performed at S and a contour that is passed into the algorithm. The contour that is passed is determined by taking the results of the first pass at S and performing a Gaussian smoothing operation on the contours. This smoothing is performed at each point of a contour by using kernel coefficients to blend the adjacent surrounding contours with the contour being smoothed. In some implementations a previous two contours and a next two contours may be used with respect to the point on the current contour. These may be mixed together to arrive at a new result for the point at the current contour. In some implementations the results of the first pass may be used in the initialization process at S.

After the initialization at S the operations at S S are performed a second time using the results of the initialization at S. The flow again returns to S where it is determined that this is not the first pass. As such the optional flood fill at S may be performed. If the flood fill operation is performed there may be some poor contours. The quality may be determined in accordance with the properties for branch and bifurcation detection note above. In an optional operation at S to fix the quality of such poor contours the same Gaussian smoothing operation across contours may be performed after the flood fill for local smoothing.

With reference to in some cases a snake result may exhibit a halo effect in an MR image. also illustrates a plot of the image intensities vertical axis along the yellow line segment intersecting the contour. The red vertical line segments represent the intersection points of the contour with the yellow line segment. The halo effect can happen where the magnitude of the gradient is greatest at a point inside the tubular object. To alleviate this the process of may include another step after step and before step S where the snake is pushed slightly outwards and then a flood fill is used to find a new contour using thresholds calculated from intensities inside the original snake. For example the snake may be pushed out the lesser of half the current radius or five pixels. After applying the optional step to push out the snake the resulting contour may look like that in . The above method may be used for any image that exhibits a halo effect with MR being exemplified.

A workflow associated with a user interface will now be introduced with reference to . Generally a user may instantiate the user interface on a workstation such as that described above. The user interface provides options to select edit analyze and generate reports regarding vessels within image data associated with e.g. a patient. A user may initially select a particular vessel or vessels of interest to be displayed in a four quadrant view that shows e.g. a 3D view of an area of interest and associated orthogonal 2D views of the same area of interest. Once the vessel selected the user may edit particular properties of the vessel such as the centerline which may have been automatically generated in accordance with the methods above.

Once the user is satisfied with the vessel user may enter an analysis view. In this view a vessel contour may be shown. Within the analysis view user may select various functions to determine characteristics of the vessel under analysis. For example the user may determine areas of stenosis or aneurysms present in the vessel either manually or automatically by selecting an appropriate tool. The user may also edit contours associated with the vessel of interest. Other data may be displayed such as cross sections diameters areas etc. When the user has completed the analysis of the vessel a report may be generated to provide information in a condensed format for review by e.g. a healthcare professional. With the introduction above the specifics of each mode of operation as presented in the user interface will now be introduced.

Referring now to there are screen shots of a user interface that may be presented on e.g. the user workstation to view image data acquired by the image processing system . illustrates computed tomography CT contrast imagery. The area indicated with a marker is right iliac vessel adjacent calcification and shown in cross section in a window . In accordance with the user Interface shown calcification is excluded as described above.

It should be understood that the various techniques described herein may be implemented in connection with hardware or software or where appropriate with a combination of both. Thus the methods and apparatus of the presently disclosed subject matter or certain aspects or portions thereof may take the form of program code i.e. instructions embodied in tangible media such as floppy diskettes CD ROMs hard drives or any other machine readable storage medium wherein when the program code is loaded into and executed by a machine such as a computer the machine becomes an apparatus for practicing the presently disclosed subject matter. In the case of program code execution on programmable computers the computing device generally includes a processor a storage medium readable by the processor including volatile and non volatile memory and or storage elements at least one input device and at least one output device. One or more programs may implement or utilize the processes described in connection with the presently disclosed subject matter e.g. through the use of an application programming interface API reusable controls or the like. Such programs may be implemented in a high level procedural or object oriented programming language to communicate with a computer system. However the program s can be implemented in assembly or machine language if desired. In any case the language may be a compiled or interpreted language and it may be combined with hardware implementations.

Although the subject matter has been described in language specific to structural features and or methodological acts it is to be understood that the subject matter defined in the appended claims is not necessarily limited to the specific features or acts described above. Rather the specific features and acts described above are disclosed as example forms of implementing the claims.

