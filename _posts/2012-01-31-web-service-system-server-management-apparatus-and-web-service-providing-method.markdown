---

title: Web service system, server management apparatus, and web service providing method
abstract: A virtual device management server manages location information and resource information about a virtual device server as server information. The virtual device management server receives a processing request and printer location information from a printer. Then, the virtual device management server selects a virtual device server for providing a Web service corresponding to the processing request on the basis of server information, the processing request, and location information about the printer to thereby assign the selected virtual device server to the printer.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09146781&OS=09146781&RS=09146781
owner: CANON KABUSHIKI KAISHA
number: 09146781
owner_city: Tokyo
owner_country: JP
publication_date: 20120131
---
The present invention relates to a Web service system a server management apparatus and a Web service providing method.

Service creation methods that bring a plurality of Web services into association with a service bus have been proposed. Japanese Patent Laid Open No. 2010 9218 discloses a service bus association method that can utilize a Web service on the adjacent service bus through registration of node identifiers and location information for service buses.

However if the service bus association method disclosed in Japanese Patent Laid Open No. 2010 9218 is applied to a Web service system including an image forming apparatus a server that provides a Web service corresponding to processing requested from the image forming apparatus and a server management apparatus that manages the server the following problems may arise. Depending on the application of the service bus association method it is difficult for the server management apparatus to select as Web service which corresponds to the location of the image forming apparatus and the processing content requested by the image forming apparatus among a plurality of Web services and to provide the selected Web service to the image forming apparatus.

For example a description will be given of the aforementioned difficulty using an example as follows. Assume the case where as server management apparatus that operates on a cloud manages a virtual printer as a server and a virtual device installed on the server provides a Web service corresponding to processing requested from an image forming apparatus. The virtual device functions as a processing execution unit that executes processing corresponding to a Web service.

When the server management apparatus assigns an image forming apparatus that has requested print processing to a virtual device that executes print processing the main body of a virtual printer on which the virtual device has been installed is not limited to be arranged at the same location as that of the image forming apparatus or the location adjacent thereto. For example when the image forming apparatus is located in Japan and the main body of the virtual printer is located in U.S.A. a time lag in the communication between the image forming apparatus and the virtual printer may occur. Thus it may take a long time until a service utilizing resources of the virtual printer is received by a user of the image forming apparatus.

Also when the resources of the server virtual printer managed by the server management apparatus vary a Web service corresponding to processing requested by the image forming apparatus may vary. In such a case depending on the application of the service bus association method disclosed in Japanese Patent Laid Open No. 2010 9218 it may be difficult to select a Web service corresponding to processing requested by the image forming apparatus.

The Web service system of the present invention includes an image forming apparatus and a server management apparatus that manages a server for providing a Web service corresponding to processing requested by the image forming apparatus and selects an appropriate Web service depending on the location of the image forming apparatus and the requested processing content.

The Web service system of an aspect of the present invention includes an image forming apparatus and a server management apparatus that manages a plurality of servers for providing a Web service corresponding to processing requested by the image forming apparatus. The server management apparatus includes a first acquisition unit configured to acquire location information about a server and resource information about the resource of the server from the servers and to manage the acquired information as server information a request reception unit configured to receive a processing request from the image forming apparatus a second acquisition unit configured to acquire location information about the image forming apparatus from the image forming apparatus and a selection unit configured to select a server for providing a Web service corresponding to the processing request from the plurality of servers on the basis of server information managed by the first acquisition unit a processing request received by the request reception unit and location information about the image forming apparatus acquired by the second acquisition unit to thereby assign one selected server to the image forming apparatus.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

The printer to the virtual device server are allowed for communication via a network such as Internet or the like. Of course the printer to the virtual device server may provide communication via a wireless LAN such as IEEE 802.11 or the like.

Given that the functions of the Web service system of the present embodiment are implemented the operation of a program on the printer the virtual device management server and the virtual device server may be executed using a CPU RAM and ROM on a printer where CPU is an abbreviation for Central Processing Unit RAM is an abbreviation for Random Access Memory and ROM is an abbreviation for Read Only Memory. Also the operation of a program on the virtual device management server and on the virtual device server may be executed in a virtual computer environment.

The printer is the image forming apparatus of the present embodiment. The printer may be a printer that provides a print function or may be a multi function peripheral MFP or the like that provides multi functions such as printing scanning faxing and the like.

In the present embodiment the printer makes a processing request to the virtual device management server . The processing request is a print processing request for for example print processing. The print processing request includes a print job for executing print processing for print data. In other words the printer functions as a client for a Web service.

The printer incorporates communication protocol for communication with the virtual device management server the virtual device server and the virtual device server . The printer executes transmission reception of a request processing request between the printer and the virtual device management server or the virtual device server using the incorporated communication protocol. Examples of such communication protocol include HTTP file transfer SNMP WS Eventing and the like.

Each of the virtual device management server and the virtual device servers and provides a service corresponding to a request from the printer serving as the source of the request. The virtual device management server functions as a server management apparatus that manages the virtual device servers and . More specifically the virtual device management server provides a virtual device management function as a Web service. The virtual device management function is a function that manages the creation deletion or the like of a virtual device.

Also the virtual device is a processing execution unit that provides a Wed service that executes processing in accordance with the processing request from the printer on the virtual device server. The virtual device management server selects a virtual device server in accordance with the processing request from the printer and instructs the selected virtual device server to create a virtual device for providing a Web service corresponding to the processing request.

Each of the virtual device servers and is a server that provides a Web service corresponding to processing requested by the printer . More specifically the virtual device server creates a virtual device service as a virtual device in accordance with the instruction given by the virtual device management server . The virtual device service executes processing requested by the printer on behalf of the printer to thereby return the result of the execution of the processing back to the printer . In the present embodiment it is assumed that the virtual device server provides a Web service in Japan and the virtual device server provides a Web service in U.S.A.

A description will be given by taking an example of a case in which the printer requests an image processing service to the virtual device management server . The virtual device management server selects a virtual device server corresponding to the image processing service and instructs the selected virtual device server to create the instances of a virtual device service corresponding to the image processing service. The virtual device management server manages a virtual device service the instances thereof created by a virtual device server for each Web service. In this example the virtual device management server stores provider information including information about the instance of a virtual device service corresponding to an image processing service in a service registry storage unit for management.

Each of the instances of a virtual device is functioning on a virtual machine VM . VM is a virtual PC in which hardware resources required for a virtual device service such as a memory a CPU or the like of a physical PC are virtually configured as a single PC. The printer utilizes a virtual device service realized by the VM whereby a Web service in this example an image processing service is provided.

More specifically in the same manner as in image processing performed by the printer the virtual device service performs rasterize processing for print data from a drawing command PDL and converts the rasterized print data to drawing data on papers. Also the virtual device service executes processing on the basis of various color processing and engine unique information.

When the image processing unit provided in the printer executes image processing there is a restriction depending on a resource such as a CPU RAM or the like or a program stored in ROM. However in the present embodiment the virtual device service executes image processing on behalf of the printer and thus such restriction is small. Thus the virtual device service can execute image processing at a high speed as compared with a case where the printer performs image processing. Also even when the image processing unit provided in the printer is defective the virtual device service can perform image processing on behalf of the printer .

Examples of other Web services provided by a virtual device include Scan service data compression expansion service data encryption decryption service Web server service storage service mail service and the like.

Also the functions of the virtual device management server and the virtual device servers and may be realized by a physical PC or may also be realized by a virtual OS or a virtual PC such as a virtual disk or the like. Further the communication between the apparatuses included in the Web service system of the present embodiment may be any type of communication using address information. For example a communication protocol such as IPv4 IPv6 or the like may be applied to the communication. The communication protocol is not intended to limit a protocol in each respective one of a physical layer a data link layer a network layer a transport layer a session layer a presentation layer and an application layer of an OSI reference model.

The physical PC shown in includes a CPU Central Processing Unit RAM Random Access Memory and ROM Read Only Memory . Also the physical PC includes a KBC Keyboard Controller and a display control unit . The physical PC further includes a DKC Disk Controller an NWC Network Controller a KB Keyboard a display unit and an external memory .

The CPU is a central processing unit that collectively controls the units connected to as system bus . The CPU executes the various processing operations for documents in which graphic patterns images characters tables including table calculation or the like and the like are mixed on the basis of an application document processing program or the like stored in a ROM for program of the ROM or the external memory . Also the CPU executes for example an expanding rasterizing process of an outline font into a display RAM set on the RAM and displays the expanded outline font on the display unit via the display control unit . The display unit is for example a CRT and the display control unit is for example a CRTC.

Also the CPU opens various registered windows and executes various data processes on the basis of commands instructed by a mouse cursor or the like on the display unit . When as user uses as client application or a server service a user can open as window regarding operations for the settings to thereby make the settings. The display unit is not limited to a CRT but may be a liquid crystal plasma or the like.

The RAM functions as a main memory a work area or one like of the CPU . The ROM includes a ROM for font a ROM for program a ROM for data or the like all of which are not shown. A ROM for font or the external memory stores font data or the like for usage during document processing or the like.

The ROM for program or the external memory stores an operating system hereinafter referred to as OS that is the control program of the CPU or the like. The ROM for data or the external memory stores various data for usage during the aforementioned document processing or the like. A program stored in the external memory is expanded on and executed by the RAM upon execution.

The KBC controls input information input by the KB and a pointing device not shown . The display control unit controls displaying on the display unit . The DKC controls access to the external memory . The NWC is connected to a network via a bi directional interface .

A keyboard includes various keys. The display unit displays graphic patterns image characters tables and the like. The external memory includes a HD Hard Disk a floppy registered trademark disk and the like. The external memory stores a boot program various applications font data a user file an edit file or the like.

A UI unit receives an MFP input operation. Also the UI unit displays various information. A paper feeding unit is a mechanism that feeds printing paper to a fixation unit during printing. The fixation unit is a mechanism that fixes a toner onto a paper fed from the paper feeding unit . A paper discharging unit is a mechanism that discharges a paper on which a toner has been fixed by the fixation unit . A finishing device is a mechanism that performs processing such as stapling punching or the like for a paper which has been discharged from the paper discharging unit in accordance with ordering information. A paper discharging tray is a tray that holds printed matter finally subject to printing and finishing.

The main controller controls the overall print function. More specifically the main controller performs input output control with the external and controls a print function by providing instructions to the engine control unit the image processing unit or the like.

An offload processing control unit provided in the main controller is a main control unit that communicates with the virtual device management server and the virtual device server with regard to processing for MFP. An offload control unit is operated by the CPU the ROM the RAM the HDD and a network control unit on the main controller . These components are independently provided as dedicated hardware for controlling the offload processing control unit and thus a high availability system can be constructed.

The network control unit controls communication with an external equipment. The network control unit receives a print instruction or receives a configuration information acquisition instruction from a client PC not shown via the LAN and transmits the results of processing in accordance with the instruction. Also the network control unit communicates with the virtual device management server and the virtual device server via the LAN or the Internet .

The CPU is a central processing unit that controls the units connected to a controller bus . The CPU executes the various processing operations for controlling the printer on the basis of a program stored in ROM for program in the ROM or the HDD serving as an external memory.

The ROM functions as a storage region for storing a program or the like executed by the CPU . The RAM functions as a main memory a work area or the like for the CPU . The HDD functions as a storage region for storing a program a work area and user data.

The engine control unit controls the print function of the printer . Here controlling a print function refers to controlling paper transfer and a fixation device. More specifically the engine control unit feeds a paper which has been conveyed from the paper feeding unit to the fixation unit so as to transfer drawing data processed by the image processing unit onto the paper. The fixation unit fixes a toner onto the paper fed from the paper feeding unit for printing. The paper printed by the fixation unit is conveyed to the paper discharging unit .

The image processing unit performs rasterize processing for print data from a drawing command PDL and converts the rasterize print data to drawing data on paper. Also the image processing unit performs processing on the basis of various color processing and engine unique information.

The client location information acquisition unit acquires client location information representing information about the location of the printer and transmits client location information to the virtual device management server via the transmission reception unit and the Internet . The client location information acquisition unit acquires physical location information or relative location information as client location information. Physical location information is information about the physical location of the printer . Relative location information is information about the relative location between the printer and the virtual device server.

The virtual device management server to be described below selects a virtual device server which provides a Web service corresponding to a processing request made from the printer using client location information acquired from the printer . The transmission reception unit transmits receives information between the virtual device management server and the virtual device server in accordance with the instruction given by the main controller .

Service identification shown in indicates a virtual device server for providing a Web service. For example a service identifier corresponding to a virtual device server for providing a print service is Print001 Print002 or Print003 . The number of hops is the number of times passed through a router during communication between the printer and each virtual device server. A communication delay is a communication delay time RTT during communication between the printer and each virtual device server. A time difference is the time difference between two local times of the printer and each virtual device server.

Since the units provided in the printer have been described with reference to a detailed description with reference to is omitted. A description will be given of the processing units provided in the virtual device management server and the virtual device servers and . The processing units provided in the virtual device management server and the virtual device servers and are stored in a ROM an external memory or the like and are executed by a CPU using a RAM as appropriate. The processing units that are common to the virtual device management server and the virtual device servers and are designated by the same reference numerals and thus an explanation thereof will be omitted.

A transmission reception unit transmits receives information between the printer and the network control unit using the NWC see . For example the transmission reception unit receives a processing request and an information acquisition instruction from the printer and transmits their response thereto to the printer .

Assume the case where the main controller of the printer causes a virtual device service created in the virtual device server to execute proxy processing for the image processing unit . In this case the transmission reception unit transmits an instruction for executing the proxy processing to the transmission reception unit of the virtual device server in accordance with the instruction given by the engine control unit . The transmission reception unit of the virtual device server returns the result of the execution of proxy processing back to the transmission reception unit of the printer .

Proxy processing for the image processing unit is not limited to the execution of print processing. Also the main controller of the printer may cause the virtual device service created in a virtual device server to execute proxy processing for the engine control unit . Also when an error occurs in the engine control unit or the image processing unit the main controller of the printer may cause the virtual device service created in a virtual device server to execute processing regarding the error.

A Web server is a Web service server that communicates with the transmission reception unit of the printer using a REST protocol a SOAP protocol or the like. Also the Web server communicates with a virtual device management unit of the virtual device management server using a REST protocol a SOAP protocol or the like. A protocol for usage in communication according to the present embodiment is not limited to a REST protocol or a SOAP protocol. Communication between the printer and the Web server may be established using a TCP or a UDP protocol an HTML protocol or the like.

The Web server provided in the virtual device management server receives a processing request from the printer and passes the processing request to the virtual device management unit . The virtual device management unit functions as a request reception unit that receives the processing request. Also the Web server passes response information which has been received from the virtual device management unit to the transmission reception unit .

For example assume the case where a drawing processing request is made from the printer to the Web server . The drawing processing request includes a drawing command PDL . The virtual device management unit passes information access information for gaining access to a virtual device server which performs drawing processing in accordance with the drawing command as response information to the transmission reception unit . Access information for a virtual device server is for example information about the end point of a virtual device server. The transmission reception unit transmits response information back to the transmission reception unit of the printer .

Each of the Web servers provided in the virtual device servers and receives a request from the virtual device management server or the printer and passes the request to a virtual device control unit . Also the Web server passes response information received from the virtual device control unit to the transmission reception unit .

The virtual device management unit provided in the virtual device management server exchanges information with the printer . For this purpose the virtual device management unit controls to invoke a necessary processing unit s provided in the printer controller . Also the virtual device management unit instructs the virtual device control unit provided in each of the virtual device servers and to thereby control the virtual device service . For controlling the virtual device service the virtual device management unit the Web server and the transmission reception unit may also process requests from a plurality of printers using one instance.

When the number of the printers which serve as the processing request sources for the virtual device management server and the virtual device servers and is large a network load balancer may also be provided for holding a numerous number of TCP sessions for a long period of time. With this arrangement a large scale system may readily be made.

Next a description will be given of the function of the virtual device management server as a host computer a provider that is a Web server service running on the host computer and a Web service running on a Web server according to the present embodiment. In the present embodiment the virtual device service operates as a Web service.

A provider information management unit functions as a first acquisition unit that acquires information server information about a virtual device server as provider information from the virtual device server. The provider information management unit registers the acquired provider information in the service registry storage unit . Provider information includes location information about a virtual device server resource information about the virtual device server and hardware resource information about the virtual device server. These information is associated with a Web service provided by the virtual device service of a virtual device server.

A provider location information acquisition unit of a virtual device server acquires location information about the virtual device server. A resource information acquisition unit acquires resource information about the virtual device server. Also a hardware resource information acquisition unit acquires hardware resource information about the virtual device server. Then the transmission reception unit passes provider information including location information about the virtual device server resource information about the virtual device server and hardware resource information about the virtual device server to the provider information management unit of the virtual device management server .

Location information about a virtual device server includes regional information. Examples of regional information include region information locale information and a local time. Location information about a virtual device server also includes physical location information or relative location information. Examples of physical location information includes GPS information user setting location information virtual PC location information physical PC location information an IP address and network domain information. Relative location information includes a network configuration map a network node to node distance a communication delay time RTT and the time difference between two local times.

Examples of resource information includes the CPU usage rate of each of a physical PC a host OS and a virtual PC the usage rate of a Network card the usage rate of a disk I O the transmission rate of a disk the transfer amount of a network card the transmission rate of a virtual network and the available space of a disk.

In the present embodiment when a virtualization technique such as a virtual PC a virtual server a virtual OS or the like is used a virtual device server can acquire resource information from a virtualization management interface on an operating system or a virtual OS. Hardware resource information can also be acquired from a host OS for managing a virtual OS or from a virtual OS.

The service registry storage unit stores the provider information acquired by the provider information management unit . A service provider determination unit selects a virtual device server for providing a Web service corresponding to the processing request from the printer and the virtual device service running on the virtual device server in accordance with the instruction given by the virtual device management unit .

The service provider determination unit executes the following processing in accordance with the instruction given by the virtual device management unit . The service provider determination unit determines a virtual device server and a virtual device service to be selected on the basis of the content of the processing request acquired from the printer client location information and provider information stored in the service registry storage unit . In other words the provider information management unit the service provider determination unit and the virtual device management unit collectively function as a selection unit that selects a virtual device server for providing a Web service corresponding to the processing request and assigns the selected virtual device server to the image forming apparatus .

A service deploy unit executes service deploy processing in accordance with the instruction given by the virtual device management unit . Service deploy processing is processing for activating the virtual device service created in a virtual device server for processing a processing request from the selected virtual device server i.e. the printer . For this purpose firstly the virtual device management unit determines the activation destination of the virtual device service on the basis of the determination result of the service provider determination unit . Then the service deploy unit installs or sets up software required when a virtual device server creates the virtual device service .

Software to be installed and set up includes a hypervisor an operating system a Web server service a database service a Web service and an enterprise service bus.

A hypervisor is OS virtualization software that virtualizes an operating system. Also this software includes a service registry client a virtual device service or the like. The service deploy unit installs this software in a virtual device server for processing a processing request from the printer and further activates the virtual device service for processing a processing request from the printer .

In order to activate the virtual device service at high speed the service deploy unit may be prepared in advance for installation of software on the basis of the demand supply prediction obtained by the processing request from the printer . For example the service deploy unit activates the virtual device service independent of the printer of which the set values are default values and sets up the virtual device service in accordance with the processing request from the printer . With this arrangement the virtual device service can be activated at high speed.

A resource monitoring unit monitors resource information included in provider information stored in the service registry storage unit . More specifically the resource monitoring unit functions as a monitoring unit that monitors a change in the state of the resources of a plurality of virtual device servers.

Resource information is variable depending on creation or extinguishment of the virtual device service by a virtual device server or depending on the load of the virtual device service that executes processing in accordance with the processing request from the printer . Also when a virtual device server on which the virtual device service is activated is running on a virtual OS resource information may vary depending on the load state of another virtual OS. In such a case the resource monitoring unit detects variations in resource information and the service provider determination unit again determines a virtual device server and the virtual device service that are capable of optimally processing a processing request from the printer .

In other words the service provider determination unit specifies a virtual device server having resources which satisfy the conditions for providing the Web service that is currently been provided depending on the monitoring result of a change in the state of resources. The service provider determination unit selects a server for providing the Web service that is currently been provided on the basis of the results of comparison between physical location information and location information about the specified virtual device server or relative location information. Then the virtual device management unit switches a virtual device server for providing the Web service from the server that is currently providing the Web service to the selected server.

When the service provider determination unit again determines the virtual device server and the virtual device service a Web service shifting unit executes the following processing. The Web service shifting unit changes the virtual device server and the virtual device service that provide a Web service in accordance with the processing request managed by provider information.

While the number of virtual device servers shown in is two the Web service system of the present embodiment may also have a configuration in which three or more scaled out virtual device servers are provided. For example depending on the number of printers that are the sources of at processing request or the processing load of a virtual device server the virtual device server is scaled out. A large scale system may be constructed by connecting the scaled out virtual device server and the virtual device management server via a service bus.

The virtual device management unit instructs the virtual device control unit of a virtual device server which has been added by scaling out to created the virtual device service . The virtual device control unit creates the virtual device service and loads application and setting information to the created virtual device service to thereby increase the virtual device service that is capable of being processed.

The virtual device management unit may also be adapted to add not only the virtual device service but also an operating system or the Web server on VM. Scale down processing may be performed by reducing the virtual device service and the virtual device server.

The hardware resource information acquisition unit provided in the virtual device server acquires information about hardware resources installed on the virtual device server. Hardware resource information includes information device information about a device for performing hardware processing for the processing request from the printer .

Hardware resource information includes for example information about a SSL accelerator for processing SSL communication at high speed and information about GPU for processing an encryption accelerator and image processing at high speed. Hardware resource information also includes information about a compression decompression accelerator for processing data compression decompression and information about a wide band network card for high speed communication. Hardware resource information further includes information about a memory or a CPU and storage information.

Also examples of device information include information about the processing in support and the status of device. For example device information about an SSL accelerator is the protocol version of SSL or TLS. Also device information about a compression decompression accelerator includes a compression algorithm its attribute or the like.

The resource information acquisition unit acquires the above mentioned resource information. The provider location information acquisition unit acquires the above mentioned virtual device server location information. A provider location information storage unit stores virtual device server location information acquired by the provider location information acquisition unit .

The virtual device control unit executes the following processing in accordance with the instruction received from the virtual device management unit of the virtual device management server . The virtual device control unit acquires hardware resource information from the hardware resource information acquisition unit . Also the virtual device control unit acquires resource information from the resource information acquisition unit . Further the virtual device control unit acquires virtual device server location information from the provider location information storage unit . Then the virtual device control unit transmits all of these acquired information as provider information to the virtual device management server via the transmission reception unit .

Also the virtual device control unit creates the virtual device service . The virtual device service is a Web service that executes processing in accordance with the processing request from the printer . The virtual device service runs on the Web server . For example the virtual device service performs proxy processing for the image processing unit of the printer . When the image processing unit of the printer is defective or it takes time for processing because of the insufficient processing power of the image processing unit the virtual device service performs processing on behalf of the image processing unit .

The virtual device service may also be adapted to execute processing of the functions not provided in the printer . For example when the printer does not have an OCR function the virtual device service provides the OCR function. With this arrangement the OCR function can be implemented as if the OCR function has been added to the printer . The virtual device service loads a program for each function for implementing the functions of the virtual device service . With this arrangement the virtual device service is capable of providing various functions on behalf of the printer .

A Web service provided by the virtual device service is managed by the provider information management unit of the virtual device management server . More specifically virtual device server location information virtual device server resource information and virtual device server hardware resource information which have been associated with the Web service are stored as provider information in the service registry storage unit . With this arrangement the virtual device management unit can create and search a Web service provided by the virtual device service .

A description will be given of the assignment of a Web service in accordance with the processing request from the printer to the printer . As described above it is assumed that the virtual device server provides a Web service in Japan and the virtual device server provides a Web service in U.S.A.

The service provider determination unit of the virtual device management server executes the following processing on the basis of provider information acquired from the service registry storage unit and a Web service indicated by the content of the processing request from the printer . The service provider determination unit acquires virtual device server location information that has been associated with the Web service. The service provider determination unit executes the following processing when client location information acquired from the printer is physical location information.

The service provider determination unit compares the physical location information with the acquired virtual device server location information and executes the following processing on the basis of the comparison result. The service provider determination unit selects a virtual device server which is arranged at a location closest to the physical location of the printer as a virtual device server for providing a Web service corresponding to the processing request.

For example when the service provider determination unit has selected the virtual device server in Japan as the virtual device server for providing a Web service corresponding to the processing request the virtual device service is created in the virtual device server . Also for example when the service provider determination unit has selected the virtual device server in U.S.A. as the virtual device server for providing a Web service corresponding to the processing request the virtual device service is created in the virtual device server .

The service provider determination unit may select a virtual device server for providing a Web service corresponding to the processing request on the basis of not only region information but also a data center such as Tokyo Osaka or the like and the physical PC location in the data center.

When client location information is relative location information the service provider determination unit may select a virtual device server in the following manner. The service provider determination unit selects for example a virtual device server having the shortest communication delay time RTT with the printer as a virtual device server for providing a Web service corresponding to the processing request.

Next the virtual device control unit of each of the virtual device servers and is activated P . With this arrangement the virtual device service is ready for provision. Next the provider location information acquisition unit is activated and then the provider location information acquisition unit acquires virtual device server location information P .

Next the Web server of each of the virtual device servers and is activated P . Next the hardware resource information acquisition unit is activated to acquire hardware resource information. Also the resource information acquisition unit is activated to acquire resource information P .

Next the virtual device servers and notify the virtual device management unit of the virtual device management server that the activation of the virtual device control unit has been completed. At this point the virtual device service associated with the processing request of the printer is not yet activated. The virtual device servers and transmit provider information including information acquired in P and P to the virtual device management server P . Then the virtual device management server stores provider information in the service registry storage unit P .

By means of the processes in P to P the virtual device management server and the virtual device servers and are ready for providing the virtual device service to the printer .

Next the printer determines the process to be executed by the virtual device service of the virtual device server and transmits a processing request to the virtual device management unit of the virtual device management server P . In P the printer further transmits client location information acquired in P to the virtual device management server . When client location information physical location information has not been acquired in P client location information is not transmitted from the printer to the virtual device management server .

When the processing units of the printer perform special processing using hardware or software the virtual device service that executes proxy processing for the processing units needs to be able to perform the same processing as the aforementioned special processing.

Next the virtual device management unit of the virtual device management server determines whether or not a virtual device server is selectable using client location information physical location information P . When a virtual device server is selectable using physical location information the process subsequent to P is executed. When physical location information is not transmitted from the printer or a virtual device server is not selectable using physical location information the virtual device management server determines that a virtual device server is not selectable using physical location information and then executes the following processing.

Firstly the virtual device management server transmits a relative location measuring server list to the printer P . The relative location measuring server list is a list of candidates of virtual device servers that provide a Web service in accordance with the processing request. The virtual device management server selects for example a predetermined number of virtual device servers as candidates among virtual device servers that are capable of providing a Web service in accordance with the processing request and includes them in the relative location measuring server list. In this example it is assumed that the virtual device servers and are included in the relative location measuring server list.

Next the printer acquires the candidates for virtual device servers from the relative location measuring server list received from the virtual device management server P . Then the printer acquires relative location information about the virtual device servers as the candidates P . More specifically the printer acquires relative location information by means of communication processing with the provider location information acquisition units of the virtual device servers. The acquired relative location information for example includes a network configuration map a network node to node distance a communication delay time RTT the time difference between two local times or the like. The printer transmits the acquired relative location information as client location information back to the virtual device management unit of the virtual device management server P .

Next the virtual device management server selects a virtual device server for providing a Web service in accordance with the processing request on the basis of the content of the processing request from the printer client location information acquired from the printer and provider information P . For example the virtual device management server refers to provider information and acquires virtual device servers that are capable of providing the Web service. Then the virtual device management server refers to relative location information and selects a virtual device server having the shortest communication delay time RTT with the printer among the acquired virtual device servers.

Among the acquired virtual device servers the virtual device management server may also be adapted to select a virtual device server having the smallest number of hops where the number of hops is the number of routers passed through the virtual device server and the printer . Among the acquired virtual device servers the virtual device management server may also be adapted to select a virtual device server having the smallest time difference between two local times of the virtual device server and the printer . In this example it is assumed that the virtual device server is selected.

Next the virtual device management server executes service deploy processing P . Then the virtual device management unit of the virtual device management server instructs the virtual device server to create the virtual device service P . In P the virtual device management unit further determines information and setting information about an application to be loaded into the virtual device service and then transmits the determined information to the virtual device server .

Depending on the processing request from the printer one virtual device service may also perform proxy processing for a plurality of printers . The virtual device management server determines whether or not the proxy processing can be performed on the basis of information about the operational virtual device service which is included in provider information.

Also the resource monitoring unit of the virtual device management server monitors the resources of the virtual device server and the virtual device server . Then when a margin for the resources of the virtual device server which is located closer to the printer is present the virtual device management server performs the following processing. The virtual device management server changes a virtual device server for providing a Web service to the virtual device server and instructs the virtual device server to create the virtual device service .

In P shown in the virtual device control unit of the virtual device server creates the virtual device service in accordance with the instruction given by the virtual device management server . Also the resource information acquisition unit acquires virtual device server resource information and notifies update information for resource information to the virtual device control unit P . Update information for resource information is the updated resource information.

Next the virtual device control unit transmits the creation result of the virtual device service and update information for resource information to the virtual device management unit of the virtual device management server . With this arrangement registration processing for the virtual device service of the virtual device server is performed P . The creation result of the virtual device service includes information about the virtual device service for example information about VM for implementing virtual device service .

The virtual device management unit of the virtual device management server notifies the creation result of the virtual device service and update information for resource information to the provider information management unit . Then the provider information management unit reflects the notified information to provider information stored in the service registry storage unit P .

Next the virtual device management unit of the virtual device management server responds information about the virtual device service stored in the virtual device server with respect to the printer P . Information about the virtual device service transmitted back from the virtual device management unit includes access information about the virtual device service for example end point information .

Next the printer accesses a virtual device service of the virtual device server using the aforementioned access information to make a process request. For example when the printer requests an image processing service the virtual device server creates the virtual device service for image processing which is specific to the printer and assigns the virtual device service to the printer P . With this arrangement a Web service is available for the printer . The provider information management unit of the virtual device management server manages the virtual device service assigned to the printer in the service registry storage unit .

When the printer receives the process result from the virtual device service the printer makes a Web service provision end request to the virtual device management server P . The Web service provision end request is a request for the end of providing a Web service provided by the virtual device service .

Next the virtual device management unit of the virtual device management server instructs the virtual device control unit of the virtual device server to end the provision of a Web service provided by the virtual device service P . The virtual device control unit of the virtual device server ends the provision of a Web service provided by the virtual device service P . Also the virtual device server acquires update information for resource information as in P P .

Next the virtual device control unit of the virtual device server transmits the end result of the Web service provided by the virtual device service and update information for resource information to the virtual device management unit of the virtual device management server . With this arrangement processing for deleting the registration of the virtual device service of the virtual device server is performed P .

The virtual device management unit of the virtual device management server reflects information which has been transmitted from the virtual device server in provider information P . More specifically the virtual device management unit updates resource information included in provider information and deletes an entry corresponding to the virtual device service which has ended the provision of the Web service among the entries included in provider information. Then the virtual device management unit notifies the end of the provision of the Web service to the printer P .

Next client location information acquisition unit determines whether or not a client location information acquisition instruction in step S is either a physical location information acquisition instruction or a relative location information acquisition instruction step S . When the client location information acquisition instruction is the relative location information acquisition instruction the process advances to step S.

When the client location information acquisition instruction is the physical location information acquisition instruction the client location information acquisition unit acquires physical location information step S . In this example the client location information acquisition unit acquires GPS information about the printer user setting location information virtual PC location information physical PC location information an IP address and network domain information as physical location information.

In step S it is determined whether or not the relative location information acquisition instruction includes the relative location measuring server list step S . When the relative location information acquisition instruction includes the relative location measuring server list the process advances to step S.

When the relative location information acquisition instruction does not include the relative location measuring server list the client location information acquisition unit makes a relative location measuring server list acquisition request to the virtual device management unit of the virtual device management server . Then the client location information acquisition unit acquires the relative location measuring server list from the virtual device management unit step S .

In steps S and S the client location information acquisition unit acquires relative location information for the candidates of virtual device servers included in the relative location measuring server list. For example the client location information acquisition unit acquires a network node to node distance between the printer and each of the candidates of virtual device servers a communication delay time RTT and the time difference between two local times step S . For example the client location information acquisition unit acquires a network configuration map step S .

More specifically the client location information acquisition unit creates a list of network configuration between its node and various services using a network search protocol such as LLDP IEEE 802.1 AB LLTD or the like where LLDP is an abbreviation for Link Layer Discovery Protocol and LLTD is an abbreviation for Link Layer Topology Discovery. The created list of network configuration includes for example the number of hops router switch or the like.

The client location information acquisition unit creates a network map as relative location information and thus is capable of acquiring not only the number of hops during communication between the printer and the virtual device server but also a communication route and information about a switch s in the communication route. Thus an accurate network path from the printer to the virtual device server can be determined using the acquired relative location information. Consequently an optimum virtual device server through which a Web service is provided can be selected.

Next the virtual device management unit receives a processing request from the printer step S . In step S the virtual device management unit further acquires client location information from the printer functions as a second acquisition unit . The client location information to be acquired in step S includes physical location information.

Next the virtual device management unit determines whether or not a virtual device service that is capable of providing a Web service in accordance with the processing request received in step S has been registered in provider information step S . When no virtual device service that is capable of providing the Web service has been registered the process advances to step S. When a virtual device service that is capable of providing the Web service has been registered the virtual device management unit selects and registers the virtual device service as the virtual device service through which the Web service is provided step S .

In step S the virtual device management unit instructs the service provider determination unit to execute processing for determining the candidates of virtual device servers through which a Web service is provided step S . More specifically the service provider determination unit determines the candidates of virtual device servers on the basis of provider location information included in provider information and client location information.

Next the virtual device management unit acquires resource information about the candidates of virtual device servers step S . Next the virtual device management unit executes the following processing on the basis of resource information acquired in step S. The virtual device management unit determines whether or not the candidates of virtual device servers are virtual device servers that are capable of running a virtual device service through which the Web service can be provided step S . In other words the virtual device management unit refers to resource information and determines whether or not the resources provided in the virtual device server which has been determined as the candidate selection target by the process in step S satisfies a processing request.

When the candidates of virtual device servers are not virtual device servers that are capable of running a virtual device service through which the Web service can be provided the process returns to step S. When the candidates of virtual device servers are virtual device servers that are capable of running a virtual device service through which the Web service can be provided the process advances to step S.

In step S the virtual device management unit selects a virtual device server that is capable of running a virtual device service through which the Web service can be provided as the virtual device server through which the Web service is provided. Then the virtual device management unit instructs the virtual device control unit of the selected virtual device server to create a virtual device service through which the Web service is provided. Next the service deploy unit performs final synchronization of information between the virtual device service and the printer step S and the process advances to step S. With this arrangement the virtual device service transitions into an available state.

Through the process described with reference to a server having the resource satisfying the processing request among the virtual device servers to be selected on the basis of client location information can be selected as the server for providing a Web service corresponding to the processing request.

The service provider determination unit creates a list of virtual device servers of which the physical locations are close to the printer on the basis of location information about the acquired virtual device servers and physical location information about the printer acquired from the printer step S . For example the service provider determination unit specifies virtual device servers that are within a range of a predetermined distance from the printer to thereby include the specified virtual device servers in the list.

Next the service provider determination unit determines whether or not the list created in step S includes a plurality of virtual device servers step S . When the list includes a plurality of virtual device servers the process advances to step S. When the list includes only one virtual device server the virtual device server is the virtual device server that is arranged at a location closest to the printer . Thus in this case the process advances to step S and the service provider determination unit determines the virtual device server that is arranged at a location closest to the printer as the candidate of virtual device server through which a Web service is provided step S .

In step S the virtual device management unit transmits the list created in step S as the relative location measuring server list to the printer . Then the virtual device management unit acquires relative location information about virtual device servers included in the relative location measuring server list from the printer .

Next the service provider determination unit determines whether or not a plurality of virtual device servers that are arranged on the same network as the printer is included in the relative location measuring server list on the basis or a network configuration map included in relative location information step S .

When a plurality of virtual device servers that are arranged on the same network as the printer is included in the relative location measuring server list the process advances to step S. When only one virtual device server that is arranged on the same network as the printer is included in the relative location measuring server list the process advances to step S. Then the service provider determination unit determines the virtual device server that is arranged on the same network as the printer as the candidate of virtual device server through which a Web service is provided.

In step S the service provider determination unit acquires a communication delay time RTT included in the corresponding relative location information for each of a plurality of virtual device servers that is arranged on the same network as the printer step S . Then among the plurality of virtual device servers the service provider determination unit determines a virtual device server having the shortest communication delay time RTT as the candidate of virtual device server through which a Web service is provided step S .

It should be noted that the service provider determination unit may also acquire a network node to node distance for the plurality of virtual device servers and determine a virtual device server having the shortest network node to node distance as the candidate of virtual device server through which a Web service is provided. Also the service provider determination unit may acquire the time difference between two local times for the plurality of virtual device servers and determine a virtual device server having the shortest time difference between two local times as the candidate of virtual device server through which a Web service is provided.

In other words when a virtual device server cannot be selected on the basis of the results of comparison between physical location information and virtual device server location information Yes in step S the service provider determination unit executes the following processing. The service provider determination unit selects a virtual device server for providing a Web service corresponding to the processing request on the basis of relative location information.

Through the process described with reference to it is assumed that the virtual device server of which the physical location or the relative location is closest to the printer located in Japan has been determined as a candidate. Here when it has been determined by the process in step S shown in that the virtual device server located in Japan is not a virtual device server that is capable of running a virtual device service through which the Web service can be provided the Web service is not deployed into the virtual device server . In this case processing for determining the candidates of virtual device servers through which a Web service is provided is executed again No in step S shown in step S . With this arrangement for example the virtual device server located in U.S.A. is selected as a virtual device server through which a Web service is provided.

A further detailed description will be given of virtual device server selection processing performed by the Web service system of the present embodiment. For example assume the case where the processing request received from the printer to the virtual device management server is a print service Version 10.10 and the location of the printer indicated by client location information is Japan.

The virtual device management server refers to provider information provider location information shown in and executes the following processing. The virtual device management server determines that a virtual device server service arranged at a location closest to the printer is a virtual device server service corresponding to a Web service of which the Region is JP and the identifier is Print001. Since the Region of a virtual device server service corresponding to a Web service of which the identifier is Print003 is US the virtual device management server determines that the virtual device server is not arranged at a location near the printer .

When there is a plurality of Web services of which the Region is JP the virtual device management server executes for example the following processing The virtual device management server determines a virtual device server service arranged at a location closest to the printer using detailed physical location information such as the data center at which the virtual device service operates the address where a virtual PC a physical PC or the like is located the latitude or the longitude or the like.

The virtual device management server refers to resource information shown in and executes the following processing. The virtual device management server determines that a virtual device server having the identifier Print001 cannot receive a new Web service due to a high load on the basis of resource information about the virtual device server corresponding to a Web service of which the identifier is Print001. Thus the virtual device management server selects the virtual device server having the identifier Print003 as the virtual device server for providing a print service in spite of the fact that the Region is US and mismatches the Region of the printer .

Next the resource information acquisition unit determines whether or not a virtual PC is running step S . When a virtual PC is not running the process is ended. When a virtual PC is running the resource information acquisition unit acquires resource information about the virtual PC step S .

The resource information acquisition unit acquires for example the CPU usage rate of a physical PC the usage rate of a Network card the usage rate of a disk I O the transmission rate of a disk the transfer amount of a network card the transmission rate of a network and the available space of a disk as resource information. Resource information about a virtual PC can be acquired by utilizing information acquisition API that is specific to the virtual PC. For example when a virtual PC is a Microsoft Hyper V registered trademark resource information about the virtual PC can be acquired by utilizing the Hypervisor API. Next the resource information acquisition unit acquires resource information about the Web server and the virtual device service step S and the process is ended.

When the virtual device management server of the present embodiment receives a processing request from the image forming apparatus the virtual device management server selects a server for providing a Web service corresponding to the processing request and assigns the server to the image forming apparatus on the basis of provider information and client location information. For example the virtual device management server executes the following processing on the basis of virtual device server location information included in provider information and physical location information about the image forming apparatus included in client location information. The virtual device management server selects a virtual device server that is arranged at a location closest to the location of the image forming apparatus as the virtual device server through which the Web service is provided. Thus according to the virtual device management server of the present embodiment a Web service in accordance with the process requested by the image forming apparatus can be provided to an appropriate server in accordance with the location of the image forming apparatus .

Also the virtual device management server of the present embodiment determines whether or not the resources provided in a virtual device server to be selected satisfy a processing request from the image forming apparatus . When the resources do not satisfy the processing request the virtual device management server selects a virtual device server having the resources satisfying the processing request as the virtual device server for providing a Web service corresponding to the processing request. Thus according to the virtual device management server of the present embodiment a virtual device through which a Web service is provided can be switched in accordance with the fluctuations of the resources in a virtual device server.

The Web service system of the present embodiment may also be applied to a device consisting of integrated equipment including the case where a device is configured by a virtual OS or the like. Furthermore the Web service system of the present embodiment may also be applied to a system configured by a cloud computing via Internet.

According to the Web service system of the present embodiment a Web service in accordance with the process requested by an image forming apparatus can be provided to an appropriate server in accordance with the location of the image forming apparatus .

Aspects of the present invention can also be realized by a computer of a system or apparatus or devices such as a CPU or MPU that reads out and executes a program recorded on a memory device to perform the functions of the above described embodiments and by a method the steps of which are performed by a computer of a system or apparatus by for example reading out and executing a program recorded on a memory device to perform the functions of the above described embodiments. For this purpose the program is provided to the computer for example via a network or from a recording medium of various types serving as the memory device e.g. computer readable medium .

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2011 032814 filed Feb. 18 2011 which is hereby incorporated by reference herein in its entirety.

