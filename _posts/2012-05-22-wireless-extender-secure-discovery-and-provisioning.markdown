---

title: Wireless extender secure discovery and provisioning
abstract: According to embodiments of the invention, a first wireless access point discovers a second wireless access point, the first wireless access point tunes its radio and privacy settings, without user input, based upon parameters automatically exchanged in response to the discovery of the second wireless access point, and a secure direct wireless connection is established between the first and second wireless access points using the radio and privacy settings. Adding the first wireless to an existing mesh network includes a determination of the best available direct wireless connection.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08594109&OS=08594109&RS=08594109
owner: SonicWALL, Inc.
number: 08594109
owner_city: San Jose
owner_country: US
publication_date: 20120522
---
This application is a continuation application of application Ser. No. 12 724 363 filed on Mar. 15 2010 now U.S. Pat. No. 8 189 608 and claims the benefit of U.S. Provisional Patent Application No. 61 291 790 filed on Dec. 31 2009. Application Ser. No. 12 724 363 and Provisional Application No. 61 291 790 are hereby incorporated by reference into the continuation Application in their entirety.

Embodiments of the present invention relate generally to wireless networks. More particularly these embodiments relate to products systems and methods for automatic discovery and provisioning of a wireless connection between access points.

A local area network LAN typically employs one of two connection arrangements full mesh topology or partial mesh topology. In the full mesh topology each mesh node e.g. an access point or station is connected directly to each of the others. In the partial mesh topology one or more mesh nodes may be connected to all the others but some of the mesh nodes are connected only to some of the other mesh nodes e.g. those other mesh nodes with which they exchange the most data .

In a wireless LAN WLAN one or more of the connections between the mesh nodes is facilitated wirelessly. In order to extend the range of a WLAN system administrators or users often connect a new wireless access point wireless extender to the network by connecting the wireless extender to another wireless access point wireless root access point . There may be however multiple wireless root access points to which the wireless extender may wirelessly connect. Existing networks may provide no means by which to determine which wireless root access point in a network would provide the best connection for the wireless extender. Furthermore the need for a user to input radio settings e.g. channel service set identifier etc. and privacy settings e.g. authentication data cipher data key data etc. into the wireless extender increases the complexity and difficulty in extending the WLAN.

In the following description numerous specific details are set forth. However it is understood that embodiments of the invention may be practiced without these specific details. In other instances well known circuits structures and techniques have not been shown in detail in order not to obscure the understanding of this description.

References in the specification to one embodiment an embodiment an example embodiment etc. indicate that the embodiment described may include a particular feature structure or characteristic but every embodiment may not necessarily include the particular feature structure or characteristic. Moreover such phrases are not necessarily referring to the same embodiment. Furthermore when a particular feature structure or characteristic is described in connection with an embodiment it is submitted that it is within the knowledge of one skilled in the art to effect such feature structure or characteristic in connection with other embodiments whether or not explicitly described.

In the following description and claims the terms coupled and connected along with their derivatives may be used. It should be understood that these terms are not intended as synonyms for each other. Coupled is used to indicate that two or more elements which may or may not be in direct physical or electrical contact with each other co operate or interact with each other. Connected is used to indicate the establishment of communication between two or more elements that are coupled with each other. Directly connected is used to indicate the establishment of communication between two or more elements that are coupled with each other without an intervening node e.g. two wireless access points in wireless communication without an intervening wireless access point .

According to an embodiment of the invention a first wireless access point wireless extender discovers a second wireless access point wireless root access point automatically in response to the discovery of the second wireless access point the first and second wireless access points exchange parameters the first wireless access point tunes its radio and privacy settings without user input based upon the exchanged parameters and a secure direct wireless connection is established between the first and second wireless access points using the radio and privacy settings. For one embodiment wireless discovery and provisioning includes a determination of the best available wireless connection e.g. signal strength hop count number of wireless stations already in the BSS of wireless root access point etc. to one of a number of wireless access points available for direct wireless connection. For one embodiment the first wireless access point manages a basic service set and relays traffic from the basic service set to the second wireless access point.

As used herein a basic service set BSS refers to a wireless access point and all stations associated with that access point. Station or wireless station is used herein to refer to a device that has the capability to connect for wireless and or wired connection to the network via a wireless access point. For example a station may be a laptop a desktop computer personal digital assistant PDA a phone etc. As used herein a mesh node refers to either a wireless access point or a station connected to a full or partial mesh network. Wireless root access point is used herein to refer to a wireless access point to which a wireless extender may establish a direct wireless connection i.e. a wireless extender joins the BSS of the wireless root access point and thus the wireless extender and wireless root access point are respectively a child mesh node and a parent mesh node . While the topmost node in a tree data structure is commonly referred to as the root node i.e. it will not have a parent node the use of the term root in wireless root access point herein is not so limited. There may be multiple wireless root access points in a network a wireless root access point does not need to be the topmost node of the WLAN e.g. a border mesh node as described below and a wireless root access point may have a parent mesh node.

For one embodiment only one active border mesh node is present in this mesh network to connect all mesh nodes to an external environment e.g. another LAN or WAN . This model simplifies the relationship among all mesh nodes in at least two aspects. First routing will be very straightforward only the route between child mesh node and parent mesh node will be allowed and all outgoing traffic will be eventually forwarded to the active border mesh node for the data exchange with external networks. Second only one active border mesh node is delegated to handle traffic exchange with the outer environment. As a result gateway functionality such as network address translation NAT and bandwidth management can be easily deployed in the active border mesh node to control traffic. Additionally for one embodiment one or more other mesh nodes are appointed as standby border mesh nodes to switch over in case the active border mesh node loses power or does not function properly. In alternate embodiments more than one active border mesh node is present.

Each leaf mesh node has at least one direct connection to communicate with its parent mesh node. illustrates a single pair of wireless access points in direct connection and implementing an embodiment of secure discovery and provisioning Secure D P . Secure D P however may be implemented in one or more pairs of child and parent mesh nodes.

In a mesh network in addition to having the capability of direct wired connections a wireless access point may perform dual roles. First the access point may manage a BSS as a regular wireless access point. If the wireless access point has the capability of establishing a direct wireless connection with a wireless extender such that the wireless access point s BSS includes the wireless extender i.e. another wireless access point the wireless access point managing the BSS acts as a wireless root access point. Second the access point may act as a wireless extender and relay traffic e.g. from its BSS or from another wireless access point to a parent mesh node e.g another wireless root access point . As a result of these dual roles multiple wireless access points are able to be wirelessly chained to extend the reach of a WLAN. Discovering and provisioning a secure direct connection between wireless access points in such a wireless chain will be addressed herein.

For example wireless access point AP and wireless access point AP both manage respective BSS s. In the illustrated example wireless station STA and wireless access point AP are a part of wireless access point AP s BSS and wireless station STA is a part of wireless access point AP s BSS. Each wireless access point may have more or less wireless stations connected to its BSS and as described below wireless stations are able to roam between BSS s.

Embodiments of the wireless extender secure discovery and provisioning disclosed herein are implemented in the mesh nodes as illustrated in . The wireless extender secure discovery and provisioning is responsible for discovery of a wireless root access point and self tuning the wireless extender to establish a secure wireless connection with the wireless root access point. Additionally a management channel can also be built on this wireless link to support administration monitoring and other management operations. For one embodiment the discovery and provisioning is implemented in the IEEE 802.11 Media Access Control MAC layer and utilizes the IEEE 802.11 Management Frame to convey discovery and simple provisioning handshake information between the wireless extender and its wireless root access point as described later herein . As used herein IEEE 802.11 refers to all applicable protocols within the IEEE 802.11 family e.g. IEEE 802.11a 802.11b 802.11g 802.11i 802.11n etc.

For one embodiment a network implements only one level of repeating. In other words in a network that contains multiple wireless root access points R i 1 . . . M and multiple wireless extenders X j 1 . . . N any wireless extender Xjoins the BSS of a wireless root access point Rinstead of any other wireless extenders. Utilizing a single level repeating relationship the R X model when more levels of repeating deployment is required a user can easily replicate the functionality of this R X model to form an R X chain.

In an exemplary network deployment radio and privacy settings include for example a service set identifier SSID authentication data cipher data key data etc. Provisioning as used herein includes exchanging parameters over a direct secure channel and setting X s radio and privacy settings in order to establish a secure direct wireless connection between Rand Xbased on these settings. In order to secure the channel between Xand Rand prevent versatile attacks such as eavesdropping man in the middle impersonating replay database reading and many other known security holes an embodiment of secure discovery and provisioning utilizes public private key pairs to perform mutual authentication and to encrypt the communication channel using strong dynamic session key. Both parties have a public private key pair . Public key E will be used for encryption and private key D will be used for decryption respectively. For one embodiment for a given public private key pair it is relatively difficult to decrypt data encrypted with E without having D. Once the Xtunes itself to R s transmitted radio and privacy settings a secure direct wireless connection is established and a wireless station can benefit from smooth roaming among BSS s of Xand Rwithout changing the wireless station s radio and privacy settings.

The processor is illustrated as including multiple subcomponents including the crypto engine routing engine discovery and provisioning engine and administration management and provisioning AM P interface each of which will be described further below. Additionally the processor is further illustrated to include a protocol stack which interacts with the AM P interface . Each component has been illustrated as a separate functional block for ease of explanation of functionality of embodiments of the invention and not intended to be limiting i.e. components could be combined or further separated implemented in hardware and or software etc e.g. as indicated above one or more components may be implemented as instructions stored in memory and executed by the processor s . Alternatively one or more of the components could be implemented separate from the processor s . Also additional components would normally be present but are not illustrated so as not to obscure one of ordinary skill in the art from understanding.

The crypto engine provides random number generation hashing encryption decryption and other cryptography related functions. The routing engine determines the best available wireless root access point when wireless access point is acting as a wireless extender. The discovery and provisioning engine manages the discovery of potential wireless root access points and provisioning of the wireless extender to establish a secure direct wireless connection with a wireless root access point. The AM P interface provides the interface to configure and monitor the protocol stack e.g. application programming interface API utilizing input output control IOCTL commands to set parameters in an IEEE 802.11 management stack . The functionalities of crypto engine routing engine and discovery and provisioning engine as they relate to secure discovery and provisioning will be further described below.

Wireless root access point R broadcasts beacon frames including an advertisement. Exemplary advertisement parameters include a protocol software and or hardware version Vr for the wireless root access point a hop count Hr nonce Nr client number i.e number of wireless stations already in the BSS Cr mean received signal strength indication RSSI value Mr and the wireless root access point s public key Er.

At block a wireless extender X seeking to join a network will receive the broadcasted beacon. At block upon receipt of the beacon frame from R if the discovery and provisioning engine in X can successfully locate the advertisement X will process the advertisement parameters. For example X automatically performs without user input one or more of the following verifying authenticity of public key Er and checking if version Vr in the advertisement is compatible with its own. For one embodiment the crypto engine utilizes a certificate authority installed within the wireless extender e.g. when manufactured prior to sale etc. or another authentication algorithm installed within the wireless extender to authenticate the public key Er. If the advertisement parameters are successfully processed e.g. authenticated compatible X will assume R is a wireless root access point candidate and keep it in candidate list e.g. stored in the memory .

Upon determination that R is a candidate the discovery and provisioning engine in X will transmit a probe request including discovery parameters from the wireless extender at block . Exemplary discovery parameters include protocol software and or hardware version Vx for the wireless extender a configuration checksum Sx nonce Nx the wireless extender s public key Ex as well as a secret key K generated for session key computation. For one embodiment the discovery parameters will be encrypted with public key Er. The generation of Nx and encryption of the discovery parameters are performed by crypto engine .

Once R receives the probe request from X R locates and decrypts the discovery parameters using its private key Dr e.g. using its own crypto engine . Wireless root access point R automatically without user input performs its own verification e.g. verifying the authenticity of public key Ex determining that version Vx in the discovery parameters is compatible with R s version Vr and or determining if checksum Cx is the same as a cached value e.g. a checksum from a previously connected wireless extender . Similar to X R may have a certificate authority or other known authentication algorithm installed within R e.g. when manufactured prior to sale etc. to verify the authenticity of Ex. For one embodiment if checksum Cx is the same as the cached value R will determine that X has been previously tuned to connect with R and is attempting to reassociate with R. In the case of reassociation R sends the original previously sent probe response management frame back to X. Otherwise if checksum Cx is not the same as the cached value R will compute a session key based on the discovery parameters from X as described with reference to block below .

Both wireless extender X and wireless root access point R compute a session key S based on the same function at block e.g. both wireless access points are programmed prior to the discovery process e.g. when manufactured prior to sale etc. to utilize the same function or formula to compute the session key. For one embodiment each wireless access point s crypto engine computes the session key using the function S PRF Nr Br Nx Bx K . For one embodiment pseudorandom function PRF is any industrial encryption method such as Data Encryption Standard DES Triple DES Advanced Encryption Standard AES etc. Br and Bx are SSID s for R and X respectively which can be collected from the beacon and probe request. K is the secret key generated by X. For one embodiment K includes a random number and the wireless root access point protocol software and or hardware version version Vr.

After computing the session key S R transmits a probe response. The payload of the probe response is an offer O which includes offer parameters for the configuration of radio and privacy settings for X. Alternatively parameters for the configuration of radio and privacy settings may be included in separate transmissions. For example radio settings e.g. the SSID for R may be included in the beacon while the privacy settings e.g. authentication data cipher data key data etc. may be included in the probe response.

For one embodiment the offer O is encrypted with wireless extender X public key Ex and then encrypted with the session key S. For one embodiment the offer is encrypted only with the session key S. For one embodiment a Message Integrity Check MIC is appended to the offer to prevent inadvertent modification to the data. For one embodiment MIC HMAC MD5 O S . Alternatively MIC implements another hash function or cryptographic hash function for message authentication. At block X receives the probe response.

If there are multiple candidate wireless root access points the routing engine in X determines that R is the best of multiple candidates with which to establish a wireless connection at block . For one embodiment X will traverse its candidate list to select the best candidate to join after X receives the probe response from R and other wireless root access points. Alternatively the determination of which candidate to join is made at an earlier stage e.g. after receiving the beacon. The determination of the best candidate is based on one or more of the following peer signal strength Rr Mr hop count Hr or client number Cr. For example each retransmission hop can equate to a reduction in the maximum wireless effective throughput as well as a time delay. Additionally the number of clients already associated with R provides an indication of the amount of bandwidth currently consumed in R s BSS.

For another embodiment the determination of the best candidate is based upon signal strength alone e.g. strongest RSSI value . Alternatively the following equation provides an exemplary method by which X chooses the best root access point 

Ci Client number i.e. number of wireless stations already in the BSS of wireless root access point i 

Wireless extender X will use the equation above to determine that the wireless root access point R has the largest weight Si or similar determination and therefore is the best candidate.

Upon selecting R the crypto engine in X decrypts R s offer parameters using the session key S computed by X at block . Additionally if utilizing multiple layers of encryption e.g. the offer is encrypted with both S and Ex X also decrypts the offer parameters using private key Dx.

Wireless extender X computes MIC using the same formula as R to check the integrity of the data sent from wireless root access point R. If the received MIC is verified X will tune itself using the privacy settings embedded in the offer parameters at block . The privacy settings enable X to be a valid wireless client to continue authentication and association reassociation with R. Additionally the privacy settings enable wireless stations to roam between the BSS of R and the BSS of X as well as other wireless access points within the network that share the same privacy settings .

For one embodiment the rest of the management frames e.g. according to IEEE 802.11 including Authentication and Association Reassociation are kept intact. Once the association request and response are completed the secure direct wireless connection is established between R and X and X can begin to relay traffic to R at block . If the privacy settings include Wi Fi Protected Access WPA WPA2 encryption the WPA WPA2 handshake will continue to play until the wireless link is established.

For one embodiment R will continue to listen to the probe request from X and once it determines that the configuration checksum Cx does not match the cached value within R R will send out a probe response with an offer to provision extender X again. This ensures the extender X can continue to synchronize with the radio and privacy settings from R to maintain a valid and secure direct wireless connection with R.

For an embodiment utilizing IEEE 802.11 element ID s 7 15 and 32 255 are reserved for vendors to implement proprietary features. For one embodiment element ID 7 is utilized for the beacon element ID 8 is utilized for probe request and element ID 9 is utilized for the probe response. Alternatively various other arrangements of the beacon probe request and probe response within the proprietary element ID s are utilized. For one embodiment an Organizationally Unique Identifier OUI or other unique identifier is included in the information elements to distinguish each of the wireless access points from others. illustrate exemplary formats for each of these three elements.

In the foregoing specification the invention has been described with reference to specific exemplary embodiments thereof. It will be evident that various modifications may be made thereto without departing from the broader spirit and scope of the invention as set forth in the following claims. For example different byte lengths and ordering of the frame formats described above can be implemented. Additionally while the description above is focused on secure discovery and provisioning among access points embodiments of the secure discovery and provisioning described herein applies to discovery and provisioning of a secure connection between other wireless devices as well.

An article of manufacture may be used to store program code providing at least some of the functionality of the embodiments described above. An article of manufacture that stores program code i.e. a computer readable storage medium or machine readable storage medium may be embodied as but is not limited to one or more memories e.g. one or more flash memories random access memories static dynamic or other optical disks CD ROMs DVD ROMs EPROMs EEPROMs magnetic or optical cards or other type of machine readable storage media suitable for storing electronic instructions. A machine readable storage medium as used herein refers to a tangible device and not to a carrier wave. Additionally embodiments of the invention may be implemented in but not limited to hardware or firmware utilizing an FPGA ASIC a processor a computer or a computer system including a network. Modules and components of hardware or software implementations can be divided or combined without significantly altering embodiments of the invention. The specification and drawings are accordingly to be regarded in an illustrative sense rather than a restrictive sense.

