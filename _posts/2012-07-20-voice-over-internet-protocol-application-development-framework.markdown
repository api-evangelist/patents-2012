---

title: Voice over internet protocol application development framework
abstract: Applying services to calls involving subscribers to a telephony services provider includes receiving an indication of a call placed to or from a first call participant. The indication is received by a telephony services provider over a first signaling path of the call that is established between the telephony services provider and a first telephony proxy server that is controlled by a telephony infrastructure provider. Control signals configured to affect a voice path of the call that is established between the first telephony proxy server and a second telephony proxy server also controlled by the telephony infrastructure provider but associated with a second call participant are identified. The identified control signals are sent to the first telephony proxy server over the first signaling path and to the second telephony proxy server over a second signaling path that is established between the telephony services provider and the second telephony proxy server.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=RE046168&OS=RE046168&RS=RE046168
owner: FACEBOOK, INC.
number: RE046168
owner_city: Menlo Park
owner_country: US
publication_date: 20120720
---
This application claims the benefit of U.S. Provisional Application No. 60 577 216 filed Jun. 7 2004 and titled Voice over Internet Protocol Application Development Framework the entire contents of which are incorporated by reference in its entirety.

This document relates to systems that provide telephone services using Voice over Internet Protocol VoIP .

In a typical VoIP communications system a network services provider i.e. the owner and manager of a network telephony infrastructure and a telephone services provider i.e. a customer facing provider of telephony services work together to offer VoIP services to customers over a data network. The network services provider controls the physical media through which the VoIP data travels e.g. the fiber optic network and the optical networking equipment and the proxy servers and voice gateway routers that direct and control the flow of VoIP data. The underlying system is generally capable of creating a basic communications session with assistance of the telephone services provider in the form of subscriber identifying information e.g. a telephone number . The telephone services provider typically develops the voice applications that enable the proxy servers and voice gateway routers to handle VoIP calls in accordance with the VoIP telephone services offered by the telephone services provider. The telephone services provider also controls back end computer systems that may be accessed by the proxy servers or voice gateway routers in response to procedure calls generated while executing a voice application. The back end computer systems typically store customer specific voice services related configuration data.

The proxy servers and the voice gateway routers manage the voice paths of VoIP calls and the signaling used to setup and tear down the VoIP calls in accordance with the voice applications developed by the telephone services provider. The voice applications are typically scripts containing Application Programming Interface API commands that when executed by a voice gateway router manage a VoIP call in accordance with a VoIP service offered to a customer. More particularly call signals arrive at the voice gateway router and the voice gateway router processes the signals in a predefined manner that is indicated by the API based voice applications. At well defined points in the processing of the messaging the voice gateway router may use API commands to retrieve particular pieces information required by the voice applications. The API commands facilitate development of voice applications and hence VoIP services by providing building blocks that may be put together to construct voice applications that offer typical voice services.

In one general aspect applying services to calls placed to or from subscribers to a telephony services provider includes receiving an indication of a call placed to or from a first call participant. The indication is received by a telephony services provider over a first signaling path of the call that is established between the telephony services provider and a first telephony proxy server that is controlled by a telephony infrastructure provider. One or more control signals configured to affect a voice path of the call that is established between the first telephony proxy server and a second telephony proxy server also controlled by the telephony infrastructure provider but associated with a second call participant are identified. The identified control signals are sent to the first telephony proxy server over the first signaling path and to the second telephony proxy server over a second signaling path that is established between the telephony services provider and the second telephony proxy server.

Implementations may include one or more of the following features. For example identifying the control signals may include accessing an indication of whether the first call participant may participate in the call based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. A determination may be made as to whether the first call participant is available to participate in the call based upon the accessed indication and the control signals may be identified based upon the determination of whether the first call participant may participate in the call.

Identifying the control signals may include accessing information to be presented to the first call participant during the call based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. Control signals configured to present the accessed information to the first call participant may be identified.

Identifying the control signals may include accessing an indication of availability of the first call participant to place and receive calls based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. The control signals may be identified based upon the accessed indication of availability.

Identifying the control signals may include accessing an indication of an activity undertaken by the first call participant at a time at which the indication of the call is received by the telephony services provider based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. The control signals may be identified based upon the accessed indication of the activity.

Identifying the control signals may include determining whether the activity is an activity during which the first call participant may or may not participate in the call. The control signals may be identified based upon the determination of whether the first call participant may or may not participate in the call. Accessing an indication of an activity may include accessing an indication of at least one activity from among a list of activities including participation in an event from an electronic calendar of the first call participant participation in another call communication with another entity sending and receiving instant messages and sending and receiving e mail messages.

Identifying the control signals may include accessing at least one indication of a time at which a call to the first call participant is to be blocked or allowed based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. A present time may be compared to the time at which a call to the first call participant is to be blocked or allowed and the control signals may be identified based upon the comparison.

Identifying the control signals may include accessing an indication of an amount of time for which the first call participant has participated in phone calls and a maximum allowable amount of time for which the first call participant may participate in telephone calls based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. The amount of time for which the first call participant has participated in phone calls may be compared to the maximum allowable amount of time and the control signals may be identified based upon the comparison.

Identifying the control signals may include accessing an indication of a parental control that has been specified for the first call participant based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. The control signals may be identified based upon the accessed indication of the parental control.

Identifying the control signals may include accessing at least one indication of a person to or from whom calls are allowed or blocked based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. The second call participant may be compared to the person to or from whom calls are allowed or blocked and the control signals may be identified based upon the determination of whether the first call participant may participate in the call.

Identifying the control signals may include enabling the first call participant or a guardian or supervisor of the first call participant to specify information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed that is accessed for use in identifying the control signals. The control signals may be identified based upon the specified information. Enabling the first call participant or a guardian or supervisor of the first call participant to specify the information may include presenting to the first call participant or to guardian or supervisor of the first call participant a graphical user interface with which the first call participant or the guardian or supervisor of the first call participant may specify the information. Identifying the control signals may include accessing at least one call handling preference that has been specified by the first call participant prior to a time at which the indication of the call is received by the telephony services provider based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. The control signals may be identified based upon the accessed call handling preference.

Identifying the control signals may include may include accessing at least one call handling preference that has been specified by a supervisor or a guardian of the first call participant prior to a time at which the indication of the call is received by the telephony services provider based upon information stored on a back end system controlled by the telephony services provider related to the first call participant to or from whom the call is placed. The control signals may be identified based upon the accessed call handling preference.

Identifying the control signals may include updating information stored on a back end system controlled by the telephony services provider that is accessed when identifying the control signals based upon the identified control signals. The updated information may indicate a status of the first call participant as a result of processing of the identified control signals. Control signals for future calls may be identified based upon the updated information. Updating the information based upon the identified control signals may include updating the information to include at least one indication from a list of indications including an indication of availability of the first call participant to place and receive a call an indication of an activity undertaken by the first call participant an indication of a time at which the first call participant may or may not place or receive a call an indication of a person with which the first call participant may or may not participate in a call an indication of an amount of time for which the first call participant has participated in calls an indication of a call handling preference or an indication of a parental control.

Identifying the control signals may include identifying control signals to cause identification of the first or second call participant who placed the call to be presented to a call recipient before the voice path is established therebetween. Identifying the control signals may include identifying control signals to cause an incoming call notification to be delivered to an intended recipient when the intended recipient is occupied with an ongoing but different call and to enable the intended recipient to interrupt the ongoing but different call to handle the incoming call. Identifying control signals to cause an incoming call notification to be delivered to an intended recipient may include identifying control signals to cause the incoming call notification that identifies the first or second call participant who placed the call to the intended recipient to be delivered to the intended recipient.

Identifying the control signals may include identifying control signals to cause the call to be delivered to an intended recipient identifying control signals to cause the call to ring busy for the first or second call participant who placed the call or identifying control signals to cause the call to be forwarded to a system different than a system to which the call was to be routed originally such as a voicemail system. Identifying the control signals may include identifying control signals to cause the call to be blocked such that an intended recipient of the call does not receive the call identifying control signals to cause an alert of the call to be presented to the first call participant or identifying control signals to cause a pre recorded message to be played to the first or second call participant who placed the call or an intended call recipient.

The voice path may be established between the first telephony proxy server and a second telephony proxy server based on the control signals.

These general and specific aspects may be implemented using a system a method or a computer program or any combination of systems methods and computer programs.

An enhanced VoIP communications system enables a telephone services provider to directly generate and process the signaling information e.g. SIP commands information used to setup and tear down VoIP calls. The enhanced VoIP communications system provides greater flexibility by allowing the telephone services provider to rapidly develop voice applications that include features not available through use of existing APIs and to redefine the format of the voice application procedure calls to back end systems. Moreover the enhanced VoIP communications system enables development of voice applications that include references to back end systems prior to a determination of the type of voice service associated with the call. The call management and signal processing may then be entirely determined by the customer specific and other contextual data stored in the back end systems.

The enhanced VoIP communications system is advantageous over a typical VoIP communications system in which APIs are used to develop voice services to be applied to telephone calls. Since the enhanced VoIP communications system does not use APIs to develop the voice services a telephone services provider is not limited to providing services that may be developed using the predefined set of APIs and corresponding procedure calls. Therefore development of voice applications is not limited by API development which would be required for applications that include features that are not covered by the existing set of APIs. Developing new APIs may slow down the application development process significantly. The kinds of call treatments that can be applied to a particular session in the enhanced VoIP communications system is not limited by the APIs. More particularly alternative call treatments are not limited to those stored away from the telephone service provider. The telephone service provider may apply concurrent asynchronous activity taking place in the telephone service provider s environment to affect the session in progress without explicitly anticipating the asynchronous activity in the application.

Referring to an enhanced communications system provides VoIP telephone services through use of voice applications that directly process signaling information used to establish VoIP calls. The communications system controls calls placed between a caller telephone a and a call recipient telephone b. The call is serviced by a telephony infrastructure provider that receives instructions for handling the call from a telephony services provider . The telephony infrastructure provider includes a data network and voice gateway routers a and b. The voice gateway routers a and b include respective user databases a and b and respective mappings a and b. The voice gateway routers a and b establish a voice path between themselves and respective signaling paths a and b between each of them and the telephony services provider . The telephony services provider includes a telephony services signal processing system and a telephony services back end system . The telephones a and b communicate with the telephony infrastructure provider through respective optional delivery systems a and b respectively.

The caller telephone a is configured to place a call to or to receive a call from the call recipient telephone b using the telephony infrastructure provider . Each of the telephones a and b may be a landline or wireline phone a wireless phone a cellular phone a mobile personal digital assistant PDA with embedded cellular phone technology or a soft phone which is a telephone integrated into a computer system. Alternatively or additionally each of the telephones a and b may be integrated into a client computer system.

The telephony infrastructure provider provides infrastructure that may be used to operate calls between the telephones a and b. The telephony infrastructure provider does not determine how the calls between the telephones a and b should be controlled. Instead the telephony infrastructure provider relies on the telephony services provider to indicate how the calls should be controlled. In one implementation communications between the components of the telephony infrastructure provider are packet based communications that use Internet Protocol IP .

The telephony services provider determines how the calls between the telephones should be controlled. The telephony services provider instructs the telephony infrastructure provider to control a call between the telephones a and b in an identified manner. The telephony services provider determines how to control the call based on information that may be accessed only by the telephony services provider and not by the telephony infrastructure provider . The telephony services provider may provide Session Initiation Protocol SIP signals H.323 signals Media Gateway Control Protocol MGCP signals Media Gateway Control Megaco signals Simple Gateway Control Protocol SGCP signals or other types of call handling signals to the telephony infrastructure provider to identify how the call should be handled. In one implementation the telephony services provider also is an Internet service provider ISP and the information that may be accessed only by the telephony services provider may relate to Internet use of customers of the ISP as well as to other services provided by the ISP. In such implementations users of the telephones a and b may be customers of the ISP. As a result the ISP may provide information relating to Internet use of the users to the telephones a and b. Furthermore information describing phone usage and call handling preferences of the users may be presented to the users when the users access the ISP for example with a computer.

The data network is configured to enable direct or indirect communications between the voice gateway routers a and b. The data network may include for example one or more of the Internet Wide Area Networks WANs Local Area Networks LANs analog or digital wired and wireless telephone networks e.g. Public Switched Telephone Network PSTN Integrated Services Digital Network ISDN and Digital Subscriber Line xDSL radio television cable satellite and or any other delivery or tunneling mechanism for carrying data.

The voice gateway routers a and b route calls between the telephones a and b. The voice gateway router a is associated with the telephone a and with a user of the telephone a and the voice gateway router b is associated with the telephone b and with a user of the telephone b. When the voice gateway router a receives a call placed from the telephone a to the telephone b serviced by the voice gateway router b the voice gateway router a determines if the call was placed by a user whose calls are controlled by the telephony services provider . If so then the call is routed to the telephony services provider such that the telephony services provider may control the call. If not then the call is routed to the voice gateway router b which services the telephone b such that the call may be handled normally. The voice gateway router b operates in a corresponding manner when a call is placed from the telephone b to the telephone a. When a call is handled by the telephony services provider the voice gateway routers a and b receive call handling signals from the telephony services provider . The voice gateway routers a and b execute the received call handling signals to handle the call in a manner identified by the telephony services provider . The voice gateway routers a and b also may be referred to as edge proxy servers or PSTN gateways.

The user databases a and b enable the voice gateway routers a and b respectively to determine whether received calls should be handled by the telephony services provider . More particularly the user databases a and b include indications of users of telephones serviced by the voice gateway routers a and b respectively whose calls are controlled by the telephony services provider . When a call is received at one of the voice gateway routers a and b the voice gateway router may determine that the call should be routed to the telephony services provider when one or more people involved in the call are included in the corresponding user database. The people involved in the call may be identified based on information included in the call such as the source and destination phone numbers for the call.

The mappings a and b enable the voice gateway routers a and b to route calls to telephones serviced by the voice gateway routers a and b respectively. More particularly the mappings a and b relate phone numbers to IP addresses of telephones that correspond to the phone numbers. Each of the mappings a and b includes entries for each telephone serviced by the corresponding voice gateway routers a and b. For example the voice gateway router a may use the mapping a to identify an IP address of the telephone a when the voice gateway router a receives a call to the telephone a from for example the telephone b. In one implementation the voice gateway router b may route the call from the telephone b to the voice gateway router a based on characteristics of the phone number or the location to which the call is placed. For example the telephone a may be serviced by the voice gateway router a as a result of being in a particular location or having a particular phone number. In another implementation the voice gateway router b may route the call to the voice gateway router a because the voice gateway router a may have informed the voice gateway router b that the voice gateway router a services the telephone a. The voice gateway router b may use the mapping b to route calls to the telephone b in a corresponding manner.

Voice data for a call between the telephones a and b is sent between the voice gateway routers a and b through the network over the voice path . In addition signals for controlling the call may be sent over signaling paths a and b. The signaling paths a and b are established when the call is to be handled by the telephony services provider . Otherwise a signaling path is established between the voice gateway routers a and b.

The telephony services signal processing system identifies call handling signals that are used by the voice gateway routers a and b to control a call between the telephones a and b. The telephony services signal processing system preferably includes one or more applications that may cause the call to be controlled in a particular manner by producing call handling signals for the call. One or more of the applications may be selected for execution based on call handling preferences of a user involved in the call.

The call handling preferences as well as other information needed by the selected applications may be accessed from the telephony services back end system . In implementations where the telephony services provider also is an ISP the telephony services back end system may include information relating to how the user involved in the call uses the ISP. For example the information may include indications of people with which the user may or may not communicate events from an electronic calendar of the user availability of the user an activity undertaken by the user times at which calls to the user are blocked or allowed a maximum allowable amount of time for which the user may participate in telephone calls and parental controls.

In some implementations the telephones a and b are VoIP telephones that may communicate directly with the telephony infrastructure provider for example using the voice gateway routers a and b. In such implementations the delivery systems a and b are not required. In other implementations the telephones a and b are circuit switched telephones in which case the delivery systems a and b are needed to enable the telephones a and b to communicate with the telephony infrastructure provider . The delivery systems a and b convert circuit switched data from the telephones a and b into packets of data that may be used by the telephony infrastructure provider . Each of the delivery systems a or b may be a public switched telephone network PSTN or a private branch exchange PBX that that may communicate with the telephony services provider . Alternatively or additionally each of the delivery systems a and b may be an adapter configured to convert data from a circuit switched telephone into data that may be used by the telephony infrastructure provider .

The process begins when the voice gateway router a receives a call from a locally serviced telephone . For example the voice gateway router a may receive the call from the caller telephone a of . In implementations where the locally serviced telephone is not a VoIP telephone the call may be received through a delivery system such as the delivery system a of . The voice gateway router a determines whether the call should be routed through the telephony services signal processing system . Such a determination may be based on a user database maintained by the voice gateway router a such as the user database a of . The user database identifies people whose calls are specially handled by the telephony services signal processing system . The voice gateway router a may identify people involved in the call based on for example phone numbers or IP addresses associated with the call. If the identified people are found in the user database then the call may be routed through the telephony services signal processing system .

When the call is to be routed through the telephony services signal processing system such that the telephony services signal processing system may control the call the voice gateway router a builds a signaling path to the telephony services signal processing system . In response the telephony services signal processing system builds signaling paths to the voice gateway routers a and b and the voice gateway router builds a signaling path to the telephony services signal processing system . As a result the telephony services signal processing system may send signals for controlling the call to the voice gateway routers over the signaling paths that have been established.

The voice gateway router a sends an indication of the call to the telephony services signal processing system over the signaling path to the telephony services signal processing system . The indication of the call may include a telephone number or an IP address from which the call was placed a telephone number or an IP address to which the call was placed identifiers of people involved in the call and a time at which the call was placed. The telephony services signal processing system receives the indication of the call from the voice gateway router a over the signaling path .

The telephony services signal processing system uses the received indication of the call to identify signals for controlling the call . The telephony services signal processing system may identify the signals by executing one or more call handling applications included in the telephony services signal processing system . The applications may use information that may be accessed from a telephony services back end system such as the telephony services back end system of . The call handling applications that are executed by the telephony services signal processing system may be selected based on call handling preferences for a participant of the call. The chosen applications identify the signals such that the call is controlled in a manner that is consistent with the call handling preferences.

The telephony services signal processing system sends the identified signals to the voice gateway routers a and b over the signaling paths a and b that have been established to the voice gateway routers a and b . The voice gateway routers a and b receive the signals from the telephony services signal processing system . In one implementation the telephony services signal processing system sends only the signals to be used by the voice gateway router a to the voice gateway router a and only the signals to be used by the voice gateway router b to the voice gateway router b.

The voice gateway routers a and b use the received signals to establish and or control a voice path between the voice gateway routers a and b . For example if the received signals indicate that the call should be allowed without restriction then the voice path is established such that the people involved in the call may communicate over the voice path. In addition other audio data such as alerts and ring tones may be presented to the people involved in the call over the voice path as may be indicated by the received signals.

As the call is operating the telephony services signal processing system may continue to identify additional signals for controlling the call and the identified signals may be sent to the voice gateway routers a and b. The additional signals may be identified at any time in response to any stimuli deemed important to the call or the participants of the call. Among these stimuli are dynamic evolving context of the call the participants or external factors that affect or are affected by the session. The additional signals may be identified using any application included in the telephony services signal processing system that applies to the call or to the participants. After the call has been completed the voice gateway routers a and b may tear down the voice path and the signaling paths.

In the implementation of the process illustrated in the voice gateway router a sends to the telephony services signal processing system an indication of the call because calls to or from a user that placed the calls are controlled by the telephony services signal processing system . In such an implementation the voice gateway router b may not receive an indication of the call until the telephony services signal processing system establishes a signaling path to the voice gateway router. In other implementations of the process the voice gateway router b may send the telephony services signal processing system an indication of the call even though the call was placed from a telephone serviced by the voice gateway router a because calls to or from a user to which the call was placed are controlled by the telephony services signal processing system . In such implementations the voice gateway router a may establish a signaling path and may forward an indication of the call to the voice gateway router b. Upon a determination that the call is to be controlled the voice gateway router b may tear down the signaling path to the voice gateway router a and may forward an indication of the call to the telephony services signal processing system .

Referring to a process is used to identify signals for controlling a received call. The process may be executed by a telephony services signal processing system of a telephony services provider such as the telephony services signal processing system of . The telephony services signal processing system is an entity distinct from a telephony infrastructure provider that operates the call in accordance with the identified signals. The telephony services signal processing system identifies the signals using information that may not be accessed by the telephony infrastructure provider.

The process begins when the telephony services provider receives an indication of a call placed to or from a user whose calls are controlled by the telephony services provider . The indication of the call is received from a voice gateway router that services an origin or a destination of the call. More particularly the indication of the call is received from a voice gateway router that services a telephone that is used by a user whose calls are controlled by the telephony services signal processing system . The indication of the call may be received over a signaling path that has been established between the voice gateway router and the telephony services signal processing system .

The telephony services signal processing system accesses information describing call handling preferences of the user . The information may be accessed from a telephony services back end system such as the telephony services back end system of . The call handling preferences for the user may indicate times at which the user desires and does not desire to receive calls. The times at which the user may and may not receive the calls may be indicated by electronic calendar events maintained in an electronic calendar of the user. The call handing preferences also may indicate people with whom the user may or may not desire to communicate. The people may be indicated by contact lists maintained by the user such as an e mail address book or an instant messaging buddy list of the user. The call handling preferences may indicate that alerts and reminders of for example tasks and calendar events are to be presented to the user while the user is participating in a telephone call.

The telephony services signal processing system identifies signals indicating how the call is to be handled based on the accessed information . The signals may be identified through execution of one or more applications included in the telephony services signal processing system. Each of these applications identifies signals for handling the call in a particular manner. The applications that are executed to identify the signals may be selected in a manner indicated by the call handling preferences accessed for the user. For example if the call handling preferences indicate that the user is to be provided with reminders of events from an electronic calendar maintained by the user while the user is participating in a call an application for providing the user with the reminders may be executed. The applications may access information from the telephony services back end system while executing. For example the application for providing the user with the reminders may access the electronic calendar event for which a reminder is to be provided from the telephony services back end system.

The identified signals are sent to voice gateway routers that service telephones involved in the call . The voice gateway routers execute the signals to control the call in the manner identified by the telephony services signal processing system. Using the example from above executing the received signals may result in the user being provided with the reminder of the calendar event.

Referring to a process is used to retrieve signals for controlling a call. The process may be executed by a voice gateway router of a telephony infrastructure provider such as one of the voice gateway routers a and b of . When a query is to be handled by a telephony services provider such as the telephony services provider of the voice gateway router retrieves signals for controlling the call from the telephony services provider. Otherwise the call is handled normally without retrieving signals from the telephony services provider.

The voice gateway router first receives a call from a locally serviced telephone . The call may be received directly from the telephone or from a delivery system that connects the telephone to the voice gateway router such as one of the delivery systems a and b of . The voice gateway router identifies a person that placed the call . The voice gateway router may identify people involved in the call based on for example phone numbers or IP addresses of the locally serviced telephone from which the call was placed.

The voice gateway router determines whether the call was placed by a user of the telephony services provider . In other words the voice gateway router determines whether the person that placed the call is a person whose calls are controlled by the telephony services provider. The voice gateway router may make such a determination by searching for an indication of the person that placed the call in a local user database such as one of the user databases a and b of . If an indication of the person is found in the user database then the person is a user of the telephony services provider. Otherwise the person is not a user of the telephony services provider.

If the person is a user of the telephony services provider then the voice gateway router builds a signaling path to the telephony services provider . The voice gateway router may know the location of the telephony services provider and consequently may be able to build the signaling path directly to the telephony services provider. The voice gateway router queries the telephony services provider over the signaling path for signals indicating how the call should be handled . The voice gateway router may query the telephony services provider for the signals by providing an indication of the call to the telephony services provider over the signaling path.

In response to the query the telephony services provider identifies the signals as described above with respect to . The telephony services provider sends the identified signals to the voice gateway router and the voice gateway router receives the signals . The voice gateway router then handles the call as indicated by the received signals . More particularly the voice gateway router executes the received signals such that the call is handled in a manner identified by the telephony services provider.

If the person is not a user of the telephony services provider then the voice gateway router handles the call normally without involving the telephony services provider. More particularly the voice gateway router identifies a voice gateway router that services the telephone to which the call was placed . The voice gateway router may identify the voice gateway router that services the telephone to which the call was placed based on characteristics of the telephone. For example the voice gateway router first may identify a phone number or a location to which the call was placed from the indication of the call received from the locally serviced telephone. The voice gateway router then may identify the corresponding voice gateway router based on the identified phone number or location.

The voice gateway router then builds a signaling path for the call directly to the voice gateway router that services the telephone to which the call was placed and also builds a voice path for the call directly to the same voice gateway router . The voice gateway router in conjunction with the voice gateway router that services the telephone to which the call was placed operates the call using the signaling path and the voice path . The voice gateway routers may use mappings such as the mappings a and b of to route signals and voice data to the endpoints of the call. As a result the call is handled normally without involving the telephony services provider.

The illustrated implementation of the process is executed by a first voice gateway router that services a telephone that placed the call. A similar process may be executed by a second voice gateway router that services a telephone to which the call was placed. In general the similar process is the same as the illustrated implementation of the process . More particularly the second voice gateway router may receive an indication of the call from the first voice gateway router or from the telephony services provider instead of from the telephone from which the call was placed . Instead of identifying a person that placed the call the second voice gateway router may identify a person to which the call was placed .

However the second voice gateway router may execute the similar process only when the first gateway router does not execute the process . If special call handling is to be applied for both the person that placed the call and the person to which the call was placed control signals for handling the call for the caller are identified first and control signals for handling the call for the recipient are identified second. The control signals for handling the call for the second user are identified such that those control signals do not conflict with the control signals identified for the caller.

Referring to one implementation of the telephony services provider of includes a telephony services signal processing system and a telephony services back end system . The telephony services signal processing system includes a feature server that includes features a n a service logic execution environment a back to back user agent call handling preferences a communications dashboard and a communications manager . The telephony services back end system includes various information sources a g that include an address book a a calendar b an alerts and reminders information source c an instant messaging information source d an e mail information source e a presence monitor f and a parental controls information source g.

The feature server manages the features a n. Each of the features a n represents an application that may be executed to identify signals for controlling a call in a particular manner. For example the feature a may cause e mail messages sent to a participant of the call to be read to the participant during the call. The feature b may provide to the participant reminders of calendar events from an electronic calendar maintained by the participant or of tasks to be performed by the participant. The feature c may provide news updates stock quotes weather reports or other information to a participant of the call. Such a feature may signal for information to be presented to the user such that other participants in the call may not perceive the information. In addition the feature d may cause ring tones or other call announcements that are specific to participants in a call to be provided to the participants when the calls are received. The feature e may allocate charges to a person that placed a call when a recipient of the call indicates that the call is undesirable.

Other features may cause the call to be delivered to an intended recipient of the call. The call may be made to ring busy for a participant that placed the call. Alternatively or additionally the call may be forwarded to a system that is different than a system to which the call was to be routed originally such as a voicemail system. A call may be blocked such that an intended recipient of the call does not receive the call. An alert of the call such as a ring tone another pre recorded audio message or a visual alert of the call may be presented to one or more participants of the call. An identification of a participant that placed the call may be presented to other participants of the call before the call is completed. An incoming call notification may be delivered to an intended recipient when the intended recipient is occupied with an ongoing but different call and the intended recipient may be enabled to interrupt the ongoing call to handle the incoming call.

The feature server may identify one or more of the features a n that may be executed to control a call. The feature server provides the identified features to the service logic execution environment which is a generic execution environment in which any of the features a n may be executed. For example the service logic execution environment may define an API of supported functions and the features a n may be implemented using the API.

The execution of one or more of the features a n in the service logic execution environment results in the identification of one of more call handling signals that are passed to the back to back user agent . The back to back user agent is an interface of the telephony services provider to a telephony infrastructure provider that operates calls that are controlled by the telephony services provider . Signaling paths that are built from the telephony infrastructure provider to the telephony services provider are built to the back to back user agent . As a result indications of calls for which control signals are to be identified are received from the telephony infrastructure provider by the back to back user agent . In addition the control signals are sent to the telephony infrastructure provider from the back to back user agent .

The call handing preferences identify one or more of the features a n to be applied to a call. More particularly the feature server may use the call handling preferences when identifying which of the features a n to apply to a call. The call handling preferences may identify conditions that must be satisfied for a particular feature to be applied to the call. The conditions may reference information that may be accessed from the telephony services back end system . The call handling preferences may include conditions for each user whose calls are controlled by the telephony services provider . The communications dashboard enables a user whose calls are controlled by the telephony services provider or a supervisor or a guardian of the user to specify personal call handling preferences. More particularly the communications dashboard is a user interface that may be accessed by the user to specify the personal call handling preferences. In one implementation the dashboard may include a program running on a server that can serve web pages to a user accessing the dashboard from a web browser. The communications dashboard also may be used to view information provided by the telephony services back end system .

The communications manager is an interface between the telephony services signal processing system and the telephony services back end system . More particularly the communications manager may provide an API with which other components of the telephony services signal processing system may request and receive information from the telephony services back end system . In one implementation the communications manager also may be used by the feature server and the service logic execution environment to access the call handing preferences . In one implementation the communications manager may include a cache of information from information sources a g such that commonly needed information does not need to be accessed repeatedly from the information sources a g.

The telephony services back end system includes information sources a g that provide information that may be used when identifying one or more of the features a n for application to a call or when executing the identified features. The information provided by the information sources a g may be maintained by the telephony services back end system or by one or more external systems corresponding to the information sources a g. For example information provided by the e mail information source d may be maintained by an e mail system that is external to the telephony services provider .

Each of the information sources a g may include information that corresponds to each of the users whose calls are controlled by the telephony services provider . The information sources a g are described below with respect to a single user though each of the information sources a g typically corresponds to multiple users.

The address book a includes contact information of people known to the user. The address book a may be used to determine if a person or opposite party participating in a call for which control signals are being identified is known to the user. In particular if contact information for the person is found in the address book then the person may be assumed to be known by the user. A feature may be applied to the call depending on whether the person is known to the user. For example a feature for providing contact information for the user may be applied to the call only when the user communicates with a known person in the call. Furthermore execution of a feature may require a determination of whether another person participating in a call is known to the user. For example a feature for providing an alert to the user may require a determination of whether the other participant is known such that the alert may be presented only to the user when the participant is not known and to both the user and the other participant when the participant is known.

The calendar b includes indications of events in which the user is to participate. A feature may be applied to a call when the user is participating in a particular type of event from the calendar b. For example a feature for providing news alerts to the user over a telephone used by the user may be applied to the call because the user is participating in the call as part of an event indicated by the calendar b. In addition execution of a feature may require accessing a description of an event in which the user is participating such that signals for presenting the description to the user may be identified. For example a feature for providing alerts of events to the user may access a description of the event such that the description may be provided to the user. The events indicated by the calendar b may indicate the availability of the user for example to place and receive calls. For example the user may be unavailable when participating in one of the events and may be available otherwise. The alerts and reminders information source c may include similar indications of events and tasks in which the user is to participate.

The instant messaging information source d and the e mail information source e both include information describing instant messages and e mail messages sent and received by the user. Signals for presenting instant messages and e mail messages to the user may be identified by one of the features a n but the call handling preferences may indicate that such a feature is only to be executed when the information sources d and e include messages that have not been presented to the user already. For example if a new e mail message or a new instant message for the user is received while the user is participating in the call then an indication of the new message such as a sender subject or a time of receipt of the message may be presented to the user. In response to the indication the user may signal for the message to be read. Appropriate signals for reading the message to the user such the message is not read to other participants of the call do not hear the message may be identified.

The presence monitor f indicates a current activity of the user. For example the presence monitor f may indicate whether the user is communicating with one or more other entities using a telephone instant messages or e mail messages or participating in an event from an electronic calendar of the user. The call handling preferences may indicate that one or more of the features a n be selected for execution if the user is using the telephone. For example if the presence monitor f indicates that the user is communicating using a telephone and instant messages a feature for presenting new instant messages to the user on the telephone may be selected for execution.

In addition the signals identified through execution of one of the features a n may depend on an activity of the user. For example a feature for determining whether the user may or may not participate in a call based on an activity of the user may identify signals for blocking or allowing the call depending on the activity of the user. For example the user may be available to participate in the call when participating in particular activities and signals for allowing the user to participate in the call may be identified when the presence monitor f indicates that the user is participating in one of the particular activities. Furthermore the user may not be available to participate in the call when participating in other activities and signals for blocking the call may be identified when the presence monitor f indicates that the user is participating in one of the other activities. In other words the current activity identified by the presence monitor f may indicate the availability of user to place and receive telephone calls.

The parental controls information source g includes information describing parental controls the telephone use of the user. For example the parental controls information source g may include an indication of an amount of time during a period for which the user has communicated using a telephone as well as an indication of a maximum amount of time during the period for which the user may communicate using the telephone. The parental controls information source g also may include indications of times when the user may participate in telephone calls and times when the user may not participate in telephone calls. The parental controls information source g also may include indications of people to or from whom calls are blocked.

The call handling preferences may indicate that one or more of the features a n be selected for application to a call based in information included in the parental controls information source g. For example if the parental controls information source g indicates that the present time is a time at which the user may not participate in the call then the a feature for notifying other participants in the call that the user may not participate in the call may be selected for execution. As another example if the parental controls information source g indicates that one or more other participants in the call are people to or from whom calls are blocked then a feature for blocking the call may be selected for execution.

In addition the signals identified through execution of one of the features a n may depend on the information included in the parental controls information source g. For example a feature for blocking or allowing a call may identify signals for allowing the call when the user has not communicated for longer than the maximum allowable amount of time during the time period. In addition the feature may identify signals for blocking the call when the user has communicated for at least the maximum allowable amount of time during the time period. Furthermore the feature may identify signals for allowing the call when the other participants in the call are people whose calls are allowed and signals for blocking the call when the one or more of the other participants in the call are people whose calls are blocked.

Information included in the telephony services back end system may be updated as a result of the execution of one or more of the features a n. For example when a feature for allowing the user to participate in a call is executed information included in the presence monitor f may be updated to indicate that the user currently is participating in the call. In general the information may be updated to include an indication of availability of the first call participant to place and receive a call an activity undertaken by the first call participant a time at which the first call participant may or may not place or receive a call a person with which the first call participant may or may not participate in a call an amount of time for which the first call participant has participated in calls a call handling preference or a parental control.

The updated information may be used to identify control signals for future calls. For example if a subsequent call for the user is received while the user still is participating in the original call control signals for providing a notification of the subsequent call to the user in a manner that does not interfere with the user s participation in the original call may be identified. Such control signals may be identified based on the updated information included in the presence monitor f which indicates that the user is participating in the original call.

The information included in the telephony services back end system and the preferences that applies to the user may be specified by the user or by a guardian or supervisor of the user such as a parent or an employer of the user. For example the user or the guardian or supervisor of the user may be presented a graphical user interface that may be used to specify the information. The user or the guardian or supervisor of the user may specify the information by accessing the telephony services back end system directly or by accessing one or more of the external systems that correspond to the information sources a g. For example the user may specify the information included in the address book a with an external communications system such as an e mail system. The information is specified prior to being used to identify control signals for a call.

Referring to a process is executed by the telephony services provider of to identify control signals for handling a call that involves a user of the telephony services provider . The process includes multiple components of the telephony services provider such as the back to back user agent BBUA the service logic execution environment SLEE the communications manager and the feature server .

The process begins when the BBUA receives signals identifying a call to be handled . The signals are received over a signaling path that has been established to the BBUA by a telephony infrastructure provider that is operating the call. The telephony infrastructure provider may send the signals identifying the call to the BBUA because the telephony infrastructure provider determined that the call should be handled by the telephony services provider . The BBUA passes information describing the call to the SLEE . The SLEE passes the information to the feature server and the feature server receives the information . The information may include telephone numbers to and from which the call was placed identifiers of people participating in the call and a time at which the call was placed.

The feature server requests information from the communications manager . More particularly the feature server requests information that may be used when identifying which of one or more included features such as the features a n of should be applied to the call. The requested information may include call handling preferences for one or more of the participants in the call.

The communications manager identifies the requested information for example from the telephony services back end system and then sends the requested information to the feature server . Using the received information the feature server identifies one or more of the included features to be applied to the call . For example the call handling preferences may indicate that a particular feature should be applied for one of the participants in the call so the feature server may identify the particular feature as one of the features to be applied to the call.

The feature server sends the identified features to the SLEE for execution and the SLEE receives the features . The SLEE executes the received features to identify control signals for handling the call . Execution of one or more of the features may require information from the telephony services back end system and the SLEE requests that information from the communications manager . The communications manager identifies the requested information from the telephony services back end system and sends the requested information to the SLEE .

The SLEE continues to execute the features that were sent by the feature server using the information received from the communications manager and identifies control signals for handling the call . The SLEE forwards the identified signals to the BBUA . The BBUA may validate the signals received from the SLEE to verify that the signals will result in allowable handling of the call. The BBUA sends the signals for execution to handle the call . More particularly the BBUA sends the signals over the signaling path on which the signals identifying the call were received. The telephony infrastructure provider receives and executes the signals to handle the call as indicated by the features that were executed.

Referring to one implementation of the communications dashboard of enables a user to view information used when identifying signals for controlling telephone calls involving the user. The communications dashboard includes multiple sections including a contact list a calendar an availability indicator a contact information indicator a voice mail indicator and a recent communications indicator . Interaction with the communications dashboard may add or modify information to the call handling preferences and the telephony services back end system of .

The contact list includes contact information for people known to a user for which the communications dashboard is presented. The information included in the contact list may be taken from one or more external sources such as an address book of an e mail system or a buddy list of an instant messaging system. In one implementation one of the entries of the contact list may be selected and an additional interface may be presented for specifying call handling preferences for calls to or from a person corresponding to the entry. For example the additional interface may enable the specification of a ring tone for calls from the person.

The calendar includes events from an electronic calendar of the user that may be retrieved from an external system that maintains the electronic calendar. Similarly to the contact list one of the events may be selected to display an additional interface for specifying call handling preferences related to the event. For example the additional interface may enable the specification of whether an alert for the selected event will be presented to the user and if so the type of alert to be presented to the user.

The availability indicator indicates the availability of the user to participate in telephone calls. The user may specify an availability with the availability indicator to override other automatic determinations of the availability of the user that may be made. The specified availability may indicate one or more call handling applications or features to be applied to calls to the user such as the features a n of . The specified availability also may affect the control signals that are identified with the one or more call handling applications.

The contact information indicator includes contact information for the user. The voice mail indicator indicates whether or not new voicemails for the user have been received. In one implementation the information presented by the contact information indicator and the voicemail indicator does not affect how calls to the user are handled. In other implementations the information presented by the indicators and may be used to identify and to affect the execution of the one or more call handling applications. For example a call handling application may be identified for execution only when a new voicemail has been received for the user.

The recent communications list identifies recent communications of the user. The recent communications may include telephone calls instant messages and e mail messages. The recent communications list may include indications of how the recent communications were handled. Such indications may be used to identify how future communications are to be handled. For example future communications may be handled in the same manner as the recent communications such that the applications for handling the future communications may be identified based on the indications of how the recent communications were handled.

Control signals for handling a call are described throughout as first being identified and then being distributed for execution. However control signals may be identified throughout the entire duration of the call and the control signals may be distributed as they are identified. As a result the call may be continually and asynchronously controlled through the entire call rather than being controlled at one or more points within the call. When control signals are identified at multiple points during a call different features or applications may be used at each of the multiple points to identify the signals.

A voice gateway router is described throughout as a single entity to which signaling and voice paths are established such that calls to telephones serviced by the voice gateway router may be controlled. In particular implementations of the described techniques the voice gateway router may include multiple subsystems that collectively operate as the voice gateway router described herein. For example the voice gateway router may include one or more subsystems that are analogous to a telephony services signaling processing of such that control signals may be identified for calls that are not handled by an external telephony services provider such as the telephony services provider of . However such subsystems may not access the information included in the telephony services provider such as the information included in the telephony services back end system of .

A VoIP telephony system is described throughout as a telephone system in which calls are operated by a telephony infrastructure provider and are controlled by a telephony services provider. However other telephone systems may be used to enable a telephony services provider to control calls operated by a telephony infrastructure provider. For example the telephony services provider may be applied to a circuit switched implementation of the described techniques such that calls between telephones connected to a circuit switched telephone network provided by a telephony infrastructure provider may be controlled by an external telephony services provider.

The described systems methods and techniques may be implemented in digital electronic circuitry computer hardware firmware software or in combinations of these elements. Apparatus embodying these techniques may include appropriate input and output devices a computer processor and a computer program product tangibly embodied in a machine readable storage device for execution by a programmable processor. A process embodying these techniques may be performed by a programmable processor executing a program of instructions to perform desired functions by operating on input data and generating appropriate output. The techniques may be implemented in one or more computer programs that are executable on a programmable system including at least one programmable processor coupled to receive data and instructions from and to transmit data and instructions to a data storage system at least one input device and at least one output device. Each computer program may be implemented in a high level procedural or object oriented programming language or in assembly or machine language if desired and in any case the language may be a compiled or interpreted language. Suitable processors include by way of example both general and special purpose microprocessors. Generally a processor will receive instructions and data from a read only memory and or a random access memory. Storage devices suitable for tangibly embodying computer program instructions and data include all forms of non volatile memory including by way of example semiconductor memory devices such as Erasable Programmable Read Only Memory EPROM Electrically Erasable Programmable Read Only Memory EEPROM and flash memory devices magnetic disks such as internal hard disks and removable disks magneto optical disks and Compact Disc Read Only Memory CD ROM . Any of the foregoing may be supplemented by or incorporated in specially designed ASICs application specific integrated circuits .

It will be understood that various modifications may be made without departing from the spirit and scope of the claims. For example advantageous results still could be achieved if steps of the disclosed techniques were performed in a different order and or if components in the disclosed systems were combined in a different manner and or replaced or supplemented by other components. Accordingly other implementations are within the scope of the following claims.

