---

title: Eye tracking based defocusing
abstract: Described herein are techniques and mechanisms for eye tracking based defocusing. According to various embodiments, video content may be transmitted from a server for presentation at a remote computing device in communication with the server via a network. Eye tracking information identified via an optical sensor at the client machine may be received from the remote computing device. The eye tracking information may describe a state of one or both eyes of an individual located proximate to the remote computing device. A first portion of the video content on which the eyes are more focused relative to a second portion of the video content may be identified. The video content may be updated based on the received eye tracking information. The second portion of the video content may be defocused relative to the first portion of the video content in the updated video content.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08990843&OS=08990843&RS=08990843
owner: MobiTV, Inc.
number: 08990843
owner_city: Emeryville
owner_country: US
publication_date: 20121026
---
The present disclosure relates generally to presenting defocused content based on eye tracking information.

Content may be viewed by users on a variety of devices such as televisions computers mobile devices and tablet computers. Transmitting content to devices often requires significant amounts of bandwidth. Mobile devices in particular often suffer from a lack of available bandwidth for receiving content. Many mobile devices receive data services that are subject to caps or costs on bandwidth rates or an amount of data transmitted. Video compression techniques allow a reduction in the amount of data transmitted but result in a lower quality video image and a diminished viewing experience.

Reference will now be made in detail to some specific examples of the invention including the best modes contemplated by the inventors for carrying out the invention. Examples of these specific embodiments are illustrated in the accompanying drawings. While the invention is described in conjunction with these specific embodiments it will be understood that it is not intended to limit the invention to the described embodiments. On the contrary it is intended to cover alternatives modifications and equivalents as may be included within the spirit and scope of the invention as defined by the appended claims.

For example the techniques of the present invention will be described in the context of fragments particular servers and encoding mechanisms. However it should be noted that the techniques of the present invention apply to a wide variety of different fragments segments servers and encoding mechanisms. In the following description numerous specific details are set forth in order to provide a thorough understanding of the present invention. Particular example embodiments of the present invention may be implemented without some or all of these specific details. In other instances well known process operations have not been described in detail in order not to unnecessarily obscure the present invention.

Various techniques and mechanisms of the present invention will sometimes be described in singular form for clarity. However it should be noted that some embodiments include multiple iterations of a technique or multiple instantiations of a mechanism unless noted otherwise. For example a system uses a processor in a variety of contexts. However it will be appreciated that a system can use multiple processors while remaining within the scope of the present invention unless otherwise noted. Furthermore the techniques and mechanisms of the present invention will sometimes describe a connection between two entities. It should be noted that a connection between two entities does not necessarily mean a direct unimpeded connection as a variety of other entities may reside between the two entities. For example a processor may be connected to memory but it will be appreciated that a variety of bridges and controllers may reside between the processor and memory. Consequently a connection does not necessarily mean a direct unimpeded connection unless otherwise noted.

In most applications video content is encoded such that different portions of any given video image exhibit similar video properties. That is each portion of the screen is similar in terms of resolution contrast ratio sharpness light intensity and other properties. However users often do not focus on all portions of video content equally. Instead users often focus on a portion of the display screen that contains important attractive or attention getting elements. For instance users may focus more on the hero in an action movie and less on background elements that are positioned far from the hero on a display screen.

User eye tracking information may be monitored and tracked in the context of the presentation of video content. For instance users eyes may be observed to focus on a particular portion of a display screen during a particular period of time when particular video content is presented. Based on this observation the video content may be encoded to provide for differential treatment of different portions of the content. For example a portion of the video content on which users eyes are focus less may be defocused relative to other portions of the video content.

According to various embodiments eye tracking based defocusing may in some cases allow for the transmission of video content from servers to client machines with lower bandwidth usage than conventional techniques. For instance video content may be encoded such that portions of the video content that are not typically focused on by users are encoded to fit a smaller data size. Although such an encoding may result in some reduction in quality the effect may be kept small by defocusing the less important video content portions. When the video content is encoded at a smaller data size less data needs to be transmitted from the server to the client device thus lowering the bandwidth required to communicate the video content.

According to various embodiments eye tracking based defocusing may in some cases allow for the transmission of video content of a perceptibly higher quality than conventional techniques. For instance video content may be encoded such that portions of the video content that are typically focused on by users are encoded at a higher quality level. Then even if other portions of the video content are encoded at the same or lower quality level the user may experience the content at a heightened quality level since the user is likely to focus on the higher quality portion of the video content. In some instances by increasing the quality of the video content portions the user is likely to focus on while decreasing the quality of other video content portions the user can experience the video content at a perceptibly higher quality while the total bandwidth required to transmit the video content stays constant or is reduced.

According to various embodiments eye tracking based defocusing may in some cases allow for lower processing resource usage and or lower power consumption during the encoding process. Encoding video content for transmission to a client machine may require significant computing resources particularly when a service provider is encoding thousands of video streams for transmission to tens of thousands of client machines. By reducing the required encoding quality for portions of video streams that users are less likely to focus on the usage of these computing resources may be reduced.

According to various embodiments eye tracking based defocusing may in some cases allow for lower processing resource usage lower power consumption or otherwise lower computing resource usage during presentation of video content. For example when a computing device determines that the user is focused on a particular portion of a display screen the computing device may reduce the brightness or contrast ratio on another portion of the display screen. As another example when a portion of a video content stream received from a remote server is encoded at a lower quality level processing the video stream to prepare the video content stream for presentation may require comparatively lower computing resources.

At content is presented at a client machine. According to various embodiments the client machine may be any computing device capable of presenting video content and communicating with a remote server. For instance the client machine may be a desktop computer laptop computer tablet computer mobile phone or other mobile device or television.

According to various embodiments the content presented at the client machine may be received from any of various sources. For example the content may be stored locally on the client machine. As another example the content may be streamed or downloaded via a network such as the Internet from a content service provider such as Netflix iTunes or Amazon. As yet another example the content may be retrieved from a network storage location.

At eye tracking information of a user proximate to the client machine is identified. According to various embodiments the eye tracking information may be identified by use of an optical sensor. The optical sensor may be used to determine location orientation and movement information for the user s eyes or other facial features. Techniques for identifying eye tracking information are discussed in further detail with respect to .

According to various embodiments various types of eye tracking information may be monitored. The eye tracking information that may be monitored and processed may include but is not limited to user eye movement velocity and acceleration the location at which a user is gazing the duration or dwell of a user s gaze at a particular location or locations a blink frequency the dilation of a user s pupils the eyelid aperture size and or other eye related information. Also the eye tracking information may include data used to identify a user s facial expressions or other indications of a user s mood opinion or impressions when viewing content presented on a portion of the display screen. Accordingly although the information may be referred to herein as eye tracking information in some instances this information may include data regarding the user s facial movements head location head orientation or other such related information.

At the focus of the content is adjusted based on the identified eye tracking information. According to various embodiments adjusting the focus of the content may involve any operation for focusing emphasizing or improving the quality of at least one portion of the video content relative to another portion of the video content. Adjusting the focus of the content may also involve any operation for defocusing deemphasizing or reducing the quality of at least one portion of the video content relative to another portion of the video content. Techniques for adjusting the focus of video content are discussed in further detail with respect to .

The client machine includes a processor and memory . Additionally the client machine includes a display screen configured to display content. The client machine also includes an optical sensor operable to collect eye tracking information from an individual in proximity to the client machine.

The server includes a content focus adjustment module operable to adjust the focus of video content transmitted to the client machine. The server also includes a content selection module operable to select content for presentation at the client machine. As well the server includes a processor and memory .

According to various embodiments as described herein a server may include components not shown in . For example a server may include one or more processors memory modules storage devices and or communication interfaces. As another example a server may include software and or hardware operable to retrieve content and provide the content to client machines.

The content focus adjustment module is operable to adjust the focus of video content for transmission to a client machine. For instance the content focus adjustment module may analyze eye tracking information to identify portions of video content that may be focused or defocused. Then the content focus adjustment module may conduct various types of operations for focusing or defocusing the identified portions of the video content. The adjustment of focus for video content is discussed in further detail with respect to .

The content selection module in the server is operable to select content to present at the client device. According to various embodiments the content selection module may be operable to identify a data constraint or preference associated with a particular client device or user account. Based on the identified information the content selection module can select a particular encoding of video content. The encoding may have a larger or smaller data size be subject to more or less focus adjustment or have other properties based on the device to which the video content is sent and or a user account associated with the device. Techniques for transmitting focus adjusted content to a client device are discussed in further detail with respect to .

The network interface is configured to receive and transmit communications via a network such as the Internet. According to various embodiments the network may be a wired network or a wireless network. The network interface may communicate via HTTP TCP IP UDP or any other communication protocol. Content may be transmitted to the client machine via unicast multicast broadcast or any other technique. Also content need not be transmitted by the server . For example in particular embodiments the server may select content for presentation while another server may transmit the content to the client machine.

The client machine may be any device operable to receive content via a network and present the content on the display screen . For example the client machine may be a desktop or laptop computer configured to communicate via the Internet. As another example the client machine may be a mobile device such as a cellular phone or tablet computer configured to communicate via a wireless network.

The display screen may be any type of display screen operable to present content for display. For example the display screen may be an LCD or LED display screen. As another example the display screen may be a touch screen. The client machine may include other components not shown in such as one or more speakers additional display screens user input devices processors or memory modules.

The optical sensor is operable to locate and track the state of one or both eyes of an individual in proximity to the client machine. The optical sensor is configured to receive and process light received at the sensor. According to various embodiments the light received and processed by the optical sensor may be any light on the spectrum capable including visible light infrared light ultraviolet light or any other kind of light. The specific type of light sensor used may be strategically determined based on factors such as the type of device at which the sensor is located and the likely proximity of the user to the device. In particular embodiments the light sensor may be a digital camera. Alternately or additionally an infrared sensor may be used.

According to various embodiments more than one light sensor may be used. For example information from two light sensors may be combined to triangulate a location of an eye. As another example different types of light sensors may be used to provide better eye tracking information in various lighting conditions.

The network interface is configured to receive and transmit communications via a network such as the Internet. According to various embodiments the network may be a wired network or a wireless network. The network interface may communicate via HTTP TCP IP UDP or any other communication protocol. Content may be received at the client machine via unicast multicast broadcast or any other transmission technique.

According to various embodiments the components shown in the client or server in need not be physically located within the same machine. For example the optical sensor shown in may be a web camera in communication with the client machine via an interface such as USB. As another example the user information storage module may be located outside the server . For instance the user information may be stored in a network storage location in communication with the server via the network interface .

At content is presented at a client machine. The content may be video content presented on a display screen. As discussed herein content may be received from various sources. For instance content may be streamed from a server in real time downloaded from a server retrieved from a local storage device received from a network storage device or retrieved in any other way.

According to various embodiments the presentation of content may be associated with a user account. For example a user may be logged in to a media content management system associated with a service provider. The service provider may provide services such as a content guide content management and content streaming. The user may receive such services via a user interface provided by the service provider. The user interface may interact with an optical device at the client machine to receive and or analyze tracking information for the user s eyes.

At eye tracking information for a user is identified. According to various embodiments the eye tracking information may include any information used to acquire specific observations regarding the status or movement of the user s gaze facial expressions head movements or orientation or other relevant information. For example a location in space occupied by the user s eyes may be determined.

At a time period is selected for analysis. According to various embodiments eye tracking information may be analyzed in real time. For instance a client machine may analyze data received via an optical sensor identify areas of focus and transmit an indication of the identified areas to a server. In this case the selected time period may be the current time period.

According to various embodiments eye tracking information may be analyzed by a client machine and or server after a video has been presented. For instance data received via an optical sensor may be stored for later analysis. Then in some cases the data may be transmitted to the remote server. Either the client machine or server may then select time periods for analysis. The time periods may be selected sequentially or based on other criteria such as based on which time periods are most likely to gain from focus adjustment. For example during some periods a user s eyes may quickly shift focus to many areas of the screen which may suggest that focusing or defocusing some portions of the video content relative to other portions of the video content is unwise. As another example during some periods a user s eyes may focus primarily on a single area of the screen which may suggest that the time periods are good candidates for focus adjustment.

At gaze location is determined. According to various embodiments the gaze location may correspond to an area of the display screen or video content on which the user s eyes are focused. The gaze location may be identified based on a central point a set of points or a screen portion on which the user s eyes are focused. The gaze location may correspond to a particular person or thing within the video content. For instance in an action movie the gaze location may correspond to the hero or another character an explosion a fuse or anything else displayed in a particular portion of the display screen.

At gaze duration is determined. According to various embodiments the gaze duration may correspond to a time period during which the user s eyes were primarily focused on the location determined in operation .

At gaze frequency is determined. According to various embodiments the gaze frequency may correspond to a number of occurrences or a percentage of time that the user s eyes focus on an identified portion of the video content. For example a user may focus primarily on an action hero in a movie but frequently glance at another area of interest such as a villain sneaking up on the hero. By determining gaze frequency the relative importance of various portions of the video content may be identified.

At eye movement information is determined. As discussed herein the eye movement information may include velocity direction and or acceleration information. According to various embodiments if a user quickly looks toward a particular area of the screen then screen portion may be selected for having a higher focus. Similarly if a user quickly looks away from a particular area of a display screen then video content displayed on the screen portion may be selected for defocusing.

At a determination is made as to whether to select an additional time period for analysis. As discussed with respect to operation various criteria may be used for selecting time periods for analysis. Accordingly an additional time period may be selected until all periods are analyzed until a sufficient reduction in data size is achieved until analyzing additional time periods is unlikely to yield profitable reductions in data size or until any other criteria are met.

At eye tracking information is transmitted for adjusting content focus. If the eye tracking based focus detection method is performed at least in part at a client machine then the eye tracking information may be transmitted to a server. If the eye tracking based focused detection method is performed at least in part at the server then the eye tracking information may be transmitted to a storage medium for storage.

According to various embodiments the method may be performed at a system configured to provide video streams encoded for presentation at client devices. For example the method may be performed at a device or system described with respect to .

According to various embodiments the method may be performed at least in part at a client machine. For example a client machine may present a video stream analyze the video stream based on the eye tracking information and transmit video stream focus information and or eye tracking information to a server. For future portions of the video stream a prediction may be made as to which portions of the video content to focus or defocus. Then the video stream may be focused or defocused in real time.

At request to adjust content focus in a video stream is received. In particular embodiments content focus may be adjusted periodically or occasionally. For example content focus for a video stream may be adjusted when the system has received a sufficient amount of eye tracking information for the video stream. As another example content focus for a video stream may be adjusted whenever the video stream is processed for encoding. As yet another example content focus for a video stream may be adjusted at regular time intervals upon request or upon detection of a triggering event or other criteria.

According to various embodiments the video stream may be any video content capable of being transmitted from a server for presentation at a client machine. For example the video stream may be transmitted via broadcast unicast or multicast transmission techniques. As another example the video stream may be a live stream or a pre recorded stream. In some cases the video stream may include one or more files that a client machine may download and present later. Alternately or additionally the video stream may be configured for live streaming and presentation to client machines. The video stream may include information other than video such as one or more audio tracks images metadata or other such information.

At eye tracking information is received for analysis. According to various embodiments eye tracking information may be received for a single user or for any number of users. For example eye tracking information may be received from a client machine in real time to update a stream being sent to the client machine. In this case the eye tracking information may be used to predict areas of focus for subsequently transmitted portions of the video stream. As another example eye tracking information collected from a large group of users for a video stream may be aggregated for the purpose of analyzing and re encoding the video stream for future viewing by other users.

At a time interval for adjusting focus is selected. According to various embodiments various techniques may be applied for selecting a time interval. For example each time interval in a video stream may be analyzed sequentially or in some other order. As another example the selection of time intervals may be prioritized by identifying time intervals likely to benefit from focus adjustment. For instance during some time intervals users may be observed to focus on a limited portion of the video content which may make focus adjustment techniques more beneficial. During other time intervals users may be observed to quickly shift focus to many areas of the video content or to not focus on any portion of the video content in particular which may make focus adjustment techniques less beneficial. As yet another example time intervals throughout a video stream may be sampled to identify patterns of eye movement that may be used to predict eye movement in unanalyzed time interval portions. In this case only some time intervals may be analyzed while even unanalyzed time intervals may be subjected to focus adjustment.

At a location is identified for focusing. According to various embodiments a location for focusing may be a location that users tend to focus on while viewing the video stream. For example the location may correspond to an important object or character. As another example the location may be positioned toward the center of the video content which users may tend to focus on more. As yet another example the location may correspond to changing or unexpected content that draws the user s attention.

According to various embodiments the location for defocusing may be identified by various techniques. For example the eye tracking information may be analyzed to select a location with a high frequency or time percentage of user eye focus. As another example the eye tracking information may be analyzed to select a location with extended gaze duration. As yet another example the eye tracking information may be analyzed to select a location that is the subject of eye movements having movement high velocity movement or high acceleration movement toward it.

At the identified location is focused during the selected time interval. According to various embodiments various techniques may be used to focus the identified location. For example the video content associated with the identified location may be encoded at a higher resolution contrast ratio or light intensity for a given period of time. As another example the video content associated with the identified location may be sharpened or subjected to a relatively high pass filter to increase the amount of detail shown at the identified location relative to other locations. As yet another example the video content associated with the identified location may be encoded at a relatively higher refresh rate.

At a location for defocusing is identified. According to various embodiments a location for defocusing may be a location that users do not tend to focus on while viewing the video content. For example the location may correspond to background scenery or characters. As another example the location may be close to the edge of the video content and users may tend not to focus on the edge of a display screen. As yet another example the video content may include elements that draw the user s attention away from the location to a different location.

According to various embodiments the location for defocusing may be identified by various techniques. For example the eye tracking information may be analyzed to select a location with a low frequency or time percentage of user eye focus. As another example the eye tracking information may be analyzed to select a location with limited gaze duration. As yet another example the eye tracking information may be analyzed to select a location that is not the subject of eye movements having movement high velocity movement or high acceleration movement toward it. As still another example the eye tracking information may be analyzed to select a location that is the subject of eye movements having movement high velocity movement or high acceleration movement away from it.

According to various embodiments the location for focusing or defocusing may be predicted based on eye tracking information for other time periods. For example if users tend to focus on a particular character in a movie during one time period then the system may predict that users will tend to focus on the character during other time periods that display similar video content. As another example as discussed with respect to operation eye tracking information for video content may be sampled at various time periods during the presentation of the video content to determine broad focus trends without analyzing eye tracking information during the entire presentation of the video content.

At the identified location is defocused during the selected time interval. According to various embodiments various techniques may be used to defocus the identified location. For example the video content associated with the identified location may be encoded at a lower resolution contrast ratio or light intensity for a given period of time. As another example the video content associated with the identified location may be blurred or subjected to a filter such as a low pass filter to reduce the amount of detail shown at the identified location. As yet another example the video content associated with the identified location may be encoded at a relatively lower refresh rate.

According to various embodiments any available video processing technique may be used to focus or defocus portions of the image. These techniques may include but are not limited to deblocking resizing deinterlacing denoising deflicking tinting color grading superresolution techniques interpolation deringing requantizing and luminance altering. In particular embodiments techniques may be applied in two dimensional or three dimensional video. Other techniques may include but are not limited to high dynamic range rendering blooming motion blur screen space ambient occlusion cel shading crepuscular ray alteration film grain simulation depth of field alteration and shadow mapping.

According to various embodiments an identified location may be focused or defocused during only a portion of the time interval. For example the eye tracking analysis may reveal that users tend to look away from a particular location at a designated time and then return to gazing at the identified location at another time. For the time period between these two times the identified location may be defocused. Similarly the eye tracking analysis may reveal that users tend to look toward a particular location during a designated time period and then look away from the location. In this case the location may be focused during the designated time period.

According to various embodiments more than one location may be selected for focusing and or defocusing. For example users may tend to glance back and forth between two portions of video content while tending to ignore other portions. As another example users may tend to focus on the center portion of video content while ignoring the left and right sides of the screen.

At a determination is made as to whether to select an additional time interval for focus adjustment. As discussed with respect to operation either all or selected time intervals may be analyzed for focus adjustment purposes. In some cases only time intervals that are likely to offer significant gains from focus adjustment are analyzed. For example in some time intervals users eyes may tend to focus primarily on a limited portion of the video stream while in other time intervals users eyes may tend to quickly move over all areas of the video stream.

At the adjusted video stream is stored. According to various embodiments video streams may be stored with different encodings so that the video streams may be transmitted to different types of client machines operating under various types of data constraints and in accordance with various types of user preferences as discussed with respect to . In some instances the adjusted video stream may be stored to a storage medium for subsequent transmission to a client machine. In other cases the adjusted video stream may be stored to a buffer for immediate transmission to a client machine.

According to various embodiments not all of the operations shown in need be performed. For example in some instances only focusing may be performed while in other cases only defocusing may be performed.

At a request to transmit content to a client machine is received. According to various embodiments the request may be associated with a particular user account or identifier. Based on the request or the user account the server may identify the device for which the content is requested. For instance the device may be a television mobile phone or computer.

At a data constraint associated with the client machine is identified. According to various embodiments the data constraint may be any consideration or limitation associated with transmitting data to the client machine or presenting video content at the client machine. For example the data constraint may be a resolution or contrast ratio limit of the display screen at the client device. As another example the data constraint may be a bandwidth limit for transmitting data to the client device. As yet another example the data constraint may be a video content preference associated with a user account linked to the client machine. In some instances more than one constraint or preference may be identified.

At focus adjusted content is selected for transmission. According to various embodiments video content may be encoded in various ways. For example video content may be encoded with various resolutions data rates data sizes and other properties. As another example video content may be encoded with more or less defocusing on key screen portions. Thus focus adjusted content may be selected based on the constraints and or preferences identified at operation .

The fragment server provides the caching layer with fragments for clients. The design philosophy behind the client server application programming interface API minimizes round trips and reduces complexity as much as possible when it comes to delivery of the media data to the client . The fragment server provides live streams and or DVR configurations.

The fragment controller is connected to application servers and controls the fragmentation of live channel streams. The fragmentation controller optionally integrates guide data to drive the recordings for a global network DVR. In particular embodiments the fragment controller embeds logic around the recording to simplify the fragment writer component. According to various embodiments the fragment controller will run on the same host as the fragment writer . In particular embodiments the fragment controller instantiates instances of the fragment writer and manages high availability.

According to various embodiments the client uses a media component that requests fragmented MPEG 4 files allows trick play and manages bandwidth adaptation. The client communicates with the application services associated with HTTP proxy to get guides and present the user with the recorded content available.

The fragment server provides the caching layer with fragments for clients. The design philosophy behind the client server API minimizes round trips and reduces complexity as much as possible when it comes to delivery of the media data to the client . The fragment server provides VoD content.

According to various embodiments the client uses a media component that requests fragmented MPEG 4 files allows trick play and manages bandwidth adaptation. The client communicates with the application services associated with HTTP proxy to get guides and present the user with the recorded content available.

According to various embodiments the fragment writer command line arguments are the SDP file of the channel to record the start time end time name of the current and next output files. The fragment writer listens to RTP traffic from the live video encoders and rewrites the media data to disk as fragmented MPEG 4. According to various embodiments media data is written as fragmented MPEG 4 as defined in MPEG 4 part 12 ISO IEC 14496 12 . Each broadcast show is written to disk as a separate file indicated by the show ID derived from EPG . Clients include the show ID as part of the channel name when requesting to view a prerecorded show. The fragment writer consumes each of the different encodings and stores them as a different MPEG 4 fragment.

In particular embodiments the fragment writer writes the RTP data for a particular encoding and the show ID field to a single file. Inside that file there is metadata information that describes the entire file MOOV blocks . Atoms are stored as groups of MOOF MDAT pairs to allow a show to be saved as a single file. At the end of the file there is random access information that can be used to enable a client to perform bandwidth adaptation and trick play functionality.

According to various embodiments the fragment writer includes an option which encrypts fragments to ensure stream security during the recording process. The fragment writer will request an encoding key from the license manager. The keys used are similar to that done for DRM. The encoding format is slightly different where MOOF is encoded. The encryption occurs once so that it does not create prohibitive costs during delivery to clients.

The fragment server responds to HTTP requests for content. According to various embodiments it provides APIs that can be used by clients to get necessary headers required to decode the video and seek any desired time frame within the fragment and APIs to watch channels live. Effectively live channels are served from the most recently written fragments for the show on that channel. The fragment server returns the media header necessary for initializing decoders particular fragments and the random access block to clients. According to various embodiments the APIs supported allow for optimization where the metadata header information is returned to the client along with the first fragment. The fragment writer creates a series of fragments within the file. When a client requests a stream it makes requests for each of these fragments and the fragment server reads the portion of the file pertaining to that fragment and returns it to the client.

According to various embodiments the fragment server uses a REST API that is cache friendly so that most requests made to the fragment server can be cached. The fragment server uses cache control headers and ETag headers to provide the proper hints to caches. This API also provides the ability to understand where a particular user stopped playing and to start play from that point providing the capability for pause on one device and resume on another .

In particular embodiments client requests for fragments follow the following format http HOSTNAME frag CHANNEL BITRATE ID COMMAND ARG e.g. http frag.hosttv.com frag 1 H8QVGAH264 1270059632.mp4 fragment 42. According to various embodiments the channel name will be the same as the backend channel name that is used as the channel portion of the SDP file. VoD uses a channel name of vod . The BITRATE should follow the BITRATE RESOLUTION identifier scheme used for RTP streams. The ID is dynamically assigned. For live streams this may be the UNIX timestamp for DVR this will be a unique ID for the show for VoD this will be the asset ID. The ID is optional and not included in LIVE command requests. The command and argument are used to indicate the exact command desired and any arguments. For example to request chunk 42 this portion would be fragment 42 .

The URL format makes the requests content delivery network CDN friendly because the fragments will never change after this point so two separate clients watching the same stream can be serviced using a cache. In particular the head end architecture leverages this to avoid too many dynamic requests arriving at the Fragment Server by using an HTTP proxy at the head end to cache requests.

According to various embodiments the fragment controller is a daemon that runs on the fragmenter and manages the fragment writer processes. A configured filter that is executed by the fragment controller can be used to generate the list of broadcasts to be recorded. This filter integrates with external components such as a guide server to determine which shows to record and which broadcast ID to use.

According to various embodiments the client includes an application logic component and a media rendering component. The application logic component presents the user interface UI for the user communicates to the front end server to get shows that are available for the user and authenticates the content. As part of this process the server returns URLs to media assets that are passed to the media rendering component.

In particular embodiments the client relies on the fact that each fragment in a fragmented MP4 file has a sequence number. Using this knowledge and a well defined URL structure for communicating with the server the client requests fragments individually as if it was reading separate files from the server simply by requesting URLs for files associated with increasing sequence numbers. In some embodiments the client can request files corresponding to higher or lower bit rate streams depending on device and network resources.

Since each file contains the information needed to create the URL for the next file no special playlist files are needed and all actions startup channel change seeking can be performed with a single HTTP request. After each fragment is downloaded the client assesses among other things the size of the fragment and the time needed to download it in order to determine if downshifting is needed or if there is enough bandwidth available to request a higher bit rate.

Because each request to the server looks like a request to a separate file the response to requests can be cached in any HTTP Proxy or be distributed over any HTTP based content delivery network CDN.

The fragment may be cached for a short period of time at caching layer . The mediakit identifies the fragment number and determines whether resources are sufficient to play the fragment. In some examples resources such as processing or bandwidth resources are insufficient. The fragment may not have been received quickly enough or the device may be having trouble decoding the fragment with sufficient speed. Consequently the mediakit may request a next fragment having a different data rate. In some instances the mediakit may request a next fragment having a higher data rate. According to various embodiments the fragment server maintains fragments for different quality of service streams with timing synchronization information to allow for timing accurate playback.

The mediakit requests a next fragment using information from the received fragment. According to various embodiments the next fragment for the media stream may be maintained on a different server may have a different bit rate or may require different authorization. Caching layer determines that the next fragment is not in cache and forwards the request to fragment server . The fragment server sends the fragment to caching layer and the fragment is cached for a short period of time. The fragment is then sent to mediakit .

In the foregoing specification the invention has been described with reference to specific embodiments. However one of ordinary skill in the art appreciates that various modifications and changes can be made without departing from the scope of the invention as set forth in the claims below. Accordingly the specification and figures are to be regarded in an illustrative rather than a restrictive sense and all such modifications are intended to be included within the scope of invention.

