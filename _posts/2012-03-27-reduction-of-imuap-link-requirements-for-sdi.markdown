---

title: Reduction of IMU/AP link requirements for SDI
abstract: A method, controller and system in accordance with various aspects of the present disclosure facilitate reduced energy consumption in a motion sensing device having an inertial measurement unit (IMU), with a strap down integration unit, and an application processing unit (AP). The system and method include sensing acceleration values and rotational values at the IMU and converting the sensed acceleration and rotational values into velocity and orientation increments by strap down integration. The velocity and orientation increments are stored in a first buffer at the IMU between updates to the AP. When an update request is received at the IMU from the AP over an interrupt link, the buffer contents are transmitted over a serial link from the IMU to the AP.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08952785&OS=08952785&RS=08952785
owner: Xsens Holding B.V.
number: 08952785
owner_city: Enschede
owner_country: NL
publication_date: 20120327
---
This application is a continuation in part of U.S. application Ser. No. 12 940 420 filed on Nov. 5 2010 and entitled Method and a System for Enabling a Wireless Communication Between a Master Unit and a Sensor Unit which claims priority to European Patent Application 09175290.7 filed Nov. 6 2009 the entirety of both applications being herein incorporated by reference for all that they teach without exclusion of any part.

The present disclosure relates to communications between an inertial measurement unit IMU and an application processor AP and more particularly relates to reduction of required bandwidth of a link between the IMU and AP.

The accurate recording or analysis of any movement requires first and foremost that the movement be accurately sensed. This was the basis for early navigational tools such as the magnetic compass and the astrolabe and it remains true today. Moreover while tools such as the compass and astrolabe require external sources of reference to determine motion it is sometimes necessary to determine motion internally i.e. via inertial measurements alone.

Early inertial measurement systems required that the sensing elements be isolated from the surrounding environment via complex and troublesome gimbaled or fluid suspended gyro stabilized platforms. However advances in electronics and micro devices have facilitated a variety of inertial sensor system known as a strap down system sometimes referred to as a Strap Down Integration system or Strap Down Inertial system both abbreviated SDI .

A typical SDI system contains two primary components namely an inertial measurement unit IMU and an application processor AP . A typical architecture based on these components is shown in . The illustrated system contains the IMU and the AP with a number of sub elements within the IMU . These include an analog section having a number of gyroscopic sensors and acceleration sensors accelerometers providing input to an analog to digital converter ADC . The ADC periodically samples the sensors and digitizes their values for calibration adjustment through a calibration module . Calibration may be based on environmental factors such as a temperature value from temperature sensor or otherwise. Finally within the IMU the digitized and calibrated values are provided to the SDI unit for integration.

In order to prevent aliasing coning and sculling which may be caused by vibration or shocks the sampling frequency at the analog side of the ADC must typically be high. Thus in most state of the art IMUs the analog sensing elements are sampled at a rate of a few kHz e.g. 2 4 kHz with multiple samples being used to create each frame at a frame rate of 200 400 Hz. In particular the SDI unit may combine a number of samples to determine the increment in the angle and velocity q and v respectively . The processed values are then transmitted over a link to the AP .

However transmitting this data to the AP via the link requires the link to have a very high bandwidth. Moreover the actual update rate required by an application using the data may be lower. For example a frame update rate of 24 Hz may be sufficient if the output is streamed to screen and a frame update rate as low as 1 Hz may be sufficient for pedestrian navigation guidance applications.

Where the sample rate is implemented in hardware the SDI rate is defined by the number of integrated samples and the update rate by the number of SDI frames. In most devices the SDI rate is the same as the update rate. On professional grade IMUs there are typically no buffers implemented since the AP using such devices should always have the time or be configured to handle the data and or buffers are implemented sufficiently on the receive side e.g. by implementing the communication using direct memory access DMA in which data points are stored in memory without involving the AP.

For consumer grade mobile devices power consumption is a significant concern and so power management is typically achieved by lowering the update rate of the IMU and switching the processor to a low power or sleep mode to occasionally wake up and handle data from the sensors. As such digital IMUs integrated in mobile devices often use an on board FIFO memory structure to store their data and have it ready for the processor to fetch it in a single burst.

However the described current state of the art architecture for mobile devices using consumer grade IMUs exhibits two substantial problems namely excessively low update rate and buffer overflow. With respect to the update rate to preserve power typically the update rate at the mobile device will be as low as possible. This also might be implemented in hardware by limiting the bandwidth i.e. lowering the clock of the communication line thereby effectively making it impossible to send data at higher update rates. With respect to buffer overflow when strap down integration is implemented the buffer of the IMU may overflow when the AP is too busy to read out the buffer or when the bus is too full with other communication.

The present disclosure is directed to a system and method for addressing some or all of the above difficulties however it should be appreciated that the solution of any particular problem is not a limitation on the scope of this disclosure or of the attached claims except to the extent expressly noted. Additionally this background section discusses problems and solutions noted by the inventors the inclusion of any problem or solution in this section is not an indication that the problem or solution represents known prior art except as otherwise expressly noted. With respect to prior art that is expressly noted as such the summary thereof is not intended to alter or supplement the prior art document itself any discrepancy or difference should be resolved by reference to the prior art.

In accordance with one aspect of the present disclosure a system and method are provided for reducing energy usage in a motion sensing device having an inertial measurement unit with a strap down integration unit and an application processing unit. The method includes sensing acceleration values and rotational values at the inertial measurement unit and converting the sensed acceleration and rotational values into velocity and orientation increments by strap down integration. The velocity and orientation increments are stored in a first buffer at the inertial measurement unit between updates to the AP. When an update request is received at the IMU from the AP over an interrupt link the buffer contents are transmitted over a serial link from the inertial measurement unit to the application processing unit.

In an embodiment of the invention the first buffer is a first in first out buffer. While the update request from the application processing may be an interrupt signal in an embodiment of the invention it is a clear to send signal or the like in another embodiment. To assist in capturing high frequency data between updates the IMU implements event detection in an embodiment of the invention and stores high frequency event data in a backtrack buffer at the IMU. The IMU notifies the AP when a high frequency event has occurred and the AP may request detailed data for the interval of interest. In this situation the IMU sends the contents of the backtrack buffer to the AP for analysis.

In an embodiment of the invention in order to avoid buffer overflow in the first buffer the IMU may combine the two oldest values in the first buffer via SDI so as to maintain the overall motion represented by the combined data.

Additional and alternative features and aspects of the disclosed methods and systems will become apparent from reading the detailed specification in conjunction with the included drawing figures.

The present disclosure provides an architecture that enables a device to minimize power consumption by reducing the number of data points that are communicated across a serial connection between an AP and an IMU. In overview and in accordance with certain embodiments of the invention this is accomplished by equipping the IMU with a FIFO buffer. Instead of the FIFO containing angular velocities and accelerometer values it contains velocity and orientation increments obtained by strap down integration. Further as a result in the case of imminent buffer overflow two velocity increments and orientation increments are combined using a further strap down integration step. Thus although the specific orientation and velocity for a specific moment is lost the resulting integrated orientation and velocity increment is maintained albeit over a longer interval.

In an embodiment of the invention the FIFO minimally contains the last velocity increment and orientation increment i.e. an on demand configuration . In a further embodiment of the invention a user can opt to configure the IMU such that the last velocity and orientation increment is sent only on request of the AP thereby reducing the information stream to what is absolutely necessary for the application. Each time the IMU is sampled a small orientation velocity increment is added to the existing orientation velocity increment. After the buffer has been readout at the request of the AP the SDI values velocity and orientation increments are reset to zero.

With above overview in mind and turning now to there is shown an exemplary architecture in keeping with the present disclosure. The illustrated architecture includes an IMU and an AP . The IMU in turn comprises an SDI unit for receiving calibrated sensor data on inputs e.g. from a calibration unit in communication with a plurality of accelerometers and gyroscopic sensors in a traditional manner.

The IMU further includes a first in first out FIFO buffer . The FIFO buffer receives velocity and orientation increments obtained by strap down integration from the SDI unit . The FIFO buffer is in turn configured to serially transmit its contents to the AP over serial link e.g. SPI I2C . In particular a bidirectional interrupt line from the AP to the FIFO buffer is used to trigger transmission from the FIFO buffer to the AP . The interrupt line may be used to transmit an actual interrupt signal or may transmit a clear to transmit signal or the like. The technical implementation of a bi directional interrupt line will be within the abilities of those of ordinary skill in the art and can be done in any suitable manner.

As noted above in the event of an imminent buffer overflow of the FIFO buffer the oldest two velocity increments and orientation increments are combined via strap down integration in an embodiment of the invention. As a result although one or more samples from specific moments are discarded the resulting integrated orientation and velocity increment is maintained albeit over a longer interval.

In a further embodiment of the invention the FIFO buffer contains at least the latest velocity increment and orientation increment e.g. for an on demand configuration . In this embodiment a user can choose to configure the IMU such that this latest velocity and orientation increment is sent only on request of the AP thereby reducing the information stream over serial link to what is absolutely necessary for the application running at the AP .

Each time the IMU is sampled a small orientation velocity increment is added to the existing orientation velocity increment. After the FIFO buffer has been readout upon request of the AP the SDI values velocity and orientation increments are reset to zero. This on demand embodiment of the invention will be discussed in greater detail below.

Within the on demand embodiment there is no requirement to pre configure an update rate at which data will be transmitted from the FIFO buffer to the AP . Rather the AP determines when to request an SDI data point from the FIFO buffer without losing accuracy. In this embodiment further a backtrack buffer may be implemented through which the overflow can be handled effectively without losing data.

The AP is then able to request the SDI data at irregular intervals e.g. when an update is required given the processor load the application currently running and the real time requirements. Issuing the request is implemented via the interrupt line by the AP sending an interrupt signal or other similar signal e.g. a clear to send indication . When the AP asserts this line the IMU will transmit the SDI value at the end of the next frame i.e. at the next integration step. This means that the IMU will not react directly on the assertion of the interrupt line by the AP since that could interfere with the precise sample timing at the IMU . Instead the IMU will check the level of the interrupt line at the frame transition. If the level of the interrupt line at the frame transition is high the IMU will transmit the calculated SDI value.

When not transmitting its SDI data the IMU continues to integrate thereby effectively increases the interval until the AP requests the data. The transmitted value corresponds to the interval between the current time and the last time at which the AP requested the SDI data.

In an embodiment of the invention after assertion of the interrupt line and once the IMU has transmitted the SDI data to the AP the IMU pulls down de asserts the interrupt line at the frame transition. The reason for the IMU to de assert the interrupt line specifically at the frame transition is to allow the AP to capture this moment precisely in the AP s own timeframe. This can then be used as mentioned below to correlate the IMU with other data.

In addition since the AP has information indicating the frame rate at the IMU and how many frames are associated with the interval other corrections could be implemented as well to cope with clock errors e.g. caused by a poor clock at the IMU . This eases the requirements for the clock at the IMU and thereby reduces power consumption. The power savings occurs because precise clocks must be temperature compensated which consumes power. While shared clocks could be used instead this introduces additional complexity and costs. Regardless the time corrections on the IMU data at the AP should not counteract the calibrations done on the IMU itself.

It will be appreciated that the timing data is not available when the AP keeps the interrupt line high to have the IMU transmit at the highest effective update rate as discussed above. However the lack of timing information in this case will not create a problem as long as the clocks of the IMU and AP are correlated enough for the AP to be able to determine the current frame at the IMU given its own internal time. Similarly the AP need not capture the timestamp for each and every data point received since clock correlation algorithms can determine the timestamp of the received data point.

Continuing an example of SDI data request timing is illustrated in the example of . In particular is a schematic frame sequence diagram correlating the timing of assertion and de assertion of the interrupt line with the SDI frame transmission and creation.

From a starting point in time the SDI unit generates sequential frames incorporating data from sequential sample instances. Thus the sequence of frames begins with a frame containing the first two sample instances and has become a frame incorporating the first six sample instances as of the time when the interrupt signal is asserted. While the interrupt signal is asserted the SDI transmits a frame incorporating samples through and begins creation of frames . At the start of the creation of the frame incorporating samples the IMU de asserts the interrupt line at time T.

The interrupt signal is again asserted by the AP during creation of the frame after which the IMU transmits the frame and begins creation of frames . At the start of the creation of the frame incorporating samples the IMU de asserts the interrupt line at time T. Thus while the update interval required by the AP is T T the update rate of the IMU is much quicker.

Regarding synchronization the timestamp can be obtained in the ISR of the AP and the SDI data can be read for example from its DMA channel. Using the timestamps the AP can correlate the SDI data with other sensor data in its own timeframe since the exact time of capture is known.

The transmission of the IMU should be completed before the AP issues a new request by re asserting the interrupt line . This can be assured via appropriate hardware or software i.e. to ensure that the interrupt line cannot be asserted during an ongoing transmission.

As noted elsewhere herein the AP can keep the interrupt line high and as a result the IMU continues to send data. However if the serial communication line has too low of a data rate such that a new value becomes available during the transmission of a current value upcoming values will be buffered in the FIFO until the buffer is filled at which point the mechanism of combining two elements is used as described elsewhere herein. This demonstrates the manner in which the described mechanism can be used to provide great freedom in choosing the data rate of the serial line even during operation.

Consider a situation in which the AP keeps the interrupt line high and consequently the IMU is continually transmitting the oldest element in the FIFO. Further in this example the FIFO can contain 3 elements and the transmission of a single value takes approximately 3 frames. This means that after 3 frames there is room for a new element. In the contents of the FIFO buffer and the ongoing transmission are illustrated for a number of consecutive frames. As can be seen from due to the combining of the two oldest elements when the buffer is full the system automatically adjusts itself to the capabilities of the serial communication link in use by effectively lowering the rate at which the data is received. This benefit is achieved without requiring any additional hardware or logic whatsoever.

It will be appreciated that since the IMU may be aware of an occasional high frequency event i.e. an event that exhibits significant changes in sensed data at a rate much higher than the AP update rate high frequency events may go unnoticed by the AP in an on demand update system unless precautions are taken. In this connection in an embodiment of the invention a prediction technique is applied at the AP to decrease the update request interval when a high frequency event is anticipated.

Thus for example the AP may keep the interrupt line high through the anticipated event. As a result the IMU would continue sending the data which is then stored in DMA. An example of a predictable event with respect to which this technique would apply is the periodic swaying of a skater. However for unpredictable events prediction is not as effective.

In order to allow the AP to track both predictable and unpredictable events without permanently increasing the update rate an event detection technique implements a buffer at the IMU for use in combination with event detection technique. In this embodiment of the invention the event detection occurs at the IMU . The detection of events may be based on changes in energy sudden stops sudden movements or accelerations and so on. Upon detection of an event the data sent by the IMU to the AP contains an indication that an event requiring a greater update rate has occurred. In an alternative embodiment of the invention an additional line between the IMU and AP is employed to convey event detection information as shown in .

As a result the AP is apprised that the IMU has identified an event by its own heuristics. The indication from the IMU regarding event detection need not be robust i.e. false positives may temporarily increase bandwidth usage but otherwise are not harmful since the AP will still perform a detailed analysis of the data generated by the IMU during the event.

Because a detailed analysis of event data by the AP will generally require analysis of intermediate data points the IMU buffers these points in an embodiment of the invention. In a first embodiment of the invention the AP is responsible for requesting the intermediate points if needed whereas in a second embodiment of the invention the IMU automatically send the intermediate points once it has detected an event. While either option is suitable the first option may be preferred because the control of updating remains at the AP .

In either case the IMU maintains the intermediate points in a backtrack buffer. To be more precise in order to enable the AP to precisely analyze the event the AP needs the intermediate points and therefore the IMU must buffer all the intermediate points between two consecutive AP data requests. This situation is exemplified by sample curve in . In the illustrated sample curve the open points represent updates routinely requested by the AP whereas the solid points represent intermediate values that have been buffered. To implement retrieval of data in the backtrack buffer the AP sets the IMU in a flushing mode e.g. using for the serial communication line after the AP receives the event detection indication from the IMU . In an embodiment of the invention once the interrupt line is asserted the IMU simply starts transmitting all of the buffered data points starting with the oldest and ending with the last one after the assertion.

An exemplary frame stream including an event notification and buffer flush is shown in . The illustrated frame sequence progresses through 12 samples with an event being detected by the IMU after the third sample. Pursuant to the next update request from the AP the IMU transmits the update data as well as an event notifier. In response to the event notifier the AP requests the backtrack buffer contents during the eighth sampling interval and the buffer is flushed including all points through over the course of the next two sampling intervals. In the meantime all new data is stored in the backtrack buffer as well. In an embodiment of the invention once a buffered element is transmitted it is deleted from the buffer. Furthermore it will be appreciated that with the foregoing technique only the intermediate points between two data requests need to be buffered.

In the event that the interval between two consecutive data requests from the AP becomes very large it is possible for the backtrack buffer to become completely filled and overflow. However instead of simply deleting a sample for example deleting the oldest value as would ordinarily be done with a FIFO structure the IMU combines the two oldest values via strap down integration accumulation in an embodiment of the invention. This operation is illustrated schematically in .

In particular the buffer is illustrated as initially containing 4 SDI data sets with the first being a combined set of SDI values and the last three being the latest SDI values. In addition a new SDI value is to be put into the buffer .

To accommodate the new SDI value the oldest SDI value the combined value is combined with the next oldest value SDI value to create a new oldest value and the new value is placed in the buffer in the space freed up by the combining step. This means that the last value in the buffer holds one SDI value delta orientation and delta velocity albeit over a longer integration time. The advantage of this approach is that although the exact data point in the time series is lost the information of the motion itself is not lost since that information is now contained in the last data value in the buffer . This combination technique can be applied numerous times as needed until the buffer is emptied by the AP .

Thus through the described novel architecture and in combination with the optional enhancements as discussed above as desired an IMU AP system is provided that allows for minimum power usage for data communications between the IMU and AP. This may be useful in any type of device but is most beneficial in power constrained mobile consumer devices such as smart phones and similar devices as well as other self contained tracking units as may be employed to track shipments or personnel. While only certain examples of the described system and method have been set forth alternatives and modifications will be apparent from the above description to those skilled in the art.

