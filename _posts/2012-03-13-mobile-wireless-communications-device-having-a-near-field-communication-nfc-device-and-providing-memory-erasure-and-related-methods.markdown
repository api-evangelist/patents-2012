---

title: Mobile wireless communications device having a near field communication (NFC) device and providing memory erasure and related methods
abstract: A mobile wireless communications device may include a wireless transceiver, a processor coupled with the wireless transceiver, and a near-field communication (NFC) device coupled with the processor. The NFC device may include an NFC controller, an NFC transceiver coupled with the NFC controller, and a first memory coupled with the NFC controller. The first memory may be configured to store at least one first application. The mobile wireless communications device may also include a second memory coupled to the processor and configured to store at least one second application. The processor may be configured to disable the NFC transceiver based upon a security condition, disable access to the at least one first application, erase the at least one second application, perform reset operation, and erase the at least one application from the first memory after the reset operation.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08670714&OS=08670714&RS=08670714
owner: BlackBerry Limited
number: 08670714
owner_city: Waterloo, Ontario
owner_country: CA
publication_date: 20120313
---
This application relates to the field of communications and more particularly to wireless communications systems and related methods.

Mobile communication systems continue to grow in popularity and have become an integral part of both personal and business communications. Various mobile devices now incorporate Personal Digital Assistant PDA features such as calendars address books task lists calculators memo and writing programs media players games etc. These multi function devices usually allow electronic mail email messages to be sent and received wirelessly as well as access the internet via a cellular network and or a wireless local area network WLAN for example.

Some mobile devices incorporate contactless card technology and or near field communication NFC chips. NFC technology is commonly used for contactless short range communications based on radio frequency identification RFID standards using magnetic field induction to enable communication between electronic devices including mobile wireless communications devices. This short range high frequency wireless communications technology exchanges data between devices over a short distance such as only a few centimeters.

The present description is made with reference to the accompanying drawings in which embodiments are shown. However many different embodiments may be used and thus the description should not be construed as limited to the embodiments set forth herein. Rather these embodiments are provided so that this disclosure will be thorough and complete. Like numbers refer to like elements throughout.

Generally speaking a mobile wireless communications device is disclosed herein which may include a wireless transceiver a processor coupled with the wireless transceiver and a near field communication NFC device coupled with the processor for example. The NFC device may include an NFC controller an NFC transceiver coupled with the NFC controller and a first memory coupled with the NFC controller. The first memory may be configured to store at least one first application for example. The mobile wireless communications device may also include a second memory coupled to the processor and configured to store at least one second application. The processor may be configured to disable the NFC transceiver based upon a security condition disable access to the at least one first application erase the at least one second application perform a reset operation and erase the at least one application from the first memory after the reset operation for example.

The processor may be configured to perform the reset operation after the erase of the at least one application of the second memory for example. The first memory may include a secure element for example.

The processor may be further configured to enable access to the NFC transceiver after the at least one first application is erased from the first memory. The processor may be further configured to erase the at least one first application after the reset operation is performed based upon communication via the wireless transceiver for example.

The mobile wireless communications device may include an input device coupled to the controller. The security condition may include a threshold number of unsuccessful access attempts via the input device. The security condition may include a security command entered via the input device for example. The security condition may also include a security command received via the wireless transceiver.

The mobile wireless communications device may further include a power source coupled to the processor. The processor may be configured to perform the reset operation by at least selectively disabling the power source.

A related communications system and a method are also provided. The method aspect is directed to a communications method for a mobile wireless communications device that may include wireless transceiver circuitry a processor coupled with the wireless transceiver circuitry and a near field communication NFC device coupled with the processor. The NFC device may include a NFC controller an NFC transceiver coupled with the NFC controller and a first memory coupled with the NFC controller and configured to store a first plurality of applications. The mobile wireless communications device may also include a second memory configured to store a second plurality of applications for example. The method may include using the processor to disable the NFC transceiver based upon a security condition using the processor to disable access to the first plurality of applications and using the processor to erase the second application for example. The method may also include using the processor to perform a reset operation and using the processor to erase the first plurality of applications from the first memory after the reset operation.

A related computer readable medium aspect is directed to a non transitory computer readable medium for use with a mobile wireless communications device such as the one described briefly above. The non transitory computer readable medium may have computer executable instructions for causing the mobile wireless communications device to perform various steps. The steps may include disabling the NFC transceiver based upon a security condition disabling access to the first plurality of applications and erasing the second application. The steps may further include performing a reset operation and erasing the first plurality of applications from the first memory after the reset operation.

Referring initially to a communications system illustratively includes a near field communication NFC terminal associated with an object and a mobile wireless communications device also referred to as a mobile device herein . Example mobile wireless communications devices may include portable or personal media players e.g. music or MP3 players video players etc. portable gaming devices portable or mobile telephones smartphones tablet computers digital cameras etc.

The mobile device illustratively includes a portable housing and a wireless transceiver carried by the portable housing . The wireless transceiver may comprise a cellular transceiver or other type of wireless communications transceiver and may communicate any combination of voice and data such as for example email. The wireless transceiver may communicate with a security server that may provide one or more of remote instructions and provisioning operations of the mobile device .

The mobile device includes a display carried by the portable housing . The display may comprise a liquid crystal display LCD and may be configured to display information relating to data or voice communications. The display may be in the form of an active display that includes a backlight for example. The display may display email information contact information or call information. The display may be another type of display for example a passive display and may display other information.

The mobile device also includes an input device . The input device may be a keypad touch screen display or other input device for example.

The mobile device also includes a processor that is carried by the portable housing and coupled with the wireless transceiver circuitry the input device and the display . The processor may be implemented using hardware e.g. memory etc. and software components i.e. computer readable instructions for causing the mobile device to perform the various functions or operations described herein.

The mobile device also includes an NFC device carried by the portable housing and coupled with the processor . The NFC device includes a NFC controller and a NFC transceiver coupled with the NFC controller . The NFC controller and the NFC transceiver advantageously cooperate to perform at least one NFC communication function. For example the NFC device may communicate with the NFC terminal based upon proximity thereto using NFC communication. The NFC terminal may be a NFC tag a NFC enabled mobile device a smart poster etc.

By way of background NFC is a short range wireless communications technology in which NFC enabled devices are swiped bumped or otherwise moved in close proximity to communicate. In one non limiting example implementation NFC may operate at 13.56 MHz and with an effective range of about 10 cm but other suitable versions of near field communication which may have different operating frequencies effective ranges etc. for example may also be used.

The NFC device also includes a first memory coupled to the NFC controller . More particularly the first memory may be embedded within the NFC device hardware or within the NFC integrated circuit IC . The first memory may be tamper resistant for example. In other words the first memory may comprise a secure element. The first memory or secure element may store applications relating to NFC communications or contactless applications for communicating with the NFC terminal . For example the applications may include financial payment applications secure access system applications loyalty card applications and other applications and may be encrypted. In some example embodiments the first memory may store only one application.

The mobile device also includes a second memory . The second memory may be the device memory for example. In other words the second memory may include operating system files applications and other device data. In some example embodiments the second memory may be part of the universal integrated circuit card UICC for example. The second memory may also be removable and may be a secure digital SD card or a subscriber identity module SIM card for example. The second memory may be another type of memory for example a flash memory. Of course while first and second memories are described herein more than two memories may be used. In other words applications or secure elements may be stored in or spread over various memory devices. It should also be noted that a secure element may be implemented in a dedicated or secure area of a common memory for example.

The processor may be configured to disable the NFC transceiver based upon a security condition. A security condition may occur when a user of the device cannot be authenticated for example as a result of the user entering too many incorrect passwords via the input device . Alternatively the security condition may occur when the user may have selected via the input device that a security condition has occurred or wishes to perform operations associated with a security condition for example when the user desires to give the device to another user for example. These operations may be collectively termed a wipe . Still further a security condition may occur when the device receives a remote command i.e. wipe command indicating a security condition for example from a system administrator. Indeed a wipe may occur at any time regardless whether the mobile device is coupled to a network.

If a security condition is detected the processor may be configured to disable access to the applications on the first memory i.e. the NFC based application for example the secure payment application. Disabling is performed since the mobile device typically does not have unlimited read write access to the first memory since the first memory does not inherently trust the mobile device . Thus the security server is able to initiate a wipe of the first memory based upon communication therewith as will be described in further detail below.

After disabling access to the applications on the first memory the processor is configured to erase the contents or second application from the second memory or device memory. In other words the mobile device is wiped.

The processor performs a reset operation after successfully erasing the applications from the second memory . In other words the reset operation may be based upon a successful wipe. The reset operation may be performed by selectively disabling a power source carried by the housing and coupled to the processor . In other words the reset operation may be a power down power up cycle of the mobile device . The power source may be a battery cell for example. In some example embodiments a reset operation may not be performed.

The processor is also configured to erase the applications from the first memory after the reset operation. The processor may erase the applications based upon a command received from the security server via the wireless transceiver after the reset operation. The processor after the applications are deleted or wiped from the first memory is configured to enable access to the NFC transceiver.

In some example embodiments the contents or second application from the second memory may not be erased based upon a security condition. Based upon a security condition the application on the first memory may be erased while selectively maintaining the second application on the second memory . In other words the processor may be configured to erase the application from the first memory without performing the steps of erasing the second application and resetting.

Referring now to in one advantageous example embodiment the first memory may be an embedded secure element eSE . An eSE is an integrated circuit IC that manages and includes credentials e.g. credit cards access cards transit passes etc. that have been provisioned to the mobile device . The eSE runs GlobalPlatform 2.1.1 and is compatible with JavaCard 2.2.2 for example. The eSE may run or be compatible with other or additional platforms.

Within the eSE GlobalPlatform is responsible for managing the lifecycle of other applets and for providing them with security services e.g. allowing application security domains to be created . Security domains maintain a lifecycle state for each applet e.g. active locked etc. manage the keys for authenticated access to an applet and serve as an endpoint when a secure channel is established between a security server i.e. trusted service manager TSM and an applet. The security server or TSM is typically responsible for provisioning and managing the applets within its security domain on the first memory .

RF readers and more particularly NFC readers for example the NFC terminal may communicate with the applets that are installed on the eSE via the NFC controller and NFC transceiver . A reader or NFC terminal first selects an applet by its applet identifier AID GlobalPlatform checks for the existence of the applet in question and verifies that the applet is in the correct lifecycle state and then further application protocol data units APDUs sent by the reader are routed to the applet by GlobalPlatform. Generally the RF readers for example the NFC terminal do not open secure channels to the security domains and any authentication that occurs with the NFC terminal is the responsibility of the specific applet that gets selected.

The TSM may open a secure channel to the issuer security domain ISD via the mobile device by authenticating itself using the appropriate ISD keys. An ISD is considered the security endpoint that communicates with the root TSM and allows for installation of applets and management of application security domains ASDs . To the mobile device this secure channel is entirely opaque. The TSM may then manage applets e.g. install and delete them change their lifecycle states and manage the application security domains on the eSE . After establishing a secure channel with a security domain the TSM can then send APDUs to the applets that belong to that security domain. The applet can determine that it is communicating with its TSM over a secure channel and can thus allow access to privileged or administrative commands.

The eSE typically does not trust the mobile device to the same degree as the TSM since GlobalPlatform may not intend for a mobile device to have access to the keys that are needed to open a secure channel. However an applet can determine that it is communicating over the baseband interface and thus allow access to commands that would not otherwise be available. The baseband interface generally refers to communications between the processor and the eSE or first memory via the NFC controller . This may include commands that are sent from the wireless transceiver for example that are then sent to the eSE across the baseband interface.

For example a credit card applet may allow the baseband interface to place it in a visible or hidden state while allowing access to the necessary commands for a typical financial transaction over the NFC transceiver or RF interface. It should be noted that due to this limitation the mobile device may not wipe the eSE in a conventional sense. Based on the interfaces and application programming interfaces APIs provided by GlobalPlatform there is typically no way for the mobile device to delete an applet or for that matter even to enumerate the applets that are installed instantiated on the eSE .

Based on the considerations described earlier it may be increasingly difficult for the mobile device to directly delete applets from the eSE . Conversely however it may be unacceptable for a mobile device to delay a wipe until such time that the TSM could be contacted to wipe the eSE especially given that an attacker might remove the mobile device SIM or any other persistent memory device i.e. the second memory to ensure it does not have radio coverage.

In the present embodiments the processor takes steps to ensure data and access to the eSE is locked down when the mobile device wipe is triggered effectively resembling a wipe of the eSE to the end user and will result in the eSE being wiped at the next possible opportunity i.e. whenever the mobile device has data coverage and is able to contact the TSM .

The eSE may include applets or other code to perform the wipe process. More particularly the eSE may include one or more emulation layers for example the MIFARE and iClass emulation layers. The emulation layers may not be directly linked to applets or other code on the eSE for example. The applet generally includes security keys for writing to its corresponding emulation layer for example for the MIFARE emulation class this would be K MIFARE which is derived from K A and K B for a specific block of MIFARE memory. Each of the wipe applets may be installed and instantiated by the TSM . The applets may be visible over the baseband interface and it may respond to a specific APDU that may trigger it to wipe its corresponding emulation layer using the security keys for example.

The ISD lifecycle state can be moved to card lock effectively disabling access to all applets on the eSE by an applet provided that it is granted the card lock privilege. Thus a wipe applet can be installed and instantiated by the TSM to the ISD and given card lock privileges. The applet may be only visible over the baseband interface and may respond to a specific APDU that triggers it to move the ISD lifecycle state to card lock. Additional code may be used so that certain portions for example internal code can communicate with this applet.

In a normal operating state the user uses the mobile device normally for voice and or data communications. For example if the user uses a wallet application for example and the TSM has installed anything to their mobile device s eSE the TSM installs and instantiates the wipe applet to the ISD and asserts the a persistent flag indicating the eSE is in use. If at some point the eSE is provisioned with an emulation layer credential for example the corresponding emulation layer wipe applet would be installed and instantiated at this time. For example if the eSE is provisioned with a MIFARE credential then the MIFARE wipe applet would be installed and instantiated at this time.

In a first step the wipe is triggered. As noted above the mobile device wipe may be triggered in multiple ways for example too many incorrect passwords guesses via the input device in an attempt to gain access to the mobile device the user may have selected the wipe option on the mobile device or a remote wipe command may be sent. In the remote wipe case an acknowledgement may be sent for example. It is worthwhile noting that that the wipe may not be delayed if this acknowledgement is not sent.

In a second step the access to the processing interface for communicating with the eSE and the transceiver is locked down. If a persistent flag indicating the eSE has been personalized the mobile device wipe code may assert a persistent flag indicating the eSE has been locked. Each of the above noted persistent flag may be set or cleared. The eSE primary interface APIs and the NFC transceiver APIs check the value of a persistent flag indicating the eSE has been locked when they are called. If it is asserted the eSE primary interface APIs typically should ignore any call not coming from an internal or trusted module and the NFC transceiver APIs should disable all access to the card emulation mode.

In a third step each emulation layer is wiped. The wipe APDU is sent to the corresponding wipe applet over the baseband interface. The applet wipes personalization data in the emulation layer. More particularly for example the wipe APDU may wipe the personalization data in the iClass and MIFARE emulation layers.

In a fourth step the eSE ISD is moved to a card locked state. The wipe APDU is sent to the wipe applet over the baseband interface. The applet moves the ISD state to card locked effectively denying access to applets and security domains on the eSE . It should be noted that this step must take place after the third step since otherwise communication may not be possible with the applets that wipe the emulation layers in those steps. After this step although the eSE still includes personalized applets these applets are no longer accessible to anyone but the TSM . From the end user s perspective the eSE is wiped .

In a fifth step the mobile device is wiped. The mobile device is wiped by operating system OS code for example.

In a seventh step an eSE proxy not shown signals the TSM . The eSE proxy starts up and detects that the ISD is in a card locked state by attempting to select the ISD over the baseband interface or by checking the persistent flag indicating the eSE has been locked. It then waits for a data connection and signals the TSM that the eSE needs to be wiped.

In a ninth step access to eSE primary interface APIs and the NFC transceiver are restored. Once the TSM is satisfied that all applets have been deleted from the eSE it signals the eSE proxy to de assert the a persistent flag indicating the eSE has been locked. At this stage eSE primary interface APIs are unlocked to third parties and the NFC transceiver is permitted to enter card emulation mode again. The eSE at this point has been reset to a factory state.

Referring now to the flowchart of related method aspects are now described. Beginning at Block the processor determines whether a security condition or wipe has been initiated Block . If a security condition or wipe is determined the processor disables the NFC transceiver Block . The processor then disables access to the first plurality of applications on the first memory Block . At Block the processor erases the second application from the second memory . A reset operation is performed by the processor Block . At Block the security server sends a signal to the processor via the wireless transceiver once a connection is established therewith. At Block the processor erases the first plurality of applications from the first memory if the signal from the security server is received. The NFC transceiver at Block is re enabled after the first plurality of applications is erased. The method ends at Block .

Example components of a mobile wireless communications device that may be used in accordance with the above described embodiments are further described below with reference to . The device illustratively includes a housing a keyboard or keypad and an output device . The output device shown is a display which may comprise a full graphic LCD. Other types of output devices may alternatively be utilized. A processing device is contained within the housing and is coupled between the keypad and the display . The processing device controls the operation of the display as well as the overall operation of the mobile device in response to actuation of keys on the keypad .

The housing may be elongated vertically or may take on other sizes and shapes including clamshell housing structures . The keypad may include a mode selection key or other hardware or software for switching between text entry and telephony entry.

In addition to the processing device other parts of the mobile device are shown schematically in . These include a communications subsystem a short range communications subsystem the keypad and the display along with other input output devices and as well as memory devices and various other device subsystems . The mobile device may comprise a two way RF communications device having data and optionally voice communications capabilities. In addition the mobile device may have the capability to communicate with other computer systems via the Internet.

Operating system software executed by the processing device is stored in a persistent store such as the flash memory but may be stored in other types of memory devices such as a read only memory ROM or similar storage element. In addition system software specific device applications or parts thereof may be temporarily loaded into a volatile store such as the random access memory RAM . Communications signals received by the mobile device may also be stored in the RAM .

The processing device in addition to its operating system functions enables execution of software applications A N on the device . A predetermined set of applications that control basic device operations such as data and voice communications A and B may be installed on the device during manufacture. In addition a personal information manager PIM application may be installed during manufacture. The PIM may be capable of organizing and managing data items such as e mail calendar events voice mails appointments and task items. The PIM application may also be capable of sending and receiving data items via a wireless network . The PIM data items may be seamlessly integrated synchronized and updated via the wireless network with corresponding data items stored or associated with a host computer system.

Communication functions including data and voice communications are performed through the communications subsystem and possibly through the short range communications subsystem. The communications subsystem includes a receiver a transmitter and one or more antennas and . In addition the communications subsystem also includes a processing module such as a digital signal processor DSP and local oscillators LOs . The specific design and implementation of the communications subsystem is dependent upon the communications network in which the mobile device is intended to operate. For example a mobile device may include a communications subsystem designed to operate with the Mobitex Data TAC or General Packet Radio Service GPRS mobile data communications networks and also designed to operate with any of a variety of voice communications networks such as AMPS TDMA CDMA WCDMA PCS GSM EDGE etc. Other types of data and voice networks both separate and integrated may also be utilized with the mobile device . The mobile device may also be compliant with other communications standards such as 3GSM 3GPP UMTS 4G etc.

Network access requirements vary depending upon the type of communication system. For example in the Mobitex and DataTAC networks mobile devices are registered on the network using a unique personal identification number or PIN associated with each device. In GPRS networks however network access is associated with a subscriber or user of a device. A GPRS device therefore typically involves use of a subscriber identity module commonly referred to as a SIM card in order to operate on a GPRS network.

When required network registration or activation procedures have been completed the mobile device may send and receive communications signals over the communication network . Signals received from the communications network by the antenna are routed to the receiver which provides for signal amplification frequency down conversion filtering channel selection etc. and may also provide analog to digital conversion. Analog to digital conversion of the received signal allows the DSP to perform more complex communications functions such as demodulation and decoding. In a similar manner signals to be transmitted to the network are processed e.g. modulated and encoded by the DSP and are then provided to the transmitter for digital to analog conversion frequency up conversion filtering amplification and transmission to the communication network or networks via the antenna .

In addition to processing communications signals the DSP provides for control of the receiver and the transmitter . For example gains applied to communications signals in the receiver and transmitter may be adaptively controlled through automatic gain control algorithms implemented in the DSP .

In a data communications mode a received signal such as a text message or web page download is processed by the communications subsystem and is input to the processing device . The received signal is then further processed by the processing device for an output to the display or alternatively to some other auxiliary I O device . A device may also be used to compose data items such as e mail messages using the keypad and or some other auxiliary I O device such as a touchpad a rocker switch a thumb wheel or some other type of input device. The composed data items may then be transmitted over the communications network via the communications subsystem .

In a voice communications mode overall operation of the device is substantially similar to the data communications mode except that received signals are output to a speaker and signals for transmission are generated by a microphone . Alternative voice or audio I O subsystems such as a voice message recording subsystem may also be implemented on the device . In addition the display may also be utilized in voice communications mode for example to display the identity of a calling party the duration of a voice call or other voice call related information.

The short range communications subsystem enables communication between the mobile device and other proximate systems or devices which need not necessarily be similar devices. For example the short range communications subsystem may include an infrared device and associated circuits and components a Bluetooth communications module to provide for communication with similarly enabled systems and devices or a near field communications NFC sensor for communicating with a NFC device or NFC tag via NFC communications.

Many modifications and other embodiments will come to the mind of one skilled in the art having the benefit of the teachings presented in the foregoing descriptions and the associated drawings. Therefore it is understood that various modifications and embodiments are intended to be included within the scope of the appended claims.

