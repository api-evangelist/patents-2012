---

title: Information processing apparatus, information processing method, and storage medium for storing program
abstract: The number of pages in which data of a structured document is laid out is determined in response to an instruction from the user, and whether the content of the data of the structured document is editable when the data is laid out is judged. The data of the structured document is then laid out in accordance with the judgment result and the determined number of pages.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09256581&OS=09256581&RS=09256581
owner: Canon Kabushiki Kaisha
number: 09256581
owner_city: Tokyo
owner_country: JP
publication_date: 20120807
---
The present invention relates to an information processing apparatus and information processing method for laying out data based on a structured document and a storage medium for storing a program.

In recent years it has become possible to obtain various types of information by accessing web pages on the Internet. A web page is a structured document written in a structured language such as Hyper Text Markup Language HTML or Extensible Hyper Text Markup Language XHTML . A web page can be displayed on a display or output to a printer by a software application called a browser supporting the structured document.

When outputting a structured document to a printer the user can specify the enlargement reduction rate in a print preview of the browser to enlarge reduce print data thereby permitting the printer to print the print data in a desired size. Also Japanese Patent Laid Open No. 2005 219294 describes a method where when the final page of print data has large blank space left in the bottom portion the print data is printed with the content of the final page arranged to fall within the previous page.

In the prior art method described above which is meant for printing the print data of the final page to fall within the previous data no consideration is given to the total number of pages. Therefore the print data may not be printed in the number of pages desired by the user. In order to ensure printing in a desired number of pages it is necessary to set the reduction rate in the print preview of the browser in manual operation stepwise by repeating specification of the reduction rate and check of the print preview.

An aspect of the present invention is to eliminate the above mentioned problems with the conventional technology. The present invention provides an information processing apparatus and information processing method capable of laying out data of a structured document appropriately and easily and a storage medium for storing a program.

The present invention in its first aspect provides an information processing apparatus comprising a decision unit configured to decide in response to an instruction from a user a number of pages in which data of a structured document is laid out a determination unit configured to determine based on the structured document whether a content of the data of the structured document is editable when the data is laid out and a layout unit configured to lay out the data of the structured document in accordance with the determination result by the determination unit and the number of pages decided by the decision unit.

The present invention in its second aspect provides an information processing method comprising the steps of in response to an instruction from the user deciding the number of pages in which data of a structured document is laid out determining based on the structured document whether a content of the data of the structured document is editable when the data is laid out and laying out the data of the structured document in accordance with the determination result in the determining step and the number of pages decided in the deciding step.

The present invention in its third aspect provides a computer readable storage medium for storing a program the program causing a computer to execute the steps of in response to an instruction from the user deciding the number of pages in which data of a structured document is laid out determining based on the structured document whether a content of the data of the structured document is editable when the data is laid out and laying out the data of the structured document in accordance with the determination result in the determining step and the number of pages decided in the deciding step.

According to the present invention data of a structured document can be laid out appropriately and easily.

Further features of the present invention will become apparent from the following description of exemplary embodiments with reference to the attached drawings.

Preferred embodiments of the present invention will now be described hereinafter in detail with reference to the accompanying drawings. It is to be understood that the following embodiments are not intended to limit the claims of the present invention and that not all of the combinations of the aspects that are described according to the following embodiments are necessarily required with respect to the means to solve the problems according to the present invention. Elements having the same configuration are given the same reference numerals and their explanation is not repeated.

A display section including a CRT or a liquid crystal display and a graphic controller displays a web page downloaded from any WWW server a print preview image a graphic user interface GUI etc. An input section is a block allowing the user to input various types of instructions into the PC and is a pointing device or a keyboard for example. A system bus connects the CPU the RAM the ROM the hard disk etc. mutually. A LAN interface is an interface to which a LAN cable is connected through which data communication with the external WWW servers is established via a router not shown and the Internet . Note that in this embodiment the data communication may be performed wirelessly by a wireless supporting interface for example. In the PC is of a notebook type where the display section and the input section are integrated with the control section including the CPU and the RAM . Alternatively the PC may be of a desktop type where the display section and the input section are in separate bodies.

A structured document print module is a plug in software application called from the browser using a structured document as a parameter. The browser executes the structured document print module when the user starts the browser . In this embodiment the structured document print module displays a print preview screen and during the display of the print preview arranges print data so as to fit into the number of pages specified by the user.

In the structured document print module a user interface is started simultaneously with the execution of the structured document print module . This leads to display of a print button for start of printing and a print preview button for display of a print preview in a window of the browser . is a view showing an example of the GUI screen with a print button and a print preview button displayed in the browser details of which will be described later.

An intermediate data extract section extracts the structured document from the browser as an intermediate data file at the time when the print button or the print preview button displayed by the user interface is pressed. The intermediate data file is data for printing. The intermediate data file which may be bit map data is constructed so that character information and graphic information can be held as vector data. For example a portable document format PDF an enhanced metafile format EMF etc. may be used as the intermediate data file.

A print layout section lays out the intermediate data file extracted by the intermediate data extract section to the sheet size according to print settings. Specifically elements objects such as text data and image data included in the intermediate data file are arranged in the area of the sheet size. The print settings including information such as the sheet size the resolution and the size of the print area in the sheet size are acquired from a printer driver via an OS . Note that the size of the print area is not necessarily acquired as a print setting but may be determined by referring to information on margins set for the sheet size.

A print preview section displays the intermediate data file laid out by the print layout section on the display section as a print preview. is a view showing an example of a GUI screen for print previewing.

In this embodiment during display of a print preview a button is presented for reducing the intermediate data so as to lay out the data in the number of pages specified by the user with no blank space left on the bottom portion of the print area of each page fitting the data to each page . Details of this screen will be described later.

A sheet quantity specifying section started at the pressing of the reduction button acquires the number of print sheets the number of print pages n in this embodiment in the current print settings from the print layout section . The sheet quantity specifying section starts a reduction rate analysis section specifying the number of sheets n 1 reduced from n by one sheet page .

The reduction rate analysis section started by the sheet quantity specifying section using the number of sheets n 1 as a parameter analyzes the reduction rate for reducing print data displayed on a print preview screen so as to fit into the specified number of sheets n 1. The page size of the n 1 sheets is calculated from the print settings the sheet size the size of the print area etc. acquired from the printer driver . The reduction rate is determined from the size of the print data and the page size.

By reducing the intermediate data at this reduction rate the intermediate data can be laid out in n 1 pages with no unnecessary blank space left in the height direction on the final page. Details of the analysis of the reduction rate will be described later.

A page width information detecting section analyzes the CSS file and tag attributes of the structured document and detects whether the page width of the structured document is variable or fixed. The reduction rate analysis section analyzes the reduction rate in a reduction method corresponding to the detection result. Details of the page width and the reduction method corresponding to the detection result will be described later.

In this embodiment the reduction rate analysis section analyzes the reduction rate in the reduction method corresponding to the detection result from the page width information detecting section . The print layout section lays out the intermediate data according to the analyzed reduction rate. In this way the layout of the print data fitting into a predetermined number of pages can be determined.

When receiving an instruction of starting printing from the user a print processing section changes the print settings as required according to the layout information of the print data laid out by the print layout section . The print processing section then executes drawing processing for the printer driver via the OS . The OS presents an application programming interface API for exchanging print setting data between the structured document print module and the printer driver and an API for performing drawing processing. The OS includes various types of control software such as a spooler system for managing print jobs and a port monitor that outputs printer commands to a port details of which are however omitted here. The printer driver generates print data according to the drawing processing executed by the print processing section converts the data to printer commands and transmits the converted printer commands to the printer . Thereafter the printer prints them on sheets.

As shown in the print image is displayed as fitted into seven sheets. shows a print preview screen presented when the reduction button is further pressed in the state shown in . As shown in the print image is displayed as fitted into six sheets. shows a print preview screen presented when the reduction button is further pressed in the state shown in . As shown in the print image is displayed as fitted into five sheets.

In this embodiment the reduction rate analysis section changes the orientation of the sheet and the number of columns as described above as required. The reduction rate analysis section acquires the size of the print area set in the print settings and judges whether the sheet orientation and the number of columns should be changed or not editable or not according to the acquired size of the print area. When performing the changes based on the judgment result the reduction rate analysis section determines the reduction rate of the intermediate data so that the data can fit into each of the plurality of pages allocated to one sheet.

Alternatively the print layout section may judge whether the sheet orientation and the number of columns should be changed. In this case the print layout section compares the size of the print data reduced at the reduction rate determined by the reduction rate analysis section to the size of the print area set in the print settings to judge whether the sheet orientation and the number of columns should be changed.

When determining to change the sheet orientation and the number of columns the reduction rate analysis section determines the reduction rate according to the size of one page out of a plurality of pages allocated to one sheet. The print layout section determines the layout according to the determined reduction rate.

The print preview section displays a print preview image as that shown in according to the determined layout and also notifies the print processing section of the sheet orientation and the number of columns changed as described above to allow the print processing section to change the print settings. In this way when the user issues an instruction of execution of printing in the state of printing corresponding to the print preview can be performed.

The layout of two columns in landscape orientation was described in this embodiment. Alternatively the configuration may be made to determine a layout with the smallest number of sheets and the smallest blank space among layouts of a total of six different combinations of the sheet orientation portrait or landscape and the number of columns one column two columns or three columns.

As described above every time the reduction button is pressed the reduction rate analysis section of the structured document print module calculates the reduction rate for reducing the print data to fit into the specified number of sheets n 1 changes the print layout settings and updates the print preview. At this time the reduction rate analysis section changes the sheet orientation and the number of columns as required and displays the resultant print preview.

In this embodiment the reduction button plays a role of accepting an instruction of page reduction by the user. Every time the button is pressed the print preview is displayed in a layout having pages reduced by one.

Thus by pressing the reduction button the user can lay out the print data in a desired number of pages easily with no unnecessary blank space left on the final page. Moreover as shown in the print settings the sheet orientation the number of columns are automatically changed in response to pressing of the reduction button indicating an instruction of reduction of the print data. Thus the user can lay out the print data appropriately without the necessity of special operation for changing the print settings.

In the examples shown in the print data is reduced every time the reduction button is pressed. Alternatively an enlargement button for enlarging the print data may be provided. In this case also every time the enlargement button is pressed the print data is enlarged increasing the number of pages by one each. It is also ensured that no blank space is left on the bottom portion of the final page.

The processing of the page width information detecting section will be described with reference to B A and B. The page width information detecting section detects page width information on whether the page width of the structured document is fixed or variable. The reduction rate analysis section analyzes the reduction rate using the detected page width information. is a view showing an example of the browser screen where the structured document having a fixed page width is displayed by the browser . shows a screen with the window size of the browser widened from that shown in . Since the page width of the structured document is fixed the page width of the structured document shown in and the page width thereof shown in are the same in the number of pixels.

As described above whether the page width is fixed or variable is already defined in the structured document and thus can be determined by analyzing the structured document. Specifically the document is displayed with its page width being fixed as shown in when the return position of a text portion of the structured document is fixed while it is displayed with its page width being variable as shown in when the return position varies. The page width information detecting section acquires the width attributes or styles of body tags and other tags of the structured document and detects whether the page width has been specified by a fixed value such as the number of pixels or specified by a variable value such as the proportion of the page width with respect to the window width of the browser based on the acquired information. Using this page width information the reduction rate analysis section analyzes the reduction rate required to fit the print data into the number of pages specified by the sheet quantity specifying section .

In the reduction of the print image to the print image the area of the image is reduced to about and the reduction rate is about 1 2. Strictly speaking the reduction rate is influenced by the size of characters the return position word wrapping presence absence of an image etc.

By contrast an image in represents a sheet of the structured document having a fixed page width at the time of printing in the initial settings. A print image is arranged in the image where the height of the print image is h. An image shows a page where the height of the print image is reduced to h 2 by the reduction rate analysis section . In the reduction of the print image to the print image the area of the image is reduced to about and the reduction rate is about . As in strictly speaking the reduction rate is influenced by the size of characters the return position word wrapping presence absence of an image etc.

As described above in reduction of the print image of the structured document having a variable page width when the reduction ratio of the print image in the height direction is r the reduction rate is about r. By contrast in reduction of the print image of the structured document having a fixed page width the reduction rate is about r. In this embodiment the reduction rate analysis section analyzes the reduction rate required to fit the print data into the number of pages specified by the sheet quantity specifying section using a method of calculating the reduction rate corresponding to the page width information.

The CPU calculates the reduction ratio r in the height direction required to fit print data of n sheets in the current print settings into n 1 sheets S . For example in in the initial state of the print image is displayed up to a half of the eighth page converted into 7.5 sheets . Therefore the reduction ratio r in the height direction for fitting the print data into seven sheets is calculated to be 7 7.5 approximately 0.93 .

In S the reduction rate analysis section acquires the size of the print data and also acquires the sheet size the size of the print area and the number of pages allocated to one sheet in the print settings from the print layout section . The reduction rate analysis section calculates the size of one page from the print settings and compares the size of the print data to the size of one page. From this the reduction rate analysis section can determine the number of pages of the print data laid out and the occupation of the content of the final page on the sheet. In this way it is possible to determine that the print data is laid out up to a half of the eighth sheet in the initial state.

The above determination processing may be performed not by the reduction rate analysis section but by the print layout section . In this case the reduction rate analysis section acquires the determination result from the print layout section in S.

Once determining the number of pages of the print data laid out and the area occupied by the print data on the final page as described above the reduction rate analysis section can calculate the reduction rate required to fit the print data into the predetermined number of pages as described above.

The CPU then acquires the page width information of the structured document from the page width information detecting section S and judges whether the page width of the structured document is fixed or variable based on the page width information S . The process proceeds to S if it is judged that the page width is fixed or to S if it is judged that the page width is variable.

First the case that the page width is judged to be fixed will be described. The CPU sets the reduction rate P as a variable and assigns the reduction ratio r in the height direction to the reduction rate P to calculate the actual number of pages when the reduction rate P is applied to the structured document S .

With the above assigning processing the print layout section reduces the print data according to the reduction ratio r to lay out the print data on pages having the size determined according to the print settings. The reduction rate analysis section checks the number of pages of the print data laid out in this way in S.

The reason for the above processing is that even if the reduction is made at the reduction ratio r calculated to lay out the print data in n 1 pages in S the print data actually fails to fit into n 1 pages in some cases. For example when a text or image object appears across pages such an object may be relocated on the next page to prevent the object from being divided between the pages. In this case even though the intermediate data is reduced at the reduction rate P and laid out the entire of the object appearing across pages will be shifted to the next page. As a result the number of pages may be n not n 1.

To solve the above problem the CPU determines the number of sheets actually required for printing when the reduction rate P is applied and determines whether the number of sheets is n 1 or not S . The process proceeds to S if the number of sheets is determined to be n 1 or to S if the number of sheets is determined not to be n 1. If the number of sheets is determined not to be n 1 i.e. if it is n the CPU calculates a reduction ratio r required to fit the print data reduced at the reduction rate P into the number of sheets n 1. Using the calculated ratio as the new reduction rate P S the CPU performs the processing of S again. As described above for a fixed page width the CPU repeats the processing steps S to S until the number of sheets becomes n 1 to obtain the reduction rate P with which the print data can fit into n 1 sheets. The CPU confirms the reduction rate P with which the print data can fit into n 1 sheets S and then terminates this processing.

In S again if it is determined that the page width is variable the process proceeds to S. The CPU assigns r to the reduction rate P to calculate the actual number of pages when the reduction rate P is applied to the structured document S . In S as in S the number of pages is calculated considering an event of relocating an object appearing across pages to the next page.

The CPU determines the number of sheets actually required for printing when the reduction rate P is applied and determines whether the number of sheets is n 1 or not S . The process proceeds to S if the number of sheets is determined to be n 1 or to S if the number of sheets is determined not to be n 1. If the number of sheets is determined not to be n 1 i.e. if it is still n the CPU calculates a reduction ratio r required to fit the print data reduced at the reduction rate P into n 1 sheets. Using the calculated ratio as the new reduction rate P S the CPU performs the processing of S again. As described above for a variable page width the CPU repeats the processing steps S to S until the number of sheets becomes n 1 to obtain the reduction rate P with which the print data can fit into n 1 sheets. The CPU confirms the reduction rate P with which the print data can fit into n 1 sheets S and then terminates this processing.

Using the reduction rate determined by the reduction rate analysis section as described above the print layout section lays out the intermediate data. In this way the intermediate data laid out in n pages can be laid out to fit into n 1 pages with no blank space left in the height direction on the final page.

In this layout the print layout section simply reduces the length and width of the print data when the page width is fixed. When the page width is variable however it performs editing processing on the intermediate data such as changing the return position of a text.

In S whether the sheet orientation and the number of columns should be changed as shown in may be judged. More specifically in S the reduction rate analysis section acquires the size of the print data and the print settings for calculation of the page size from the print layout section as described above. At this time the reduction rate analysis section compares the size of the print data in the page width direction to the width of the page to calculate the blank space in the page width direction. When having judged that the sheet orientation and the number of columns should be changed as shown in the reduction rate analysis section calculates a new page size according to the print settings and determines the reduction rate so that the print data reduced at this rate can fit into the page size.

As described above while r is used as the reduction rate in S r is used as the reduction rate in S. The reason for this is that as shown in while the reduction rate of the print image is reflected as it is in the length direction of the print image when the page width of the structured document is fixed it is applied to both the width direction and the length direction of the print image when the page width is variable.

In this embodiment the number of sheets required for printing is reduced stepwise by pressing the reduction button repeatedly. Alternatively it may be reduced at one time by specifying a given number of sheets. In this case with no need to specify the number of sheets a plurality of times until a desired number of sheets is reached the number of steps to be performed by the user can be further reduced.

As already described in relation to the reduction rate analysis section determines the sheet orientation and the number of columns as required and calculates a new page size. This layout processing is especially effective when the structured document having a fixed page width is reduced. When the page width is fixed as in the case shown in the higher the reduction rate the larger the right side blank portion becomes. By changing the sheet orientation and the layout however such a right side blank portion can be eliminated and also the number of sheets can be reduced although the reduction rate is unchanged.

Another embodiment will be described where print data is laid out at a specified reduction rate and further laid out in a different sheet orientation in a different number of columns as required to print the print data. The configuration of the system and the configuration of the PC in this embodiment are the same as those in .

A print layout section like the print layout section in lays out an intermediate data file extracted by the intermediate data extract section to the sheet size according to the print settings. Also when the reduction rate is specified by a reduction rate specifying section to be described later the print layout section lays out the intermediate data reduced according to the specified reduction rate to the sheet size. At this time the print layout section calculates the numbers of sheets required when the specified reduction rate is applied for a plurality of sheet orientations and layouts and arranges the print data in the sheet orientation and in the number of pages in one sheet with which the number of sheets is smallest. At this time the print layout section determines the sheet orientation and the number of pages in one sheet with which the number of sheets is smallest by calculating the blank space left when the print data is arranged according to the various types of layouts. The blank space can be calculated from the print settings the sheet size the size of the print area in the sheet size and the size of the print data.

The print preview section displays the intermediate data file laid out by the print layout section on the display section as a print preview.

In this embodiment the print preview screen has the slider bar with which the user can specify the reduction rate of the print data displayed on the print preview screen in units of 1 . The reduction rate specifying section detects the reduction rate specified by the user with the slider bar. The print processing section the OS and the printer driver are the same as those described with reference to .

Next the operation of the reduction rate specifying section and the print layout section in this embodiment will be described with reference to . shows a thumbnail display on the print preview screen . In eight sheets are shown on the print preview screen . shows a print preview screen presented when a reduction rate of 66 is specified with the slider bar in the state shown in . In the print image is displayed in five sheets.

As described above in this embodiment when the reduction rate is specified with the slider bar the reduction rate specifying section notifies the print layout section of the reduction rate. The print layout section selects from a plurality of sheet orientations and layouts the sheet orientation and the layout with which the number of sheets is smallest at the specified reduction rate and displays the print preview of this layout.

In the embodiments described above once the user gives an instruction for page increase decrease the number of pages is determined in response to the instruction and the print data is laid out to fit into the determined number of pages. Thus by giving an instruction so as to obtain a desired number of pages the user can have the print data laid out to fit into the specified number of pages. In this way the user can lay out the data based on the structured document appropriately and easily.

In the above embodiments the user gives an instruction of increasing decreasing the page from the number of pages of the print data currently arranged. Alternatively the user may specify the number of pages before arrangement of the print data in pages to arrange the print data to fit into the specified number of pages. Although the print data is reduced in the above embodiments it may be enlarged when the number of pages is to be increased.

The present invention is not limited to the case of enlarging reducing the print data when the print data is already arranged in pages but the size of the print data may be determined so as to fit into the number of pages specified by the user at the time of preparation of the print data. In this case by specifying the number of pages the user can prepare print data according to the specified number of pages easily and appropriately.

Also the present invention is not limited to the case of displaying a print preview of the print data having the number of pages specified by the user but in response to the specification of the number of pages by the user the print data having the specified number of pages may be prepared and the resultant print data may be printed without display of its print preview. Furthermore the present invention is not limited to the case of preparing print data so as to fit into the number of pages specified by the user but when the print data exceeds the number of pages specified by the user the print data may be arranged to fall within the specified number of pages. In other words by specifying the upper limit of the number of pages the user can have the print data printed so as to fall within the upper limit number of pages. In the above embodiments printing of data laid out in pages was described as an example. The present invention is not limited to this but displaying of data on a display device and various types of output processing such as storing data in memory may be performed.

Aspects of the present invention can also be realized by a computer of a system or apparatus or devices such as a CPU or MPU that reads out and executes a program recorded on a memory device to perform the functions of the above described embodiment s and by a method the steps of which are performed by a computer of a system or apparatus by for example reading out and executing a program recorded on a memory device to perform the functions of the above described embodiment s . For this purpose the program is provided to the computer for example via a network or from a recording medium of various types serving as the memory device e.g. computer readable medium .

While the present invention has been described with reference to exemplary embodiments it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.

This application claims the benefit of Japanese Patent Application No. 2011 192032 filed Sep. 2 2011 which is hereby incorporated by reference herein in its entirety.

