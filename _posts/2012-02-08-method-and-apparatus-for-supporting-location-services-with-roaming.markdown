---

title: Method and apparatus for supporting location services with roaming
abstract: Techniques for supporting location services with roaming are described. A method of supporting location services (LCS) for a mobile station roaming from a home network and communicating with a visited network includes receiving a domain name system (DNS) query at a DNS of the home network from a packet data serving node (PDSN) of the home network. The method also includes sending to the mobile station from the DNS of the home network an address of a serving position determining entity (S-PDE) in the visited network.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08548500&OS=08548500&RS=08548500
owner: QUALCOMM Incorporated
number: 08548500
owner_city: San Diego
owner_country: US
publication_date: 20120208
---
This application is a continuation of and claims priority to U.S. patent application Ser. No. 11 564 680 filed on Nov. 29 2006 which claims priority to U.S. Provisional Application No. 60 741 324 filed Nov. 30 2005 both of which are incorporated herein by reference in their entireties.

The present disclosure relates generally to communication and more specifically to techniques for supporting location services.

It is often desirable and sometimes necessary to know the location of a mobile station e.g. a cellular phone. The terms location and position are synonymous and are used interchangeably. For example a user may utilize the mobile station to browse through a website and may click on location sensitive content. The location of the mobile station may then be determined and used to provide appropriate content to the user. There are many other scenarios in which knowledge of the location of the mobile station is useful or necessary.

The mobile station may be provisioned such that it can obtain location services from a home network with which the user has a service subscription. The mobile station may communicate with various network entities in the home network in order to determine the location of the mobile station whenever needed. The mobile station may roam to other networks with which the user has no service subscription. A major challenge is to provide location services to the mobile station in such roaming scenario.

Techniques for supporting location services LCS with roaming are described herein. In an aspect a mobile station interacts with a home mobile positioning center H MPC in a home network for location services even when the mobile station is roaming. The mobile station may communicate with a visited network for a data session and receive a request for the location of the mobile station e.g. from an application resident on the mobile station an MS resident application an LCS client or the H MPC. The mobile station may then send first information to the H MPC. The first information may indicate the current network location of the mobile station and may be dependent on the radio technology used by the visited network. For example the first information may comprise a system identifier SID and a network identifier NID of the visited network or some other information obtained from the visited network. A serving position determining entity S PDE in the visited network may be determined based on the first information. Depending on the selected positioning method the mobile station may receive from the H MPC a an address of the S PDE and may then communicate with the S PDE for positioning of the mobile station or b a position estimate of the mobile station which may be determined by the S PDE based on the first information.

In another aspect the H MPC may receive a request for the location of the mobile station e.g. from the MS resident application or the LCS client receive the first information from the mobile station and determine a serving mobile positioning center S MPC in the visited network based on the first information. The H MPC may then receive second information from the S MPC and send the second information to the mobile station. Depending on the selected positioning method the second information may comprise the S PDE address or the position estimate. The H MPC may also perform other functions such as authorization handoff etc.

In yet another aspect the mobile station may receive a request for the location of the mobile station and may send a query for an address of an S PDE to a domain name system DNS server. The mobile station may include a domain name formed based on the SID and NID in the query sent to the DNS server. The mobile station may receive the address of the S PDE from the DNS server and may then communicate with the S PDE for positioning of the mobile station.

The techniques described herein may be used for various wireless networks such as Code Division Multiple Access CDMA networks Time Division Multiple Access TDMA networks Frequency Division Multiple Access FDMA networks Orthogonal FDMA OFDMA networks etc. A CDMA network may implement a radio technology such as cdma2000 Wideband CDMA W CDMA etc. cdma2000 covers IS 2000 IS 856 and IS 95 standards. A TDMA network may implement a radio technology such as Global System for Mobile Communications GSM Digital Advanced Mobile Phone System D AMPS etc. W CDMA and GSM are described in documents from an organization named 3rd Generation Partnership Project 3GPP . cdma2000 is described in documents from an organization named 3rd Generation Partnership Project 2 3GPP2 . 3GPP and 3GPP2 documents are publicly available. For clarity the techniques are described below for 3GPP2 networks.

Mobile station may be stationary or mobile and may also be called a user equipment UE a terminal a subscriber unit a station etc. Mobile station may be a cellular phone a personal digital assistant PDA a wireless device a handset a laptop computer a telemetry device a tracking device etc. Mobile station may communicate with a radio access network RAN in visited network to obtain communication services such as voice video packet data broadcast messaging etc. Mobile station may also receive signals from one or more satellites which may be part of the United States Global Positioning System GPS the European Galileo system the Russian Glonass system or some other satellite positioning system. Mobile station may measure signals from satellites and or signals from base stations in RAN and may obtain pseudo range measurements for the satellites and or timing measurements for the base stations. The pseudo range measurements and or timing measurements may be used to derive a position estimate of mobile station using one or a combination of positioning methods such as assisted GPS A GPS standalone GPS Advanced Forward Link Trilateration A FLT Enhanced Observed Time Difference E OTD Observed Time Difference Of Arrival OTDOA Enhanced Cell ID Cell ID etc.

RAN provides radio communication for mobile stations located within the coverage of the RAN. RAN may include base stations base station controllers BSCs and or other network entities that support radio communication. A mobile switching center MSC supports circuit switched calls and also routes Short Message Service SMS messages. A message center MC supports SMS and is responsible for storing relaying and forwarding SMS messages for mobile stations. A packet control function PCF supports packet data exchanges between RAN and a packet data serving node PDSN . PDSN supports packet switched calls for mobile stations and is responsible for the establishment maintenance and termination of data sessions. An inter working function IWF may be used in place of PDSN in some wireless networks e.g. IS 95 networks.

Serving position determining entities S PDEs and support positioning for mobile stations and may serve different geographic areas. Positioning refers to a process to measure compute a geographic position estimate of a target device. A position estimate may also be referred to as a location estimate a position fix a fix etc. S PDEs and may exchange messages with mobile stations for positioning calculating position estimates supporting delivery of assistance data to the mobile stations performing functions for security etc. Serving mobile positioning centers S MPCs and perform various functions for location services and may serve different geographic areas. S MPCs and may support subscriber privacy authorization authentication roaming support charging billing service management position calculation etc. Mobile station may be served by S MPC and S PDE initially and may thereafter be handed off to S PDE or to S MPC and S PDE when roaming. A home MPC H MPC in home network supports location services for mobile stations in the home network and may perform various functions as described below. H MPC may provide information to S MPCs and to support positioning and may receive location information e.g. position estimates PDE addresses etc. from the S MPCs.

A home location register visitor location register HLR VLR stores registration information for mobile stations that have registered with visited network . A domain name system DNS server translates domain names e.g. www.domain name.com into Internet Protocol IP addresses e.g. 204.62.131.129 which are used by entities to communicate with each other via an IP network. DNS server receives queries for IP addresses of domain names determines the IP addresses for these domain names and sends responses with the IP addresses to the requesting entities.

Applications APPs and may comprise LCS clients and or higher layer applications. An LCS client is a function or an entity that requests location information for LCS targets. An LCS target is a mobile station whose location is being sought. In general an LCS client may reside in a network entity or a mobile station or may be external to both. LCS client may communicate with H MPC to obtain location information for mobile station .

Home network includes H MPC a PDSN a DNS server a home authentication authorization and accounting H AAA entity a HLR a home PDE H PDE and a BSA that may operate in similar manners as the corresponding network entities in visited network . PDSN may be a home agent HA with which mobile station has registered and may be responsible for forwarding packets to mobile station . The network entities in home network serve mobile stations communicating with home network . The network entities in home network may communicate with one another and with external entities via a data network which may be an IP network the Internet or some other network.

Third party network may include a BSA server that may couple to PDEs in other networks not shown in . The entities in requesting network and third party network may communicate with the entities in visited network and home network via a data network which may be an IP network or some other network.

In the following description visited network may refer to visited network in and or visited network in . Home network may refer to home network in and or home network in . Networks and may support a user plane location architecture. A user plane is a mechanism for carrying messages signaling for higher layer applications and employs a user plane bearer which is typically implemented with protocols such as User Datagram Protocol UDP Transmission Control Protocol TCP and Internet Protocol IP all of which are known in the art. Messages signaling supporting location services and positioning may be carried as part of data from a network perspective in a user plane architecture.

Networks and may implement any user plane architecture such as V1 or V2 user plane from CDMA Development Group CDG X.S0024 user plane from 3GPP2 Secure User Plane Location SUPL from Open Mobile Alliance OMA etc. X.S0024 is applicable for 3GPP2 networks. SUPL is applicable for 3GPP and 3GPP2 networks. V2 user plane is described in a document 80 V6410 2NP entitled Location Based Services V2 System Specification Jan. 19 2005. All of the user plane architectures are described in publicly available documents.

In the description herein the term MPC generically refers to an entity that supports location services the term PDE generically refers to an entity that supports positioning the term mobile station generically refers to an entity that may communicate with an MPC for location services and or a PDE for positioning and the term LCS client generically refers to an entity that requests the location of a mobile station. An MPC may be an MPC in V1 and V2 user plane a SUPL Location Center SLC in SUPL a Position Server PS in X.S0024 a Gateway Mobile Location Center GMLC in 3GPP etc. A PDE may be a PDE in V1 and V2 user plane a SUPL Positioning Center SPC in SUPL a Serving Mobile Location Center SMLC or a Standalone SMLC SAS in 3GPP etc. A mobile station may be a mobile station in V1 and V2 user plane a SUPL enabled terminal SET in SUPL a user equipment UE in 3GPP etc. The MPC PDE mobile station and LCS client may also be referred to by other names in other networks and other location architectures.

Networks and may support LCS for roaming mobile stations based on trusted and or non trusted models. Table 1 gives short descriptions for the trusted and non trusted models.

For both trusted and non trusted models LCS may be requested by Wireless Application Protocol WAP pull applications network initiated applications MS resident applications etc. WAP pull applications are applications that pull data from a network. Network initiated applications are applications that are resident on the network side or interact with the network e.g. LCS client . The MS resident applications are applications that reside on mobile station and may be Binary Runtime Environment for Wireless BREW applications Java applications etc.

Various location sessions may be supported such as single fix tracking fix gpsOne positioning cell sector positioning etc. Single fix refers to the return of a single position fix for a target mobile station to an LCS client. Tracking fix refers to the return of multiple position fixes for a target mobile station to an LCS client e.g. periodically. A tracking fix may be initiated by an LCS client or a mobile station and may be canceled by the LCS client or mobile station. The mobile station may also be handed off from one S MPC to another S MPC and or from one S PDE to another S PDE during a tracking fix.

Various positioning methods types may also be supported such as gpsOne positioning cell sector positioning etc. gpsOne positioning refers to a satellite based positioning method such as GPS A GPS etc. Cell sector positioning refers to a network based positioning method such as A FLT E OTD OTDOA Enhanced Cell ID Cell ID etc.

Various message flows may be used for different location sessions initiated by different applications in the trusted and non trusted models. A message flow may also be referred to as a call flow a process etc. Some example message flows are described below. In the following message flows mobile station may have a data session with home network using Mobile IP Session Initiation Protocol SIP Layer 2 Tunneling Protocol L2TP or some other protocol that supports packet data roaming For each message flow service authorization may be performed for the non trusted model and may be omitted for the trusted model.

In general mobile station may send any information that can provide the current network location of mobile station . This network location information may be dependent on radio technology. For example a SID a NID and or a base station identifier BaseID may be used for IS 2000 Releases 0 and A which are commonly referred to as CDMA2000 1X. A sector identifier SectorID may be used for IS 856 which is commonly referred to as CDMA2000 1xEV DO. A mobile country code MCC a mobile network code MNC a location area code LAC and or a cell identity CI may be used for GSM. An MCC an MNC and or a UTRAN cell identity UC ID may be used for W CDMA. An access point identifier AP ID or a Medium Access Control MAC address may be used for WLAN. The network location information may also comprise location coordinates e.g. latitude and longitude coordinates of a base station in a cellular network an access point in a WLAN or some other transmitting station in a wireless network. For clarity much of the description below assumes the use of SID and NID for the network location information.

H MPC receives the SPPReq message and performs authorization if applicable to ensure that this particular user and LCS client are authorized to obtain the location being requested step e . H MPC may use the QoS information in the SPPReq message and LCS client profile to determine whether a gpsOne position is appropriate as opposed to either a cached position or a cell sector based position . H MPC determines that mobile station is roaming and selects a suitable S MPC which in this example is S MPC based on the SID NID information. H MPC then sends to S MPC a Roaming Request message that may include information such as the application type an International Mobile Subscriber Identifier IMSI of mobile station gpsOne positioning type the SID NID a PDE access duration etc.

S MPC receives the Roaming Request message with instructions to do gpsOne positioning from H MPC and determines a suitable S PDE which in this example is S PDE based on the SID NID information. S MPC then sends a GPOSREQ message that invokes and seeds S PDE such that the S PDE will accept an incoming mobile originated MO IS 801 positioning session from mobile station step f . An IS 801 positioning session is a session for satellite based positioning e.g. to obtain assistance data a position estimate etc. and is also referred to as an IS 801 session a gpsOne session a GPS session etc. The GPOSREQ message may include information such as the IMSI gpsOne positioning type PDE access duration etc. S PDE returns a gposreq message containing a position pending acknowledgment for the GPOSREQ message step g . S MPC receives the gposreq message from S PDE and sends to H MPC a Roaming Request Acknowledgment message with the address of S PDE step h . H MPC receives the Acknowledgment from S MPC and sends an SPPRes message instructing mobile station to perform an IS 801 session and including the address of S PDE step i .

Mobile station and S PDE then perform an MO IS 801 session step j . A position estimate of mobile station is obtained and made available to the mobile station at the end of the IS 801 session. S PDE then sends a gposreq message that informs S MPC that the IS 801 session terminated normally and includes the position estimate step k .

S MPC sends to H MPC a Location Report message that reports successful positioning and provides the position estimate step l . H MPC may store the position estimate which may be used later as a cached position for a subsequent request. Mobile station then re requests the location sensitive URL and provides the position estimate along with the request step m . LCS client downloads the requested content to mobile station step n .

The messages between the various entities are described in the following publicly available document 

S MPC receives the Roaming Request message with instructions to do cell sector positioning from H MPC and sends to S PDE a GPOSREQ message containing the cell sector positioning type etc. step f . S PDE responds to S MPC with a gposreq message containing a cell sector based position estimate for mobile station step g . S MPC sends to H MPC a Location Report message that reports successful positioning and includes the position estimate step h . H MPC sends to mobile station an SPPRes message containing the position estimate step i . Steps j and k of message flow are the same as steps m and n respectively of message flow in .

In general mobile station may send a location specific DNS query to DNS server V DNS in visited network as shown in or to DNS server H DNS in home network not shown in . For the V DNS option DNS server may be assigned by PDSN FA during PPP negotiation for data call setup. Mobile station may send a DNS query to DNS server which may recognize and resolve the location specific URL and return the IP address of an S PDE in visited network to mobile station . For the H DNS option mobile station may send a DNS query which may be re directed by home agent to DNS server . DNS server may resolve the location specific URL and return the S PDE IP address to mobile station . For both DNS options the SID NID information may be omitted from the DNS query if visited network has one PDE or designates one PDE to serve roaming mobile stations.

H MPC determines that mobile station is roaming and selects S MPC based on the SID NID information. H MPC then sends to S MPC a Roaming Request message that may include information such as the CI IMSI SID NID PDE access duration etc. step d . S MPC receives the Roaming Request message with instructions to do gpsOne positioning and sends a GPOSREQ message that invokes and seeds S PDE step e . S PDE returns a gposreq message containing a position pending acknowledgment step f . S MPC receives the gposreq message and sends to H MPC a Roaming Request Acknowledgment message with the address of S PDE step g .

H MPC receives the Acknowledgment message from S MPC and sends to mobile station an SPPRes message instructing mobile station to perform an IS 801 session and including the address of S PDE step h . Mobile station and S PDE perform an MO IS 801 session to obtain a position estimate of the mobile station step i . S PDE then sends the position estimate in a gposreq message to S MPC step j . S MPC forwards the position estimate in a Location Report message to H MPC step k . H MPC then provides the position estimate in an MLP Location Immediate Answer LIA message to LCS client step l .

After successful authorization of LCS client if applicable H MPC sends to mobile station an MT SMS Positioning Request message indicating an IS 801 session and including information such as notification and verification procedures a CI the number of fixes N the time interval between fixes T the H MPC ID etc. step c . Mobile station receives the SMS message and if applicable prompts the user for consent. Mobile station then sends to H MPC an SPPReq message that serves as a response to the MT SMS message in step c and may include information such as the user consent or lack of consent CI IMSI SID NID session duration etc. step d . The session duration is equal to the number of fixes times the interval between fixes.

H MPC determines that mobile station is roaming and selects S MPC based on the SID NID information. H MPC then sends to S MPC a Roaming Request message with information used by S MPC to support a tracking session with gpsOne positioning step e . This information may include the CI IMSI SID NID session duration stop time etc. S MPC receives the Roaming Request message with instructions to do gpsOne positioning and sends to S PDE a GPOSREQ message that invokes and seeds S PDE and includes information e.g. PDE access duration for the tracking session step f . S PDE returns a gposreq message containing an acknowledgment step g . S MPC receives the gposreq message and sends to H MPC a Roaming Request Acknowledgment message with the address of S PDE step h .

H MPC sends an MLP TL Reporting Answer to LCS client step i which may occur after step b if user consent is not needed or after step d if user consent is needed and obtained. After receiving the Acknowledgment in step h H MPC sends to mobile station an SPPRes message instructing mobile station to perform an IS 801 session and including the address of S PDE step j . Mobile station and S PDE perform an MO IS 801 session e.g. to download assistance data to mobile station step k . S PDE then provides relevant information on the IS 801 session completion in a gposreq message to S MPC step l . S MPC forwards the information on session completion in a Session Status Report message to H MPC step m .

For the first position fix mobile station provides location information in a Position Report message to H MPC step n . H MPC returns a Position Report Response to acknowledge the Position Report message step o . H MPC reports the location of mobile station via an MLP TL Report message sent to LCS client step p . For the second position fix which occurs at interval T later steps n o and p are repeated as steps q r and s respectively. Mobile station and S PDE may perform additional MO IS 801 sessions whenever needed to download assistance data and to provide updated location information. Steps k l and m may be repeated as steps t u and v respectively. Each additional fix may be achieved by repeating steps n o and p. For the last position fix steps n o and p are repeated as steps w x and y respectively. MS assisted tracking may be used for cases when the time between fixes is greater than a particular interval e.g. 1800 seconds .

Mobile station may have a pending network initiated tracking session and may roam outside the coverage of the current S MPC and S PDE . H MPC may receive from S MPC a Session Status Report message indicating that mobile station is outside the serving area of S PDE . H MPC may then send to mobile station a Position Report Response message containing information on a new S PDE that can serve mobile station at its current location.

At a later time mobile station and S PDE perform another MO IS 801 session that fails because mobile station is outside the serving area of S PDE step q . S PDE then informs S MPC of the IS 801 session failure by sending a gposreq message with an error reason of S PDE out of serving area which means that mobile station is outside the serving area of S PDE step r . S MPC reports the status of the IS 801 session to H MPC via a Session Status Report message that contains the IS 801 session information and the error reason indicated by S PDE step s . H MPC determines that mobile station is roaming and is outside the serving area of S PDE step t .

After interval T has passed mobile station sends a Position Report message to H MPC step u . H MPC uses the SID NID information in the Position Report message to determine a new S MPC which in this example is S MPC . H MPC then triggers roaming procedures. To determine a new S PDE H MPC sends to S MPC a Roaming Request message with information used by S MPC to support the remaining tracking session with gpsOne positioning step v . This information may include the stop time remaining session duration etc. S MPC receives the Roaming Request message with instructions to do gpsOne positioning and sends to a new S PDE which in this example is S PDE a GPOSREQ message that invokes S PDE and includes information e.g. PDE access duration for the remaining tracking session step w . The GPOSREQ message also seeds S PDE such that it will accept an incoming MO IS 801 session for the tracking session. S PDE returns a gposreq message containing an acknowledgment step x . S MPC receives the gposreq message and sends to H MPC a Roaming Request Acknowledgment message with the address of S PDE step y .

H MPC then sends to mobile station a Position Report Response message that acknowledges the Position Report message in step u and includes information for new S PDE step z . H MPC reports the location of mobile station in an MLP TL Report message to LCS client step aa . H MPC also sends to original S MPC a Location Reporting Cancel message to inform S MPC that it should clear resources allocated to the tracking session step bb . S MPC receives the Location Reporting Cancel message and sends a CANCEL message to original S PDE step cc which returns a cancel message to S MPC step dd . S MPC then sends to H MPC a Location Report message that acknowledges the Location Reporting Cancel message step ee . Mobile station may perform an MO IS 801 session with new S PDE step ff . S PDE provides information on the IS 801 session completion to S MPC . The remaining tracking session may proceed as described above for message flow in albeit with new S MPC and new S PDE .

Mobile station may have a pending network initiated tracking session and may roam outside the coverage of the current S PDE but may remain within the coverage of S MPC . H MPC may then send information on a new S PDE that can serve mobile station at its current location.

H MPC determines that mobile station is roaming and selects S MPC based on the SID NID information. H MPC then sends to S MPC a Roaming Request message with information used by S MPC to support a tracking session with cell sector positioning step g . S MPC receives the Roaming Request message with instructions to do cell sector positioning and sends to S PDE a GPOSREQ message with information for cell sector positioning step h . S PDE returns a gposreq message containing a cell sector based position estimate for mobile station step i . S MPC forwards the position estimate in a Location Report message to H MPC step j . H MPC provides the position estimate for the first fix in an MLP TL Report message to LCS client step k .

For the second position fix after interval T has passed mobile station sends to H MPC a Position Report message containing information such as the current SID NID BASE ID etc. step l . H MPC returns a Position Report Response message that acknowledges the Position Report message step m . Subsequent steps n through r for the second fix are the same as steps g through k respectively for the first fix. Each additional fix may be achieved by repeating steps l through r. The tracking session continues until the last fix is reported in steps s through y. To S MPC and S PDE the tracking fix with cell sector positioning is achieved with a series of single fixes.

LCS client may terminate message flow by sending an MLP TL Reporting Stop Request message as shown in or some other message. Mobile station may terminate message flow by sending an MT SMS Cancel Tracking Session message as shown in or some other message. LCS client or mobile station may also terminate message flow in similar manner as for a message flow for tracking fix of a mobile station within an area served by its H MPC.

H MPC determines that mobile station is roaming and selects S MPC based on the SID NID information. H MPC then sends to S MPC a Roaming Request message that may include information such as the IMSI SID NID cell sector positioning type etc. step d . S MPC receives the Roaming Request message with instructions to do cell sector positioning and sends a GPOSREQ message to S PDE step e . S PDE returns a cell sector based position estimate of mobile station in a gposreq message to S MPC step f . S MPC forwards the position estimate in a Location Report message to H MPC step g . H MPC then sends the position estimate in an SPPRes message to mobile station step h . The gpsOne API then returns the position estimate to MS resident application step i .

H MPC sends to mobile station an SPPRes message instructing mobile station to perform an IS 801 session and including the address of S PDE step h . Mobile station and S PDE perform an MO IS 801 session and a position estimate is made available to mobile station at the end of the IS 801 session step i . The IS 801 session may be skipped if MS based positioning is used and mobile station has current ephemeris information for GPS satellites. S PDE then informs S MPC that the IS 801 session terminated normally step j . S MPC may return a Session Status Report message to the H MPC to report the status of the IS 801 session step k .

The gpsOne API returns the position estimate as the first fix to MS resident application step l . After interval T the gpsOne API returns the second fix to MS resident application step m . Mobile station and S PDE may perform additional MO IS 801 sessions whenever needed until the last fix is completed step n . A position estimate may be made available to mobile station at the end of each IS 801 session. After each additional MO IS 801 session S PDE may inform S MPC that the IS 801 session terminated normally step o and S MPC may return a Session Status Report message to H MPC to report the status of the IS 801 session step p . The gpsOne API returns a position estimate for the last fix to MS resident application step q .

Mobile station may have a pending MS resident tracking session and may roam outside the coverage of the current S MPC and S PDE . Upon detecting IS 801 session failure due to PDE handoff error condition H MPC may send an MT SMS message to refresh the MS resident tracking session. Upon receiving this MT SMS message mobile station may send a new SPPReq message to H MPC for updated information on a new S PDE and may then continue the tracking fix via the new S PDE.

At a later time mobile station and S PDE perform another MO IS 801 session that fails because mobile station is outside the serving area of S PDE step n . S PDE then informs S MPC of the IS 801 session failure by sending a gposreq message with an error reason set to S PDE out of serving area step o . S MPC then reports the status of the IS 801 session to H MPC via a Session Status Report message that contains the IS 801 session information and the error reason indicated by S PDE step p . H MPC detects that a PDE handoff is required and sends to mobile station an MT SMS message with a cause code set to PDE out of serving area step q . H MPC also cancels the tracking session with S MPC and S PDE via steps r through u which are the same as steps d through g respectively of message flow in .

Mobile station receives the MT SMS message and sends to H MPC an SPPReq message with information e.g. IMSI SID NID remaining duration etc. used for the remaining tracking session step v . H MPC uses the SID NID information in the SPPReq message to determine that mobile station is roaming and to select a new S MPC which in this example is S MPC . H MPC then sends to S MPC a Roaming Request message with information e.g. remaining session duration etc. used by S MPC to support the remaining tracking session with gpsOne positioning step w . S MPC receives the Roaming Request message with instructions to do gpsOne positioning and sends to a new S PDE which in this example is S PDE a GPOSREQ message that invokes and seeds S PDE for the tracking session step x . S PDE returns a gposreq message containing an acknowledgment step y . S MPC receives the gposreq message and sends to H MPC a Roaming Request Acknowledgment message with the address of S PDE step z .

After receiving the Acknowledgment message H MPC sends an SPPRes message instructing mobile station to perform an IS 801 session and including the address of S PDE step aa . Mobile station and S PDE perform an MO IS 801 session block bb . After completing the IS 801 session S PDE informs S MPC that the IS 801 session terminated normally step cc . S MPC may return a Session Status Report message to H MPC to report the status of the IS 801 session step dd . For each subsequent fix the gpsOne API returns a current position estimate to MS resident application step ee . The remaining tracking session may proceed in the normal manner as described for message flow albeit with new S MPC and new S PDE .

Mobile station may have a pending MS resident tracking session and may roam outside the coverage of the current S PDE but may remain within the coverage of the current S MPC . H MPC may send an MT SMS message to refresh the MS resident tracking session and mobile station may send a new SPPReq message for updated information on a new S PDE.

Mobile station receives an MT SMS message in step q and sends to H MPC an SPPReq message with information e.g. IMSI SID NID remaining duration etc. used for the remaining tracking session step r . H MPC uses the SID NID information in the SPPReq message to determine that mobile station is roaming and to select S MPC . H MPC then sends to S MPC a Roaming Request message with information e.g. remaining session duration etc. used by S MPC to support the remaining tracking session with gpsOne positioning step s . S MPC receives the Roaming Request message with instructions to do gpsOne positioning and sends to a new S PDE which in this example is S PDE a GPOSREQ message that invokes and seeds S PDE for the remaining tracking session step t . S PDE returns a gposreq message containing an acknowledgment step u . S MPC receives the gposreq message and sends to H MPC a Roaming Request Acknowledgment message with the address of S PDE step v .

After receiving the Acknowledgment message H MPC sends an SPPRes message instructing mobile station to perform an IS 801 session and including the address of S PDE step w . S MPC sends a CANCEL message to release the tracking session with the previous S PDE step x which returns a cancel message to S MPC step y . Steps z through cc of message flow are the same as steps bb through ee of message flow in . The remaining tracking session may proceed in the normal manner albeit with new S PDE .

Message flows through show various timers T through T that may be used for different transactions or message pairs. Each timer is shown by a heavy dashed line from the point event where the timer is started to the point event where the timer is stopped. Appropriate action e.g. retry action terminate action clear resources send notification etc. may be taken if a response or acknowledgement is not received by the time the timer expires. Any suitable duration may be used for each timer.

Home network may support V1 user plane location and visited network may support V2 user plane location. The following message flows cover the case in which mobile station roams from home network with V1 user plane location to visited network with V2 user plane location. In these message flows H MPC and S MPC may use V1 MPC MPC interface and S MPC and S PDE within visited network may use V2 E5 interface.

S MPC sends a GPOSREQ message that invokes and seeds S PDE and may include information such as the IMSI gpsOne positioning type PDE access duration etc. step i . S PDE returns a gposreq message to acknowledge the GPOSREQ message step j . Mobile station and S PDE perform an MO IS 801 session and a position estimate of mobile station is obtained and made available to the mobile station at the end of the IS 801 session step k . S PDE then sends to S MPC a gposreq message indicating that the IS 801 session terminated normally and including the position estimate step l . S MPC sends the position estimate in a Location Report message to H MPC which may store the position estimate for later use step m . Steps n and o are the same as steps m and n respectively of message flow .

H MPC sends to mobile station an MT SMS message instructing mobile station to perform an IS 801 session and including the address and port number of S PDE step i . If verification is required then the user is prompted for permission step j . Mobile station sends to H MPC an MO SMS message with information such as user consent or lack of consent SID NID etc. step k . Mobile station and S PDE perform an MO IS 801 session step l . S PDE then sends to S MPC a gposreq message indicating that the IS 801 session terminated normally and including a position estimate of mobile station step m . S MPC forwards the position estimate in a Location Report message to H MPC step n . H MPC provides the position estimate to LCS client step o .

If an IS 801 session is appropriate then H MPC checks the SID NID information to determine if mobile station is within the serving area of H MPC . In this case mobile station is outside the serving area of H MPC . H MPC selects S MPC based on the SID NID information and sends a Roaming Request message to S MPC step d . S MPC receives the Roaming Request message and sends a Roaming Request Acknowledgement message indicating that S MPC is able to accept the request and including an address and port number of S PDE step e . H MPC sends to mobile station an SPPRes message instructing mobile station to perform an IS 801 session and including the address and port number of S PDE step f . S MPC sends a GPOSREQ message that invokes and seeds S PDE step g which returns a gposreq message to acknowledge the GPOSREQ message step h .

Mobile station and S PDE perform an MO IS 801 session and a position estimate is made available to mobile station at the end of the IS 801 session step i . S PDE sends to S MPC a gposreq message indicating that the IS 801 session terminated normally and including the position estimate step j . The gpsOne API returns the position estimate to MS resident application step k . S MPC sends the position estimate in a Location Report message to H MPC step .

On the downlink base stations in RAN transmit traffic data messages signaling and pilot to mobile stations within their coverage area. These various types of data are processed by processor and conditioned by transceiver to generate a downlink signal which is transmitted via an antenna. At mobile station the downlink signals from base stations are received via an antenna conditioned by transceiver and processed by processor to obtain various types of information for positioning location and other services. For example processor may decode messages used for the message flows described above. Memories and store program codes and data for mobile station and RAN respectively. On the uplink mobile station may transmit traffic data messages signaling and pilot to base stations in RAN . These various types of data are processed by processor and conditioned by transceiver to generate an uplink signal which is transmitted via the mobile station antenna. At RAN the uplink signals from mobile station and other mobile stations are received and conditioned by transceiver and further processed by processor to obtain various types of information e.g. data messages signaling etc. RAN may communicate with other network entities via communication unit .

Within S PDE processor performs processing for the S PDE memory stores program codes and data for the S PDE and communication unit allows the S PDE to communicate with other entities. Processor may perform processing for S PDE in the message flows described above.

Within S MPC processor performs location and or positioning processing for the S MPC memory stores program codes and data for the S MPC and communication unit allows the S MPC to communicate with other entities. Processor may perform processing for S MPC in the message flows described above.

Within H MPC processor performs location and or positioning processing for the H MPC memory stores program codes and data for the H MPC and communication unit allows the H MPC to communicate with other entities. Processor may perform processing for H MPC in the message flows described above.

The techniques described herein may be implemented by various means. For example these techniques may be implemented in hardware firmware software or a combination thereof. For a hardware implementation the processing units used to perform the techniques at each entity e.g. mobile station S PDE S MPC H MPC etc. may be implemented within one or more application specific integrated circuits ASICs digital signal processors DSPs digital signal processing devices DSPDs programmable logic devices PLDs field programmable gate arrays FPGAs processors controllers micro controllers microprocessors electronic devices other electronic units designed to perform the functions described herein a computer or a combination thereof.

For a firmware and or software implementation the techniques may be implemented with modules e.g. procedures functions and so on that perform the functions described herein. The firmware and or software codes may be stored in a memory e.g. memory or in and executed by a processor e.g. processor or . The memory may be implemented within the processor or external to the processor. For example according to some embodiments a processor readable media for storing instructions is operable to receive a location request for location of a mobile station at a home mobile positioning center H MPC in a home network receive first information from the mobile station determine a serving mobile positioning center S MPC in a visited network based on the first information receive second information from the S MPC and send the second information to the mobile station. In some embodiments the processor readable media is further for storing instructions operable to receive a system identifier SID and a network identifier NID from the mobile station determine the S MPC based on the SID and NID receive an address of a serving position determining entity S PDE from the S MPC and send the address of the S PDE to the mobile station.

The previous description of the disclosure is provided to enable any person skilled in the art to make or use the disclosure. Various modifications to the disclosure will be readily apparent to those skilled in the art and the generic principles defined herein may be applied to other variations without departing from the spirit or scope of the disclosure. Thus the disclosure is not intended to be limited to the examples described herein but is to be accorded the widest scope consistent with the principles and novel features disclosed herein.

