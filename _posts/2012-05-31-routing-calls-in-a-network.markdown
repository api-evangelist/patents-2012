---

title: Routing calls in a network
abstract: A method includes receiving a telephone number mapping query associated with a call. The method may also include generating routing information based on the query and forwarding the routing information to a control device. The routing information may indicate that processing associated with routing the call is to bypass a core portion of an Internet multimedia subsystem (IMS) when a calling party associated with the call does not invoke an IMS service, the called party associated with the call does not invoke an IMS service and the called party is not an IMS subscriber.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08737592&OS=08737592&RS=08737592
owner: Verizon Patent and Licensing Inc.
number: 08737592
owner_city: Basking Ridge
owner_country: US
publication_date: 20120531
---
The present application claims priority to U.S. Provisional Patent Application No. 60 703 812 filed on Jul. 29 2005 and U.S. Provisional Patent Application No. 60 764 748 filed on Feb. 3 2006. The entire contents of both provisional applications are incorporated herein by reference in their entireties.

The present application is a continuation of U.S. patent application Ser. No. 11 460 668 filed on Jul. 28 2006 which claims priority to U.S. Provisional Patent Application No. 60 703 812 filed on Jul. 29 2005 and U.S. Provisional Patent Application No. 60 764 748 filed on Feb. 3 2006. The entire contents these applications are incorporated herein by reference in their entireties.

The Internet Protocol Multimedia Subsystem IMS provides mobile and fixed multimedia services. The aim of IMS is to provide both current and future services via the Internet. IMS gives network operators and service providers the ability to control and charge for each service. In addition users are provided with the ability to execute services from their home computers networks as well as via their mobile devices.

The following detailed description of implementations consistent with the principles of the invention refers to the accompanying drawings. The same reference numbers in different drawings may identify the same or similar elements. Also the following detailed description does not limit the invention. Instead the scope of the invention is defined by the appended claims and their equivalents.

Implementations consistent with the principles of the invention relate to routing traffic in relation to an Internet Protocol IP Multimedia Subsystem IMS also referred to as an IMS core or IMS platform . The IMS core may be used for routing multimedia calls data sessions from various originations towards various destinations with possible invocation of value added service during processing and routing determinations. Calls not involving IMS subscriber endpoints or IMS based applications may be bypass the IMS core e.g. be routed around the IMS core .

It will be appreciated that the telephony terminology that is used herein covers the United States based public switched telephone network PSTN structure. Implementations consistent with principles of the invention are not so limited. For example implementations consistent with principles of the invention are equally applicable to other communication networks.

S CSCF I CSCF and P CSCF may be considered call session control components in system . The call control components may be responsible for parsing a session e.g. a session initiation protocol SIP session and applying logic e.g. business logic service logic operational logic etc. on a per event basis. The outcome of the session control may be to either route an event to the appropriate components and or append SIP headers and values.

S CSCF may be viewed as the brain of the IMS core. The term IMS core as used herein may refer to and include the call session control components i.e. S CSCS I CSCF P CSCF . The IMS core may also include HSS and or other elements associated with providing IMS related services. Other components in system such as BGCF and BIGCF may represent non core IMS components. S CSCF may perform session control and registration services for the users of the IMS platform. S CSCF may receive a user profile from HSS and route sessions requested by an IMS user also called an IMS subscriber or subscriber . Additionally S CSCF may perform user authentication based on information from HSS .

In some implementations S CSCF may include a Service Capability Interaction Manager SCIM and Resource Management RM functions. The SCIM may be responsible for orchestrating the offerings of one or more application services across various service enabling technologies and platforms to produce valued services for IMS users. The RM may be responsible for executing business rules and service level agreements SLAs by allocating the appropriate resources.

I CSCF may act as the main point of contact for connections to subscribers served by other IP networks. I CSCF may be located at the edge of the IMS core. I CSCF may receive SIP messages and identify the next hops for the SIP messages. To achieve this I CSCF may query HSS for the location e.g. an address of the appropriate S CSCF to which a particular SIP message is to be forwarded.

P CSCF may act as the main point of contact for connections to subscribers of the local IMS. As such P CSCF may validate requests forward the requests to selected destinations process and forward the responses. P CSCF may generate chargeable events and send information relating to the chargeable events to CF . Additionally P CSCF may interact with PDF to grant reject or downgrade a session request based on platform resources and quality of service QoS measurements.

HSS may include one or more servers that act as the central repository for user related information. HSS may contain user related subscription information for handling multimedia sessions. Some of the information contained in HSS may include information identifying the location of a particular S CSCF for a particular user. As indicated above the location of a particular S CSCF may be conveyed to I CSCF upon receiving a query from a network element. HSS may also include user profile information that contains service trigger points and the corresponding resources e.g. applications media services etc. that offer the services. The user profile information may be forwarded to S CSCF for session control and service treatment. Moreover HSS may provide and receive updates directly from application servers .

SLF may include one or more databases that contain service location information for subscribers. SLF may receive a query containing identification information for a subscriber from I CSCF and return based on the subscriber identification information information identifying an HSS that serves the subscriber.

System may include various components that bridge the IMS core to external networks such as a public switched telephone network PSTN the Internet etc. These components which may include MGW function MGCF SLG NGW BGCF and BIGCF may perform protocol conversion and event routing to or from the IMS platform.

MGW function may connect PSTN networks and the IMS core. In one implementation MGW function may terminate bearer channels from a PSTN network and media steams from the IMS core e.g. real time transport protocol RTP streams in an IP network or asynchronous transfer mode adaptation layer 2 AAL2 ATM connections in an ATM backbone execute the conversion between these terminations and perform transcoding and signal processing. In addition MGW function may provide tone announcements to circuit switched CS users. In one implementation consistent with the principles of the invention MGW function may operate under the control of MGCF .

MGCF may be part of the gateway infrastructure that enables communication between IMS and PSTN networks. MGCF may perform protocol conversion between the ISDN User Part ISUP or Primary Rate Interface PRI and SIP protocols before forwarding a session to the IMS platform. In similar fashion IMS originated sessions directed towards PSTN users may traverse MGCF . MGCF may control media channels in MGW . In addition MGCF may report account information to CF .

SLG may include an MGCF and a set of associated MGW entities within the same physical entity. SLG may connect the IMS platform to the local exchange layer of the PSTN. In one implementation the interfaces between SLG and the local exchange networks may include digital signal 0 DS0 or digital signal 1 DS1 based Non Facilities Associated Signaling NFAS PRIs.

NGW may include an MGCF and a set of associated MGW entities which may physically reside in separate physical entities. NGW may connect the IMS platform to the long distance layer of the PSTN. In one implementation the interfaces between MGCF of NGW and the long distance networks may include DS0 or DS1 based signaling system 7 SS7 interfaces and the interfaces between MGW of NGW and the long distance networks may include DS1 bearer channels.

BGCF may connect IMS initiated calls to a Circuit Switch CS customer e.g. an IMS user calling a telephone number in the PSTN . BGCF may based on a routing policy select an appropriate network in which the connection is to be made or may select the appropriate MGCF to the other network.

BIGCF may correspond to an ingress point that handles incoming calls from Wholesalers PSTN gateways e.g. NGW SLG I SBC wholesale gateways which may require prepaid authorization for non emergency calls other IP based carriers e.g. based on VoIP peering agreements Emergency Services Peering Points etc. BIGCF may route calls to the IMS core when the calls are destined for IMS subscribers or when IMS services are to be invoked or may bypass the IMS core elements P CSCF I CSCF S CSCF HSS etc. when the calls are destined for non IMS subscribers and no IMS services are invoked by the calling party or called party. BIGCF may route calls to PSTN based termination points to BGCF and route calls to IP based termination points e.g. to wholesale IP based carriers etc. directly to I SBCs associated with the IP based termination points. BIGCF may include static routing policies to route emergency calls to BGCF . BIGCF may also support static routing policies to route non emergency calls from certain originations e.g. wholesale gateway requiring prepaid authorization for non emergency calls to pre paid service controllers. If calls are either from and or to IMS subscribers or IMS services are invoked BIGCF may route the calls to the IMS platform using I CSCF to invoke calling and or called party features.

BIGCF may include a group of configuration data. For example BIGCF may maintain a list of served hosts. If a request uniform resource identifier R URI in the incoming request does not identify one of the served hosts BIGCF may either proxy the call externally to an address resolved by a domain name service DNS service SRV record or reject the call by sending a session initiation protocol SIP response or other type of message unless the call is an emergency call. In this way BIGCF may reject calls destined for unknown entities.

BIGCF may also include a list of emergency prefixes on a per country basis. For example BIGCF may store the prefix for the United States. BIGCF may store a list of non geographic numbers per country of origin e.g. 800 411 etc. . Via this list BIGCF may route calls directly for PSTN breakout.

BIGCF may further store a list of originating hosts e.g. gateway uniform resource locators URLs from which calls may be expected. If a call is not from one of the hosts in the list of origination hosts either in the second topmost via or first via BIGCF may reject the request. The originating host based data may include a number of data elements. For example the data elements may include a gateway IP address of one or more hostnames. The originating hosts may point to prefix suffix information to normalize the calling party number. For example a wholesale gateway origination may have a rule indicating that if 7 digits are given in the calling party number then prefix the calling party number with 1732. The suffix information may indicate how many digits to consider after the suffix.

The originating hosts may identify a location of the calling party identity indicators. For example the originating hosts may identify from which header in a SIP INVITE message to retrieve the calling party information.

The data elements may also include the country or location of the gateway. This location may be used by BIGCF to normalize the called party number based on the country of origination of the call. The location of the gateway may also be used by BIGCF to identify a location of a gateway to which an emergency call is to be routed.

The data elements may further include a list of blocked prefixes from each origination host. For example 1900 may indicate that 1 900 calling is blocked from this gateway. The data elements may further include an outbound route for each origination host. For example non emergency calls from a given host may be routed to a configured host such as a pre paid service controller.

In addition to the above data BIGCF may be configured with the following data a variable to either allow or reject processing of an INVITE where the request URI does not match one of the configured served hosts an option per originating domain or IP address to accept or reject the request an option to process certain SIP requests a prefix per origination that is not allowed static routing rules based on prefix matching a server group pointing to a farm of ENUM servers a server group pointing to a farm of I CSCF servers for routing to the IMS core a server group pointing to a farm of BGCF servers for bypassing the IMS core and routing directly to BGCF a server group pointing to a farm of Emergency Services Positioning Servers e.g. part of the U.S. emergency service network an option to specify that certain message s are to be directed to an error log or an on screen display an option to place a gateway in service and place a gateway out of service in BIGCF country codes needed for number normalizations number normalization rules e.g. based on originating gateway an option for enabling or disabling logging categories an option for enabling or disabling alarms and an option for enabling or disabling metrics.

In one implementation BIGCF may connect to I CSCF SLG NGW and BGCF via SIP interfaces. Additionally BIGCF may connect to ENUM via a DNS protocol interface.

The IMS core may provide shared multimedia services. Examples of multimedia services or applications include playing announcements audio video recording and playback interactive voice response IVR fax reception and transmission automatic speech recognition ASR text to speech TTS sessions multimedia conferencing customized ring back tones push to talk over cellular PoC video messaging etc. MRF may be part of the IMS platform and may support services that require multimedia streams.

As illustrated in MRF may include MRFC MRFP and MRB . MRFC and MRFP are the IMS resources that provide support for bearer related services e.g. multi party sessions announcements to a user bearer transcoding etc. . MRFC may provide bearer control related services. MRFP may provide user plane resources that may be requested and instructed by MRFC . MRB may provide a resource management function that is able to allow media resources to become common resources shared among multiple applications.

Application servers may include one or more servers that provide enhanced audio video messaging and data services within the application layer of system . Application servers may be accessible to the users of the IMS platform and provide value added multimedia services to those users. Application servers may submit charges to the IMS platform for the services that application servers provide to the IMS user community.

Two types of application servers that may be used within system may include micro applications and macro applications or macro application services . Micro applications may be provided on a common Services Delivery Platform through the use of a Services Creation Environment SCE . Micro applications may include a wide variety of enhanced multimedia services that need a rapid development and deployment cycle. Examples of macro application services include Hosted IP CENTREX HIPC Unified Messaging UM and Carrier Application Service .

HIPC may correspond to a type of Private Branch Exchange PBX service in which switching occurs at a local telephone office instead of at the company premises where the traditional PBX is located. In one implementation HIPC may be replaced or supplemented with a SIP Voice Features server. Unified messaging may allow users to be able to retrieve and send voice messages from a single interface regardless of the technology e.g. telephone personal computer etc. and other unified messaging services e.g. fax deposit retrieval voice to email etc. . Carrier AS may facilitate tool free call processing.

SCE provides a foundation for rapid development of next generation services. SCE may support Java Specification Request JSR SIP Servlet and a suite of externalized application programming interfaces APIs for developers to gain access to the IMS platform. A single SCE may support a number of macro application servers and may support the building of micro applications.

The IMS core may support a number of different services such as GLMS Presence and ENUM server . GLMS may include one or more services that allow for group list creation management and use across multiple applications within IMS. GLMS may enforce access and visibility rules. Presence may include one or more services that automate the task of aggregating both presence and availability information. Presence may inform one user about the status of another user s availability and willingness to communicate. Presence servers may use the Presence User Agent PUA to manage the presence of the IMS users and handle presence subscription requests. For example an application or an IMS subscriber may act as a watcher which is an entity that subscribes to presence information provided by Presence Server . ENUM server may provide translation of E.164 to SIP URIs. BIGCF and S CSCF may query ENUM server to determine a next hop for a call. In some implementations consistent with principles of the invention BIGCF may execute ENUM queries for both calling and called number resolution.

The IMS core may include one or more session border controllers SBCs that provide control of the boundary between different service provider networks provide signaling protocol inter working between the SIP based IMS platform and other service provider networks control the transport boundary between service provider networks and provide usage metering and Quality of Service QoS measurements for media flows. Two types of SBCs that may be implemented in the IMS platform are the access session border controller A SBC and the I SBC .

A SBC may correspond to an ingress point to the IMS platform for Customer Premises Equipment CPE traffic with the exception of the wholesale gateway. A SBC may provide SIP aware firewall capabilities that support network address translation NAT prevent denial of service DoS attacks and execute other security enforcement features. A SBC may be the first SIP events normalization point prior the IMS platform.

Internetworking session border controller I SBC may serve as a connection point between the IMS platform and the wholesale gateway and also between the IMS platform and IP peering VoIP carriers. I SBC may provide SIP normalization and Topology Hiding and Internetwork Gateway THIG services. In one implementation I SBC may be replaced by or supplemented with a border gateway function BGF .

System may include a number of policy components. For example system may as illustrated in include a policy engine a PDF and a RM . Policy engine may include one or more rule based engines that govern subscriber access to the IMS platform subscriber access to resources and routing decisions for several different types of event requests made within the IMS platform. In one implementation policy engine may provide decision logic to decision and policy points within the IMS platform. PDF may correspond to a Policy Decision Point PDP for service based local policy control. PDF may make policy decisions based on session and media related information. PDF may exchange this decision information with another IMS element such as A SBC or I SBC to control the flow and characteristics of the communication link. RM may be used to execute a policy at the component level. As illustrated in RM may be associated with for example S CSCF BIGCF A SBC and I SBC . In one implementation RM may store and execute the policy decisions that are relevant for the location at which RM is associated.

CF may include a unified system for affecting both offline charging and online charging. Offline charging is a process where charging information for network resource usage is collected concurrently with that resource usage. The charging information may be passed through a chain of CFs . At the end of this process Call Detail Record CDR files may be generated by the network which are then transferred to the network operator s billing domain for the purpose of subscriber billing processing which may include rating and rendering.

Online charging is a process where charging information can affect in real time the service rendered. Support of this capability requires direct interaction between the charging mechanism and the network s session control mechanism. An example of online charging includes pre paid calling card usage.

CDF may compile chargeable events gathered from IMS components into a single CDR for offline billing activities. CDF may gather the chargeable events from a Charging Trigger Function CTF that may be associated with components of system and after creating the CDR pass the billing data to the CGF .

CGF may act as a gateway between both the offline charging system the online system and an external post processing system such as the billing domain.

Information related to IMS subscribers may be in many formats managed by many network elements and administrations. This complicates access to that data for users network elements and value added service providers. The Generic User Profile GUP addresses these issues and provides a common conceptual description of subscriber data. A GUP server may provide a means to access the data described in the GUP.

Bus may permit communication among the components of ENUM server . Processing logic may include any type of processor or microprocessor that interprets and executes instructions. In other implementations processing logic may be implemented as or include an application specific integrated circuit ASIC field programmable gate array FPGA or the like. Memory may include a random access memory RAM or another type of dynamic storage device that stores information and instructions for execution by processing logic a read only memory ROM or another type of static storage device that stores static information and instructions for the processing logic and or some other type of magnetic or optical recording medium and its corresponding drive for storing information and or instructions.

Input device may include a device that permits an operator to input information to ENUM server such as a keyboard a keypad a mouse a pen a microphone one or more biometric mechanisms and the like. Output device may include a device that outputs information to the operator such as a display a speaker etc.

Communication interface may include any transceiver like mechanism that enables ENUM server to communicate with other devices and or systems. For example communication interface may include mechanisms for communicating with other components within system .

As will be described in detail below ENUM server may perform processing associated with routing calls to and from various parties. ENUM server may perform these and other functions in response to processing logic executing software instructions contained in a computer readable medium such as memory . A computer readable medium may be defined as one or more memory devices and or carrier waves. The software instructions may be read into memory from another computer readable medium or from another device via communication interface . The software instructions contained in memory may cause processing logic to perform processes that will be described later. Alternatively hardwired circuitry may be used in place of or in combination with software instructions to implement processes consistent with the principles of the invention. Thus systems and methods consistent with the principles of the invention are not limited to any specific combination of hardware circuitry and software.

Numbers in E.164 format are globally unique language independent identifiers for resources on public telecommunication networks that can support many different services and protocols. E.164 is controlled by the International Telecommunication Union ITU . Currently many IMS subscribers that wish to establish a session may be identified via an E.164 number also referred to as the subscriber public ID as opposed to a URI. Therefore system may support the establishment of sessions to terminals identified by E.164 numbers as described in detail below.

System and more particularly ENUM server may perform processing associated with performing ENUM related mappings such as mappings from E.164 numbers to URIs. This processing is referred to herein as infrastructure ENUM . Infrastructure ENUM is based on formats and procedures defined in the Internet Engineering Task Force IETF Request for Comments RFC 3761. However ENUM server s application of those formats and procedures i.e. formats and procedures specified in RFC 3761 may not be strictly consistent with the objectives defined in RFC 3761. For example RFC 3761 defines the translation of E.164 numbers into URIs that identify an individual subscriber known as Addresses of Record or AORs . These URIs can then be routed using the mechanisms in RFC 3261 and RFC 3263. Such an implementation is sometimes referred to as user ENUM . Conceptually user ENUM is an end user service. As such the presence and nature of translation logic associated with a given E.164 number may be determined by the subscriber to whom the number is allocated. Infrastructure ENUM in contrast is a network routing mechanism. Infrastructure ENUM translations will typically exist for all active E.164 numbers. Translation details for a given number may be determined by the entity to whom the number is assigned e.g. by the national Numbering Plan Administrator an agent acting on behalf of such an entity or an entity to whom that entity has delegated responsibility for the number. Infrastructure ENUM utilizes similar translation mechanics as user ENUM but the resulting URI does not necessarily identify an end user. The translation logic associated with a given E.164 number may identify directly or indirectly a network element to which the session request should be forwarded for subsequent processing. ENUM server and other components in system perform infrastructure ENUM related processing and resolve any potential conflicts between user ENUM processing and infrastructure ENUM processing.

ENUM server performs a number of functions associated with infrastructure ENUM. The infrastructure ENUM related processing may service internal routing functions and inter carrier routing functions. For example ENUM server may translate E.164 routing numbers including pooled and or ported numbers to URIs for routing purposes. ENUM server may also include a provisioning interface for populating the naming authority pointer NAPTR records into an ENUM database not shown in . ENUM server may further provide alarming and performance management functions and configuration management functions associated with OSS BSS . ENUM server may further provide DNS server functionality consistent with RFC 1034 and RFC 1035.

As described above ENUM server provides internal routing information as well as routing information for use between a set of peering service providers such as VoIP service providers. For example infrastructure ENUM may be intended for service provider internal routing and or for use between a set of peering VoIP service providers. The DNS NAPTR queries may be based on a common top level domain TLD that is agreed to by the peering partners. In this configuration each party manages its own ENUM translation data within a set of ENUM servers for which it has administrative authority. Queries for translation information associated with numbers assigned to other carriers are forwarded to and answered by servers associated with those carriers. Alternatively the peering partners may share their ENUM translation data with each storing data from all parties with which it has executed a peering agreement within a set of servers for which it has administrative authority and under a private TLD of its choosing. In either implementation the selected TLD may not be E164.arpa domain so that it does not conflict with user ENUM. The TLD may also use a non public root such as a root that is not .com .edu .gov etc. to ensure that the data is not accessible to the public.

In a configuration involving a shared TLD a DNS peering provider accessible to system and its VoIP peering partners may host the domain root. For example illustrates infrastructure ENUM root server coupled to E.164 database and E.164 database . E.164 database may be implemented within ENUM server or may be a database accessible to ENUM server . E.164 database may be associated with a VoIP peering partner. E.164 database may receive an ENUM query from IMS SIP server . IMS SIP server may represent for example BIGCF S CSCF or another SIP server in system . E.164 database may perform hierarchical recursive DNS resolution by communication with ENUM root server if a particular E.164 number is not included in E.164 database . Similarly E.164 database may perform hierarchical recursive DNS resolution with ENUM root server . The ENUM peering service provider may also provide additional services such as support for routing of ported numbers.

In a configuration in which each peering partner stores Infrastructure ENUM translations for its own numbers as well as numbers assigned to its peering partners under a private TLD each partner may determine for every E.164 number or block of E.164 numbers over which it has authority the URI s to which the number s should translate in response to a query from each of its peering partners. Each partner may then produce the corresponding data and provide the appropriate subset to each other partner. In return each partner may expect to receive equivalent translation data from the other partners which it may store in its local database . This process of formulating and exchanging Infrastructure ENUM translations which may be repeated periodically may be facilitated by a DNS peering provider accessible to system and its VoIP peering partners. Such a DNS peering provider may also provide certain value added functions such as normalization of ported and pooled numbers. E.164 database may receive an ENUM query from IMS SIP server . IMS SIP server may represent for example BIGCF S CSCF or another SIP server in system . Since E.164 database contains translation data from all peering partners it may resolve this query without requiring access to any external data store. Similarly E.164 database may resolve all queries coming from SIP servers in its domain without requiring access to external data stores.

In an exemplary implementation of the shared TLD configuration the URI to which a given E.164 number is translated may be different if that number is assigned to the entity responsible for system than if it is not. For example the URI returned in response to a query specifying a number assigned to the entity responsible for E.164 database may identify an element within system whereas the URI returned in response to a query for a number assigned to another operator may at the discretion of that operator identify an element in that operator s network. System may therefore implement a type of policy using a configuration referred to herein as split DNS . Split DNS may use two sets of DNS servers one for internal use and one for external use.

For example illustrates a split DNS implementation. Referring to system may include external DNS server E.164 database internal DNS server and E.164 database . A firewall or other security device may be located between servers and to prevent unauthorized access to DNS server . The VoIP peering partner illustrated in to the right of the dotted line may be configured in a manner similar to system . External DNS server may connect to ENUM root server and may receive queries from outside system . External DNS server may also be coupled to E.164 database . Internal DNS server and or E.164 database may be accessible from within system . Internal DNS server may be populated with data that gives details for the routing of calls within system . The set of E.164 numbers for which translations are configured in external DNS server may overlap set of E.164 numbers for which translations are configured in internal DNS server . However the URI s returned by DNS servers and may be different. For example external DNS server may in response to queries specifying numbers assigned to the owned by an entity responsible for system return the URI of an I SBC within system whereas internal DNS server may return the URI of an I CSCF or wholesaler gateway addresses.

Devices within system may be configured to use internal DNS server . Internal DNS server may forward queries that it cannot resolve to external DNS server . External DNS server may participate in DNS hierarchical resolution using ENUM root server and DNS servers of VoIP service provider peers e.g. VoIP peering partners .

Since user ENUM and infrastructure ENUM serve different needs and are populated with different data there may be discrepancies between the results from user ENUM and infrastructure ENUM queries for the same E.164 number. These discrepancies may result in identifying different routing logic and may identify different providers for services to which a user has subscribed. To resolve these discrepancies system may handle user ENUM as a terminating network issue. That is only the service provider to which the particular number is assigned would perform user ENUM lookup. This helps ensure that the terms of peering agreements are honored thereby avoiding scenarios where user ENUM results would result in the bypassing of a VoIP peer s network.

System may also utilize only infrastructure ENUM routing and IMS service configuration for internal IMS users thereby maintaining vertical service integration. The entity service provider associated with system may also utilize both infrastructure and user ENUM routing as well as user ENUM service configuration for internally owned numbers for non IMS subscribers. This allows the service provider to offer non IMS VoIP services in which user ENUM may play a more significant role.

For example in one implementation if the calling party number is not associated with an IMS profile that invokes an IMS application the called party number is not associated with an IMS subscriber or the called party is not associated with an IMS profile that invokes an IMS application the call may not be served by the IMS core. Assume that the call is not served by the IMS core. In this case ENUM server may return a response to BIGCF that includes a URI that identifies an element outside of the IMS core act . For example ENUM server may identify a URI pointing to a gateway of a wholesale subscriber e.g. sip CdPN gateway.wholesaler.com where CdPN represents the called party E.164 number .

BIGCF may receive the response from ENUM server and route the call accordingly. In this case the call may be routed outside the IMS core. That is BIGCF routes the call to the entity identified by the URI in the ENUM query response which in this example has the effect of bypassing the IMS core act . For example BIGCF may if no URI was returned in the ENUM query response forward the call to BGCF for routing to an appropriate PSTN termination point or to an appropriate I SBC if the URI in the ENUM query response identified a wholesale gateway or IP based carrier termination point.

If the call is to be routed to the IMS core ENUM server may return a response that identifies an element in the IMS core act . For example ENUM server may return a URI identifying an element in the IMS core e.g. sip CdPN icscf1.21.sip.com . In this example the message indicates that the call is to be routed to I CSCF .

BIGCF may receive the response with the URI and route the call to the IMS core i.e. I CSCF in this example for terminating subscriber feature processing act . The terminating subscriber feature processing may include for example an application executed by the IMS core such as text to speech conversion IVR ASR multimedia conferencing etc. In each case the appropriate element in IMS core may invoke the appropriate IMS service s forward the request to the appropriate element and or forward the call toward the appropriate IMS subscriber.

The processing described above with respect to involves an inbound call received from outside the IMS core from for example a non IMS subscriber. illustrates exemplary processing associated with an inbound call that is received by the IMS core from a registered subscriber.

Processing may begin with receiving a call from a registered IMS subscriber act . The call message may be sent from for example P CSCF to for example S CSCF . S CSCF may retrieve a service profile for the originating subscriber act . For example S CSCF may access HSS to determine if HSS includes an IMS profile for the destination number i.e. the called party number . Assume that S CSCF cannot find an IMS profile for the called party number in HSS .

S CSCF may then perform an infrastructure ENUM lookup based on the called party number act . For example S CSCF may send a DNS NAPTR query to ENUM server that includes the called party number. ENUM server may receive the DNS NAPTR query and generate a URI pointing to for example a VoIP peering partner s gateway act . Alternatively the URI may point to a PSTN destination gateway. ENUM server may then forward the response to S CSCF .

Assume that ENUM server generates a URI pointing to a VoIP peering partner s gateway. S CSCF may then look up a URI identifying for example an I SBC using the VoIP peering partner s gateway name as a search key into a local table act . S CSCF may then identify a URI from the local table and add a route header specifying this URI to the signaling message act . S CSCF may then route the call to the peering partner gateway via the I SBC determined at act act .

In some implementations the infrastructure ENUM lookup based on the called number at act may result in ENUM server returning a void response. For example this may occur when the called number is out of service. In this case S CSCF may terminate the call.

ENUM server as discussed above supports route lookup for both IMS subscribers and non subscribers. ENUM server may also perform a number of other functions processes. For example ENUM server may implement the Dynamic Delegation Discovery System DDDS as defined in IETF RFC 3401 3402 3403 3404 and 3405. ENUM server may perform batch processing for uploading the mapping of E.164 numbers and NAPTR resource records. ENUM server may also include an administrative interface allowing for manual updating of E.164 and NAPTR mapping.

ENUM server may further perform validation of the format of the URI in the NAPTR resource records and rejection of the NAPTR resource records that contain incorrect URI format. ENUM server may also provide support for mapping one E.164 numbers to multiple NAPTR resource records.

ENUM server may also provides support of the SIP Enumservice specified in IETF RFC3764 and support of the VOID Enumservice. ENUM server may further support mapping policies that allow for resolving NAPTR record by using any number of digits up to for example 15 digits. ENUM server may also support negative response caching and support for records i.e. wildcards as per RFC 1034.

As discussed in various conditions coupled with operator policy govern the response from ENUM server . Table 1 below provides exemplary ENUM responses to a variety of different numbers.

BIGCF may use the responses from the two NAPTR queries i.e. called number query and calling number query to route calls to either the IMS core e.g. towards I CSCF or away from the IMS core e.g. towards the BGCF .

As described above the infrastructure ENUM configuration of a set of operators offering IP based services e.g. VoIP and wishing to exchange associated information flows via IP i.e. peering partners may be implemented using either a shared Top Level Domain TLD or private TLDs. The shared TLD configuration may be implemented using a split DNS structure. In either shared TLD or private TLD configuration the responses returned to queries from a peering partner may be different from those returned in response to queries from within system .

In the private TLD configuration OSS BSS may populate the ENUM peering service provider database with ENUM data associated with system . The peering service provider may augment this data e.g. with Local Number Portability information and the merged data may be pushed into the real time name servers.

ENUM server may also provide tools to view the following performance related system information in real time system up time summary of successful queries summary of unsuccessful queries and system utilization percentage processor and storage . ENUM server may further provide logging and metrics to assist with performance management.

For example ENUM server may log requests and responses with configurable logging data content i.e. the log s fields may be configurable. The logging may be written to persistent storage with periodically incremented file identifiers e.g. daily log files. The file period and minimum maximum file sizes may be configurable and ENUM server may support logging to off platform persistent storage as an option.

ENUM server may also support a number of configuration management features. For example ENUM server may support for example simple object access protocol SOAP or plain XML HTTP provisioning application programming interfaces APIs that allow for full remote configuration of ENUM server including loading and changing DNS records. ENUM server may also support a command line based configuration and management console a graphical user interface GUI based configuration and management console and a configuration and management console that is capable of managing multiple instances of the ENUM server from a single console and batch processing for uploading the NAPTR resource records.

ENUM server may also support fault management functions. For example ENUM server may generate alarms to identify problems in at least the following areas network interface disk capacity utilization and unsuccessful query count exceeded configurable threshold. ENUM server may also provide tools to view fault related system information in real time such as alarm count by severity.

Implementations described herein provide for routing calls through an IMS core or outside the IMS core. For example if a call involves an IMS subscriber or invokes an IMS application an ENUM server may provide routing information that indicates that the call is to be routed through the IMS core. If however a call does not involve an IMS subscriber or invoke an IMS application the ENUM server may identify routing information that results in routing outside the IMS core.

In the preceding specification the invention has been described with reference to specific exemplary embodiments thereof. It will however be evident that various modifications and changes may be made thereunto without departing from the broader spirit and scope of the invention as set forth in the claims that follow. The specification and drawings are accordingly to be regarded in an illustrative rather than restrictive sense.

For example a single ENUM server is illustrated in for simplicity. In some implementations a number of ENUM servers may be used. In addition the call routing situations described above are provided for explanatory purposes only. Other calls call routing situations involving IMS subscribers non IMS subscribers peering parties PSTN parties etc. may also be processed in implementations consistent with the invention.

In addition while series of acts have been described with respect to the order of the acts may be varied in other implementations consistent with the invention. Moreover non dependent acts may be implemented in parallel.

It will be apparent to one of ordinary skill in the art that aspects of the invention as described above may be implemented in many different forms of software firmware and hardware in the implementations illustrated in the figures. The actual software code or specialized control hardware used to implement aspects consistent with the principles of the invention is not limiting of the invention. Thus the operation and behavior of the aspects of the invention were described without reference to the specific software code it being understood that one of ordinary skill in the art would be able to design software and control hardware to implement the aspects based on the description herein.

Further certain portions of the invention may be implemented as logic that performs one or more functions. This logic may include hardware such as a processor a microprocessor an application specific integrated circuit or a field programmable gate array software or a combination of hardware and software.

Aspects of the invention described herein are generally applicable to multimedia sessions implemented over an Internet Protocol infrastructure which uses E.164 numbers to identify endpoints. Neither the usage of terms frequently associated with telephony e.g. call nor the historic association of E.164 numbers with such services limits the scope or applicability of this invention.

No element act or instruction used in the description of the present application should be construed as critical or essential to the invention unless explicitly described as such. Also as used herein the article a is intended to include one or more items. Where only one item is intended the term one or similar language is used. Further the phrase based on is intended to mean based at least in part on unless explicitly stated otherwise.

