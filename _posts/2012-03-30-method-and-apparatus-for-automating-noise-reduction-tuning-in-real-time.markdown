---

title: Method and apparatus for automating noise reduction tuning in real time
abstract: An embodiment of a method for detecting noise for a capacitance sensing panel may comprise generating an input signal based on a noise signal, performing a series of measurements for measuring capacitances from a capacitive sensor sensitive to the noise signal, and controlling timing for at least one of the subconversions based on the input signal.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09170322&OS=09170322&RS=09170322
owner: PARADE TECHNOLOGIES, LTD.
number: 09170322
owner_city: Santa Clara
owner_country: US
publication_date: 20120330
---
This application claims the benefit of U.S. Provisional Application No. 61 512 338 filed on Jul. 27 2011 and is a Continuation in Part of U.S. Utility application Ser. No. 13 309 674 filed Dec. 2 2011 which claims the benefit of U.S. Provisional Application No. 61 472 172 filed on Apr. 5 2011. These applications are herein incorporated by reference.

This disclosure relates to the field of touch sensors and in particular to detection and suppression of noise in capacitive touch sensor arrays.

Computing devices such as notebook computers personal data assistants PDAs kiosks and mobile handsets have user interface devices which are also known as human interface devices HID . One user interface device that has become more common is a touch sensor pad also commonly referred to as a touchpad . A basic notebook computer touch sensor pad emulates the function of a personal computer PC mouse. A touch sensor pad is typically embedded into a PC notebook for built in portability. A touch sensor pad replicates X Y movement using a collection of capacitive sensor elements arranged along two defined axes that detect the presence or proximity of one or more conductive objects such as a finger. Mouse right left button clicks can be replicated by two mechanical or capacitive sensed buttons located in the vicinity of the touchpad or by tapping commands on the touch sensor pad itself. The touch sensor pad provides a user interface device for performing such functions as positioning a pointer or selecting an item on a display. These touch sensor pads may include multi dimensional sensor arrays for determining movement of the conductive object in multiple axes. The sensor array may include a one dimensional sensor array detecting movement in one axis. The sensor array may also be two dimensional detecting movements in two axes.

Another user interface device that has become more common is a touch screen. Touch screens also known as touchscreens touch windows touch panels or touchscreen panels are transparent display overlays which are typically either pressure sensitive resistive or piezoelectric electrically sensitive capacitive acoustically sensitive surface acoustic wave SAW or photo sensitive infra red . Such overlays allow a display to be used as an input device removing the keyboard and or the mouse as the primary input device for interacting with the displayed image s content. Such displays can be attached to computers or as terminals to networks. Touch screens have become familiar in retail settings on point of sale systems on ATMs on mobile handsets on kiosks on game consoles and on PDAs where a stylus is sometimes used to manipulate the graphical user interface GUI and to enter data. A user can touch a touch screen or a touch sensor pad to manipulate data. For example a user can apply a single touch by using a finger to touch the surface of a touch screen to select an item from a menu.

The following description sets forth numerous specific details such as examples of specific systems components methods and so forth in order to provide a good understanding of several embodiments of the present invention. It will be apparent to one skilled in the art however that at least some embodiments of the present invention may be practiced without these specific details. In other instances well known components or methods are not described in detail or are presented in a simple block diagram format in order to avoid unnecessarily obscuring the present invention. Thus the specific details set forth are merely exemplary. Particular implementations may vary from these exemplary details and still be contemplated to be within the spirit and scope of the present invention.

In one embodiment a touch screen system may include a capacitive sensor array overlaying a display panel such as an LCD or LED display. The touch screen system may include a capacitance sensor that performs a capacitance measurement of one intersection between sensor elements conversion of the capacitive sensor array that may be based on a number of capacitance measurements subconversions associated with individual TX pulses. In one embodiment up to 255 subconversions may be performed over the course of a single conversion to determine a mutual capacitance between two intersecting sensor elements. In one embodiment the conversions and subconversions are sequenced and controlled by a TX RX sequencer state machine.

In one embodiment noise from a display panel such as an LCD panel may include pulsed noise caused by the LCD electrode excitation signals. The intervals between subsequent noise edges may vary within the range of microseconds to milliseconds. While some display panels may generate simple periodic noise waveforms others may generate more complex periodic waveforms with multiple edges. In one embodiment a display panel may generate a noise pattern depending on an image being displayed. Alternatively the noise pattern may be independent of the image being displayed.

In such a touch screen system the capacitive sensor array may be sufficiently sensitive to noise generated by the display panel that the noise may affect the capacitance measurements performed on the capacitive sensor array. Thus the touch screen system may generate a signal such as a start signal or a reject signal based on the noise signal. This start signal or reject signal may be used by a sequencer state machine to control the timing of capacitance measurements performed on the capacitive sensor array. In one embodiment a reject signal may cause the sequencer to abort a subconversion in progress at a time indicated by the reject signal. In one embodiment a start signal may cause the sequencer to initiate a subconversion or a conversion including multiple subconversions at a time indicated by the start signal. In one embodiment the start signal may initiate a state transition of the sequencer state machine.

In one embodiment a touch screen system may limit the sequencer state machine s sensitivity to the noise signal by generating a sensitivity window signal indicating time durations during which sensitive operations are being performed. In one embodiment the sequencer state machine may abort subconversions in progress when a reject signal is asserted within a sensitivity window. In one embodiment the sequencer state machine may ignore assertions of the reject signal that occur outside the sensitivity window. Embodiments of a touch screen system may thus ignore insignificant noise events responding to the noise signal only when characteristics of the noise signal are likely to interfere with accurate measurement of the capacitive sensor elements.

In one embodiment a touch screen system may receive signals from any of a number of available noise signal and synchronization signal sources and may control the timing of conversions or subconversions based on these signals. The touch screen system may further process the signals to delay reverse polarity debounce or perform other operations on the signal then use the processed signal as a basis for controlling the timing of conversions and subconversions.

By controlling the timing of conversions and subconversions based on a detected noise signal one embodiment of a touch screen system may be adaptable for use with display panels or other noise sources with differing noise characteristics. Controlling the timing of conversions and subconversions based on a detected noise signal may also increase the signal to noise ratio SNR for the conversions.

In one embodiment the sensor array includes sensor elements N where N is a positive integer that are disposed as a two dimensional matrix also referred to as an XY matrix . The sensor array is coupled to pins N of the processing device via one or more analog buses transporting multiple signals. In this embodiment each sensor element N is represented as a capacitor.

In one embodiment the capacitance sensor may include a relaxation oscillator or other means to convert a capacitance into a measured value. The capacitance sensor may also include a counter or timer to measure the oscillator output. The processing device may further include software components to convert the count value e.g. capacitance value into a sensor element detection decision also referred to as switch detection decision or relative magnitude. It should be noted that there are various known methods for measuring capacitance such as current versus voltage phase shift measurement resistor capacitor charge timing capacitive bridge divider charge transfer successive approximation sigma delta modulators charge accumulation circuits field effect mutual capacitance frequency shift or other capacitance measurement algorithms. It should be noted however instead of evaluating the raw counts relative to a threshold the capacitance sensor may be evaluating other measurements to determine the user interaction. For example in the capacitance sensor having a sigma delta modulator the capacitance sensor is evaluating the ratio of pulse widths of the output instead of the raw counts being over or under a certain threshold.

In one embodiment the processing device further includes processing logic . Operations of the processing logic may be implemented in firmware alternatively it may be implemented in hardware or software. The processing logic may receive signals from the capacitance sensor and determine the state of the sensor array such as whether an object e.g. a finger is detected on or in proximity to the sensor array e.g. determining the presence of the object where the object is detected on the sensor array e.g. determining the location of the object tracking the motion of the object or other information related to an object detected at the touch sensor.

In another embodiment instead of performing the operations of the processing logic in the processing device the processing device may send the raw data or partially processed data to the host . The host as illustrated in may include decision logic that performs some or all of the operations of the processing logic . Operations of the decision logic may be implemented in firmware hardware software or a combination thereof. The host may include a high level Application Programming Interface API in applications that perform routines on the received data such as compensating for sensitivity differences other compensation algorithms baseline update routines start up and or initialization routines interpolation operations or scaling operations. The operations described with respect to the processing logic may be implemented in the decision logic the applications or in other hardware software and or firmware external to the processing device . In some other embodiments the processing device is the host .

In another embodiment the processing device may also include a non sensing actions block . This block may be used to process and or receive transmit data to and from the host . For example additional components may be implemented to operate with the processing device along with the sensor array e.g. keyboard keypad mouse trackball LEDs displays or other peripheral devices .

The processing device may reside on a common carrier substrate such as for example an integrated circuit IC die substrate or a multi chip module substrate. Alternatively the components of the processing device may be one or more separate integrated circuits and or discrete components. In one embodiment the processing device may be the Programmable System on a Chip PSoC processing device developed by Cypress Semiconductor Corporation San Jose Calif. Alternatively the processing device may be one or more other processing devices known by those of ordinary skill in the art such as a microprocessor or central processing unit a controller special purpose processor digital signal processor DSP an application specific integrated circuit ASIC a field programmable gate array FPGA or other programmable device. In an alternative embodiment for example the processing device may be a network processor having multiple processors including a core unit and multiple micro engines. Additionally the processing device may include any combination of general purpose processing device s and special purpose processing device s .

In one embodiment the electronic system is implemented in a device that includes the touch sensing surface as the user interface such as handheld electronics portable telephones cellular telephones notebook computers personal computers personal data assistants PDAs kiosks keyboards televisions remote controls monitors handheld multi media devices handheld video players gaming devices control panels of a household or industrial appliances or other computer peripheral or input devices. Alternatively the electronic system may be used in other types of devices. It should be noted that the components of electronic system may include all the components described above. Alternatively electronic system may include only some of the components described above or include additional components not listed herein.

Capacitance sensor includes multiplexer control demultiplexer and multiplexer clock generator signal generator demodulation circuit and analog to digital converter ADC . ADC is further coupled with touch coordinate converter . Touch coordinate converter may be implemented in the processing logic .

The transmit and receive electrodes in the electrode matrix may be arranged so that each of the transmit electrodes overlap and cross each of the receive electrodes such as to form an array of intersections while maintaining galvanic isolation from each other. Thus each transmit electrode may be capacitively coupled with each of the receive electrodes. For example transmit electrode is capacitively coupled with receive electrode at the point where transmit electrode and receive electrode overlap.

Clock generator supplies a clock signal to signal generator which produces a TX signal to be supplied to the transmit electrodes of touch sensor . In one embodiment the signal generator includes a set of switches that operate according to the clock signal from clock generator . The switches may generate a TX signal by periodically connecting the output of signal generator to a first voltage and then to a second voltage wherein said first and second voltages are different.

The output of signal generator is connected with demultiplexer which allows the TX signal to be applied to any of the M transmit electrodes of touch sensor . In one embodiment multiplexer control controls demultiplexer so that the TX signal is applied to each transmit electrode in a controlled sequence. Demultiplexer may also be used to ground float or connect an alternate signal to the other transmit electrodes to which the TX signal is not currently being applied. In an alternate embodiment the TX signal may be presented in a true form to a subset of the transmit electrodes and in complement form to a second subset of the transmit electrodes wherein there is no overlap in members of the first and second subset of transmit electrodes .

Because of the capacitive coupling between the transmit and receive electrodes the TX signal applied to each transmit electrode induces a current within each of the receive electrodes. For instance when the TX signal is applied to transmit electrode through demultiplexer the TX signal induces an RX signal on the receive electrodes in matrix . The RX signal on each of the receive electrodes can then be measured in sequence by using multiplexer to connect each of the N receive electrodes to demodulation circuit in sequence.

The mutual capacitance associated with each intersection between a TX electrode and an RX electrode can be sensed by selecting every available combination of TX electrode and an RX electrode using demultiplexer and multiplexer . To improve performance multiplexer may also be segmented to allow more than one of the receive electrodes in matrix to be routed to additional demodulation circuits . In an optimized configuration wherein there is a 1 to 1 correspondence of instances of demodulation circuit with receive electrodes multiplexer may not be present in the system.

When a conductive object such as a finger approaches the electrode matrix the object causes a decrease in the measured mutual capacitance between only some of the electrodes. For example if a finger is placed near the intersection of transmit electrode and receive electrode the presence of the finger will decrease the charge coupled between electrodes and . Thus the location of the finger on the touchpad can be determined by identifying the one or more receive electrodes having a decrease in measured mutual capacitance in addition to identifying the transmit electrode to which the TX signal was applied at the time the decrease in capacitance was measured on the one or more receive electrodes.

By determining the mutual capacitances associated with each intersection of electrodes in the matrix the presence and locations of one or more conductive objects may be determined. The determination may be sequential in parallel or may occur more frequently at commonly used electrodes.

In alternative embodiments other methods for detecting the presence of a finger or other conductive object may be used where the finger or conductive object causes an increase in measured capacitance at one or more electrodes which may be arranged in a grid or other pattern. For example a finger placed near an electrode of a capacitive sensor may introduce an additional capacitance to ground that increases the total capacitance between the electrode and ground. The location of the finger can be determined based on the locations of one or more electrodes at which a change in measured capacitance is detected.

The induced current signal is integrated by demodulation circuit . The rectified current output by demodulation circuit can then be filtered and converted to a digital code by ADC .

A series of such digital codes measured from adjacent sensor or intersections may be converted to touch coordinates indicating a position of an input on touch sensor array by touch coordinate converter . The touch coordinates may then be used to detect gestures or perform other functions by the processing logic .

In one embodiment the capacitance sensor can be configured to detect multiple touches. One technique for the detection and location resolution of multiple touches uses a two axis implementation one axis to support rows and another axis to support columns. Additional axes such as a diagonal axis implemented on the surface using additional layers can allow resolution of additional touches.

One embodiment of a touch screen system may include an input for receiving an input signal that is generated based on a noise signal. For example this input signal may be a reject signal or a start signal. The touch screen system may further include a sequencer state machine coupled with the input. In one embodiment the sequencer state machine may perform a series of conversions or subconversions for measuring capacitances from a capacitive sensor to which it is connected. The sequencer state machine may further control the timing of such conversions or subconversions based on the input signal. For example the sequencer may start a subconversion or a conversion including multiple subconversions in response to detecting that a start signal is asserted or may abort a subconversion that is pending or in progress in response to detecting that a reject signal is asserted. In one embodiment where the capacitive sensor array is sensitive to the noise signal this method may increase the SNR for the capacitance measurements.

Master chip includes an Inter Integrated Circuit System Packet Interface IC SPI slave for communicating with a host device. In one embodiment the master chip may also include a touch screen subsystem TSS . The TSS includes an external noise input qualifier that receives an external reject signal an internal noise pulse qualifier and a multi chip synchronization circuit . In one embodiment a TX RX sequencer state machine may receive signals from any one or more of the pulse qualifier circuits and or the synchronization circuit and may further control the timing of conversions or subconversions performed on a capacitive sensor array based on signals received from the circuits or .

One embodiment of a master chip may also include other logic such as universal digital blocks UDBs or a digital system interconnect DSI . A UDB is a programmable logic block that may contain a combination of uncommitted logic and structured logic. A DSI may connect components of the master chip such as fixed function blocks I O pins interrups DMA signals and other system core blocks to a UDB array routing matrix.

In one embodiment of a single chip configuration as illustrated in the touch screen system may rely on either its own noise detection circuitry or may receive an input from an external noise detector. For example the external noise input qualifier receives an external reject signal which may be generated by an external noise detector. In an embodiment the external reject signal may be a signal supplied by an LCD panel. In an alternative embodiment the signal may be a synchronization signal that allows the sequencer to synchronize subconversions or conversions to a periodic noise signal.

The sequencer meters out the conversions subconversions TX pulses and other signals associated with scanning of a capacitive sensor array. In one embodiment the sequencer is a configurable state machine with timed and conditional transitions.

In one embodiment the sequencer controls the switch matrix via the switch matrix control to connect and disconnect TX or RX sensing channels from the appropriate sensor elements over the course of a conversion. The sequencer additionally controls the TX pump and driver via TX driver control circuit to transmit a TX signal on a sensor element on which a subconversion is being performed. The sequencer further controls the RX channels to receive the RX signal for the subconversion and controls the analog to digital converter ADC via ADC sequencer when converting the RX signal to a usable count value.

In one embodiment the ext reject signal may be received from an external device through a pin of the device on which the components of system are integrated. In one embodiment the ext reject signal may be interpreted as either a reject signal used to abort subconversions or as a start signal used to initiate subconversions or conversions.

In one embodiment the synchronization signal ext sync may be received by a multi chip synchronization circuit from an external device through a pin of a device on which components of touch screen system are integrated. In one embodiment the signal may be used to synchronize state transitions of the TX RX sequencer as a slave device to an external master device such as another integrated circuit chip including a similar touch screen system. Thus within each subconversion each of the slave device s state machines may progress in a synchronized manner. For example a multiple chip touch screen configuration may include multiple chips each connected to a separate capacitive sensor array. The chips may be synchronized to each other to coordinate scanning of their respective sensor arrays by transmitting and receiving at the same time. By this method the touch screen system may be used as a slave device to synchronize with a master device thus enabling large panel operation through the use of multiple capacitive sensor arrays.

In one embodiment the lx detect signal of the internal noise pulse qualifier may indicate that noise is detected by an internal noise detector. In one embodiment the lx detect is asserted in response to detecting a noise signal that is greater than or less than a predetermined threshold. In one embodiment asserting the lx detect signal initiates a rejection or synchronization of a subconversion. In one embodiment the lx detect signal may be generated as a result of a logical operation between an lx detect lo signal and an lx detect hi signal . In one embodiment signals and may be generated by comparators with different thresholds based on a signal from one or more of the receive RX channels . In one embodiment the signals and may be available as inputs to the DSI for use in UDB logic.

In one embodiment the reject signals output from the external noise input qualifier internal noise pulse qualifier and multi chip synchronization circuit may be used to cause the sequencer to abort and reject an ongoing subconversion. In one embodiment the reject signals of the external and internal noise pulse qualifiers and may be used in any combination or they may be incorporated into the reject signal from the multi chip synchronization circuit . In one embodiment the sequencer may ignore the start and reject signals from the external and internal noise pulse qualifiers when using the multi chip synchronization circuit.

In one embodiment the internal noise pulse qualifier may obtain noise information in the form of the lx detect hi or lx detect lo 452 signals which may be generated based on noise generated by a display panel such as an LCD panel. The raw noise signal may be obtained from one of the RX channels . In one embodiment the raw noise signal as processed by the pulse qualifier which may be configured by registers to perform operations such as debounce or change the polarity or phase delay of the noise signal. The outputs from the internal noise pulse qualifier include a reject signal that may cause the sequencer to abort and reset a subconversion that is in progress. The sequencer may further discard any measurement data acquired by the aborted subconversion.

In one embodiment the reject final signal that is input to the sequencer is the result of logical combination of the other reject signals from modules and the rej window signal. The logical combination may also include an input from the DSI so that the reject final signal may be controlled by a programmable UDB. In one embodiment the sequencer responds to the reject final signal by controlling the timing of a conversion or subconversion. For example in response to detecting that the reject final signal is asserted the sequencer may abort and reject a subconversion that is in progress during a time indicated by the assertion of the reject final signal. In one embodiment the sequencer does not begin a new subconversion until the reject final signal is deasserted. In one embodiment the subsequent subconversion attempts will be aborted until the reject final signal is deasserted. For instance if a reject occurs the ongoing subconversion may be aborted and a new subconversion may start however the new subconversion may also be rejected some time later during the sensitivity window. Thus in one embodiment the rejection of a subconversion does not prevent a new subconversion from starting.

In one embodiment the internal noise pulse qualifier may also generate a start signal by processing the raw noise signal. The start signal may cause the sequencer to initiate a subconversion or may be used by the sequencer to synchronize a series of subconversions to the noise signal.

In one embodiment the circuit modules and may have configuration parameters stored in registers . The use of each of the rejection or synchronization sources for rejecting or initiating subconversions or conversions may be configured through the registers .

In one embodiment the external noise input qualifier receives an external signal from a noise detector and causes the sequencer to control timing of one or more conversions or subconversions based on the received external signal. In one embodiment the external noise input qualifier may process the external signal by performing polarity phase delay edge or level detection debouncing or other functions on the external signal. The external signal may be used before or after processing to cause the sequencer to either reject and abort subconversions or to initiate subconversions.

The Trej filter duration is a threshold duration associated with filtering of the ext reject signal . In one embodiment if pulse of ext reject has a shorter duration than Trej filter the pulse is not reflected in the reject signal or or the start signal . Trej delay is a delay between a time when the ext reject signal is asserted and the time when the reject and start signals are asserted in response to the ext reject signal . In one embodiment the delay is configurable through the use of configuration registers . In one embodiment both the start signal and the reject signals and may be delayed by the Trej delay parameter to accommodate any delay between the asserting or deasserting of the ext reject signal and the effect of the noise on the conversions or subconversions.

In one embodiment the ext reject signal may be configured to cancel an ongoing subconversion in response to detecting that a noise signal has exceeded a threshold. The ext reject signal may alternatively be configured to start a conversion only after a timed synchronization pulse is received. In one embodiment a combination of these strategies may also be used. For example these signals may be made available to programmable UDBs through the DSI.

In one embodiment a system operating in edge detect mode may generate a reject signal by interpreting each positive or negative edge of the ext reject signal as a noise event. A programmable duration Trej length may determine the length of time that the edge mode reject signal is asserted in response to a positive or negative edge of ext reject . The duration of Trej length may be stored for example in configuration registers .

In one embodiment a system operating in a level detect mode may generate a reject signal by interpreting a level of ext reject exceeding a predetermined threshold as an ongoing noise event. The level mode reject signal may be asserted for as long as the ext reject signal exceeds the predetermined threshold. Thus the level mode reject signal may be deasserted a period of time after the deassertion of ext reject that is approximately equal to Trej delay Trej filter.

In one embodiment as illustrated in the reject signal from the external noise input qualifier may be logically combined with one or more reject signals from other sources such as an internal noise pulse qualifier or a multi chip synchronization circuit to generate a reject final signal. In one embodiment the sequencer controls the timing of conversions or subconversions in response to the reject final signal.

After a rejection of a subconversion a new subconversion may be automatically started either immediately or in response to a synchronization event such as assertion of a start signal.

In one embodiment the reject signals may cause the sequencer to abort and reject an ongoing subconversion only when a sensitivity window signal rej window is asserted indicating that a noise sensitive operation is being performed. In one embodiment a sequencer such as sequencer may assert a sensitivity window to indicate a time duration during which a subconversion or other sensitive operation is being performed. The sequencer may abort and reject the subconversion in response to detecting that a rejection signal such as reject final is asserted during the time duration indicated by the sensitivity window.

In one embodiment the sensitivity window is configurable to encompass either the entire subconversion or only a portion of the entire subconversion such as the integration periods within the subconversion. In one embodiment the sensitivity window can be configured to encompass a particular time period with a predetermined margin and phase delay.

In one embodiment the start of the sensitivity window rej window may be configured by one or more programmable registers which allows the start of the sensitivity window the flexibility to move into a subsequent state of the sequencer state machine. Thus the sensitivity window can more readily be timed to encompass the time associated with a subconversion or other sensitive operation.

In one embodiment the start signals output from modules may be used to cause the sequencer to start a subconversion or a series of subconversions. In one embodiment the start signals may be pulse mode signals that initiate a subconversion upon a rising or falling edge which may indicate a time for initiating the subconversion.

In one embodiment the start signal may be used to synchronize individual TX pulses to an external signal source. For example the start signal may allow a series of TX pulses to be synchronized to an LCD framer clock.

In one embodiment the start signals from modules may be logically combined resulting in a start final signal. The logical combination may also include inputs from the DSI to allow the start final signal to be controlled by a programmable UDB. In one embodiment the sequencer responds to assertion of the start final signal by initiating a subconversion or by synchronizing a series of subconversions with the start final signal.

Start signal may be subsequently generated based on the lx detect filtered signal . For example each pulse of start signal may be generated to follow a pulse of lx detect filtered by a configurable delay of Trej delay . In one embodiment the lx detect filtered signal causes a pulse to be generated on the start signal only after the lx detect filtered signal is asserted for a minimum duration of Trej filter . In one embodiment Trej filter thus operates as a filtering delay that may also be configurable using registers or other memory.

In one embodiment pulses of the start signal may cause a sequencer state machine such as sequencer to change its state to one or more conversion states during which a subconversion may be performed. For example the first pulse of start signal causes the sequencer state to advance to the convert state during which a subconversion may be performed. In one embodiment pulses of the start signal are timed so that the subconversion may be completed in the quiet time between the large low frequency noise pulses as illustrated in .

In one embodiment an interval discriminator circuit coupled with the sequencer may be used to identify a predetermined feature of the noise signal such as a specific recurring interval in the periodic signal. The recurring interval may then be used to time a series of subconversions so that each subconversion is performed during similar noise conditions. For example a subconversion performed during the convert state may be performed under similar noise conditions as subconversions performed during subsequent convert states. The noise may then appear as a constant offset which can be more easily compensated.

For example the interval between pulses C and D may be identified by an interval discriminator circuit based on the interval count between the pulses C and D. In one embodiment the interval discriminator circuit may measure the interval C D from the end of a previous noise event C to the beginning of a current noise event D. When the length of the interval falls within a predetermined range a start signal pulse is generated. In one embodiment when the interval is identified a pulse may be generated in the lx detect filtered signal . In response to this pulse another pulse may be generated in the start signal after a configurable delay of Trej delay .

In one embodiment during either of the methods as illustrated in a reject signal may also be used to abort and reject an ongoing subconversion in response to an unexpected noise event that occurs during the synchronized subconversions. In one embodiment a listen channel may also be used for noise subtraction while either of these methods is in use.

In one embodiment a pulse of start signal may be generated in response to an assertion of the ext reject signal . In one embodiment the start pulse may be repeated to trigger subsequent subconversions. The start pulses may be spaced apart in time by a configurable duration Trej repeat . In one embodiment the duration of Trej repeat is constant alternatively the duration of Trej repeat may vary over time. In one embodiment either or both of the external noise input qualifier and the internal noise pulse qualifier may implement a repeat start function such that the series of start pulses may be generated even when the ext reject signal does not assert or the noise signal decreases below a detection threshold. Thus conversions or subconversions that are started based on the pulse qualifier output do not stop or hang if for some reason the noise or synchronization signal disappears.

In one embodiment the repeated start functionality allows the generation of repeated start signals at a programmable interval. This could be used as a backup in the case where an external or internal signal is being used to generate start signals to the sequencer state machine. Repeated start generation would reduce the likelihood that the sequencer state machine would hang if for some reason the external or internal noise signals stopped asserting.

In one embodiment an input or pulse qualifier implementing a repeat start function may also implement a programmable noise timeout nse timeout. If no ext reject pulse is received for a duration defined by nse timeout an interrupt flag may be asserted to indicate that the ext reject signal has stopped asserting. This may indicate a problem with the noise detection scheme or a change in the noise profile which may then be addressed by the system.

In one embodiment a start signal pulse may be generated in response to a period of low noise detected by a noise detection circuit. The start pulse may then be used by a sequencer to initiate a subconversion during the detected period of low noise.

In one embodiment the internal noise pulse qualifier implements reject and start signals having similar functionality as the level mode and edge mode reject signals and and the start signal as illustrated in . The two qualifier circuits and differ in their input signals the external noise input qualifier receives and processes the ext reject signal while the internal noise pulse qualifier processes the lx detect signal from an RX channel used as an internal listen channel.

In one embodiment the touch screen system may implement a noise characterization mode which allows profiling of a noise pattern of a noise source such as an LCD panel. In one embodiment such a noise characterization process may determine the high and low times of the noise pattern. This characterization data may be stored in RAM or other memory such that one or more configurations for the pulse qualifier may be selected for use based upon the characterization data making up the noise profile. These configurations that could be selected based on the characterization data may include parameters such as the Trej filter and interval discrimination limits.

If the measured noise value is less than the threshold noise value the capacitance data may be used to calculate the location of a contact on the sensing array in block . If the measured noise value is greater than the threshold noise value the noise event time count for each sample of the internal noise pulse qualifier may be stored in a memory such as RAM in block . The maximum noise event of the stored noise events of block may be determined in block . The interval count may be calculated based on the maximum noise event or time count from the values stored in memory. The interval count of a noise event is shown in interval count for lx detect signal . In one embodiment margin may be applied to the interval count by reducing the value from the maximum value by some percentage. The interval count may then be used to synchronize the capacitance measurement circuitry to the period of the noise source. Once the capacitance measurement circuitry is synchronized to the period of the noise source the noise will not appear in the capacitance data.

For the example shown in Table 1 the maximum value is 5000 seen in sample . The high low data is indicative of a positive or negative edge of the pulse as illustrated in . The interval count of T may be set to 5000 minus the margin value. A 10 margin may be used to give the interval count a value of 4500. For the example in Table 1 with an interval count of 4500 the capacitance sensing circuitry may not initiate a scan if a noise event is detected by the listening channel during the interval count. After the interval count is reached and no noise event has been detected the capacitance sensing circuit may be enabled and a scan of the capacitance sensing array initiated. This ensures that measurement of capacitance for each sensor or sensors occurs at the same time relative to the detected noise in the system.

In one embodiment the interval count may be used to tune the lx detect filtered signal so that a single clean pulse is output. The single clean pulse may then be used to synchronize to the noise signal or to reject conversions.

Embodiments of the present invention described herein include various operations. These operations may be performed by hardware components software firmware or a combination thereof. As used herein the term coupled to may mean coupled directly or indirectly through one or more intervening components. Any of the signals provided over various buses described herein may be time multiplexed with other signals and provided over one or more common buses. Additionally the interconnection between circuit components or blocks may be shown as buses or as single signal lines. Each of the buses may alternatively be one or more single signal lines and each of the single signal lines may alternatively be buses.

Certain embodiments may be implemented as a computer program product that may include instructions stored on a computer readable medium. These instructions may be used to program a general purpose or special purpose processor to perform the described operations. A computer readable medium includes any mechanism for storing or transmitting information in a form e.g. software processing application readable by a machine e.g. a computer . The computer readable storage medium may include but is not limited to magnetic storage medium e.g. floppy diskette optical storage medium e.g. CD ROM magneto optical storage medium read only memory ROM random access memory RAM erasable programmable memory e.g. EPROM and EEPROM flash memory or another type of medium suitable for storing electronic instructions.

Additionally some embodiments may be practiced in distributed computing environments where the computer readable medium is stored on and or executed by more than one computer system. In addition the information transferred between computer systems may either be pulled or pushed across the transmission medium connecting the computer systems.

Although the operations of the method s herein are shown and described in a particular order the order of the operations of each method may be altered so that certain operations may be performed in an inverse order or so that certain operation may be performed at least in part concurrently with other operations. In another embodiment instructions or sub operations of distinct operations may be in an intermittent and or alternating manner.

In the foregoing specification the invention has been described with reference to specific exemplary embodiments thereof. It will however be evident that various modifications and changes may be made thereto without departing from the broader spirit and scope of the invention as set forth in the appended claims. The specification and drawings are accordingly to be regarded in an illustrative sense rather than a restrictive sense.

