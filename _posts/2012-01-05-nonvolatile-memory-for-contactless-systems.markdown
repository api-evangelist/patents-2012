---

title: Non-volatile memory for contactless systems
abstract: A contactless system is described in which energy is scavenged from an electromagnetic field provided by a proximate reader device. An embedded processor and a volatile memory circuit within a near field communication (NFC) controller are operated using the scavenged energy. Parameter data from the proximate reader device may be acquired while conducting a near field communication transaction. A non-volatile memory (NVRAM) server is coupled to the NFC controller and also operates using the scavenged energy. Parameter data may be stored within the NVRAM server by sending a command and the parameter data from the NFC controller to the NVRAM server. At the completion of the transaction, the electromagnet field may be removed and all parameter data stored within the NFC controller will be lost. However, the next time the electromagnetic field is applied, the NFC controller may retrieve the parameters from the NVRAM server by sending a command.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08811896&OS=08811896&RS=08811896
owner: Texas Instruments Incorporated
number: 08811896
owner_city: Dallas
owner_country: US
publication_date: 20120105
---
The present application claims priority to and incorporates by reference U.S. Provisional Application No. 61 430 784 filed Jan. 7 2011 entitled Non Volatile Memory Solution for Contactless Systems. 

This invention generally relates to use of a near field communication controller within a mobile or a portable device such as a cell phone or a laptop tablet computer.

Near Field Communication NFC is a wireless technology allowing two devices to communicate over a short distance of approximately 10 cm or less. NFC is standardized internationally within NFC Forum specifications and defined in ISO IEC 18092 ECMA 340 and ISO 14443 for example. NFC allows a mobile handset to interact with a subscriber s immediate environment. With close range contactless technology mobile handsets may be used as credit cards to access public transportation to access secured locations and many more applications.

A chip in the handset may perform the wireless near field communication to an adjacent reader smart card or other handset. The display keyboard and the mobile network capability of the handset enable the implementation of a wide range of powerful applications. To protect the consumer some of these applications must be securely deployed and managed regardless of where the subscriber is and the time of day. The UICC universal integrated circuit card also referred to as USIM universal subscriber identity module is a secure environment for deploying these applications. An embedded secure environment chip may also be provided by some handsets.

A subscriber identity module SIM is an integrated circuit that securely stores its unique serial number ICCID an International Mobile Subscriber Identity IMSI and the related key used to identify and authenticate subscriber on mobile telephony devices such as mobile phones and computers. A SIM also contains temporary information related to the local network a list of the services to which the user has access and passwords.

USIM Universal Subscriber Identity Module is an application for UMTS mobile telephony running on a UICC smart card which is inserted in a 3G mobile phone. There is a common misconception to call the UICC itself a USIM but the USIM is merely a logical entity on the physical card. It stores user subscriber information authentication information and provides storage space for text messages and phone book contacts. The phone book on a UICC has been greatly enhanced. For authentication purposes the USIM stores a long term pre shared secret key which is shared with the Authentication Center AuC in the network. The USIM also verifies a sequence number that must be within a range using a window mechanism to avoid replay attacks and is in charge of generating the session keys to be used in the confidentiality and integrity algorithms of the KASUMI block cipher in UMTS. The equivalent of USIM on CDMA networks is CSIM.

The capabilities of a UICC have been skyrocketing in the last few years with fast processors and multi megabyte capacities squeezed into the diminutive package. A UICC card is typically connected to a host processing module on a handset using an ISO 7816 Industry Standards Organization protocol while a UICC may also include a fast universal serial bus USB interface. The adoption of USB leaves one pin free on the UICC package and it is over this single wire that the USIM can communicate with NFC hardware on the handset. Alternatively other pins may be used such as programming voltage VPP pin C6 that is available regardless of USB use. The Single Wire Protocol SWP for this purpose has been approved as a standard by the European Technical Standards Institute ETSI as TS 301 613.

Various systems may also include an embedded security element that includes a processor and memory. The embedded security element may include a secure operating system that allows the execution of various applications within the security element. Currently vendors such as Gemalto and Giesecke Devrient provide secure operating systems for use on embedded security elements. The embedded security element will have an interface to communicate with the NFC hardware this interface may be SWP compliant or some vendor specific protocol.

Other features of the present embodiments will be apparent from the accompanying drawings and from the detailed description that follows.

Specific embodiments of the invention will now be described in detail with reference to the accompanying figures. Like elements in the various figures are denoted by like reference numerals for consistency. In the following detailed description of embodiments of the invention numerous specific details are set forth in order to provide a more thorough understanding of the invention. However it will be apparent to one of ordinary skill in the art that the invention may be practiced without these specific details. In other instances well known features have not been described in detail to avoid unnecessarily complicating the description.

A near field communication NFC controller needs access to a block of non volatile memory to hold various parameters used in each communication protocol supported by the NFC controller. A solution for non volatile memory for use by a NFC controller in contactless systems based on use of non volatile memory embedded within an adjacent device is described herein. The adjacent device may be either an embedded security device or a UICC SIM for example. The term contactless system in this document is intended to cover any contactless system such as NFC ISO14443 ISO 15693 proximity cards any RFID radio frequency identification system etc. that requires a contactless controller to have information stored in a non volatile memory.

Contactless systems have been around for a while and are common as access control ID s e.g. employee badges as well as payment systems for public transportation etc. More recently credit cards are beginning to include NFC capability. Lately contactless capabilities are being integrated into mobile phones as well recent examples are Nokia s 6212 phone and Google s Android which supported NFC in its latest release.

A key difference between the implementation of the stand alone contactless cards described above and implementation of a mobile phone contactless system is the manufacturing process and its capabilities used to produce the contactless controller used in a mobile handset. The stand alone contactless cards usually contain a contactless controller manufactured in an analog friendly process that produces relatively large size transistors in which non volatile memory is common and cheap. However most of the contactless controllers for mobile handsets will be manufactured in a deep sub micron CMOS process so that they can be easily integrated with other modules in the handset such as WLAN wireless local area network Bluetooth etc. for size reduction and platform optimization. One draw back of these advanced processes is the lack or high cost of non volatile memory space.

In order to enable low or no battery operation there is a requirement to store information in a non volatile manner. This information may include parameters defining the tag configuration for example. Low or no battery operation is required to allow a user to still have access to credit cards access codes transportation tokens etc even if the battery in their mobile handset has been depleted or even removed.

A simple but costly solution in terms of price and system size would be to connect an external non volatile memory device such as an EEPROM electrically erasable programmable read only memory etc. to a NFC controller. This would require an extra component and additional space on the substrate or circuit board to which the NFC controller is mounted.

The phone processor may be connected to a large non volatile memory such as a very large flash memory. However since some of the NFC applications may be required to operate when the battery is mostly or completely depleted e.g. for transportation ticketing small credit card payments etc. the processor and processor s memory would not be available for use by the NFC while the battery is low or dead.

A better solution is to provide NVRAM non volatile random access memory service to the contactless controller from another device that is already present within the mobile handset and operational in the same usage scenarios. The mobile handset may also contain a security device that may be either an embedded security element SE or the UICC or both that is connected to the NFC controller. The security device is also active when contactless activities occur since it is required for many contactless use cases including payment and access control. These security devices contain a relatively large amount of non volatile memory and are capable of running various applications also referred to as applets.

An embodiment of the invention may use the security device as a non volatile memory service provider by having a specific non volatile applet on the security device either as part of the operating system installed by the phone manufacturer on the embedded security device or by the phone service provider on the UICC SIM. This saves both the cost and effort of adding a specific non volatile memory device. A standardized and simple API application programming interface may be provided to support the NVRAM service over an existing interface between the security device and the contactless controller such as SWP single wire protocol etc.

The non volatile memory service may also be secured if required by employing an authentication scheme on power up events for example in order to maintain the secure environment of the embedded security element and or the UICC.

The SIM card memory was previously only used for the on board SIM applications and services such as phone book info. This on board service is defined by standardized SIM toolkit specifications and managed by a SIM application. API s are provided that enable the mobile handset s processor to use this service. However since some NFC applications must work while the battery is low or dead accessing the SIM using API by the host processor is not feasible.

Conversely embodiments of the invention request direct and simple memory access between the NFC controller and the security element. Configuring the UICC SIM secure element to act as an NVRAM server provides an elegant solution since the UICC SIM secure element is required to be operating in these cases as well.

NFC is a set of short range wireless technologies typically requiring a distance of 4 cm or less. Some NFC embodiments operate at 13.56 MHz on ISO IEC 18000 3 air interface and at rates ranging from 106 kbit s to 424 kbit s for example. Other embodiments may be based on existing radio frequency identification RFID contactless standards including ISO IEC 14443 and FeliCa for example. Embodiments may also utilize later developed standards for contactless communication. NFC always involves an initiator and a target the initiator actively generates an RF field that can power a passive target. This enables NFC targets to take very simple form factors such as tags stickers key fobs or cards that do not require batteries. NFC peer to peer communication is possible provided both devices are powered. NFC tags contain data and are typically read only but may be rewriteable. They can be custom encoded by their manufacturers or use the specifications provided by the NFC Forum an industry association charged with promoting the technology and setting key standards. The tags can securely store personal data such as debit and credit card information loyalty program data PINs and networking contacts among other information. The NFC Forum defines four types of tags which provide different communication speeds and capabilities in terms of configurability memory security data retention and write endurance. Tags currently offer between 96 and 4 096 bytes of memory.

As mentioned above stand alone contactless cards usually contain a contactless controller manufactured in an analog friendly process that produces relatively large size transistors in which non volatile memory is common and cheap.

As discussed above mobile handsets are now being configured to emulate credit cards access cards bus transportation tokens etc. In order to support these applications an embedded secure element eSE may be included within handset . eSE includes an embedded processor that may execute application software stored in NVRAM or in other read only memory not shown within eSE .

In principle NFC controller operates similarly to contactless device . Embedded processor may include simple ROM in which various application programs are stored for execution by embedded processor . The NFC Controller s ROM may also include and run the Media Access MAC layer of the NFC contactless protocols as well as handle the interfaces to the NFC Execution Environments UICC eSE which would include and run these various application programs.

However as described above in order to reduce cost and size NFC controller may be fabricated on the same integrated circuit as baseband processor and eSE . This integrated circuit may be manufactured in a deep sub micron CMOS process in which writable non volatile memory structures are not feasible or very expensive. Therefore NVRAM that is needed by the NFC controller needs to be separate from the integrated circuit IC that contains NFC controller .

NFC controller is designed to perform transactions with nearby devices using standardized protocols. An example of such a protocol is ISO IEC 14443. ISO IEC 14443 consists of four parts and describes two types of cards Type A and Type B both of which communicate via radio at 13.56 MHz. The main differences between these types concern modulation methods coding schemes Part 2 and protocol initialization procedures Part 3 . For example in one protocol NFC employs two different codings to transfer data. If an active device transfers data at 106 kbit s a modified Miller coding with 100 modulation is used. In all other cases Manchester coding is used with a modulation ratio of 10 . Both Type A and Type B cards use the same transmission protocol described in Part 4. The transmission protocol specifies data block exchange and related mechanisms data block chaining waiting time extension multi activation etc. There are other types of defined protocols such as type F etc.

There are two modes of near field communication passive communication mode and active communication mode. In passive communication mode the initiator device provides a carrier field and the target device answers by modulating the existing field. In this mode the target device may draw its operating power from the initiator provided electromagnetic field thus making the target device a transponder. In active communication mode both initiator and target device communicate by alternately generating their own fields. A device deactivates its RF field while it is waiting for data. In this mode both devices typically have power supplies. NFC devices are able to receive and transmit data at the same time. Thus they can check for potential collisions if the received signal frequency does not match with the transmitted signal s frequency.

For each protocol of a certain ISO DEP type sixteen or more bytes of NVRAM may be required to identify the application also known as Application ID or AID As discussed above there may be a number of protocols that need to be supported on a mobile handset in which it is desirable to emulate a large number of credit cards access cards transportation cards token etc. Therefore a considerable amount of NVRAM may be needed by NFC controller to keep track of all of the various parameters.

As discussed above it may not be practical to implement NVRAM on the same IC that contains NFC controller . NFC controller is coupled to UICC via an interface such as single wire protocol. Similarly NFC controller is coupled to eSE via an interface such as single wire protocol. Other embodiments may use a different interconnect protocol for these connections. Rather than providing a separate NVRAM component that is coupled to NFC controller either or both UICC and eSE may execute an NVRAM server app on their respective embedded processors that provides NVRAM service from their respective embedded NVRAMs as indicated by dotted lines . In this manner NVRAM is not a separate component but is actually located within NVRAM .

When mobile handset is turned off or its battery charge is low or depleted NFC controller may be powered by resonant inductive coupling via an LC circuit including a capacitor not shown and antenna coil that are connected in parallel. When handset is placed in proximity to a card reader the card reader produces an electromagnetic field that excites the coil and resonant current charges the capacitor which in turn energizes and powers NFC in a similar manner to the operation of contactless device . In this embodiment the resonant circuit of NFC is capable of producing enough current to power NFC controller and UICC by scavenging power from the electromagnet field when handset is placed in proximity to an external card reader or other reader device. Operation of UICC in low power mode including processor and NVRAM requires approximately 5 ma. Power sharing circuitry is provided that allows UICC and NFC controller to operate from battery or an external power source that is connected to power management circuitry or from power scavenged from an impinging electromagnetic signal by coil when battery power or external power is not available. Similarly eSE may be configured to operate in a low power mode using power scavenged from an impinging electromagnetic field when battery power or external power is not available. Therefore UICC and or eSE may be able to provide NVRAM service to NFC controller even when the handset battery is turned off depleted of charge or even removed from handset .

UICC host NVapp gate and UICC host administration gate are logic modules that may be implemented within UICC by executing software instructions stored within NV memory or other read only memory by embedded processor . Host controller administration gate and host controller firmware are logic modules that may be implemented within NFC controller by executing software instructions stored within read only memory by embedded processor .

When handset is turned on an initialization process is performed that assigns unique and static pipe ID such as 0x67 for example so that host controller logic will always know what the pipe ID is. Pipes also know as streams is a well known technique used to transfer data between a requester device and a target device as a stream of data destined to a selected pipe ID rather than by doing individual read write accesses to selected individual memory addresses. This allows the actual memory address of a block of data that is stored on the target device to be masked from the requester device. Pipes operate in a similar manner to message passing another known technique for transferring data between two devices. A pipe ID is used to define both the target if there are more than two devices coupled together and also to define a particular block of data that is of interest. In this embodiment data is transferred between the NVRAM server in the UICC to the NFC controller over a single wire protocol SWP interface. In other embodiments other types of physical and logical interconnection may be implemented between the NVRAM server and the NFC controller.

As mentioned earlier initialization process may also include an authentication scheme on power up events for example in order to maintain the secure environment of the embedded security element and or the UICC.

Using the assigned pipe ID NFC controller firmware may request configuration information for a block of NVRAM that will be served by NVapp on UICC using a get memory size API command. NFC controller firmware may receive registry information during a transaction with an external reader and than send the registry information to NVRAM server app for storage on NVRAM within UICC using a write memory address size data API command. Additional transactions may occur that produce additional registry information that is likewise sent to the NVRAM server app via the assigned pipe using write memory API commands. The registry information is also stored in volatile memory within NFC controller .

At some point handset my be turned off either by a user or its battery may run down and power management logic may turn the handset off. Due to this loss of power all registry information stored within NFC controller is lost .

A transaction is then performed in response to the proximate near by reader device. The transaction may produce updated registry data such as a transaction count etc that is stored in the NFC controller s volatile RAM and also sent to the NVRAM server via a write memory address length data API command. The transaction may include additional interaction with an application being executed on UICC that emulates a particular credit card access transportation token etc.

When the transaction is completed the proximate reader device may turn off the electromagnetic field and therefore the volatile memory holding the registry data in NFC controller will be reset . However the registry data is preserved by NVRAM server .

This sequence of field on low power initialization registry restoration from the NVRAM server transaction registry update NVRAM server update and then field off may be repeated a number of times in response to the proximate reader device during the course of a point of sale operation or other type of NFC operation. In some reader implementations the field may be left on for a longer period of time while several transactions are performed. However eventually the proximate reader will turn off the field and the NFC controller local registry information will be lost but the NVRAM server will maintain the registry information that was sent to it by the NFC controller.

In case the UICC was removed from the handset and replaced with a UICC that does not include the NVapp then an error will be returned to a read memory command. In case the UICC was removed and replaced with a different UICC that does include an NVapp and the parameter data stored therein is valid then the NFC controller may continue using the stored registry data in the new UICC card as it is relevant for this UICC configuration.

For example NFC controller may request configuration information for a block of NVRAM that will be served by NVapp on the secure element using a get confiuration API command. NFC controller may receive registry information during a transaction with an external reader and than send the registry information to NVRAM server app for storage on a NVRAM within the secure element using a write memory address size data API command. Additional transactions may occur that produce additional registry information that is likewise sent to the NVRAM server app via the communication channel using write memory API commands. The registry information is also stored in volatile memory within NFC controller .

At some point the system may be turned off either by a user or its battery may run down and power management logic may turn the system off. Due to this loss of power all registry information stored within NFC controller is lost .

A transaction is then performed in response to the proximate reader device. The transaction may produce updated registry data such as a transaction count etc that is stored in the NFC controller s volatile RAM and also sent to the NVRAM server via a write memory address length data API command. The transaction may include additional interaction with an application being executed on the secure element that emulates a particular credit card access transportation token etc.

When the transaction is completed the proximate reader device may turn off the electromagnetic field and therefore the volatile memory holding the registry data in NFC controller will be reset . However the registry data is preserved by NVRAM server .

RF transceiver is a digital radio processor and includes a receiver for receiving a stream of coded data frames from a cellular base station via antenna and a transmitter for transmitting a stream of coded data frames to the cellular base station via antenna . RF transceiver is coupled to DBB which provides processing of the frames of encoded data being received and transmitted by cell phone .

DBB unit may send or receive data to various devices connected to universal serial bus USB port . DBB can be connected to subscriber identity module SIM card and stores and retrieves information used for making calls via the cellular system. DBB can also connected to memory that augments the onboard memory and is used for various processing needs. DBB can be connected to Bluetooth baseband unit for wireless connection to a microphone and headset for sending and receiving voice data. DBB can also be connected to display and can send information to it for interaction with a user of the mobile UE during a call process. Touch screen may be connected to DBB for haptic feedback. Display may also display pictures received from the network from a local camera or from other sources such as USB . DBB may also send a video stream to display that is received from various sources such as the cellular network via RF transceiver or camera . DBB may also send a video stream to an external video display unit via encoder over composite output terminal . Encoder unit can provide encoding according to PAL SECAM NTSC video standards. In some embodiments audio codec receives an audio stream from FM Radio tuner and sends an audio stream to stereo headset and or stereo speakers . In other embodiments there may be other sources of an audio stream such a compact disc CD player a solid state memory module etc.

NFC controller may be implemented within the same IC as baseband processor and manufactured using a deep sub micron CMOS process that does not provide embedded NVRAM. SIM card and or embedded security element may provide NVRAM service to NFC controller as described in more detail above. In this manner NFC controller may operate on a separate power domain within the IC so that it can be operated by power scavenged from an impinging electromagnetic field from a proximate reader device. SIM card and or eSE may also be operated by the scavenged power and thereby provide NVRAM service to NFC controller .

While the invention has been described with reference to illustrative embodiments this description is not intended to be construed in a limiting sense. Various other embodiments of the invention will be apparent to persons skilled in the art upon reference to this description. For example while a mobile handset and were descried herein other types and configurations of mobile handsets may embody an NVRAM server for use by a contactless communication system as described herein. Other portable or mobile systems such as data tablets personal digital assistants portable computers game handsets remote controls access badges and fobs smart credit debit cards and emulators and any other now known or later developed systems may embody an NVRAM server for use by a contactless communication system as described herein.

Furthermore various fixed systems that perform contactless communication such as card readers access systems transportation ticketing systems etc may embody an NVRAM server for use by a contactless communication system as described herein.

While an NVRAM server was described herein that responds to API commands using a pipe or stream protocol other embodiments may use a message passing protocol or other now known or later developed techniques for exchanging data packets between two coupled devices.

While an interconnection between the NFC controller and the NVRAM server eSE or UICC has been described herein as being based on the standardized Single Wire Protocol other embodiments may use a different interconnect mechanism such as a USB multiple parallel signals etc. as long as low power operation can be performed to allow transfer of data between the NFC controller and the NVRAM server module.

The techniques described in this disclosure may be implemented in hardware software firmware or any combination thereof. If implemented in software the software may be executed in one or more processors such as a microprocessor application specific integrated circuit ASIC field programmable gate array FPGA or digital signal processor DSP . The software that executes the techniques may be initially stored in a computer readable medium such as compact disc CD a diskette a tape a file memory or any other computer readable storage device and loaded and executed in the processor. In some cases the software may also be sold in a computer program product which includes the computer readable medium and packaging materials for the computer readable medium. In some cases the software instructions may be distributed via removable computer readable media e.g. floppy disk optical disk flash memory USB key via a transmission path from computer readable media on another digital system etc.

Certain terms are used throughout the description and the claims to refer to particular system components. As one skilled in the art will appreciate components in digital systems may be referred to by different names and or may be combined in ways not shown herein without departing from the described functionality. This document does not intend to distinguish between components that differ in name but not function. In the preceding discussion and in the claims the terms including and comprising are used in an open ended fashion and thus should be interpreted to mean including but not limited to . . . . Also the term couple and derivatives thereof are intended to mean an indirect direct optical and or wireless electrical connection. Thus if a first device couples to a second device that connection may be through a direct electrical connection through an indirect electrical connection via other devices and connections through an optical electrical connection and or through a wireless electrical connection for example.

Although method steps may be presented and described herein in a sequential fashion one or more of the steps shown and described may be omitted repeated performed concurrently and or performed in a different order than the order shown in the figures and or described herein. Accordingly embodiments of the invention should not be considered limited to the specific ordering of steps shown in the figures and or described herein.

It is therefore contemplated that the appended claims will cover any such modifications of the embodiments as fall within the true scope and spirit of the invention.

