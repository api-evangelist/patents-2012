---

title: Clearinghouse server for internet telephony and multimedia communications
abstract: A clearinghouse server for routing multi-media communications, including telephony calls, between a source device and a destination device via a distributed computer network, such as the global Internet. The clearinghouse server can authorize the completion of a communication from a source device to a destination device and collect usage-related information for the completed communication. In response to an authorization request issued by an enrolled source device, the clearinghouse server can identify one or more available destination devices available to accept a communication from an authorized source device. The clearinghouse server can provide a list of the identified destination devices, typically organized in a rank order, by sending an authorization response to the source device. In turn, the source device can use this list to select a destination device and contact that selected device via the computer network to complete the communication.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09094504&OS=09094504&RS=09094504
owner: TRANSNEXUS, INC.
number: 09094504
owner_city: Atlanta
owner_country: US
publication_date: 20120916
---
The present application is a continuation of and claims priority under 35 U.S.C. 120 to U.S. Nonprovisional patent application Ser. No. 13 026 213 entitled CLEARINGHOUSE SERVER FOR INTERNET TELEPHONY AND MULTIMEDIA COMMUNICATIONS filed on Feb. 12 2011 now U.S. Pat. No. 8 289 974 which is a continuation of U.S. nonprovisional patent application Ser. No. 11 282 945 entitled CLEARINGHOUSE SERVER FOR INTERNET TELEPHONY AND MULTIMEDIA COMMUNICATIONS filed on Nov. 17 2005 now U.S. Pat. No. 7 912 067 and which is a continuation of U.S. nonprovisional patent application Ser. No. 09 952 938 now U.S. Pat. No. 7 017 050. The contents of these patent applications are hereby incorporated by reference.

The present invention is generally directed to telephony and multimedia communications carried by a distributed computer network such as the global Internet. More specifically the present invention relates to a clearinghouse server for routing a communication between an originating VoIP device and a terminating VoIP device via the Internet.

Telecommunications networks are experiencing a drastic technology shift from a circuit switched architecture such as the current voice phone network to a packet switched architecture such as the global Internet . Worldwide the capacity of deployed packet switched networks is doubling every year while circuit switched capacity is only increasing at an annual rate of around 6 . In many developed regions packet switched capacity already exceeds circuit switched capacity. Recognizing this trend telecommunications providers have begun to optimize their networks for the technology that is expected to dominate future growth packet switching. As they deploy packet switched technology these providers must still support traditional circuit switched applications such as voice and facsimile. Instead of operating parallel network infrastructures however service providers seek to support those applications over a packet switched network. This approach offers several advantages greater efficiency through the use of a single common network infrastructure lower cost through a reliance on packet switching equipment and better support of innovative new services through an open architecture.

As circuit switched applications move to a packet switched network service providers need a way to identify systems on the packet switched network that are associated with addresses typically telephone numbers common to the circuit switched world. Providers must also have a means to authorize communications and to ensure that unauthorized communications do not consume bandwidth. For example the provisioning of a physical circuit switched connection between two providers typically serves as authorization for the providers to share traffic. In a packet switched environment however communicating parties need not share a physical connection and some other means of authorizing traffic is required. Finally providers must have a reliable way to collect information from packet switched devices to account for customer usage e.g. for billing .

There remains a need in the art for a convenient centralized application to identify call routes provide authorization and collect usage information for circuit switched applications in a packet switched network environment.

The present invention provides a clearinghouse solution for routing multi media communications including telephony calls between a source device and a destination device via a distributed computer network such as the global Internet. The present invention also authorizes the completion of a communication from a source device to a destination device and collects usage related information for the completed communication. The clearinghouse server constructed in accordance with the inventive concept can identify one or more available destination devices available to accept a communication from an authorized source device based upon the source of that communication. This clearinghouse server also can assign a weight or rank to destination groups or destination devices identified as available for handling a communication from a source device to achieve a balanced assignment of communications carried by those destination devices. An exemplary embodiment of the clearinghouse server can operate in either a WINDOWS or SOLARIS operating system environment in support of Web based communications in a distributed computer network.

Turning now to the drawings in which like reference numbers identify like elements of exemplary embodiments of the present invention is a block diagram illustrating a representative operating environment for an exemplary embodiment of the present invention. A communication system comprises one or more originating gateways one or more terminating gateways and a clearinghouse server each coupled to an Internet Protocol IP network . For purposes of this discussion an originating gateway and a terminating gateway will be alternatively described as a source device and a destination device respectively. Although illustrates an operating environment including only a single originating gateway and a single terminating gateway those skilled in the art will appreciate that the operating environment of the communication system can include multiple originating source VoIP devices and terminating VoIP destination devices. Those skilled in the art will also appreciate that source devices and destination devices are not limited to gateways but may include any device which requires discovery routing and authorization to establish a communication session with another IP device. Possible IP devices might include but are not limited to gatekeepers softswitches SIP proxies signaling gateways and call agents. The IP network represents a distributing computer network and can be implemented by the global Internet a wide area network WAN or an enterprise wide local area network LAN . The operating environment illustrated in is also described in related U.S. patent applications assigned to the assignee of the present application including U.S. patent application Ser. Nos. 09 154 564 and 09 759 680 Now U.S. Pat. Nos. 6 426 955 6 996 093 and which are hereby fully incorporated herein by reference.

To initiate a communication supported by the communication system a calling party sends an outgoing call having a called telephone number to the source device . For this representative example the calling party has an established relationship with the source device such as a subscription to call origination services provided by that source device. The source device is an authorized user of the clearinghouse services provided by the clearinghouse server as a result of enrolling for operation with that server. Consequently the source device sends an authorization request message to the clearinghouse server via the IP network to request the completion of the outgoing call with an available designation device . The authorization request typically comprises the called telephone number otherwise described as the dialed number a call identifier to uniquely identify the outgoing call and for certain applications the telephone number for the calling party and payment authorization such as a calling card number and a personal identification number PIN .

If the clearinghouse server determines that the source device is an authorized user of clearinghouse services the clearinghouse server can identify one or more destination devices for handling the outgoing call. If the clearinghouse server identifies more than one destination device available to handle the outgoing call the clearinghouse server typically applies a weight assigned to each destination device to prioritize or rank order the available destination devices. The clearinghouse server also can assign an authorization token to each identified destination device as an indicator that call completion is authorized by the clearinghouse server . The clearinghouse server can further assign a transaction identifier to the incoming call to uniquely identify that call for recordkeeping purposes. Responsive to the authorization request the clearinghouse server can send an authorization response to the source device via the IP network . The authorization response typically comprises a list identifying one or more available destination devices the authorization token s and the transaction identifier.

The source device can use the information provided by the clearinghouse server in the authorization response to contact a selected destination device and to complete the incoming call via the IP network . In turn the selected destination device can communicate the outgoing call to a called party typically via the Public Switched Telephone Network PSTN . In this manner the outgoing call is connected between the calling party and the called party by a combination of a distributed computer network and the PSTN.

Upon completion of the call the source device can issue a usage indication message to the clearinghouse server via the IP network . This indication message typically comprises usage information related to the completed call such as call duration and the transaction identifier originally assigned to that call by the clearinghouse server . The clearinghouse server can extract the usage information provided by the usage indication message for storage in local memory and send a usage indication confirmation as an acknowledgement message to acknowledge receipt of such information. The usage indication confirmation message is carried by the IP network to the source device to complete the confirmation process.

The platform of the clearinghouse server is provided by the operating system which is preferably implemented by Microsoft Corporation s WINDOWS 2000 or Sun Microsystem s SOLARIS operating systems. Although the WINDOWS and the UNIX platforms represent preferred platforms it will be appreciated that the inventive concept of a clearinghouse server can be supported by other operating systems and is not limited to those described herein. The operating system communicates with the Web server which preferably includes the XML parser .

The Web server supports Web based communications with client computers in a Web enabled computing environment including the source and destination devices illustrated in . The XML parser can accept messages from the clearinghouse engine and convert those messages to XML format for communication via the Web server . The XML parser also can extract information from an XML message received by the Web server and supply the extracted information to the clearinghouse engine . The Web server also communicates with the user interface via application programming interfaces APIs . The Webserver is preferably implemented by an XITAMI server available from iMatix Corporation sprl of Antwerpen Belgium.

The clearinghouse engine supports the processing of clearinghouse transactions and communicates with the operating system the Web server and the user interface . APIs can be used to access functions supported by the clearinghouse engine . The clearinghouse engine also can access configuration files maintained by the configuration database in support of clearinghouse transactions. The configuration files typically contain descriptive information identifying characteristics of enrolled source devices and clearinghouse transaction records including transaction identifiers assigned to transactions by the clearinghouse server .

The user interface provides a mechanism for a user such as an assistant administrator to input information about the clearinghouse environment including details about enrolled source devices and destination devices which can be used for authorization and routing logic. An enrolled device can be a source device and destination device. The user interface can be used to assign devices to a source group and destination groups. The user interface also can present the user with information related to clearinghouse transaction records stored by the clearinghouse server . is a logical flow chart diagram illustrating exemplary steps completed during the enrollment of a source or destination device for operation with a clearinghouse server. Turning now to an exemplary enrollment process is initiated in response to a user typically an assistant administrator defining a source device to be enrolled as a user or subscriber of clearinghouse services. A source device is typically identified by an IP address or a Domain Name System DNS name. In addition the administrator can assign the device to a particular source group of devices having one or more common characteristics and to different destination groups having one or more common characteristics.

In step commands are issued at the source or destination device device to complete an enrollment request for transmission to the clearinghouse server. These commands are typically device dependent and often require support by an administrator to select the appropriate enrollment instructions. Representative tasks completed by the source device for step are shown in the logical flow chart diagram of . Turning briefly to the source device obtains the identity of the clearinghouse server in step . The identity is typically an IP address or a DNS name for the clearinghouse server. In step the source or destination device obtains certificate authority CA certificate from the clearinghouse server based upon an initial contact with the identified clearinghouse server via the IP network. In decision step an inquiry is conducted to determine if the CA certificate can be verified as a certificate issued by a trusted device. For example the verification task in decision step can be completed by an administrator of the source or destination device contacting a representative of the services offered by the clearinghouse server to verify the CA certificate. If the CA certificate can not be verified in decision step the NO branch is followed to step and the enrollment request process is terminated at the source device. Based on a positive response however the YES branch is followed from decision step to step . In step the source device generates a public private key pair and sends an enrollment request with the public key to the clearinghouse server via the IP network. Upon device enrollment a configuration record or file for that device is constructed for storage in the configuration database accessible by the clearinghouse server.

Returning now to the source device sends an enrollment request via the IP network to the clearinghouse server in step . Responsive to the enrollment request the clearinghouse server in step creates a public key certificate and sends that certificate to the source device via the IP network. The clearinghouse server may issue a common public key certificate to all devices a unique public key certificate to every device or a unique public key certificate to all devices in a given group. This public key can be used by the source device to initiate secure communications with the clearinghouse server. In step the clearinghouse server obtains device information and builds a configuration file for the source device. The configuration file is maintained at the configuration database and is accessible by the clearinghouse server. A representative configuration file in accordance with an exemplary embodiment of a limited implementation of the present invention is shown in Table 1.

Each line in a configuration file other than comments or blank lines contains a single configuration item. The first word on the line identifies that item. The possible values for this word are listed below in Table 2.

The same configuration item may be included multiple times in this file. In such cases the clearinghouse server s behavior depends on the specific item. In most cases later occurrences of an item will override an earlier value. For example if multiple license lines are included in the file only the last line will actually be used by the server. In the case of group device and route multiple occurrences define additional groups devices or routes. Note however that it is not possible to define multiple groups with the same name multiple devices with the same name or multiple routes with the same group and called number. If the configuration file attempts to define duplicates the server will generate an error when attempting to read and parse the file.

The content following the license keyword should be a software license key enclosed in double quotation marks. If this parameter is absent from the file or if the included license key is invalid the underlying software supporting operations of the clearinghouse server will revert to a trial version. New software license keys may be obtained from a licensor of the clearinghouse server software. They can either be added to the configuration file manually or imported into the server through the user interface. Imported license keys are stored in configuration backups. Unlike other configuration items old values of the license key are kept in the configuration file allowing a straightforward reversion to an earlier license by deleting the newest license keys as well as problem diagnosis and auditing.

The content following the crypto keyword should be cryptographic parameters for the clearinghouse server enclosed in double quotation marks. If this parameter is absent the clearinghouse server will automatically generate new cryptographic parameters. If this occurs though all enrolled devices will have to re enroll with the server to refresh their cryptographic knowledge.

The content following the enroll keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate. If this parameter is not present device enrollment will be disabled.

The content following the routing keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate. If this parameter is not present call routing will be disabled.

The content following the call details records cdrs keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate. If this parameter is not present CDR collection will be disabled.

The content following the ssl keyword should be a single word either enabled or disabled without the quotation marks whichever is appropriate.

The content following the group keyword should be the name of the group. If the name consists of more than one word the entire name should be enclosed in double quotation marks.

The content following the device keyword should be the DNS name of the device the name of the group to which the device belongs enclosed in quotation marks if the name is more than one word the word enabled or disabled without the quotation marks and optionally the word enrolled also without quotation marks .

The content following the route keyword should be the name of the group to which the route applies enclosed in quotation marks if the name is more than one word the called number prefix for the routes enclosed in quotation marks if the number includes spaces and then a series of one or more device weight pairs where device is the DNS name of the destination device and weight is the weighting factor for that device.

To initiate a call routing operation by the clearinghouse server the source device can issue an authorization request message as shown in . The authorization request typically comprises a dialed number for the called party and a call identifier created by the source device to uniquely identify the communication. An optional attribute of an authorization request is the telephone number for the calling party. Another optional attribute of an authorization request is call payment information such as a calling card number and a PIN.

The clearinghouse server can respond to an authorization request message by generating an authorization response message. Both the authorization request and the authorization response are typically formatted as XML messages and are carried by the IP network. Assuming approval of an authorized communication by the source device the authorization response typically includes a list of destination devices available to accept the call an authorization token assigned to each identified destination device and a transaction identifier. If more than one device is identified by the clearinghouse server as available to handle the incoming communication the clearinghouse server typically rank orders the resulting list based upon weights assigned to those destination devices. The clearinghouse server assigns an authorization token to each identified destination device for use by the source device when contacting the selected destination device to complete a routed communication. The transaction identifier is assigned by the clearinghouse server to uniquely identify the transaction for this communication.

Upon completion of a communication between a source device and a selected destination device the source and destination devices can issue a usage indication message defining the duration of the communication as shown in . The typical usage indication message includes the call duration and the transaction identifier originally assigned by the clearinghouse server to uniquely identify that call transaction. Responsive to the usage indication message the clearinghouse server can collect the usage related information for storage in a local memory such as the configuration database coupled to the clearinghouse server. The clearinghouse server can confirm receipt of the usage indication message by issuing a usage confirmation message for delivery to the source device. Both the usage indication message and the usage confirmation message are preferably formatted as XML messages for communication via the IP network.

In decision step an inquiry is conducted by the clearinghouse engine to determine if the source device is an enrolled device with the clearinghouse server. In other words the clearinghouse engine determines whether the source device is an authorized subscriber or user of the clearinghouse services available at the clearinghouse server. If the response to this inquiry is negative the NO branch is followed from decision step to step and authorization is denied. This process can continue as illustrated to step to provide an error message explaining why authorization was denied. Otherwise the YES branch is followed from step to step .

In step the clearinghouse engine examines device groupings maintained by the clearinghouse server to determine if the source device has been assigned to one of the device groupings. For example an administrator can assign an enrolled source device to a particular device grouping based upon common characteristics of devices in that group. If the source device is associated with a particular device group the routing operations completed by the clearinghouse server are typically conducted based upon the attributes of the device group rather than the individual source device. In decision step the process determines if the source group is authorized to initiate calls. The source device may be enrolled but perhaps the device belongs to a group of devices such as a customer with poor credit which have been temporarily denied clearinghouse services. If the source group is not authorized then the process follows the NO branch and authorization is denied. This branch may continue to step .

If the source group is authorized the process continues to the YES branch and step which determines if called number translation rules should be applied. Based on pre defined rules for each source device the called number can be translated. As an example translation a trunk code pre pended to a called number might be replaced with a defined string of digits to a predefined format. Such predefined formats can include an E.164 number. E.164 is the worldwide telephone numbering standard defined by the ITU International telecommunications Union. Other formats and translation rules are not beyond the scope of the present invention.

The process continues to decision step to determine if calling party features have been configured. If calling party features have been configured in the clearinghouse server the process proceeds to step to implement additional authorization steps. Step determines if the calling party or end user is a customer of the firm operating the source device. If not then the calling party is a customer of another firm and is defined as a roamer. If the calling party is a roamer the authentication process for roamers is used step . This process may include authorization rules unique for each pair of source group and the firm offering services to the roamer. If the calling party is associated with the source device group the calling party is not a roamer and authorization process for non roamers in step is used.

Step determines if the calling party is authorized based on processes and . If the calling party is not authorized the process continues down the NO branch to step which determines if the call receives special handling. If not the process follows the NO branch to step where the call is denied. This process may be continued to step . If the call is determined to receive special processing the process continues to step . The clearinghouse server may use rules which use the identity of the calling party the source group or called number to route the call. Typically the call would be routed to customer service or collection department of the firm offering services to the called party or possibly to the fraud department of the clearinghouse operator.

Returning to step if the calling party is authorized the clearinghouse server may determine if the calling party is a pre paid or post paid customer in step . If the customer is a pre paid customer the clearinghouse server in step may determine the maximum allowable call length based on the customer s debit balance the called number and the retail usage rate such as price per minute applicable for this calling party.

In step the clearinghouse engine determines the communication route for completing the outgoing call and destination devices available to handle the communication. The clearinghouse engine typically identifies the destination devices available to handle the call based upon the identity of the source device. However if the enrolled source device is also a member of a device group the clearinghouse engine will identify the available destination devices based upon the device group associated with that source device. The administrator may also use the identity of the calling party to determine the routing operation for each call. Additional detail on the routing processes are provided in .

In step the clearinghouse server may determine the maximum call length for which the call may be authorized. This value may be a function of any or all of the following parameters source group destination group called number and calling party. The value determined in this process may be included on the authorization response to source device.

In step the decision is made whether to apply network address translation rules. This decision may be configurable by the clearinghouse server operator based on the identity of the source or destination devices. If network address translation rules are used the process continues down the YES branch to step where the IP address of each destination device is translated into an alternate destination IP address. Translation of network IP address is used in this example of the invention however steps and may be more general to include translation or addition of any information about the destination device.

In step the clearinghouse engine generates an authorization token for each identified destination device and a transaction identifier. Each token includes the non translated IP address of the destination device. The source device can use the authorization token for a selected destination device to confirm that the communication transaction has been authorized by the clearinghouse server. The clearinghouse engine assigns each communication transaction a transaction identifier to uniquely identify that transaction. Also in Step the clearinghouse engine also generates and stores a time date stamp that can be used for internal call detail records CDRs as will be discussed below. The clearinghouse engine also assigns to each communication its server identification number. Similar to the time date stamp mentioned above the server identification number can be used for internal CDRs. The server identification number uniquely identifies a respective clearinghouse and clearinghouse server that is part of the clearinghouse network or a network of clearinghouse networks.

Additionally in Step the clearinghouse engine creates an internal CDR that can comprise at least one of the following parameters the transaction identifier the identified destination devices the tokens for each identified destination device the source group number assigned to the source device the destination group number s corresponding to the destination devices the time date stamp and the server identification number. As noted above a source device may or may not be part of or assigned to a source group. Therefore a CDR may or may not include the source group number depending upon the source device and may not include destination group number s depending on the destination device s . In addition the internal CDR may included the identify of the calling party the called number and the maximum call length authorized by the clearinghouse engine. If network translation rules are applied step the translated identity of the destination device may be included. If called number translation is applied step the translated called number may be included in the CDR. The CDR created by the clearinghouse engine can be stored locally in the configuration database .

Included in steps and is the process to recognize if any recommended destination devices have been derived from an external destination clearinghouse see steps and . If so then the clearinghouse engine will use the authorization token and transaction identifier from the destination clearinghouse in its authorization response providing the external destination devices. By using the transaction identifier from the destination clearinghouse as an input to the processes in step and the source clearinghouse transaction identifier can be created to identify both the source and destination clearinghouses. This technique can be expanded and it is possible to chain together clearinghouse transactions with each subsequent transaction identifier including information about all preceding clearinghouses as the initial destination clearinghouse token is forwarded via multiple clearinghouses to the eventual source device.

If authorization responses have been received from an external clearinghouse s in step then the internal CDR created in steps and may include the following additional records transaction identifier from the destination clearinghouse a record derived from the combination of the destination clearinghouse transaction identifier and source clearinghouse transaction identifier number identifying the destination clearinghouse and a number identifying the destination clearinghouse server.

In step the clearinghouse determines whether to apply address translation security. An important reason for IP network address translation is to conceal the true identity of the source and destination devices from one another. This can be achieved by routing the call from a source device to a proxy device which then handles all call signaling and routing of media packets to the destination server. By encrypting the authorization token it is possible to conceal the destination device IP addresses from the source device. In step the token is encrypted in such a manner that the source device cannot determine the IP address of the true destination device. The token is encrypted in such a manner that a proxy device will appear as the destination device to the source device. The token is encrypted so it can only be decrypted by the proxy device which extracts the IP address of the destination device. The proxy then completes the IP communication from the source device to the destination device concealing the true IP addresses of both the source and destination devices from each other. This step may rely on the administrative process described in step where specific cryptographic certificates are issued to specific devices or groups by the clearinghouse server.

The authorization response described in step includes the encrypted authorization token and additional non encrypted information about the call such as the translated call number maximum call length and other call attributes. Some important information in the non encrypted portion of the authorization response are the alternate destination IP addresses. These are addresses of proxy devices which appear to be normal destination devices to the operator of the source device. However these devices may be proxy devices which can decrypt the authorization token to obtain the true IP address of the destination devices and then complete the call from the source device to the destination device. The last function of step is to forward the authorization response information to the XML parser .

Returning to decision point if network address translation does not apply then the process proceeds down the NO branch to step where the clearinghouse engine generates a transaction identifier and authorization token s . Then in step the clearinghouse engine forwards the token s transaction identifier addresses of destination devices translated call number maximum call length and other call attributes to the XML parser .

In step the XML parser prepares an XML authorization response message with the appropriate error code indicating why the authorization request was denied. In step the clearinghouse engine prepares an XML authorization response message containing the transaction information from step or step . In step the XML parser passes the XML message for the authorization response to the Web server. The Web server in step sends the authorization response to the source device via the IP network.

Responsive to the authorization response the source device can select a destination device from the list of identified destination device s and route the communication to that selected destination device for completion. The selected destination device typically accepts the communication based upon the authorization token provided by the source device in connection with the communication. This authorization token indicates that the communication has been authorized by a clearinghouse service for completion between the source and destination devices. Upon completion of the communication a source device typically collects communication usage information including the duration of the call for transmission to the clearinghouse server.

In step the XML parser forwards the extracted usage information to the clearinghouse engine. In decision step the clearinghouse engine determines the source device is a device enrolled for operations supported by the clearinghouse server. If the response to this inquiry is negative the NO branch is followed from step to step . In step the clearinghouse engine determines that the usage indication information cannot be confirmed by the clearinghouse server and issues an error message.

In step the clearinghouse engine stores the extracted usage information of call details records provided by the XML parser. This extracted information is typically stored in local memory accessible by the clearinghouse engine. For example the extracted information can be maintained in CDRs stored at the configuration database . That is the clearinghouse engine can append the CDRs created in Step with this extracted information. The extracted information can comprise at least one of the following a listing of the destination group number identifiers if the source device was assigned to a source group used for the communication and a listing of each authorized destination device used during the communication. In step the clearinghouse engine provides a usage confirmation to the XML parser. In turn the XML parser prepares an XML formatted usage confirmation message for delivery to the source device. The XML parser forwards the XML formatted message to the Web server in step . In response the Web server sends the usage confirmation message to the source device via the IP network.

Step is an example of the logic which may be used by the invention to determine if the usage indication received from the source device should be forwarded to a destination clearinghouse such as in step . By analyzing the transaction identifier created from the combination of the destination clearinghouse transaction identifier and the source clearinghouse transaction identifier.

Based upon the identity of the source group and optionally on the calling party the clearinghouse engine in step can calculate possible routes based upon an identification of each available destination group for handling the communication originated by the source device. Each destination group is preferably identified based upon the dialed number for the communication. A general description of routing algorithms is provided by Donald E. Knuth Sorting and Searching Vol. 3 of Reading Mass. Addison Wesley 1973 pp. 481 500.

The routing tasks completed by the clearinghouse server can be implemented by Algorithm T described in the Knuth reference on pages 481 486. For this exemplary implementation a table of records form an M ary trie where M is set to 10 for the digits 0 9 . This trie search searches for a given argument K where K is the dialed number. The table of records is the call routing table for a single source group where each source group has its own separate trie. The route look up returns the longest match which represents the destination for the communication.

Once possible destination groups have been identified the next step is a decision point for the clearinghouse engine to determine if load balancing should be applied in the process to rank order the destination groups. The rules for this decision may be configured by the clearinghouse server operator and may use the identity of the source group or destination groups selected to determine if load balancing is applied. If load balancing is applied the process continues down the YES branch to step . Using weights assigned to each destination group the clearinghouse engine determines the rank order of the destination group.

Returning to step if load balancing among destination groups is not applied then the destination groups may be rank ordered by their assigned weights. Once the destination groups have been rank ordered the process continues at the clearinghouse engine to step to determine the potential destination devices in each destination group.

If one of the destination groups is identified as an external clearinghouse the clearinghouse server in step will launch an authorization request to an external or destination clearinghouse server identified with the destination group to obtain an authorization response with a list of destination devices. If the destination clearinghouse server has destination devices which can complete the call the destination clearinghouse server may send an authorization response with a list of destination devices authorization tokens transaction identifier and other attributes to the source clearinghouse server. As part of step the source clearinghouse server will store the authorization token s and transaction identifier received from the external or destination clearinghouse server and include this information in its authorization response to the source device. The destination device of a destination clearinghouse may only accept a token that originates from a clearinghouse server with which it is enrolled.

The transaction identifier may include clearinghouse and server identification number. The combination of the destination clearinghouse transaction identifier with the source clearinghouse transaction identifier creates a unique transaction identifier sent to the source device that identifies both the source and destination clearinghouses. Using information contained within the combined transaction identifier steps and both the source and destination clearinghouse servers have sufficient information to recognize inter clearinghouse usage indications and automatically forward usage indication messages steps and to the respective destination and source clearinghouse devices.

Step is the decision point for the clearinghouse engine to determine whether or not to apply load balancing among destination devices. In a manner similar to load balancing destination groups the operator of the clearinghouse server may configure rules which use the identity of the source group and destination groups to determine if destination device load balancing should be applied. If destination device load balancing is applied then the process continues down the YES branch to step where weights assigned to each device are used to determine load balancing in a manner similar to that described in steps and in . If load balancing is not applied the process proceeds down the NO branch to and destination devices may be simply rank ordered using the weight assigned to each destination device.

The next step is applied based on the identity of the source device or destination group and truncates the number of possible number destination devices within each group. The last step is final ordering of destination devices for the clearinghouse server authorization response. The order priority may be based first on destination devices suggested by the source device. In the authorization request from a source device to a clearinghouse server the source device may provide a list of possible destination devices. In step the clearinghouse server will determine if the suggested destination devices are enrolled with the clearinghouse and are authorized to receive traffic from the source device. The second priority for ordering devices may be based on the rank order of each destination group and the third priority of ordering devices may by device ranking.

The present invention has been described in relation to particular embodiments which are intended in all respects to be illustrative rather than restrictive. Alternative embodiments will be apparent to those skilled in the art to which the present invention pertains without departing from its spirit and scope. Accordingly the scope of the present invention is defined by the appended claims rather than the foregoing description.

