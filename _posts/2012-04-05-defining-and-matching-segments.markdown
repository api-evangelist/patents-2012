---

title: Defining and matching segments
abstract: Defining and matching segments is disclosed. In some embodiments, defining and matching segments includes receiving a user defined segment via a user interface input; and determining a matching effort (e.g., which can include a set of Geographic Positioning System (GPS) data) to the segment using a processor. In some embodiments, the data associated with the effort includes one or more of the following: heart rate, speed, time, and power. In some embodiments, defining and matching segments further includes storing data associated with the matching effort with the segment. In some embodiments, the user defined segment is based at least in part in uploaded GPS data. In some embodiments, the user defined segment is based at least in part on selected points on a map application.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09208175&OS=09208175&RS=09208175
owner: Strava, Inc.
number: 09208175
owner_city: San Francisco
owner_country: US
publication_date: 20120405
---
This application is a continuation of co pending U.S. patent application Ser. No. 13 077 410 entitled DEFINING AND MATCHING SEGMENTS filed Mar. 31 2011 which is incorporated herein by reference for all purposes.

Conventionally an athlete can use a device to record the Global Positioning System GPS locations and other metrics e.g. time and heart rate of a physical activity. For example a device user can wear a GPS device on a run. The GPS device could then record and store the GPS coordinates and other information associated with the run.

However typically in order with for two or more athletes to compare their performance over the same geographical terrain they would have to attempt to manually synchronize their activity. For example two cyclists competing over the same course at the same time would need to rely on the other to start and stop their respective GPS devices at the same time. Also for example two cyclists competing over the same course at different times might need to estimate the exact the locations of the start and stop points of the other cyclist. Manually attempting to synchronize athletic performance can be inefficient and imprecise.

The invention can be implemented in numerous ways including as a process an apparatus a system a composition of matter a computer program product embodied on a computer readable storage medium and or a processor such as a processor configured to execute instructions stored on and or provided by a memory coupled to the processor. In this specification these implementations or any other form that the invention may take may be referred to as techniques. In general the order of the steps of disclosed processes may be altered within the scope of the invention. Unless stated otherwise a component such as a processor or a memory described as being configured to perform a task may be implemented as a general component that is temporarily configured to perform the task at a given time or a specific component that is manufactured to perform the task. As used herein the term processor refers to one or more devices circuits and or processing cores configured to process data such as computer program instructions.

A detailed description of one or more embodiments of the invention is provided below along with accompanying figures that illustrate the principles of the invention. The invention is described in connection with such embodiments but the invention is not limited to any embodiment. The scope of the invention is limited only by the claims and the invention encompasses numerous alternatives modifications and equivalents. Numerous specific details are set forth in the following description in order to provide a thorough understanding of the invention. These details are provided for the purpose of example and the invention may be practiced according to the claims without some or all of these specific details. For the purpose of clarity technical material that is known in the technical fields related to the invention has not been described in detail so that the invention is not unnecessarily obscured.

Defining segments and matching efforts to segments are disclosed herein. As used herein a segment refers to a geographical track that is of interest and can be used as a reference e.g. for comparison of athletic performance along that track and or for other applications . For example a segment can be used to identify a popular hill climb for cyclists. As used herein an effort refers to a recorded series of GPS information with timestamps e.g. which can represent an instance of athletic performance . In some embodiments an effort is stored with associated data e.g. metrics of the activity with which the effort is associated . In some embodiments one or more segments are derived from a stored effort. In some embodiments a user can define a segment. In some embodiments a visual representation of an effort is presented at a user interface and a user defines a segment using the visual representation. In some embodiments a map is presented at a user interface and a user defines a segment by indicating a track on the map. In various embodiments a series of GPS information is converted into a set of geographical abstractions prior to storing it as a segment. In some embodiments a segment is stored with the associated data of efforts that have been determined to match the segment.

In various embodiments an effort is matched against stored segments. In various embodiments two levels of matching can be performed using the effort and the stored segments. In the first level of matching if a percentage of match of the effort to one of the stored segments exceeds a first threshold then a first determination is made e.g. the effort is a loose match to the segment . In the second level of matching if a percentage of match of the effort to one of the stored segments exceeds a second threshold that is greater than the first threshold and in addition the effort also crosses the start and finish line associated with the segment then a second determination is made e.g. the effort is a tight match to the segment . In some embodiments it can be determined that an effort is a loose match to one or more stored segments and the effort is also a tight match to one or more stored segments. In some embodiments if an effort matches e.g. either as a loose or tight match to a segment the associated data of the effort is compared against the associated data stored with the matched segment. In some embodiments if an effort matches to a segment the associated data of the effort is also compared against the associated data of other efforts that match the segment.

Device is a device that can record GPS information and or other data associated with a physical activity. Device can also be a device to which GPS information and or other data associated with a physical activity can be uploaded or transferred. Examples of device includes but is not limited to a GPS device e.g. Garmin Forerunner and Edge devices including Garmin Forerunner 110 205 301 305 310XT 405 405CX and Garmin Edge 305 605 705 500 a mobile phone such as a smart phone e.g. an Android based device or Apple iPhone device including a GPS recording application e.g. MotionX Endomondo and RunKeeper a computer a tablet device and or other general purpose computing devices and or specialized computing devices which typically include a general processor a memory or other storage component s a network or input out I O capability and possibly integrated GPS functionality or support or an interface for a GPS device or GPS functionality.

In various embodiments device or an application thereof is configured to record GPS information and data associated with a physical activity during the activity. In some embodiments device is configured to receive recorded GPS information and data associated with a physical activity subsequent to the completion of the activity e.g. such information is uploaded to device . In some embodiments the recorded GPS information and the associated data is referred to as an effort. Put another way an effort is an instance of a physical activity and can be represented through its geographical information as well as other metrics related to athletic performance. Examples of a physical activity include cycling running and skiing. In some embodiments GPS information includes a series of consecutive and discrete GPS data points e.g. longitudinal and latitude coordinates with a timestamp for each point. In some embodiments associated data includes but is not limited to elevation heart rate power watts e.g. energy expended time speed e.g. average and or maximum speed per segment and or route in which average speed for example can be derived from time and GPS information and or cadence. Associated data can be recorded at various granularities. For example associated data can correspond to each GPS data point the entire activity e.g. the associated data includes averages of the metrics or portions of the activity. As an example one can use device on a bike ride. At the end of the bike ride the user can review his performance with the recorded GPS information e.g. through a user interface of device to observe the geographical track that he traversed how much he energy he expended along the ride how fast he finished it in average speed elevation based metrics and or other metrics. In some embodiments device is configured to store the recorded GPS information and the associated data e.g. effort and or send the effort information to server . In some embodiments device is configured to present an interactive user interface. The user interface may display GPS information and receive selections e.g. made by a user with respect to the displays. In some embodiments device sends the selections that it receives to segment matching server .

In various embodiments segment matching server is configured to support and present a user interface at device . In some embodiments segment matching server is configured to receive a user defined segment at the user interface using a recorded effort. A segment refers to a geographical track that is of interest and can be used as a reference for comparisons of athletic performance along that geographical track. Segment matching server is configured to receive a series of GPS information and associated data e.g. effort . In some embodiments segment matching server is configured to display a visual representation of the GPS information at the user interface using a map software application. The visual representation can be for example a series of flags or a continuous line marked on a graphical map. In some embodiments segment matching server is able to support a map at the user interface by including logic configured to interact with the Application Programming Interface API of a map software application e.g. Google Maps MapQuest Bing maps and or another mapping application service . In some embodiments a user may define a segment using the visual representation of the GPS information. In some embodiments a start point and a finish e.g. end point along the visual representation of the GPS information are selected on the graphical map to define a segment. For example a user may select e.g. by dropping a marker or clicking the start and or finish points along the geographical track that he or she just traversed during a physical activity. The portion of the geographical track between the selected start and finish points is thus defined as a segment. In some embodiments the start and finish points are stored with the defined segment. In some embodiments the portion of the geographical track between the selected start and finish points are converted into an abstracted form and then stored in a database for storing segments. In some embodiments the associated data that correspond to the defined segment are also stored with the segment at the database.

In some embodiments segment matching server is configured to receive a user defined segment at the user interface using selections on a map. In some embodiments segment matching server presents a graphical map e.g. Google Maps MapQuest and receives a series of selections of points on the map to indicate the course of a segment. This series of selections of points on the map need not be based on a recorded effort and can be merely be any geographical track that is of interest. For example the selected segment can be a track that a cyclist has rode over before but has not documented the ride or the selected the segment can be a track that the cyclist would like to ride on in the future. The series of selections of points on the map can be converted into a series of GPS information e.g. coordinates . In some embodiments the series of GPS information is converted into an abstracted form and then stored as a segment.

In some embodiments subsequent to a definition of a segment at the user interface stored efforts e.g. sets of GPS information from past physical activities are compared to the defined segment. In some embodiments when an effort is compared against this defined segment it is determined whether the effort matches the segment in part by checking whether the GPS information of the effort indicates that the start and finish points of the segment have been crossed. Once one or more efforts are determined to match the segment the data associated with the efforts are retrieved and analyzed. In some embodiments the data associated with the newly defined segment is also included in the analysis. For example the data can be compared to determine which effort matching the segment has the fastest time of completing the segment.

Segment matching server is also configured to match efforts e.g. sets of GPS information to segments. In some embodiments the effort is converted into the same abstracted form of a stored segment prior to determining matches for the effort. One purpose of matching efforts to segments is to find stored instances of physical activities that have occurred across the same demarcated tracks of interest i.e. segments . Put another way an effort that matches a segment refers to an instance of a physical activity that has taken place along a defined track. Once the instances of physical activities that have occurred over the same segment are found their associated information e.g. time of completion speed heart rate and or watts can be compared to produce certain statistics e.g. fastest time highest watts regarding athletic performance by one or more individuals across the same track. In some embodiments for a newly defined segment segment matching server is configured to compare stored efforts to the segment. In some embodiments the associated data of efforts are stored with the segments the efforts have been determined to match. In some embodiments segment matching server is configured to receive an effort e.g. from device and to compare the effort to stored segments to find match es . In various embodiments once an effort is found to match a segment their associated data are compared e.g. the associated data of all efforts that match the segment are compared .

Segments database is configured to store defined segments. While segments database is shown to be one database in the example a segments matching server may contain more than one database to store defined segments. In some embodiments segments database includes segments that are defined by users uploading a stored effort and indicating a start point and a finish end point along a visual representation of the effort at a user interface. In some embodiments segments database includes segments defined by users making a series of selections along a track on a map at a user interface. In some embodiments segments database includes segments that are predefined e.g. by administrators of segments server based on known characteristics e.g. information that is provided by professional associations of various tracks or climbs. In some embodiments segments are stored in segments database in an abstracted form e.g. as sets minimum bounding rectangles . One reason to store to store a segment in an abstracted form is so that a search query of similar segments or efforts that match segments can be efficiently performed. In some embodiments segments data base is organized based on the R Tree index. In some embodiments segments are stored in segments database as sets of GPS data points. In some embodiments each segment in the segments database is stored with the identifiers of efforts from efforts database that have been determined to match the segment. In some embodiments each segment in the segments database is stored with the associated data of the efforts that have been found to match the segment.

Efforts database is configured to store efforts as sets of GPS information and timestamps. While efforts database is shown to be one database in the example a segments matching server may contain more than one database to store efforts. In some embodiments effort database includes efforts that are recorded and uploaded from devices e.g. device . An effort stored at efforts database includes at least GPS information timestamps corresponding to the GPS information and metrics e.g. associated data related to the athletic performance of the effort. In some embodiments the timestamps are included in the GPS information e.g. the GPS information includes latitude and longitude coordinates with corresponding timestamps . In some embodiments an effort is stored with an identifier for the athlete who performed the effort e.g. the user of device . In some embodiments each effort of efforts database is stored with the identifiers of the segments of segments database to which it has been determined to match.

Definition engine is configured to receive definitions of segments. Definition engine may be implemented with hardware and or software. In some embodiments definition engine is configured to present a user interface e.g. at a device . In some embodiments the user interface displays a visual representation of an effort e.g. recorded by the device at the user interface. In some embodiments definition engine is configured to interact with third party map applications e.g. Google Maps MapQuest through an API to obtain map services e.g. displaying a map receiving GPS coordinates of a selection on a displayed map and or other map services . A selection of a start point and a finish point are made at the user interface and received at definition engine . Then definition engine stores the track demarcated by the start and finish points as a segment at segments database . In some embodiments a track e.g. indicated as a series of selections on a map displayed by the user interface is received at definition engine . Then definition engine stores the track on marked on the map as a segment at segments database . In some embodiments definition engine converts a segment into an abstracted geographical form e.g. as a set of minimum bounding rectangles before storing it.

In some embodiments definition engine is configured to compare a newly defined segment to stored segments at segments database to determine whether any existing segments are similar to the newly defined segment. In some embodiments if it is determined that existing segments are similar to a newly defined segment a display may alert the creator of the segment of the already existing segments. In some embodiments the creator of the new segment may opt to forgo saving the new segment since similar ones have already been defined.

In some embodiments definition engine is configured to e.g. periodically compare the segments stored at segments database to determine groups of two or more segments are similar. In some embodiments for segments that are found to be similar a display is presented with the segments so that only one may be chosen e.g. crowd source by using a voting process with a community of users who use devices such as device to remain in the database. The segments that are not chosen can be discarded from the database in order to free up space by removing redundant segments or demoted so that they are not displayed as a public segment but may be retained for private use by the submitting user. In some embodiments definition engine is configured to determine that similar segments include segments that are entirely included by other segments i.e. sub segments and super segments . In some embodiments a relationship between a segment and its super or sub segment noted at segments database .

Matching engine is configured to determine efforts that match to one or more segments e.g. of segments database . In some embodiments matching engine is configured to access efforts stored at efforts database . In some embodiments subsequent to a user definition of a segment e.g. based on an uploaded effort or markings on a map matching engine accesses stored efforts to match the newly defined segment. For example a user e.g. a cyclist can define a segment and optionally publicly share the segment for other users to see and then receive information on past activities e.g. past rides by the cyclist himself or other cyclists that have traversed the defined segment. In some embodiments matching engine is configured to access segments stored at segments database . In some embodiments in response to a received effort e.g. sent by device matching engine determines whether the received effort matches any segments stored at segments database . For example a user e.g. a cyclist can check whether a recently recorded effort e.g. a bike ride included one or more already defined segments. If it is determined that the effort includes a segment then the associated data e.g. athletic performance data of the segment is accessed and compared to the associated data of the effort. This way a user can benefit from an already defined segment by automatically being able to check for whether he has traversed the segment without needing to manually determine where the segment begins or ends.

In some embodiments matching engine is configured to convert an effort e.g. a set of GPS coordinates into the same abstracted form e.g. a set of minimum bounding rectangles in which a segment is stored prior to performing a match against the stored segments e.g. via querying the segments database . In some embodiments two types of determinations e.g. the effort is a loose match the effort is a close match can be made based on performing a match between an effort and the stored segments. An effort can be determined to be a loose match to a stored segment if their percentage of match exceeds a first threshold e.g. 65 or greater . In some embodiments an effort that is a loose match to a stored segment may entail that the recorded physical activity approximately traversed the same track as the matched segment. An effort can be determined to be a tight match to a stored segment if their percentage of match exceeds a second threshold e.g. 80 and in addition the effort crosses the start and finish lines associated with the stored segment. In some embodiments an effort that is a tight match to a stored segment may entail that the recorded physical activity closely traversed the same track as the matched segment. In various embodiments determining a percentage of match for the two determinations e.g. loose match and tight match is performed in the same manner. In some embodiments an effort can be determined to be a loose match to one or more segments and the effort can also be determined to be a tight match to one or more of the same or different segments. For example an effort can be determined as a loose match to a segment and it can also be determined to be a tight match to the same segment. In another example an effort can be determined as a loose match to one segment and a tight match to a different segment. In some embodiments a determination of an effort as a loose match is made to one or more segments stored in a first database and a determination of the effort as a tight match is made to one or more segments stored in a second different database.

In some embodiments in the event that an effort is determined to match a segment e.g. either as a loose match or tight match then the associated data of the segment e.g. associated data of stored efforts that have been determined to match the segment is accessed to be compared against the associated data for the effort. In some embodiments multiple stored efforts are determined to match a newly defined segment and the associated data for the matched segments are accessed aggregated and analyzed. In some embodiments matching engine is configured to produce analysis results based on the retrieved data. In some embodiments matching engine sends the analyzed results to device e.g. for display as a user interface .

For example a user can define a segment and all the stored efforts that match the segment can be aggregated and analyzed to produce a list of users who have traversed the segment in the fastest times or highest power i.e. a leader board . In another example a user can produce an effort and the segment matching server can determine whether the effort has traversed across any defined segments. If it is determined that the effort has traversed across a defined segment then the data associated with that effort can be compared with the history of all efforts that have been determined to have traversed the defined segment. In this way the user can determine how his athletic performance on the segment compares to all other efforts across the same geographical track as represented by the segment . Furthermore the user need not know e.g. as he is on his bike ride where exactly the segment begins or ends.

In some embodiments device may include segments database efforts database definition engine and matching engine or equivalent functionalities such that device can store segments store efforts define segments and match an effort to segments at device without needing to send or receive information from segments matching server . In some embodiments an efforts database at device includes only the efforts produced by the user of the device.

At a segment is defined. In some embodiments a segment is defined by a user at a user interface by selecting a start and end point along a visual representation of an effort e.g. series of GPS information with timestamps . In some embodiments the effort is recorded by a device equipped with a GPS tracking functionality. In some embodiments a segment is defined by a user at a user interface by selecting a series of points on a map e.g. supported by a third party map software such as Google Maps . In some embodiments a segment is defined e.g. by administrators of a segments matching server using known characteristics e.g. elevation and average grade of a geographical track. Defined segments are stored in one or more databases. In some embodiments a defined segment is converted into an abstracted form e.g. as a set of minimum bounding rectangles and stored in their abstracted forms. In some embodiments a database in which segments are stored is organized based on the R Tree index.

At a matching effort to the segment are determined. In some embodiments for a defined segment information regarding stored efforts are accessed and compared against the segment. In some embodiments efforts are stored as sets of GPS information with timestamps and with associated data such as various metrics of athletic performance . In some embodiments the GPS information of the stored efforts are accessed and converted into whichever form the segment is in e.g. minimum bounding rectangles before the comparisons are made. In some embodiments stored efforts are compared against the segment to determine a subset of stored efforts that match the segment. The associated data for the subset of stored efforts that are found to match the segment are accessed e.g. from the same database that stores the efforts and aggregated. The aggregated associated data is analyzed and in some embodiments the result s of the analysis is presented in table s e.g. leader boards and or visual s .

At a visual representation of an effort is presented. In some embodiments the effort is a series of GPS information with timestamps that is recorded by a device equipped with GPS tracking functionality. In some embodiments the visual presentation is presented at a user interface. For example the GPS coordinates can be displayed as a continuous line on a map or a series of markers on a map e.g. supported by a map application such as Google Maps . In some embodiments even though a series of GPS information is a set of discrete geographical coordinates the points in between two coordinates can be extrapolated in producing a visual representation that is in the form a continuous line.

For example a user e.g. a cyclist has completed a bike ride and would like to designate at least a portion of the ride as a segment. This way the cyclist or other cyclists may be able to track and compare their performances across the geographical track that is referenced by the segment.

At a selection of a start point is received. In some embodiments a user selects a point along the visual presentation at the user interface to be the start point of the segment. In some embodiments if the selected point has been crossed more than once in the effort then a display is generated to indicate each of the times along the effort that the selected start point was crossed. The user may then select the time corresponding to the desired instance that he or she would like to represent as the start point. In some embodiments the selected start point is stored as its corresponding GPS coordinates e.g. as returned by an API associated with the map application . In some embodiments the selected start point is stored with a virtual starting line that is derived based on the selected start point and other point s of the effort.

Returning to the previous example the cyclist can select a point along his ride to designate as the starting point of the segment. The start point need not be at the starting point of the entire segment but can be any point along the ride. The start point can be thought of as the starting line for a race. When it is later determined whether another cyclist or the same cyclist on a different occasion has rode over the segment it is determined whether the subsequent ride i.e. effort has crossed the starting point.

At a selection of a finish point is received. In some embodiments a user selects a point along the visual presentation at the user interface to be the finish or end point of the segment. In various embodiments the technique for selecting and storing a finish point is the same as that is used for a start point. For example a selected finish point can be stored as its corresponding GPS coordinates and or with a derived virtual finish line.

Returning to the example the cyclist can select a point along his ride to designate as the finish point of the segment. The finish point need not be at the very end of the ride but can be any point that is subsequent to the start point. The finish point can be thought of as a finish line for a race. When it is later determined whether another cyclist or the same cyclist on a different occasion has rode over the segment it is determined whether the subsequent ride i.e. effort has also crossed the finish point.

At the defined segment is optionally stored. In some embodiments if the defined segment is determined to be similar to already existing segments e.g. in a data store that includes predefined and or user defined segments such as a segment database then the user is prompted with a corresponding display. In some embodiments the user can review the existing segments and or choose to discard the newly defined segment in light of the existing overlapping segments. In the event that the user chooses to discard the newly defined segment he or she can choose to associated his effort with an existing segment and store the data associated with his effort with the existing segment. In some embodiments if the user defined segment matches an existing segment then the matched existing segment is already stored e.g. in a data store that includes predefined and or user defined segments such as a segment database . If there are no existing similar segments or if the user chooses to store the newly defined segment anyway despite a possible overlap the newly defined segment is stored. In some embodiments the segment is converted into an abstracted form e.g. as a set of minimum bounding rectangles and then stored. In some embodiments the newly defined segment can be saved with a name and or one or more tags e.g. that are chosen by the user . In some embodiments stored efforts are accessed to match against this segment. If when matching efforts are found the data associated with the matching efforts are combined and compared.

Returning to the example the cyclist can use the user interface to create the segment. The cyclist can also input the segment name as Old La Honda to associate the segment with the name of the road along which the segment exists. The cyclist can also receive feedback on past rides that have occurred on the Old La Honda e.g. as determined by segment matching such as which users have rode on the segment when who had the fastest time who expended the most amount of energy in completing the segment. The cyclist can also see how his own performance over the Old La Honda fares in comparison to past rides e.g. where the user s performance ranks among the history of rides over the segment . Subsequent users can also search for this segment by entering in Old La Honda at a user interface that supports searching through a segments database. Subsequent users can also check to see if they have ridden over Old La Honda by recording a ride and sending the ride to be checked for matching segments. If it is determined e.g. as determined by segment matching that the ride includes the Old La Honda segment then the subsequent user s performance during the ride for the length of the segment can be compared to the historical performance of the other users who have ridden over the segment.

One reason to convert a series of GPS information into a set of MBRs is that in various embodiments MBRs can be used to perform an efficient bounding box query on an R Tree indexed database of MBRs. In some embodiments a search input for a query of a R Tree database e.g. for defined segments is a MBR e.g. associated with an effort and the query returns MBRs e.g. associated with segments that overlap the input MBR. In some embodiments whether an effort is similar to e.g. matches a segment depends on the extent that their MBRs are found to overlap using the bounding box query. In some embodiments whether one segment is similar to another segment also depends on the extent that their MBRs overlap.

At a series of GPS information is mapped on to a set of tiles. In some embodiments the series of GPS information is from an effort recorded by a device equipped with GPS tracking functionality. In some embodiments the series of GPS information corresponds to a segment e.g. defined at a user interface .

A known technique of universal tiling is used to divide an area of geography that is of interest into generally uniform tiles. For example each tile can be 20 meters by 20 meters. This universal tiling scheme is applied to the series of GPS information to result in a set of corresponding tiles. For example each tile that contains a GPS coordinate and also any tiles in between two such tiles is included in the set of tiles. In some embodiments any two geographic tracks covering roughly the same terrain will map to the same set of universal tiles despite small differences in their respective sets of GPS information.

At optionally tiles are added to fill in tiles to provide a path between the GPS points that includes a contiguous set of tiles. For example if two consecutive GPS points do not map to adjacent tiles then any tiles traversed by the line connecting the consecutive GPS points can be added to the set of tiles e.g. filling in the tiles between the GPS points before expansion .

At optionally the set of tiles is expanded. In some embodiments the set of tiles can be expanded to encompass adjacent tiles to compensate for differences in GPS data. For example the adjacent eight tiles of each tile in the set of tiles produced at can be included in the set of tiles if they are not already included. However the set of tiles can be expanded in other appropriate ways as well.

At the set of tiles are grouped into a set of MBRs. In some embodiments tiles in the set that are close to each other are grouped into one MBR. In some embodiments each dimension e.g. height width of a MBR is a one or more entire tiles. For example to group a set of tiles into a set of MBRs the tiles of the set are first merged into a set of non overlapping rectangular boxes. In one approach cells that adjoin horizontally are merged into a set of wide boxes each one tile tall. Next each box is then compared to the boxes on the row below and if there is a box of the same width and horizontal position they are merged. The resulting set of boxes is the desired set of MBRs. However grouping the set of tiles into a set of MBRs is not limited to only the previous example.

In some embodiments each MBR is identified by the coordinates of its four respective corners e.g. on the tiling scheme . In some embodiments the set of MBRs is stored at a database for segments. For example the MBRs of the set can be stored in rows of a R Tree indexed database table. The MBRs of the set can also be stored with an identifier associated with the segment they represent.

However in some embodiments a segment can be stored as the corresponding set of GPS data points as opposed to being converted into MBRs and then stored .

While the example of includes only four entries for each of the MBRs in the set for a segment an actual segment may include thousands of entries at the database depending on the length of the track. In some embodiments entries of a database for storing segment information can include more or fewer columns than the ones shown in the example of . In some embodiments a set of information for a segment stored at a database includes all the efforts e.g. from an efforts database and their associated data that have been determined to match the segment. That way when a segment is retrieved from a database a history of athletic performance e.g. as represented by the matched efforts and their associated data can be quickly accessed as well.

In some embodiments a segment is stored as a set of MBRs in a R Tree indexed database. In some embodiments a segment is stored as a set of GPS data points in a database.

In some embodiments a segments database is queried to determine whether the query input e.g. a geographical track that is represented by a series of GPS data points matches to a defined segment at the database. As used herein a series of GPS information e.g. belonging to an effort matches to another series of GPS information e.g. belonging to a segment when their percentage of match exceeds a certain threshold.

At a series of GPS information is converted if appropriate. In some embodiments the series of GPS information is extracted from an effort e.g. recorded by a GPS enabled device . In some embodiments the GPS information is a series of consecutive GPS data points. In some embodiments the segments are stored in an abstracted form such as a set of MBRs. If the segments are stored as sets of MBRs then the series of GPS information is also converted into a set of MBRs. In some embodiments segments are stored as set of GPS data points so the GPS information does not need to be converted into another form.

At the segments database is queried using the GPS information. In some embodiments a query of the database returns portions e.g. GPS data points MBRs of segments that are similar to the series of GPS information.

In some embodiments the segments are stored as sets of MBRs at a R Tree indexed database. For example to search at the database the MBRs converted from the GPS information are used to perform a bounding box query on the R Tree indexed database. The query returns MBRs that overlap with the input MBRs. Overlapping MBRs are considered to be similar. For overlapping MBRs their respective entries from a table e.g. table of at the database can be returned. Referring to table in this example assume that MBR MBR and MBR which all belong to segment Old La Honda have been found to overlap. Thus the respective rows for MBR MBR and MBR can be returned so that their entries may be analyzed e.g. to determine whether the set of input MBRs matches to the segment of Old La Honda . In some embodiments overlapping MBRs associated with more than one segment may be returned.

In some embodiments the segments are stored as sets GPS data points at a database. Various search techniques for determining similar series of GPS data points e.g. within a tolerance may be employed to find similar segments at the database. In one example technique each GPS data point at the database is assumed to include a tolerance zone that is indicated by a radius of a selected length e.g. 50 meters . Each point in the series of GPS information is also assumed to include a tolerance zone that is indicated by a radius of a selected length which can be the same length as the radius of a point at the database. As a result each GPS data point can be thought of as spanning a circle of area. Subsequently the circular area of each point in the series of GPS information is used to search for an overlapping circle associated with a GPS data point associated with a segment at the database. In some embodiments GPS data points of the database that correspond to the overlapping circles can be returned. In some embodiments GPS data points associated with more than one segment may be returned.

In some embodiments searching for similar segments using a series of GPS data points requires more computational time and or resources than is needed for using MBRs and a R Tree indexed database.

In some embodiments when the segments are stored as MBRs the percentage of match is determined using the returned MBRs. In some embodiments the percentage of match of a series of GPS information to a segment is calculated based on the ratio between the number of overlapped MBRs of the segment to the total number of MBRs for the segment. If the ratio exceeds a threshold then the geographical track represented by the series of GPS information is considered to match the segment. In some embodiments the similarity of a series of GPS information to a segment is calculated based on the sum of the fill ratios of the returned MBRs. If the sum of the fill ratios exceeds a threshold then the geographical track represented by the series of GPS information is considered to match the segment. In some embodiments MBRs returned as a result of the query e.g. include their respective rows from a table at the database. Referring to the table of in this example assume that that MBR MBR and MBR all belonging to segment Old La Honda have been found to overlap. Thus the respective rows for MBR MBR and MBR are returned. In this example the similarity between the series of GPS information and the Old La Honda segment is calculated based on the sum of the fill ratios for the overlapped MBRs. Since MBR MBR and MBR are overlapped the sum of their respective fill ratios i.e. 6 26 4 26 10 26 is 20 26 or about 76.9 . If the threshold percentage for a match is 65 then the series of GPS information is considered to match the Old La Honda segment. In some embodiments MBRs can be returned for more than one segment and the similarity to each of those segments can be determined.

In some embodiments when the segments are stored as sets of GPS data points the percentage of match is determined based on the number of GPS data points that are returned by the query. In some embodiments if the ratio of the number of GPS data points returned by the query to the total number of GPS data points associated with the segment exceeds a certain threshold then the geographical track represented by the series of GPS information is considered to match the segment. In some embodiments GPS data points can be returned for more than one segment the percentage of match to each of those segments can determined

In some embodiments if the percentage of match between the series of GPS information falls below a threshold e.g. 65 then the geographical track is considered to not match the segment. In some embodiments there are multiple thresholds for which a series of GPS information can match a segment. In some embodiments a series of GPS information can match a segment at lower threshold e.g. between 65 to 79 and be considered as a loose match of the segment. In some embodiments a series of GPS information can match a segment at a higher threshold e.g. between 80 and 100 and be considered as a candidate to be a close match of the segment. In some embodiments to be considered to a close match of the segment not only does the series of GPS information need to match the segment at a higher threshold but the series of GPS information also needs to cross the virtual starting and finish lines of the segment. When a series of GPS information is considered to be a loose match to a segment it implies that the geographical track e.g. effort associated with the GPS information does not closely follow the track referenced by the segment. For example a cyclist who intends to take a leisurely bike ride along the general terrain demarcated by a segment can deviate somewhat from the exact segment. When a series of GPS information is considered to be a tight match of the segment it implies that the geographical track associated with the GPS information has closely followed the track referenced by the segment. For example a cyclist who intends to compete his time or another performance metric across a segment against his own record or the performances of others would need to follow more closely to the region demarcated by a segment. Also the cyclist who aims to compete his time would need to cross the virtual start and finish lines of the segment to ensure that the full length of the segment rather than only a portion thereof was traveled.

At the start of process assume that has been performed and the query has returned similar portions e.g. overlapped MBRs or GPS data points that are within a given tolerance for a segment.

In some embodiments matching an effort to a segment includes and ends after e.g. determination of a loose match but not a determination of a tight match. In some embodiments matching an effort to a segment includes to e.g. determination of a tight match but not a determination of a loose match. In some embodiments matching an effort includes both the determination of a loose match and a tight match of an effort to a stored segment.

At it is determined whether the percentage of match between an effort and the segment exceeds a first threshold. If the percentage of match is below the first threshold e.g. the percentage of match is below 65 then the effort is deemed to not match the segment and process ends. If the percentage of match exceeds the first threshold e.g. the percentage of match is above 65 then the effort is deemed to be a loose match to the segment at and control passes to .

At it is determined whether the percentage of match between an effort and the segment exceeds a second threshold. If the percentage of match exceeds the second threshold e.g. the percentage of match is above 80 then the effort is deemed be a candidate to be a tight match of the segment and control passes to . If the percentage of match is below the second threshold e.g. the percentage of match is between 65 to 79 then the effort is deemed not to be a tight match and only a loose match and the process ends.

At it is determined whether the effort crosses the start and finish lines of the segment. If both the start and the finish lines are crossed then the effort is deemed to be a tight match of the segment at . However if one or both of the lines are not crossed then the process ends and the effort is deemed not to be a tight match and only as a loose match .

In the example of the recorded effort is represented by the series of consecutive GPS coordinates P t P t P t P t and P t . Point P t was passed earlier in time than P t and P t was passed earlier in time than P t and so forth. The start point is selected at location . The selected start point takes place after P t was passed but before P t was also passed. Since the next GPS coordinate of the series is P t that is not passed linear path is drawn from P t to the selected start point. Virtual start line is selected to be in a position such that its center crosses with the center of linear path between the selected start point and P t . In the example virtual start line crosses with linear path at a 90 degree angle although the two can cross at a different angle as well. The length of virtual start line can be selected to any appropriate length e.g. 100 meters . In some embodiments the virtual start line can be stored at the segments database with its associated segment. In some embodiments the virtual start line can be stored as only the coordinates of the two ends of the line e.g. because the line can be recreated by drawing a straight line between the two coordinates . In some embodiments the virtual start line can be stored as a close series of consecutive GPS coordinates along the line.

In some embodiments a finish line can be created and stored in a similar manner as the previous technique.

In some embodiments a start or finish line is considered to be crossed when the series of GPS information of an effort can be determined to intersect the line. For example even though a series of GPS information is made of discrete points if two consecutive points are found to be on different sides of the line then the associated track is considered to have crossed the line. In some embodiments if a point in a series is found to be close e.g. within a given distance from the line then an extrapolation of the series of GPS information can be made based on the associated data e.g. speed grade heart rate that is known about the effort to determine whether if the actual physical activity had cross the virtual line even if the corresponding recording did not indicate this. For example some GPS enabled devices records GPS information at different frequencies than others. As such some discrepancies may occur between the recorded GPS information depending on the type of recording device used. However by extrapolating GPS information based on other known data at least some discrepancies may be compensated for to better ensure that an athlete who has actually crossed a line is given such credit.

At an effort is compared to a segment. In some embodiments the segment is already defined. In some embodiments the segment is stored at a database. In some embodiments the segment is stored as a set of MBRs. In some embodiments the segment is stored as a series of GPS data points. In some embodiments the effort is accessed from a database of stored past efforts.

In various embodiments the effort is compared to a segment to determine to a percentage of match. In some embodiments the GPS information associated with the effort is accessed e.g. from a database . In some embodiments if the segment is stored as a set of MBRs then the GPS information of the effort is also converted into a set of MBRs and then compared. In some embodiments if the segment is stored as a set of GPS information then GPS information of the effort need not be converted.

In some embodiments if the percentage of match is beyond a threshold then the effort is deemed to match the segment. In some embodiments an effort can match a segment at two different levels e.g. loose match and tight match . If the effort matches a segment at the lower threshold then it is determined that the effort is a loose match which implies a lower degree of similarity between geographical tracks of the effort and the segment. If the effort matches a segment at the higher threshold and additionally it is determined the effort crosses both the start and finish lines of the segment then it is determined that the effort is a tight match. In some embodiments a tight match implies a high degree of similarity between the geographical tracks between at least a portion of the effort and the segment. In some embodiments an identifier associated with the effort that matches a segment is stored with the segment. In some embodiments an identifier for a segment that matches the effort is stored with the effort.

At it is determined whether there are more efforts to compare to the segment. In some embodiments all the stored efforts are compared to the segment. In some embodiments only a subset of the stored efforts is compared to the segment. In some embodiments all the efforts compared to the segment is associated with one user. In some embodiments the efforts that are compared to the segment are associated with more than one user.

At the data associated with the matched efforts are aggregated. In some embodiments for the efforts that have been deemed to match the segment e.g. as approximate matches and or close matches their associated data e.g. heart speed heart rate power time are accessed e.g. at the efforts database and aggregated. For example the aggregated data may be temporarily stored in another database.

At the aggregated data is analyzed. In some embodiments calculations are performed using the aggregated data of the matched efforts. For example the average heart rate average speed average time average power and or average grade can be calculated. In some embodiments the set of associated data for each effort is compared to the sets of associated data for each other effort to create a sorted list of matched efforts e.g. the list can be sorted based on any one metric of the associated data . For example a sorted list can include a descending list of efforts with the fastest time. Or in another example a sorted list can include an ascending list of efforts with the highest power. For example a sorted list can include a list of the most recently recorded efforts. In some embodiments the analysis of the aggregated data can be displayed e.g. at a user interface . The display can include tables and or visuals.

By defining a geographical track as a segment it can be easily referenced for comparisons of athletic performance over the track. In some embodiments a user can define a segment at a user interface using recorded GPS data from his or her own physical activity. In some embodiments a user can define a segment at a user interface by making selections on a map. However a segment is defined once it has been defined a stored history of athletic performance e.g. efforts can be accessed to match the segment. The associated data of the matching efforts can be aggregated and presented in a table or visual that represents all or a subset of all athletic performance associated with the segment. In some embodiments the same user or another user can subsequently check if his or her recorded activity included or matched a defined segment. In this subsequent check the user can benefit from the automatic match of his or her recorded activity against defined and stored segments without needing to know exactly where a segment begins or ends.

Although the foregoing embodiments have been described in some detail for purposes of clarity of understanding the invention is not limited to the details provided. There are many alternative ways of implementing the invention. The disclosed embodiments are illustrative and not restrictive.

