---

title: Method and devices for determining noise variance for gyroscope
abstract: Methods and devices for determining a noise variance of an axis of a gyroscope are described. In one aspect, the method includes: representing a plurality of gyroscope readings for the axis in a histogram, the histogram including a plurality of bins associated with respective ranges; determining a bias for the axis of the gyroscope by identifying a concentration of the gyroscope readings within the histogram; and determining a noise variance for the axis of the gyroscope based on the histogram and based on the identified concentration of gyroscope readings.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09471539&OS=09471539&RS=09471539
owner: BlackBerry Limited
number: 09471539
owner_city: Waterloo, Ontario
owner_country: CA
publication_date: 20120824
---
The present disclosure relates generally to gyroscopes and more particularly to a method of determining a noise variance for a gyroscope.

A gyroscope is a device for measuring rotation. Gyroscopes are sometimes included in electronic devices such as handheld electronic devices in order to provide information about the orientation of such electronic devices. Such orientation information allows the electronic device to know information about its own physical position. The gyroscope may allow for recognition of movement within a three dimensional space. The electronic device may use such orientation information as an input signal. That is the electronic device may be operated in a mode in which gyroscope measurements affect the operation of the electronic device.

Even when a gyroscope is not rotating the gyroscope may have a signal output. The output when the gyroscope is not rotating is referred to as the bias or the bias error. Each sensing axis of the gyroscope may have a different bias. The bias may not be a fixed amount. That is the bias may vary over time. Such variations may for example be caused by changes to the temperature of the electronic device or changes to the operating state of the electronic device. For example the bias may be affected when the electronic device switches from an off state to an on state.

Gyroscope readings may also be subject to noise. Gyroscope readings may contain random fluctuations that are not due to movement of the gyroscope. That is even when the gyroscope is stationary the gyroscope readings obtained from the gyroscope may vary due to the effect of noise.

In one aspect the present disclosure provides a processor implemented method of determining a noise variance of an axis of a gyroscope. The method includes representing a plurality of gyroscope readings for the axis in a histogram the histogram including a plurality of bins associated with respective ranges determining a bias for the axis of the gyroscope by identifying a concentration of the gyroscope readings within the histogram and determining a noise variance for the axis of the gyroscope based on the histogram and based on the identified concentration of gyroscope readings.

In another aspect the present disclosure describes an electronic device. The electronic device includes a memory for storing a histogram and a gyroscope. The electronic device also includes a processor coupled to the memory and the gyroscope. The processor is configured to represent a plurality of gyroscope readings for an axis of the gyroscope in the histogram the histogram including a plurality of bins associated with respective ranges determine a bias for the axis of the gyroscope by identifying a concentration of the gyroscope readings within the histogram and determine a noise variance for the axis of the gyroscope based on the histogram and based on the identified concentration of gyroscope readings.

In another aspect the present disclosure describes a computer readable storage medium. The computer readable storage medium includes computer executable instructions for representing a plurality of gyroscope readings for the axis in a histogram the histogram including a plurality of bins associated with respective ranges determining a bias for the axis of the gyroscope by identifying a concentration of the gyroscope readings within the histogram and determining a noise variance for the axis of the gyroscope based on the histogram and based on the identified concentration of gyroscope readings.

Gyroscope measurements may suffer from a bias. Bias or bias error is the difference between the ideal output which is zero when the gyroscope is not rotating and the actual output when the gyroscope is not rotating. That is the bias is the gyroscope output when the electronic device is not rotating. If the bias is unknown to an electronic device interpreting the gyroscope output then the electronic device may erroneously interpret the gyroscope output. For example the electronic device may believe that the gyroscope output represents a rotation when the gyroscope is in fact not rotating.

When the electronic device which is interpreting the gyroscope output knows the bias then the electronic device can account for the bias when interpreting the gyroscope output. That is when the electronic device knows the amount of the bias the electronic device can effectively cancel out the effect of the bias to ensure that the gyroscope output is correctly correlated to rotation of the gyroscope.

Similarly gyroscope measurements may also suffer from noise. Noise is the random fluctuations that occur in gyroscope readings that are not caused by movement of the electronic device. The noise may for example be caused by random movement of charge carriers e.g. electrons carrying current.

The bias for a gyroscope and the noise variance associated with the noise for that gyroscope may be different for each sensing axis of the gyroscope. Accordingly the bias and noise variance may be determined separately for each sensing axis of the gyroscope and the electronic device which interprets the gyroscope output may cancel the effect of bias and in some cases noise variance on a per axis basis. Methods and electronic devices for determining the noise variance of a gyroscope will be discussed below.

Referring first to a gyroscope is shown located within an electronic device . The electronic device may take many forms. By way of the electronic device may be a global positioning system GPS unit an inertial navigation system INS a mobile communication device such as a mobile phone or smartphone a tablet computer a laptop computer a wearable computer such as a watch a camera or an electronic device of another type.

The electronic device may be any electronic device which makes use of one or more gyroscopes . In some embodiments the electronic device includes a display such as a liquid crystal display LCD and an input interface such as a keyboard or keypad or a navigation tool such as a clickable scroll wheel also referred to as a track wheel or thumbwheel or trackball. In some embodiments the display may be a touchscreen display which permits a user to provide input to the electronic device by touching the display . That is the display may act as an input interface .

The gyroscope measures rotational velocity of the gyroscope . In the embodiment illustrated since the gyroscope is integrated within the electronic device the gyroscope effectively measures rotational velocity of the electronic device .

The gyroscope includes one or more sensing axis. In the embodiment illustrated the gyroscope includes three orthogonal primary sensing axes denoted x y and z. Each sensing axis is orthogonal to the other sensing axes. For example the x sensing axis is orthogonal to the y and z sensing axes the y sensing axis is orthogonal to the x and z sensing axes and the z sensing axis is orthogonal to the x and y sensing axes.

The gyroscope may produce a gyroscope reading for each of the sensing axes. For example a gyroscope reading wmay be produced by the gyroscope based on gyroscope measurements associated with the x sensing axis such as a rotation about the x sensing axis a gyroscope reading wmay be produced by the gyroscope based on gyroscope measurements associated with the y sensing axis such as a rotation about the y sensing axis and a gyroscope reading wmay be produced by the gyroscope based on gyroscope measurements associated with the z sensing axis such as a rotation about the z sensing axis . These gyroscope readings collectively form the gyroscope output. That is the gyroscope output is an electronic signal which is representative of the gyroscope readings w w wfor the sensing axes x y z of the gyroscope . The electronic signal may for example provide the gyroscope readings w w wfor the sensing axes x y z of the gyroscope as measures of an amount of rotation per unit time about each sensing axis. For example the gyroscope may produce an output in terms of radians per second or degrees per second. The gyroscope output may in some embodiments be an analog output. In other embodiments the gyroscope output may be digital. A gyroscope reading captured at a point in time may be referred to as a gyroscope sample. Such samples may be obtained for example at regular intervals.

The gyroscope output may separate the gyroscope readings for each sensing axis at a signal level or at an output interface level or both. For example in some embodiments the gyroscope may have a separate output interface such as a separate pad or pin associated with each sensing axis. Each output interface associated with a sensing axis may provide an output signal representing gyroscope readings for its associated sensing axis thus separating the gyroscope readings for the sensing axes at an output interface level . In other example embodiments a common output interface such as a common pad or pin may be associated with a plurality of sensing axes. That is gyroscope readings for a plurality of sensing axes may be provided on a common output interface such as a common pad or pin .

In some embodiments the gyroscope may be a digital gyroscope provided in an integrated circuit IC having a memory such as Electrically Erasable Programmable Read Only Memory EEPROM or flash memory analog to digital A D converter and a controller such as a suitably programmed microprocessor or Field Programmable Gate Array FPGA . The IC may provide an industry standard interface such as an SPI Serial Peripheral Interface or I2C Inter Integrated Circuit interface for connecting to a printed circuit board PCB of the electronic device .

As shown in the sensing axes x y z may be aligned with the form factor of the electronic device . In some embodiments the x sensing axis is aligned along an axis extending along the midpoint of the electronic device between left and right sides of the electronic device the y sensing axis is aligned along an axis extending along the midpoint of the electronic device between top and bottom ends and the z sensing axis extends perpendicularly through the x y plane defined by the x and y sensing axes at the intersection origin of these axes. In this way when the electronic device is oriented on a flat surface such as a table the x and y sensing axes are parallel to the table and the z sensing axis is perpendicular to the table. It is contemplated that the sensing axes x y z may be aligned with different features of the electronic device in other embodiments.

Referring now to a block diagram of an example electronic device is illustrated. The electronic device of may include a housing which houses components of the electronic device . Internal components of the electronic device may be constructed on a printed circuit board PCB . The electronic device includes a controller including at least one processor such as a microprocessor which controls the overall operation of the electronic device . The processor interacts with device subsystems such as a wireless communication subsystem for exchanging radio frequency signals with a wireless network to perform communication functions. The processor interacts with additional device subsystems including one or more input interfaces such as a keyboard one or more control buttons one or more microphones one or more cameras a gyroscope and or a touch sensitive overlay associated with a touchscreen display flash memory random access memory RAM read only memory ROM auxiliary input output I O subsystems a data port which may be a serial data port such as a Universal Serial Bus USB data port one or more output interfaces such as a display which may be a liquid crystal display LCD one or more speakers or other output interfaces a short range communication module and other device subsystems generally designated as . Some of the subsystems shown in perform communication related functions whereas other subsystems may provide resident or on device functions.

The electronic device may include a touchscreen display in some example embodiments. The touchscreen display may be constructed using a touch sensitive input surface connected to an electronic controller. The touch sensitive input surface overlays the display and may be referred to as a touch sensitive overlay. The touch sensitive overlay and the electronic controller provide a touch sensitive input interface and the processor interacts with the touch sensitive overlay via the electronic controller. That is the touchscreen display acts as both an input interface and an output interface .

The communication subsystem includes a receiver a transmitter and associated components such as one or more antenna elements and local oscillators LOs and a processing module such as a digital signal processor DSP . The antenna elements and may be embedded or internal to the electronic device and a single antenna may be shared by both receiver and transmitter as is known in the art. The particular design of the wireless communication subsystem depends on the wireless network in which the electronic device is intended to operate.

The electronic device may communicate with any one of a plurality of fixed transceiver base stations of the wireless network within its geographic coverage area. The electronic device may send and receive communication signals over the wireless network after the required network registration or activation procedures have been completed. Signals received by the antenna through the wireless network are input to the receiver which may perform such common receiver functions as signal amplification frequency down conversion filtering channel selection etc. as well as analog to digital A D conversion. A D conversion of a received signal allows more complex communication functions such as demodulation and decoding to be performed in the DSP . In a similar manner signals to be transmitted are processed including modulation and encoding for example by the DSP . These DSP processed signals are input to the transmitter for digital to analog D A conversion frequency up conversion filtering amplification and transmission to the wireless network via the antenna . The DSP not only processes communication signals but may also provide for receiver and transmitter control. For example the gains applied to communication signals in the receiver and the transmitter may be adaptively controlled through automatic gain control algorithms implemented in the DSP .

In some example embodiments the auxiliary input output I O subsystems may include an external communication link or interface for example an Ethernet connection. The electronic device may include other wireless communication interfaces for communicating with other types of wireless networks for example a wireless network such as an orthogonal frequency division multiplexed OFDM network.

In some example embodiments the electronic device also includes a removable memory module typically including flash memory and a memory module interface . Network access may be associated with a subscriber or user of the electronic device via the memory module which may be a Subscriber Identity Module SIM card for use in a GSM network or other type of memory module for use in the relevant wireless network type. The memory module may be inserted in or connected to the memory module interface of the electronic device .

The electronic device may store data in an erasable persistent memory which in one example embodiment is the flash memory . In various example embodiments the data may include service data having information required by the electronic device to establish and maintain communication with the wireless network . The data may also include user application data such as email messages address book and contact information calendar and schedule information notepad documents images and other commonly stored user information stored on the electronic device by its user and other data.

The data may in at least some embodiments include one or more bias values for the gyroscope . The bias may identify the bias of the gyroscope . The memory may store a plurality of biases . For example the memory may include a bias for each of the sensing axes x y z of the gyroscope . The gyroscope bias may be used by the electronic device when interpreting an output of the gyroscope . That is the electronic device may be configured to account for the bias when interpreting gyroscope measurements.

The data may in at least some embodiments include one or more noise variance values. The noise variance may identify the noise variance of the gyroscope . In at least some embodiments the memory may store a plurality of noise variances . For example the memory may include a noise variance value for each of the sensing axes x y z of the gyroscope . The noise variance may be used by the electronic device when determining whether a movement of the electronic device has occurred. That is the electronic device may be configured to account for the noise variance when interpreting gyroscope measurements.

The data may in at least some embodiments include one or more histogram . The histogram is a representation of past gyroscope readings w w wfor a sensing axis. That is a histogram is associated with one of the sensing axes. While a single histogram is illustrated in the data may include a greater number of histograms in other embodiments. For example the data may in at least some embodiments include a histogram for each sensing axis of the gyroscope . Accordingly in the example embodiment of in which the gyroscope is a three axis gyroscope the data may include three histograms. An x axis histogram may be associated with the x sensing axis of the gyroscope a y axis histogram may be associated with the y sensing axis of the gyroscope and a z axis histogram may be associated with the z sensing axis of the gyroscope .

As will be described in greater detail below the histograms may be created maintained and or used by a software application or module such as a gyroscope calibration application .

The data stored in the persistent memory e.g. flash memory of the electronic device may be organized at least partially into a number of databases or data stores each containing data items of the same data type or associated with the same application. For example email messages contact records and task items may be stored in individual databases within the electronic device memory.

The data port may be used for synchronization with a user s host computer system. The data port enables a user to set preferences through an external device or software application and extends the capabilities of the electronic device by providing for information or software downloads to the electronic device other than through the wireless network . The alternate download path may for example be used to load an encryption key onto the electronic device through a direct reliable and trusted connection to thereby provide secure device communication.

In some example embodiments the electronic device is provided with a service routing application programming interface API which provides an application with the ability to route traffic through a serial data i.e. USB or Bluetooth Bluetooth is a registered trademark of Bluetooth SIG Inc. connection to the host computer system using standard connectivity protocols. When a user connects their electronic device to the host computer system via a USB cable or Bluetooth connection traffic that was destined for the wireless network is automatically routed to the electronic device using the USB cable or Bluetooth connection. Similarly any traffic destined for the wireless network is automatically sent over the USB cable Bluetooth connection to the host computer for processing.

The electronic device also includes or is connectable to a power source such as a battery . The battery may be one or more rechargeable batteries that may be charged for example through charging circuitry coupled to a battery interface such as the serial data port . The battery provides electrical power to at least some of the electrical circuitry in the electronic device and the battery interface provides a mechanical and electrical connection for the battery . The battery interface is coupled to a regulator not shown which provides power V to the circuitry of the electronic device .

The short range communication module provides for communication between the electronic device and different systems or devices which need not necessarily be similar devices. For example the short range communication module may include an infrared device and associated circuits and components or a wireless bus protocol compliant communication mechanism such as a Bluetooth communication module to provide for communication with similarly enabled systems and devices.

The electronic device includes a gyroscope which is configured to sense rotation of the electronic device . The gyroscope may in at least some embodiments be a three axis gyroscope of the type described above with reference to .

A predetermined set of applications that control basic device operations including data and possibly voice communication applications may be installed on the electronic device during or after manufacture. Additional applications and or upgrades to an operating system or software applications may also be loaded onto the electronic device through the wireless network the auxiliary I O subsystem the data port the short range communication module or other suitable device subsystems . The downloaded programs or code modules may be permanently installed for example written into the program memory e.g. the flash memory or written into and executed from the RAM for execution by the processor at runtime.

In some example embodiments the electronic device may provide two principal modes of communication a data communication mode and a voice communication mode. In the data communication mode a received data signal such as a text message an email message or webpage download will be processed by the communication subsystem and input to the processor for further processing. For example a downloaded webpage may be further processed by a web browser or an email message may be processed by the email messaging application and output to the display . A user of the electronic device may also compose data items such as email messages for example using an input interface in conjunction with the display . These composed items may be transmitted through the communication subsystem over the wireless network .

In the voice communication mode the electronic device provides telephony functions and may operate as a typical cellular phone. The overall operation is similar to the data communication mode except that the received signals would be output to the speaker and signals for transmission would be generated by a transducer such as the microphone . The telephony functions are provided by a combination of software firmware i.e. a voice communication module and hardware i.e. the microphone the speaker and input devices . Alternative voice or audio I O subsystems such as a voice message recording subsystem may also be implemented on the electronic device . Although voice or audio signal output may be accomplished primarily through the speaker the display may also be used to provide an indication of the identity of a calling party duration of a voice call or other voice call related information.

The processor operates under stored program control and executes software modules stored in memory such as persistent memory for example in the flash memory . As illustrated in the software modules may include operating system software and one or more additional applications or modules such as for example a gyroscope calibration application .

In the example embodiment of the gyroscope calibration application is illustrated as being implemented as a stand alone application . However in other example embodiments the gyroscope calibration application could be provided by another application or module such as for example the operating system software . Furthermore while the gyroscope calibration application is illustrated with a single block the functions or features provided by the gyroscope calibration application could in at least some embodiments be divided up and implemented by a plurality of applications and or modules.

Furthermore while in the example embodiment of the gyroscope calibration application is illustrated as being associated with the main processor of the electronic device in other embodiments the gyroscope calibration application could be associated with another processor or group of processors. For example in some embodiments the gyroscope may include or be connected to a secondary processor. The secondary processor may provide a narrow set of functions or features and may be used to offload some processing from the main processor . For example in some embodiments the secondary processor is a gyroscope specific processor which is coupled to the gyroscope and which is configured to provide gyroscope related functions such as those provided by the gyroscope calibration application . For example the secondary processor may be configured to determine the bias and or noise variance of the gyroscope in the manner described herein and may in at least some embodiments be configured to correct for the bias and or noise variance . For example the secondary processor may separate and remove the effect of the bias from gyroscope readings and may provide the resulting corrected gyroscope readings to the main processor for further analysis and or interpretation. In at least some embodiments the secondary processor may determine whether a gyroscope reading represents a movement of the electronic device based on the bias and the noise variance .

The gyroscope calibration application may be configured to determine the bias and or noise variance for a gyroscope . The gyroscope calibration application is configured to dynamically determine the bias and or the noise variance . More particularly since bias can change over time for example due to temperature variations age of the electronic device voltage etc. the gyroscope calibration application repeatedly determines a bias and may in at least some embodiments repeatedly determine a noise variance . That is in at least some embodiments in order to account for changes in the bias and or noise variance the gyroscope calibration application may determine the bias and or noise variance a number of times. In at least some embodiments the gyroscope calibration application continually operates e.g. runs in the background to monitor changes in the bias and or noise variance .

While a single bias and noise variance are illustrated in the gyroscope calibration application may in at least some embodiments determine a bias and or noise variance for each sensing axis x y z of the gyroscope . For example the gyroscope calibration application may determine three biases for a three axis gyroscope . Similarly the gyroscope calibration application may determine three noise variances for a three axis gyroscope.

In at least some embodiments the gyroscope calibration application is configured to use histograms to determine the biases and the noise variances . As will be described in greater detail below with reference to the gyroscope calibration application may be configured to cause the electronic device to track gyroscope readings using the histograms. Each sensing axis of the gyroscope may have a separate histogram associated therewith which may be used for tracking the gyroscope readings associated with that axis.

Accordingly in at least some embodiments the gyroscope calibration application may determine the bias for an axis of the gyroscope by representing a plurality of gyroscope readings for that axis in a histogram . The histogram may then be used to determine the bias for that axis. The use of a histogram may allow a bias to be easily identified. That is the bias may be identified by looking for an area of the histogram which has a high concentration of readings e.g. by identifying the most significant bin .

Since the histogram represents gyroscope readings which are obtained over time the histogram will represent both periods of rotation and periods of no rotation. That is the histogram will include gyroscope readings from periods when the gyroscope and hence the electronic device is rotating and gyroscope readings from periods when the gyroscope and hence the electronic device is not rotating. The rate of rotation during the periods of rotation tends to vary since a user will not typically be rotating the electronic device at a constant rate. Accordingly the gyroscope readings during the periods of rotation may vary widely across the gyroscope s range. However during the periods without rotation the gyroscope readings will reflect the bias . Thus over time the histogram reflects a concentration of gyroscope readings at the bias . The gyroscope calibration application may use the histogram to identify such a point of concentration and consequently identify the bias .

The high concentration of gyroscope readings may be identified for example by identifying a most significant bin in the histogram . The most significant bin is identified based on the bin population for the bins and the width for the bins . For example in some embodiments the gyroscope calibration application may determine the most significant bin by calculating a bin significance score for each of the bins. The bin significance score for a bin may be calculated by dividing the bin population for the bin by the width of the bin. Accordingly the bin significance score varies directly with the bin population and inversely with the width of the bin. The bin having the highest bin significance score may be selected as the most significant bin .

The histogram may also be used by the gyroscope calibration application to determine the noise variance . More particularly in at least some embodiments the electronic device may determine that the bins of a histogram that are adjacent to the bin of the histogram that contains the bias represent noise. The electronic device may consider the noise of the gyroscope to be Additive White Gaussian Noise AWGN and may determine the noise variance by modelling the noise as AWGN. As will be explained in greater detail below the bins of the histogram that are adjacent to the bin of the histogram that contains the bias may be considered to be noise bins. That is these adjacent bins may be considered to represent the noise of the gyroscope . Data from these noise bins may be fitted to a Gaussian curve to determine the noise variance.

In at least some embodiments based on the bias and the noise variance the electronic device may identify movements of the electronic device . That is the noise variance and the bias may effectively be used to determine one or more thresholds. These thresholds may be used for differentiating between a movement of the electronic device and a non movement of the electronic device .

In at least some embodiments the gyroscope calibration application may perform one or more maintenance operations on the histogram . The maintenance operations may be used to improve the efficiency of the histogram . That is the maintenance operations may be used to improve the speed at which the histogram may be used to identify a bias and or a noise variance and or the accuracy of the bias and or noise variance which is identified.

For example in at least some embodiments which will be described in greater detail below with reference to the gyroscope calibration application may be configured to adapt bin widths of the histogram if one or more predetermined conditions is satisfied. That is the gyroscope calibration application may adjust the range of some of bins of the histogram. This may be done for example by splitting a single bin into two or more bins and by merging two or more bins which are adjacent to each other into a single bin. In at least some embodiments during such bin width adaptation the number of bins in the histogram remains fixed. That is the number of bins before bin width adaptation is performed is the same as the number of bins after bin width adaptation is performed. Each bin that is split into two bins may be offset by combining two bins together so that the net number of bins is the same. Accordingly the bins in the histogram may have different widths.

Bin width adaptation may be used to allow the histogram to better focus on areas of concentration in the histogram . That is adaptation allows a bin which includes gyroscope readings representing the bias to be made narrow and allows bins further away from the bias point to be made much wider. A narrow bin width for the bin which includes gyroscope readings representing the bias allows the bias to be easily estimated once that bin is identified.

Since the bin significance score of a bin varies inversely with the bin width but directly with the bin population the bin width adaptation will not unduly affect the bin significance scores. That is when bins are combined due to the adaptation the resulting bin has a larger width which tends to decrease the bin significance score but also has a larger bin population which tends to increase the bin significance score . Similarly when bins are split due to the adaptation the resulting bins each have a smaller width which tends to increase the bin significance score but also have smaller bin populations which tends to decrease the bin significance score . Accordingly the effect of the bin width adaptation on the bin significance scores may be minimal.

In at least some embodiments the gyroscope calibration application may be configured to maintain the histogram by occasionally reducing the population of the histogram . That is the gyroscope calibration application may reduce the population of the histogram if one or more conditions are met. For example in some embodiments if the bin population of the largest bin the bin with the highest bin population exceeds a predetermined threshold then the gyroscope calibration application may effectively reduce the size of the bins. The population of all bins in the histogram may in at least some embodiments be reduced by the same factor. For example in some embodiments the bin population of all bins is reduced by a factor of two. Bin reduction will be described in greater detail below with reference to .

Further functions and features of the gyroscope calibration application will be described in greater detail below with reference to .

The electronic device may include a range of additional software applications including for example a notepad application voice communication i.e. telephony application mapping application a media player application or any combination thereof. Each of the software applications may include layout information defining the placement of particular fields and graphic elements e.g. text fields input fields icons etc. in the user interface i.e. the display according to the application.

The software modules or parts thereof may be temporarily loaded into volatile memory such as the RAM . The RAM is used for storing runtime data variables and other types of data or information. Although specific functions are described for various types of memory this is merely one example and a different assignment of functions to types of memory could also be used.

In the description which follows reference will be made to methods which are illustrated in . Any one or more of these methods may include features which may be provided by an electronic device such as the electronic device of . For example one or more applications or modules associated with an electronic device such as the gyroscope calibration application may contain processor readable instructions for causing a processor associated with the electronic device to perform one or more operations of the methods of . That is in at least some example embodiments the electronic device may be configured to perform one or more of the methods . For example one or more of the methods may be implemented by a processor of an electronic device .

In at least some embodiments one or more of the functions or features of one or more of the methods may be performed in whole or in part by another system software application module component or device apart from those specifically listed above. For example in some embodiments one or more of the methods may be performed by a processor associated with the gyroscope . That is in at least some embodiments one or more of the methods or a portion thereof may be performed by a processor other than the main processor the electronic device . A processor which is associated with the gyroscope and which may be used for the specific purpose of controlling the gyroscope i.e. a gyroscope specific processor may be configured to perform one or more of the methods or a portion thereof.

Referring first to a method of determining a noise variance for an axis of a gyroscope is illustrated. In the embodiment illustrated the method may be performed to obtain the noise variance for an axis of the gyroscope . The method may be performed repeatedly to obtain noise variances for all axes of the gyroscope .

At the electronic device represents a plurality of gyroscope readings for an axis of the gyroscope in a histogram . An example histogram will be described below with reference to . As will be described in greater detail below with reference to the histogram includes a plurality of bins that are associated with respective ranges. That is each bin has a range which is associated with that bin. The range of the bin defines gyroscope readings which are considered to be included within that bin. That is the ranges of the bins define boundaries which are used to separate gyroscope readings into the bins.

Accordingly at the electronic device effectively builds a histogram which includes past gyroscope readings for the axis. The histogram represents the number of times a gyroscope reading was within each of the ranges of the bins of the histogram . That is the histogram is used to track past gyroscope readings to allow for easy identification of highly concentrated gyroscope reading values.

The histogram which is generated at may have a small number of bins. For example in some embodiments the number of bins is less than twenty. In some embodiments the number of bins is less than ten. In some embodiments the histogram includes eight bins. A small number of bins may allow gyroscope readings to be assigned to a bin rapidly and may allow for easier evaluation of bins when determining the bias and or noise variance from the histogram .

An example method for adding a gyroscope reading for an axis to the histogram for that axis will be described in greater detail below with reference to . That is a method of generating a histogram based on gyroscope readings will be described in greater detail below.

At the bias is determined for the axis of the gyroscope which is associated with the histogram obtained at . The bias is determined by identifying a concentration of the gyroscope readings within the histogram . That is the bias is determined by looking for an area of the histogram where there are a large number of gyroscope readings within a small range.

In at least some embodiments the bias for the axis of the gyroscope may be determined at based on bin populations of the bins. The bin population for a bin identifies a total number of gyroscope readings associated with that bin. The bias may in at least some embodiments also be determined based on bin widths for the bins.

For example in some embodiments the electronic device may at identify a most significant bin for the histogram . The most significant bin is identified based on the bin population for the bins and the width for the bins. For example in some embodiments the gyroscope calibration application may determine the most significant bin by calculating a bin significance score for each of the bins. The bin significance score for a bin may be calculated by dividing the bin population for the bin by the width of the bin. Accordingly the bin significance score varies directly with the bin population and inversely with the width of the bin. The bin having the highest bin significance score may be selected as the most significant bin.

After identifying the most significant bin the electronic device may determine the bias for an axis of the gyroscope based on the identified most significant bin. For example the electronic device may determine the bias for the gyroscope by averaging the gyroscope readings in the most significant bin. That is the bias may be determined as the average of the values of the gyroscope readings which were included in the most significant bin.

In at least some embodiments at after the bias is determined the bias may be stored in memory of the electronic device and or used in subsequent gyroscope measurements. That is the electronic device may compensate for the bias when gyroscope readings are obtained. That is the effect of the bias may be removed from subsequent gyroscope readings.

At the electronic device may determine the noise variance for the gyroscope . The noise variance may be determined based on the histogram and also based on the concentration of bin readings that was identified at . More particularly the variance may be determined based on the bias determined at and based on other features of the histogram which will be described below.

In at least some embodiments the electronic device may identify one or more bins of the histogram that are adjacent to the bin containing the bias i.e. bins that are adjacent to the most significant bin . Typically there will be two such bins one to the left of the bin containing the bias and one to the right of the bin containing the bias. These bins may be referred to as noise bins since they represent the effect of noise on gyroscope readings. Thus the electronic device may determine that the bins that are adjacent to the bin containing the bias represent noise associated with the gyroscope.

The electronic device may then use these identified noise bins to determine the noise variance . More particularly since the noise is typically AWGN which may be represented using a Gaussian probability distribution function the electronic device may fit bin data associated with the noise bins to a Gaussian curve and may determine the noise variance based on the Gaussian curve. More particularly the electronic device may treat the most significant bin as being located at the center of the Gaussian curve since this bin represents the apex of the Gaussian curve. Then the electronic device determines the noise variance by solving a Gaussian probability distribution function.

More specifically the Gaussian probability distribution function that is centered at zero may be written as 

This equation may be solved using known values for P x such as the bin significance scores for the bin containing the bias and the bin significance scores for the bins adjacent to the bin containing the bias i.e. the noise bins .

The bin significance score for a bin may be calculated by dividing the bin population for the bin by the width of the bin. Accordingly the bin significance score varies directly with the bin population and inversely with the width of the bin.

In at least some embodiments to determine the noise variance the electronic device identifies the distance between the bin containing the bias i.e. the most significant bin and one or more of the adjacent bins. Since noise is typically present in a Gaussian distribution the distance between both noise bins and the bin containing the bias i.e. the most significant bin will typically be approximately the same. As illustrated in these distances may be measured from the center of the noise bins to the center of the most significant bin. The distances may in at least some embodiments be averaged to obtain the representation of the distances D that will be used to obtain the noise variance . The distance D that is used in the equation for noise variance above is a measure of the difference between the average gyroscope readings contained in the noise bins and the average gyroscope readings contained in the bin containing the bias. Thus in at least some embodiments the distance D is a measure of the how far apart the gyroscope readings in the noise bin are from those in the bias bin.

In order to solve the equation above and determine the noise variance in at least some embodiments the electronic device identifies a bin population associated with the bin of the histogram containing the bias i.e. the most significant bin . The electronic device may also identify the width of the bin containing the bias and may determine a bin significance score for the bin containing the bias based on the bin population and the width of the bin containing the bias i.e. it may determine P bias .

Similarly the electronic device may identify one or more bin populations associated with one or more bins that are adjacent to the bin of the histogram containing the bias i.e. the most significant bin and widths associated with those bins. Using the bin populations and widths a bin significance score may be determined for the bins that are adjacent to the bias bin i.e. for the noise bin . The bin significance scores of the bins that are adjacent to the bin containing the bias may be averaged to produce a value P Adjacent that will be used to determine the noise variance.

After the electronic device identifies the information referred to above i.e. a distance D representing the distance between the bin containing the bias and the bins adjacent to the bias bin a bin significance score P bias associated with the bin of the histogram containing the bias and bin significance scores associated with the bin containing the bias and bin s adjacent to the bin containing the bias the electronic device may then determine the noise variance based on these values. For example the electronic device may use these identified values in the variance equation provided above to determine the noise variance .

In some embodiments not shown the electronic device may perform a check before determining the noise variance. More particularly the electronic device may determine whether the histogram contains enough data to be useful for estimating the noise variance. In at least some embodiments the electronic device may do so by comparing the number of gyroscope readings in the histogram to a predetermined threshold. Based on the comparison the electronic device may determine whether the histogram contains too few gyroscope readings to be reliable. For example in some embodiments if the number of gyroscope readings represented by the histogram is less than a predetermined threshold then the electronic device may determine that the histogram contains too few readings to be reliable. When this happens the electronic device may generate an error. The error may be generated instead of or in addition to the step of determining the noise variance. For example in some embodiments the noise variance may not be determined when the error is generated. In other embodiments the noise variance may be determined even when the error is generated. In such embodiments the error effectively indicates that the noise variance may be unreliable.

In at least some embodiments at after the noise variance is determined the noise variance may be stored in memory of the electronic device .

In some embodiments at the electronic device may perform histogram maintenance on the histogram . That is at one or more maintenance operations may be performed on the histogram . The maintenance operations may be used to improve the efficiency of the histogram . That is the maintenance operations may be used to improve the speed at which the histogram may be used to identify a bias and or the accuracy of the bias which is identified.

As will be described in greater detail below with reference to in at least some embodiments at the electronic device may improve precision in concentrated areas of the histogram by adapting bin widths. As will be described in greater detail below with reference to in at least some embodiments at the electronic device may reduce the size of the histogram .

After the noise variance and bias have been determined these values may be used for determining whether a gyroscope reading represents movement. For example at a gyroscope reading may be obtained and at the electronic device may determine based on the gyroscope reading the bias and the noise variance whether the gyroscope reading represents a movement of the gyroscope .

In order to determine whether the gyroscope reading represents a movement the electronic device may determine a measure of the difference between the gyroscope reading and the bias . For example the electronic device may determine a square of the difference between the bias and the gyroscope reading. The electronic device may also determine a variance threshold as the product of the noise variance and a predetermined value. For example the variance threshold may be determined by multiplying the noise variance by a predetermined factor. Then the electronic device may determine whether the difference between the gyroscope reading and the bias is greater than the variance threshold. If so the electronic device may determine that the gyroscope reading represents a movement of the gyroscope. If not then the electronic device may determine that the gyroscope reading does not represent a movement of the gyroscope.

In at least some embodiments the method may be repeated. That is the method may be performed multiple times in order to ensure that the determined bias and or noise variance remains accurate. For example the method may upon completing resume operation again at . Similarly after a bias and or noise variance is established and may operate in parallel with other features of the method. That is the electronic device may continue to update the bias noise variance and or histogram according to features through and may at the same time determine whether the electronic device is moving using features and .

Referring now to at example histogram is illustrated. The example histogram includes a plurality of bins . For the sake of clarity only a single bin has been labelled.

The example histogram illustrates the bin population of each bin illustrated on the y axis . For the sake of clarity only a single bin population has been labelled. Each bin has an associated bin population . The bin population is a measure of the number of gyroscope readings which were included in the bin . That is the bin population illustrates the number of samples which were considered to fall within the bin .

In the example histogram the x axis has been used to represent gyroscope reading values which are considered to be associated with that bin. That is the x axis of the histogram effectively illustrates the range of each bin . It will be appreciated that in other examples the histogram may be represented so that the x axis represents a bin number instead of the range of gyroscope reading values for the bin.

Each bin has an associated bin width only one of which has been labelled . The bin width is defined by the range of the bin. That is the bin width is the difference between an upper limit for gyroscope readings which are considered to be associated with the bin and a lower limit for gyroscope readings which are considered to be associated with the bin .

Two bins may be considered to be extreme bins . The extreme bins are the bins which are at the outside of the histogram . The extreme bins include a lower extreme bin and an upper extreme bin . The extreme bins and effectively define the range of the histogram . A lower limit of the range of the lower extreme bin defines a lower limit associated with the histogram and an upper limit of the range of the upper extreme bin defines an upper limit associated with the histogram .

One of the bins may be considered to be a most significant bin . The most significant bin identifies a point of concentration in the histogram . That is the most significant bin is a bin having the best combination of bin width and bin population. Methods of identifying which bin is the most significant bin are described in greater detail with reference to .

The bins adjacent to the most significant bin are the noise bins . These noise bins are immediately adjacent to the most significant bin . One of the noise bins is to the left of the most significant bin and one of the noise bins is to the right of the most significant bin .

Referring now to a method for obtaining a histogram is illustrated in flowchart form. The method may for example be performed at of the method of .

At the electronic device may in some embodiments determine whether the histogram is already initialized. For example the electronic device may determine whether the memory of the electronic device already includes the histogram or whether a new histogram must be created.

If the histogram is not already initialized then at the histogram may be initialized. In at least some embodiments the histogram may be initialized by storing in memory a histogram having one or more default properties. For example the histogram may have a default number of bins each having default ranges. In at least some embodiments the histogram may be created so that all bins initially have the same bin width . The bin population for the bins of the newly created histogram may initially be nil.

After a histogram is initialized i.e. after a new histogram is initialized at or if it is determined at that a histogram is already initialized then at a gyroscope reading for may be obtained for the axis of the gyroscope associated with the histogram . That is the gyroscope may be sampled in order to obtain a gyroscope reading which may also be referred to as a sample .

At the gyroscope reading may be added to the histogram . That is the histogram may be updated to reflect the additional gyroscope reading. More particularly the electronic device may use the ranges associated with the bins of the histogram to assign the gyroscope reading to a specific one of the bins . That is an appropriate bin for the gyroscope reading is identified based on the ranges of the bins . A bin population for identified bin may be updated to reflect the fact that the bin has a new bin member.

In some embodiments a sum of gyroscope readings within each bin may be maintained by the electronic device . For example rather than track all of the individual gyroscope readings associated with a bin the electronic device may instead maintain a sum of the gyroscope readings which were associated with that bin . The sum of the readings when coupled with the bin population allows an average gyroscope reading for a bin to be determined. As noted in the discussion of of the method of above the average gyroscope reading for the most significant bin may provide the bias.

In some embodiments and in some situations a gyroscope reading may be obtained which falls outside of the range of the histogram . In some such embodiments the reading may be ignored. In other embodiments if a gyroscope reading is outside of a range of the histogram the electronic device may automatically increase the range of one of the extreme bins of the histogram so that the gyroscope reading may be included in that bin.

The method of may be repeatedly performed in order to provide a well populated histogram which yields an accurate estimate of bias .

Referring now to a method of adapting bin widths of a histogram is illustrated in flowchart form. The method may for example be performed at of the method of .

At the electronic device determines whether width adaptation is required. The electronic device may make this determination based on one or more predetermined criteria. The predetermined criteria may consider for example the bin population of the bin having the largest bin population. The predetermined criteria may also consider for example the sum of the bin populations for a pair of adjacent bins of the histogram which collectively contain fewer gyroscope readings than any other pair of adjacent bins. For example in some embodiments the electronic device may determine the ratio of the bin population of the bin having the largest bin population to the sum of the bin populations for the pair of adjacent bins which collectively contain fewer gyroscope readings than any other pair of adjacent bins. If this ratio exceeds a threshold then the electronic device may determine that bin width adaptation is required.

If bin adaptation is required then at the electronic device may identify the bin of the histogram containing the greatest number of gyroscope readings and may at identify the pair of adjacent bins of the histogram which collectively contain fewer gyroscope readings than any other pair of adjacent bins.

At the electronic device may split the largest bin into two bins. That is the electronic device may form two bins from the single largest bin. The bin width of each of the newly formed bins may be half the bin width of the largest bin. In some embodiments the bin population of each of the newly formed bins is half the bin population of the largest bin. Similarly if the electronic device maintains a sum of gyroscope readings associated with each bin then the sums for the new bins may be half of the sum from the largest bin.

At the electronic device may merge the pair of adjacent bins identified at . That is the electronic device may combine these two bins so that these two bins now become one bin. The bin width of the newly formed bin may be the sum of the bin widths of both bins in the pair. Similarly the bin population of the newly formed bin may be the sum of the bin populations for both bins in the pair. The sum of gyroscope readings associated with the newly formed bin may be the sum of the gyroscope readings for both bins in the pair.

In at least some embodiments the method maintains the number of bins in the histogram at a constant number. That is the number of bins in the histogram is the same before the method is performed as it is after the method is performed. While the ranges of individual bins may be affected the number of bins is static.

The method eventually causes the bin with the most gyroscope readings to continually split and increase its resolution. Accordingly the bin which contains the bias and which contains a high concentration of measurements will eventually become very precise. Furthermore the splitting allows slow changing bias signals to be tracked because after the bin with the bias is split one of the two sides of that bin will typically take the new gyroscope readings representing the bias.

Referring now to a method of reducing the size of a histogram is illustrated in flowchart form. The method may for example be performed at of the method of .

At the electronic device may determine whether the histogram is overpopulated. In at least some embodiments the electronic device may make this determination by comparing the bin population for the largest bin i.e. the most populated bin to a predetermined threshold. If the bin population exceeds the threshold then the electronic device may determine that the histogram is overpopulated. That is the electronic device determines that bin reduction is required. In at least some embodiments the threshold is in the range of 2000 to 4000. In some embodiments the threshold may be approximately 3000.

If the histogram is overpopulated then at the electronic device reduces the size of the histogram . In at least some embodiments at the bin population for each bin is reduced by a common factor. For example. In some embodiments the bin population for all bins is reduced by a factor of two. In at least some embodiments the sum of the gyroscope readings for each bin may be reduced by a common factor.

It will be appreciated that the methods described herein may be user assisted partially user assisted or unassisted by the device user depending on the embodiment. Accordingly in some embodiments such as those depicted in the determinations of bias and noise variance are dynamic and do not require user input.

While the present disclosure describes the calculation of biases for a gyroscope having three axes in other embodiments the gyroscope may have a different number of sensing axes such as single axis gyroscopes or two axes gyroscopes . Accordingly gyroscopes having one or two sensing axes electronic devices incorporating such gyroscopes and methods of determining bias for such gyroscopes are also within the scope of the present disclosure.

While the present disclosure is primarily described in terms of methods a person of ordinary skill in the art will understand that the present disclosure is also directed to various apparatus such as a handheld electronic device including components for performing at least some of the aspects and features of the described methods be it by way of hardware components software or any combination of the two or in any other manner. Moreover an article of manufacture for use with the apparatus such as a pre recorded storage device or other similar computer readable storage medium including program instructions recorded thereon which may for example cause a processor to perform one or more of the methods described herein or a computer data signal carrying computer readable program instructions may direct an apparatus to facilitate the practice of the described methods. It is understood that such apparatus articles of manufacture and computer data signals also come within the scope of the present disclosure.

The term computer readable storage medium as used herein means any medium which can store instructions for use by or execution by a computer or other computing device including but not limited to a portable computer diskette a hard disk drive HDD a random access memory RAM a read only memory ROM an erasable programmable read only memory EPROM or flash memory an optical disc such as a Compact Disc CD Digital Versatile Video Disc DVD or Blu Ray Disc and a solid state storage device e.g. NAND flash or synchronous dynamic RAM SDRAM .

The embodiments of the present disclosure described above are intended to be examples only. Those of skill in the art may effect alterations modifications and variations to the particular embodiments without departing from the intended scope of the present disclosure. In particular features from one or more of the above described embodiments may be selected to create alternate embodiments comprised of a sub combination of features which may not be explicitly described above. In addition features from one or more of the above described embodiments may be selected and combined to create alternate embodiments comprised of a combination of features which may not be explicitly described above. Features suitable for such combinations and sub combinations would be readily apparent to persons skilled in the art upon review of the present disclosure as a whole. The subject matter described herein and in the recited claims intends to cover and embrace all suitable changes in technology.

