---

title: Methods, systems and apparatus for the control of interconnection of fibre channel over ethernet devices
abstract: Systems, apparatus and methods are provided for interconnection of one or more Fiber Channel over Ethernet (FCoE) devices. The system preferably comprises a virtualized or virtual server which in turn comprises a virtual machine having an FCoE device interconnection apparatus controller, a virtual switch, the virtual switch being coupled to the FCoE device interconnection apparatus controller, and a network interface. The network interface is coupled to the virtual switch, which in turn couples to an Ethernet fabric. A first Ethernet link couples the network interface to the Ethernet fabric. One or more Fiber Channel over Ethernet (FCoE) devices are coupled to the Ethernet fabric via Ethernet links.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09178944&OS=09178944&RS=09178944
owner: JEDA NETWORKS, INC.
number: 09178944
owner_city: Newport Beach
owner_country: US
publication_date: 20120712
---
This patent application is a continuation in part of the following U.S. patent applications application Ser. No. 12 987 057 now U.S. Pat. No. 8 625 597 entitled Methods Systems and Apparatus for the interconnection of Fibre Channel Over Ethernet Devices application Ser. No. 12 987 063 now U.S. Pat. No. 8 811 399 entitled Methods Systems and Apparatus for the Interconnection of Fibre Channel Over Ethernet Devices Using a Fibre Channel Over Ethernet Interconnection Apparatus Controller application Ser. No. 12 987 066 now U.S. Pat. No. 8 559 433 entitled Methods Systems and Apparatus for the Servicing of Fibre Channel Fabric Login Frames application Ser. No. 12 987 073 entitled Methods Systems and Apparatus for Utilizing an iSNS Server in a Network of Fibre Channel Over Ethernet Devices application Ser. No. 12 987 077 entitled Methods Systems and Apparatus for the Interconnection of Fibre Channel Over Ethernet Devices Using a TRILL Network application Ser. No. 12 987 076 now U.S. Pat. No. 8 559 335 entitled Methods Systems and Apparatus for Converged Network Adapters and application Ser. No. 12 987 075 entitled Methods Systems and Apparatus for the Interconnection of Fibre Channel Over Ethernet Devices Using Shortest Path Bridging all filed on Jan. 7 2011 which are all incorporated herein by reference as if fully set forth herein.

The disclosures and embodiments of the invention relate to network systems and communications networks more particularly certain embodiments of the invention relate to a method and system for Fibre Channel over Ethernet networking Fibre Channel networking and Ethernet frame forwarding.

There are at least two separate networks are found in Data Centers. The more ubiquitous of the networks the Local Area Network LAN based on the Ethernet protocol is mainly used for server to server and server to internet communications. The other network the Storage Area Network SAN is specialized to carry server to storage communications. The Data Center Storage Area Network is mainly based on the Fibre Channel protocol and has the following characteristics low latency high bandwidth and a loss less network. Recently there have been innovations to merge the Storage Area Network SAN with the Local Area Network. The promised benefits include a savings on the amount of equipment and the resulting savings on the amount of equipment real estate power and cooling required. Newly created standards comprising this LAN SAN convergence define how Storage Area Network frames namely Fibre Channel protocol frames are mapped over the Ethernet network. These new frames are called Fibre Channel over Ethernet FCoE network frames. Additional standards define how to make the Ethernet network lossless i.e. to add flow control at the network level to prevent Ethernet frames from being dropped due to congestion. Still other standards define how to segment the transmission line into classes that virtually separate the communications over the transmission line.

Converging the LAN and SAN networks has created additional complexity in the management control and data switching areas. Singly the Fibre Channel switch fabric protocols are very complex and have shown to be not very interoperable between the small number of vendors who build products that support them. Mapping the Fibre Channel switch fabric protocols over Ethernet has resulted in a dizzying amount of new standards that have inhibited the market acceptance of the Fibre Channel over Ethernet FCoE mapping over this new converged network. New switches have been defined called Fibre Channel Forwarders FCFs and Fibre Channel Data Forwarders FDFs which add Fibre Channel over Ethernet and Ethernet elements to the already complex Fibre Channel switch architecture. FCFs and FDFs interconrect ENodes which are Fibre Channel or devices nodes that are able to transmit Fibre Channel over Ethernet frames. There have been some standards and innovations applied to ENodes and their embedded Virtual N Ports VN Ports to connect without using FCF s or FDF s. One of these efforts defines an ENode to ENode connection method called VN Port to VN Port VNVN whereby ENodes can connect to each other over a Lossless Ethernet network without an FCF or FDF. Other methods have been suggested to move some of the FCF FDF intelligence to the ENode. Both the emerging VNVN standard and the emerging direct ENode direct connect methods have many significant disadvantages. These disadvantages include but are not limited to the requirement for the ENode to choose a unique MAC address for each VN Port the requirement for the ENode to choose a unique Fibre Channel address identifier for each VN Port the lack of visibility into the network s supported maximum frame size or other capabilities the lack of standardized discovery of specific ENode types such as Storage targets the lack of the ability to automatically and dynamically create Fibre Channel zones or access control lists ACLs for intermediate Ethernet bridges the lack of visibility to load balance across several paths from a source ENode to a destination ENode based on FCID s and the increased complexity to scale to hundreds of ENodes which requires error prone manual configuration. Due to the lack of Fibre Channel fabric control these emerging ideas and standards target smaller networks of ENodes which are impractical in today s Data Center.

In parallel with the innovations around converging the LAN and SAN there have also been a trend to virtualize servers i.e. consolidate a corporation s many underutilized servers onto fewer more utilized servers. The server virtualization trend has many advantages including more utilization of existing underutilized servers lower equipment space power and cooling requirements since there are fewer servers. This trend results in fewer and higher utilized servers which have changed the traffic characteristics of the Local Area Network that interconnects them. The traffic requirements which used to be flowing from Internet to Server have changed to an any to any server flow. This migration in traffic patterns has produced a trend to flatten LANs i.e. consolidate the normally three layers core distribution and access of switches commonly found in a Data Center to two layers core and access . In parallel with this physical flattening trend is the trend towards utilizing layer 2 forwarding methods to keep the network in a single broadcast domain which helps support any to any connection requirements of virtualized servers and their hypervisors. New link level protocols have been defined to accelerate the ability for any to any server based virtual machine communications. Many of these new link level protocols need new switch hardware and new ways to manage the resulting network.

What is needed is a simpler way to converge the LAN and SAN in a scalable and less complex method than the trajectory of both the standards committees and emerging ENode to ENode inventions. What is also needed is have this simpler method be more compatible with the trend towards flattening the large Data Center networks. Both simpler methods need to be easily managed scalable and interoperable. Accomplishing this would accelerate LAN SAN network convergence trend and accelerate the flattening of the LAN to more easily attain the benefits of virtualization convergence and consolidation.

In one aspect of the inventions herein a system is provided for interconnection of one or more Fibre Channel over Ethernet FCoE devices. The system preferably comprises a virtualized or virtual server which in turn comprises a virtual machine having an FCoE device interconnection apparatus controller a virtual switch the virtual switch being coupled to the FCoE device interconnection apparatus controller and a network interface. The network interface is coupled to the virtual switch which in turn couples to an Ethernet fabric. A first Ethernet link couples the network interface to the Ethernet fabric. One or more Fibre Channel over Ethernet FCoE devices are coupled to the Ethernet fabric via Ethernet links.

In yet another aspect of the inventions a system method or apparatus provides for interconnection of one or more Fibre Channel over Ethernet FCoE devices under control of a FIAC virtual machine coupled to an Ethernet fabric. In one implementation a FIP Discovery Advertisement frame is multi cast over the Ethernet fabric to the one or more FCoE devices. The FIP Discovery Advertisement frame is received at the one or more FCoE devices. A response is then made from one or more of the FCoE devices to the FIAC virtual machine with a FIP Discovery Solicitation frame.

In yet another aspect of the invention automatic zone configuration is implemented through use of best practices. In the discovering of initiators and targets in the system zones are created so as to have one initiator with one target. By way of example if two initiators are found and one target the best practice rule will pair one initiator with one target in a zone for a total of two zones.

In one aspect of the invention the systems and methods use port groups such as LAGs and MLAGs by FIAs in forwarding the FCoE frames. In the preferred implementation this is accomplished without use of Fibre Channel based routing such as FSPF.

In yet another aspect of the inventions the systems and methods provide for automatic discovery of FIA ports attached to ENodes through use of the Bridge MIB. In one aspect if a MAC address is known the Bridge MIB is used to discover the port in the FIA to which the ENode is connected.

In yet another aspect when multiple modules share a single database is utilized a database trigger is provided within the system when a change is made to a database thereby informing other modules that a change occurred in the database.

In yet another aspect the FMEs are preconfigured by a FIAC to optimize FME configuration. In one implementation the FMEs are preloaded with filter table entries such that a VN Port is instantiated without the need to communicate with the FIA to set an FME.

In yet another aspect in the transport of frames between two ENodes the network between the ENodes being a TRILL network.

In yet another aspect in the transport of frames between two ENodes wherein the intervening network is a network using the Shortest Path Bridging SPB frame forwarding.

In yet another aspect of these inventions the use of FIACs apply to various systems topologies and architectures. By way of example the FIAC is used in a redundant network a redundant FIAC may be used in a redundant network a FIAC may be used in a core edge or leaf spline network and or a FIAC in a virtual chassis network.

Address or Port identifier An address value used to identify source S ID or destination D ID of a frame.

Controlling FCF Set The Switch Names of the up to two Controlling FCFs that are part of a Distributed FCF.

Converged Network Adapter CNA is a technology that supports data networking TCP IP and storage networking Fibre Channel traffic on a single I O adapter. CNA s support both Enhanced Ethernet and Fibre Channel over Ethernet FCoE .

Distributed FCF A set of FDFs associated with at least one Controlling FCF that controls the operations of the set of FDFs A Distributed FCF is defined by the administrative configuration of the Controlling FCF Set and of the FDF Set.

Encapsulated FC frame An SOF EOF delimited FC frame prefixed with a 28 byte FC frame Encapsulation Header see RFC 3643 .

ENode An FCoE Node a Fiber Channel node see FC FS 3 that is able to transmit FCoE frames using one or more ENode MACs.

ENode MAC address The MAC address used by the FCoE Controller on an ENode MAC for the FCoE Initialization Protocol FIP .

Fabric As defined in FC FS 3 an entity that interconnects various Nx Ports attached to it and is capable of routing frames using only the D ID information in an FC 2 frame header. A Fabric may also refer to an Ethernet network comprised of one or more Ethernet switches or FIAs.

FIA An FCoE interconnect apparatus. Some examples may include an Ethernet switch an Ethernet bridge or an Ethernet router.

FIB Forwarding information Base also known as a forwarding table is most commonly used in network bridging routing and similar functions to find the proper interface to which the input interface should send a packet to be transmitted by the bridge switch router or similar device.

FCF FCoE Forwarder A Fibre Channel Switching Element see FC SW 5 that is able to forward FCoE frames across one or more FCF MACs and that optionally includes one or more Lossless Ethernet bridging elements and or a Fibre Channel Fabric interface.

FDF FCoE Data Plane Forwarder A simplified FCoE switching entity that forwards FC frames among VA Ports and VF Ports through a FCDF Switching Element. An FDF shall support at least one VA Port capable FDF MAC and may support one or more VF Port capable FDF MAC. Each FDF MAC shall be coupled with an FCoE Controller function and may be coupled with a Lossless Ethernet bridging element.

FIA A FCoE and FC interconnection apparatus. The interconnection apparatus interconnects devices selected from the list which may include but not be limited to FCoE ENodes Fibre Channel devices FCF s FDF s. An FIA may also be a FCoE only interconnection apparatus i.e. not capable of handling Fibre Channel frames not embedded in Ethernet frames.

FCoE Controller A functional entity coupled with a Lossless Ethernet MAC instantiating and de instantiating VE Ports VF Ports VN Ports and or FCoE LEPs.

FCoE Entity The interface containing one or more FCoE LEPs between a VN Port a VF Port or a VE Port and a Lossless Ethernet MAC.

FCoE LEP FCoE Link End Point The data forwarding component of an FCoE Entity that handles FC frame encapsulation decapsulation and transmission reception of encapsulated frames through a single Virtual Link.

FDF FCoE Data Forwarder a Fibre Channel Switching Element see FC SW 5 that is able to forward FCoE frames across on or more FCF MACs and that optionally includes one or more Lossless Ethernet bridging elements. A FDF comprises a subset of FCF features most notably routing and zoning. A FDF is controlled by a FCF.

Link Aggregation Link Aggregation is a term to describe various methods of combining aggregating multiple network connections in parallel to increase throughput beyond what a single connection could sustain and to provide redundancy in case one of the links fails. Further umbrella terms used to describe the method include port trunking link bundling Ethernet network NIC bonding or NIC teaming. These umbrella terms not only encompass vendor independent standards such as IEEE 802.1ax Link Aggregation Control Protocol LACP for wired Ethernet or the previous IEEE 802.3ad but also various proprietary solutions.

Lossless Ethernet bridging element An Ethernet bridging function operating across Lossless Ethernet MACs.

Lossless Ethernet MAC A full duplex Ethernet MAC implementing extensions to avoid Ethernet frame loss due to congestion e.g. the PAUSE mechanism see IEEE 802.3 2008 or the Priority based Flow Control mechanism see IEEE 802.1Qbb 

Lossless Ethernet network An Ethernet network composed only of full duplex links Lossless Ethernet MACs and Lossless Ethernet bridging elements.

Multicast MAC address A MAC address associated with a group of logically related Ethernet stations on an Ethernet network and called a Multicast Group Address in IEEE 802.3 2008.

Unicast MAC address A MAC address associated with a particular Ethernet station on an Ethernet network and called an Individual Address in IEEE 802.3 2008.

VA Port Virtual A Port An instance of the FC 2V sublevel of Fibre Channel that communicates with another VA Port and that is dynamically instantiated on successful completion of a FIP ELP Exchange. A VA Port is uniquely identified by an A Port Name Name Identifier and is addressable by the VA Port connected to it through the A Port Controller address identifier i.e. FFFFF9h .

Virtual Switch is a software program that allows one virtual machine VM to communicate with another virtual machine VM . A virtual machine can intelligently direct communication on the network by inspecting packets before passing them on.

Virtual Chassis Virtual chassis is a technology that allows multiple physically separate Ethernet switches to be combined into a single logical entity for the purpose of simplifying management and configuration.

VN Port Virtual N Port An instance of the FC 2V sublevel of Fibre Channel that operates as an N Port see FC FS 3 and is dynamically instantiated on successful completion of a FIP FLOGI or FIP NPIV FDISC Exchange.

Zone A group of Zone Members. Members of a Zone are made aware of each other but not made aware of Zone Members outside the Zone.

The FCoE LEP is the functional entity performing the encapsulation of FC frames into FCoE frames in transmission and the decapsulation of FCoE frames into FC frames in reception. An FCoE LEP operates according to the MAC address of the local link end point and the MAC address of the remote link end point. When encapsulating FC frames into FCoE frames the MAC address of the local link end point shall be used as source address and the MAC address of the remote link end point shall be used as destination address of the generated FCoE frame. When decapsulating FC frames from FCoE frames the FCoE LEP shall verify that the destination address of the received FCoE frame is equal to the MAC address of the local link end point and shall verify that the source address of the received FCoE frame is equal to the MAC address of the remote link end point. If either check fails the FCoE frame shall be discarded. For a VA Port capable FDF MAC the MAC address of the local link end point is the FDF MAC address and the MAC address of the remote link end point is the MAC address of the remote FDF MAC or FCF MAC with which a FIP ELP Exchange has been successfully completed.

A VA Port is an instance of the FC 2V sublevel of Fibre Channel that is dynamically instantiated together with its FCoE LEP on successful completion of a FIP ELP Exchange according to the rules specified in the FC BB standard. A VA Port receives FC frames from the FCDF Switching Element and sends them to its FCoE LEP for encapsulation and transmission over the Lossless Ethernet network. In a similar way a VA Port sends FC frames received from its FCoE LEP to the FCDF Switching element . A VA Port is uniquely identified by an A Port Name Name Identifier and is addressed by the A Port Controller address identifier i.e. FFFFF9h . To initialize VA Port to VA Port links i.e. links between FDFs a successful completion of a FIP ELP Exchange is required. After successful FIP ELP Exchange the FCoE Controllers of the two involved VA Port capable FDF MACs instantiate a VA Port FCoE LEP pair.

Another topology defined by the ANSI T11 standards includes the instantiation of VN Port to VN Port links i.e. direct attachment between ENodes. A VNVN ENode MAC operating in either multipoint or point to point mode instantiates VN Port to VN Port Virtual Links on successful completion of a point to point PIP FLOGI as defined in FC LS 2. Both FIP FLOGI Request and LS ACC shall have the Locally Unique N Port ID of the originating VNVN Port as S ID the Locally Unique N Port ID of the destination VNVN Port as D ID for the point to point FLOGI protocol and the originating VN Port FPMA in the MAC Address descriptor. The MAC addresses of the FIP FLOGI Request and LS ACC shall be the ENode MAC addresses of the involved VNVN Ports. As specified in FC LS 2 the VNVN Port with the greater N Port Name proceeds to N Port Login with the PLOGI ELS encapsulated in FCoE. Both FCoE PLOGI Request and LS ACC shall have the Locally Unique N Port ID of the originating VNVN Port as S ID and the Locally Unique N Port ID of the destination VNVN Port as D ID. Upon completion of FCoE PLOGI the involved VN Ports operate in point to point mode see FC LS 2 . A VN Port to VN Port Virtual Link is explicitly deinstantiated by performing a FIP LOGO that deinstantiates the FCoE LEPs and performs a N Port logout. The S ID and D ID on the encapsulated LOGO ELS shall be set to the Locally Unique N Port IDs of the involved VNVN Ports. The VN Port to VN Port capability is limited due to scalability and ENode complexity in implementation issues.

In FME entry is a lower priority entry in the VIA FME table i.e. the rule will match if all it s elements match and none of the other FME entries match. In FME entries elements and may be optional. If the elements are not present frames will still be forwarded to the appropriate FCoE devices but the check that the correct Fibre Channel source identifier S ID will not be done. Further the redirect port or port group actions may also be optional i.e. the FIB in the FIA can be used to forward the frames.

The FIA FME table comprises two FME entries . FME Entry matches frames sent from T to and FME Entry matches frames sent from I to T. Note that in FME Entry there exists the capability of forwarding over a predefined Port Group. The Port Group could be a LAG group or any other method for coupling multiple ports together e.g. TRILL Port Bonding etc.

Shortest Path Bridging SPB is an IEEE draft 802.1aq . There are two SPB models for multipath bridging Shortest Path Bridging VLAN SPBV and Shortest Path Bridging MAC in MAC SPBM . is a diagram showing the interconnection of ENodes through a Shortest Path Bridging MAC in MAC SPBM network . An FCoE frame sent from an Ethernet connected ENode through a network of FIAs adapted to implement Shortest Path Bridging to a destination Ethernet connected ENode over a SPBM network . FIA FIA and FIA form a SPBM . The links from FIA to ENode and from FIA to ENode are Ethernet links . An FIAC is coupled to the SPBM network through the link . The FIAC may be located anywhere in the network as long as it can access both the FIAs to set and remove FMEs and access the ENodes to perform the FIP protocol and provide essential Fabric Services through FCoE frames. The FCoE frame transmitted from VN Port in ENode includes the following values Ethernet destination FCF MAC address of the FIAC symbolically FIACntlrMAC Ethernet source MAC address of VN Port symbolically VN Port MAC a Vlan identifier symbolically VLAN data and an FCS . FIA substitutes the destination MAC address with VN Port s MAC address symbolically VN PortMAC and substitutes the source MAC address with VN Port s MAC address symbolically VN PortMAC. The FIA encapsulates the frame in a SPBM frame i.e. adds a MAC in MAC header and other SPB fields. The outer destination Ethernet MAC address contains the value of the egress FIA MAC address in this case the symbolic MAC address FIAMAC . The outer source Ethernet MAC address contains the value of the current FIA MAC address in this case the symbolic MAC address FIAMAC. The frame is received by FIA and forwarded to the egress FIA FIA . FIA removes the outer MAC header substitutes the source MAC address with the FIAC MAC address symbolically FIACntlrMAC and forwards the frame to VN Port in ENode . The Shortest Path Bridging network can be adapted to use Shortest Path Bridging VLAN SPBV in lieu of SPBM by using the Shortest Path VLAN ID SPVID to designate nodal reachability.

The foregoing systems methods and apparatus may be widely applied to various applications. Without narrowing the generality of the foregoing they may be fully applicable to Software Defined Storage Networks.

Although the foregoing invention has been described in some detail by way of illustration and example for purposes of clarity and understanding it may be readily apparent to those of ordinary skill in the art in light of the teachings of this invention that certain changes and modifications may be made thereto without departing from the spirit or scope of the appended claims.

All publications and patents cited in this specification are herein incorporated by reference as if each individual publication or patent were specifically and individually indicated to be incorporated by reference in their entirety.

