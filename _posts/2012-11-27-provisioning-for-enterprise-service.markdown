---

title: Provisioning for enterprise service
abstract: Identifying an incoming call as from a mobile device of an enterprise communication system. Creating a first list relating mobile devices of the enterprise communication system with Public Land Mobile Network (PLMN) number of the device. Creating a hashmap comprising keys. Each key comprising the last n digits assigned as a PLMN number to at least one mobile device of the enterprise communication system. The hashmap further comprising a plurality of buckets. Each bucket corresponding to a key, and comprising a second list identifying each enterprise-associated mobile device having a PLMN number ending with the key. Receiving an Automatic Number Identification (ANI) number of an call incoming to the enterprise communication system. Retrieving at least one bucket corresponding to a key comprising the last n digits of the ANI number. Searching the retrieved bucket for the unique identifier associated with the full PLMN number.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08533325&OS=08533325&RS=08533325
owner: BlackBerry Limited
number: 08533325
owner_city: Waterloo
owner_country: CA
publication_date: 20121127
---
This application is a continuation application of U.S. patent application Ser. No. 12 837 681 filed on Jul. 16 2010 now U.S. Pat. No. 8 370 484 which claims the benefit of U.S. Provisional Application No. 61 328 543 filed on Apr. 27 2010 each of said applications are expressly incorporated by reference herein in their entirety.

The technology disclosed herein the technology relates to communication system configuration. Exemplary embodiments of the technology relate to determining a communications path between an enterprise associated mobile communications device and an enterprise resource.

Reference will now be made in detail to embodiments of the technology. Each example is provided by way of explanation of the technology only not as a limitation of the technology. It will be apparent to those skilled in the art that various modifications and variations can be made in the present technology without departing from the technology. For instance features described as part of one embodiment can be used on another embodiment to yield a still further embodiment. Thus it is intended that the present technology cover such modifications and variations that come within the scope of the technology.

The present application relates to the control and management of communications. Although reference may be made to calls in the description of example embodiments below it will be appreciated that the described systems and methods are applicable to session based communications in general and not limited to voice calls. It will also be appreciated that the systems and methods may not be limited to sessions and may be applicable to messaging based communications in some embodiments.

Reference is now made to which shows in block diagram form an example system generally designated for the control and management of communications. The system includes an enterprise or business system which in many embodiments includes a local area network LAN . In the description below the enterprise or business system may be referred to as an enterprise network . It will be appreciated that the enterprise network may include more than one network and may be located in multiple geographic areas in some embodiments.

The enterprise network may be connected often through a firewall to a wide area network WAN such as the Internet. The enterprise network may also be connected to a public switched telephone network PSTN via direct inward dialing DID trunks or primary rate interface PRI trunks.

The enterprise network may also communicate with a public land mobile network PLMN which may also be referred to as a wireless wide area network WWAN or in some cases a cellular network. The connection with the PLMN may be made via a relay as known in the art.

The enterprise network may also provide a wireless local area network WLAN featuring wireless access points. Other WLANs may exist outside the enterprise network . For example WLAN may be connected to WAN .

The system may include a number of enterprise associated mobile devices only one shown . The mobile devices may include devices equipped for cellular communication through the PLMN mobile devices equipped for Wi Fi communications over one of the WLANs or dual mode devices capable of both cellular and WLAN communications. WLANs may be configured in accordance with one of the IEEE 802.11 specifications.

It will be understood that the mobile devices include one or more radio transceivers and associated processing hardware and software to enable wireless communications with the PLMN and or one of the WLANs . In various embodiments the PLMN and mobile devices may be configured to operate in compliance with any one or more of a number of wireless protocols including GSM GPRS CDMA EDGE UMTS EvDO HSPA 3GPP or a variety of others. It will be appreciated that the mobile device may roam within the PLMN and across PLMNs in known manner as a user moves. In some instances the dual mode mobile devices and or the enterprise network are configured to facilitate roaming between the PLMN and a WLAN and are thus capable of seamlessly transferring sessions such as voice calls from a connection with the cellular interface of the dual mode device to the WLAN interface of the dual mode device and vice versa.

The enterprise network typically includes a number of networked servers computers and other devices. For example the enterprise network may connect one or more desktop or laptop computers one shown . The connection may be wired or wireless in some embodiments. The enterprise network may also connect to one or more digital telephone sets one shown .

The enterprise network may include one or more mail servers such as mail server for coordinating the transmission storage and receipt of electronic messages for client devices operating within the enterprise network . Typical mail servers include the Microsoft Exchange Server and the IBM Lotus Domino server. Each user within the enterprise typically has at least one user account within the enterprise network . Associated with each user account is information such as message address information such as an e mail address and enterprise telephone exchange e.g. a phone exchange that can be associated with a digital telephone set e.g. . Information on users of the enterprise network and its resources can be stored in an enterprise data store e.g. implemented with Microsoft Active Directory. Messages addressed to a user message address are stored on the enterprise network in the mail server . The messages may be retrieved by a user using a messaging application such as an e mail client application. The messaging application may be operating on a user s computer connected to the enterprise network within the enterprise. In some embodiments a user may be permitted to access stored messages using a remote computer for example at another location via the WAN using a VPN connection. Using the messaging application a user may also compose and send messages addressed to others within or outside the enterprise network . The messaging application causes the mail server to send a composed message to the addressee often via the WAN .

The relay serves to route messages received over the PLMN from the mobile device to the corresponding enterprise network . The relay also pushes messages from the enterprise network to the mobile device via the PLMN .

The enterprise network also includes an enterprise server . Together with the relay the enterprise server functions to redirect or relay incoming e mail messages addressed to a user s e mail address within the enterprise network to a user s mobile device and to relay incoming e mail messages composed and sent via the mobile device to the intended recipients within the WAN or elsewhere. The enterprise server and relay together facilitate push e mail service for the mobile device enabling the user to send and receive e mail messages using the mobile device as though the user were connected to an e mail client within the enterprise network using the user s enterprise related e mail address for example on a computer .

As is typical in many enterprises the enterprise network includes a Private Branch eXchange system although in various embodiments the PBX may be a standard PBX or an IP PBX for simplicity the description below uses the term PBX system to refer to both having a connection with the PSTN for routing incoming and outgoing voice calls for the enterprise. The PBX system is connected to the PSTN via DID trunks or PRI trunks for example. The PBX system may use ISDN signaling protocols for setting up and tearing down circuit switched connections through the PSTN and related signaling and communications. In some embodiments the PBX system may be connected to one or more conventional analog telephones . The PBX system is also connected to the enterprise network and through it to telephone terminal devices such as digital telephone sets softphones operating on computers etc. Within the enterprise each individual may have an associated extension number sometimes referred to as a PNP private numbering plan or direct dial phone number. Calls outgoing from the PBX system to the PSTN or incoming from the PSTN to the PBX system are typically circuit switched calls. Within the enterprise e.g. between the PBX system and terminal devices voice calls are often packet switched calls for example Voice over IP VoIP calls.

The enterprise network may further include a Service Management Platform SMP for performing some aspects of messaging or session control like call control and advanced call processing features. The SMP may in some cases also perform some media handling. Collectively the SMP and PBX system may be referred to as the enterprise communications platform generally designated . It will be appreciated that the enterprise communications platform and in particular the SMP is implemented on one or more servers having suitable communications interfaces for connecting to and communicating with the PBX system and in some embodiments the DID PRI trunks. Although the SMP may be implemented on a stand alone server it will be appreciated that it may be implemented into an existing control agent server as a logical software component. As will be described below the SMP may be implemented as a multi layer platform.

The enterprise communications platform implements the switching to connect session legs and may provide the conversion between for example a circuit switched call and a VoIP call or to connect legs of other media sessions. In some embodiments in the context of voice calls the enterprise communications platform provides a number of additional functions including automated attendant interactive voice response call forwarding voice mail etc. It may also implement certain usage restrictions on enterprise users such as blocking international calls or 1 900 calls. In many embodiments Session Initiation Protocol SIP may be used to set up manage and terminate media sessions for voice calls. Other protocols may also be employed by the enterprise communications platform for example Web Services Computer Telephony Integration CTI protocol Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions SIMPLE and various custom Application Programming Interfaces APIs as will be described in greater detail below.

One of the functions of the enterprise communications platform is to extend the features of enterprise telephony to the mobile devices . For example the enterprise communications platform may allow the mobile device to perform functions akin to those normally available on a standard office telephone such as the digital telephone set or analog telephone set . Example features may include direct extension dialing enterprise voice mail conferencing call transfer call park etc.

Reference is now made to which show example embodiments of the enterprise communications platform . Again although references are made below to calls or call centric features it will be appreciated that the architectures and systems depicted and described are applicable to session based communications in general and in some instances to messaging based communications.

In this embodiment the SMP assumes control over both call processing and the media itself. This architecture may be referred to as First Party Call Control . Many of the media handling functions normally implemented by the PBX system are handled by the SMP in this architecture. Incoming calls addressed to any extension or direct dial number within the enterprise for example are always first routed to the SMP . Thereafter a call leg is established from the SMP to the called party within the enterprise and the two legs are bridged. Accordingly the SMP includes a digital trunk interface and a digital signal processing DSP conferencing bridge . The DSP conferencing bridge performs the bridging of calls for implementation of various call features such as conferencing call transfer etc. The digital trunk interface may be implemented as a plurality of telephonic cards e.g. Intel Dialogic cards interconnected by a bus and operating under the control of a processor. The digital trunk interface may also be partly implemented using a processor module such as for example a Host Media Processing HMP processor.

The SMP may include various scripts for managing call processing. The scripts are implemented as software modules routines functions etc. stored in memory and executed by the processor of the SMP . The scripts may implement call flow logic business logic user preferences call service processes and various feature applications.

The call control server is coupled to the PBX system for example through the LAN enabling packet based communications and more specifically IP based communications. In one embodiment communications between the PBX system and the call control server are carried out in accordance with SIP. In other words the call control server uses SIP based communications to manage the set up tear down and control of media handled by the PBX system . In one example embodiment the call control server may employ a communications protocol conforming to the ECMA 269 or ECMA 323 standards for Computer Supported Telecommunications Applications CSTA .

The SIP server interacts with the media server using SIP based media handling commands. For example the SIP server and media server may communicate using Media Server Markup Language MSML as defined in IETF document Saleem A. Media Server Markup Language Internet Draft draft saleem msml 07 Aug. 7 2008. The media server may be configured to perform Host Media Processing HMP . Other architectures or configurations for the enterprise communications system will be appreciated by those ordinarily skilled in the art.

Reference is now made to and which show another embodiment of the enterprise communications system with a Third Party Call Control architecture. In this embodiment the SMP is a multi layer platform that includes a protocol layer a services layer and an application layer . The protocol layer includes a plurality of interface protocols configured for enabling operation of corresponding applications in the application layer . The services layer includes a plurality of services that can be leveraged by the interface protocols to create richer applications. Finally the application layer includes a plurality of applications that are exposed to the communication devices and that leverage services and interface protocols for enabling the applications.

Specifically the protocol layer can include protocols which allow media to be controlled separate from data. For example the protocol layer can include among other things a Session Initiation Protocol or SIP a Web Services protocol an Application Programming Interface or API a Computer Telephony Integration protocol or CTI and a Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions or SIMPLE protocol . It is contemplated that the interface protocols are plug ins that can interface directly with corresponding servers in the enterprise network which will be further described below.

For the purposes of this disclosure SIP will be utilized although it is appreciated that the system can operate using the above disclosed or additional protocols. As known by those of ordinary skill in the art SIP is the IETF Internet Engineering Task Force standard for multimedia session management and more specifically is an application layer control protocol for establishing maintaining modifying and terminating multimedia sessions between two or more endpoints. As further known by those of ordinary skill in the art the SIP protocol includes two interfaces for signaling SIP Trunk hereinafter referred to as SIP T and SIP Line hereinafter referred to as SIP L . Specifically the SIP T interface is utilized when the endpoint is a non specific entity or not registered i.e. when communicating between two network entities . In contrast the SIP L interface is utilized when the endpoint is registered i.e. when dialing to a specific extension . The specific operation of the system utilizing SIP will be described in further detail below.

The SMP also includes a plurality of enablers among other things a VoIP enabler a Fixed Mobile Convergence or FMC enabler a conference services enabler a presence enabler and an Instant Messaging or IM enabler . Each of the enablers are used by corresponding services in the services layer that combine one or more of the enablers. Each of the applications in the application layer is then combined with one or more of the services to perform the desired application. For example a phone call service may use the VoIP or PBX enabler and an emergency response application may use the phone call service an Instant Messenger service a video call service and email service or a conference service or combinations thereof.

The application layer may include a conference services application that together with the conference services enabler enables multiple communication devices including desk telephones and personal computers to participate in a conference call through use of a centralized conference server . As seen in and the conference server is provided in the enterprise network and is in communication with the conference services enabler preferably through the SIP protocol although it is recognized that additional protocols that control media separate from data may be appropriate such as the Web Services protocol or the CTI protocol . The conference call server is configured for directing media and data streams to and from one or more communication devices i.e. mobile devices telephones and computers .

Automatic Number Identification ANI is a feature of telephony intelligent network services that permits subscribers to display or capture the billing telephone number of a calling party. In the United States it is part of Inward Wide Area Telephone Service WATS . The ANI service was created for long distance billing purposes. ANI has two components information digits which identify the class of service and the calling party billing telephone number. As applicable to the present disclosure the calling party billing telephone number can be a PLMN Number. ANI formats both format length and information digit meaning and specific uses of ANI like information vary from country to country.

Enterprise resources e.g. the SMP often need to associate an incoming call with an enterprise user e.g. to extend enterprise telephony services to a user s enterprise associated mobile device e.g. . Systems of the present disclosure use ANI specifically the PLMN number portion to associate incoming calls with an enterprise user.

It is not uncommon for enterprise users to use enterprise associated mobile devices in more than the country where the enterprise network resources are located therefore the meaning of an ANI number or ANI like number is not guaranteed to be distinguishable from the ANI number alone. When an enterprise associated device is in roaming mode e.g. while in a foreign country the foreign PLMN carrier may prefix additional numbers to the PLMN Number which itself may vary in number of digits from country to country to form the ANI number for that device on the foreign PLMN carrier s network.

A hash table or hash map is a data structure that uses a hash function to map identifiers or keys e.g. an enterprise user telephone number to associated values e.g. an enterprise user ID . The hash function is used to transform the key into the index the hash of an array element the slot or bucket where the corresponding value is stored. Ideally the hash function should map each possible key to a different slot index but this ideal is rarely achievable in practice unless the hash keys are fixed i.e. new entries are never added to the table after creation . Typical hash table designs assume that hash collisions pairs of different keys with the same hash values are normal occurrences and must be accommodated in some way. In a well dimensioned hash table the average cost number of instructions for each lookup is relatively independent of the number of elements stored in the table. Some hash table designs allow arbitrary insertions and deletions of key value pairs at constant average cost per operation. In many situations hash tables turn out to be more efficient than search trees or any other table lookup structure. In part for this reason they are used in systems of the present disclosure to related a PLMN number of an enterprise associated mobile device to an enterprise user ID.

One approach to ANI PLMN number matching is to directly compare the ANI number received from the PSTN with the PLNM numbers maintained in the enterprise network for all enterprise users. Since a single SMP can support up to 10 000 enterprise users the time to find a match can be long. The best case is that the match happens for the first enterprise user supported by the SMP . The worst case is that the match is found on the 10 000user or not found at all after comparing the ANI number to the PLMN number of all 10 000 users. The enterprise does not store the PLMN number and User ID in a hash map where the PLNM number is the key and the enterprise User ID is the value. One reason is that the ANI number typically contains information digits in addition to the PLMN number and when the mobile device is roaming it is not apparent from the ANI itself which digits are PLMN number digits and which are ANI information digits. The PLMN carrier adds digits to the beginning of the PLMN number to form the ANI number for billing purposes. In this case the enterprise system has to use a pattern match for each PLMN number in the enterprise database one by one or a linear search. It is disadvantageous for the enterprise system to store the PLMN number in a hashmap pair as hashmap because the hashmap does not provide an efficient pattern match capability. For a 10 000 user enterprise system the worst case scenario is long because enterprise system needs to do a linear pattern match for 10 000 mobile numbers.

Embodiments of the present technology provide a matching of a portion of the ANI number against PLMN number and eventually user ID for enterprise system users.

Embodiments of the technology store the last n digits of PLNM number in a hash map with enterprise user IDs. Any entry in this hashmap can correspond to multiple enterprise users sharing the same last n digits of their PLMN number. One hashmap that can be used is hashmap pair where the linklist stores all those enterprise user IDs having identical PLNM number last n digits. In many embodiments n 6 is a good choice if enterprise users are not expected to use enterprise associated mobile devices in countries with less than six 6 digits in the PLMN number.

For example User has PLMN number 519 555 1234 and user has PLMN number 647 855 1234. These two users have identical last six digits in their PLMN number. Therefore one entry in the hashmap would be .

In some embodiments such hashmaps can be created for various n thereby allowing various configurations of the technology responsive to the population of PLMN number formats of the enterprise users. In some embodiments n is the lowest number of digits used by a PLMN of an enterprise user. For example if an enterprise has one hundred 100 users with fifty 50 being in the U.S. and having 10 digit PLMN numbers e.g. 555 123 4567 forty nine 49 users being in country A that uses a 9 digit PLMN number format and one user being in country B that uses a 6 digit PLMN then an n 6 hashmap can be employed. It also can be desirable to create an n 9 digit hashmap in anticipation of the single country B user either leaving the enterprise or changing phone numbers. Further it is desirable for the number n to be selected e.g. by a system administrator to be compatible with the PLMN number format of the country using the lowest number of PLMN number digits from among all the such countries.

When the enterprise system e.g. the SMP via the PBX retrieves an ANI number from an incoming call e.g. 8191 519 555 1234 the enterprise system will determine the last six digits of the ANI e.g. 55 1234 .

The technology uses this partial ANI to search at the hash map. If found the result is an entry where the key is the last n digits of the PLMN number 551234 and the value is a linklist which contains all the User IDs for users who have identical last n digits of the PLMN number.

Next the technology determined the user ID associated with the incoming call by comparing the full ANI number with each entry in the linked list. Since the size of linked list of a particular last n digits of the PLMN number is small then the comparison is relatively short.

Referring to methods of the technology are illustrated. In such methods the technology creates a first list relating each of a plurality of mobile devices of the enterprise communication system with at least one PLMN number of the enterprise associated mobile communication devices. The technology also creates a hashmap . The hashmap includes keys comprising the last n digits assigned as a part of a PLMN number to at least one mobile device of the enterprise communication system and corresponding buckets comprising a second list identifying each enterprise associated mobile device having a PLMN number ending with the key. Upon receiving an Automatic Number Identification ANI number of an call incoming to the enterprise communication system the technology retrieves at least one bucket corresponding to a key comprising the last n digits of the ANI number. The technology then searches the retrieved bucket for the unique identifier associated with the full PLMN number.

The present technology can take the forms of hardware software or both hardware and software elements. In some embodiments the technology is implemented in software which includes but is not limited to firmware resident software microcode a Field Programmable Gate Array FPGA or Application Specific Integrated Circuit ASIC etc. In particular for real time or near real time use an FPGA or ASIC implementation is desirable.

Furthermore the present technology can take the form of a computer program product comprising program modules accessible from computer usable or computer readable medium storing program code for use by or in connection with one or more computers processors or instruction execution system. For the purposes of this description a computer usable or computer readable medium can be any apparatus that can contain store communicate propagate or transport the program for use by or in connection with the instruction execution system apparatus or device. The medium can be an electronic magnetic optical electromagnetic infrared or semiconductor system or apparatus or device or a propagation medium though propagation mediums in and of themselves as signal carriers are not included in the definition of physical computer readable medium . Examples of a physical computer readable medium include a semiconductor or solid state memory magnetic tape a removable computer diskette a random access memory RAM a read only memory ROM a rigid magnetic disk and an optical disk. Current examples of optical disks include compact disk read only memory CD ROM compact disk read write CD R W and DVD. Both processors and program code for implementing each as aspect of the technology can be centralized or distributed or a combination thereof .

A data processing system suitable for storing a computer program product of the present technology and for executing the program code of the computer program product will include at least one processor coupled directly or indirectly to memory elements through a system bus. The memory elements can include local memory employed during actual execution of the program code bulk storage and cache memories that provide temporary storage of at least some program code in order to reduce the number of times code must be retrieved from bulk storage during execution. Input output or I O devices including but not limited to keyboards displays pointing devices etc. can be coupled to the system either directly or through intervening I O controllers. Network adapters can also be coupled to the system to enable the data processing system to become coupled to other data processing systems or remote printers or storage devices through intervening private or public networks. Modems cable modem and Ethernet cards are just a few of the currently available types of network adapters. Such systems can be centralized or distributed e.g. in peer to peer and client server configurations. In some embodiments the data processing system is implemented using one or both of FPGAs and ASICs.

