---

title: System and method for reducing call latency in monitored calls
abstract: A service management platform for processing packet switched communications is provided. The service management platform has a component for handling voice calls. The component for handling voice calls comprises a first input/output for sending and receiving data packets associated with a first leg of a call, a second input/output for sending and receiving data packets associated with a second leg of the call, a monitoring component for monitoring copies of the data packets for commands contained within a payload of the data packets, and a relay component for directly relaying the data packets between the first input/output and the second input/output and for generating and forwarding copies of the data packets to the monitoring component.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08688030&OS=08688030&RS=08688030
owner: BlackBerry Limited
number: 08688030
owner_city: Waterloo, Ontario
owner_country: CA
publication_date: 20121220
---
The present application relates generally to telecommunications and more specifically to a system and method for reducing call latency in monitored calls.

The monitoring of telephone calls for commands such as voice commands or DTMF commands in packet switched networks requires that the packets being transmitted be collected in a buffer decompressed decoded processed by the monitoring equipment encoded recompressed and retransmitted in the direction of the receiving equipment. Such multiple compressions decompressions is referred to as tromboning or hairpinning and increases the latency of voice heard at the receiving end of the call which results in increased delays when having a voice conversation over such a network.

It would be desirable to monitor telephone calls in a packet switched network in a way that does not suffer from these disadvantages.

In one aspect the present application provides a service management platform for processing packet switched communications. The service management platform has a component for handling voice calls. The component for handling voice calls comprises a first input output for sending and receiving data packets associated with a first leg of a call a second input output for sending and receiving data packets associated with a second leg of the call a monitoring component for monitoring copies of the data packets for commands contained within a payload of the data packets and a relay component for directly relaying the data packets between the first input output and the second input output and for generating and forwarding copies of the data packets to the monitoring component.

In another aspect the present application provides a method for processing commands in a service management platform of a packet switched network. The method comprises receiving data packets from a first leg of a call sending a first copy of the received data packets directly to a second leg of the call sending a second copy of the received data packets to a monitoring component for monitoring the data packets for commands contained within the data packets and detecting commands contained within a payload of the data packets and responding to the detected commands.

Other aspects of the present application will be apparent to those of ordinary skill in the art from a review of the following detailed description in conjunction with the drawings.

Embodiments of the present application are not limited to any particular operating system mobile device architecture server architecture or computer programming language.

The present application relates to the control and management of communications. Although reference may be made to calls in the description of example embodiments below it will be appreciated that the described systems and methods are applicable to session based communications in general and not limited to voice calls. It will also be appreciated that the systems and methods may not be limited to sessions and may be applicable to messaging based communications in some embodiments.

Reference is now made to which shows in block diagram form an example system generally designated for the control and management of communications. The system includes an enterprise or business system which in many embodiments includes a local area network LAN . In the description below the enterprise or business system may be referred to as an enterprise network . It will be appreciated that the enterprise network may include more than one network and may be located in multiple geographic areas in some embodiments.

The enterprise network may be connected often through a firewall to a wide area network WAN such as the Internet. The enterprise network may also be connected to a public switched telephone network PSTN via direct inward dialing DID trunks or primary rate interface PRI trunks.

The enterprise network may also communicate with a public land mobile network PLMN which may also be referred to as a wireless wide area network WWAN or in some cases a cellular network. The connection with the PLMN may be made via a relay as known in the art.

The enterprise network may also provide a wireless local area network WLAN featuring wireless access points. Other WLANs may exist outside the enterprise network . For example WLAN may be connected to WAN .

The system may include a number of enterprise associated mobile devices only one shown . The mobile devices may include devices equipped for cellular communication through the PLMN mobile devices equipped for Wi Fi communications over one of the WLANs or dual mode devices capable of both cellular and WLAN communications. WLANs may be configured in accordance with one of the IEEE 802.11 specifications.

It will be understood that the mobile devices include one or more radio transceivers and associated processing hardware and software to enable wireless communications with the PLMN and or one of the WLANs . In various embodiments the PLMN and mobile devices may be configured to operate in compliance with any one or more of a number of wireless protocols including GSM GPRS CDMA EDGE UMTS EvDO HSPA 3GPP or a variety of others. It will be appreciated that the mobile device may roam within the PLMN and across PLMNs in known manner as the user moves. In some instances the dual mode mobile devices and or the enterprise network are configured to facilitate roaming between the PLMN and a WLAN and are thus capable of seamlessly transferring sessions such as voice calls from a connection with the cellular interface of the dual mode device to the WLAN interface of the dual mode device and vice versa.

The enterprise network typically includes a number of networked servers computers and other devices. For example the enterprise network may connect one or more desktop or laptop computers one shown . The connection may be wired or wireless in some embodiments. The enterprise network may also connect to one or more digital telephone sets one shown .

The enterprise network may include one or more mail servers such as mail server for coordinating the transmission storage and receipt of electronic messages for client devices operating within the enterprise network . Typical mail servers include the Microsoft Exchange Server and the IBM Lotus Domino server. Each user within the enterprise typically has at least one user account within the enterprise network . Associated with each user account is message address information such as an e mail address. Messages addressed to a user message address are stored on the enterprise network in the mail server . The messages may be retrieved by the user using a messaging application such as an e mail client application. The messaging application may be operating on a user s computer connected to the enterprise network within the enterprise. In some embodiments the user may be permitted to access stored messages using a remote computer for example at another location via the WAN using a VPN connection. Using the messaging application the user may also compose and send messages addressed to others within or outside the enterprise network . The messaging application causes the mail server to send a composed message to the addressee often via the WAN .

The relay serves to route messages received over the PLMN from the mobile device to the corresponding enterprise network . The relay also pushes messages from the enterprise network to the mobile device via the PLMN .

The enterprise network also includes an enterprise server . Together with the relay the enterprise server functions to redirect or relay incoming e mail messages addressed to a user s e mail address within the enterprise network to the user s mobile device and to relay incoming e mail messages composed and sent via the mobile device out to the intended recipients within the WAN or elsewhere. The enterprise server and relay together facilitate push e mail service for the mobile device enabling the user to send and receive e mail messages using the mobile device as though the user were connected to an e mail client within the enterprise network using the user s enterprise related e mail address for example on computer .

As is typical in many enterprises the enterprise network includes a Private Branch eXchange although in various embodiments the PBX may be a standard PBX or an IP PBX for simplicity the description below uses the term PBX to refer to both having a connection with the PSTN for routing incoming and outgoing voice calls for the enterprise. The PBX is connected to the PSTN via DID trunks or PRI trunks for example. The PBX may use ISDN signaling protocols for setting up and tearing down circuit switched connections through the PSTN and related signaling and communications. In some embodiments the PBX may be connected to one or more conventional analog telephones . The PBX is also connected to the enterprise network and through it to telephone terminal devices such as digital telephone sets softphones operating on computers etc. Within the enterprise each individual may have an associated extension number sometimes referred to as a PNP private numbering plan or direct dial phone number. Calls outgoing from the PBX to the PSTN or incoming from the PSTN to the PBX are typically circuit switched calls. Within the enterprise e.g. between the PBX and terminal devices voice calls are often packet switched calls for example Voice over IP VoIP calls.

The enterprise network may further include a Service Management Platform SMP for performing some aspects of messaging or session control like call control and advanced call processing features. The SMP may in some cases also perform some media handling. Further yet the SMP may have a media processing unit and or communication enterprise server that may be responsible for call monitoring such as interactive voice response IVR which is described in more detail below. Collectively the SMP and PBX may be referred to as the enterprise communications platform generally designated . It will be appreciated that the enterprise communications platform and in particular the SMP is implemented on one or more servers having suitable communications interfaces for connecting to and communicating with the PBX and or DID PRI trunks. Although the SMP may be implemented on a stand alone server it will be appreciated that it may be implemented into an existing control agent server as a logical software component. As will be described below the SMP may be implemented as a multi layer platform.

The enterprise communications platform implements the switching to connect session legs and may provide the conversion between for example a circuit switched call and a VoIP call or to connect legs of other media sessions. In some embodiments in the context of voice calls the enterprise communications platform provides a number of additional functions including automated attendant interactive voice response IVR call forwarding voice mail etc. It may also implement certain usage restrictions on enterprise users such as blocking international calls or 1 900 calls. In many embodiments Session Initiation Protocol SIP may be used to set up manage and terminate media sessions for voice calls. Other protocols may also be employed by the enterprise communications platform for example Web Services Computer Telephony Integration CTI protocol Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions SIMPLE and various custom Application Programming Interfaces APIs as will be described in greater detail below.

One of the functions of the enterprise communications platform is to extend the features of enterprise telephony to the mobile devices . For example the enterprise communications platform may allow the mobile device to perform functions akin to those normally available on a standard office telephone such as the digital telephone set or analog telephone set . Example features may include direct extension dialing enterprise voice mail conferencing call transfer call park etc.

Reference is now made to which show example embodiments of the enterprise communications system . Again although references are made below to calls or call centric features it will be appreciated that the architectures and systems depicted and described are applicable to session based communications in general and in some instances to messaging based communications.

In this embodiment the SMP assumes control over both call processing and the media itself. This architecture may be referred to as First Party Call Control . Many of the media handling functions normally implemented by the PBX are handled by the SMP in this architecture. Incoming calls addressed to any extension or direct dial number within the enterprise for example are always first routed to the SMP . Thereafter a call leg is established from the SMP to the called party within the enterprise and the two legs are bridged. Accordingly the SMP includes a digital trunk interface and a digital signal processing DSP conferencing bridge . The DSP conferencing bridge performs the bridging of calls for implementation of various call features such as conferencing call transfer etc. The digital trunk interface may be implemented as a plurality of telephonic cards e.g. Intel Dialogic cards interconnected by a bus and operating under the control of a processor. The digital trunk interface may also be partly implemented using a processor module such as for example a Host Media Processing HMP processor.

The SMP may include various scripts for managing call processing. The scripts are implemented as software modules routines functions etc. stored in non volatile memory and executed by the processor of the SMP . The scripts may implement call flow logic business logic user preferences call service processes and various feature applications.

The call control server is coupled to the PBX for example through the LAN enabling packet based communications and more specifically IP based communications. In one embodiment communications between the PBX and the call control server are carried out in accordance with SIP. In other words the call control server uses SIP based communications to manage the set up tear down and control of media handled by the PBX . In one example embodiment the call control server may employ a communications protocol conforming to the ECMA 269 or ECMA 323 standards for Computer Supported Telecommunications Applications CSTA .

The SIP server interacts with the media server using SIP based media handling commands. For example the SIP server and media server may communicate using Media Server Markup Language MSML as defined in IETF document Saleem A. Media Server Markup Language Internet Draft draft saleem msml 07 Aug. 7 2008. The media server may be configured to perform Host Media Processing HMP .

Other architectures or configurations for the enterprise communications system will be appreciated by those ordinarily skilled in the art.

Reference is now made to collectively referred to as which shows another embodiment of the enterprise communications system with a Third Party Call Control architecture. In this embodiment the SMP is a multi layer platform that includes a protocol layer a services layer and an application layer . The protocol layer includes a plurality of interface protocols configured for enabling operation of corresponding applications in the application layer . The services layer includes a plurality of services that can be leveraged by the interface protocols to create richer applications. Finally the application layer includes a plurality of applications that are exposed out to the communication devices and that leverage corresponding ones of the services and interface protocols for enabling the applications.

Specifically the protocol layer may implement protocols which allow media to be controlled separate from data. For example the protocol layer can include among other things a Session Initiation Protocol or SIP a Web Services protocol an Application Programming Interface or API a Computer Telephony Integration protocol or CTI and a Session Initiation Protocol for Instant Messaging and Presence Leveraging Extensions or SIMPLE protocol . It is contemplated that the interface protocols are plug ins that can interface directly with corresponding servers in the enterprise network which will be further described below.

For the purposes of this disclosure SIP will be utilized although it is appreciated that the system can operate using the above disclosed or additional protocols. As known by those of ordinary skill in the art SIP is the IETF Internet Engineering Task Force standard for multimedia session management and more specifically is an application layer control protocol for establishing maintaining modifying and terminating multimedia sessions between two or more endpoints. As further known by those of ordinary skill in the art the SIP protocol includes two interfaces for signaling SIP Trunk hereinafter referred to as SIP T and SIP Line hereinafter referred to as SIP L . Specifically the SIP T interface is utilized when the endpoint is a non specific entity or not registered i.e. when communicating between two network entities . In contrast the SIP L interface is utilized when the endpoint is registered i.e. when dialing to a specific extension . The specific operation of the system utilizing SIP will be described in further detail below.

In the embodiment shown in the SMP also includes a plurality of enablers among other things a VoIP enabler a Fixed Mobile Convergence or FMC enabler a conference services enabler a presence enabler and an Instant Messaging or IM enabler . Each of the enablers are used by corresponding services in the services layer that combine one or more of the enablers. Each of the applications in the application layer may be combined with one or more of the services to perform the desired application. For example a phone call service may use the VoIP or PBX enabler and an emergency response application may use the phone call service an Instant Messenger service a video call service and email service and or a conference service.

The application layer may include a conference services application that together with the conference services enabler enables multiple communication devices including desk telephones and personal computers to participate in a conference call through use of a centralized conference server . As seen in the conference server may be provided in the enterprise network and is in communication with the conference services enabler preferably through the SIP protocol although it is recognized that additional protocols that control media separate from data may be appropriate such as the Web Services protocol or the CTI protocol . As will be described in further detail below the conference call server is configured for directing media and data streams to and from one or more communication devices i.e. mobile devices telephones and computers .

Referring now to a block diagram is shown illustrating details of an embodiment of an enterprise communications platform for reducing call latency in accordance with the disclosure. For the purposes of this example a simplified enterprise communications platform is shown. While many of the components of the enterprise communications platform are not shown in it will be understood by those skilled in the art that the components shown in are suitably employed by the platform .

Typically the voice traffic traveling through the platform or the platform is in the form of packet switched data transmission such as voice over IP VOIP with the exception of the PSTN which is may be largely composed of a circuit switched network. Since the media processing unit monitors for commands found within the voice stream e.g. 4 khz and below or within the data packet payload where transmission is in the form of packet switched data transmission the conventional approach to implement this monitoring includes collecting and decoding the packet switched data transmissions at the communication enterprise server to reconstruct the original voice band signal. For example bidirectional or full duplex communications take place between phone and service management platform illustrated by arrow and bidirectional or full duplex communications take place between phone and service management platform illustrated by arrow . The service management platform may have a first input and or output for sending and or receiving data packets associated with a first leg of a call which may be represented by the arrow . The service management platform may further have a second input and or output for sending and or receiving data packets associated with a second leg of a call which may be represented by the arrow .

In the conventional approach link does not exist and is not used. In the collection decoding and construction process components known to those skilled in the art of VOIP are employed such as a jitter buffer that is used to collect and reassemble the data packets in the appropriate order before the decoding and or decompression is performed to reconstruct the original voice signal which can then be processed for detection of voice commands or DTMF commands at the media processing unit . As such in the conventional approach arrows and represent bidirectional full duplex communications. Data communications arriving from phone via link are collected in a jitter buffer of the CES arranged into proper order decoded and or decompressed and provided to the media processing unit for command detection. Thereafter the data communications are re encoded and or compressed and the regenerated data packets are sent along to phone via links and .

The same process happens in reverse where data communications arriving from phone via link are collected in a jitter buffer of the CES arranged into proper order decoded and or decompressed and provided to the media processing unit for command detection. Thereafter the data communications are re encoded and or compressed and the regenerated data packets are sent along to phone via links and . Additional decompression and or decoding and subsequent recompression and or re encoding may occur elsewhere in the system along the transmission path of packet switched communications and this repetitive decompression and or decoding and subsequent recompression and or re encoding is referred to as tromboning or hairpinning. Particularly where jitter buffers are employed such as in CES and or the media processing unit this tromboning causes added latency to the voice signal which is undesirable.

In accordance with one example of the present disclosure the CES may have a component for directly relaying data packets between the input output and the input output generally designated by reference . The component may have switches and and a link represented by arrow where the CES employs interactive voice response or DTMF command detection. In one example the link is a full duplex or bidirectional link and links and are implemented as half duplex or unidirectional links. Switches and may be implemented as real time transport protocol RTP switches that implement RTP proxy by passing the RTP packets to the destination without any analysis of the packets. Alternatively TDM proxying may also be employed.

According to the present example data packets arriving from phone via link are directly switched or directed by switch towards switch over link . The data communications arriving from phone are also simultaneously directed towards MPU over link which is now implemented as a unidirectional or half duplex link. This process may occur in a number of ways. The switch may be a regenerative switch or repeater that sends one copy of the data packet over link and a second copy of the data packet over link while dispensing with the original data packet. Alternatively the switch may pass the original data packet on through link and send a copy of the data packet through link . The data packets arriving from phone are collected in a jitter buffer of the CES arranged into proper order decoded and or decompressed and provided to the media processing unit as communications for command detection. The MPU may discard the communications after processing the communications for IVR or DTMF commands e.g. commands that would have been found in the data payload of the data packets and taking any appropriate action in response to any commands because the same communications were also directly sent to phone using switch link switch and link . Using this approach data packets arriving at the phone from the phone have been monitored by MPU for IVR or DTMF commands but have not been decoded and or decompressed and recoded and or recompressed by the CES and or media processing unit along the journey from the phone to the phone which eliminates any added latency by for example the jitter buffer s of the CES .

The same process may occur in reverse. For example data communications arriving from phone via link are directly switched or directed by switch towards switch over link . Data packets arriving from phone are also simultaneously directed towards MPU over link which is now implemented as a unidirectional or half duplex link. Again this process may occur in a number of ways. The switch may be a regenerative switch or repeater that sends one copy of the data packet over link and a second copy of the data packet over link while dispensing with the original data packet. Alternatively the switch may pass the original data packet on through link and send a copy of the data packet through link . The data packets arriving from phone are still collected in a jitter buffer of the CES arranged into proper order decoded and or decompressed and provided to the media processing unit as communications for command detection. However the MPU discards the communications after processing the communications for IVR or DTMF commands and taking any appropriate action in response to any commands because the same communications were also sent directly to phone using switch link switch and link . Using this approach data packets arriving at the phone from the phone have still been monitored by MPU for IVR or DTMF commands but have not been decoded and or decompressed and recoded and or recompressed by the CES on the journey from the phone to the phone which eliminates any added latency by for example the jitter buffer s of the CES .

While in some embodiments some phone devices such as digital phone or mobile device may provide commands such as conference calling or call control commands over a separate data channel making DTMF or IVR command detection in the baseband voice band signal unnecessary the system described in connection with is particularly beneficial when for example data channels are unavailable to the device and or the digital phone or when an analog phone such as the phone or phones connected to the PSTN are involved in a call or conference.

In some embodiments the switches and and the link may be implemented as physical switches and links in a network. In one alternative the switches and may be replaced by a single switch in the link that sends one copy of all traffic traversing the bidirectional link to the MPU . In other embodiments the service management platform and consequently the switches and and the link are implemented using programmed instructions where the CES and or the MPU may be implemented as a server or servers in the networks or . The programmed instructions may be embodied in the one or more software modules resident in a memory of the server. Alternatively the programmed instructions may be tangibly embodied on a computer readable medium such as a DVD CD floppy disk or other storage media which may be used for transporting the programmed instructions to the memory the server. Alternatively the programmed instructions may be embedded in a computer readable signal bearing medium that is uploaded to a server of the network by a vendor or supplier of the programmed instructions and this signal bearing medium may be downloaded through one or more of the interfaces of the server through a network.

In the description above the term link is intended to include a physical electrical cable a fiber optic connection a wireless connection or any other suitable connection for conveying an optical electronic or electromagnetic signal. As is understood by those skilled in the art the terms half duplex and unidirectional refer to a signal that is being sent in one direction with no corresponding return signal and the terms full duplex and bidirectional refer to a corresponding signals being sent in both directions.

Referring to a method is shown in flowchart form for reducing call latency in an enterprise communications platform in accordance with one embodiment. The method may also be referred to as a method for processing commands in an enterprise communications platform. The method is in one example implemented by the Communication Enterprise Server shown in .

At a first block a data packet is received for a packet switched voice call from a first leg of a call which may also be referred to as an inbound call. For example a data packet may be received by the CES from the phone over the link .

At a second block a first copy of the data packet is sent directly to a second leg of the call which may be referred to as the outbound call. For example a first copy of the data packet may be directed by switch to switch over link which then directs the packet to phone over connection where connection comprises at least a part of the second leg of the call. In one example this may be accomplished using a real time transport protocol RTP proxy by passing the packets e.g. RTP packets to the destination without any analysis of the packets. Alternatively TDM proxying may also be employed.

At a third block a second copy of the packet is passed to a monitoring component for monitoring the data packets for commands for example to the MPU for buffering decoding and or decompression and command detection of any IVR or DTMF commands that may be found in baseband voice signal. Alternatively any portion of the buffering decoding and or decompression may be performed by the CES and the remaining processing and or detection may be performed by the MPU . It will be understood that depending on the particular configuration chosen according to the needs of a particular application one of the first copy and second copy may be the original received data packet and only one copy of each data packet may be generated.

At a fourth block the MPU detects any commands found in the payload of the packet s and responds accordingly. Response may be coordinated with the aid of the CES and or the service management platform depending on the particular response needed based on the detected command. For example a command may be detected to add an additional caller to a conference call in progress which may involve several components of the system working together. Other examples include detecting a command to delete a member from a voice conference and deleting the member from the voice conference detecting a command to initiate a voice conference and initiating the voice conference detecting a command to terminate a voice conference and terminating the voice conference detecting a command to place a call on hold and placing the call on hold and detecting a command to take a call off hold and taking the call off hold.

While the method has been described with reference to an inbound call and an outbound call the same method is typically operative in a complementary fashion for data packets arriving from the outbound call and destined for the inbound call.

Certain adaptations and modifications of the described embodiments can be made. Therefore the above discussed embodiments are considered to be illustrative and not restrictive.

