---

title: Fast startup hybrid memory module
abstract: A memory device is provided comprising: a volatile memory device, a non-volatile memory device, a memory control circuit volatile memory controller coupled to the volatile memory device and non-volatile memory device, and a backup power source. The backup power source may be arranged to temporarily power the volatile memory devices and the memory control circuit upon a loss of power from the external power source. Additionally, a switch may serve to selectively couple: (a) a host memory bus to either the volatile memory device or non-volatile memory device; and (b) the volatile memory device to the non-volatile memory device. Upon reestablishment of power by an external power source from a power loss event, the memory control circuit is configured to restore data from the non-volatile memory device to the volatile memory device prior to a host system, to which the memory device is coupled, completes boot-up.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09019792&OS=09019792&RS=09019792
owner: Sanmina-SCI Corporation
number: 09019792
owner_city: San Jose
owner_country: US
publication_date: 20121113
---
The present Application for Patent is a divisional of and claims priority to U.S. Utility patent application Ser. No. 12 500471 filed Jul. 9 2009 which claims priority on Provisional Application No. 61 079 594 entitled Battery Less RAID DIMM filed Jul. 10 2008 assigned to the assignee hereof and hereby expressly incorporated by reference herein.

At least one feature relates to memory devices and more particularly to memory modules having integrated battery less backup function.

Some mission critical servers and storage systems employ Redundant Array of Inexpensive Drives RAID disk controllers for fault tolerance to reduce the likelihood of data loss in the event of a hardware fault. To improve performance many RAID controllers use a RAID cache. A RAID cache provides temporary storage for data transfers between host and disk subsystems. Typically such RAID cache is implemented with a dynamic random access memory DRAM based dual in line memory modules DIMM e.g. 256 MB 4 GB capacity . RAID cache data loss can occur in the event of a power failure. The cache often will momentarily contain the only copy of a piece of write data until that data can be written to the disk If power is lost before data is written to the disk the data is gone forever. To avoid data loss on power fail some prior art RAID cache DIMM s are backed up by batteries. When the system power fails the battery kicks in to supply power to the DIMM thus sustaining the data until power can be restored. Once power is restored the dirty data in the cache is flushed to disk.

However such use of batteries to provide backup power to the RAID cache DIMM s means that the batteries may need to be replaced regularly which is inconvenient and hinders the availability of the RAID DIMM. Consequently a way is needed to provide backup to the cache and or memory DIMM s that does not rely on batteries.

A memory module is provided comprising a substrate volatile memory non volatile memory and a logic device. The substrate may include an interface to a host system. One or more volatile memory devices may be mounted on the substrate. One or more non volatile memory devices may be mounted on the substrate. The logic device may be coupled to the one or more volatile memory devices the one or more non volatile memory devices and the interface. The logic device may be configured to a receive a first indicator of a first external triggering event and or b copy data from the one or more volatile memory devices to the one or more non volatile memory devices upon receipt of the first indicator. The first external triggering event may be one of an external power failure a hardware signal or a system host command.

The memory module may also comprise a voltage detector that monitors the voltage of an external power source and generates the first indicator of the first external triggering event if the voltage level of the external power source falls below a threshold level. The voltage detector clears the first indicator of the first external triggering event if voltage of the external power source is above the threshold level.

In one example the logic device may be further configured to a electrically decouple the host system from the one or more volatile memory devices after receiving the first indicator of the first external triggering event and or b electrically couple the one or more volatile memory devices to the one or more non volatile memory devices prior to copying the data.

In another example the logic device may be further configured to a receive a second indicator of a second external triggering event b restore the data from the one or more non volatile memory devices to the one or more volatile memory devices based on receipt of the second indicator c electrically decouple the one or more non volatile memory devices from the one or more volatile memory devices after restoring the data and or d electrically couple the one or more volatile memory devices to the host system after restoring the data. Note that the second indicator may be indicative that the first indicator has been cleared. In some implementations the second indicator may be received via a different interface than the first indicator or the second external triggering event may be independent of the first external triggering event.

The memory module may further comprise a passive backup power source that is charged by the external power source the passive backup power source temporarily providing power to the memory module if power loss from the external power source occurs. The passive backup power source may include one or more super capacitors of between five and thirty Farads or ten to fifty Farads for example. The passive backup power source may keep the memory module operational for at least four 4 seconds after power loss from the external power source. The passive backup power source may be mounted over the one or more volatile memory devices or the one or more non volatile memory devices.

In one example the memory module may have a thickness of between 7.5 millimeters and 10.5 millimeters. The memory module may have a height of between 27 millimeters and 33 millimeters.

The memory module may further comprise a power connector separate from the interface the power connector for coupling the memory module to a passive backup power source which is utilized by the memory module if power loss from the external power source occurs.

In one example the logic device may include a a volatile memory controller selectively coupled to the one or more volatile memory devices b a non volatile memory controller coupled to the on the one or more non volatile memory devices c a buffer coupled between the volatile memory controller and the non volatile memory controller and or d a control circuit coupled to the volatile memory controller and the non volatile memory controller. The control circuit may be adapted to a switch connectivity for the one or more volatile memory devices from the host system to the one or more non volatile memory devices upon obtaining the indicator of the triggering event and or b switch connectivity for the one or more volatile memory devices from the one or more non volatile memory devices to the host system when the indicator of the triggering event is cleared.

Additionally the logic device may be further configured to a provide internal status information to the host system via a first external register for data stored in the memory module b obtain an indication from the host system via a second external register to initiate an internal data save data restore or data clear process for data already stored in the memory module and or c obtain configuration information from the host system via a third external register to configure internal data save and data restore processes for data already stored in the memory module.

A method is also provided the method being operational on a memory module having volatile memory and non volatile memory to save data upon indication of an external triggering event. A first indicator of a first external triggering event is obtained by the memory module. Data from volatile memory is saved into non volatile memory upon the receipt of the first indicator of the first external triggering event. The memory module may switch to a backup power source specific to the memory module upon receipt of the first indicator. Additionally the memory module may a decouple a host system from the one or more volatile memory devices upon receipt of the first indicator of the first external triggering event and or b couples the one or more volatile memory devices to the one or more non volatile memory devices prior to backing up the data. A second indicator may be obtained of a second external triggering event. Data from the non volatile memory may be restored to the volatile memory based on receipt of the second indicator. Note that the second indicator may be indicative that the first indicator has been cleared. In some implementations the second indicator may be received via a different interface than the first indicator or the second external triggering event may be independent of the first external triggering event. The non volatile memory is decoupled from the volatile memory after restoring the data. The volatile memory may then be coupled to a host system after restoring the data.

An integrated circuit is also provided comprising a an first interface for a first bus to and from a host system b a second interface for a second bus to and from volatile memory c a third interface for a third bus to and from non volatile memory and or d a switch coupled to the first interface second interface and third interface. The switch may be configured to a electrically couple the first bus to the second bus in a first mode of operation b electrically couple the first bus to the third bus in a second mode of operation and or c electrically couple the second bus to the third bus in a third mode of operation. The switch may be adaptable between the first mode second mode and third mode based on an indicator of an external triggering event. The integrated circuit may further comprise a a non volatile memory controller between the switch and the third interface to convert signals between the first bus and the third bus b a volatile memory controller between the switch and the second interface to convert signals between the first bus and the second bus c a volatile memory controller electrically coupled to the second bus d a non volatile memory controller electrically coupled to the third bus and or e a buffer coupled between the volatile memory controller and the non volatile memory controller to facilitate data transfers directly between the second bus and the third bus.

While certain exemplary embodiments have been described and shown in the accompanying drawings it is to be understood that such embodiments are merely illustrative of and not restrictive on the broad invention and that this invention is not be limited to the specific constructions and arrangements shown and described since various other modifications may occur to those ordinarily skilled in the art.

A first feature provides a memory module with a passive backup power source that allows the memory module to backup data from volatile memory devices to non volatile memory devices. If a triggering event such as host power loss is detected the power stored in the passive backup power source is utilized to keep sufficient components on the memory module powered long enough to transfer data from the volatile memory devices to the non volatile memory devices. Upon detection that the power loss event has been cleared e.g. external power has been restored the backed up data is copied from the non volatile memory devices to the volatile memory devices.

A second feature provides for the passive backup power source to be integrated with the memory module. Such integrated passive backup power source may be a super capacitor that is mounted on at least one side of the memory module and is charged by the external power provided to the memory module typically through a bus with a host system . The super capacitors may have a thin profile such that the thickness of the memory module is not significantly increased. In an alternative implementation the memory module may include a power connector separate from an interface to the host system that allows coupling to an external backup power source.

A third feature provides a controller capable of transferring data between volatile and non volatile memory devices in a memory module based on an external trigger such as detected power conditions. The controller may be adapted to backup or restore data depending on the state or condition of the external power source. In backup mode the controller may be adapted to decouple the volatile memory from the host system and couple it to the non volatile memory devices. Conversely once data has been restored from the non volatile memory devices to the volatile memory devices the volatile memory devices can be decoupled from the non volatile memory devices and coupled to the host system.

In some instances the RAID controller may include cache memory storage which may be used to temporarily store data as it is transferred from the host computer to the RAID . In one example the cache memory storage may include may include volatile memory devices arranged as a double data rate DDR dual in line memory modules DIMM e.g. 256 MB 4 GB capacity .

The cache memory storage may allow faster storage and retrieval of data than to the RAID disk drives and may also act as temporary storage as data is redundantly stored to a plurality of the RAID disk drives . However some prior art cache memory devices may be susceptible to data loss in the event of power failure. Data loss from cache memory storage may be unrecoverable and cause inconsistencies in data stored among the RAID disk drives .

To prevent such data loss in the event of power failure the cache memory storage may include a passive backup power source e.g. such as an ultra thin capacitor . While external power is available the backup power source is charged. If a power failure event e.g. low voltage level is detected the backup power source provides sufficient power long enough e.g. 8 to 10 seconds to backup data from the volatile memory devices to on board non volatile memory devices. When external power is reestablished to its normal level data stored in the non volatile memory devices can be copied to the volatile memory devices and or flushed to the disk drives .

The memory module may also include one or more onboard volatile memory devices e.g. double data rate DDR synchronous dynamic random access memory DRAM including DDR2 and DDR3 etc. which rely on power to maintain the information data stored therein. The memory module may also include one or more onboard non volatile memory devices e.g. flash etc. which do not need power maintain information data stored therein. The memory module main include additional components to allow storage and or retrieval of data. One or more of these components may allow data stored in the one or more volatile memory devices to be backed up in the one or more non volatile memory devices when a triggering event e.g. a power interruption hardware signal and or host system command is detected thereby preventing loss of data. The memory module may be adapted to receive an indicator when one or more different types of triggering events occur or are cleared.

In one example the memory module may include a power module that receives external power e.g. via the interface and provides such power to one or more of the components of the memory module . The power module may be coupled to a backup power source . In one example the backup power source may be for instance a passive component such as an ultra thin capacitor. When the external power source provides a normal voltage level to the power module the backup power source is charged. A voltage detector may determine when the external power source fails to provide a normal typical or minimum voltage level which is indicative of an imminent power failure and loss of data stored in the one or more volatile memory devices . If such low voltage condition is detected by the voltage detector it causes the backup power source to provide power to one or more of the components of the memory module . That is if a low voltage condition occurs the backup power source provides enough power to the memory module to allow data stored in the volatile memory devices to be stored or backed up to the non volatile memory devices . When the voltage detector subsequently detects a normal voltage condition from the external power source it may copy or restore the backed up data from the non volatile memory devices to the volatile memory devices and or to an external disk e.g. RAID .

To accomplish such data backup the memory module may include an address control bus switch that receives address and or control information from the interface e.g. via an address control bus and directs it to either the volatile memory devices or the non volatile memory devices via a backup restore logic device . Similarly the memory module may include a data bus switch that receives address and or control information from the interface e.g. via a data bus and directs it to either the volatile memory devices or the non volatile memory devices via the backup restore logic device . That is when the external power source provides a normal voltage e.g. a voltage level equal to or greater than a threshold voltage level then the address control bus switch and the data bus switch route the address control bus and data bus respectively to the volatile memory devices . Conversely if the external power supply provides a low voltage e.g. a voltage level less than a threshold voltage level then the address control bus switch and the data bus switch route the address control bus and data bus respectively to the non volatile memory devices via the backup restore logic device . Note that the address control bus may provide an address and or control signals used to write store data in the data bus to the volatile memory devices or read retrieve data from the volatile memory devices .

The backup restore logic device may be adapted to convert a first bus type to a second bus type to facilitate data transfers between the volatile memory devices and the non volatile memory devices . In a first mode of operation when a power failure has been detected the logic device may be configured to back up data from the volatile memory devices to the non volatile memory devices . Additionally in a second mode of operation when external power has been restored the logic device may be configured to restore data from the non volatile memory devices to the volatile memory devices . The backup restore circuit may be implemented by one or more controllers circuits processors application specific integrated circuits programmable logic arrays and or switches.

The memory module may optionally include a controller between the backup restore logic device and the non volatile memory devices which may serve to write read data to from the non volatile memory devices and or convert signals between two different types of interfaces or busses e.g. between a DDR DRAM bus and a SATA flash bus . In other implementations the controller may be omitted e.g. where its functionality is performed by the controller or where conversion between different busses is not needed .

Note that the backup power source need only provide operating power to the memory module for only a moment just a few seconds to allow time for data to be copied from the volatile memory devices to the non volatile memory devices when a power failure is detected. The amount of time needed to copy data from the volatile memory devices to the non volatile memory devices will depend on the speed of the read time of the volatile memory devices and the write time of the non volatile memory devices and the amount of data being copied. In some instances the whole content of the volatile memory devices may be copied to the non volatile memory devices therefore the amount of time needed to backup data is dependent on the capacity of the volatile memory devices .

The backup restore logic device may also be adapted to receive other indicators of an external triggering event. For example a host system may generate and send a hardware signal and or a host system command to the memory module indicating an external triggering event. The host system may generate such hardware signal and or software command when a triggering event is sensed. It may also provide an indicator that such triggering event has been cleared.

If a triggering event is detected a save or backup state is entered in which the data in the volatile memory devices is transferred to the non volatile memory devices. For example where the volatile memory devices have a combined a size or capacity of 512 megabytes the data save or backup operation may be performed within eight 8 seconds or less. Note that the speed at which the data can be saved or backed up will depend on the total size of the volatile memory devices among other factors. Additionally the amount of time a backup power source e.g. super capacitors on the memory module can sustain operations may be increased or decreased according to the time needed e.g. by using larger or smaller Farad capacitors . The volatile memory devices may be refreshed during a save state to avoid data loss.

After data transfer is complete the memory module enters an Off state in which the volatile memory and other components on the memory module is powered Off. After the triggering event is cleared e.g. normal voltage is reestablished from the external power source or the triggering event is cleared data in non volatile memory devices may be copied or transferred to the volatile memory devices or an external disk drive. However should a triggering event e.g. low voltage etc. be detected during the restore state the state is changed back to the Off state While in the restore state access to the volatile memory devices by an external host may be blocked while restore operations take place. In most instances this should not cause a problem since the restore operations should be completed long before the host has completed operating system boot up.

Any time the host system power or voltage is below the threshold voltage the memory module controller either disconnects or does not reconnect the memory module to the host memory bus and the memory module will be in Power Fail Mode. The host system can check the memory module s controller status registers through its i2c interface to know if the memory module is available busy performing a Save or Restore operation and or in Power Fail Mode. While the memory module is busy all memory bus traffic including refresh commands to the memory module is ignored. All volatile memory refresh requirements are handled by the on module controller during Save or Restore operations. On Die Termination ODT may also not be operating on the memory module while the host memory bus is disconnected so system signal quality analysis should take this into account. Test reads by the host system to the memory module to check availability are not recommended since the memory bus will be tri stated on the memory module.

Under normal operation the controller is in an idle state which include may include checking for a triggering event or condition e.g. low voltage hardware signal software interrupt etc. . For example the memory module may monitor for or receive an indicator of an external triggering event e.g. a low voltage loss of power event etc. . In one example a host system may generate an indicator of a triggering event. Such indicator is received monitored and or obtained by the memory module. In the idle state the memory module may be adapted to force a memory restore operation force a memory clear operation initiate a save operation based on a detected triggering event and or power off without saving .

When forcing the memory Restore operation the memory module may enter a restore state . In this restore state data may be restored from non volatile memory to volatile memory and upon completion of data restoration the memory module returns to the idle state .

When forcing the memory Clear operation the memory module may enter a clear state . In this clear state data may be cleared from non volatile memory and or volatile memory. Upon completion or abortion of the data Clear operation the memory module returns to the idle state . However if the host power has dropped below a threshold level then the memory module may enter the off state instead.

In some instances such as when a host power drops below threshold level and a Save operation is not triggered the memory module may transition directly from the idle state to an off state . In other instances the memory module while in idle state may detect a triggering event e.g. auto save host power less than threshold level hardware interrupt and or force save signal which causes it to enter a save state . In the save state the memory module saves data from the volatile memory to the non volatile memory. Upon completion of the save operation and if the host power is less than a threshold level the memory module enters the off state . Otherwise upon completion of the save operation and if the host power is greater than a threshold level the memory module returns to the idle state .

From the off state if the host power is greater than the threshold level then the memory module may enter the restore state where data is restored from the non volatile memory to the volatile memory. Alternatively if no restore operation is to be performed e.g. no data was stored upon entering the off state then if host power is greater than the threshold level the memory device transitions directly from the off state to the idle state .

There may be several available triggers that prompt a memory module controller or logic device to initiate a Save operation. For example three SAVE triggers may include a power failure the setting of an i2c interface Force Save bit by the host system and the setting of a SAVE n hardware interrupt pin.

Save Trigger 1 Automatic save in the event of power failure. In order to automatically save or backup the volatile memory if a system power failure is experienced an on module voltage monitor may immediately alert the controller or logic device if the main host power or voltage goes below a set threshold. The controller then automatically initiates a Save operation. When the monitor observes a host power or voltage level that is less than the threshold the host system power will likely not be available while all of the data is being transferred. Therefore the Save operation is completed while the memory module power is held up by an attached capacitor. This ensures the integrity of the data while it is still in volatile memory and provides the power needed for the data transfer to be completed. The controller quickly isolates the host memory bus after the Save operation is triggered and begins the data transfer from the volatile memory to the non volatile memory. This trigger may be enabled by default defined by an Auto Save bit being set in a register.

Save Trigger 2 The host system may force a Save operation through an i2c control register interface. The host system may prompt the memory module controller to initiate a Save operation through the i2c interface any time that the controller is in the Idle state. The host system only sets the Force Save bit in the i2c host control registers to start the Save process. After the controller reads the bit as set it will start the Save operation and clears the bit. This controller status can be checked in the i2c status registers.

Save Trigger 3 The host system may also force a Save operation by driving a hardware interrupt pin e.g. SAVE n hardware interrupt pin to force the memory module controller to initiate a Save operation. The hardware interrupt pin may be driven asynchronously but may be sampled at the rising memory bus clock edge. In one example the hardware interrupt pin may be driven low for a minimum of 10 ns or 2 memory clock periods whichever is more. The controller can mask the hardware interrupt by setting an i2c interface bit Ignore HW Int so that the hardware interrupt pin will not trigger the Save operation. Once triggered the Save operation completes a full backup of data from volatile memory into non volatile memory on the memory module. When the SAVE operation is completed and power is stable the controller may resume monitoring the state of this hardware interrupt pin.

There may be multiple triggers that cause the memory module controller or logic device to initiate a Restore operation. For example a Restore operation may be automatically triggered upon power up from a power failure event or may be triggered when a restore bit is set e.g. an i2c interface Force Restore bit is set .

Restore Trigger 1 If data is saved in non volatile memory due to a power failure event it may be automatically restored to volatile memory when adequate power levels resume. The memory module can do this automatically as soon as the host power is stable. If an Auto Restore host configuration option is enabled after power up the controller can isolate the memory module from the host memory bus at least isolate the data address and or control lines of the host memory bus and perform a Restore operation.

Restore Trigger 2 The host system may prompt the memory module controller to initiate a Restore operation by using the i2c interface when the controller is in the Idle state. To start the Restore process the host system may set the Force Restore bit in the i2c interface e.g. in a host system control register . After the memory module controller logic device reads the bit as set it can start a Restore operation and then clear the bit. The controller status can be checked in the i2c status registers.

The Clear operation may provide the host system a way to overwrite the stored contents of the non volatile memory. The intent of a Clear operation is to erase all data that was previously saved to the non volatile memory from the volatile memory. Since the Clear operation writes to all of the non volatile memory it may take considerably longer than a typical Save operation. Therefore Clear operations during a Power Fail Mode may not be supported since it may take more power than is available on an on module capacitor that provides backup power. If the memory module changes into Power Fail Mode during a Clear operation the Clear operation may be aborted. Should a Save or Restore operation be triggered while a Clear operation is being performed the Clear operation may be aborted and the Save or Restore operation may be initiated. While a Clear operation is being performed the host system may still have access to the memory module and the host system memory bus is not isolated. The host system may check over the i2c interface to see if the Clear operation finished. When a Clear operation has been successfully completed the memory module controller may set the read only status bit Clear Complete. This bit may be cleared when the next Save operation is initiated.

When first supplying host system power to the memory module normal power sequencing processes for the memory module can be followed. However the memory module may require time to initialize before certain functions are available. The time required depends on whether the memory module controller automatically performs a Restore operation when host system power resumes. That is when a Restore operation is performed upon power up it may take longer for certain memory module functions are available to the host system. In the case that a Restore process is performed before the host system is given access the memory module controller may initialize the memory.

The memory module may monitor the status and regularly check the health of the on module capacitor supercapacitors used as backup power. The capacitor s may begin charging as soon as host system power becomes available. When the charge on the capacitor s is sufficient to support a full Save operation the Data Safe bit may set e.g. in an i2c interface status register . Generally depending on the memory module density a capacitor capacity and other factors this process may take less time than approximately one minute.

In one example the memory module may be a Joint Electron Device Engineering Council JEDEC Edge Compatible DDR2 533 512 megabytes registered dual in line memory module DIMM with error correcting code ECC which may be based on 9 8 volatile memory devices or 5 16 volatile memory devices. The memory module may have a standard low profile LP form factor of approximately 8 millimeters mm thick and or approximately 30.0 mm in height.

In this example the second side of the substrate may also include a voltage detector and a backup restore logic device . The voltage detector may monitor an external voltage e.g. provided by an external power source via the connection edge to determine if and when a low voltage or power loss event occurs. The backup restore logic device may operate to copy data from volatile memory to non volatile memory if a low voltage or power loss event is detected. When an external power source again provides a normal voltage level the backup restore logic device may operate to copy the backed up data from the non volatile memory to the volatile memory .

In one example the memory module may be a Joint Electron Device Engineering Council JEDEC Edge Compatible DDR3 1066 1 Gigabyte 2 Gigabyte registered DIMM with error correcting code ECC which may be based on 9 8 volatile memory devices 1 Gigabyte or 2 Gigabyte . The memory module may have a standard low profile LP form factor of approximately 7.55 millimeters mm thick and or approximately 30 mm in height.

In one example the memory module may be a Joint Electron Device Engineering Council JEDEC Edge Compatible DDR3 1333 4 Gigabyte registered DIMM with error correcting code ECC which may be based on eighteen 2 Gigabyte 8 volatile memory devices dynamic RAM packaged in 2 high stacks 2R 8 module . The memory module may have a standard low profile LP form factor of approximately 10.5 millimeters mm thick and or approximately 27.5 mm in height.

In contrast to previous examples the memory module may include a power connector that allows charging and or discharging of an external backup power capacitor through a wire or other conductor .

The concepts and or configurations described herein may be implemented in memory modules of different physical dimensions and capacities including Ultra Small Backup DIMM Low Height Backup Module Standard Mini DIMM and Standard Low Profile DIMM. In one example the memory module may be an Ultra Small DIMM with ECC having an approximate dimension of 60 mm wide and 30 mm high. In another example the memory module may be an Ultra Small DIMM with ECC having an approximate dimension of 60 mm wide and 30 mm high.

In the examples illustrated in the triggering event is considered a low voltage or loss of external power event. However it should be clear that other triggering events such as an external hardware signal or a command from a host system are possible and contemplated triggering events.

In some implementations the memory modules illustrated in may be implemented for caching information e.g. temporary storage in such implementations as RAID systems. For instance one or more of these memory modules may be coupled to a RAID controller and utilized by the RAID controller for caching data.

After an external power source reestablishes a normal voltage data in non volatile memory can be restored to volatile memory. In some implementations this restoration process may take a few seconds e.g. 4 to 10 seconds depending on the size or capacity of the volatile memory. For instance it may take approximately 8 seconds for a 512 MB DIMM memory module. While restore operations take place the memory module may not be accessible to a host. In most cases this should not be a problem since the restore operation should be completed long before the host has completed boot up of its operating system. However if the non access period e.g. 8 second is a problem for some host systems e.g. the host wants immediate access to the memory module a hybrid approach may be employed using non volatile memory for data backup with a small battery e.g. smaller than the batteries used by the prior art .

That is a small auxiliary battery may be utilized to support immediate accessibility to the memory module after a host system powers up. The data in the volatile memory device of the memory module may have been saved in non volatile memory for long term backup e.g. prior to a power failure . The small auxiliary battery may provide power to one or more components of the memory module during this period when the host system has not yet powered up. A restore operation may be initiated prior to the host system powering up in one of two ways. First the operator may depress a pushbutton on memory module to wakeup components of the memory module and copy data from non volatile memory back to volatile memory. Second a dedicated hardware signal e.g. defined by the host system may be used to initiate the restore operation on the memory module. For instance such dedicated hardware signal may be driven by out of band system management hardware to support fully remote system operations.

Note that the use of super capacitor described in various examples herein have several advantages over prior art that utilizes batteries to backup data in volatile memory. First using the non volatile memory to backup data allows long term data storage e.g. months or years . By contrast the prior art may utilize batteries to maintain data in volatile memory but this only allows maintaining data for just a few hours or days e.g. 72 hours . Consequently the present approach allows data to be retained backed up or stored long term relative to the prior art.

Second the present approach of using one or more super capacitors as the backup power source allows recharging within a few seconds e.g. 10 seconds or less while the use of rechargeable batteries in the prior art typically takes several hours e.g. 8 hours to recharge.

Third the use of super capacitors makes the overall size and or weight of the memory module smaller or lighter than if batteries were used. Note that the heavier the module the greater the chance of failure at the interconnect point e.g. socket with the host system.

Fourth with super capacitors backup and restore capabilities are always available to the memory module. By contrast if rechargeable batteries are used these batteries must be regularly conditioned by discharging them periodically. Consequently the cache memory module must be taken off line for such procedure affecting its availability and backup performance.

Fifth super capacitors can operate with replacement while batteries must be periodically replaced. This replacement of batteries adds to the operating and maintenance cost of prior art memory modules.

Sixth batteries tend to have a higher initial cost than capacitors and also have ongoing costs for periodic maintenance or replacement.

Seventh the use of super capacitors as a backup power source is more environmentally friendly than using batteries since unlike batteries super capacitors do not have to be regularly replaced.

The power circuit may also include a voltage detector that is configured to sense changes in voltage from the external power source. The voltage detector may be adapted to determine when the incoming voltage level falls below a voltage threshold which may indicate a power failure or loss. If such power loss event is detected the voltage detector may send a signal to cause the switch to change its input power from the step up converter to the super capacitors and . Note that the signal may be optional as the switch may perform this automatically upon sensing a lower voltage from the converter . Additionally the voltage detector may also generate a power failure interrupt signal . When the power failure interrupt signal is set this is an indicator of imminent power failure and can be used by other components such as a backup restore controller of the memory module to quickly copy data from volatile memory to non volatile memory. Subsequently when external power is reestablished or again normal the power failure interrupt signal may be cleared thereby indicating that data previously copied to the non volatile memory can be restored to the volatile memory.

Note that the number size and or value of the super capacitors and may vary depending on how long the backup power source needs to maintain or holdup the components of the memory module and how much power is needed to allow backing up data from volatile memory to non volatile memory.

Smaller or larger capacitors and or fewer or greater number of super capacitors may be employed depending on the memory module e.g. volatile memory capacity to satisfy the power needed to backup data from volatile memory to non volatile memory in the event of power loss.

Upon receiving a power failure interrupt signal e.g. indicating imminent loss of power to the memory module the logic device may be configured to enter backup mode. In backup mode the logic device facilitates data storage from volatile memory into non volatile memory thereby preventing data loss in the memory module. The logic device may implement a state machine e.g. using a control circuit a logic module etc. to perform backup and or restore operations depending on the condition of an external power source. One example of such state machine is illustrated in . Upon entering backup mode the logic device may generate one or more signals to cause one or more external switches e.g. data bus switch and address control bus switch in to cause an address control bus and data bus to be setup between volatile memory and non volatile memory on the memory module. For example in data bus switch and address control bus switch may be reconfigured to decouple the volatile memory devices from the interface and instead couple the volatile memory devices to the non volatile memory devices . Therefore in backup mode the logic device can retrieve data from the volatile memory via a data bus and address control information via an address control bus . The volatile memory controller may be adapted to retrieve data from the volatile memory and provide it to a non volatile memory controller which stores the data in the non volatile memory. A buffer may be placed between the volatile memory controller and non volatile memory controller to temporarily store data being transferred between a first data bus e.g. data bus and a second data bus data bus . In one example a status register may also be used to maintain information indicating the state of the logic device e.g. SAVE in process SAVE complete RESTORE in process etc. These status registers may also allow a host system to configure the operation of the backup and restore logic device .

Note that the sustained write read speed of the logic device and or the non volatile memory being used may determine save backup and or restore times achieved during backup and or restore operations between volatile and non volatile memory.

Upon clearing of the power failure interrupt signal e.g. indicating that external power is now available at a normal voltage level the logic device may be configured to enter restore mode. In restore mode the logic device facilitates data retrieval and storage from non volatile memory into volatile memory thereby restoring the data in volatile memory to its original state before the power loss event. In one example the restore operations may be performed as illustrated in the state machine of .

More generally the logic device may be configured to a receive a first indicator of a first external triggering event and b copy data from the one or more volatile memory devices to the one or more non volatile memory devices upon receipt of the first indicator. The first external triggering event may be one of an external power failure a hardware signal or a system host command.

In one example the logic device may be further configured to a electrically decouple the host system from the one or more volatile memory devices after receiving the first indicator of the first external triggering event and or b electrically couple the one or more volatile memory devices to the one or more non volatile memory devices prior to copying the data.

In another example the logic device may be further configured to a receive an a second indicator a second external triggering event b restore the data from the one or more non volatile memory devices to the one or more volatile memory devices based on receipt of the second indicator c electrically decouple the one or more non volatile memory devices from the one or more volatile memory devices after restoring the data and or d electrically couple the one or more volatile memory devices to the host system after restoring the data. Note that the second indicator may be indicative that the first indicator has been cleared. In some implementations the second indicator may be received via a different interface than the first indicator or the second external triggering event may be independent of the first external triggering event.

Similarly Bit Restore Complete may indicate whether a restore operation was successfully completed e.g. from non volatile memory to volatile memory since the last power cycle or operating system hang. Bit Power Fail Mode may be used to indicate that the memory module detects that a host system power or voltage is below the minimum threshold and the memory module is running off of backup supercapacitor power. Bit Data Safe may be utilized to indicate that the memory module backup power e.g. supercapacitors are ready to support a full Save operation from volatile memory using only on module power. Bit Clear Complete may be used to indicate that a Clear operation has been successfully completed. Bit may be cleared when a Save operation is initiated.

According to one implementation a memory module controller or logic device may be instructed to perform only one operation in a control register at a time. If Force Save Force Restore Restore Defaults or Force Clear is set then the controller ignores any further writes to set other control registers until the previous operation is started and the associated bit is cleared. However the Abort Save bit Bit in Byte may be written at any time to abort a Save operation.

In a normal mode of operation e.g. when power is being provided to the memory module via the external host system the logic device may electrically couple a data bus and or an address control bus to volatile memory via a corresponding data bus and or address control bus . In one example such electrical coupling may be done by a switch .

Upon receiving a triggering event indicator signal e.g. power failure interrupt signal from a voltage detector or an external source indicating imminent loss of power to the memory module the logic device may be configured to enter backup mode. In backup mode the logic device facilitates data storage from volatile memory into non volatile memory thereby preventing data loss in the memory module. The logic device may implement a state machine e.g. using a control circuit a logic module etc. to perform backup and or restore operations depending on the condition of the external triggering event e.g. state of an external power source . Upon entering backup mode the logic device may cause external signal paths to from the host system to be partially decoupled. For example in backup mode the logic device may electrically decouple the data bus and or the address control bus to and or from the host system. Note that other external signal paths e.g. for module status information etc. may remain electrically coupled between the memory module and the host system. In one example the switch may be utilized by the logic device to electrically decouple the data bus and or address control bus from the host system and electrically couple a first bus e.g. and to from volatile memory to a second bus to from non volatile memory. The path between the first bus and the second bus may include a volatile memory controller and a non volatile memory controller . For example the volatile memory controller may be adapted to send address information to the volatile memory and retrieve data from such address from the volatile memory. The volatile memory controller then sends the retrieved information to the non volatile memory controller which stores it in non volatile memory. A buffer may be placed between the volatile memory controller and non volatile memory controller to temporarily store data being transferred between the first bus e.g. data bus and or address control bus and the second bus . In one example a status register may also be used to maintain information indicating the state of the logic device e.g. SAVE in process SAVE complete RESTORE in process etc. These status registers may also allow a host system to configure the operation of the backup and restore logic device .

When the triggering event indicator signal e.g. power failure interrupt signal is cleared e.g. indicating that power is being provided by the external power source from the host system or that saved data should be restored from non volatile memory to volatile memory the logic device may be adapted to transfer or restore data from the non volatile memory to the volatile memory. Again during this restore operation the switch may decouple the data bus and or address control bus from the first bus and couples the first bus to the second bus .

In yet another implementation the logic device may be adaptable to send data and address information from the data bus and or address control bus directly to the non volatile memory. For example the switch may be adapted to electrically couple the data bus and or address control bus to the second bus . Consequently data from the data bus may be sent only to the non volatile memory or may be sent concurrently to both the volatile memory via the first bus and the non volatile memory via the second bus . In one implementation the logic device may be adapted to save data to the non volatile memory first and subsequently transfer copy or save the data from the non volatile memory to the volatile memory.

Note that in yet another alternative embodiment the non volatile memory controller may optionally include a direct bus between the switch and the non volatile memory controller to allow transferring data or address control information directly to the non volatile memory controller . The direct bus may include a data bus and or an address control bus.

The logic device may subsequently determine whether a second indicator of a second triggering event has been received . For example the second indicator may indicate that the first indicator has cleared. Note that the second indicator may be indicative that the first indicator has been cleared. In some implementations the second indicator may be received via the same or a different interface than the first indicator. Additionally the second external triggering event may be independent of the first external triggering event. In other instances the first indicator e.g. used for a Save operation may be triggered by a different event than the second indicator e.g. used for a Restore operation . For example the first external triggering event may be a host system power failure event but the second triggering event may be a host system command or signal. If the second indicator is received e.g. indicating that external power is again available or that the operator wants to restore backed up data the logic device restores data from the non volatile memory to the volatile memory . The logic device then electrically decouples the non volatile memory from the volatile memory and electrically couples the volatile memory to the host system .

In a first mode of operation the logic device may electrically couple a host bus e.g. data bus and or an address control bus to non volatile memory via a corresponding second bus e.g. including a data bus and or address control bus . In one example such electrical coupling may be done by a switch .

In one implementation during the first mode of operation the switch may concurrently couple the host bus to volatile memory via a first bus including data bus and or address control bus . This may be done via an optional direct bus or via a non volatile memory controller and volatile memory controller .

In a second mode of operation the switch may decouple the host bus from the second bus and couples the host bus to volatile memory via the data bus and or address control bus . This may be done via an optional direct bus or via a non volatile memory controller and volatile memory controller . A buffer may serve to transfer data between the non volatile memory controller and volatile memory controller .

In yet a third mode of operation upon receiving a triggering event indicator signal e.g. power failure interrupt signal from a voltage detector or an external source indicating imminent loss of power to the memory module the logic device may be configured to facilitate data transfers from the volatile memory into non volatile memory thereby preventing data loss. For example in the third mode the logic device may electrically decouple the host bus e.g. data bus and or the address control bus to and or from the host system. Note that other external signal paths e.g. for module status information etc. may remain electrically coupled between the memory module and the host system. In one example the switch may be utilized by the logic device to electrically decouple the host bus e.g. data bus and or address control bus from the host system and electrically couple the first bus e.g. and to from volatile memory to the second bus to from non volatile memory. The path between the first bus and the second bus may include the switch a volatile memory controller and a non volatile memory controller . For example the volatile memory controller may be adapted to send address information to the volatile memory and retrieve data from such address from the volatile memory. The volatile memory controller then sends the retrieved information to the non volatile memory controller which stores it in non volatile memory. A buffer may be placed between the volatile memory controller and non volatile memory controller to temporarily store data being transferred between the first bus e.g. data bus and or address control bus and the second bus . In one example a status register may also be used to maintain information indicating the state of the logic device e.g. SAVE in process SAVE complete RESTORE in process etc. These status registers may also allow a host system to configure the operation of the backup and restore logic device . In an alternative approach an optional bus may be coupled between the switch and volatile memory controller to bypass the non volatile memory controller .

In a fourth mode of operation upon receiving an indicator that the triggering event has been cleared the state machine may be adapted to cause data to be read from the non volatile memory via the second bus and stored in the volatile memory via the first bus and volatile memory controller .

In a first mode of operation the logic device may electrically couple a host bus e.g. data bus and or an address control bus to non volatile memory via a non volatile memory controller and a corresponding second bus e.g. including a data bus and or address control bus . In one example a switch may be used to direct the data to the non volatile memory controller via a second direct bus .

In one implementation during the first mode of operation the switch may concurrently couple the host bus to volatile memory via a volatile memory controller and a first bus including data bus and or address control bus . This may be done via a first direct bus .

In a second mode of operation the switch may decouple the host bus from the second bus and couples the host bus to volatile memory via the first bus e.g. data bus and or address control bus . This may be done via the direct bus and the volatile memory controller .

In yet a third mode of operation upon receiving a triggering event indicator signal e.g. power failure interrupt signal from a voltage detector or an external source indicating imminent loss of power to the memory module the logic device may be configured to facilitate data transfers from the volatile memory into non volatile memory thereby preventing data loss. For example in the third mode the logic device may electrically decouple the host bus e.g. data bus and or the address control bus to and or from the host system. Note that other external signal paths e.g. for module status information etc. may remain electrically coupled between the memory module and the host system. In one example the switch may be utilized by the logic device to electrically decouple the host bus e.g. data bus and or address control bus from the host system and electrically couple the first bus e.g. and to from volatile memory to the second bus to from non volatile memory. The path between the first bus and the second bus may include the volatile memory controller and the non volatile memory controller . For example the volatile memory controller may be adapted to send address information to the volatile memory and retrieve data from such address from the volatile memory. The volatile memory controller then sends the retrieved information to the non volatile memory controller which stores it in non volatile memory. A buffer may be placed between the volatile memory controller and non volatile memory controller to temporarily store data being transferred between the first bus e.g. data bus and or address control bus and the second bus . In one example a status register may also be used to maintain information indicating the state of the logic device e.g. SAVE in process SAVE complete RESTORE in process etc. These status registers may also allow a host system to configure the operation of the backup and restore logic device .

In a fourth mode of operation upon receiving an indicator that the triggering event has been cleared the state machine may be adapted to cause data to be read from the non volatile memory via the second bus and non volatile memory controller and stored in the volatile memory via the first bus and volatile memory controller .

While various examples described herein may illustrate the logic devices as being part of a memory module it should be clear that this logic device may be implemented as part of other modules circuits or electrical boards.

It should be recognized that generally most of the processing described in this disclosure may be implemented in a similar fashion. Some of the circuit s or circuit sections may be implemented alone or in combination as part of an integrated circuit with one or more processors. The one or more of the circuits may be implemented on an integrated circuit an Advance RISC Machine ARM processor a digital signal processor DSP a general purpose processor an application specific integrated circuit ASIC a field programmable gate array FPGA etc.

Also it is noted that the embodiments may be described as a process that is depicted as a flowchart a flow diagram a structure diagram or a block diagram. Although a flowchart may describe the operations as a sequential process many of the operations can be performed in parallel or concurrently. In addition the order of the operations may be re arranged. A process is terminated when its operations are completed. A process may correspond to a method a function a procedure a subroutine a subprogram etc. When a process corresponds to a function its termination corresponds to a return of the function to the calling function or the main function.

As used in this application the terms component module system and the like are intended to refer to a computer related entity either hardware firmware a combination of hardware and software software or software in execution. For example a component may be but is not limited to being a process running on a processor a processor an object an executable a thread of execution a program and or a computer. By way of illustration both an application running on a computing device and the computing device can be a component. One or more components can reside within a process and or thread of execution and a component may be localized on one computer and or distributed between two or more computers. In addition these components can execute from various computer readable media having various data structures stored thereon. The components may communicate by way of local and or remote processes such as in accordance with a signal having one or more data packets e.g. data from one component interacting with another component in a local system distributed system and or across a network such as the Internet with other systems by way of the signal .

Moreover a storage medium may represent one or more devices for storing data including read only memory ROM random access memory RAM magnetic disk storage mediums optical storage mediums flash memory devices and or other machine readable mediums for storing information. The term machine readable medium includes but is not limited to portable or fixed storage devices optical storage devices wireless channels and various other mediums capable of storing containing or carrying instruction s and or data.

Furthermore embodiments may be implemented by hardware software firmware middleware microcode or any combination thereof. When implemented in software firmware middleware or microcode the program code or code segments to perform the necessary tasks may be stored in a machine readable medium such as a storage medium or other storage s . A processor may perform the necessary tasks. A code segment may represent a procedure a function a subprogram a program a routine a subroutine a module a software package a class or any combination of instructions data structures or program statements. A code segment may be coupled to another code segment or a hardware circuit by passing and or receiving information data arguments parameters or memory contents. Information arguments parameters data etc. may be passed forwarded or transmitted via any suitable means including memory sharing message passing token passing network transmission etc.

One or more of the components steps and or functions illustrated in the Figures may be rearranged and or combined into a single component step or function or embodied in several components steps or functions without affecting the operation. Additional elements components steps and or functions may also be added without departing from the invention. The apparatus devices and or components illustrated in the Figures may be configured to perform one or more of the methods features or steps described in the Figures. The novel algorithms described herein may be efficiently implemented in software and or embedded hardware.

Those of skill in the art would further appreciate that the various illustrative logical blocks modules circuits and algorithm steps described in connection with the embodiments disclosed herein may be implemented as electronic hardware computer software or combinations of both. To clearly illustrate this interchangeability of hardware and software various illustrative components blocks modules circuits and steps have been described above generally in terms of their functionality. Whether such functionality is implemented as hardware or software depends upon the particular application and design constraints imposed on the overall system.

The various features of the invention described herein can be implemented in different systems without departing from the invention. For example some implementations of the invention may be performed with a moving or static communication device e.g. access terminal and a plurality of mobile or static base stations e.g. access points .

It should be noted that the foregoing embodiments are merely examples and are not to be construed as limiting the invention. The description of the embodiments is intended to be illustrative and not to limit the scope of the claims. As such the present teachings can be readily applied to other types of apparatuses and many alternatives modifications and variations will be apparent to those skilled in the art.

