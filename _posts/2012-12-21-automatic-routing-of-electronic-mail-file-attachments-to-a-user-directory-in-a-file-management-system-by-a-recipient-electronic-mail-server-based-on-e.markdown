---

title: Automatic routing of electronic mail file attachments to a user directory in a file management system, by a recipient electronic mail server, based on email sender defined processing rules
abstract: Attachments received at an email account are processed according to a processing rule that is selected using, for example, a sender's email address, the sender's domain, or metadata in the email. A feature triggers the processing rule that then removes the attachment from the received email and stores the attachment in a rule-indicated directory. Processing rules can be defined by the email sender or by the email recipient. Changes to the attachment can be synchronized across multiple user devices and user accounts using a file sharing application.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09385980&OS=09385980&RS=09385980
owner: Dropbox, Inc.
number: 09385980
owner_city: San Francisco
owner_country: US
publication_date: 20121221
---
This application claims the benefit of U.S. Provisional Patent Application No. 61 706 622 entitled AUTOMATIC ROUTING OF ELECTRONIC FILE ATTACHMENTS filed on Sep. 27 2012 and which is hereby expressly incorporated herein by reference in its entirety.

The disclosed embodiments relate generally to sharing data over a network using a file management system. In particular the disclosed embodiments are directed to automatically routing electronic file attachments.

Many individuals and businesses have replaced physical mail with email. Attachments to email are often used to communicate information that is sent on a predictable schedule or from an expected correspondent. These attachments are used because they can generally convey complexly structured information e.g. documents spreadsheets presentations videos etc. that cannot be readily communicated in the body of an email. Attachments are also useful for communicating documents produced by business and enterprise systems. This is particularly helpful when presenting a consumer with a bill or invoice for a rendered commercial transaction.

While it can be convenient to send information via an attachment to an email it can be less convenient for the recipient to receive information in this way. The sources of email are legion originating from businesses personal correspondents social media systems advertisers marketers and others. This leads to email accounts receiving enormous amounts of email every day quickly overwhelming the ability of a user to identify those emails having an attachment and requiring a response.

Embodiments of the disclosure include methods and systems for using electronic communication email attachments to transfer files from a sender to a recipient using a file management system rather than directly transferring the file. In one embodiment a file management system is configured to provide users with file directories by which they can upload and share files with other users. The file management system includes a mail server that can receive an email having an attachment the email being sent from a sender to a recipient user user having an account with the file management system. An email attachment manager receives the email from the mail server and is configured to automatically apply an attachment processing rule by which to store the attachment in a target file directory associated with the user of the system. The processing rule is selected according to the metadata associated with the email. In one embodiment each sender provides the attachment processing rule or rules applied to emails it sends to users. Examples of metadata used to trigger a processing rule include the author or sender of the email the domain from which the email is sent tags included in the subject line or body of the email and the file type of the attachment.

Other embodiments include a system and a non transitory computer readable storage medium for processing email attachments in the manner described above. A file management computer system embodiment includes a computer processor a user account database module configured to store a plurality of user directories where each user directory is associated with a user having an account on the file management computer system. An email server module is configured to receive an email having an attachment from an email sender addressed to at least one user having an account on the file management computer system. An email attachment manager module is configured to store processing rules for processing email attachments. The processing rules include sender defined rules provided by at least one email sender. The email attachment manager is further configured to select at least one sender defined processing rule based upon the email sender of the received email and process the email according to selected sender defined processing rule to determine a target directory in the user s account in which to store the attachment included with the email. The email attachment manager then stores the attachment in the determined target directory in the user s account.

The features and advantages described in this summary and the following detailed description are not all inclusive. Many additional features and advantages will be apparent to one of ordinary skill in the art in view of the drawings specification and claims hereof.

The figures depict various embodiments of the present invention for purposes of illustration only. One skilled in the art will readily recognize from the following description that other alternative embodiments of the structures and methods illustrated herein may be employed without departing from the principles of the invention described herein.

The network represents the communication pathway between the sender system the user device and the file management system . In one embodiment the network uses standard Internet communications technologies and or protocols. Thus the network can include links using various communication models such as protocols and standards consistent with the OSI model including various layers such as physical data link network transport session presentation and application layers.

The data exchanged over the network can be represented using any file format including without limitation a wide variety of text document formats audio file formats and image file formats. In addition all or some links can be encrypted using conventional encryption technologies such as the secure sockets layer SSL Secure HTTP HTTPS and or virtual private networks VPNs . In another embodiment the entities can use custom and or dedicated data communications technologies instead of or in addition to the ones described above.

The sender system which includes a mail server is instantiated on a server grade computer system using any appropriate hardware for performing file serving and storage and is used for the distribution of attachments via email to the file management system .

User device is used to access attachments and other stored files in the file management system through the network using a file synchronizing application that is stored as an application on the user device. For purposes of clarity only a single user device is shown but in practice there will be any number of user devices . Examples of user devices include a desktop computer a laptop computer a tablet computing device and a handheld computing device such as a personal digital assistant or a smart phone. Examples of the file sharing application include web browsers or specific applications that access the file management system thereby providing user access to the attachments stored therein. The file sharing application on the client device communicates designated attachments or files to the file management system . The file management system in turn communicates the attachments or files to other user devices not shown either by pushing the attachments to the clients or by enabling the other user devices to pull the attachments from the file management system. The cooperation of the user devices with the file management system thereby permits attachments initially acquired or altered on the user device to be propagated to all user devices in communication with the file management system .

The file management system is generally configured for a user to store files in a directory structure that is persistently represented and synchronized across multiple user devices . Examples of the multiple user devices can include the user s business computer the user s personal computer and the user s smartphone. Files stored to a user s directory are synchronized across those devices associated with the user s file management system account . A user can also share files and directories with other users.

In the context of this disclosure the file management system is configured to receive emails with attachments sent from the mail server of the sender system . As described below the emails and attachments are processed according to processing rules described in more detail in the context of and stored in a directory that is accessible by the user device using the file sharing application . The file management system as well as the sender system is comprised or one or more computers preferably server grade computers including one or more high performance CPUs processors and 1 G or more of main memory as well as 500 Gb to 2 Tb of computer readable persistent storage and running an operating system such as LINUX or variants thereof. The operations of the system as described herein are controlled through both hardware and computer programs executed by the processor s to perform the functions described herein. The system includes other hardware elements used in the operations described here including network interfaces and protocols input devices for data entry and output devices for data presentation that are known to those of skill in the art but not germane to this description and which thus are omitted for clarity. As will be apparent from the following description the operations and processes described herein for the user device and system necessarily require the operation of a computer system and cannot be performed merely as mental steps in the human mind.

In one example to accomplish the above described functions the file management system includes a user account database a file manager an account manager a synchronization manager a mail server and an email attachment manager .

The user account database stores user account credentials and the files and attachments associated with a particular user. The user credentials are used to identify a user account and associate the account with a user. Registering for an account gives users access to the file management system for creating directories and storing files therein. Upon registration users also obtain a specific email address associated with the file management system . This specific email address is used by the user to receive emails at the file management system sent from senders. For example user John Doe may obtain an account and have an associated email JohnDoe fileaccess.com to which senders can direct emails with attachments. In one embodiment the mail server of the file management system is configured so that this associated user email address is used only for receiving emails and attachments and not used for sending emails. However in another embodiment the mail server is configured so that the user can also send emails with an attachment if desired from the file management system in which case the user can access the mail server with a mail client application.

The plurality of directories or folders within a user account are used to store attachments that are included in emails sent to the user. The underlying storage architecture of these directories need not physically correspond to the directories as shown to the user but instead may be implemented to maximize storage efficiency. Storage efficiency can be maximized by for example using various relationship object or key value database architectures thus the structure of the directories can be virtual from the point of view of the user account database even as the directories appear and operate as physical directories when presented to the user on the user device .

The file manager manages the various manipulations of the directories and the files . For example the file manager enables a user or even a sender to create name move and or delete both directories and files . The file manager performs these functions as instructed directly by a user or by the processing rules triggered by receipt of an email as described in more detail below.

The account manager manages the various preferences and permissions for each folder. These preferences and permissions include for example identifying which sender systems are permitted to send emails and attachments to the user account and which user devices are permitted to access the user account. Other preferences include identifying blocked senders and users creating and or tailoring the names of directories nesting various directories and determining when to notify a user of a newly received attachment or file .

The synchronization manager enables files stored within the file management system to be synchronized across multiple user devices using a synchronization application. The synchronization manager enables an attachment received by the file management system to be replicated across multiple user devices . Furthermore upon changing one of the replicated attachments the synchronization manager replicates the change across all copies of the attachment. Provided the appropriate permissions have been granted using the account manager the multiple user devices can even include devices not associated with the user of the user account . This enables multiple parties to receive view and modify an attachment stored on the file management system and have the changed document distributed by the synchronization manager . One embodiment of the synchronization manager is a service commercially known as DROPBOX.

Emails addressed to the user account within the file management system are received by the mail server . The mail server includes any server grade computer operating a mail server application such as MICROSOFT EXCHANGE POP3 SMTP and others. The mail server is in communication with the email attachment manager .

The email attachment manager stores a set of processing rules used to process emails and attachments. When an email with an attachment is received the mail server passes the email to the email attachment manager . In one embodiment emails received without attachments are discarded returned or rerouted. The email attachment manager selects a processing rule by which to process the received email and attachment. Once the processing rule is selected the email attachment manager processes the email and the attachment according to the selected rule in order to store it in a particular user account and target directory . As will be apparent from the following description the operations and processes described herein necessarily require the operation of a computer system and cannot be performed merely as mental steps in the human mind.

The processing module of the email attachment manager performs several functions. Upon notification by the mail server that a new email with an attachment has been received the processing module tests the received email against sender defined processing rules and user defined processing rules . These rules are explained in more detail below. Upon determining the proper rule to apply to the attachment the processing module selects a rule removes the attachment from the email and stores it in the appropriate user account and target directory as indicated by the rule. This process is described below in more detail.

During the execution of a sender defined processing rule the processing module identifies the proper user account to route the processed attachment to by for example using the email address to which the email was sent. The execution of the sender defined processing rule and or the user defined processing rule then identifies the appropriate target directory within the identified user account in which to store the attachment.

Within the processing module processing rules whether sender defined or user defined follow the same general process of a testing the received email for a match with one or more conditions specified in the rule and b upon matching the email with the conditions met storing the attachment in a specified directory of the user account . The conditions are tested using metadata associated with the received email. The processing module selects the appropriate set of processing rules based on the email address and or domain of the sender thereby ensuring that an email from one sender is not processed using the processing rules of a different sender.

As mentioned above two broad categories of processing rules include sender defined processing rules and user defined processing rules . A sender creates sender defined processing rules by using an application programming interface API that is exposed by the email attachment manager . Using the API the sender defines the processing rules which are applied to all emails sent from the mail server of the sender system to the mail server of the file management system to route or store the attachments to within a particular user account in the database . Any number of senders can establish processing rules for use by the file management system .

One useful set of processing rules are those for handling attachments based on the sender s email address or domain of origin. This is particularly useful for senders that provide invoices and monthly billing statements to consumers as email attachments. Generally email addresses from senders take the form of sender name sender domain. Either the sender name or the sender domain portion can be used to define a processing rule. For example a utility company named ABC Utility can define a rule that an email received from the domain abc utility.com and addressed to user X filesystem.com will have its attachment saved to a folder entitled ABC Utility Bills in user X s file directory in the file management system . The benefit of this approach is that a single rule set up by the sender operates to handle all emails sent from the sender to all of its customers users thereby eliminating the need for every individual user to set up a user defined rule in his or her email system. Thus the system administrator for ABC Utility can set up a single rule that will be used to process emails for potentially thousands or even millions of customers without requiring such customers to set up any rules at all.

Sender defined processing rules can specify the target directory to which the attachment is to be stored in several different ways. In one example the target directory is fixed by naming a specific directory e.g. Utility Bills . Or in another example the rule can specify a variable target directory wherein the name of the variable target directory is determined based upon to a tag or other metadata of the email or attachment. In one embodiment of this example the target directory is specified by providing a tag e.g. a keyword in the subject line or body of the email triggering a corresponding rule. That is Annual Summary can be provided in the subject line or body of the email thereby specifying that the attachment be saved in the Annual Summary directory of the user s account. Similarly a keyword used in the file name of the attachment sent can specify the directory e.g. Monthly Statement June as well as using the entire file name. In yet another embodiment of this example the directory is specified by the file type of the attachment. This embodiment uses a lookup relationship to map the file type to a directory e.g. .PDF files are stored in the Acrobat Files directory .doc files are stored in the Word Files directory etc. .

Another way in which the target directory can be specified is through the use of plus addressing. In plus addressing an email address has the form username targetdirectory domain.com. The plus symbol is typically recognized by a mail server as an invalid character in an email address and the following characters are normally ignored. Here the characters following the sign in the email address of the user receiving the email attachment specifies the name of the target directory. A sender may also define multiple target directories in the user s account for storing the attachments.

The processing module determines whether the specified target directory exists in the user account and if not the processing module can create the directory consistent with the sender defined rule and name the directory accordingly and then store the attachment to the directory.

In some embodiments sender defined processing rules are used to set several conditions for example indicating a new directory is to be created within an existing directory for a user account . This can be accomplished for example by using a tag in a subject line of an email or in the body of an email. Examples of tags include a user ID number associated with a service or financial account e.g. a utility customer account a mobile phone number a physical address of the user etc. or a phrase that is expected in the email or attachment. In other embodiments a condition to create a new directory is met using the file type of the attachment or the title of the attachment. In this later case illustrations of expected phrases that trigger processing include annual summary quarterly report and other similar phrases suggesting that a timely response is requested or that the attachment is not one routinely sent. Upon the processing module determining that one of these processing rules is met the processing module can create rename or restructure the directories in the user account . Similarly the sender can set up rules that are based on the file type of the attachment. For example the sender can set up a rule by which PDF files are stored to a directory named Sender s PDF s. Finally the sender can set up rules that select the target directory

The user defined processing rules as with the sender defined processing rules generally have the previously described process of a testing the received email for compliance with a condition and b upon determining that the condition is met storing the attachment in a specified directory . Users can thus save attachments from various senders to a preferred directory by defining a storage path indicating the directory and or sub directories in which the received attachment is to be stored.

The user defined processing rules may also be used to relocate attachments saved according to a sender defined processing rule . For example as an email is tested according to the conditions of a sender defined processing rule the processing module can also test the email for conditions of a user defined rule . For example upon execution of the sender defined processing rule the attachment is first saved in the designated directory. Then the processing module further applies the user defined processing rule in order to relocate the attachment to the user defined directory. In this way the sender defined processing rules still functions as defined but the ultimate location of the attachment is determined by the user rules .

In some cases a sender defined rule and a user defined rule may conflict regarding the proper location in which to save an attachment. For example a sender from given domain may define a rule to store an attachment to a directory named Bills whereas the user may have defined a rule to store attachments in emails from that sender to a directory named Things I have to do . Conflicts such as these can be resolved by the email processing module applying a conflict resolution rule. Examples of these resolution rules include for example preferentially selecting a sender defined rule a user defined rule the most recently entered rule or avoiding the conflict entirely by saving the attachment and at least one duplicate in every location indicated by a rule e.g. saving a copy of the attachment to both the sender defined target directory and the user defined target directory . Another example of avoiding conflicts between rules is to preferentially select rules in a particular order storing the attachment according to the first rule that applies. In one embodiment of this sender defined rules are applied in preference to user defined rules which in turn are applied in preference to a default rule .

Users may relocate attachments from the sender defined directory by moving or copying the attachment to a different user selected directory . Any such relocation can be identified tracked and recorded by the file manager .

The user defined processing rules can also include a default rule in the event that no other sender defined or user defined rules apply or have been created within the processing module . One example of a default processing rule is a rule instructing that any received attachments are placed in a New Attachments directory within the user account .

At some point subsequent to the creation of the processing rules the sender sends an email with an attachment to the user. Upon receipt of the email at the email server and subsequent transfer to the email attachment manager the attachment manager may execute preliminary system rules testing the validity of the received email. Some example preliminary rules include determining whether the email includes an attachment or not whether the recipient email address is valid and whether the sender system from which the email originates is authorized to provide emails to the user. Other preliminary rules can include the execution of spam filters anti virus protocols and other security features. Should any of these preliminary rules identify a fault in the received email the email can be rejected and a non delivery notice provided to the sender.

Upon execution of the preliminary rules the email attachment manager determines the sender of the email and the recipient of the email. Either or both the sender and the recipient are used as a first step in the process of determining the rule or rules to apply to the attachment in order to save the attachment to a directory within the user account . Upon determining the sender and the recipient of the email the email attachment manager identifies the processing rules corresponding to the sender and optionally the recipient. As described above the rules can be sender defined or user defined. Upon identifying the various rules for the sender and optionally the recipient the email attachment manager reads the metadata in the email and tests the metadata against the identified rules in order to determine which of the identified rules to apply to appropriately store the email. As described above a rule can be triggered by the sender s email address domain the title of the attachment the type of attachment a tag in the subject line or body of the email the user s email address and other criteria. As also mentioned above the email attachment manager can apply sender defined rules in preference to user defined rules or vice versa in order to avoid conflicts or resolve conflict rules according to any of a variety of methods.

Once the appropriate rule is determined the email attachment manager identifies the appropriate directory and determines whether the directory already is present within the user account . If the directory is already present then the email attachment manager stores the attachment in the directory . If the directory is not already present the email attachment manager automatically creates a directory in order to store the attachment according to the rule or stores the attachment in a default directory. Once the file is stored to the directory the user can access the file edit it and share it with other users using the file sharing application which then synchronizes the received attachments to such other user s devices.

However in some cases a sender may send an email having an attachment to the recipient user without the sender having previously defined a processing rule . In these cases the processing module determines whether any user defined processing rules can be used to store the attachment in a directory of the user account . In the absence of a user defined processing rule the processing module stores the attachment in a default folder of the recipient user that can be designed either by the email attachment manager or by the user. If the user has defined at least one rule the processing module applies the rule to test the email for the compliance with a condition and stores the attachment in a directory contingent upon the condition as described above. For cases in which multiple user defined rules conflict the conflict can be resolved using some or all of the previously described resolution protocols.

The disclosure herein has been described in particular detail with respect certain embodiments of the invention. Those of skill in the art will appreciate that other embodiments may be practiced and that various changes in form and details can be made therein without departing from the spirit and scope of the invention.

First it should be noted that the language used in the specification has been principally selected for readability and instructional purposes and may not have been selected to delineate or circumscribe the inventive subject matter. Thus the particular naming of the components and variables capitalization of terms the attributes data structures or any other programming or structural aspect is not mandatory or significant and the mechanisms that implement the invention or its features may have different names formats or protocols. Also the particular division of functionality between the various system components described herein is merely exemplary and not mandatory functions performed by a single system component may instead be performed by multiple components and functions performed by multiple components may instead performed by a single component.

Second portions of above description present features in terms of algorithms and symbolic representations of operations on information. These algorithmic descriptions and representations are the means used by those skilled in the data processing arts to most effectively convey the substance of their work to others skilled in the art. These operations while described functionally or logically are understood to be implemented by computer programs. Furthermore it has also proven convenient at times to refer to these arrangements of operations as modules or by functional names without loss of generality.

Third reference to one embodiment or to an embodiment means that a particular feature structure or characteristic described in connection with the embodiments is included in at least one embodiment. The appearances of the phrase in one embodiment in various places in the specification are not necessarily all referring to the same embodiment.

As set forth above the file management system is embodied in a computer system. This computer system may be specially constructed for the required purposes or it may comprise a general purpose computer selectively activated or reconfigured by one or more computer programs stored in the computer system. Such computer programs may be stored in a non transitory computer readable storage medium such as but is not limited to any type of disk including floppy disks optical disks CD ROMs magnetic optical disks read only memories ROMs random access memories RAMs EPROMs EEPROMs magnetic or optical cards application specific integrated circuits ASICs or any type of media suitable for storing electronic instructions and each coupled to a computer system bus accessible by one or processors. Accordingly unless expressly stated otherwise it is understood that throughout the description terms such as determining processing selecting accessing or the like refer to the action and processes of a computer system or similar electronic computing device that manipulates and transforms data represented as physical electronic quantities within the computer system memories or registers or other such information storage transmission or display devices and do not refer to mental steps made by a human being.

Finally the embodiments disclosed herein are well suited to a wide variety of computer network systems over numerous topologies. Within this field the configuration and management of large networks comprise storage devices and computers that are communicatively coupled to dissimilar computers and storage devices over a network such as the Internet.

Accordingly the disclosure herein is intended to be illustrative but not limiting of the scope of the invention which is set forth in the following claims.

