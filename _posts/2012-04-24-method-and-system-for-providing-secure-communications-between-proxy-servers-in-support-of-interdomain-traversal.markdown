---

title: Method and system for providing secure communications between proxy servers in support of interdomain traversal
abstract: An approach provides interdomain traversal to support packetized voice transmissions. A request is received and specifies a directory number for establishing a communication session from a first endpoint to a second endpoint. The first endpoint is behind a first network address translator of a first domain, and the second endpoint is within a second domain. A service provider network is accessed to determine a network address for communicating with the second endpoint based on the directory number, to determine existence of a second network address translator within the second domain, and to establish, if the network address can be determined, a media path between the first endpoint and the second endpoint based on the network address to support the communication session. An encrypted session is established with a proxy server according to a cryptographic protocol to support the media path. The proxy server resides within the second domain.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08948200&OS=08948200&RS=08948200
owner: Verizon Patent and Licensing Inc.
number: 08948200
owner_city: Basking Ridge
owner_country: US
publication_date: 20120424
---
This application is a continuation of U.S. patent application Ser. No. 11 323 863 filed Dec. 30 2005 which is related to and claims the benefit of the earlier filing date under 35 U.S.C. 119 e of U.S. Provisional Patent Application Ser. No. 60 700 949 filed Jul. 20 2005 entitled Security for an Inter Domain VoIP Communications Network the entirety of which is incorporated herein by reference.

The present invention according to various embodiments relates to communications and more particularly to transmitting a packetized voice call across different domains.

Internet Protocol IP telephony has changed the business model and engineering approaches of how voice services are provisioned and delivered. The attractive economics of IP telephony stemming largely from the global connectivity and accessibility of the Internet along with innovative productivity tools for users have triggered adoption of this technology by numerous businesses organizations enterprises and the like. Unfortunately this adoption primarily has been uncoordinated and driven by the needs of the specific enterprise little regard to a global approach for IP telephony deployment. Interestingly the prevailing IP telephony implementations have confined the particular enterprises as to make communications outside the enterprise difficult and impractical. Moreover security concerns are an impediment to wide spread deployment of IP telephony systems.

As enterprises implement Internet telephony as well as messaging systems and associated applications closed communities of IP enabled users are created i.e. IP islands . That is because of systems and applications constraints and incompatibilities these IP enable users are isolated and thus cannot readily communicate with each other. Moreover as Internet Service Providers ISPs cable and mobile network operators begin to provide Internet telephony services. The IP islands grow even larger into a constellation of non connected communities. While such communities can in some cases be linked using the Public Switched Telephone Network PSTN the benefits of IP telephony e.g. user presence unified communications user preference and lower costs may be sacrificed.

Unlike the PSTN in which users and carriers are easily reachable by anyone on the network IP telephony is subject to several constraints. First users are required to have knowledge of whether an IP endpoint is available if the full capabilities of IP telephony are to be realized. Also the knowledge of whether there are multiple IP enabled devices is being used by the called party as well as how to reach such devices is needed. Another constraint is that a single IP telephone number is not available among the various IP enabled devices instead these devices utilize diverse and complex addresses. Additionally determining the identity of the calling party e.g. caller ID is an important function. Further IP networks are vulnerable to a variety of security threats which are non existent in circuit switched telephony networks.

Based on the foregoing there is a clear need for an approach that facilitates securely bridging of the IP islands thereby enabling greater deployment of IP telephony. There is also a need for a mechanism to ensure compatibility and coordination of IP telephony services among service providers. There is a further need for an approach to exploit the full capabilities of Internet telephony technologies.

These and other needs are addressed by the present invention in which an approach for performing network based packetized voice call processing is provided.

According to one aspect of the present invention a method for providing packetized communication services is disclosed. The method includes receiving a request specifying a directory number for establishing a communication session from a first endpoint to a second endpoint wherein the first endpoint is behind a first network address translator of a first domain and the second endpoint is within a second domain. The method also includes communicating with a service provider network to determine a network address for communicating with the second endpoint based on the directory number to determine existence of a second network address translator within the second domain and to establish if the network address can be determined a media path between the first endpoint and the second endpoint based on the network address to support the communication session. Further the method includes establishing an encrypted session with a proxy server according to a cryptographic protocol to support the media path the proxy server residing within the second domain.

According to another aspect of the present invention a network apparatus for supporting managed communication services is disclosed. The apparatus includes a first communication interface configured to receive a request specifying a directory number for establishing a communication session from a first endpoint to a second endpoint wherein the first endpoint is behind a first network address translator of a first domain and the second endpoint is within a second domain. Additionally the apparatus includes a second communication interface configured to communicate with a service provider network to determine a network address for communicating with the second endpoint based on the directory number to determine existence of a second network address translator within the second domain and to establish if the network address can be determined a media path between the first endpoint and the second endpoint based on the network address to support the communication session. Further the apparatus includes a processor configured to establish an encrypted session with a proxy server according to a cryptographic protocol to support the media path the proxy server residing within the second domain.

According to another aspect of the present invention a system for providing managed communication services is disclosed. The system includes an address server configured to receive a request for a network address for communicating with a destination endpoint based on a directory number wherein the directory number is specified in a call establishment request to establish a communication session from a source endpoint behind a first network address translator of a first domain and the destination endpoint is within a second domain. The system also includes a STUN Simple Traversal of UDP User Datagram Protocol server configured to support determination of existence of a second network address translator within the second domain. Additionally the system includes a TURN Traversal Using Relay NAT Network Address Translation server configured to establish if the network address can be determined a media path between the source endpoint and the destination endpoint based on the network address to support the communication session. The media path includes an encrypted session between a first proxy server residing within the first domain and a second proxy server residing within the second domain.

According to yet another aspect of the present invention a method for providing packetized communication services is disclosed. The method includes transmitting a request to a near end proxy server for establishing a communication session with a destination endpoint wherein the request is transmitted through a first network address translator of a first domain and the destination endpoint is within a second domain. The near end proxy server is configured communicate with a service provider network to determine a network address for communicating with the second endpoint based on the directory number to determine existence of a second network address translator within the second domain and to establish if the network address can be determined a media path with the destination endpoint based on the network address to support the communication session. Further the method includes establishing an encrypted session with the near end proxy server according to a cryptographic protocol to support the media path.

Still other aspects features and advantages of the present invention are readily apparent from the following detailed description simply by illustrating a number of particular embodiments and implementations including the best mode contemplated for carrying out the present invention. The present invention is also capable of other and different embodiments and its several details can be modified in various obvious respects all without departing from the spirit and scope of the present invention. Accordingly the drawings and description are to be regarded as illustrative in nature and not as restrictive.

An apparatus method and software for providing interdomain traversal to support secure packetized voice transmissions are described. In the following description for the purposes of explanation numerous specific details are set forth in order to provide a thorough understanding of the present invention. It is apparent however to one skilled in the art that the present invention may be practiced without these specific details or with an equivalent arrangement. In other instances well known structures and devices are shown in block diagram form in order to avoid unnecessarily obscuring the present invention.

Although the various embodiments of the present invention are described with respect to the Internet Protocol IP based voice sessions it is contemplated that these embodiments have applicability to other communication protocols.

It is recognized that development of new Internet technologies has enabled creation of new communication services. As a result strictly traditional communication services over the Public Switched Telephone Network PSTN are becoming less attractive economically and functionally. Coincident with greater accessibility to the constellation of IP endpoints e.g. VoIP IM users across enterprise carrier ISP and wireless networks it is recognized that new features for enhancing the IP calling experience can be developed. In various embodiments the term endpoint represents a node station or application that can receive and or initiate a communication session.

The approach according to an embodiment of the present invention provides seamless Internet interconnect between enterprise IP islands and management of the routing and services offered between such islands. Also the approach supports traffic between IP enabled Private Branch Exchange PBX systems and endpoints e.g. Session Initiation Protocol SIP clients over the global Internet and IP islands of other service providers e.g. cable operators Internet Service Providers ISPs Virtual VoIP service providers etc.

The IP interconnect service system according to one embodiment of the present invention encompasses the following functional components a discovery component an identity component a signaling conversion component and a Network Address Translation NAT Firewall traversal component . As used herein the terms Network Address Translation or Network Address Translator are used synonymously. These functional components or modules provide a capability for enabling connectivity for multiple IP telephony networks behind NAT and or firewalls . The system thus provides for interdomain traversal across these NAT and or firewalls 

Firewalls provide security for interfacing with another network e.g. an untrusted network . It is noted that a private network e.g. enterprise network having connectivity to external network such as public data network e.g. the Internet can be subjected to various security risks. Firewalls can be implemented as hardware and or software to prevent unauthorized access to the private network. Firewalls monitor incoming and outgoing traffic and filters or blocks such traffic according to certain rules and policies. A firewall can employ various techniques to filter traffic e.g. packet or flow filtering examines packets to ensure specified requirements are met with respect to the characteristics of the packet or flow . Hence the process only allows packets satisfying such requirements to pass. These requirements can be based on network addresses ports or whether the traffic is ingress or egress etc.

Network Address Translation NAT performs translation between private network addresses and public network addresses i.e. providing private address to public address binding. This binding can be static or dynamic. In the context of security and firewalls NAT can hide a set of host addresses on the private network behind a pool of public addresses. In this manner external networks cannot see internal addresses and thereby prevent establishment of connections not originating from the private network. The pool can be one or more network addresses or can be a range of network addresses e.g. a set of contiguous network addresses . The NAT can also specify a port range to restrict port translation. NAT is further detailed in RFC 3022 which is incorporated herein by reference in its entirety.

As indicated discovery plays an important part in providing the bridging service to IP enabled islands. The discovery query can be accomplished using a DNS Domain Name Service query ENUM or via a SIP query Redirect server . While this discovery mechanism is most useful between islands for the sake of simplicity this mechanism can be used for all requests even those within an island. Once IP enabled island discovery is complete identity is the next concern.

A cryptographically secure identity mechanism or service can prevent for example spam problems confronting email systems. In addition the identity service provides a Caller ID service on the Internet.

As regard signaling conversion in some cases IP enabled islands are unable to communicate due to different signaling protocols e.g. Session Initiation Protocol SIP vs. H.323 or protocol incompatibilities e.g. stemming from different versions of SIP . The IP interconnect service provides signaling conversion for all common protocols e.g. SIP and H.323 versions and dialects. This service can be provided in an exemplary embodiment via a SIP proxy service.

By way of example the system utilizes IP telephony signaling that includes for example the H.323 protocol and the Session Initiation Protocol SIP . The H.323 protocol which is promulgated by the International Telecommunication Union ITU specifies a suite of protocols for multimedia communication. SIP is a competing standard that has been developed by the Internet Engineering Task Force IETF . SIP is a signaling protocol that is based on a client server model. It should be noted that both the H.323 protocol and SIP are not limited to IP telephony applications but have applicability to multimedia services in general. In an embodiment of the present invention SIP is used to create and terminate voice calls over an IP network. However it is understood that one of ordinary skill in the art would realize that the International Telecommunications Union ITU H.323 protocol suite and similar protocols can be utilized in lieu of SIP.

The IP interconnect service enables the creation of innovative IP based services that add value to the user beyond Internet calling by defining powerful call preference capabilities. Within the service Voice over IP VoIP Instant Messaging IM conferencing collaboration and other IP communication services are supported.

According to one embodiment of the present invention the service provider system offers an open managed service for the interdomain traversal. This approach contrasts with the traditional traversal which is controlled by supernoding other users or session border controllers in one domain or the other. Interdomain traversal supports establishing a peer to peer communication session between two distinct virtual locations or domains separated by firewalls and or NATs . Procession of call flows managed service enables the interdomain traversal ENUM Service. Interdomain traversal involves communicating between a device in one administrative domain and another device in a different administrative domain . It is noted that these domains and can represent enterprise networks or autonomous networks.

In an exemplary embodiment a SIP proxy server e.g. servers and maintains registration for all users in its domain as well as directory numbers i.e. telephone numbers for them. Upon receiving a request for the directory number if the SIP proxy server determines that number does not correspond to one of registered users the SIP proxy server queries the ENUM server to obtain the requested number.

In an exemplary embodiment the system supports customization of components and processes to enable procession of call flows managed service these components include the client e.g. and SIP proxy server and TURN server . The SIP proxy server maintains the user ID s along with their assigned telephone numbers. A registry not shown contains identifiers including aliases and associated telephone numbers. The SIP proxy server can be configured with routing rules. For example the SIP proxy server may require looking through the list of registry first before querying the ENUM server . If found in the ENUM server the URI corresponding to the telephone number is obtained from the server . The URI can be utilized for the INVITE onto the appropriate SIP proxy server e.g. for that domain e.g. . The registry of aliases and associated telephone numbers can be maintained locally to minimize querying the ENUM server . Essentially the contact information from the ENUM server is cached for subsequent use thereby minimizing network traffic and processor loads on the ENUM server . With respect to the client configuration is made so that the client knows the location of the TURN server . By way of example by default the client can be configured to try to communicate with the SIP proxy server or session border controller.

Providing the TURN server as a managed service involves setting up credentials for users. The SIP proxy server can maintain credentials for users and be managed by an enterprise. In managed service network i.e. cloud of the service provider credential pairs are utilized as enterprise users may not want SIP User credentials to be managed by the service provider.

The Traversal Using Relay NAT TURN protocol permits an element behind a NAT and or firewall to receive incoming data over Transmission Control Protocol TCP or User Datagram Protocol UDP connections. That is the network element within the private network can be on the receiving end rather than the sending end of a connection that is requested by the host.

STUN is a lightweight protocol that allows applications to discover the presence and types of Network Address Translators and firewalls between them and the public Internet. This protocol also provides the ability for applications to determine the public IP addresses allocated to them by the NAT. STUN allows a wide variety of applications to work through existing NAT infrastructure.

According to various embodiments of the present invention the IP interconnect service employs standards based ENUM and SIP services. The functional structure of the IP interconnect is compatible with for example the Internet DNS and infrastructure domain e164.arpa so that future number records migration can be performed seamlessly coincident with public ENUM deployment.

ENUM provides translation of telephone numbers e.g. E.164 into Uniform Resource Identifiers URIs thereby communication with an IP endpoint. It is noted that ENUM is protocol agnostic because it is application agnostic and thus operates with either H.323 or SIP.

ENUM is a protocol that resolves fully qualified telephone numbers e.g. E.164 to fully qualified domain name addresses using a Domain Name System DNS based architecture. The protocol as defined in RFC 2916 uses the DNS for storage of E.164 numbers and supports services associated with an E.164 number. E.164 refers to the international telephone numbering plan administered by the International Telecommunication Union ITU . E.164 specifies the format structure and administrative hierarchy of telephone numbers. A fully qualified E.164 number is designated by a country code an area or city code and a phone number.

The translation of a telephone number into an Internet address proceeds as follows. A fully qualified number has the form 1 234 567 8910. First non numerical characters are removed 12345678910. Next the order of these digits are reversed 01987654321. Thereafter decimal points are introduced between the digits resulting in 0.1.9.8.7.6.5.4.3.2.1 and the domain e164.arpa is appended. This yields 0.1.9.8.7.6.5.4.3.2.1. e164.arpa. The .arpa domain has been designated for Internet infrastructure purposes. Based on this address the ENUM protocol issues a DNS query and retrieves the appropriate NAPTR Naming Authority Pointer Resource records which contain information about what resources services and applications are associated with a specific phone number. These services are determined by the subscriber.

By way of example the system ensures communication between different IP telephony networks which reside in different administrative domains and over a public data network such as the global Internet. The network within domain includes a firewall for interfacing the public data network . Behind the firewall is a NAT that serves a variety of endpoints capable of supporting IP telephony e.g. a web phone and a so called soft phone . The network also utilizes a proxy server for supporting packetized voice calls which in this example is compatible with SIP.

As regard the network a firewall resides between the network and the pubic data network . A NAT serves a soft phone and one or more SIP phones . The network also includes a SIP proxy server

As shown the Internet communicates with a circuit switched telephone network such as the PSTN through a gateway . Under this scenario the PSTN supports cellular capable devices e.g. cellular phones as well as POTS Plain Old Telephone Service phones .

It is recognized that signaling information for establishment of packetized voice calls are susceptible to tapping. Each link of the communication is vulnerable to hackers for example a communication session in the example of involves a call setup between the soft phone and one of the SIP phones via the SIP proxy server of the domain and the SIP proxy server of the domain . With respect to the soft phone and the SIP proxy server during registration a hacker can attempt to intercept i.e. tapping a registration message between these two entities and and utilize the information to place calls utilizing the identity and credentials of the soft phone . Tapping can also occur in the link between the proxy servers and such that the hacker can intercept a SIP Invite message and determine the RTP traffic pattern. The hacker can also tap signaling retry messages. Namely upon a subsequent attempt to establish a call the hacker taps the signaling information and can imitate the address of the soft phone assuming the soft phone is attempting to establish the call to the SIP phone . Specifically the hacker can resend Invite messages to the proxy server after learning the address of the soft phone thereby spoofing the original address. Hence the hacker is able to impersonate the soft phone by overriding the original registration. Based on these potential threats an approach as shown in is provided for encrypting the signaling links involved with the call establishment.

Accordingly in the system of the communications among the endpoints e.g. soft phone and SIP phones can be encrypted using cryptographic protocols. That is the communication session can include encrypted media. For instance an encrypted session can be established from between the SIP proxy server and the SIP proxy server . Furthermore the encrypted communication can extend end to end wherein the soft phone supports an encrypted session with the SIP proxy server and the SIP phone establishes an encrypted session with the SIP proxy server . These encrypted sessions and according to various embodiments are created per the processes depicted in flowcharts of .

Similarly continuing with the above example the soft phone and the SIP can execute a peer negotiation phase a key exchange phase and a traffic encryption phase .

The Transport Layer Security TLS Protocol provides privacy and data integrity between two applications and has two layers the TLS Record Protocol and the TLS Handshake Protocol. The TLS Record Protocol resides on top of a reliable transport protocol such as TCP. The TLS Record Protocol provides connection security. Symmetric cryptography is used for data encryption DES RC4 etc. the keys are generated uniquely for each connection and are based on a secret negotiated by another protocol such as the TLS Handshake Protocol . The Record Protocol can also be used without encryption. The message transport includes a message integrity check using a keyed Medium Access Control MAC wherein secure hash functions e.g. SHA MD5 etc. are used for MAC computations. The TLS Record Protocol provides encapsulation of various higher level protocols such as the TLS Handshake Protocol. The TLS Handshake Protocol allows the server and client to authenticate each other and to negotiate an encryption algorithm and cryptographic keys before the application protocol transmits or receives its first byte of data.

The TLS protocol is detailed in RFCs 2246 and 3546 which are incorporated herein by reference in their entireties this security protocol is formerly known as the Secure Sockets Layer SSL . Although SSL TLS is discussed in the various embodiments of the present invention it is recognized that other equivalent cryptographic protocols can be employed.

The Media Relay Server and two user agents UAs in either domain pass each other information about their environment. Such information can include external firewalls internal IP addresses and support information.

The ENUM DNS Root server provides a combined Tier Tier ENUM root functionality. Because country codes may not be generally available the service provider can host its own ENUM tree this can be structured in a similar way to the e164.arpa tree. According to one embodiment of the present invention this root server supplies DDOS Distributed Denial of Service protection. According to an embodiment of the present invention the ENUM DNS Root server provides ENUM services according to RFC 3761 and RFC 2916 which are both incorporated herein by reference in their entireties.

The ENUM DNS Tier server is the DNS functionality that contains actual DNS NAPTR records e.g. one per telephone number. It is noted that only E.164 global telephone numbers are used no private numbers. These records are created and backed up by an administrative system that will tie into the order entry and billing systems as later described with respect to . It is assumed that entries are authorized and validated using various mechanisms which can include known authorization and validation standards. The NAPTR records can be queried by any IP enabled endpoint or island on the Internet regardless of whether they are an IP interconnect customer or not. In this way the discovery service mimics that of the public ENUM.

The ENUM DNS Tier server in an exemplary embodiment utilizes existing DNS server farms to implement the ENUM Tier functionality. A provisioning system such as that of can collect the telephone number to URI mapping information from the IP interconnect customers and automatically generate the NAPTR records. As Public ENUM is deployed the service provider can become a Tier provider in each country code. The provisioning interface can then be adapted to interface with each Tier function. According to an embodiment of the present invention the ENUM DNS Tier server provides ENUM services according to RFC 3761 as well as RFCs 3762 and 3764 which are incorporated herein by reference in their entireties .

The ENUM SIP redirect server behaves as a SIP redirect server by accepting SIP requests and responding with a 3xx class response for example. According one embodiment of the present invention this redirect server has a built in ENUM resolver and queries the ENUM Tier Server using DNS. That is the server can perform ENUM queries for IP enabled endpoints or islands that do not have an ENUM resolver the resolver takes a telephone number performs a DNS query and returns a set of Uniform Resource Identifiers URIs . For instance the ENUM Redirect server accepts a SIP request such as INVITE SUBSCRIBE or even other methods such as OPTIONS performs an ENUM query on the telephone number in the Request URI and returns a redirect response Moved Temporarily or Multiple Choices containing Contact header fields with each resolved URI.

For the purposes of explanation the Request URI can be a tel URI tel 13145551234 or a SIP URI with a telephone number in the user part sip 458320923 mci.com user phone . The telephone number in an exemplary embodiment is in E.164 global format. If an endpoint is not able to generate requests in this format the SIP to SIP Gateway service can be used to generate this format. The time to live TTL information in the ENUM record are translated into an expires parameter for each URI. It is noted that non SIP URIs may be returned. The resulting set of URIs are mapped into SIP Contact header fields and returned.

If a single URI is returned it can be done so in a Moved Temporarily response. If multiple URIs are to be returned a Multiple Choices response is returned. Other SIP elements such as the Proxy Authentication Server H.323 to SIP Gateway and SIP to SIP Gateway all interact with the ENUM Redirect server using standard SIP messages. It is noted that the ENUM Redirect server does not perform any resolution on the URIs from the ENUM query they are passed unchanged in the redirect response. If the ENUM query fails to return any URIs the ENUM Redirect server returns a single tel URI representing the telephone number in the Request URI. If the Request URI does not contain a valid E.164 telephone number the server returns a Not Found response.

The Proxy Authentication Server is the SIP edge of the IP interconnect service. The Proxy Authentication Server has two key functions authentication and proxying requests. The authentication function can be provided on behalf of other elements in the architecture such as the ENUM Redirect server .

The authentication method is determined by the type of security on the link from the service provider to IP interconnect. If the SIP request arrives over a Transport Layer Security TLS connection the certificate provided may be use for authentication. The certificate may be one issued by the Certificate Authority CA Store or it may be one issued by another CA. If the SIP request comes in over a Virtual Private Network VPN or IPSec IP Security then the use of the private key provides authentication. Otherwise the request receives a SIP Digest challenge in the form of a Proxy Authentication Required response containing a one time nonce.

The Proxy Authentication Server compares the re sent request with the MD5 hash of the shared secret to the shared secret retrieved from the AAA server . A match provides authentication. An authorization failure will result in a Forbidden response being sent.

Once authentication has succeeded the Proxy Authentication Server can provide identity services as described in . Before any identity services are performed the From header URI is compared to a list of valid identities for the authenticated party. It is noted that this scope will typically be restricted to the domains of record host part not user part and telephone numbers in tel URIs. If the From identity is valid identity services may be performed. If it is not valid a Invalid From Identity response is returned and no further services are rendered.

It is noted that the presence of a Privacy header field in the request may override the normal identity assertion rules. However the IP interconnect service does not provide complete IP privacy by itself although using TURN it may be possible for an endpoint to establish a truly private IP session.

According to one embodiment of the present invention the following identity options are provided Authenticated Identity Body AIB P Asserted Identity and Identity. The particular method that is requested is based on the authenticated user s service profile. In addition a user s profile will indicate the default server option to proxy or redirect. Alternatively SIP caller preferences can be used to indicate which mode of operation is desired on a request by request basis.

For the AIB method the Proxy Authentication Server generates an Authenticated Identity Body AIB and returns it in a Moved Temporarily response. The AIB is signed by the Proxy Authentication Server using the IP interconnect private key. The resulting request is then retried by the user with the AIB included as a message body. The AIB method is used in a redirect mode.

For the P Asserted Identity method the Proxy Authentication Server generates the P Asserted Identity header field possibly using the P Preferred Identity header field if multiple identities are valid. The P Asserted Identity method is used in proxy mode. An additional requirement on P Asserted Identity is the use of an integrity protected SIP connection from the Proxy Authentication Server and the next hop effectively this means TLS transport or the use of VPN or IPSec tunnel . If integrity protection is not available no P Asserted Identity service can be provided.

For the Identity method the Proxy Authentication Server generates an Identity header field and either returns it in a redirect or proxies the request. The Identity method can be used in either proxy or redirect mode. In proxy mode the Proxy Authentication Server performs DNS resolution on the Request URI according to normal SIP DNS rules and prepares to proxy the request.

The Proxy Authentication Server has SIP interfaces to the ENUM Redirect server the H.323 to SIP gateway and the SIP to SIP gateway . Authentication can be performed according to an exemplary embodiment using normal SIP mechanisms such as SIP Digest challenge certificate validation or symmetric key encryption e.g. IPSec or VPN . Credentials are verified in a AAA database using the RADIUS protocol.

Additionally the Proxy Authentication Server can serve as one or more SIP servers and or soft switches .

The Authentication Authorization and Accounting AAA Server provides various service specific information such as credentials preferences and service options. The AAA server stores the shared secrets usernames passwords of IP interconnect customers. This server is accessed by other elements using RADIUS e.g. the Proxy Authentication Server SIP to H.323 Gateway SIP to SIP gateway and TURN Servers. SIP AAA functions are further detailed in RFC 3702 which is incorporated herein by reference in its entirety.

The Certificate Store Authority server hosts and allocates certificates to IP enabled endpoints or islands. The certificates can be stored locally on the respective islands or can be stored in the network. The Certificate Authority CA Store provides certificate creation management revocation storage and distribution. The certificates can be either self signed certificates suitable for individual SIP endpoints to use for Secure Multipurpose Internet Mail Extensions S MIME or SRTP Secure Real time Transport Protocol or certificates issued by the IP interconnect CA. By way of example the certificates can be fetched using TLS SIP and HyperText Transfer Protocol HTTP based mechanisms. The Certificate Authority functionality provides limited SIP identity assertions and thus provides a more cost effective approach than conventional Verisign type e commerce certificates.

In addition the Proxy Authentication Server uses the Certificate Authority Store to retrieve and verify certificates of customers.

The H.323 to SIP gateway in this example provides conversion between H.323 and SIP. According to one embodiment of the present invention This gateway can serve an IP PBX . To the SIP network the gateway appears as a SIP User Agent while appearing as a H.323 Gatekeeper to a H.323 network. Normal H.323 authentication mechanisms can be used.

Under the scenario of a SIP to SIP gateway for converting incompatible SIP dialects to for example the standard RFC 3261 SIP. Some typical broken SIP issues include incorrect use of To From tags malformed header fields and bodies nonstandard methods nonstandard DTMF transport methods multipart Multipurpose Internet Mail Extensions MIME handling issues e.g. SIP T Session Initiation Protocol for Telephones proprietary authentication schemes transport protocol incompatibilities improper Record Route and proxy routing behavior and IPv6 to IPv4 mapping.

The SIP to SIP gateway acts as transparently as possible when serving IP PBX for example. The SIP to SIP gateway also provides the authentication function and support some additional authentication schemes. According to an embodiment of the present invention credentials are verified in a AAA database using the RADIUS protocol. This protocol can be embedded in various network elements routers modem servers switches etc. RADIUS facilitates centralized user administration which is important in large networks having significant number of users. Additionally these users are continually being added and deleted resulting in constant flux of authentication information . RADIUS is described in Internet Engineering Task Force IETF Request For Comment RFC 2865 entitled Remote Authentication Dial In User Service RADIUS June 2000 which is incorporated herein by reference in its entirety.

The SIP Network based NAT Traversal function performs the necessary signaling to support network based NAT traversal by invoking a media relay function e.g. TURN or RTP proxy for sessions that would otherwise fail. According to an embodiment of the present invention only islands provisioned for this service can utilize this function. Network based NAT traversal is provided when the island does not manage this function internally. When a media relay is required the SIP to SIP gateway invokes one from the Media Relay function and modify the SIP signaling messages appropriately. In addition to TURN other protocols can be used between the SIP to SIP gateway and the Media Relay .

It is noted that this SIP Network based NAT Traversal function is transparent to islands using STUN and TURN this appears as if no NAT is present and hence no action is taken. The NAT traversal functionality can be provisioned for a given island rather than dynamically detected. This is because the dynamic detection of NATs requires registration data which is generally not available from islands.

The Simple Traversal of UDP through NAT STUN Server provides endpoint based NAT discovery and characterization. A STUN enabled endpoint can traverse most NAT types without relying on network based detection and fixing. An endpoint can determine the type of NAT e.g. full cone restricted cone or symmetric and discover and maintain bindings between private and public IP addresses. For an endpoint the combination of STUN and TURN usage as described in the ICE Interactivity Communication Establishment protocol provides complete endpoint based NAT traversal.

It is noted that the STUN server does not authenticate users largely because the resources used are trivial as it is essentially just a type of ping server. As a result no AAA or provisioning tie in is necessary. STUN server discovery can be provided using DNS SRV lookups on the domain used by the IP interconnect service. The STUN functions are further detailed in RFC 3489 which is incorporated herein by reference in its entirety.

The Media Relay function provides the relay functionality needed in certain NAT and firewall traversal scenarios. This function is provided using both TURN Traversal Using Relay NAT Server for endpoint enabled traversal and RTP proxies for network based relay . Authentication is performed using SIP Digest credentials and accessed using RADIUS from the AAA server . In an exemplary embodiment the Media Relay function provides RTP and Real Time Control Protocol RTCP relay functionality for NAT and firewall traversal.

According to one embodiment of the present invention the Media Relay function is decentralized and distributed throughout the service provider s IP backbone. In addition some optimal Media Relay selection algorithms can be used. In the alternative centrally deployed media relays can be utilized if a distributed architecture cannot be achieved. The architecture supports both network invoked and endpoint invoked media relay functionality. As such a standards based protocol such as TURN is used. Media Relays are a significant network resource as such they must authenticate and account for usage. Because the TURN function supports reuse of existing SIP Digest credentials the TURN servers are able to access the AAA Servers e.g. server .

The SOA IT Server provides the back office functions necessary to provide the Interconnect service. That is the SOA IT has components that provide the Operational Support System OSS functions needed to run and support the IP interconnect product offering as a revenue generating business. According to one embodiment of the present invention the SOA IT components include both customer facing systems e.g. enabling customer self service and back office systems. The SOA IT components largely concentrate on the so called F A B broad functional areas Fulfillment Assurance and Billing as well as ensuring that such functions are compliant with regulatory reporting requirements. Such functions are more fully described with respect to .

The described IP interconnect services involve the interaction of SIP STUN and TURN protocols to support IP telephony. This interaction is explained in the call flows of in the context of .

In step the endpoint submits an INVITE message to the SIP proxy server which replies with a 100 Trying message step .

At this point the proxy server determines that the URI of the destination endpoint needs to be determined. Accordingly the SIP proxy server submits a DNS query to the ENUM server which responds with the appropriate NAPTR record steps and .

Next the SIP proxy server sends the INVITE message to the SIP proxy server of the destination network step . The SIP proxy server forwards the INVITE message to the destination endpoint per step .

The endpoint then sends a 180 Ringing message as in step to the SIP proxy server which relays the message to the SIP proxy server step . Thereafter the Ringing message is transmitted per step to the source endpoint

In step the endpoint generates a 200 OK message forwarding the message to the SIP proxy server . In step this 200 OK message is relayed by the SIP proxy server to the other SIP proxy server . Thereafter the 200 OK message is forwarded by the SIP proxy server to the source endpoint as in step . The endpoint acknowledges the SIP proxy server with an ACK message step . The SIP proxy server sends the ACK message to the destination endpoint through the SIP proxy server steps and . In step the endpoints and now can exchange media via the TURN server .

In step the endpoint sends an INVITE message to the SIP proxy server . The server then replies with a Trying message step .

Per step the proxy server sends a DNS query to the ENUM server . In this example the ENUM server cannot find the corresponding URI and indicates so to the SIP proxy server per step . Accordingly the SIP proxy server sends an INVITE message to the media gateway step the INVITE message specifies the telephone number. The media gateway as in step replies with a Ringing message. The SIP proxy server forwards the Ringing message to the endpoint per step .

In step the media gateway also sends a 200 OK message to the SIP proxy server . This message is then forwarded to the endpoint step by the SIP proxy server

The endpoint responds with an ACK message to the SIP proxy server which sends the message to the media gateway steps and . In step a call is established between the source endpoint and the PSTN via the media gateway .

The data store stores user information as well as information on how packetized voice calls are to be routed over a public data network such as the Internet further this registry can specify alternate paths including circuit switched paths cellular paths or media paths e.g. IP media paths such routing information can take many forms including network addresses protocol port information etc. Additionally the data store permits the service provider to store and manage billing and rating information for calls placed by users. Further the service provider can maintain the necessary information to authorize communication between the endpoints involving different network elements.

The network includes a SIP proxy server for interfacing the various endpoints and . The SIP proxy server interacts with a TURN server a STUN server and an ENUM server as detailed early for supporting packetized voice calls with other data networks as well as circuit switched telephone systems.

In addition the system utilizes a gateway to provide connectivity to other systems e.g. data network or circuit switched telephone network .

It is contemplated that the above architecture can be deployed in a variety of terrestrial and radio communication systems to offer the Interconnect services which can be complementary or supplementary to other communication services. For example a wireless communication system can implement such services as explained below.

The approach in an exemplary embodiment adheres to the following assumptions. First the IP side controls all fixed and mobile services. Also it is assumed that calls are established over a myriad of networks the Internet 2G 3G mobile networks 3GPP and 3GPP2 Time Division Multiplexing TDM networks such as the PSTN and PBXs and ISDN Integrated Digital Services Network 4G 4Generation Wi Fi and WiMax wireless networks and IP PBXs and other IP systems such as H.323. Communication services are enabled or deployed on the IP side and can be based for instance on SIP and its associated application layer protocols such as developed in the SIMPLE SIPPING IPTEL XCON and ENUM working groups of the Internet Engineering Task Force IETF . The system for example includes SIP telephony and IM devices that are endpoints on the Internet . Gateways to 2G 3G mobile phone networks are also endpoints on the Internet . Further SIP PSTN and SIP PBX are endpoints on the Internet . The above approach is compatible with the end to end applications control architecture of the Internet e.g. IETF documents RFC 3665 and RFC 3666 show exemplary SIP call flow implementations for PBX Centrex like telephony and SIP PSTN respectively these documents are incorporated herein by reference in their entireties.

The wireless network which is a Visited network with respect to the service provider network includes an access point e.g. Ethernet switch as well as an AAA server . Likewise the service provider network includes an AAA server . In addition the network provides a STUN TURN server these two functions can also be implemented as separate components as evident from the previous discussion of STUN and TURN functionalities. Further the service provider network includes a SIP proxy server .

The mobile telephony network e.g. cellular network includes a mobile switch for processing communication sessions from the multimodal mobile station to the PSTN or the Internet through a mobile gateway . Similarly a gateway is employed to connect from the PSTN to the Internet in this manner the station within the PSTN can be reached by calls placed over the Internet .

Depending on the capabilities supported by the wireless or wired access network rich services such as presence events instant messaging voice telephony video games and entertainment services can be supported by the service provider network .

It is recognized that modern communication technologies have afforded users with a multitude of alternatives for communicating. Given these many possibilities a user is unsure at times of the most appropriate expedient way to communicate with another user given each party s preferences of when and how to be reached. Users of traditional telephone services and Private Branch Exchanges PBXs in the enterprise as well as mobile and Internet communications have at present separate devices identities and subscriptions for each communication service. These users can possess for example a home phone often with separate local and long distance service a PBX phone at work a mobile phone and such as a Personal Digital Assistant PDA that may also have mobile phone network and Wireless Local Area Network WLAN access to the Internet or to the enterprise PBX.

Additionally users of Instant Messaging IM may also have several accounts that can be used with a PC or laptop computer. Likewise users of e mail and mobile Short Messaging Systems SMS may also use dedicated devices and networks for each particular system though some bridging between e mail systems and separately between SMS and IM is sometimes possible. Separate subscriptions and mobile devices for access to these services is still required.

According to one embodiment of the present invention seamless communications using presence SIP events text voice video communications and file sharing is enabled in conjunction with a single identity or a suite of similar identifiers. That is the multimodal device enables a user to have a single identity and a single service subscription on all mobile and fixed networks whereby the device can operate in dual modes to communicate using any wireless or wired network. One single identity can take the form of a phone number and or a URI same or similar to the e mail address for all fixed and mobile networks and for all types of communications. The phone number and or URI can be the only entry in the address book by which the called party can be both reached and identified. A single identity is provided for the caller for access to all wired and wireless networks. Also a single subscription can be utilized for all types of networks and devices. Further NAT and firewall traversal is transparent to the user. Secure communications can be achieved based on network asserted user identity and encryption on demand.

The mobile device can interwork with PBXs not shown or can provide PBX like services. Calls and conferences can be maintained while switching between the wireless networks e.g. 2G 3G 2Generation 3Generation mobile phone networks Wi Fi WiMax wireless broadband and a wired PSTN or PBX network .

The Presence Events and IM Gateway provides gateway services from SIP to and from other protocols to enable seamless and interoperable presence events and instant messaging IM . Presence events and instant messaging IM have evolved as core new communication services on the Internet and in private IP networks with hundreds of million users worldwide. Leading edge mobile phone services such as push to talk are based on presence events and IM. It is no coincidence that telephony has become an adjunct to popular IM services where making a phone call is just another option to choose from various other communication modes. IP IP voice calls are also enabled without the use of telephone network or dependency on phone numbers.

In both wired and wireless networks Graphical User Interfaces GUIs with the presence of buddies can be more useful than displaying phone numbers. That is the clicking on presence icons is perceived as more useful than using the dial pad. The dial pad remains an option when connecting to traditional TDM networks using phone numbers only.

The IM infrastructure is completely separate from other forms of communications such as voice video conferencing etc. Conventionally IM services are proprietary and require gateways for at least some degree of basic communications between disparate systems.

The adoption of the SIP IM Protocols Leveraging Extensions SIMPLE by the mobile industry in the 3G IMS Third Generation IP Multimedia Service platform as well as by large technology vendors is due to the desire to have a single SIP based communication infrastructure for all IP communication services.

Gateways between legacy IM protocols can be provided as a fully meshed architecture where the number of gateways increases by the square of the number of protocols. However migration to a common IM core based on SIMPLE standards is a more effective approach and provides gateways between legacy IM systems and SIMPLE. Under such a scenario the increase in gateways is only linear with the number of IM protocols utilized.

The IM architecture according to an embodiment of the present invention is based on the SIMPLE standards. The presence event package describes the usage of the Session Initiation Protocol SIP for subscriptions and notifications of presence. Presence is defined as the willingness and ability of a user to communicate with other users on the network. The presence event package and associated notifications are more detailed respectively in A Presence Event Package for the Session Initiation Protocol SIP by J. Rosenberg Internet Draft IETF work in progress January 2003 and Functional Description of Event Notification Filtering by H. Khartabil et al. Internet Draft IETF work in progress August 2004 both of which are incorporated herein by reference in their entireties . Traditionally presence has been limited to on line and off line indicators the notion of presence here is broader. Subscriptions and notifications of presence are supported by defining an event package within the general SIP event notification framework.

The filtering of event notifications refers to the operations a subscriber performs in order to define filtering rules associated with event notification information. The handling of responses to subscriptions carrying filtering rules and the handling of notifications with filtering rules applied to them is defined. The definition also describes how the notifier behaves when receiving such filtering rules and how a notification is constructed.

The watcher information date format defines template package for the SIP event framework. Watcher information refers to the set of users subscribed to a particular resource within a particular event package. Watcher information changes dynamically as users subscribe unsubscribe are approved or are rejected. A user can subscribe to this information and therefore learn about changes to it. This event package is a template package because it can be applied to any event package including itself. Watcher functions are further detailed in A Watcher Information Event Template Package for SIP by J. Rosenberg Internet Draft IETF work in progress January 2003 which is incorporated herein by reference in its entirety .

In particular the Presence Information Data Format PIDF defines a basic format for representing presence information for a presentity. A presentity is an entity whose presence is tracked the presentity can project its presence information for example by registering status information location information or other attributes with a presence server not shown . That format defines a textual note an indication of availability open or closed and a URI for communication. However it is frequently useful to convey additional information about a user that needs to be interpreted by an automaton and is therefore not appropriate for placement in the note element of the PIDF document. Generally the extensions have been chosen to provide features common in existing presence systems at the time of writing in addition to elements that could readily be derived automatically from existing sources of presence such as calendaring systems or sources describing the user s current physical environment.

For example the Presence Information Data Format PIDF can utilize an XML format. The Extensible Markup Language XML Configuration Access Protocol XCAP allows a client to read write and modify application configuration data stored in XML format on a server. XCAP maps XML document sub trees and element attributes to HTTP URIs so that these components can be directly accessed by HTTP. Additional details of XCAP is provided in The Extensible Markup Language XML Configuration Access Protocol XCAP by J. Rosenberg Internet Draft IETF work in progress July 2004 which is incorporated herein by reference in its entirety .

XML Configuration Access Protocol XCAP allows a client to read write and modify application configuration data stored in XML format on a server. The data has no expiration time so it must be explicitly inserted and deleted. The protocol allows multiple clients to manipulate the data provided that they are authorized to do so. XCAP is used in SIMPLE based presence systems for manipulation of presence lists and presence authorization policies. Thus XCAP is rather suitable for providing device independent presence document manipulation.

A series of related textual messages between two or more parties can be viewed as part of a session with a definite start and end. This is in contrast to individual messages each sent completely independently. Under the SIMPLE standards messaging schemes only track individual messages as page mode messages whereas messaging that is part of a session with a definite start and end is called session mode messaging.

Page mode messaging is enabled in SIMPLE via the SIP MESSAGE method. Session mode messaging has a number of benefits over page mode messaging however such as explicit rendezvous tighter integration with other media types direct client to client operation and brokered privacy and security.

The Contact Information for Presence Information Data Format CIPID is an extension that adds elements to PIDF that provide additional contact information about a presentity and its contacts including references to address book entries and icons. CIPID is further detailed in CIPID Contact Information in Presence Information Data Format by H. Schulzrinne Internet Draft IETF work in progress July 2004 which is incorporated herein by reference in its entirety .

Presence information e.g. represented as Presence Information Data Format PIDF and Rich Presence Information Data Format RPID describes the current state of the presentity. RPID also allows a presentity to indicate how long certain aspects of the status have been valid and how long they are expected to be valid but the time range has to include the time when the presence information is published and delivered to the watcher. This restriction is necessary to avoid backwards compatibility problems with plain PIDF implementations. RPID is additionally described in RPID Rich Presence Extensions to the Presence Information Data Format by H. Schulzrinne et al. Internet Draft IETF work in progress March 2004 which is incorporated herein by reference in its entirety . Likewise PIDF is further detailed in Timed Presence Extensions to the Presence Information Data Format PIDF to Indicate Presence Information for Past and Future Time Intervals by H. Schulzrinne Internet Draft IETF work in progress July 2004 which is incorporated herein by reference in its entirety .

In some cases the watcher can better plan communications if it knows about the presentity future plans. For example if a watcher knows that the presentity is about to travel it might place a phone call earlier.

It can also be useful to represent past information as it may be the only known presence information. Such past information may provide watchers with an indication of the current status. For example indicating that the presentity was at a meeting that ended an hour ago indicates that the presentity is likely in transit at the current time.

The multimodal communication devices can also be a wired or wireless IP Centrex like phone with applications beyond voice e.g. such as presence events IM conferencing collaboration and games. As noted these devices can assume the role of a PBX or can interwork with existing PBXs.

These multimodal devices advantageously provide users with enhanced capability over traditional stations primarily because these devices can store and or execute valuable data and sophisticated applications such as personal data e.g. address book and calendar various office applications entertainment e.g. music and video files account information for various services including converged communications and payment mechanisms etc.

A multimodal communication device e.g. can contain software stacks and for mobile networks e.g. 2G and 3G etc. and for Internet access using Wi Fi WiMax and wired Ethernet LANs. Accordingly the lower stack includes Layer 1 L1 and Layer 2 L2 protocols while the upper stack can include User Datagram Protocol UDP Transmission Control Protocol TCP and Internet Protocol IP as well as G2.

As shown gateways are utilized to provide seamless communications to the respective networks PSTN cellular networks and e.g. 2G Code Division Multiple Access CDMA Global System for Mobile Communications GSM etc. and the Internet . For example the 2G network CDMA and GSM may support only voice and SMS while the 3G network may provide 3GPP IMS 3rd Generation Partnership Project IP Multimedia Subsystem services.

In an exemplary embodiment some of the functions described can be accomplished using a Bluetooth link between the multimodal communication device e.g. and the PC laptop or with a Bluetooth enabled SIP phone that is connected to the Internet notably for such functions as ICE and STUN TURN servers for NAT and firewall traversal.

The following process describes network and service access to Internet based SIP services by the multimodal devices . First an IP address is obtained for example using Dynamic Host Configuration Protocol DHCP . Thereafter Internet access is achieved. ICE provides determination of the optimum NAT firewall traversal. The device for instance can then register with the home SIP registrar to receive the SIP based IP communication services. According to one embodiment of the present invention a SIP re INVITE is utilized to switch between networks without leaving an established session such as a conference.

Smooth handoff in wireless networks can be readily accomplished at the Network Layer 2 in the respective radio networks such as in 2G 3G or Wi Fi WiMax networks. The user may be prompted by the mobile device to approve the switch from one network type to another such as when switching from the mobile 2G network to an enterprise or hot spot Wi Fi network not shown . In contrast to approaches where both a visited SIP registrar and a home SIP registrar are utilized the system can utilize a single SIP registrar e.g. the home registrar .

It is also contemplated that similar techniques may be applied for allowing a user to move from one device interface to another while maintaining a given session.

As seen in the multimodal mobile device of includes a cellular transceiver for communication with cellular systems. A wireless transceiver is also included for connecting to wireless networks e.g. 802.11 etc. . Further a network interface card NIC is provided for connectivity to a wired network the NIC can be an Ethernet type card. Use of the transceivers or NIC depends on the mode of operation of the device and is controlled by a controller . Radio transmissions can be relayed via the antenna .

The multimodal mobile device additionally includes a processor for executing instructions associated with the various applications e.g. PDA functions and applications etc. as well as memory both volatile and non volatile for storing the instructions and any necessary data.

In step the mobile station and the Access Point perform a Dynamic Host Configuration Protocol DHCP process. Next the mobile station establishes communication with the STUN TURN server as in step . Thereafter communication with the SIP server is executed by the mobile station through a REGISTER and 200 OK exchange per steps and .

The SIP proxy server forwards as in step to the mobile gateway . This gateway consequently sends per step an Answer Message ANM or Connect message to the cellular mobile switch . In step the switch signals a Connected message to the mobile station .

Per step the mobile station and a phone off the PSTN can begin communicating as a call is now established.

The above call flow involves a call being initiated by the mobile station the following process describes a call being received by the mobile station from a station within the PSTN .

In response to the Connect message the mobile gateway transmits a 200 OK message to the SIP proxy server step . This server subsequently forwards the OK message to the PSTN gateway per step . In step the PSTN gateway replies with an ACK message to the SIP proxy server which relays this message to the mobile station step . Thereafter a call is established between the mobile station and the originating station as in step .

After receiving the 200 OK message the mobile station replies as in step to the SIP proxy server with an ACK message. Per step the SIP proxy server transmits the ACK message to the PSTN gateway .

At this stage the PSTN gateway signals the termination of the 2G call with a BYE message to the SIP proxy server per step . The proxy server forwards the BYE message to the mobile gateway as in step . In step the mobile gateway sends a Release message to the cellular mobile switch which sends a Disconnect message to the mobile station .

After sending the Release signal the mobile gateway also sends a 200 OK message as in step to the SIP proxy server . The proxy server sends the 200 OK message to the PSTN gateway . Therefore an IP call is established per step .

In step the mobile gateway sends an ANM Answer Message or Connect message to the cellular mobile switch . The switch signals a Connected message to the mobile station per step .

The mobile gateway sends an ACK message per step to the SIP proxy server which transmits the ACK message to the PSTN gateway step . Thereafter the PSTN gateway sends a BYE message to the SIP proxy server which forwards the message to the mobile station steps and . In step the mobile station transmits a 200 OK message to the SIP proxy server the 200 OK message is further sent to the PSTN gateway step . Consequently a TDM call is now supported between the mobile station and the PSTN station.

In step the SIP proxy server to the mobile gateway which transmits an ISUP ISDN User Part Initial Address Message IAM or Setup message to the cellular mobile switch step . The cellular mobile switch exchanges Alerting Answer signaling with mobile station B per step . The cellular mobile switch sends an ANM or Connect message to the mobile gateway step . Next the mobile gateway generates as in step a 200 OK message to the SIP proxy server . The proxy server responds back with a 200 OK message per step .

In step the mobile gateway sends an ANM or Connect message to cellular mobile switch . A connection is established with the mobile station A step .

Per step the mobile gateway sends an ACK message to the SIP proxy server which transmits its own ACK message to the mobile gateway step . Hence the cellular mobile switch has established cellular communication with both the mobile stations A and B per steps and .

In step the mobile station A forwards an ACK message to the SIP proxy server in response to the 200 OK message. The SIP proxy server per step sends an ACK to the mobile gateway . The mobile gateway next sends a BYE message to the SIP proxy server step .

The mobile gateway next sends a Release message to the cellular mobile switch which in turn issues a Disconnect message to the mobile station A steps and .

The SIP proxy server in step transmits a BYE message to the mobile gateway which responds with a 200 OK message steps and . At this point the mobile station B still engaged in a cellular call leg per step . In step the SIP proxy server sends a 200 OK to the mobile gateway . Now the mobile station A communicating over IP media as in step .

According to one embodiment of the present invention the architecture includes three primary tiers an Access Tier a Services Tier and a Resource Tier . The Access Tier which can also be referred to as a Presentation Tier permits user and system access into the OSS for customers and service provider s sales support. The Services Tier is the focal point of the OSS architecture where a majority of the functionalities reside. Lastly the Resource Tier encompasses the elements that the services act upon. The OSS architecture manages these various resources.

According to one embodiment of the present invention the subsystems of the Access Tier include a Web Portal a Web Services Gateway and an Identity Management and Access Control component not shown . These interrelated components allow human users e.g. customer employees or service provider s staff and customer systems to access the OSS services via for example web browser or via Simple Object Access Protocol SOAP invocations.

In an exemplary embodiment the external access architecture are as follows. A web server is provided in a DMZ. Also programming and runtime environment is supported for dynamic generation of HTML pages and for handling incoming web requests. An XML firewall is deployed for screening and routing inbound SOAP traffic coming into DMZ from customers. Also by way of example web server agents are plugged into the web server and XML firewall. Further a Policy Server and LDAP backing store can be utilized.

The identity administration allows authorized users to be added and to permit these users to enter orders update information provision users etc. on behalf of their organization or company. This administration function enable delegation of administration privileges to customer administrators allowing them to add further users and grant them access privileges. It is assumed the service provider has some control in identity administration as the customer cannot be completely self managed using e.g. web self service. It is important to note that this identity administration function is distinct from end user identity management within the core SIP telephony components. The identity administration is concerned with administrative accounts that allow customer employees to interact with the OSS systems online to allow customer self service.

The Services Tier includes services that are mainly concerned with encapsulating resources such as data and other managed resources through Resource Encapsulation Services . The Services Tier also includes application process activities behavior or actually doing something.

As shown the arrows directed into the Services Tier constitute event sources that trigger activities within the services. Exemplary triggering events involve activities undertaken by the customer via web browser notifications coming in from legacy systems e.g. Accounts Receivable informing that a given customer has paid its bill and management related notifications originating from IP Services components in the architecture. For example a media relay server or its management agent can inform the OSS services that a resource consumption metric has gone above a high water mark and additional capacity needs to be provisioned. Also some OSS activities are triggered by time based events as suggested by the hour glass. In particular activities related to the monthly billing cycle are schedule driven.

The Resource Tier includes databases and legacy systems as well as primary IP Services components which are at the core of the IP IC offering .

As shows User Provisioning is invoked by the Access Tier driven by customer self service events. The Access Tier then pushes updates to the Customer Profile service and the ENUM DNS servers. In one embodiment the system employs a GUI which provides one or more Customer Self Service screens to permit the user to provision and manage their services. A Billing Presentment component is also provided.

In an exemplary embodiment presentment can be performed electronically via the web portal . The Billing Presentment component can be though of as presentation code in the Web Portal which draws the underlying statement information for each given customer from the Billing Statement store and renders that into for example HTML markup for presentation to the user.

The User Provisioning component in an exemplary embodiment is a Web Service which provides interfaces for a single user or a set of multiple users possibly thousands to be added to the system . The end result of user provisioning for instance is that ENUM mappings for the user s telephone number to SIP URI are added to the ENUM DNS server or servers . Also customer profile information is adjusted to increment or decrement the current user count field for the customer or customers. According to one embodiment of the present invention mirror databases are updated with the ENUM mapping information. This information can be captured in database format in addition to DNS for other uses e.g. to support white pages directory.

Because the User Provisioning component is implemented as a Web Service the Application Programming Interface API can include methods for adding a single user to the system dropping a single user from the system bulk loading an array of users to the system and for performing bulk drops. These API functions can be exposed to the customers as XML Web Services interfaces which the customer systems can programmatically call. The customer self service screens of the IP IC Web Portal can also provide Graphical User Interface GUI interfaces allowing customer administrative personnel to add and drop users.

Additionally the User Provisioning component according to one embodiment of the present invention performs dynamic updates to the DNS server or servers. By way of example the dynamic update can be executed by using public domain Java APIs into DNS using available C language library and use JNI to support binding of Java code to object code or exercise available DNS management interfaces. In an exemplary embodiment one of the roles of the User Provisioning service is to hide the exact details of this DNS binding from upstream systems so all these upstream systems see a simple Web Service interface.

When the User Provisioning component adds or drops a user or users for a given Customer the Customer Profile service updates bookkeeping on the user count. This can include updating a current user count field and updating a monthly peak user count field with respect to the User Provisioning component . The Customer Profile component also interacts with a Billing Computation component and a Fulfillment also referred to as an Order Management Customer Provisioning component .

Within the IP IC service the notion of provisioning can occur in an exemplary embodiment at two different levels 1 provisioning and de provisioning of individual SIP end users an ongoing activity and 2 provisioning of customers. In contrast with up front activities of provisioning a new customer configuring a given customer facility or PBX to point to IP IC DNS redirect relay and or signaling conversion servers etc. The User Provisioning service described in this example focuses on the former notion of provisioning the SIP end user not customer level provisioning. The Fulfillment component focuses on the customer level sense of provisioning.

According to an embodiment of the present invention the Billing Computation component or engine is a service that is primarily process oriented. It is triggered by a scheduler e.g. on a monthly billing cycle. Depending upon the service pricing model the Billing Computation component can also be triggered on a daily basis in order to take a daily sample of each Customer s user count. The samples can then be used to update a running accumulator for the purpose of calculating a monthly average user count for instance.

As for the Rating component this function can be integrated into the billing computation with regard to applying relevant discounts.

For the purposes of illustration it is assumed that the pricing model is based upon peak user count over the course of the month rather than the average. As discussed above the peak user count is maintained by the Customer Profile component each time it gets an increment decrement user count event from the User Provisioning Service . On a monthly trigger event the Billing Computation engine cycles through the customers. The Customer Profile is queried for the monthly peak user count for each customer. Each customer s Service Profile record is also consulted to determine the optional services that the customer is subscribed to. The system allows for a business model where different features are optional such as signal conversion or media relay and such options incur additional charges above the base offering price.

Additionally the Billing Computation engine pulls and caches the current base price figures for each option from a Product Description store . With all of this information the Billing Computation engine can then calculate the customer s itemized charges and bottom line. The Billing Computation engine can then consult the Rating component to determine discount adjustments for the customer. Further the Billing Computation engine prepares for example a XML document that represents the complete monthly information regarding what the customer bought and owes and posts these XML documents to the Billing Statement store . The Billing Statement store provides storage of these documents persistently for later consumption by the Billing Presentment component and financial systems .

In an exemplary embodiment the Billing Statement component is a data oriented service and supports persistent storage of the billing statement documents that are created by the Billing Computation engine for each customer e.g. each month . Specifically the Billing Statement component maintains storage for both the current billing cycle and for archival storage of all past billing statements.

In an exemplary embodiment each record in the Billing Statement tables stores an ASCII document. This document can be in XML format document for detailing the itemized charges for a given customer applied discounts and bottom line. The XML document records the detail of what the customer bought and what the customer owe. These XML documents stored in the Billing Statement component represent all the information that is required for Billing Presentment to present an e invoice to the customer and for the financial systems to collect payment and report back on the status of customer payment or delinquency.

The Product Description component stores product information received from the Product Design Maintenance component . In other words the Product Description component is mainly a data store and records information about the product offering as a whole plus separate information about each of the product s available options. This arrangement externalizes general information about the product so as to avoid hard coding such information within program code. Of import is pricing information which is likely subject to change and best to keep in an external store. If a pricing model is adopted where separate product options are priced individually then each option could have an associated base price or price rate per user .

The main client of the Product Description service is the Billing Computation engine which mainly needs to extract the base pricing information in order to compute bills.

The Service Profile component is another data oriented component and is fed by the Fulfillment component which can be GUI driven by Order Entry Product Design and Customer Support web screens . The Service Profile component can be queried on a monthly cycle by the Billing Computation component in the course of calculating each customer s bill.

The Service Profile component persists the complete product description for each customer of the products provisioned by the customer. If the product offering has several optional features such as signal conversion media relay etc. then the Service Profile information for each customer details the options elected by the customer along with attributes that parameterize variable quantities associated with the different product options. The Service Profile component thus represents the instantiation of the IP IC product offering for each customer. This is in contrast with the Product Description component which embodies a description of the product as a whole not any given customer s realization of the product. In object oriented parlance the Product Description would be thought of as class level and the Service Profile would be instance level. 

According to one embodiment of the present invention the Fulfillment component provides a back end to the customer self service web screens as well as sales support screens related to order management and customer provisioning processes.

As noted earlier provisioning involves multiple levels provisioning in the sense of enabling SIP end users to use the system and provisioning in the sense of turning up a new Customer and maintaining updating their information at a customer level. The Fulfillment component supports the customer level sense of provisioning not the SIP user management which is handled by the User Provisioning component.

Among other functions the Fulfillment component supports establishing new customer accounts and creating an IP IC product specific Accounts for an existing customer. In addition the Fulfillment component can coordinate with customer data stores of record to ensure that proper corporate Customer ID is used. The Fulfillment component also provides support for a customer entering survey of their needs and environment which can assist sales personnel in product design configuration. This Fulfillment component additionally provides Customer Premise Equipment CPE information entry and can inform customers of the proper URLs or other binding information that they need for operational use of the various servers e.g. DNS ENUM Redirect STUN TURN Signal Conversion gateways etc. .

Moreover the Fulfillment component permits customer election of product options that define what the customer is buying. For example the component can determine whether the customer require signal conversion media relay etc. Further the Fulfillment component supports entering site information.

As seen in the figure the Fulfillment component communicates with an Inventory component . In an exemplary embodiment this Inventory component is a data component that tracks relevant resource inventory both at the customer premises via the legacy customer data store and resources that are internal to the service provider. It is noted that separate stores for these two sorts of inventory information can be maintained. For example the inventory store can be kept in a relational database. By way of example internal resources that might be considered for storage in some sort of inventory service include CPUs and their associated IP addresses databases deployed services that comprise the OSS architecture. The inventory of deployed services according to an embodiment of the present invention can be deployed as a service directory such as UDDI rather than within a relational database. UDDI is a web based distributed directory that enables businesses to list themselves on the Internet.

According to one embodiment of the present invention it is assumed that the core of the service assurance architecture is based on a Manager Agent model. A number of different Agent types and instances active agents are responsible for monitoring the vital signs of various resources services CPUs databases that make up the system environment. These active agents provide information to a Management Layer which can be single tiered or multi tiered. The Management Layer provides information to other interested systems such as a management console capacity management component alerts and a report engine etc.

According to one embodiment of the present invention the Management Console can be a rich client. Such a rich client can be implemented with Java applets Java WebStart deployment of a Java application or a .NET Smart Client deployed perhaps with technology such as Microsoft ClickOnce technology or via a hyper link that resolves to an .exe similar in spirit to the Java applet model .

The management infrastructure of the service assurance systems determines when and where additional CPU resource are needed alerts could be raised and physical capacity could be provisioned i.e. another CPU rack installed . In light of these considerations the Agent tier can be involved not only with monitoring health of deployed systems but also with dynamic deployment of services into the environment service life cycle management. For example the growth of the core servers e.g. Media Relay instances supporting the Interconnect services can be readily management using the arrangement of . The Media Relay instances can be deployed on demand onto a grid like farm of resources.

The processes described herein for supporting Interconnect services may be implemented via software hardware e.g. general processor Digital Signal Processing DSP chip an Application Specific Integrated Circuit ASIC Field Programmable Gate Arrays FPGAs etc. firmware or a combination thereof. Such exemplary hardware for performing the described functions is detailed below.

The computer system may be coupled via the bus to a display such as a cathode ray tube CRT liquid crystal display active matrix display or plasma display for displaying information to a computer user. An input device such as a keyboard including alphanumeric and other keys is coupled to the bus for communicating information and command selections to the processor . Another type of user input device is a cursor control such as a mouse a trackball or cursor direction keys for communicating direction information and command selections to the processor and for controlling cursor movement on the display .

According to one embodiment of the invention the processes described herein are performed by the computer system in response to the processor executing an arrangement of instructions contained in main memory . Such instructions can be read into main memory from another computer readable medium such as the storage device . Execution of the arrangement of instructions contained in main memory causes the processor to perform the process steps described herein. One or more processors in a multi processing arrangement may also be employed to execute the instructions contained in main memory . In alternative embodiments hard wired circuitry may be used in place of or in combination with software instructions to implement the embodiment of the present invention. Thus embodiments of the present invention are not limited to any specific combination of hardware circuitry and software.

The computer system also includes a communication interface coupled to bus . The communication interface provides a two way data communication coupling to a network link connected to a local network . For example the communication interface may be a digital subscriber line DSL card or modem an integrated services digital network ISDN card a cable modem a telephone modem or any other communication interface to provide a data communication connection to a corresponding type of communication line. As another example communication interface may be a local area network LAN card e.g. for Ethernet or an Asynchronous Transfer Model ATM network to provide a data communication connection to a compatible LAN. Wireless links can also be implemented. In any such implementation communication interface sends and receives electrical electromagnetic or optical signals that carry digital data streams representing various types of information. Further the communication interface can include peripheral interface devices such as a Universal Serial Bus USB interface a PCMCIA Personal Computer Memory Card International Association interface etc. Although a single communication interface is depicted in multiple communication interfaces can also be employed.

The network link typically provides data communication through one or more networks to other data devices. For example the network link may provide a connection through local network to a host computer which has connectivity to a network e.g. a wide area network WAN or the global packet data communication network now commonly referred to as the Internet or to data equipment operated by a service provider. The local network and the network both use electrical electromagnetic or optical signals to convey information and instructions. The signals through the various networks and the signals on the network link and through the communication interface which communicate digital data with the computer system are exemplary forms of carrier waves bearing the information and instructions.

The computer system can send messages and receive data including program code through the network s the network link and the communication interface . In the Internet example a server not shown might transmit requested code belonging to an application program for implementing an embodiment of the present invention through the network the local network and the communication interface . The processor may execute the transmitted code while being received and or store the code in the storage device or other non volatile storage for later execution. In this manner the computer system may obtain application code in the form of a carrier wave.

The term computer readable medium as used herein refers to any medium that participates in providing instructions to the processor for execution. Such a medium may take many forms including but not limited to non volatile media volatile media and transmission media. Non volatile media include for example optical or magnetic disks such as the storage device . Volatile media include dynamic memory such as main memory . Transmission media include coaxial cables copper wire and fiber optics including the wires that comprise the bus . Transmission media can also take the form of acoustic optical or electromagnetic waves such as those generated during radio frequency RF and infrared IR data communications. Common forms of computer readable media include for example a floppy disk a flexible disk hard disk magnetic tape any other magnetic medium a CD ROM CDRW DVD any other optical medium punch cards paper tape optical mark sheets any other physical medium with patterns of holes or other optically recognizable indicia a RAM a PROM and EPROM a FLASH EPROM any other memory chip or cartridge a carrier wave or any other medium from which a computer can read.

Various forms of computer readable media may be involved in providing instructions to a processor for execution. For example the instructions for carrying out at least part of the present invention may initially be borne on a magnetic disk of a remote computer. In such a scenario the remote computer loads the instructions into main memory and sends the instructions over a telephone line using a modem. A modem of a local computer system receives the data on the telephone line and uses an infrared transmitter to convert the data to an infrared signal and transmit the infrared signal to a portable computing device such as a personal digital assistant PDA or a laptop. An infrared detector on the portable computing device receives the information and instructions borne by the infrared signal and places the data on a bus. The bus conveys the data to main memory from which a processor retrieves and executes the instructions. The instructions received by main memory can optionally be stored on storage device either before or after execution by processor.

While the present invention has been described in connection with a number of embodiments and implementations the present invention is not so limited but covers various obvious modifications and equivalent arrangements which fall within the purview of the appended claims.

The following patent applications are incorporated herein by reference in their entireties co pending U.S. patent application Ser. No. 11 202 659 filed Aug. 12 2005 entitled Method and System for Providing Voice Over IP Managed Services Utilizing a Centralized Data Store co pending U.S. patent application Ser. No. 11 202 589 filed Aug. 12 2005 entitled Fixed Mobile Communications with Mid Session Mode Switching co pending U.S. patent application Ser. No. 11 324 039 filed Dec. 30 2005 entitled Method and System for Providing Secure Media Gateways in Support of Interdomain Traversal co pending U.S. patent application Ser. No. 11 324 049 filed Dec. 30 2005 entitled Method and System for Providing Secure Real time Media Streams in Support of Interdomain Traversal and co pending U.S. patent application Ser. No. 11 323 513 filed Dec. 30 2005 entitled Method and System for Providing Secure Credential Storage to Support Interdomain Traversal. 

