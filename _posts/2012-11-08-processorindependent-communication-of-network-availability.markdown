---

title: Processor-independent communication of network availability
abstract: In some embodiments, an electronic device includes a host processor and a module, coupled to the host processor, to communicate over a wireless network using a first wireless communications protocol. The electronic device also includes a controller, coupled to the host processor and the module, to communicate wirelessly with a remote device using a second wireless communications protocol, to obtain a status of the wireless network from the module independently of the host processor, and to transmit the status of the wireless network to the remote device.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08942632&OS=08942632&RS=08942632
owner: QUALCOMM Incorporated
number: 08942632
owner_city: San Diego
owner_country: US
publication_date: 20121108
---
This application claims priority to U.S. Provisional Patent Application No. 61 693 954 titled System and Method for Communicating Network Availability filed Aug. 28 2012 which is hereby incorporated by reference in its entirety.

The present embodiments relate generally to wireless communication systems and more specifically to systems and methods for communicating network status information between devices.

A wireless device may be wirelessly connected to a remote device using a wireless communications protocol such as Bluetooth. If the wireless device also has access to a wireless network that the remote device cannot access directly then the wireless device may act as a gateway that provides the remote device with access to the wireless network. The wireless device may provide network status information as well as network access to the remote device. However implementing these functions using a host processor in the wireless device may result in undesirable delays and power consumption.

Embodiments are disclosed that allow a controller in an electronic device to obtain network status information and provide the network status information to a remote device independently of a host processor in the electronic device.

In some embodiments an electronic device includes a host processor and a module coupled to the host processor to communicate over a wireless network using a first wireless communications protocol. The electronic device also includes a controller coupled to the host processor and the module to communicate wirelessly with a remote device using a second wireless communications protocol to obtain a status of the wireless network from the module independently of the host processor and to transmit the status of the wireless network to the remote device.

In some embodiments a method of operating an electronic device is performed. The electronic device includes a host processor a module to communicate over a wireless network using a first wireless communications protocol and a controller to communicate wirelessly with a remote device using a second wireless communications protocol. In the method a request from the remote device for a status of the wireless network is received in the controller. The controller obtains the status of the wireless network from the module independently of the host processor and transmits the status of the wireless network to the remote device.

In some embodiments a non transitory computer readable storage medium stores one or more programs configured to be executed by a controller in an electronic device. The electronic device further includes a host processor and a module to communicate over a wireless network using a first wireless communications protocol. The controller is configured to communicate wirelessly with a remote device using a second wireless communications protocol. The one or more programs include instructions to obtain a status of the wireless network from the module independently of the host processor in response to a request from the remote device. The one or more programs also include instructions to transmit the status of the wireless network to the remote device.

In the following description numerous specific details are set forth such as examples of specific components circuits and processes to provide a thorough understanding of the present disclosure. Also in the following description and for purposes of explanation specific nomenclature is set forth to provide a thorough understanding of the present embodiments. However it will be apparent to one skilled in the art that these specific details may not be required to practice the present embodiments. In other instances well known circuits and devices are shown in block diagram form to avoid obscuring the present disclosure. The term coupled as used herein means connected directly to or connected through one or more intervening components or circuits. Any of the signals provided over various buses described herein may be time multiplexed with other signals and provided over one or more common buses. Additionally the interconnection between circuit elements or software blocks may be shown as buses or as single signal lines. Each of the buses may alternatively be a single signal line and each of the single signal lines may alternatively be buses and a single line or bus might represent any one or more of a myriad of physical or logical mechanisms for communication between components. The present embodiments are not to be construed as limited to specific examples described herein but rather to include within their scope all embodiments defined by the appended claims.

The illustration of the wireless device as a mobile phone in is merely an example. Other examples include but are not limited to tablet computers laptop computers personal digital assistants and the like. Furthermore the wireless device need not be mobile.

The wireless device is also configured to communicate over a wireless link with a remote device e.g. a watch . In some embodiments the link is a Bluetooth link. For example the remote device is a Bluetooth Low Energy BLE device and the wireless device includes a BLE transceiver for communicating with the remote device . In some embodiments the remote device uses a single mode BLE implementation characterized by a lightweight Low Energy Link Layer LE LL in the Bluetooth protocol stack to provide low power idle mode operation and power save modes simple device discovery and reliable data transfer. The illustration of the remote device as a watch in is merely an example. Other examples include but are not limited to sensors monitors and meters e.g. in applications such as sports wellness healthcare entertainment toys industrial equipment etc. . In some embodiments the remote device is battery powered e.g. using button cell batteries .

In some embodiments the remote device includes a user interface e.g. a display that displays an icon showing a network status e.g. for the WLAN or cellular network that includes link or of the wireless device . For example the icon illustrates whether the wireless device is connected to WLAN and or cellular networks via the links and or . The remote device may also display other information regarding the network status of the wireless device such as the type of network signal strength and available data transfer rate. The remote device obtains the network status of the wireless device over the link .

In some embodiments the remote device may also access network resources e.g. the WANs and or through the link wireless device and links and or . For example the remote device retrieves data from the networks and or for display or other use or uploads information e.g. sensor measurements to the networks and or . The wireless device thus serves as a gateway through which the remote device can access the networks and or .

As described the remote device monitors the network status of the wireless device as reported to it by the wireless device through the link . The remote device is thus said to function in a network monitor role and the wireless device is said to function in a network reporter role e.g. in accordance with terminology adopted by the Bluetooth Special Interest Group . is a block diagram showing a network monitor e.g. the remote device with a wireless connection e.g. via the wireless link to a network reporter e.g. the wireless device . The network monitor may request information from the network reporter about the network status of the network reporter . A network availability service e.g. as implemented using a Bluetooth profile of the network reporter processes and responds to the request. To save power in the network reporter and to reduce response time the network availability service is offloaded from the host processor e.g. host processor of the network reporter which allows the network reporter to respond to the request independently of the host processor. For example if the host processor is idle and has entered a power saving mode the network reporter may respond to the request without waking the host processor from the power saving mode. Because the network availability service is offloaded from the host processor it is referred to as an offloaded network availability ONwA service .

The wireless device also includes a host processor e.g. a central processing unit or CPU and memory . The host processor runs an operating system and device applications. A bus couples the host processor memory Bluetooth controller WLAN module and cellular module . In some embodiments an interface separate from the bus couples the Bluetooth controller with the WLAN module and an interface separate from the bus couples the Bluetooth controller with the cellular module . The interface is used for communications between the Bluetooth controller and WLAN module regarding the WLAN status. The interface is used for communications between the Bluetooth controller and the cellular module regarding the cellular network status. The interfaces and which may be referred to as status interfaces may be combined in a single bus. Alternatively the bus is used for communications between the Bluetooth controller and the WLAN module and or cellular module regarding network status and the interfaces and or are omitted.

In some embodiments instead of using three separate antennas and one antenna may be shared between two or more e.g. all of the modules and and controller using switching techniques. In some embodiments the Bluetooth controller WLAN module and cellular module may be located on the same circuit board or may be embedded on the same integrated circuit as a system on a chip SoC . In some embodiments the bus is implemented as a peripheral component interconnect express PCIe bus a universal serial bus USB a universal asynchronous receiver transmitter UART serial bus a suitable advanced microcontroller bus architecture AMBA interface a serial digital input output SDIO bus or other interface. In some embodiments the interfaces and or are implemented as IC busses IS busses or other suitable interfaces.

In some embodiments the wireless device has an architecture in which the lower layers of the protocol stacks for Bluetooth WLAN and cellular communications are implemented in firmware and hardware in the Bluetooth controller WLAN module and WLAN module respectively. The Bluetooth controller includes a Low Energy Link Layer LE LL for managing the radio frequency RF link between the wireless device and remote device by performing advertisement scanning initiating and connection functions. The Bluetooth controller also includes a physical layer PHY for performing the hardware specific transmission and reception of wireless signals. For example the PHY may be a 1 Mbps adaptive frequency hopping radio using Gaussian Frequency Shift Keying GFSK in the 2.4 GHz Industrial Scientific Medical ISM band. The WLAN module includes a PHY for transmitting and receiving WLAN signals and a media access controller MAC for processing frames corresponding to the transmitted and received signals. In some embodiments the MAC and PHY operate in accordance with a protocol from the IEEE 802.11 family of protocols e.g. a WiFi protocol . Similarly cellular module includes a media access controller radio link controller MAC RLC that implements a data link layer and a PHY that transmits and receives cellular signals.

Upper layers of the Bluetooth WLAN and or cellular protocol stacks are implemented in software executed by the host processor . For example drivers corresponding to the upper layers of these protocol stacks are stored in the memory e.g. in a non transitory computer readable medium in the memory such as one or more nonvolatile memory devices and accessed by the host processor over the bus . The drivers include instructions that when executed by the host processor implement the upper layers of the Bluetooth WLAN and or cellular protocol stacks.

The Bluetooth controller includes an offloaded network availability ONwA module that obtains information regarding network status from the WLAN module and or cellular module independently of the host processor and thus without execution of upper protocol stack layers by the host processor . For example the Bluetooth controller obtains network status information over status interfaces and respectively or alternatively over the bus . The status interfaces and are coupled for example to the ONwA module of the Bluetooth controller . The status interface is also coupled for example to the MAC in the WLAN module and the status interface is also coupled to the MAC RLC in the cellular module . In some embodiments one or both of the status interfaces and are implemented as a coexistence interface configured to coordinate operation of the Bluetooth controller and network modules and or in a manner that minimizes interference such as for example packet traffic arbitration using a 2 wire 3 wire or 4 wire interface. The ONwA module may be implemented as processor readable instructions stored as firmware and executable by the Bluetooth controller e.g. as illustrated for the controller in . The ONwA module is configured to communicate information regarding network status e.g. as obtained over status interfaces and or to another device such as the remote device over a Bluetooth link .

The upper layers of the BLE protocol stack as implemented in the host processor include a logical link control and adaptation protocol L2CAP layer an attribute protocol ATT layer a generic attribute profile GATT layer a security manager SM layer and a generic access profile GAP layer . The L2CAP layer performs data encapsulation for the layers above it including multiplexing data from the layers above it and formatting packets to be exchanged with the HCI . The ATT layer allows the wireless device to expose data known as attributes to other devices e.g. to the remote device such that the other devices can access the attributes. When the wireless device exposes attributes to the remote device the wireless device is referred to as an ATT server and the remote device is referred to as an ATT client. The GATT layer defines sub procedures for using the ATT layer and specifies the structure of BLE profiles. Data used by profiles and services in BLE are referred to as characteristics. GATT sub procedures handle the communication of these characteristics. Profiles and applications thus interface with the GATT layer for communication of characteristics. A Bluetooth profile is a specification regarding an aspect of Bluetooth communication. A profile defines configurations and functions that enable a service provided using wireless communications. The ATT layer and GATT layer together allow the remote device to discover what services the wireless device supports.

The SM layer is used for secure connection and data exchange with other devices e.g. with the remote device . The SM layer defines procedures for pairing and key distribution and provides encryption and identification functions. The GAP layer handles device discovery and detection and initiates security features. Applications and profiles interface with the GAP layer to perform discovery and connection.

A network availability NwA profile e.g. as defined in Version 4.0 of the Bluetooth Core Specification allows the wireless device to determine status information regarding WLAN and or cellular connections and provide this information to the remote device . The NwA profile uses the functionality of the ATT layer GATT layer and GAP layer to provide the NwA service. Since the layers and are upper level protocol layers implemented in software on the host processor the NwA profile uses the host processor . This use of the host processor causes power consumption that shortens the useful operational period of the wireless device when the wireless device is battery powered.

To avoid this power consumption and to reduce delays the network availability service is offloaded from the host processor to the Bluetooth controller by including an ONwA module in accordance with some embodiments. The lower portion of the BLE protocol stack as implemented in the Bluetooth controller is modified from that of to support the operation of the ONwA module .

The ONwA module allows the Bluetooth controller to determine information regarding WLAN and or cellular network status e.g. via status interfaces and or or via bus and write the information as characteristics that the remote device may read over the link . Further the ONwA module may also provide a notification when the network status e.g. WLAN and or cellular connectivity status of the wireless device changes. Providing notification of network status changes saves power in a network monitor e.g. the remote device by reducing or eliminating polling by the network monitor to obtain the status information.

In some embodiments the ONwA module is configured to respond to a GATT Discover All Primary Services procedure initiated by a network monitor to report the instance of ONwA service provided by the ONwA module . Further the ONwA module may be configured to respond to a GATT Discover All Characteristics of a Service procedure initiated by the network monitor to report the characteristics associated with the ONwA module . The ONwA module may also be configured to respond to a GATT Read Characteristic Value procedure initiated by the network monitor to report the value of the network availability characteristic. In some embodiments the network availability characteristic is a single bit indicating whether or not the network reporter e.g. the wireless device is connected to a network. Alternatively the network availability characteristic includes a first bit to indicate whether the network reporter has WLAN connectivity and a second bit to indicate whether the network reporter has cellular network connectivity. Furthermore the network availability characteristic may include additional bits to provide additional information regarding network connectivity status including for example the type of network signal strength and or data rate.

In some embodiments the ONwA module is configured to respond to a GATT Write Characteristic Descriptors procedure initiated by the network monitor to set the Notification bit in the Client Characteristic Configuration descriptor to enable the ONwA service to notify the network monitor of changes to the network status. For example the ONwA module may be configured to replicate the GATT Notification procedure to report changes in network availability to the network monitor .

In some embodiments the ONwA module is configured to perform or respond to GAP Limited Discoverable Mode procedures initiated by the network monitor to allow connection to unbonded devices. Unbonded devices are devices with which the network monitor has not yet established a secure connection. Similarly the ONwA module may be configured to perform or respond to GAP Undirected Connectable Mode procedures initiated by the network monitor to allow connection to bonded devices. Further the ONwA module may be configured to perform or respond to any suitable GAP connection procedure in the event of a link loss with the network monitor .

In the method a determination is made as to whether a connection e.g. a Bluetooth connection over a link with the external device exists. This determination is made for example by the ONwA module . If no connection exists No a connection is established . For example the ONwA module performs a GAP connection procedure using the GAP layer of the controller s protocol stack . Because the controller s protocol stack duplicates the GAP functionality of the GAP layer as implemented in the host processor the connection is established independently of the host processor .

If a connection to the external device exists Yes or once the connection is established a request e.g. a query is received from the external device. In some embodiments the request initiates a GATT procedure e.g. in accordance with the GATT layer of the controller s protocol stack . Because the controller s protocol stack duplicates the GATT functionality of the GATT layer implemented in the host processor the controller is able to process the request independently of the host processor .

Examples of the request received in the operation include a request for the status e.g. the availability connection status network type signal strength data rate etc. of a wireless network e.g. a WLAN associated with WLAN module or a cellular network associated with cellular module a service discovery request and a service characteristics discovery request.

Information is obtained in response to the request independently of the host processor e.g. using an ONwA service . For example the ONwA module obtains information regarding the WLAN status from the WLAN module and or information regarding the cellular network status from the cellular module . In another example information is obtained from the ONwA module indicating the availability of the ONwA service in response to a service discovery request. In some embodiments one or more characteristics of the ONwA service are obtained in response to a service characteristics discovery request.

The information obtained in the operation is transmitted to the external device e.g. over the link . For example the ONwA module responds to the GATT procedure initiated in operation with the information obtained in the operation the controller then transmits this information to the external device. As described above this information may include information regarding the ONwA service information regarding the characteristics of the ONwA service and or information regarding network status depending upon the request received from the external device e.g. depending on the procedure called by the network monitor .

The operations and including for example the operations and may be performed repeatedly for different requests from the external device.

In some embodiments if a wireless network connection e.g. a WLAN connection or cellular connection is available the external device is provided with access to the wireless network. For example the controller provides wireless network access to the network monitor e.g. the remote device in conjunction with the WLAN module or cellular module independently of the host processor . The external device may use this access to upload data to and or download data from a network e.g. the network or . Downloaded data may be displayed for example on the user interface . The operations and including for example the operations and allow the external device to confirm network availability before accessing the network.

In the method the operations and are performed as described for the method . If a connection to the external device exists Yes or once the connection is established the ONwA service e.g. as implemented in the ONwA module is used to monitor a network status e.g. for a WLAN associated with the WLAN module or a cellular network associated with the cellular module . For example the ONwA module receives network status information from the WLAN module or cellular module and compares current network status information with previously stored network status information to determine whether a change in network status has occurred. The network status may include for example the network availability connection status signal strength and or data rate.

In some embodiments if a change in the network status is detected Yes the external device is notified of the change. In some embodiments if a change in the network status is detected Yes a timer is started. If the change is still detected upon expiration of the timer Yes the external device is notified of the change. The timer may for example have a duration in the range of 1 5 seconds e.g. 3 seconds . Use of the timer filters out transient changes in network status such that the external device is not notified of changes with durations shorter than the duration of the timer.

If no change in the network status is detected No or if a change is detected but is no longer detected upon expiration of the timer No then no notification is provided to the external device and the ONwA service continues to monitor the network status.

In some embodiments if a wireless network connection e.g. a WLAN connection or cellular connection is available the external device is provided with access to the wireless network as described for the method . The operations and allow the external device to confirm network availability before accessing the network.

In some embodiments all or a portion of the methods and or are performed using the controller while the host processor is in a power saving mode. For example the host processor exits a normal operating mode and enters a power saving mode when it is idle such that the host processor consumes less power in the power saving mode than in the normal operating mode. This transition may occur before or during the method or and performance of operations in the method or does not cause the host processor to transition back from the power saving mode to the normal operating mode.

While the methods and include a number of operations that appear to occur in a specific order it should be apparent that the methods and can include more or fewer operations which can be executed serially or in parallel. An order of two or more operations may be changed and two or more operations may be combined into a single operation. Also the methods and or portions thereof may be combined into a single method.

In some embodiments the LE LL and ONwA module of the Bluetooth controller or analogous elements of an analogous controller for a different wireless communications protocol are implemented in software e.g. in firmware . is a block diagram of a controller that is an example of such a Bluetooth controller or analogous controller in accordance with some embodiments. The controller includes the PHY as described for and also includes a bus interface to connect to the bus and an optional ONwA interface to connect to the interfaces and . The PHY bus interface and ONwA interface are coupled to one or more processor cores which are coupled to memory . In some embodiments the memory includes a non transitory computer readable medium e.g. one or more nonvolatile memory elements such as EPROM EEPROM Flash memory and so on that stores instructions for execution by the one or more processor cores . The instructions include instructions that when executed by the processor core s cause the controller to perform all or a portion of the methods and or . For example the instructions include instructions that when executed by the processor core s implement the functionality of layers and or of the protocol stack .

While the memory is shown as being separate from the processor core s all or a portion of the memory may be embedded in the processor core s . In some embodiments the memory is implemented in the same integrated circuit as the processor core s PHY and interfaces and .

In the foregoing specification the present embodiments have been described with reference to specific exemplary embodiments thereof. It will however be evident that various modifications and changes may be made thereto without departing from the broader spirit and scope of the disclosure as set forth in the appended claims. For example while embodiments have been described with regard to the BLE systems other embodiments may be implemented in other wireless communication systems having devices with analogous network monitor and network reporter roles. The specification and drawings are accordingly to be regarded in an illustrative sense rather than a restrictive sense.

