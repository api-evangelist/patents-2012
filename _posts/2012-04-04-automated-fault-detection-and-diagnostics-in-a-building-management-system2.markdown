---

title: Automated fault detection and diagnostics in a building management system
abstract: Systems and methods for automated fault detection in a building management system are shown and described. The systems and methods further involve organizing the data set into bins, each bin containing a plurality of the observed points for the variable of the building management system. The systems and methods further involve calculating, for each bin, a target parameter and an estimator of scale for the observed points. The systems and methods further involve detecting, for each bin, an outlier of the building management system by comparing a data point of the bin to the calculated target parameter and estimator of scale for the bin.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09606520&OS=09606520&RS=09606520
owner: Johnson Controls Technology Company
number: 09606520
owner_city: Holland
owner_country: US
publication_date: 20120404
---
This is a continuation in part of U.S. application Ser. No. 13 246 644 filed Sep. 27 2011 which is a continuation in part of U.S. application Ser. No. 12 949 660 filed Nov. 18 2010 which is a continuation in part of U.S. application Ser. No. 12 819 977 filed Jun. 21 2010 which claims the benefit of U.S. Provisional Application No. 61 219 326 filed Jun. 22 2009 U.S. Provisional Application No. 61 234 217 filed Aug. 14 2009 and U.S. Provisional Application No. 61 302 854 filed Feb. 9 2010. The entireties of U.S. application Ser. Nos. 13 246 644 12 949 660 12 819 977 and U.S. Provisional Application Nos. 61 302 854 61 219 326 and 61 234 217 are hereby incorporated by reference.

The present invention relates generally to the field of building management systems. The present invention more particularly relates to systems and methods for statistical control and fault detection in a building management system.

One embodiment of the invention relates to a computerized method for detecting outliers in a building management system. The method includes receiving at a building management system a data set containing a plurality of observed points for a variable of the building management system. The method further includes organizing the data set into bins each bin containing a plurality of the observed points for the variable of the building management system. The method further includes calculating for each bin a target parameter and an estimator of scale for the observed points. The method further includes detecting for each bin an outlier of the building management system by comparing a data point of the bin to the calculated target parameter and estimator of scale for the bin. The method includes generating an expected outlier parameter which provides a metric that describes a threshold of outliers in the system under normal operating conditions. If the actual number of outliers is larger than the threshold then a fault may exist. The method further includes outputting an indication of one or more of the outliers to at least one of a memory device a user device or another device on the building management system.

Another embodiment of the invention relates to a controller for detecting outliers in a building management system. The controller includes a processing circuit configured to receive a data set containing a plurality of observed points for a variable of the building management system. The processing circuit is further configured to organize the data set into bins each bin containing a plurality of the observed points for the variable of the building management system. The processing circuit is further configured to calculate for each bin a target parameter and an estimator of scale for the observed points. The processing circuit is further configured to detect for each bin an outlier of the building management system by comparing a data point of the bin to the calculated target parameter and estimator of scale for the bin. The processing circuit is further configured to output an indication of one or more of the outliers to at least one of a memory device a user device or another device on the building management system

Alternative exemplary embodiments relate to other features and combinations of features as may be generally recited in the claims.

The invention relates to a building management system configured to improve building efficiency to enable greater or improved use of renewable energy sources and to provide more comfortable and productive buildings.

A building management system BMS is in general hardware and or software configured to control monitor and manage devices in or around a building or building area. BMS subsystems or devices can include heating ventilation and air conditioning HVAC subsystems or devices security subsystems or devices lighting subsystems or devices fire alerting subsystems or devices elevator subsystems or devices other devices that are capable of managing building functions or any combination thereof.

Referring now to a block diagram of a system including a smart building manager is shown according to an exemplary embodiment. Smart building manager is connected to a smart grid and a plurality of building subsystems . The building subsystems may include a building electrical subsystem an information communication technology ICT subsystem a security subsystem a HVAC subsystem a lighting subsystem a lift escalators subsystem and a fire safety subsystem . The building subsystems can include fewer additional or alternative subsystems. For example building subsystems may also or alternatively include a refrigeration subsystem an advertising or signage subsystem a cooking subsystem a vending subsystem or a printer or copy service subsystem. Conventionally these systems are autonomous and managed by separate control systems. The smart building manager described herein is configured to achieve energy consumption and energy demand reductions by integrating the management of the building subsystems.

Each of building subsystems includes any number of devices controllers and connections for completing its individual functions and control activities. For example HVAC subsystem may include a chiller a boiler any number of air handling units economizers field controllers supervisory controllers actuators temperature sensors and other devices for controlling the temperature within a building. As another example lighting subsystem may include any number of light fixtures ballasts lighting sensors dimmers or other devices configured to controllably adjust the amount of light provided to a building space. Security subsystem may include occupancy sensors video surveillance cameras digital video recorders video processing servers intrusion detection devices access control devices and servers or other security related devices.

In an exemplary embodiment the smart building manager is configured to include a communications interface to the smart grid outside the building an interface to disparate subsystems within a building e.g. HVAC lighting security lifts power distribution business etc. and an interface to applications network or local for allowing user control and the monitoring and adjustment of the smart building manager or subsystems . Enterprise control applications may be configured to provide subsystem spanning control to a graphical user interface GUI or to any number of enterprise level business applications e.g. accounting systems user identification systems etc. . Enterprise control applications may also or alternatively be configured to provide configuration GUIs for configuring the smart building manager . In yet other embodiments enterprise control applications can work with layers to optimize building performance e.g. efficiency energy use comfort or safety based on inputs received at the interface to the smart grid and the interface to building subsystems . In an exemplary embodiment smart building manager is integrated within a single computer e.g. one server one housing etc. . In various other exemplary embodiments the smart building manager can be distributed across multiple servers or computers e.g. that can exist in distributed locations .

Communications interfaces can be or include wired or wireless interfaces e.g. jacks antennas transmitters receivers transceivers wire terminals etc. for conducting data communications with e.g. smart grid energy providers and purchasers building subsystems or other external sources via a direct connection or a network connection e.g. an Internet connection a LAN WAN or WLAN connection etc. . For example communications interfaces can include an Ethernet card and port for sending and receiving data via an Ethernet based communications link or network. In another example communications interfaces can include a WiFi transceiver for communicating via a wireless communications network. In another example one or both of interfaces may include cellular or mobile phone communications transceivers. In one embodiment communications interface is a power line communications interface and communications interface is an Ethernet interface. In other embodiments both communications interface and communications interface are Ethernet interfaces or are the same Ethernet interface. Further while shows applications and as existing outside of smart building manager in some embodiments applications and may be hosted within smart building manager generally or memory device more particularly.

Referring further to the building subsystem integration layer is configured to manage communications between the rest of the smart building manager s components and the building subsystems. The building subsystem integration layer may also be configured to manage communications between building subsystems. The building subsystem integration layer may be configured to translate communications e.g. sensor data input signals output signals etc. across a plurality of multi vendor multi protocol systems. For example the building subsystem integration layer may be configured to integrate data from subsystems .

In the building subsystem integration layer is shown in greater detail to include a message format and content normalization component . The message format and content normalization component is configured to convert data messages for and from disparately protocolled devices or networks e.g. different building subsystems differently protocolled smart grid sources etc. . The message format and content normalization component is shown to include two subcomponents an application normalization component and a building subsystem normalization component . The application normalization component is a computer function object service or combination thereof configured to drive the conversion of communications for and from applications e.g. enterprise level applications shown in a computerized maintenance management system utility company applications via smart grid shown in etc. . The building subsystem normalization component is a computer function object service or combination thereof configured to drive the conversion of communications for and from building subsystems e.g. building subsystems shown in building subsystem controllers building devices security systems fire systems etc. . The application normalization component and the building subsystem normalization component are configured to accommodate multiple communications or data protocols. In some embodiments the application normalization component and the building subsystem normalization component are configured to conduct the conversion for each protocol based on information stored in modules e.g. a table a script in memory device shown in for each of systems or devices . The protocol modules may be for example schema maps or other descriptions of how a message for one protocol should be translated to a message for a second protocol. In some embodiments the modules may be plug in drivers that can be easily installed to or removed from a building subsystem integration layer e.g. via an executable installation routine by placing a file in an interfaces folder etc. during setup. For example modules may be vendor specific e.g. Johnson Controls Honeywell Siemens etc. standards based e.g. BACnet ANSI C12.19 Lon Works Modbus RIP SNMP SOAP web services HTML HTTP HTTPS XML XAML TFTP DHCP DNS SMTP SNTP etc. user built user selected or user customized. In some embodiments the application normalization component or building subsystem normalization component are configured for compatibility with new modules or drivers e.g. user defined or provided by a vendor or third party . In such embodiments message format and content normalization component may advantageously be scaled for future applications or case specific requirements e.g. situations calling for the use of additional cyber security standards such as data encryption decryption by changing the active module set or by installing a new module.

Using message format and content normalization component the building subsystem integration layer can be configured to provide a service oriented architecture for providing cross subsystem control activities and cross subsystem applications. The message format and content normalization component can be configured to provide a relatively small number of straightforward interfaces e.g. application programming interfaces APIs or protocols e.g. open protocols unified protocols common protocols for use by layers shown in or external applications e.g. shown in and to hide such layers or applications from the complexities of the underlying subsystems and their particular data transport protocols data formats semantics interaction styles and the like. Configuration of the message format and content normalization component may occur automatically e.g. via a building subsystem and device discovery process via user configuration or by a combination of automated discovery and user configuration. User configuration may be driven by providing one or more graphical user interfaces or wizards to a user the graphical user interfaces allowing the user to map an attribute from one protocol to an attribute of another protocol. Configuration tool shown in may be configured to drive such an association process. The configuration tool may be served to clients local or remote via web services and or GUI engine both shown in . The configuration tool may be provided as a thin web client e.g. that primarily interfaces with web services or a thick client e.g. that only occasionally draws upon web services and or GUI engine . Configuration tool may be configured to use a W3C standard intended to harmonize semantic information from different systems to controllably define describe and store relationships between the data protocols e.g. define the modules . For example the W3C standard used may be the Web Ontology Language OWL . In some exemplary embodiments configuration tool may be configured to prepare the message format and content normalization component and device protocol modules thereof for machine level interoperability of data content.

Once the building subsystem integration layer is configured developers of applications may be provided with a software development kit to allow rapid development of applications compatible with the smart building manager e.g. with an application facing protocol or API of the building subsystem integration layer . Such an API or application facing protocol may be exposed at the enterprise integration layer shown in . In various exemplary embodiments the smart building manager including building subsystem integration layer includes the following features or advantages it is seamless in that heterogeneous applications and subsystems may be integrated without varying or affecting the behavior of the external facing interfaces or logic it is open in that it allows venders to develop products and applications by coding adapters e.g. modules shown in or features according to a well defined specification it is multi standard in that it supports subsystems that operate according to standards as well as proprietary protocols it is extensible in that it accommodates new applications and subsystems with little to no modification it is scalable in that it supports many applications and subsystems it is adaptable in that it allows for the addition or deletion of applications or subsystems without affecting system consistency it is user configurable in that it is adjustable to changes in the business environment business rules or business workflows and it is secure in that it protects information transferred through the integration channel. Additional details with respect to building subsystem integration layer are described below with respect to .

Referring further to the integrated control layer is configured to use the data input or output of the building subsystem integration layer to make control decisions. Due to the subsystem integration provided by the building subsystem integration layer the integrated control layer can integrate control activities of the subsystems such that the subsystems behave as a single integrated supersystem. In an exemplary embodiment the integrated control layer includes control logic that uses inputs and outputs from a plurality of building subsystems to provide greater comfort and energy savings relative to the comfort and energy savings that separate subsystems could provide alone. For example information from a first building subsystem may be used to control a second building subsystem. By way of a more particular example when a building employee badges in at a parking garage a message may be sent from the parking subsystem to the building subsystem integration layer converted into an event recognized as a universal occupancy e.g. badge in event and provided to integrated control layer . Integrated control layer may include logic that turns on the lights in the building employee s office begins cooling the building employee s office in response to the anticipated occupancy and boots up the employee s computer. The decision to turn the devices on is made by integrated control layer and integrated control layer may cause proper on commands to be forwarded to the particular subsystems e.g. the lighting subsystem the IT subsystem the HVAC subsystem . The integrated control layer passes the on commands through building subsystem integration layer so that the messages are properly formatted or protocolled for receipt and action by the subsystems. As is illustrated in the integrated control layer is logically above the building subsystems and building subsystem controllers. The integrated control layer by having access to information from multiple systems is configured to use inputs from one or more building subsystems to make control decisions for control algorithms of other building subsystems. For example the badge in event described above can be used by the integrated control layer e.g. a control algorithm thereof to provide new setpoints to an HVAC control algorithm of the HVAC subsystem.

While conventional building subsystem controllers are only able to process inputs that are directly relevant to the performance of their own control loops the integrated control layer is configured to use an input from a first subsystem to make an energy saving control decision for a second subsystem. Results of these decisions can be communicated back to the building subsystem integration layer via for example the message format and content normalization component shown in . Therefore advantageously regardless of the particular HVAC system or systems connected to the smart building manager and due to the normalization at the building subsystem integration layer the integrated control layer s control algorithms can determine a control strategy using normalized temperature inputs and provide an output including a normalized setpoint temperature to the building subsystem integration layer. The building subsystem integration layer can translate the normalized setpoint temperature into a command specific to the building subsystem or controller for which the setpoint adjustment is intended. If multiple subsystems are utilized to complete the same function e.g. if multiple disparately protocolled HVAC subsystems are provided in different regions of a building the building subsystem integration layer can convert a command decision e.g. to lower the temperature setpoint by 2 degrees to multiple different commands for receipt and action by the multiple disparately protocolled HVAC subsystems. In this way functions of the integrated control layer may be executed using the capabilities of building subsystem integration layer . In an exemplary embodiment the integrated control layer is configured to conduct the primary monitoring of system and subsystem statuses and interrelationships for the building. Such monitoring can cross the major energy consuming subsystems of a building to allow for cross subsystem energy savings to be achieved e.g. by the demand response layer .

The integrated control layer is shown to be logically below the demand response layer . The integrated control layer is configured to enhance the effectiveness of the demand response layer by enabling building subsystems and their respective control loops to be controlled in coordination with the demand response layer . This configuration may advantageously reduce disruptive demand response behavior relative to conventional systems. For example the integrated control layer may be configured to assure that a demand response driven upward adjustment to the setpoint for chilled water temperature or another component that directly or indirectly affects temperature does not result in an increase in fan energy or other energy used to cool a space that would result in greater total building energy use than was saved at the chiller. The integrated control layer may also be configured to provide feedback to the demand response layer so that the demand response layer checks that constraints e.g. temperature lighting levels etc. are properly maintained even while demanded load shedding is in progress. The constraints may also include setpoint or sensed boundaries relating to safety equipment operating limits and performance comfort fire codes electrical codes energy codes and the like. The integrated control layer is also logically below the fault detection and diagnostics layer and the automated measurement and validation layer . The integrated control layer may be configured to provide calculated inputs e.g. aggregations to these higher levels based on outputs from more than one building subsystem.

Control activities that may be completed by the integrated control layer e.g. software modules or control algorithms thereof include occupancy based control activities. Security systems such as radio frequency location systems RFLS access control systems and video surveillance systems can provide detailed occupancy information to the integrated control layer and other building subsystems via the smart building manager and more particularly via the building subsystem integration layer . Integration of an access control subsystem and a security subsystem for a building may provide detailed occupancy data for consumption by the integrated control layer e.g. beyond binary occupied or unoccupied data available to some conventional HVAC systems that rely on for example a motion sensor . For example the exact number of occupants in the building or building zone floor conference room etc. may be provided to the integrated control layer or aggregated by the integrated control layer using inputs from a plurality of subsystems. The exact number of occupants in the building can be used by the integrated control layer to determine and command appropriate adjustments for building subsystems such as HVAC subsystem or lighting subsystem . Integrated control layer may be configured to use the number of occupants for example to determine how many of the available elevators to activate in a building. If the building is only 20 occupied the integrated control layer for example may be configured to power down 80 of the available elevators for energy savings. Further occupancy data may be associated with individual workspaces e.g. cubicles offices desks workstations etc. and if a workspace is determined to be unoccupied by the integrated control layer a control algorithm of the integrated control layer may allow for the energy using devices serving the workspace to be turned off or commanded to enter a low power mode. For example workspace plug loads task lighting computers and even phone circuits may be affected based on a determination by the integrated control layer that the employee associated with the workspace is on vacation e.g. using data inputs received from a human resources subsystem . Significant electrical loads may be shed by the integrated control layer including for example heating and humidification loads cooling and dehumidification loads ventilation and fan loads electric lighting and plug loads e.g. with secondary thermal loads electric elevator loads and the like. The integrated control layer may further be configured to integrate an HVAC subsystem or a lighting subsystem with sunlight shading devices or other smart window technologies. Natural day lighting can significantly offset lighting loads but for optimal comfort may be controlled by the integrated control layer to prevent glare or over lighting. Conversely shading devices and smart windows may also be controlled by the integrated control layer to calculably reduce solar heat gains in a building space which can have a significant impact on cooling loads. Using feedback from sensors in the space and with knowledge of the HVAC control strategy the integrated control layer may further be configured to control the transmission of infrared radiation into the building minimizing thermal transmission when the HVAC subsystem is cooling and maximizing thermal transmission when the HVAC subsystem is heating. As a further example of an occupancy based control strategy that may be implemented by the integrated control layer inputs from a video security subsystem may be analyzed by a control algorithm of the integrated control layer to make a determination regarding occupancy of a building space. Using the determination the control algorithm may turn off the lights adjust HVAC set points power down ICT devices serving the space reduce ventilation and the like enabling energy savings with an acceptable loss of comfort to occupants of the building space.

Referring now to a detailed diagram of a portion of smart building manager is shown according to an exemplary embodiment. In particular illustrates a detailed embodiment of integrated control layer . Configuration tools can allow a user to define e.g. via graphical user interfaces via prompt driven wizards etc. how the integrated control layer should react to changing conditions in the building subsystems . In an exemplary embodiment configuration tools allow a user to build and store condition response scenarios that can cross multiple building subsystems and multiple enterprise control applications e.g. work order management system applications entity resource planning ERP applications etc. .

Building subsystems external sources such as smart grid and internal layers such as demand response layer can regularly generate events e.g. messages alarms changed values etc. and provide the events to integrated control layer or another layer configured to handle the particular event. For example demand response DR events e.g. a change in real time energy pricing may be provided to smart building manager as Open Automated Demand Response OpenADR messages a protocol developed by Lawrence Berkeley National Laboratories . The DR messages may be received by OpenADR adapter which may be a part of enterprise application layer shown in . The OpenADR adapter may be configured to convert the OpenADR message into a DR event configured to be understood e.g. parsed interpreted processed etc. by demand response layer . The DR event may be formatted and transmitted according to or via a service bus for the smart building manager .

Service bus adapter may be configured to trap or otherwise receive the DR event on the service bus and forward the DR event on to demand response layer . Service bus adapter may be configured to queue mediate or otherwise manage demand response messages for demand response layer . Once a DR event is received by demand response layer logic thereof can generate a control trigger in response to processing the DR event. The integrated control engine of integrated control layer is configured to parse the received control trigger to determine if a control strategy exists in control strategy database that corresponds to the received control trigger. If a control strategy exists integrated control engine executes the stored control strategy for the control trigger. In some cases the output of the integrated control engine will be an apply policy message for business rules engine to process. Business rules engine may process an apply policy message by looking up the policy in business rules database . A policy in business rules database may take the form of a set of action commands for sending to building subsystems . The set of action commands may include ordering or scripting for conducting the action commands at the correct timing ordering or with other particular parameters. When business rules engine processes the set of action commands therefore it can control the ordering scripting and other parameters of action commands transmitted to the building subsystems .

Action commands may be commands for relatively direct consumption by building subsystems commands for other applications to process or relatively abstract cross subsystem commands. Commands for relatively direct consumption by building subsystems can be passed through service bus adapter to service bus and to a subsystem adapter for providing to a building subsystem in a format particular to the building subsystem. Commands for other applications to process may include commands for a user interface application to request feedback from a user a command to generate a work order via a computerized maintenance management system CMMS application a command to generate a change in an ERP application or other application level commands.

More abstract cross subsystem commands may be passed to a semantic mediator which performs the task of translating those actions to the specific commands required by the various building subsystems . For example a policy might contain an abstract action to set lighting zone X to maximum light. The semantic mediator may translate this action to a first command such as set level to 100 for lighting object O in controller C and a second command of set lights to on in controller Z zone id no 3141593. In this example both lighting object O in controller C and zone id no 3141593 in controller Z may affect lighting in zone X. Controller C may be a dimming controller for accent lighting while controller Z may be a non dimming controller for the primary lighting in the room. The semantic mediator is configured to determine the controllers that relate to zone X using ontology database . Ontology database stores a representation or representations of relationships the ontology between building spaces and subsystem elements and subsystems elements and concepts of the integrated building supersystem. Using the ontology stored in ontology database the semantic mediator can also determine that controller C is dimming and requires a numerical percentage parameter while controller Z is not dimming and requires only an on or off command. Configuration tool can allow a user to build the ontology of ontology database by establishing relationships between subsystems building spaces input output points or other concepts objects of the building subsystems and the building space.

Events other than those received via OpenADR adapter demand response layer or any other specific event handing mechanism can be trapped by subsystem adapter a part of building integration subsystem layer and provided to a general event manager via service bus and a service bus adapter. By the time an event from a building subsystem is received by event manager it may have been converted into a unified event i.e. common event standardized event etc. by subsystem adapter and or other components of building subsystem integration layer such as semantic mediator . The event manager can utilize an event logic DB to lookup control triggers control trigger scripts or control trigger sequences based on received unified events. Event manager can provide control triggers to integrated control engine as described above with respect to demand response layer . As events are received they may be archived in event history by event manager . Similarly demand response layer can store DR events in DR history . One or both of event manager and demand response layer may be configured to wait until multi event conditions are met e.g. by processing data in history as new events are received . For example demand response layer may include logic that does not act to reduce energy loads until a series of two sequential energy price increases are received. In an exemplary embodiment event manager may be configured to receive time events e.g. from a calendaring system . Different time events can be associated with different triggers in event logic database .

In an exemplary embodiment the configuration tools can be used to build event conditions or trigger conditions in event logic or control strategy database . For example the configuration tools can provide the user with the ability to combine data e.g. from subsystems from event histories using a variety of conditional logic. In varying exemplary embodiments the conditional logic can range from simple logical operators between conditions e.g. AND OR XOR etc. to pseudo code constructs or complex programming language functions allowing for more complex interactions conditional statements loops etc. . The configuration tools can present user interfaces for building such conditional logic. The user interfaces may allow users to define policies and responses graphically. In some embodiments the user interfaces may allow a user to select a pre stored or pre constructed policy and adapt it or enable it for use with their system.

Referring still to in some embodiments integrated control layer generally and integrated control engine can operate as a service that can be used by higher level layers of smart building manager enterprise applications or subsystem logic whenever a policy or sequence of actions based on the occurrence of a condition is to be performed. In such embodiments control operations do not need to be reprogrammed. Instead applications or logic can rely on the integrated control layer to receive an event and to execute the related subsystem functions. For example demand response layer fault detection and diagnostics layer shown in enterprise integration and applications may all utilize a shared control strategy and integrated control engine to initiate response sequences to events.

Referring now to the fault detection and diagnostics FDD layer is shown in greater detail according to an exemplary embodiment. Fault detection and diagnostics FDD layer is configured to provide on going fault detection of building subsystems building subsystem devices and control algorithms of the integrated control layer. The FDD layer may receive its inputs from the integrated control layer directly from one or more building subsystems or devices or from the smart grid. The FDD layer may automatically diagnose and respond to detected faults. The responses to detected or diagnosed faults may include providing an alert message to a user a maintenance scheduling system or a control algorithm configured to attempt to repair the fault or to work around the fault. In other exemplary embodiments FDD layer is configured to provide fault events to integrated control layer as described with reference to and the integrated control layer of is configured to execute control strategies and policies in response to the received fault events. According to an exemplary embodiment the FDD layer or a policy executed by an integrated control engine or business rules engine may shut down systems or direct control activities around faulty devices or systems to reduce energy waste extend equipment life or assure proper control response. The FDD layer may be configured to use statistical analysis of near real time or historical building subsystem data to rapidly identify faults in equipment operation.

As shown in the FDD layer is configured to store or access a variety of different system data stores or data points for live data . FDD layer may use some content of data stores to identify faults at the equipment level e.g. specific chiller specific AHU specific terminal unit etc. and other content to identify faults at component or subsystem levels. The FDD layer may be configured to output a specific identification of the faulty component or cause of the fault e.g. loose damper linkage using detailed subsystem inputs available at the building subsystem integration layer shown in previous Figures . Such specificity and determinations may be calculated by the FDD layer based on such subsystem inputs and for example automated fault detection module . Automated fault detection module can utilize pattern recognition methods pattern classification methods rule based classification methods outlier analysis statistical quality control charting techniques or the like to conduct its statistical analysis. In some embodiments automated fault detection module more particularly is configured to calculate or update performance indices .

Performance indices may be calculated based on exponentially weighted moving averages EWMAs to provide statistical analysis features which allow outlier and statistical process control SPC techniques to be used to identify faults. For example the FDD layer may be configured to use meter data outliers to detect when energy consumption becomes abnormal. Statistical fault detection module may also or alternatively be configured to analyze the meter data using statistical methods that provide for data clustering outlier analysis or quality control determinations. The meter data may be received from for example a smart meter a utility or calculated based on the building use data available to the smart building manager.

Once a fault is detected by the FDD layer e.g. by statistical fault detection module the FDD layer may be configured to generate one or more alarms or events to prompt manual fault diagnostics or to initiate an automatic fault diagnostics activity via automated diagnostics module . Automatic fault diagnostics module may be configured to use meter data weather data model data e.g. performance models based on historical building equipment performance building subsystem data performance indices or other data available at the building subsystem integration layer to complete its fault diagnostics activities.

In an exemplary embodiment when a fault is detected the automated diagnostics module is configured to investigate the fault by initiating expanded data logging and error detection diagnostics activities relative to the inputs outputs and systems related to the fault. For example the automated diagnostics module may be configured to poll sensors associated with an air handling unit AHU e.g. temperature sensors for the space served by the AHU air flow sensors position sensors etc. on a frequent or more synchronized basis to better diagnose the source of a detected AHU fault.

Automated fault diagnostics module may further be configured to compute residuals differences between measured and expected values for analysis to determine the fault source. For example automated fault diagnostics module may be configured to implement processing circuits or methods described in U.S. patent application Ser. No. 12 487 594 filed Jun. 18 2009 titled Systems and Methods for Fault Detection of Air Handling Units the entirety of which is incorporated herein by reference. Automated fault diagnostics module can use a finite state machine and input from system sensors e.g. temperature sensors air mass sensors etc. to diagnose faults. State transition frequency e.g. between a heating state a free cooling state and a mechanical cooling state may also be used by the statistical fault detection module and the automated diagnostics module to identify and diagnose unstable control issues. The FDD layer may also or alternatively be configured for rule based predictive detection and diagnostics e.g. to determine rule thresholds to provide for continuous monitoring and diagnostics of building equipment .

In addition to or as an alternative to an automated diagnostics process provided by automated diagnostics module FDD layer can drive a user through a manual diagnostic process using manual diagnostics module . One or both of automated diagnostics module and manual diagnostics module can store data regarding the fault and the diagnosis thereof for further assessment by manual or automated fault assessment engine . Any manually driven process of assessment engine can utilize graphical or textual user interfaces displayed to a user to receive feedback or input from a user. In some embodiments assessment engine will provide a number of possible reasons for a fault to the user via a GUI. The user may select one of the faults for manual investigation or calculation. Similarly an automated process of assessment engine may be configured to select the most probable cause for a fault based on diagnostics provided by modules or . Once a cause is detected or estimated using assessment engine a work order can be generated by work order generation and dispatch service . Work order generation and dispatch service can transmit the work order to a service management system or a work dispatch service for action.

Data and processing results from modules or other data stored or modules of a fault detection and diagnostics layer can be provided to the enterprise integration layer shown in . Monitoring and reporting applications can then access the data or be pushed the data so that real time system health dashboards can be viewed and navigated by a user e.g. a building engineer . For example monitoring and reporting applications may include a web based monitoring application that includes several graphical user interface GUI elements e.g. widgets dashboard controls windows etc. for displaying key performance indicators KPI or other information to users of a GUI using FDD layer information or analyses. In addition the GUI elements may summarize relative energy use and intensity across different buildings real or modeled different campuses or the like. Other GUI elements or reports may be generated and shown based on available data that allow facility managers to assess performance across a group of buildings from one screen. The user interface or report or underlying data engine may be configured to aggregate and categorize faults by building building type equipment type fault type times of occurrence frequency of occurrence severity and the like. The GUI elements may include charts or histograms that allow the user to visually analyze the magnitude of occurrence of specific faults or equipment for a building time frame or other grouping. A time series pane of the GUI may allow users to diagnose a fault remotely by analyzing and comparing interval time series data trends and patterns for various input output points tracked logged by the FDD layer . The FDD layer may include one or more GUI servers or services e.g. a web service to support such applications. Further in some embodiments applications and GUI engines may be included outside of the FDD layer e.g. monitoring and reporting applications shown in web services shown in GUI engine shown in . The FDD layer may be configured to maintain detailed historical databases e.g. relational databases XML databases etc. of relevant data and includes computer code modules that continuously frequently or infrequently query aggregate transform search or otherwise process the data maintained in the detailed databases. The FDD layer may be configured to provide the results of any such processing to other databases tables XML files or other data structures for further querying calculation or access by for example external monitoring and reporting applications.

In an exemplary embodiment the automated diagnostics module automatically prioritizes detected faults. The prioritization may be conducted based on customer defined criteria. The prioritization may be used by the manual or automated fault assessment module to determine which faults to communicate to a human user via a dashboard or other GUI. Further the prioritization can be used by the work order dispatch service to determine which faults are worthy of immediate investigation or which faults should be investigated during regular servicing rather than a special work request. The FDD layer may be configured to determine the prioritization based on the expected financial impact of the fault. The fault assessment module may retrieve fault information and compare the fault information to historical information. Using the comparison the fault assessment module may determine an increased energy consumption and use pricing information from the smart grid to calculate the cost over time e.g. cost per day . Each fault in the system may be ranked according to cost or lost energy. The fault assessment module may be configured to generate a report for supporting operational decisions and capital requests. The report may include the cost of allowing faults to persist energy wasted due to the fault potential cost to fix the fault e.g. based on a service schedule or other overall metrics such as overall subsystem or building reliability e.g. compared to a benchmark . The fault assessment module may further be configured to conduct equipment hierarchy based suppression of faults e.g. suppressed relative to a user interface suppressed relative to further diagnostics etc. . For such suppression module may use the hierarchical information available at e.g. integrated control layer or building subsystem integration layer shown in . For example module may utilize building subsystem hierarchy information stored in ontology database to suppress lower level faults in favor of a higher level fault suppress faults for a particular temperature sensor and air handling unit in favor of a fault that communicates Inspect HVAC Components Serving Conference Room .

FDD layer may also receive inputs from lower level FDD processes. For example FDD layer may receive inputs from building subsystem supervisory controllers or field controllers having FDD features. In an exemplary embodiment FDD layer may receive FDD events process the received FDD events query the building subsystems for further information or otherwise use the FDD events in an overall FDD scheme e.g. prioritization and reporting . U.S. Pat. No. 6 223 544 titled Integrated Control and Fault Detection of HVAC Equipment issued May 1 2001 incorporated herein by reference and U.S. Pub. No. 2009 0083583 titled Fault Detection Systems and Methods for Self Optimizing Heating Ventilation and Air Conditioning Controls filed Nov. 25 2008 published Mar. 26 2009 incorporated herein by reference may be referred to as examples of FDD systems and methods that may be implemented by FDD layer and or lower level FDD processes for providing information to FDD layer .

In some exemplary embodiments the DR layer may include a control module configured to actively initiate control actions e.g. automatically changing setpoints which minimize energy costs based on one or more inputs representative of or based on demand e.g. price a curtailment signal a demand level etc. . The DR layer may further include or draw upon one or more DR policy definitions e.g. databases XML files etc. . The policy definitions may be edited or adjusted by a user e.g. via a graphical user interface so that the control actions initiated in response to demand inputs may be tailored for the user s application desired comfort level particular building equipment or based on other concerns. For example the DR policy definitions can specify which equipment may be turned on or off in response to particular demand inputs how long a system or piece of equipment should be turned off what setpoints can be changed what the allowable set point adjustment range is how long to hold a high demand setpoint before returning to a normally scheduled setpoint how close to approach capacity limits which equipment modes to utilize the energy transfer rates e.g. the maximum rate an alarm rate other rate boundary information etc. into and out of energy storage devices e.g. thermal storage tanks battery banks etc. and when to dispatch on site generation of energy e.g. via fuel cells a motor generator set etc. . One or more of the policies and control activities may be located within control strategy database or business rules database . Further as described above with reference to some of the DR responses to events may be processed and completed by integrated control layer with or without further inputs or processing by DR layer .

A plurality of market based DR inputs and reliability based DR inputs may be configured e.g. via the DR policy definitions or other system configuration mechanisms for use by the DR layer . The smart building manager may be configured e.g. self configured manually configured configured via DR policy definitions etc. to select deselect or differently weigh varying inputs in the DR layer s calculation or execution of control strategies based on the inputs. DR layer may automatically or via the user configuration calculate outputs or control strategies based on a balance of minimizing energy cost and maximizing comfort. Such balance may be adjusted e.g. graphically via rule sliders etc. by users of the smart building manager via a configuration utility or administration GUI.

The DR layer may be configured to receive inputs from other layers e.g. the building subsystem integration layer the integrated control layer etc. . The inputs received from other layers may include environmental or sensor inputs such as temperature carbon dioxide levels relative humidity levels air quality sensor outputs occupancy sensor outputs room schedules and the like. The inputs may also include inputs such as electrical use e.g. expressed in kWh thermal load measurements pricing information projected pricing smoothed pricing curtailment signals from utilities and the like from inside the system from the smart grid or from other remote sources.

Some embodiments of the DR layer may utilize industry standard open protocols or emerging National Institute of Standards and Technology NIST standards to receive real time pricing RTP or curtailment signals from utilities or power retailers. In other embodiments proprietary protocols or other standards may be utilized. As mentioned above in some exemplary embodiments the DR layer is configured to use the OpenADR protocol to receive curtailment signals or RTP data from utilities other independent system operators ISOs or other smart grid sources. The DR layer or another layer e.g. the enterprise integration layer that serves the DR layer may be configured to use one or more security schemes or standards such as the Organization for the Advancement of Structured Information Standards OASIS Web Service Security Standards to provide for secure communications to from the DR layer and the smart grid e.g. a utility company s data communications network . If the utility does not use a standard protocol e.g. the OpenADR protocol the DR layer the enterprise integration layer or the building subsystem integration layer may be configured to translate the utility s protocol into a format for use by the utility. The DR layer may be configured to bi directionally communicate with the smart grid or energy providers and purchasers e.g. a utility an energy retailer a group of utilities an energy broker etc. to exchange price information demand information curtailable load calculations e.g. the amount of load calculated by the DR layer to be able to be shed without exceeding parameters defined by the system or user load profile forecasts and the like. DR layer or an enterprise application in communication with the DR layer may be configured to continuously monitor pricing data provided by utilities ISOs across the nation to parse the useful information from the monitored data and to display the useful information to a user to or send the information to other systems or layers e.g. integrated control layer .

The DR layer may be configured to include one or more adjustable control algorithms in addition to or as an alternative from allowing the user creation of DR profiles. For example one or more control algorithms may be automatically adjusted by the DR layer using dynamic programming or model predictive control modules. In one embodiment business rules engine is configured to respond to a DR event by adjusting a control algorithm or selecting a different control algorithm to use e.g. for a lighting system for an HVAC system for a combination of multiple building subsystems etc. .

The smart building manager e.g. using the demand response layer can be configured to automatically or with the help of a user manage energy spend. The smart building manager with input from the user or operating using pre configured business rules shown in may be configured to accept time of use pricing signals or information from a smart grid e.g. an energy provider a smart meter etc. and using its knowledge of historical building system data control algorithms calendar information and or weather information received from a remote source may be configured to conduct automatic cost forecasting. The smart building manager e.g. the demand response layer may automatically or with user approval take specific load shedding actions or control algorithm changes in response to different cost forecasts.

The smart building manager may also be configured to monitor and control energy storage systems e.g. thermal electrical etc. and distributed generation systems e.g. a solar array for the building etc. . The smart building manager or DR layer may also be configured to model utility rates to make decisions for the system. All of the aforementioned processing activities or inputs may be used by the smart building manager and more particularly a demand response layer thereof to limit cap profit from or otherwise manage the building or campus s energy spend. For example using time of use pricing information for an upcoming hour that indicates an unusually high price per kilowatt hour the system may use its control of a plurality of building systems to limit cost without too drastically impacting occupant comfort. To make such a decision and to conduct such activity the smart building manager may use data such as a relatively high load forecast for a building and information that energy storage levels or distributed energy levels are low. The smart building manager may accordingly adjust or select a control strategy to reduce ventilation levels provided to unoccupied areas reduce server load raise a cooling setpoint throughout the building reserve stored power for use during the expensive period of time dim lights in occupied areas turn off lights in unoccupied areas and the like.

The smart building manager may provide yet other services to improve building or grid performance. For example the smart building manager may provide for expanded user driven load control allowing a building manager to shed loads at a high level of system device granularity . The smart building manager may also monitor and control power switching equipment to route power to from the most efficient sources or destinations. The smart building manager may communicate to the power switching equipment within the building or campus to conduct smart voltage regulation. For example in the event of a brownout the smart building manager may prioritize branches of a building s internal power grid tightly regulating and ensuring voltage to high priority equipment e.g. communications equipment data center equipment cooling equipment for a clean room or chemical factory etc. while allowing voltage to lower priority equipment to dip or be cut off by the smart grid e.g. the power provider . The smart building manager or the DR layer may plan these activities or proactively begin load shedding based on grid services capacity forecasting conducted by a source on the smart grid or by a local algorithm e.g. an algorithm of the demand response layer . The smart building manager or the DR layer may further include control logic for purchasing energy selling energy or otherwise participating in a real time or near real time energy market or auction. For example if energy is predicted to be expensive during a time when the DR layer determines it can shed extra load or perhaps even enter a net positive energy state using energy generated by solar arrays or other energy sources of the building or campus the DR layer may offer units of energy during that period for sale back to the smart grid e.g. directly to the utility to another purchaser in exchange for carbon credits etc. .

In some exemplary embodiments the DR layer may also be configured to support a Grid Aware plug in hybrid electric vehicle PHEV electric vehicle charging system instead of or in addition to having the charging system in the vehicles be grid aware. For example in buildings that have vehicle charging stations e.g. terminals in a parking lot for charging an electric or hybrid vehicle the DR layer can decide when to charge the vehicles e.g. when to enable the charging stations when to switch a relay providing power to the charging stations etc. based upon time real time pricing RTP information from the smart grid or other pricing demand or curtailment information from the smart grid. In other embodiments each vehicle owner could set a policy that is communicated to the charging station and back to the DR layer via wired or wireless communications that the DR layer could be instructed to follow. The policy information could be provided to the DR layer via an enterprise application a vehicle information system or a personal portal e.g. a web site vehicle owners are able to access to input for example at what price they would like to enable charging . The DR layer could then activate the PHEV charging station based upon that policy unless a curtailment event is expected or occurs or unless the DR layer otherwise determines that charging should not occur e.g. decides that electrical storage should be conducted instead to help with upcoming anticipated peak demand . When such a decision is made the DR layer may pre charge the vehicle or suspend charge to the vehicle e.g. via a data command to the charging station . Vehicle charging may be restricted or turned off by the smart building manager during periods of high energy use or expensive energy. Further during such periods the smart building manager or the DR layer may be configured to cause energy to be drawn from plugged in connected vehicles to supplement or to provide back up power to grid energy.

Using the real time or near real time detailed information regarding energy use in the building the smart building manager may maintain a greenhouse gas inventory forecast renewable energy use surpluses deficits and generation and facilitate emission allocation emission trading and the like. Due to the detailed and real time or near real time nature of such calculations the smart building manager may include or be coupled to a micro transaction emission trading platform.

The DR layer may further be configured to facilitate the storage of on site electrical or thermal storage and to controllably shift electrical loads from peak to off peak times using the stored electrical or thermal storage. The DR layer may be configured to significantly shed loads during peak hours if for example high price or contracted curtailment signals are received using the stored electrical or thermal storage and without significantly affecting building operation or comfort. The integrated control layer may be configured to use a building pre cooling algorithm in the night or morning and rely on calculated thermal storage characteristics for the building in order to reduce peak demand for cooling. Further the integrated control layer may be configured to use inputs such as utility rates type of cooling equipment occupancy schedule building construction climate conditions upcoming weather events and the like to make control decisions e.g. the extent to which to pre cool etc. .

The AM V layer may further be configured to verify that control strategies commanded by for example the integrated control layer or the DR layer are working properly. Further the AM V layer may be configured to verify that a building has fulfilled curtailment contract obligations. The AM V layer may further be configured as an independent verification source for the energy supply company utility . One concern of the utility is that a conventional smart meter may be compromised to report less energy or energy consumed at the wrong time . The AM V layer can be used to audit smart meter data or other data used by the utility by measuring energy consumption directly from the building subsystems or knowledge of building subsystem usage and comparing the measurement or knowledge to the metered consumption data. If there is a discrepancy the AM V layer may be configured to report the discrepancy directly to the utility. Because the AM V layer may be continuously operational and automated e.g. not based on a monthly or quarterly calculation the AM V layer may be configured to provide verification of impact e.g. of demand signals on a granular scale e.g. hourly daily weekly etc. . For example the AM V layer may be configured to support the validation of very short curtailment contracts e.g. drop X kW h over 20 minutes starting at 2 00 pm acted upon by the DR layer . The DR layer may track meter data to create a subhourly baseline model against which to measure load reductions. The model may be based on average load during a period of hours prior to the curtailment event during the five prior uncontrolled days or as specified by other contract requirements from a utility or curtailment service provider e.g. broker . The calculations made by the AM V layer may be based on building system energy models and may be driven by a combination of stipulated and measured input parameters to estimate calculate apportion and or plan for load reductions resulting from the DR control activities.

The AM V layer may yet further be configured to calculate energy savings and peak demand reductions in accordance with standards protocols or best practices for enterprise accounting and reporting on greenhouse gas GHG emissions. An application may access data provided or calculated by the AM V layer to provide for web based graphical user interfaces or reports. The data underlying the GUIs or reports may be checked by the AM V layer according to for example the GHG Protocol Corporate Accounting Standard and the GHG Protocol for Project Accounting. The AM V layer preferably consolidates data from all the potential sources of GHG emissions at a building or campus and calculates carbon credits energy savings in dollars or any other currency or unit of measure makes adjustments to the calculations or outputs based on any numbers of standards or methods and creates detailed accountings or inventories of GHG emissions or emission reductions for each building. Such calculations and outputs may allow the AM V layer to communicate with electronic trading platforms contract partners or other third parties in real time or near real time to facilitate for example carbon offset trading and the like.

The AM V Layer may be further configured to become a smart electric meter a or substitute for conventional electric meters. One reason the adoption rate of the Smart Electric Grid has conventionally been low is that currently installed electric meters must be replaced so that the meters will support Real Time Pricing RTP of energy and other data communications features. The AM V layer can collect interval based electric meter data and store the data within the system. The AM V layer can also communicate with the utility to retrieve or otherwise receive Real Time Pricing RTP signals or other pricing information and associate the prices with the meter data. The utility can query this information from the smart building manager e.g. the AM V layer the DR layer at the end of a billing period and charge the customer using a RTP tariff or another mechanism. In this manner the AM V layer can be used as a Smart Electric Meter .

When the AM V layer is used in conjunction with the DR layer building subsystem integration layer and enterprise integration layer the smart building manager can be configured as an energy service portal ESP . As an ESP the smart building manager may communicably or functionally connect the smart grid e.g. energy supply company utility ISO broker etc. network to the metering and energy management devices in a building e.g. devices built into appliances such as dishwashers or other smart appliances . In other words the smart building manager may be configured to route messages to and from other data aware e.g. Real Time Pricing RTP aware curtailment signal aware pricing aware etc. devices and the energy supply company. In this configuration building subsystems that are not RTP aware will be managed by the DR layer while devices that are RTP aware can get signals directly from the utility. For example if a vehicle e.g. PHEV is programmed to charge only when the price of electricity is below 0.1 kWh the PHEV can query the utility through the smart building manager and charge independently from the DR layer .

In an exemplary embodiment the AM V layer described in U.S. Provisional Application No. 61 302 854 filed Feb. 9 2010 can be used as AM V layer or a part thereof.

The enterprise integration layer shown in or is configured to serve clients or local applications with information and services to support a variety of enterprise level applications. The enterprise integration layer may be configured to communicate in real time or near real time with the smart grid and energy providers and purchasers . More particularly in some embodiments the enterprise integration layer may communicate with smart meters automated meter interfaces with utilities carbon emission tracking and accounting systems energy reporting systems a building occupant interface and traditional enterprise productivity applications e.g. maintenance management systems financial systems workplace and supply chain management systems etc. . The enterprise integration layer may be configured to use protocols and methods as described above with respect to other layers or otherwise.

Referring again to the smart building manager may be configured to provide drivers for BACnet LON N2 Modbus OPC OBIX MIG SMTP XML Web services and various other wireless communications protocols including Zigbee. These drivers may be implemented within or used by the service bus adapters or subsystem adapters. The service bus for the smart building manager may be configured to communicate using any number of smart grid communications standards. Such standards may be utilized for intra manager communication as well as communication with a smart grid component e.g. utility company smart meter etc. . For example the smart building manager may be configured to use the ANSI C12.22 C12.19 protocol for some internal communications e.g. DR events as well as for communications with the smart grid. The service bus adapters and subsystem adapters convert received messages into a normalized messaging format for use on the service bus. In an exemplary embodiment the service bus is flexible making use of IT centric message queuing technologies e.g. Open AMQ MSMQ and WebSphere MQ to assure reliability security scalability and performance. Service bus adapters enable layers and applications to communicate among one another and or to the various in building or external systems e.g. via subsystem adapters . Stored communications rules may be used by the service bus adapters subsystem adapters or other components of the system to catch or correct communications failures. Communications and action failure rules may also be configured for use by the action layers of the system. For example the DR layer can check for whether an action requested or commanded by the DR layer has completed. If not the DR layer can take a different action or a corrective action e.g. turn off an alternate load adjust additional setpoints trigger a focused FDD activity etc. to ensure that DR needs are met. The smart building manager can also determine if someone has provided a DR override command to the system and take corrective action if available. If corrective action is unavailable an appropriate message or warning may be sent to a DR partner e.g. a utility co. an energy purchaser via the smart grid etc. .

The smart building manager may reside on e.g. be connected to an IP Ethernet network utilizing standard network infrastructure protocols and applications e.g. DNS DHCP SNTP SNMP Active Directory etc. and can also be secured using IT security best practices for those standard network infrastructure protocols and applications. For example in some embodiments the smart building manager may include or be installed behind infrastructure software or hardware such as firewalls or switches. Further configurations in the smart building manager can be used by the system to adjust the level of security of the smart building manager . For example the smart building manager or particular components thereof can be configured to allow its middle layers or other components to communicate only with each other to communicate with a LAN WAN or Internet to communicate with select devices having a building service or to restrict communications with any of the above mentioned layers components data sources networks or devices. The smart building manager may be configured to support a tiered network architecture approach to communications which may provide for some measure of security. Outward facing components are placed in a less secure tier of the network to act as a point of entry to from the smart building manager . These outward facing components are minimized e.g. a web server receives and handles all requests from client applications which limits the number of ways the system can be accessed and provides an indirect communications route between external devices applications and networks and the internal layers or modules of the smart building manager . For example behind the outward facing first tier may lie a more secure tier of the network that requires authentication and authorization to occur at the first tier before functions of the more secure tier are accessed. The smart building manager may be configured to include firewalls between such tiers or to define such tiers to protect databases or core components of the system from direct unauthorized access from outside networks.

In addition to including or implementing infrastructure type security measures as the type disclosed above the smart building manager may be configured to include a communications security module configured to provide network message security between the smart building manager and an outside device or application. For example if SOAP messaging over HTTP is used for communication at the enterprise integration layer the SOAP messages may be concatenated to include an RC2 encrypted header containing authentication credentials. The authentication credentials may be checked by the receiving device e.g. the smart building manager the end application or device etc. . In some embodiments the encrypted header may also contain information e.g. bits configured to identify whether the message was tampered with during transmission has been spoofed or is being replayed by an attacker. If a message does not conform to an expected format or if any part of the authentication fails the smart building manager may be configured to reject the message and any other unauthorized commands to the system. In some embodiments that use HTTP messages between the application and the smart building manager the smart building manager may be configured to provide SSL for message content security encryption and or Forms authentication for message authentication.

The smart building manager may yet further include an access security module that requires any application to be authenticated with user credentials prior to logging into the system. The access security module may be configured to complete a secure authentication challenge accomplished via a public or private key exchange e.g. RSA keys of a session key e.g. an RC2 key after a login with user credentials. The session key is used to encrypt the user credentials for the authentication challenge. After the authentication challenge the session key is used to encrypt the security header of the messages. Once authenticated user actions within the system are restricted by action based authorizations and can be limited. For example a user may be able to command and control HVAC points but may not be able to command and control Fire and Security points. Furthermore actions of a user within the smart building manager are written to memory via an audit trail engine providing a record of the actions that were taken. The database component of the smart building manager e.g. for storing device information DR profiles configuration data pricing information or other data mentioned herein or otherwise can be accessible via an SQL server that is a part of the building management server or located remotely from the smart building manager . For example the database server component of the smart building manager may be physically separated from other smart building manager components and located in a more secure tier of the network e.g. behind another firewall . The smart building manager may use SQL authentication for secure access to one or more of the aforementioned databases. Furthermore in an exemplary embodiment the smart building manager can be configured to support the use of non default instances of SQL and a non default TCP port for SQL. The operating system of the smart building manager may be a Windows based operating system.

Each smart building manager may provide its own security and is not reliant on a central server to provide the security. Further the same robustness of the smart building manager that provides the ability to incorporate new building subsystem communications standards modules drivers and the like also allows it to incorporate new and changing security standards e.g. for each module at a higher level etc. .

The smart building manager shown in the Figures may be configured to support multi campus or multi building energy management services. Each of a plurality of campuses can include a smart building manager configured to manage the building IT and energy resources of each campus. In such an example the building subsystems shown e.g. in may be a collection of building subsystems for multiple buildings in a campus. The smart building manager may be configured to bi directionally communicate with on site power generation systems e.g. distributed power sources related services solar arrays fuel cell arrays diesel generators combined heat and power CHP systems etc. plug in hybrid electric vehicle PHEV systems and energy storage systems e.g. stationary energy storage thermal energy storage etc. . Data inputs from such sources may be used by the demand and response layer of the smart building manager to make demand or response decisions and to provide other ancillary services to a connected smart grid e.g. utility smart meter connected to a utility etc. in real time or near real time. For example the smart building manager may communicate with smart meters associated with an energy utility and directly or indirectly with independent systems operators ISOs which may be regional power providers. Using these communications and its inputs from devices of the campus the smart building manager e.g. the demand response layer is configured to engage in peak shaving load shedding or load balancing programs which provide financial incentives for reducing power draw during certain days or times of day. The demand response layer or other control algorithms of the smart building manager e.g. control algorithms of the integrated control layer may be configured to use weather forecast information to make setpoint or load shedding decisions e.g. so that comfort of buildings in the campus is not compromised . The smart building manager may be configured to use energy pricing information campus energy use information or other information to optimize business transactions e.g. the purchase of energy from the smart grid the sale of energy to the smart grid the purchase or sale of carbon credits with energy providers and purchasers etc. . The smart building manager is configured to use the decisions and processing of the demand response layer to affect control algorithms of the integrated control layer.

While is shown as a tightly coupled smart building manager in some embodiments the processing circuit of including the layers modules thereof may be distributed to different servers that together form the smart building manager having the control features described herein. In embodiments where the smart building manager is controlling an entire campus or set of campuses one or more smart building managers may be layered to effect hierarchical control activities. For example an enterprise level smart building manager may provide overall DR strategy decisions to a plurality of lower level smart building managers that process the strategy decisions e.g. using the framework shown in to effect change at an individual campus or building. By way of further example the integrated control layer and the building system integration layer may be replicated for each building and stored within lower level smart building servers while a single enterprise level smart building manager may provide a single higher level layer such the DR layer. Such a DR layer can execute a campus wide DR strategy by passing appropriate DR events to the separate lower level smart building mangers having integrated control layers and building system integration layers. Higher level servers may provide software interfaces APIs to the one or more lower level servers so that the one or more lower level servers can request information from the higher level server provide commands to the higher level server or otherwise communicate with the layers or data of the higher level server. The reverse is also true APIs or other software interfaces of the lower level servers may be exposed for consumption by the higher level server. The software interfaces may be web services interfaces relational database connections or otherwise.

A moving average can be used as an input to a statistical process control strategy for detecting a variation in the behavior of the building management system. In general moving averages are a class of statistical metrics that utilize previously calculated averages in their computation. Moving averages may advantageously reduce processing times and memory requirements relative to other statistical processing strategies since only a subset of the data values needs to be retained. For example a standard average may be calculated using the formula 

Weighted moving averages are a subclass of moving averages that apply weightings to the various subsets of data. For example a weighted moving average may weight more recent data values higher than older values. In this way the weighted moving average provides a current metric on the underlying data. Exponentially weighted averages EWMAs have been used to diagnose faults in building management controllers. See U.S. Pat. No. 5 682 329 to Seem et al. EWMAs utilize exponential weightings that can be used to give greater emphasis to more recent values. A variety of equations exist for calculating an EWMA. For example an EWMA may be calculated according to the following function 

Embodiments of the present application can include using EWMA based control strategies to detect errors. In one example relating to an HVAC system a building management system controller may sample the position of a damper that it controls. The controller can then calculate the EWMA of the position value. If the EWMA exceeds a threshold the controller may determine that the damper is in a saturation condition. The controller can then notify a user of the potential fault.

In another example a network of controllers may collect EWMA values for a temperature error. A design criterion for the network may be set such that ninety five percent of all controllers should have a temperature error EWMA of below 2 F. An EWMA of the temperature error greater than 2 F. could be used to estimate or predict system faults while an EWMA of less than 2 F. could indicate that the network is working properly.

A statistical process control strategy of varying exemplary embodiments may detect variations in measured data by evaluating the measured data relative to a trained statistical model e.g. a statistical process control chart . The trained statistical model may be based on measurements taken during a training period e.g. while the building management system is operating normally during a steady state operating period etc. . The trained statistical model is used to predict behavior for the building management system under normal operating conditions. Measured data that falls outside of the parameters of the statistical model may be considered to be statistically significant and indicate that the predicted behavior is no longer valid and or that faults exist in the building management system.

Referring now to a flow diagram of a process for using statistical process control to detect faults in a building management system is shown according to an exemplary embodiment. Process includes collecting training data from the building management system step . During the training period training data i.e. performance values are collected to build a history of performance values. For example the performance values may be measured temperature values calculated error rates moving averages measured power consumptions or any other historical performance data. The history of performance values is used to determine if the BMS is operating normally.

Once a sufficient history of performance values has been built the history can be used to generate a statistical model step . Generally speaking the statistical model is a set of metrics based on calculated using or describing the history of performance values. The statistical model is used to predict a behavior of the BMS.

Process is further shown to include calculating an EWMA using new performance values step . The new performance values are collected after the training period. In some embodiments the new performance values are collected by building management controllers and sent via a network to a remote location for calculation of the EWMA. In other embodiments the EWMA is calculated directly on a local BMS controller that collects the performance values.

Process is yet further shown to include comparing the EWMA calculated in step to the statistical model generated in step step . For example the EWMA calculated in step can be compared to the statistical model generated in step to test for statistical significance i.e. if the EWMA is an outlier in relation to the statistical model. If a specified number of outliers are detected the system can determine that the newly observed behavior of the system no longer matches the predicted behavior i.e. described by the statistical model of step and that appropriate action is necessary. If the new performance value is determined to be statistically significant in step i.e. it is an outlier in relation to the statistical model of behavior for that performance value any number of actions may be taken by the BMS and or a user. For example if process is used within fault detection and diagnostics FDD layer statistical significance of new performance values may indicate that a fault condition exists. FDD layer may then notify a user a maintenance scheduling system or a control algorithm configured to attempt to further diagnose the fault to repair the fault or to work around the fault. If process is used in automated measurement and validation AM V layer a statistical significance of new performance values may indicate that a predicted model of a power consumption is no longer valid. AM V layer may then attempt to update the statistical model to better predict future power consumptions and or notify FDD layer that a fault condition may exist.

Referring now to a detailed diagram of a fault detection module is shown according to an exemplary embodiment. Automated fault detection module includes EWMA generator which receives building management system data such as meter data weather data and building subsystem data . EWMA generator calculates exponentially weighted moving averages of the data or a value calculated using the data and outputs them as performance indices . Performance indices may be stored in performance value database .

The EWMAs may be calculated directly on building equipment controllers not shown in and transmitted to automated fault detection module e.g. via a network via communications electronics etc. . In other embodiments some EWMAs are calculated directly on the building equipment controllers while others are calculated remotely by EWMA generator .

EWMA generator may calculate the moving averages by first removing sudden spikes in the data by applying an anti spike filter or an outlier filter. For example EWMA generator may use a generalized extreme studentized distribution method to remove outliers in the building management system data. EWMA generator may also sub sample the building management system data to reduce the effects of autocorrelation in the data. For example a sampling interval greater than or equal to the time constant of the process being controlled by the building equipment controller may be used.

Automated fault detection module includes performance value database . Performance value database can store a history of performance values used by training component to generate statistical models such as model data . In one embodiment the history of performance values stored in performance value database contains a record of EWMAs previously calculated by EWMA generator . In another embodiment performance value database contains a history of raw data values from the building management system.

Automated fault detection module is further shown to include training component which performs statistical operations on the history of performance values to produce one or more threshold parameters as inputs to threshold evaluator . The threshold parameters are statistical predictors of the behavior of the building management system i.e. markers that define a range of normal behavior within a specific statistical confidence. For example training component may generate threshold parameters that define a model wherein 99.7 of values observed during the training period fall within upper and lower temperature threshold parameters.

Automated fault detection module is yet further shown to include threshold parameter evaluator . Threshold parameter evaluator can use the one or more threshold parameters from training component to determine if new performance values are statistically significant. For example threshold parameter evaluator may compare a new EWMA from EWMA generator to a trained threshold parameter to determine if the new EWMA is statistically significant i.e. the new EWMA falls outside of the predicted behavior. If a new performance value is statistically significant threshold parameter evaluator may notify automated diagnostics module manual diagnostics module and or GUI services that a possible fault condition exists. Additionally a user may be notified that a fault may exist by GUI services causing a graphical user interface to be displayed on an electronic display device. The generated graphical user interface can include an indicator that a fault has occurred and information regarding the estimated fault. Threshold parameter evaluator may notify automated diagnostics module manual diagnostics module or GUI services only if a plurality of statistically significant performance values are detected.

In many of the varying exemplary embodiments the statistical model used in the statistical process control strategy may be a statistical process control chart e.g. an EWMA control chart etc. . Such charts typically utilize upper and lower control limits relative to a center line to define the statistical boundaries for the process. New data values that are outside of these boundaries indicate a deviation in the behavior of the process. In some cases the charts may also contain one or more alarm thresholds that define separate alarm regions below the upper control limit and above the lower control limits. A processor utilizing such a chart may determine that a new data value is within or approaching an alarm region and generate an alert initiate a diagnostic routine or perform another action to move the new data values away from the alarm regions and back towards the center line. Although this disclosure variously mentions the term chart many of the exemplary embodiments of the disclosure will operate without storing or displaying a graphical representation of a chart. In such embodiments an information structure suitable for representing the data of a statistical process control chart may be created maintained updated processed and or stored in memory. Description in this disclosure that relates to systems having statistical process control charts or processes acting on or with statistical process control charts is intended to encompass systems and methods that include or act on such suitable information structures.

Referring now to a flow diagram of a process for generating a statistical process control chart is shown according to an exemplary embodiment. Process includes receiving a history of performance values step . The performance values may be data collected by the BMS during normal operations. For example the performance values may be measured temperature values calculated error rates measured power consumptions or any other data that can be used to determine whether the BMS is operating normally. In another embodiment the performance values are exponentially weighted moving averages of data from the BMS. A history of 150 500 performance values may be sufficient to create the statistical model although more or less may be used in varying exemplary embodiments.

Process is also shown to include generating a target parameter step . The target parameter provides a target metric for the system under normal operating conditions. In one embodiment the target parameter is the statistical mean of the history of performance values from step i.e. the simple average of the performance values. In another embodiment the median of the history is used. In yet another embodiment a moving average of the performance values can be used. For example the history of performance values may be measured temperature values that range from 95 F. to 105 F. with a simple average of 100 F. Therefore a target parameter of 100 F. may be used to predict future temperatures for a normally operating BMS. Future performance values that vary greatly from the target parameter may indicate a fault in the BMS a change in behavior of the BMS or that the statistical model needs to be updated.

Process is further shown to include generating an estimator of scale step . Estimators of scale generally provide a metric that describes how spread out a set of performance values is relative to the target parameter. In one embodiment the standard deviation of the history of performance values is calculated using the target parameter from step and the performance values from step . For example the history of performance values may contain measured temperatures that range from 95 F. to 105 F. with a simple average of 100 F. Assuming that the performance values are distributed normally i.e. they conform to a Gaussian distribution a calculated standard deviation of 1.5 F. indicates that approximately 99.7 of the measured temperatures fall within the range of 95.5 F. to 104.5 F. However a non normal distribution of the performance values or the presence of outlier performance values can affect the ability of a standard deviation to gauge the spread of the data.

In an exemplary embodiment a robust estimator of scale is calculated in step . Robust estimators of scale differ from standard estimators of scale such as a standard deviation by reducing the effects of outlying performance values. A variety of different types of robust estimators of scale may be used in conjunction with the present invention. For example a robust estimator of scale that uses a pairwise difference approach may be used. Such approaches typically have a higher Gaussian efficiency than other robust approaches. These approaches provide a useful metric on the interpoint distances between elements of two arrays and can be used to compare a predicted behavior and an observed behavior in the building management system. For example one robust estimator of scale may be defined as 

S c 1.1926 medmed x x where the set of medians for j 1 . . . n is first calculated as an inner operation. Next the median of these results is calculated with respect to the i values. The median result is then multiplied by 1.1926 to provide consistency at normal distributions. A correction factor cmay also be applied and is typically defined as 1 if n is even. If n is odd ccan be calculated as 

In another exemplary embodiment Qmay be used as a robust estimator of scale where Qis defined as Q d 2.2219 1quartile x x i

Process is yet further shown to include generating a threshold parameter step . In some embodiments the threshold may be based on the estimator of scale from step . For example the threshold parameters may be calculated using threshold K where K is a constant is the target parameter and is the estimator of scale.

A threshold parameter can be compared against a new performance value from the BMS to determine whether the new performance value is statistical significant. For example if the history of performance values are measured temperatures that range from 95 F. to 105 F. with a simple average of 100 F. and a standard deviation of 1.5 F. K may be set to 3 to provide an upper threshold parameter of 104.5 F. Assuming that the data values are normally distributed this means that approximately 99.85 of the historical temperatures fall below this threshold parameter. New temperature measurements that are equal to or greater than the threshold parameter may be statistically significant and indicate that a fault condition exists.

Referring now to a more detailed flow diagram of a process for generating a statistical process control chart is shown according to an exemplary embodiment. Process includes receiving a history of performance values from the BMS step . In one embodiment the history of performance values is built during a training period where the BMS is operating normally.

Process is also shown to include checking the history of performance values for autocorrelation step . In general autocorrelation measures how closely a newer set of performance values follows the pattern of previous performance values. Any known method of testing autocorrelation may be used in step . For example a lag one correlation coefficient may be calculated to test for autocorrelation. If the coefficient is high the data is assumed to be autocorrelated. If the coefficient is low the data is assumed not to be autocorrelated.

Process optionally includes checking the history of performance values for normality i.e. how closely the history conforms to a Gaussian distribution step . Any suitable method of testing for normality may be used in step . For example a Lillifors test may be used to test the null hypothesis that the data is normal against the alternative hypothesis that the data is not normal.

Process is further shown to include generating a target parameter using the history of performance values step . The characteristics of the history tested in steps and can be used to determine how the target parameter is generated. Any suitable metrics that reduce the effects of autocorrelation and non normal data may be used. For example if the history is determined not to be autocorrelated in step the median of the history may be used as the target parameter. In other examples the EWMA or the simple mean of the history is used.

If the data is determined to be autocorrelated in step an autoregressive model may be used to fit the data and the residuals used to calculate the target parameter. For example an AR 1 model may be fit to the history using the equation x x ewhere x is a predicted value xis a previous value and are constants and eis a residual. The target parameter can then be calculated using the residual values. For example the target parameter can be the simple mean of the residual values. In other embodiments the target parameter can be the median of the residual values a moving average of the residual values or any other statistical metric that generally corresponds to the center of the distribution of residual values.

Process is yet further shown to include generating an estimator of scale step . The estimator of scale may be generated using the target parameter and or the history of performance values. The type of estimator of scale that is used may be determined based on the results of steps and or the type of target parameter used in step . If the target parameter of step is the median of the history and the history is not autocorrelated a robust estimator of scale may be found for the history itself. However if the data is autocorrelated and the target parameter is determined using an autoregressive model a robust estimator of scale may calculated using the residuals of the autoregressive model. In other embodiments other types of estimators of scale are used such as a standard deviation.

Process is also shown to include generating a threshold parameter step . The threshold parameter may be calculated using the estimator of scale of step and the target parameter of step . In some embodiments the threshold parameter is calculated by multiplying the estimator of scale by a constant and adding or subtracting that value from the target parameter as in step of method . For example if the estimator of scale is a simple standard deviation the constant may be set to 3 to generate upper and lower thresholds that encompass approximately 99.7 of the history. In this way the choice of a constant value may be used to define any number of threshold parameters. In one embodiment the threshold parameter is calculated automatically by the BMS. In another embodiment a user may input a desired threshold parameter using a display device configured to receive user input. In yet another embodiment a hybrid approach may be taken where the BMS automatically calculates the threshold parameter and provided it to a display device for user confirmation of the threshold parameter or input of a different threshold parameter.

The target parameter and one or more threshold parameters generated in process or process may also be used to generate a SPC control chart. In such a case the target parameter may be used as the center line of the chart. The threshold parameters may also be used as upper and lower control limits for the SPC control chart. New data that falls outside of the control limits of the chart may indicate a deviation in the behavior of the associated process.

Referring now to a detailed diagram of training module is shown according to an exemplary embodiment. Training module is shown to include performance value aggregator which generates and maintains a history of performance values. During training performance value aggregator stores performance values from the BMS as performance indices or in performance value database . Performance value aggregator may also be configured to receive an input from automated diagnostics module manual diagnostics module or GUI services that indicates that the system needs to be retrained. If retraining is needed performance value aggregator can update and store new performance values during the new training period. During a training period performance value aggregator can overwrite some data or delete some data e.g. old data faulty data etc. from the its performance value calculation. Once a sufficient number of performance values are collected the training period ends and performance value aggregator retrieves a history of performance values from performance indices or performance value database .

Training module includes autocorrelation evaluator . Autocorrelation evaluator detects autocorrelation in the history of performance values retrieved by performance value aggregator . For example autocorrelation evaluator may use a lag one correlation coefficient method to test for autocorrelation in the history. The results of this determination are then provided to target parameter generator and may be used to determine the method to be used in generating the target parameter.

Training module includes normality evaluator . Normality evaluator determines how closely the history of performance values conforms to a Gaussian distribution i.e. a bell curve. Normal data provides a greater statistical confidence in the model s ability to predict behavior although non normal data can still be used to detect variations in the system s behavior.

Training module is further shown to include target parameter generator which uses the history of performance values from performance value aggregator and the outputs of autocorrelation evaluator and normality evaluator to generate a target parameter. The target parameter provides a statistical center for the statistical model based on the history of performance values. For example target parameter generator may calculate the median of the history of performance values as the target parameter. Once target parameter generator generates a target parameter an estimator of scale is calculated by estimator of scale generator . Estimator of scale generator uses the output of target parameter generator and the history of performance values from performance value aggregator to generate an estimator of scale for the history i.e. a metric on how spread out the distribution of data is. In one embodiment a robust estimator of scale is calculated by estimator of scale generator .

Training module yet further includes threshold parameter generator which uses the outputs of target parameter generator and estimator of scale generator to generate one or more threshold parameters. The one or more threshold parameters are then provided to threshold parameter evaluator for comparison against new performance values.

The method of identifying outliers using statistical control chart limits as described above may be well suited for identifying outliers in systems having homogenous operating conditions i.e. fixed mean and standard deviation . A temporal analysis algorithm may find the target parameter e.g. median and estimator of scale e.g. robust standard deviation of all performance values e.g. EWMAs of BMS data . This approach may work well when the performance values vary randomly throughout the monitored period.

When a system has heterogeneous multi mode operating conditions the mean and standard deviation may not be fixed. In some instances this can make the identification of outliers unreliable or otherwise challenging. In multimodal systems performance values may have in addition to random variations shifts in the distribution mean and standard deviation attributable to different modes of operation that the system goes through during the monitored period. An algorithm using a single fixed target parameter and a single fixed estimator of scale for a multimodal system may have very wide chart control limits i.e. very low sensitivity . Wide chart control limits may lead to an excessive number of missed outliers i.e. type II statistical errors . For example in a system with two operating modes e.g. high and low a performance value that is an outlier with respect to the low operating mode may not be identified as an outlier if the performance value is within the chart control limits generated using a single target parameter and a single estimator of scale for both the high and the low operating modes. Thus the statistical control chart limit method using one target parameter and one estimator of scale to identify outliers may be ineffective for systems with heterogeneous multi mode operating conditions. A robust method for finding outliers in multimodal systems is needed.

According to an exemplary embodiment a graduated statistical process control method for a building management system is provided to detect outliers in a multimodal system. Rather than generating a single target parameter and estimator of scale for an entire monitored period e.g. one day the graduated method divides the monitored period into bins calculates a target parameter and estimator of scale for each bin and detects outliers for each bin based on the corresponding target parameter and estimator of scale. The graduated method may be implemented for systems with multiple operating modes or for systems with only one operating mode.

This method may advantageously reduce the time and cost associated with configuration of a fault detection and diagnostics FDD system. The method of this section may also advantageously reduce the amount of data e.g. configuration information with internal operational modes that needs to be mapped on systems having different operational modes. Because internal mode information may not be available on e.g. third party or antiquated systems a graduated method may be required for effective implementation of the FDD system. Software using the described method may be able to finely track changes in performance of BMS components and find data points that are out of the norm for a bin s population.

Referring to a flow diagram of a process for using a graduated statistical process control method to detect outliers and faults in a building management system is shown according to an exemplary embodiment. Process includes collecting performance values from a BMS . As described in the discussion of the performance values may be any data that can be used to determine whether the BMS is operating normally. Performance values may described as observed points of a variable of the building management system. The performance values may be exponentially weighted moving averages of data from the BMS.

Performance values may be collected with binning parameters associated with each performance value. The system can then use the binning parameters to organize the performance values into bins . Adjacent bins may describe a condition or set of conditions that relate to performance changes of the variable or performance value. For example the condition may be time and adjacent bins may be separated by intervals of time. In some embodiments a binning parameter may indicate the time a performance value was generated. In other embodiments the binning parameter may indicate the outside air temperature at the time the performance value was generated the operating mode of the system etc. More than one binning parameter may be associated with a single performance value. Binning parameters may be associated with a performance value when the performance value is generated. Alternatively binning parameters may be associated with a performance value some time before performance values are organized into bins.

As discussed above process includes organizing performance values into logical bins . A bin may be a collection of performance values that are related by a given parameter. The parameter may be a measurable quantity that relates the performance values within a given bin. For example bins may be based on time. If the bins are based on time the performance values may be collected at equally spaced time intervals e.g. every fifteen minutes during a monitored period e.g. one day . The performance values may also be collected at the same times during every monitored period. For example performance values for seven days may be collected in fifteen minute intervals every day at 6 00 AM 6 15 AM etc. Bins could also be based on outside air temperature e.g. performance values collected while the outside air temperature is between 80 F. and 85 F. or other parameters.

The performance values may be collected in distinct bins or the data may be separated into bins after the data has been collected. The data may be separated into bins based on binning parameters associated with the collected data. For example if the bins are based on time each of the performances value collected may include a time stamp e.g. 6 00 AM . Then the performance values may be separated and placed into bins based on the corresponding time stamps. In the example above seven performance values one for each day collected at 6 00 AM may be organized into a bin corresponding to 6 00 AM seven performance values collected at 6 15 AM may be organized into a bin corresponding to 6 15 AM etc. If the system has scheduled occupancy the data may be trimmed to make all days start and end at the same time stamp.

Process includes steps that are repeated for each bin in a given monitored period. The number of bins depends on the parameter chosen as the basis of the bins. For example if the monitoring period is twenty four hours and bins are based on one hour increments there may be twenty four bins. Steps may be repeated twenty four times for the monitoring period once for each bin.

Process includes generating a target parameter for each bin . As described in the discussion of the target parameter provides a target metric for the system under normal operating conditions. The target parameter may be a statistical mean median moving average or any other quantity that describes the system under normal operating conditions. In an exemplary embodiment the target parameter is a median of the performance values. The median is a robust estimator of the mean and may not be sensitive to the presence of outliers in a data set. A different target parameter may be generated for each bin using the data in the corresponding bin. In the example above a median of the performance values for the 6 00 AM bin may be generated using the performance values in the 6 00 AM bin. Because it is bin specific the value of the target parameter may be different for different intervals of the day.

Process includes generating an estimator of scale for each bin . As described in the discussion of the estimator of scale generally provides a metric that describes how spread out a set of performance values is relative to the target parameter. The estimator of scale may be a standard deviation. In an exemplary embodiment a robust estimator of scale may be generated. A robust estimator of scale is described more fully in the discussion of . The estimator of scale may be a robust standard deviation. A different estimator of scale may be generated for each bin using the data in the corresponding bin. In the example above a robust standard deviation of the performance values for the 6 00 AM bin may be generated using the performance values in the 6 00 AM bin. Because it is bin specific the value of the estimator of scale may be different for different intervals of the day.

Process includes generating a threshold parameter for each bin . The threshold parameter may be based on the estimator of scale . For example the threshold parameters may be calculated using threshold K where K is a constant is the target parameter and is the estimator of scale. The threshold parameter may have an upper limit and a lower limit. For example an upper control limit UCL may be calculated by multiplying the estimator of scale by a constant value K and adding the result to the target parameter. In another example the product of the constant and the estimator of scale may be subtracted by the target parameter to generate a lower control limit LCL . The threshold parameter may be bin specific and calculated using a target parameter and estimator of scale that are also bin specific. In the example above the threshold parameter for the bin containing performance values collected at 6 00 may be generated using the target parameter and estimator of scale for the 6 00 AM bin.

The threshold parameter can be compared against a performance value from the BMS to determine whether the performance value is statistically significant . An example is described in the discussion of . Performance values that are equal to or greater than an upper control limit or that are equal to or less than a lower control limit may be statistically significant and indicate that the performance value is an outlier. An outlier may be a performance value that is out of the norm for a given bin when compared to other performance values in the same bin. The comparison between the performance value and threshold parameter may be bin specific. In the example above a performance value collected at 6 00 AM during the seventh monitored period i.e. the seventh day is compared to a threshold parameter based on performance values collected at 6 00 AM during all of the monitored periods. If the seventh day 6 00 AM data point is greater than or equal to the 6 00 AM threshold parameter the data point is statistically significant with respect to the 6 00 AM bin. That data point may indicate an outlier at the 6 00 AM time interval. The BMS may be configured to output an indication of one or more of the outliers to at least one of a memory device a user device or another device on the building management system.

A user may configure the minimum number of performance values per bin sufficient to generate a bin specific target parameter estimator of scale and threshold parameter. A minimum of seven performance values per bin may be a default. The seven performance values per bin may correspond to seven one day monitoring periods. As a default then a minimum of seven days of data may be required. If more than the minimum performance values per bin is available then the algorithm may be repeated for each minimum set of data. This may create a sliding window of data with each window as wide as the minimum number of performances values or equivalently the minimum number of monitoring periods required to collect the data.

In some embodiments the sliding window may be based on a minimum number of performance values. In other embodiments the width of the sliding window may be specified by a user. A user may choose for example to see the past twelve months of performance values. In other embodiments the width of the sliding window may be a maximum or some other number of performance values.

Detecting outliers on a bin by bin basis may advantageously overcome the challenge of implementing a statistical process control strategy in a multimodal system. Rather than detecting outliers on an interval spanning all operating modes outliers may be advantageously detected at narrower intervals i.e. bins that may span only one or a portion of one operating mode. Narrower intervals may have narrower chart control limits more sensitivity which may lead to less missed outliers type II statistical errors . For example in a system with two operating modes e.g. high and low outliers may be detected using two or more bins. One bin may include only performance values collected while the system was in one operating mode. A performance value that is an outlier with respect to the low operating mode may be more likely to be identified as an outlier if the performance value is compared to other performance values that were generated while the system was in the low operating mode i.e. performance values in the same bin . The outlier may be more likely to be outside the bin specific chart control limits generated using a bin specific target parameter and bin specific estimator of scale than chart control limits generated with a single target parameter and a single estimator of scale.

Process includes steps for detecting a fault of the building management system for a monitored period as a whole . A fault may be a condition of the BMS when the actual number of outliers detected during a monitored period is larger than a threshold of outliers under normal operating conditions. Monitoring periods may be based on any parameter selected by the user e.g. time outside air temperature operating mode etc. Monitoring periods may last as long as specified by a user. For example a monitoring period may be one week or it may be one day from building start up to shut down e.g. 6 00 AM to 5 00 PM . Process includes counting the total number of outliers detected during a monitored period . The total number of outliers is the sum of outliers detected for all bins during a monitored period. For example if the monitoring period is twenty four hours and bins are based on one hour increments any of the twenty four bins may contain an outlier.

Process includes generating an expected outlier parameter for the monitored period . The expected outlier parameter provides a metric that describes a threshold of outliers in the system under normal operating conditions. If the actual number of outliers is larger than the threshold then a BMS fault may exist. In some embodiments an expected value of outliers may describe the threshold. In other embodiments a band of expected values may describe the threshold. The expected outlier parameter may describe the number of outliers on a per bin or per monitored period basis. A user may configure the expected outlier parameter. In some embodiments the expected outlier parameter may be a raw number e.g. two expected outliers per monitored period . In other embodiments the expected outlier parameter may be a percentage e.g. 5 of performance values in a monitored period are outliers .

In still other embodiments a statistical distribution may describe the threshold of outliers under normal operating conditions. For example the statistical distribution may be a binomial distribution. A monitoring period may be considered a fault if the probability of finding the number of outliers that actually occurred during the monitoring period is less than a specified probability of false alarm based on the null hypothesis that under normal operation the number of outliers in any given period follows a binomial distribution. The binomial distribution may describe the probability distribution of outliers in a set of performance values e.g. those during a monitoring period . In another embodiment the binomial distribution may be approximated by the normal distribution known as the continuity correction . The normal distribution may be used when the size of the sample n times the probability p is greater than 5 i.e. n p 5 or n 1 p 5. In another embodiment the Poisson distribution may be used known as the law of rare events to define the threshold of whether the number of outliers constitute a fault or not. The Poisson distribution may be used if the sample size n is large e.g. n 20 and the probability p is small e.g. p

Process includes comparing the total number of outliers during a monitored period to the threshold of outliers . If the total number of outliers during the monitored period is greater than or equal to the expected outlier parameter the total number of outliers may be statistically significant and represent a fault of the BMS for the monitored period . Step may be repeated for each for each monitored period.

Process includes alerting the user of a fault of the BMS for the monitored period . If the number of outliers exceeds the expected outlier parameter the BMS may indicate the fault to a user via a display device . Alternatively or in addition thereto the BMS may take other measures if a change in behavior of the BMS has been detected. For example the BMS may initiate a diagnostics routine send a communication to a technician e.g. email text message pager message etc. or any other appropriate action that corresponds to the change in system behavior.

Referring now to a detailed diagram of a graduated fault detection module is shown according to an exemplary embodiment. Graduated fault detection module may be configured to carry out process .

Graduated fault detection module may be used in the conjunction with fault analysis module of . Graduated fault detection module may be used in lieu of or in addition to fault detection module . Graduated fault detection module may receive data about a building from building data . Graduated fault detection module may transmit data to visualization module . For example data may be provided to visualization module to generate the chart of and the plot of in a user interface. Graduated fault detection module may also transmit data to diagnostics module . For example diagnostics module may receive information about a bin specific outlier or a fault monitoring period of the BMS. Fault monetization module may use the data from graduated fault detection module to compute the monetary or energy costs associated with an outlier in a given bin. Fault prioritization module may use the data from graduated fault detection module to prioritize among outliers occurring in various bins. For example if bins are organized by time an outlier occurring in a bin during a high customer occupancy period of the day may be prioritized higher than an outlier occurring in a bin when the building is unoccupied.

Graduated fault detection module may also be implemented on fault detection and diagnostics layer in lieu of or in addition to automated fault detection module .

Referring to graduated fault detection module includes performance value generator which receives building management system data such as meter data weather data and building subsystem data . Based on the data received performance value generator calculates performance values that can be used to determine whether the BMS is operating normally. For example performance values may be measured temperature values calculated error rates measured power consumptions or exponentially weighted moving averages of data from the BMS.

Graduated fault detection module includes data preparation module . Data preparation module may check for data gaps unreasonable values and improperly formatted values in performance value generator . Data preparation module may flag or correct data with these or any other problems. For example bad data may be replaced via linear interpolation or with a not a number NaN value. Data preparation module may also check for improper binning parameters e.g. timestamps or data without binning parameters and correct these problems by e.g. removing the incomplete data or adding the necessary binning parameters via linear interpolation. Data preparation module may trim the data in each bin to make all days start and end at the same time stamp.

Graduated fault detection module includes performance value database . Performance value database stores the performance values generated by performance value generator . In one embodiment the history of performance values stored in performance value database contains a record of performance values previously generated by performance value generator . In another embodiment performance value database contains a history of raw data values from the building management system. Database may also store binning parameters associated with a performance value. Performance values may be transmitted from the database to binning module .

Graduated fault detection module includes binning module . Binning module organizes the data stored in performance value database . Binning module may divide the data based on binning parameters associated with each data point. Binning module may be configured to enable a user to input the quantity by which data points organized e.g. time and the number of bins e.g. twenty four one hour intervals .

Graduated fault detection module includes binned performance value database . Binned performance value database receives performance values from binning module and stores them according to bin assignments. Binned performance value database provides binned performance values to target parameter generator and estimator of scale generator to calculate bin specific target parameters and estimators of scale respectively. Binned performance value database also provides binned performance values to outlier identifier for comparison to bin specific threshold parameters and to outlier evaluator to determine a BMS fault period.

Graduated fault detection module includes target parameter generator . Target parameter generator uses the performance values from binned performance value database to generate a target parameter for each bin. The bin specific target parameter provides a statistical center for the performance values in a given bin. For example target parameter generator may calculate the bin specific median of the performance values as the target parameter. Target parameter generator may be configured to operate on each bin of performance values. Target parameters may be transmitted to estimator of scale generator for calculation of bin specific estimators of scale and to threshold parameter generator for calculation of bin specific threshold parameters.

Graduated fault detection module includes estimator of scale generator . Estimator of scale generator uses the bin specific outputs of target parameter generator and the performance values from binned performance value database to generate an estimator of scale for each bin. The estimator of scale describes how spread out the data in each bin is. In one embodiment a robust estimator of scale such as a robust standard deviation is calculated by estimator of scale generator . Estimator of scale generator may be configured to operate on each bin of performance values. Estimators of scale may be transmitted to threshold parameter generator for calculation of bin specific threshold parameters.

Graduated fault detection module includes threshold parameter generator . Threshold parameter generator uses the bin specific outputs of the target parameter generator and estimator of scale generator to calculate a threshold parameter for each bin. Threshold parameters describe the behavior of the BMS under normal operating conditions and define a range of normal behavior within a specific statistical confidence. Threshold parameter generator may be configured to operate on each bin of performance values. A bin specific threshold parameter describes the normal range of the BMS within the given bin e.g. at a certain time interval . Threshold parameter generator may compute upper and lower control limits. Threshold parameters may be transmitted to outlier identifier for comparison to binned performance values.

Graduated fault detection module includes outlier identifier . Outlier identifier detects outliers on a bin by bin basis by comparing performance values from binned performance value database to bin specific threshold parameters from threshold parameter generator . Outlier identifier may determine if a performance value in a given bin is greater than the upper limit or less than the lower limit of the corresponding threshold parameter. If so then the performance value may be determined to be an outlier with respect to the particular bin. Outliers may be transmitted to binned performance value database to be stored or to outlier evaluator to be counted for determination of whether there is a fault in the monitoring period of the BMS.

Graduated fault detection module includes expected outlier module . Expected outlier module provides data to the outlier evaluator that describes the number of outliers for the system under normal operating conditions. Expected outlier module may be configured to enable a user to specify the number of expected outliers or the percentage of outliers in a set of performance values. A user may also specify a statistical description of the outliers e.g. a binomial distribution a normal distribution or a Poisson distribution. The number percentage or description of expected outliers may be per bin and per monitored period.

Graduated fault detection module includes outlier evaluator . Outlier evaluator determines whether a monitored period of the BMS is a fault monitored period. Outlier evaluator may receive outliers per bin from outlier identifier and count the total number of outliers across all bins i.e. the entire monitored period . Outlier evaluator may receive the number of bins and the number of monitoring periods from binned performance value database . Outlier evaluator may receive a description of the expected number of outliers for the system under normal operating conditions from expected outlier module . Outlier evaluator may compare the total number of outliers counted during the monitored period and compare it to the expected number of outliers to identify a fault monitored period.

Outlier evaluator may transmit fault monitoring period determinations to various modules of including for example visualization module and diagnostics module . Outlier evaluator may also transmit fault monitoring period determinations to various modules on fault detection and diagnostics layer for further assessment and investigation including automated diagnostics module and manual diagnostics module . The fault monitoring period determinations may also be transmitted to GUI services to be included in the graphical user interface displayed to a user. Fault determinations may also update performance indices and be stored in binned performance value database .

Referring to a chart of bin specific performance values target parameters estimators of scale threshold parameters and outliers is shown. In some embodiments outliers may be detected using a graduated statistical control chart such as that of . Chart may be created maintained updated processed and or stored in binned performance value data . Chart may also be displayed to a user by a user interface device. In other embodiments the process will operate without displaying a graphical representation of a chart. While chart is shown as a two dimensional chart another information structure suitable for representing and storing the data of chart may be used. For example a relational database having one or more related tables may be used.

In the illustration of chart includes columns of bins rows of monitoring periods and performance values . In the embodiment of bins are based on fifteen minute intervals of time e.g. 6 00 AM 6 15 AM etc. . Chart depicts only a portion of the bins in the entire monitoring period. For example if a monitoring period lasts for twenty four hours chart would include columns of bins for fifteen minute intervals for the entire twenty four hours. In the embodiment of chart includes seven monitoring periods i.e. seven days . Other embodiments may include greater or fewer monitoring periods. Chart includes performances values . In the embodiment of the performance values may be exponentially weighted moving averages EWMAs of an air handler unit discharge air temperature error. Performance value corresponds to the 6 00 AM bin for the second monitoring period.

In the embodiment of chart includes target parameters estimators of scale threshold parameters and outliers . Target parameters estimators of scale threshold parameters and outliers are based on the performance values in each bin i.e. there are different values for each column of data . In the embodiment of the target parameter is a median and estimator of scale is a robust standard deviation. Chart is also shown to include threshold parameters with an upper control limit and lower control limit . In the embodiment of outliers are represented by the numeral 1. Outlier corresponds to performance value in the 6 00 AM bin during the second monitored period. Performance value is an outlier because it is less than the 6 00 AM lower control limit. The number of outliers for each monitoring period may be summed and compared an expected number of outliers to determine a fault of the monitoring period.

Referring to a plot of performances values during a monitoring period is shown according to an exemplary embodiment. The plot of may be output on a graphical user interface e.g. on a client device on a mobile device generated by a web server etc. using the systems and methods described above.

In the illustration of the monitoring period may be one day. The plot may show one entire monitoring period or a portion thereof. The x axis of the plot may represent bins during the monitoring period. In the illustration of forty five bins are shown. The y axis of the plot may be the numerical values of performance values . Performances values may be EWMAs corresponding to one building system e.g. air handler unit discharge air temperature error . Performances values may be bin specific.

The plot of may represent a multi modal system. Specifically it may represent a system with at least two modes low and high. During a portion of the monitoring period the system may operate in a low mode. The low mode is reflected on the left side of the plot of . During another portion of the monitoring period the system may operate in a high mode. The high mode is reflected on the right side of the plot of . Upper control limits and lower control limits while the system is in the low mode may be generated from bins containing only performance value from the system in low mode. Likewise the upper control limit and lower control limit while the system is in high mode may be generated from bins containing only performance values from the system in high mode.

The plot of may include outlier . Outlier may be identified as a bin specific outlier because the performance value is less than the lower control limit for the associated bin. The identification of outlier demonstrates an advantage of bin specific calculation of target parameters and estimators of scale. Had a single fixed target parameter and a single fixed estimator of scale been calculated for all of the data shown in the plot of outlier may have fallen within the chart control limits and been a missed fault. Because bin specific target parameters and estimators of scale were used outlier fell outside of the chart control limits and was identified as an outlier.

Referring now to a process for measuring and verifying energy savings in a building management system is shown according to an exemplary embodiment. Process may be used by automated measurement and verification layer to measure and verify energy savings in the building management system. Process is shown to include retrieving historical building and building environment data from a pre retrofit period step . Input variables retrieved in step and used in subsequent steps may include both controllable variables e.g. variables that may be controlled by a user such as occupancy of an area space usage occupancy hours etc. and uncontrollable variables e.g. outdoor temperature solar intensity and duration other weather occurrences degree days etc. . Variables which are not needed i.e. they do not have an impact on the energy savings calculations may be discarded or ignored by automated measurement and verification layer .

Process is also shown to include using historical data to create a baseline model that allows energy usage e.g. kWh or power consumption e.g. kW to be predicted from varying input or predictor variables e.g. occupancy space usage occupancy hours outdoor air temperature solar intensity degree days etc. . For example power consumptions measured during previous weekends may be used to predict future weekend power consumptions since the building is likely at minimum occupancy during these times.

Process is further shown to include storing agreed upon ranges of controllable input variables and other agreement terms in memory step . These stored and agreed upon ranges or terms may be used as baseline model assumptions. In other embodiments the baseline model or a resultant contract outcome may be shifted or changed when agreed upon terms are not met.

Process is yet further shown to include conducting an energy efficient retrofit of a building environment step . The energy efficient retrofit may include any one or more process or equipment changes or upgrades expected to result in reduced energy consumption by a building. For example an energy efficient air handling unit having a self optimizing controller may be installed in a building in place of a legacy air handling unit with a conventional controller. Once the energy efficient retrofit is installed a measured energy consumption for the building is obtained step . The post retrofit energy consumption may be measured by a utility provider e.g. power company a system or device configured to calculate energy expended by the building HVAC system or otherwise.

Process also includes applying actual input variables of the post retrofit period to the previously created baseline model to predict energy usage of the old system during the post retrofit period step . This step results in obtaining a baseline energy consumption e.g. in kWh against which actual measured consumption from the retrofit can be compared.

Process is further shown to include subtracting the measured consumption from the baseline energy consumption to determine potential energy savings step . In an exemplary embodiment a baseline energy consumption is compared to a measured consumption in by subtracting the measured consumption during the post retrofit period from the baseline energy consumption calculated in step . This subtraction will yield the energy savings resulting from the retrofit.

Process is yet further shown to include checking the baseline model assumptions for changes by comparing the calculated energy savings to a threshold parameter step . For example an EWMA control chart may be applied to the calculated energy savings to check the validity of the model assumptions. Such a chart may utilize control limits e.g. threshold parameters generated using a computerized implementation of process or . A BMS implementing process may determine if the savings are outside of the control limits of the chart. If the savings are outside of the control limits the BMS may then generate an alert or may initiate other corrective measures. For example the BMS may then determine new baseline model assumptions e.g. by repeating step and repeating steps to continuously calculate and verify the potential energy savings for the building.

Referring now to a detailed diagram of a building management system portion is shown according to an exemplary embodiment. The logic blocks shown in may represent software modules of fault detection and diagnostics layer shown in . Field controller controls one or more components of the BMS and receives or calculates performance values e.g. sensor inputs actuator positions etc. . Controller can store a trend of performance values setpoints and current status in local trend storage . Trend storage may be a memory device that is a component of coupled to or located externally to controller . In one embodiment the trend sample intervals used to sample performance values are setup during a system configuration process. For example the sample intervals may be less than one half of the time constant of the process controlled by controller to prevent aliasing. Other sample intervals may also be used depending upon the type of data that is sampled.

The trend data in local trend storage may be communicated over network e.g. the Internet a WAN a LAN etc. to an EWMA database or to an intermediate server between controller and EWMA database . In one embodiment the trend data from local trend storage may be provided to delay filter . Delay filter removes data that is likely to contain excessive field controller dynamics. Typically the delay period for delay filter is greater than or equal to five times the time constant of the process controlled by controller although other delay periods may also be used. In some embodiments delay filter is triggered by a change in the current status of controller or by changes in one or more setpoint values for controller .

A performance index calculator may use the outputs of delay filter to calculate a performance index. For example performance index calculator may use the setpoint of controller minus performance values to determine a performance index. Once a performance index has been calculated by performance index calculator outlier remover may be used to remove anomalous values. For example outlier remover may utilize the generalized extreme studentized deviate GESD method or an anti spike filter to remove extreme data values.

EWMA calculator may calculate a moving average of the data from outlier remover which is sub sampled by sampler . Sampler samples the EWMA data to remove or reduce autocorrelation. For example sampler may utilize a sample interval greater than or equal to five times the time constant of the process controlled by controller to sample the EWMA data although other sampler intervals may also be used.

In other embodiments EWMAs may be calculated directly in a controller such as field controller . Field controller receives performance values from the controlled process e.g. measured temperature values measured power consumptions or any other data that can be used to determine if the BMS is operating normally . The EWMA data is then trended and stored in trend storage . Trend storage may be a memory local to controller a memory in a supervisory controller having control over controller or within any other device within the BMS. Typically the trend sample interval time for trend storage is set up during system configuration and ranges from 1 60 minutes although other interval times may also be used.

The trended EWMA data in trend storage is transmitted over network to outlier remover which filters outliers from the data. For example outlier remover may use the GESD method an anti spike filter or another method capable of removing outliers from the data. Outlier remover provides the resultant data to sampler which sub samples the data to remove or reduce autocorrelation. Sampler may utilize a sample interval greater than or equal to five times the time constant of the process controlled by controller to sample the EWMA data although other sampler intervals may also be used. Sampled EWMA data from samplers are then stored in EWMA database as a history of EWMA values. In this way EWMA database may be used to train or test EWMA with a statistical process control chart.

Using EWMA database the BMS may determine an analysis period or schedule and determine if training has not been performed or if retraining has been triggered step . If training or retraining is necessary the BMS may then determine if a desirable set of training data is available step . For example training sets of 150 500 data points are typically used. Other amounts of training data may also be used so long as they provide a sufficient history of behavior of the BMS. If an insufficient amount of data has yet to be collected the BMS may continue to collect data until reaching a desired amount.

If EWMA database contains a sufficient amount of training data the BMS may implement process to define a statistical process control chart. Process includes checking the autocorrelation and setting a statistical process control chart method step . For example autocorrelation may be checked by calculating a lag one correlation coefficient. If the coefficient is low the data is not autocorrelated and an EWMA method may be used. If the coefficient is high the data is considered to be autocorrelated and an AR method may be used. Under the AR method an AR one model may first be fit to the training data. The AR res residuals of the AR one model may then be used in other steps of process .

Process is shown to include checking the data for normality step . In general normal data provides better performance than non normal data. However non normal data may also be used to detect changes in the behavior of the BMS. Normality may be tested using a Lillifors test or any other normality test capable of distinguishing normal data sets from non normal data sets.

Process further includes calculating robust estimates of the target parameter and the estimator of scale step . In one embodiment the target parameter is the statistical mean of the history of the EWMA. For example the simple mean of the data may be calculated if the data is determined to be normal in step . In another embodiment the median of the data is used. In an exemplary embodiment the estimator of scale calculated in step is a robust estimator of scale although other estimators may also be used. For example robust estimators of scale having Gaussian efficiencies of about 58 or about 82 may be used.

Process yet further includes calculating the control chart limits i.e. the one or more threshold parameters step . For example an upper control limit UCL may be calculated by multiplying the estimator of scale by a constant value K and adding the result to the target parameter. In another example the product of the constant and the estimator of scale may be subtracted by the target parameter to generate a lower control limit LCL .

Once target parameters have been established using process the BMS can begin to use the generated statistical process control chart to detect changes in the behavior of the BMS. If new EWMA or AR res values are less than the LCL or greater than the UCL the new values are considered to be outliers e.g. one or more statistically significant outliers step . Optionally the BMS also determines if an excessive number of outliers have been detected step . For example the BMS may disregard one or more outliers detected in step before taking further action. The number of outliers necessary before taking further action may be set manually by a user or automatically by the BMS itself. For example the BMS may utilize data concerning the operational state of controller to determine a threshold number of outliers.

If the BMS determines in step that an excessive number of outliers have been detected the BMS may present an indication to a user via a display device step . Alternatively or in addition to step the BMS may take any number of other measures if a change in behavior has been detected. For example the BMS may initiate a diagnostics routine send a communication to a technician e.g. email text message pager message etc. retrain the statistical model or any other appropriate action that corresponds to the change in behavior.

Text above relating to describes a process for using abnormal energy detection to conduct automated fault detection and diagnostics. Such systems and methods can use energy meter data e.g. electric gas steam etc. to help detect building system or building device faults. The energy usage measurements used in automated fault detection and diagnostics can be measurements of either the total building energy usage e.g. using whole building meters or energy usage for a portion of the building management system e.g. using sub meters . Various methods for detecting abnormal energy usage in buildings are also described by John E. Seem. See for example U.S. Pat. No. 6 816 811 inventor John E. Seem Method of Intelligent Data Analysis to Detect Abnormal Use of Utilities in Buildings John E. Seem Energy and Buildings vol. 37 127 139 2005 John E. Seem Energy and Buildings vol. 39 52 58 2007 Seem et al. ASH RAE Transactions pt. 1. 710 721 1991 . describe exemplary processes that may be conducted by an FDD layer e.g. the FDD layer described with reference to or an FDD module or modules of another building automation system controller.

Referring now to a flow diagram of a process for the identification of energy outlier days is shown according to an exemplary embodiment. Process includes an energy metering step step where energy usage is measured by a meter or multiple meters. The meters measure the consumption and or demand of an energy utility such as electricity gas steam hot water chilled water etc. The meters may be owned by a building owner the utility that provides the energy utility and or any other entity or combination of entities. The energy measurements may be for a campus of buildings e.g. a group of related building an individual building a sub set or portion of a building or any other aggregation or disaggregation of energy usage.

Process further includes a trend data capture step step . In step a multitude of measurements collected over time e.g. from step are stored. The measurements are stored in an electronic storage device local to the site remote from the site or any combination of devices both local and remote from the site.

Process further includes a data processing trigger step step . In step a triggering action that initiates the remaining data processing steps in process is activated. The trigger may be time based e.g. every day at midnight or another set time every week every hour etc. user based e.g. by receiving an input from a user at a graphical user interface event based e.g. when commanded by a utility when an energy usage threshold is triggered when the local storage buffer is full or may use any other basis to initiate processing.

Process further includes a data cleansing step step . In step one or more sub steps are taken to ensure that the data is in an appropriate form for further processing. Data cleansing may include but is not limited to checking for data gaps checking for improper timestamps checking for unreasonable values and improperly formatted values and flagging or correcting data with these or any other problems. For example bad data may be replaced via linear interpolation or by replacing the data with a not a number NaN value.

Process further includes calculating key values or features from the data step . Step may include for example a daily feature extraction e.g. calculations for daily energy usage . In one embodiment step includes calculating the daily energy consumption and the daily peak energy demand. In other embodiments step can include calculating other statistics to describe daily energy use data calculating to determine moving averages or other calculations.

Process further includes identifying and grouping energy features by day type step . Step may include for example using a pattern recognition approach to identify and group days of the week with similar energy features. Step may be used to identify patterns in energy usage for analysis as day to day energy usage patters may differ significantly. For example for many commercial buildings the difference in energy usage between weekdays and weekends may be significant. Therefore all weekdays may be grouped together and all weekend days may be grouped together.

Process further includes identifying energy outliers step . Step may include identifying the outliers in the daily features using the day type groups identified in step . In one embodiment a Generalized Extreme Studentized Distribution GESD approach may be used for identifying energy outliers as described in .

Process includes determining upper and lower limits for daily energy consumption and daily peak energy demand for an average or normal day step . In one embodiment the limits are calculated using the robust mean and robust standard deviation determined in process . The limits are calculated as the robust mean plus or minus a set value e.g. two or three standard deviations . In one embodiment a normal day is based on the average energy use or demand of a plurality of recent days of the same day type e.g. weekend weekday after removing any outlier days.

Process further includes replacing outlier values of the daily energy consumption and or daily peak energy demand with a more reasonable or normal value from step step . For example if an outlier value is greater than the upper normal limit determined in step the outlier value is replaced by the upper normal limit and if the outlier value is less than the lower normal limit determined in step the outlier value is replaced by the lower normal limit.

Process further includes storing the daily features calculated in process and the replacement values calculated in step step . Storage is provided by an electronic storage device local to the site remote from the site or a combination of both.

Process further includes retrieving the daily data from storage and creating a set of data for each day to be analyzed step . In one embodiment the set of data for each day to be analyzed includes the day and the 29 previous days. In other words a 30 day sliding window of energy usage is generated. Two 30 day data sets may be created for each day one with outliers and one without outliers included.

Process further includes defining cost factors to be used to monetize the outliers step . The cost factors may be user defined when the software is being configured. Cost factors are required for energy consumption and or energy demand. Blended or marginal cost factors may be provided. Furthermore in varying embodiments of the disclosure the values used throughout the processes described herein may relate to or use a blended energy value blend of consumption demand rather than one or the other.

Process further includes calculating the average daily cost using the data without the outliers step . The energy cost factors e.g. consumption and or demand utility rate information are multiplied by the energy consumption and energy demand for each 30 day set of data. The resulting consumption and demand cost estimations are summed to obtain the total costs. The total costs are then divided by the 30 days to obtain the average daily cost. Each 30 day set of data is used to calculate an average daily cost which is uniquely associated to the analyzed day e.g. the last day of the 30 day window . In other words every day is treated as if it were the last day of a billing period that is exactly 30 days long an estimated utility bill is calculated for each of these billing periods and divided by 30 days to determine the average daily cost which is associated with the last day of the 30 day billing period.

Process further includes calculating the average daily cost using the data with the outliers step . The calculation of step may be the same as the calculation in step but with the data outliers being included in the calculation.

Process further includes subtracting the average daily cost calculated in step from the average daily cost calculated in step step . The result is an estimate of the daily financial impact of the outlier.

Process further includes obtaining a user defined threshold for a cost filter step to which the estimate of the daily financial impact of the outlier will be subjected. The threshold may be defined during configuration or changed at anytime by a user. In other embodiments the threshold may be adjusted automatically based on statistical confidence levels or other calculated values. The threshold for the cost filter allows a user to define the financial impact that they consider to be significant for an outlier.

Process further includes filtering the energy outliers determined in process using the user defined threshold from step step . In other words step includes determining that an energy outlier is a fault when it exceeds a certain financial impact threshold.

Process further includes a presentation of the fault and its costs step . The presentation may be made through various graphical user interfaces user interface dashboards via on line and off line reports via email text message or via any other medium. In an exemplary embodiment the graphical user interface formats shown above with respect to chiller energy and cost outliers may be utilized to report energy and or cost outliers for other pieces of equipment e.g. cooling towers air handling units boilers lighting systems etc. .

In an exemplary embodiment the calculations of process are performed primarily by an FDD layer such as FDD layer of . Outputs of the fault determination associated energy use associated energy costs and the like may be reported to an enterprise integration layer e.g. layer shown in for transforming such outputs into information e.g. graphical user interfaces for providing to a local electronic display or to a remote source such as a client running an enterprise control application or a monitoring and reporting application .

Referring now to a process for identifying weather outliers and using the weather outliers to further filter energy outliers is shown according to an exemplary embodiment. Energy usage in most buildings is correlated to weather conditions. The presence of weather outliers may result in energy outliers which may not need to be identified as faults if the building is responding as expected to the weather. Process is shown as an extension of process . Although shown separately in some exemplary embodiments one or more of the extensions to process may be applied together e.g. in series or in parallel .

Process includes measuring the outside air temperature step . The measurement may be made by a local air sensor used by the building automation system or on site weather station. In some embodiments the outside air temperature used in process could be obtained from an external source e.g. a weather station database maintained and operated by the U.S. National Oceanic and Atmospheric Administration NOAA via communications electronics or storage media of a smart building manager. While temperature is particularly shown in in other embodiments other weather parameters may be tracked and utilized for energy outlier filtering. For example humidity average daily temperature peak temperature a blend of temperature and humidity or any other weather describing information may be used and processed.

Process further includes storing a multitude of weather measurements over time via a local trend capture step . In an exemplary embodiment step may be similar to step of process .

Process further includes receiving a triggering action and conducting related triggering activities step that initiate the remaining weather data processing steps in process . Step may be similar to the triggering step of process e.g. the triggering may be time based or event based .

Process further includes a data cleansing step to ensure that the data is in an appropriate form for further processing step . Step may be similar to the data cleansing step of process .

Process further includes calculating key values or features from the weather data step . In one embodiment the key weather features calculated may be the daily maximum temperature the average temperature and the minimum outside air temperature. Process further includes identifying outliers in the daily weather features calculated in step step . In one embodiment a GESD approach may be used to identify weather outliers.

Process further includes filtering the energy outliers step identified in process using the outliers found in step . In other words if an energy outlier occurs on the same day that a weather outlier occurs then the energy outlier may be excluded from consideration as a fault. The use of the weather filter reduces the number of false or insignificant faults based on the assumption that the building responds to extreme weather conditions as expected and the resulting energy usage increase is unavoidable. Process further includes presenting the filtered energy outliers as faults step .

Referring now to a flow diagram of a process for applying the general outlier analysis approach of process to real time monitoring of energy usage is shown according to an exemplary embodiment. Process is shown as an extension of process . Process is intended to provide a user or building operator an immediate notice e.g. nearly immediate near real time when a building s energy usage or demand is abnormal.

Process includes using data from the GESD outlier analysis of step of process to estimate the threshold on the daily peak energy demand that results in a day being flagged as an outlier step .

Process further includes using the threshold from step and the day type grouping from step of process to reset or adjust the alarm limit on the energy meter point in the building automation system step . In an exemplary embodiment the thresholds determined for the last day processed in step for each day type group are used as the alarm limit for all future days that have the same day type. Thresholds may be passed from step to step on a daily basis. In other embodiments less frequent threshold estimations may be provided to step .

Process further includes monitoring energy demand step . Process further includes activating a real time alarm notification when the energy demand monitored in step exceeds the alarm limit determined in steps step . Alarm notification presentation acknowledgement and tracking may all be handled with the standard protocols implemented in the building automation system.

Referring now to a process for pro active monitoring of energy usage is shown according to an exemplary embodiment. Process is shown as an extension of process of . Process is used to generate advanced notice of faults by predicting when a building s energy usage is likely to become abnormal. Forecasts of the hourly energy usage for the day are used with estimated outlier thresholds to predict abnormal energy usage. The pro active notification gives operators more time to take corrective actions to reduce or eliminate additional energy usage and costs.

Process includes storing trend data and day type information from process step . Storage is provided by an electronic storage device local to the site remote to the site or a combination of the two. Process further includes forecasting energy usage step . Step may be executed for example every hour and may forecast the energy usage profile for the remainder of the day. In one embodiment the forecasts are made using an approach defined by Seem and Braun in 1991 ASHRAE Transactions p. 710 721.

Process further includes using data from the GESD outlier analysis of step of process to estimate thresholds for both daily energy consumption and daily peak energy demand that results in a day being flagged as an outlier step . Process further includes using the forecasted energy profile from step and the thresholds from step to predict if and or when energy usage is likely to be considered abnormal step . Process further includes an alarm notification step . For example a building operation may be notified when energy usage is predicted to be abnormal e.g. via dashboards email text messages etc. .

Referring now to a block diagram of a fault detection module and fault analysis module is shown according to an exemplary embodiment. Fault detection module receives data from building data and conducts fault detection methods as generally described in the present disclosure. In an exemplary embodiment the components of may be implemented within an FDD layer e.g. an FDD layer as described with reference to of a smart building manager.

Fault detection module provides fault information to fault analysis module . Fault information may include statistical outliers indicating the presence of a fault a magnitude of the fault e.g. how severe the fault is and other fault properties. Fault analysis module includes a diagnostics module configured to receive fault information. Diagnostics module is configured to identify a root cause for the fault based on fault information. Diagnostics module may further determine critical or enhanced data or information related to the fault.

Diagnostics module provides the root cause information to a fault monetization module . Fault monetization module is configured to determine a cost associated with the fault e.g. how much the fault is costing the owner of the building . The cost may be in terms of dollars energy use or any other type of metric. Fault monetization module may provide the cost information to visualization module for display to a user.

Fault cost information from fault monetization module is provided to a fault prioritization module . Fault prioritization module is configured to use the fault cost information to prioritize between two or more faults. For example the fault with the higher cost may be given a higher priority e.g. the fault may be listed first in a report or display the fault may be presented to the user before the other fault etc. . After determining fault priority scheduling module is configured to generate a schedule for addressing the prioritized faults. Scheduling module may for example create a maintenance schedule for inspecting and fixing faults in the building. The schedule may be based on faults that have a higher priority or cost.

The schedule for resolving faults is provided to a fault resolution and tracking module . Fault resolution and tracking module is configured to verify if a fault was fixed and if the fix was effective. Fault resolution and tracking module may conduct the check when the schedule indicates that the fault resolution should have occurred. Fault resolution and tracking module may further include and maintain information about a fault life timeline. For example if a fault resolution is only expected to last for a period of time or if a maintenance schedule should be associated with a fault resolution module may keep track of such information and conduct checks when necessary. Fault resolution and tracking module may further generate reports related to the tracking of fault resolutions. The reports may include cost information e.g. money saved by conducting the fault resolutions . These reports may be provided to user devices via an enterprise application interface .

Visualization module is configured to receive fault information e.g. the magnitude of the fault a cost associated with the fault from various modules and may generate a user interface for providing to an electronic display or remote device. The graphical user interface may include the number of faults the number of faults relative to the total data e.g. a percentage or ratio of faults compared to non faulty equipment and other fault information. For example the severity of a fault may be detailed the cost of the fault may be detailed etc. The faults may be grouped by type of fault equipment involved in the fault cost or severity of the fault etc. The graphical user interface may be provided to user devices .

The construction and arrangement of the systems and methods as shown in the various exemplary embodiments are illustrative only. Although only a few embodiments have been described in detail in this disclosure many modifications are possible e.g. variations in sizes dimensions structures shapes and proportions of the various elements values of parameters mounting arrangements use of materials orientations etc. . For example the position of elements may be reversed or otherwise varied and the nature or number of discrete elements or positions may be altered or varied. Accordingly all such modifications are intended to be included within the scope of the present disclosure. The order or sequence of any process or method steps may be varied or re sequenced according to alternative embodiments. Other substitutions modifications changes and omissions may be made in the design operating conditions and arrangement of the exemplary embodiments without departing from the scope of the present disclosure.

The present disclosure contemplates methods systems and program products on memory or other machine readable media for accomplishing various operations. The embodiments of the present disclosure may be implemented using existing computer processors or by a special purpose computer processor for an appropriate system incorporated for this or another purpose or by a hardwired system. Embodiments within the scope of the present disclosure include program products or memory comprising machine readable media for carrying or having machine executable instructions or data structures stored thereon. Such machine readable media can be any available media that can be accessed by a general purpose or special purpose computer or other machine with a processor. By way of example such machine readable media can comprise RAM ROM EPROM EEPROM CD ROM or other optical disk storage magnetic disk storage or other magnetic storage devices or any other medium which can be used to carry or store desired program code in the form of machine executable instructions or data structures and which can be accessed by a general purpose or special purpose computer or other machine with a processor. Combinations of the above are also included within the scope of machine readable media. Machine executable instructions include for example instructions and data which cause a general purpose computer special purpose computer or special purpose processing machines to perform a certain function or group of functions.

Although the figures may show a specific order of method steps the order of the steps may differ from what is depicted. Also two or more steps may be performed concurrently or with partial concurrence. Such variation will depend on the software and hardware systems chosen and on designer choice. All such variations are within the scope of the disclosure. Likewise software implementations could be accomplished with standard programming techniques with rule based logic and other logic to accomplish the various connection steps processing steps comparison steps and decision steps.

