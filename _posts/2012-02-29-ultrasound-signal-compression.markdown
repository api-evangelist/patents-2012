---

title: Ultrasound signal compression
abstract: A method and an apparatus for an ultrasound system provide compression of ultrasound signal samples after analog to digital conversion and before beamforming. The analog ultrasound signals received from an array of ultrasound transducer elements are digitally sampled by a plurality of analog to digital converters (ADCs) to produce a plurality of sequences of signal samples. Each sequence of signal samples is compressed to form a corresponding sequence of compressed samples. The resulting sequences of compressed samples are transferred via a digital interface to an ultrasound signal processor. At the ultrasound signal processor, the received sequences of compressed samples are decompressed. The typical processing operations, such as beamforming, downconversion and detection, are applied to decompressed samples. This abstract does not limit the scope of the invention as described in the claims.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08795180&OS=08795180&RS=08795180
owner: Altera Corporation
number: 08795180
owner_city: San Jose
owner_country: US
publication_date: 20120229
---
This application is a divisional of U.S. patent application Ser. No. 12 477 062 filed on 2 Jun. 2009 now U.S. Pat. No. 8 157 738 which application is incorporated by reference as if fully set forth herein.

The present invention relates to compression of ultrasound signal data received by ultrasound transducers particularly to compressing ultrasound signal samples after analog to digital conversion and prior to beamforming detection and image formation.

Medical ultrasound systems scan the internal anatomy of a subject by transmitting ultrasound beams from a transducer placed on the subject by a clinician. The ultrasound waves are reflected at interfaces of internal tissues having different acoustic impedances producing echoes. The transducer receives the echoes and converts them to electrical ultrasound signals. The ultrasound system applies a sequence of processing steps to the ultrasound signals to produce an image or series of images that are displayed at a control console for analysis by the clinician. Images formed based on the strength of the received echo are referred to as B mode images. In addition the system can measure the Doppler shifts of the ultrasound signals to produce color images indicating the flow of fluid such as blood and perform additional analyses useful for diagnosis.

A conventional medical ultrasound transducer includes an array of piezoelectric elements that transmit ultrasound waves when driven by electrical signals receive the returning echoes and convert the received echoes to a plurality of analog signals. A plurality of analog to digital converters ADCs sample the analog signals each producing a stream of digital signal samples. Typical digital signal processing of the signal samples includes beamforming downconversion B mode brightness processing and or Doppler processing scan conversion and image processing for display. The beamformer delays and combines the streams of signal samples to form an array of beamformed samples corresponding to a particular direction in the field of view. The beamformer can produce a number of arrays of beamformed samples corresponding to a number of directions in the field of view. Depending on the type of diagnostic information desired B mode processing and or Doppler processing are then performed on the beamformed samples to form B mode detected samples and or Doppler detected samples. The spatial coordinates of the detected samples still correspond to the beam geometry of the beamformed samples. The scan converter performs coordinate transformations of the detected samples to produce frames of data having a raster format appropriate for display. Additional image processing is applied to the frames of samples to allow their display as two dimensional 2 D or three dimensional 3 D images.

Current efforts for improving medical ultrasound systems are directed to increasing the diagnostic capabilities of console cart systems and developing smaller portable devices with improved image quality. For the high end console or cart systems it is desirable to increase the number of transducer elements to produce higher resolution and or 3 D images to expand the diagnostic capability. Increasing the number of transducer elements increases the amount of data communicated from the transducer head to the console processor which can require a higher bandwidth communication channel and a larger cable connection. The data acquisition capacity of the transducer head is constrained by requirements for manipulation and form factors. Hand carried and handheld ultrasound devices are economical and desirable for use in small clinics mobile treatment units and the home. For these devices battery life is also a constraint. More efficient processing transfer and storage of ultrasound signal data in the ultrasound system can conserve power data transfer bandwidth and memory capacity.

Compression of ultrasound signal data can provide benefits for both console cart systems and portable systems. The benefits include reducing the data transfer bandwidth memory capacity and power requirements of the system. For a portable or hand carried ultrasound system these benefits reduce weight and increase battery life. For a console system compression mitigates the impact of increasing amounts of data acquired by the transducer head and transport of the data to the ultrasound signal processor. Compression that is computationally efficient introduces the benefits of compression with low or no impact on system complexity.

The present description uses the term compression to refer to data compression of ultrasound signal samples where the number of bits representing the signal samples is reduced and the signal samples are later decompressed prior to processing for display. Some descriptions of ultrasound imaging systems use the term compression to mean pulse compression not data compression. Pulse compression refers to filtering and or modulation of the transmitted ultrasound pulses and inverse filtering and or demodulation of the received ultrasound pulses. For example see Parameter optimization of pulse compression in ultrasound imaging system with coded excitation by V. Behar and D. Adam in Ultrasonics vol. 42 pp. 1101 1109 2004. Some descriptions of ultrasound imaging systems use the term compression to mean log compression not data compression. In that context log compression refers to calculating the logarithm of processed ultrasound data typically the magnitude detected data prior to display. For example see Signal Processing Overview of Ultrasound Systems for Medical Imaging by A. Murtaza et al. Texas Instruments SPRAB 12 pp. 1 26 Nov. 2008 . Both pulse compression and log compression intentionally change characteristics of the transmitted or received ultrasound signals in the time domain and frequency domain. Data compression of the received ultrasound signal samples followed later by decompression is a process that preserves the signal characteristics in the time and frequency domains. The present description refers to lossless and lossy compression of ultrasound signal samples. In lossless compression the decompressed samples have identical values to the original samples. In lossy compression the decompressed samples are similar but not identical to the original samples. The present description uses to the term frame to refer to an array of ultrasound data either raw or processed that is eventually processed to form an ultrasound image for display. Descriptions of ultrasound imaging systems in the art also use the term screen to refer to a frame of ultrasound data. In the present description real time means a rate that is at least as fast as the sample rate of a digital signal. The term real time can be used to describe rates for processing transfer and storage of the digital signal. The sample rate is the rate at which an ADC forms samples of a digital signal during conversion of an analog signal. Some descriptions of ultrasound imaging systems in the art use the term real time to refer to the frame rate for display of the ultrasound images. The present description relates real time to the sample rate instead of the frame rate interpretation.

Previous applications of data compression in ultrasound systems have included alternatives for data compression before and after scan conversion for image formation. In U.S. Pat. No. 6 315 722 entitled Ultrasonic Diagnostic Device issued on Nov. 13 2001 Yaegashi describes a time axis extension unit for storing ultrasound signal samples output from an ADC unit. The time axis extension unit writes the data at the rate output from the ADC unit and reads the data out at a lower rate. The time axis extension unit stores signal samples for one screen or frame and can be implemented using first in first out FIFO memories. A data compression unit compresses signal samples read from the time axis extension unit. Yaegashi describes applying image compression technologies such as methods based on the discrete cosine transform DCT for exploiting spatial correlation within one frame of data or MPEG compression methods for multiple frames of data. MPEG refers to the video data compression standards developed by the Moving Picture Experts Group. The compressed samples are stored in a mass memory device such as a hard disk. The data compression reduces the storage capacity needed in the mass memory device. For producing an image a data expanding unit decompresses the compressed samples retrieved from the mass memory device. Conventional operations including filtering logarithmic conversion detection and digital scan conversion are applied to the decompressed samples for image formation and display. Yaegashi does not disclose beamforming in the processing sequence.

In the US Patent Publication publication number 2008 0114246 entitled Transducer Array Imaging System Randall et al. describe compressing ultrasound digital data using mapping resampling and or data windowing before and or after beamforming. The mapping can include requantizing or clipping signal samples. For example the number of required bits decreases monotonically with depth so that fewer bits per sample may be assigned based on depth. In some embodiments signal samples from receive channels extending beyond the transmit and receive apertures may be truncated. For imaging a region of interest ROI signal acquisition time may be proportional to depth range so that data acquired before a minimum sample time and or after a maximum sample time may be truncated if they do not contribute to the formation of image pixels. In some embodiments the data may be resampled to fewer samples if the display resolution is less than required for full resolution imaging thus reducing the number of samples transferred.

In U.S. Pat. No. 6 042 545 entitled Medical Diagnostic Ultrasound System and Method for Transform Ultrasound Processing issued Mar. 28 2000 Hossack et al. describe transform compression techniques for ultrasound data after beamforming. Alternatives for beamforming include analog beamforming prior to the ADC or digital beamforming after the ADC. The beamformer generates in phase and quadrature I and Q samples or alternatively radio frequency RF samples. Beamformed samples corresponding to a two dimensional 2 D frame are filtered and transformed to produce a transform domain representation. The transform domain samples are quantized and or encoded for compression. The compression may be lossless or lossy. Any transform such as the DCT or the Discrete Wavelet Transform DWT quantization function and encoding function may be applied for compressing the frame of data. For example JPEG compression includes dividing the frames of data into 2 D blocks of data transforming using a 2 D DCT on each of the blocks quantizing the transform domain samples differentially encoding the DC zero frequency transform samples between blocks and entropy encoding the 2 D blocks of quantized transform domain samples e.g. Huffman encoding . The JPEG compression algorithms can be configured as lossy or lossless. JPEG compression refers to the standard image compression methods developed by the Joint Photographic Experts Group. Additional operations in the transform domain for various image processing functions such as filtering are more computationally efficient in the transform domain than the spatial domain. For example 2 D filtering in the spatial domain uses 2 D convolution operations. In the transform domain 2 D filtering uses more efficient multiplications by the transform domain filter coefficients. The compressed transform domain data can be stored for later image formation. For decompression the inverse encoding and transform functions are applied prior to processing for display.

In the U.S. Pat. No. 6 855 113 entitled Diagnostic Information Generation Apparatus and Ultrasonic Diagnostic System issued Feb. 15 2005 Amemiya et al. describe compressing frames of ultrasound data prior to wireless transmission from an ultrasonic wave unit to an information unit. The ultrasonic wave unit includes the transducer and a processer for subsequent beamforming B mode imaging and Doppler imaging. General purpose data compression standards are applied to the B mode imaging data or Doppler imaging data such as JPEG compression for a single frame or MPEG compression for multiple frames. The compressed data are transmitted using a standard wireless communication modality to the information unit. The information unit includes a central processing unit CPU that decompresses the received data in accordance with the compression standard. The CPU further processes the decompressed B mode imaging data and decompressed Doppler imaging data for display.

In the PCT published application international publication number WO 97 09930 entitled Ultrasonic Diagnostic Apparatus for Compressing and Storing Data in CINE Memory published Mar. 20 1997 Lee describes compressing ultrasound data prior to storage in a CINE memory and decompressing data retrieved from the CINE memory. A CINE memory includes several banks organized by time. In this system the ultrasonic probe performs beamforming prior to the ADC so the ADC output data represent beamformed samples. Compression is applied to a frame of data and can be applied before or after scan conversion. The Lempel Ziv Welch LZW algorithm is applied for compression and decompression. The LZW algorithm is based on detecting repeated patterns of bits in the data and assigning codes to the repeated patterns. The compressed data for a frame retrieved from the CINE memory are decompressed and further processed for display.

In the Japanese patent application publication number 2005 081082 entitled Ultrasonograph and Ultrasonic Data Compression Method published Mar. 31 2005 Akihiro describes three embodiments for compressing ultrasound data after analog beamforming. In the first embodiment an ADC generates I and Q samples of the analog beamformer output signals. The compressor calculates the differences between the I Q samples of adjacent beams followed by run length encoding of the differences to form the compressed data. The compressed data are stored in memory. Compressed data retrieved from memory are decompressed and processed for image display. In the second embodiment an ADC generates RF samples of the analog beamformer output samples. The compressor calculates differences between the RF samples of adjacent beams followed by run length encoding. The compressed samples are stored in memory retrieved decompressed and processed for image display. In the third embodiment beamformer output is further processed to generate B mode image frames and Doppler image frames prior to compression. The compressor calculates frame to frame differences to produce compressed data frames. The compressed data frames are stored in memory retrieved decompressed and further processed for display.

In the U.S. Pat. No. 4 751 929 entitled Ultrasonic Bloodstream Diagnostic Apparatus with Dual Displays of Velocity Profiles and Average Flow Velocity issued Jun. 21 1988 Hayakawa et al. describe compressing Doppler frequency detected data. The compressor operates on the output of a squaring and adding circuit that calculates the magnitude squared of the real and imaginary parts of the frequency spectrum samples. The compressor re encodes the bits of each sample output from the adder to reduce the number of bits in the representation. The compressor operates on the adder output sample to encode the location of the most significant bit in the mantissa preserve a fixed number of most significant bits and remove the remaining least significant bits. The resulting compressed word for each sample includes the fixed number of most significant bits and a code indicating the number of least significant bits eliminated from the original sample. A variable number of least significant bits are removed from each sample so the compression is lossy.

In the paper entitled A Novel B Mode Ultrasound Image Compression Method Based on Beam Forming Data 1998 Proc. Intl. Conf. IEEE Engineering in Medicine and Biology Society Vol. 20 No. 3 pp. 1274 76 Li et al. describe compressing beamformed samples for transmission in a tele ultrasound system. The DWT is applied to a frame of 128 512 beamformed samples. The coefficients of subimages in the vertical direction are quantized and encoded using arithmetic coding. After decompression scan conversion is applied to the frame of 128 512 decompressed samples to form the frame of 512 512 samples for display.

Several papers describe different methods for compressing ultrasound images after scan conversion for image formation. A few examples include the following. In the paper entitled Comparative Survey of Ultrasound Images compression Methods Dedicated to a Tele Echography Robotic System 2001 Proc. 23Annual IEEE Engineering in Medicine and Biology Society Intl. Conf. pp. 2461 64 Delgorge et al. describe applying different compression methods to ultrasound images. The methods include Fourier transform DCT quadtree decomposition DWT fractals histogram thresholding and run length coding. The methods are applied to 512 512 ultrasound images after scan conversion. In the paper entitled Despeckling of Medical Ultrasound Images Using Data and Rate Adaptive Lossy Compression IEEE Trans. Medical Imaging vol. 24 No. 6 Jun. 2005 pp. 743 54 Gupta et al. describe combining compression with an algorithm to remove speckle from the ultrasound image. The DWT is followed by the speckle removal algorithm quantization and entropy encoding. In the paper entitled A Tele Operated Mobile Ultrasound Scanner Using a Light Weight Robot IEEE Trans. Information Technology in Biomedicine Vol. 9 No. 1 Mar. 2005 pp. 50 58 Delgorge et al. describe applying various lossless and lossy compression methods to ultrasound images. The lossless methods include Huffman arithmetic coding Lempel Ziv run length coding and Fano coding. The lossy methods include various JPEG versions including JPEG JPEG LS and JPEG2000. In the paper entitled Maximum Likelihood Motion Estimation in Ultrasound Image Sequences IEEE Signal Processing Letters Vol. 4 No. 6 June 1997 pp. 156 7 Strintzis et al. describe applying MPEG compression to a sequence of ultrasound images. The method includes detecting motion vectors for 8 8 blocks of pixels between consecutive frames in the sequence of images. The motion vectors are encoded for frame to frame MPEG compression.

The commonly owned U.S. Pat. No. 7 009 533 the 533 patent entitled Adaptive Compression and Decompression of Bandlimited Signals dated Mar. 7 2006 describes algorithms for compression and decompression of certain bandlimited signals. The commonly owned U.S. Pat. No. 7 088 276 the 276 patent entitled Enhanced Data Converters Using Compression and Decompression dated Aug. 8 2007 describes applying lossless or lossy compression to signal samples output from an ADC implemented in a single integrated circuit. The commonly owned and copending U.S. patent application Ser. No. 12 120 988 the 988 application filed May 15 2008 entitled Digital Interface for Data Converters describes multiplexing data output from multiple ADCs in parallel to reduce the number of active data ports at the digital interface.

There is a need for efficient data transfer and storage of ultrasound signal data between components of the ultrasound imaging system. There is a need for computationally efficient data compression of ultrasound signal data to improve data transfer and storage capacity with minimal impact on system complexity.

Embodiments of the present invention have been made in consideration of the foregoing conventional problems. An object of the present invention is to compress ultrasound signal samples after analog to digital conversion in an ultrasound imaging system. The ultrasound imaging system includes an array of ultrasound transducer elements that outputs a plurality of analog ultrasound signals during a sampling window. The method comprises 

The compressed samples are decompressed prior to beamforming or other ultrasound signal processing operations.

Another object of the present invention is to provide an apparatus to compress ultrasound signal samples after analog to digital conversion of analog ultrasound signals in an ultrasound imaging system. The ultrasound imaging system includes an array of ultrasound transducer elements that outputs a plurality of analog ultrasound signals during a sampling window. The apparatus comprises an integrated circuit device having a plurality of analog inputs for receiving the plurality of analog ultrasound signals and a plurality of data ports at a digital interface the integrated circuit device comprising 

Another aspect of the present invention exploits excess data transfer bandwidth of the data ports to use fewer data ports to transfer the compressed samples over the digital interface. The sequences of compressed samples can be multiplexed to form fewer sequences that can be transferred using fewer data ports.

Another aspect of the present invention exploits excess data transfer bandwidth of the data ports to use fewer data ports to transfer uncompressed ultrasound signal samples over the digital interface. When the bit rates of the signal samples output from the plurality of ADCs are sufficiently less than the maximum data transfer bandwidth of the data ports the sequences of uncompressed signal samples can be multiplexed to form fewer sequences that can be transferred using fewer data ports.

The ultrasound signal processor performs the operations that extract the diagnostic information from the ultrasound signal samples including beamforming downconversion B mode processing and or Doppler processing described further with respect to . The ultrasound signal processor can be implemented in one or more processors such as a digital signal processor DSP field programmable gate array FPGA microprocessor or CPU of a computer. The scan converter performs coordinate transformations of a frame of processed samples to produce a frame of ultrasound image samples having a raster rectilinear format. The image processor can apply additional image enhancement operations to the ultrasound image samples. The display provides two dimensional or three dimensional images for analysis by a user.

The diagnostic information processor performs the appropriate operations on the I Q samples for the desired type of ultrasound image. B mode processing generates information representing the intensity of the echo signal. The magnitudes of the I Q samples can be calculated to form the detected samples for B mode imaging. Doppler processing estimates the velocity variance of velocity and energy from the I Q samples to form Doppler detected samples. The spatial coordinates of the B mode detected samples and the Doppler detected samples correspond to the geometry of the beamformed samples. The scan converter performs coordinate transformations of the detected samples to produce frames of data having raster format appropriate for display. The image processor performs additional image processing of the frames of samples prior to display as two dimensional or three dimensional images.

Since the compressed samples have fewer bits per sample than the original ultrasound signal samples the compressed samples can be transferred across the digital interface using fewer data ports than the uncompressed samples. is a block diagram for an ultrasound system including multiplexing the compressed samples for transfer across fewer data ports. For this example the ADC bank includes N ADCs ADC to ADCN producing streams of signal samples at the N ADC output channels Xto X. The compression units produce corresponding streams of compressed samples at N compressor outputs Yto Y. The compressed samples having a reduced bit rate are provided to the data ports . Preferably the data ports provide low voltage differential signaling LVDS data transmission. Alternatively the data ports can use serializer deserializer SerDes interfaces for data transmission. The document entitled LVDS Owner s Manual Including High Speed CML and Signal Conditioning Fourth Edition published in Jan. 2008 by National Semiconductor describes LVDS devices and architectures. The LVDS data transmission has desirable characteristics including a maximum data transfer rate of 3.125 Gbps low noise and low power consumption. The differential signaling requires two I O pins per channel output one for the positive differential output and one for the negative differential output referred to as an LVDS pair. The data port has excess bandwidth when the bit rate of the compressed samples at compressor output Y is lower than the port s maximum data transfer rate. The excess bandwidth can be utilized by combining multiple streams of compressed samples for transfer over a given data port . The multiplexer combines N sequences of compressed samples to form M sequences of multiplexed compressed samples where M

The advantages of multiplexing the compressed samples to use M data ports include using fewer physical data ports which in turn reduces the connections and power consumption of the data ports. In applications where the bit rate of the compressed samples is fixed the multiplexer has a fixed number of multiplexer outputs for a fixed number of physical data ports . Alternatively a flexible architecture can support a variable number active data ports depending on the bit rate of the compressed samples. For the flexible architecture the compressor provides compressed samples at various bit rates that depend on a user selectable compression ratio parameter. A compression controller not shown in provides compression control parameters to the compression units so that the operations produce compressed samples with a bit rate that corresponds to the desired compression ratio. The compression controller provides multiplexing control parameters to the multiplexer to indicate the number of sequences of multiplexed compressed samples to produce at the multiplexer outputs . The compression controller can also respond to the user input to power down the inactive data ports thus further conserving power.

It is also possible for the data ports to have excess bandwidth for certain values of the sample rate and bits per sample even without compressing the signal samples. The data ports have excess bandwidth when the product of the sample rate and number of bits per sample results in a bit rate at the ADC output that is lower than the maximum data transfer rate of the data port . For example suppose the ADC clock frequency is 50 megahertz MHz corresponding to 50 Msps and the sample width is 12 bits per sample so that each ADC produces 600 megabits per second Mbps . The data transfer rate will be 600 Mbps for each data port . For an LVDS port having a maximum data transfer rate of 800 Mbps there is an unused bandwidth of 200 Mbps for each port. The data ports will consume the same amount of power to transfer data at 600 Mbps as they would for transferring data at full capacity of 800 Mbps because LVDS interfaces are constant current thus constant power links. Port concentration exploits the excess data transfer capacity by combining bits from multiple ADC outputs and transmitting the combined data at a faster rate over fewer ports. Each data port transmits the combined data at a rate that is greater than the ADC bit rate and up to the maximum data transfer rate of each data port

The compression methods applied by compression units include block floating point encoding and computing first or higher order derivatives of the signal samples followed by block floating point encoding. Huffman or other types of encoding can be alternatives to block floating point encoding.

The preferred embodiment of the compression unit applies block floating point encoding to groups of consecutive signal samples from the ADC output each group having N GROUP samples. The maximum exponent for the N GROUP samples is encoded and the N GROUP samples are encoded according to the following steps.

For the first group of samples the exponent n exp 0 is directly encoded. For example the exponent n exp 0 can be encoded as follows where S is the original number of bits per sample 

For the igroup the exponent n exp i is differentially encoded using a prefix code where no codeword is the prefix of another codeword. The preferred differential encoding is as follows 

Encoding the mantissas and exponents separately can provide additional compression and mitigate compression error. The difference values of consecutive exponents are calculated and encoded. The exponents vary slowly so there are relatively few nonzero values separated by strings of zero values. The exponent difference values can be efficiently encoded by representing only the nonzero difference values and their corresponding positions. The position can be represented by the corresponding index value or relative to the position of the last nonzero difference value. Encoding of the exponent difference values is lossless which prevents relatively large errors. For decoding the exponents the exponent values are reconstructed by integrating the exponent difference values and decoding the corresponding position locations. For decoding of the mantissas each reconstructed mantissa value is restricted to so that it does not change the value of the corresponding exponent of the decoded sample. For a decoded exponent of n exp the reconstructed mantissa can have a maximum value of 2 1. This prevents compression error in the mantissa from changing the value of the exponent.

An alternative block floating point encoding method includes reducing the number of bits representing the mantissa and differential encoding of the exponents as described above. The number of bits representing the mantissas of the N GROUP samples is reduced by selectively removing a number of least significant bits LSBs from each mantissa depending on the value of n exp for the group. illustrates an example of selecting bits for representing the reduced mantissa. The n exp is determined as in step 1 and step 4 above. Instead of encoding all of the n exp lower bits of the mantissa a number n LSB of bits starting with the least significant bit are removed. The remaining m exp bits m exp n exp n LSB are selected for encoding. The value of n LSB depends on the value of n exp according to a formula or a table. is a table of exemplary values of n exp n LSB and m exp. For larger values of n exp more LSBs are removed by truncating or rounding to form the reduced mantissa having m exp bits. For example if n exp is 12 3 LSBs are removed so that 9 mantissa bits are retained for packing the N GROUP reduced mantissas. The compressor can store a lookup table of values of n exp n LSB and m exp. Alternatively the compressor can represent n LSB and m exp as a function of n exp and calculate their values when needed. is a block diagram of block floating point encoding using reduced mantissas. For the each group of N GROUP samples the exponent calculator determines the maximum exponent n exp as described above. The mantissa bit calculator determines the number of bits m exp in the reduced mantissa using a lookup table or formula. The reduced mantissa packer selects the m exp bits for each of the N GROUP samples. The multiplexer then packs the exponent token followed by the reduced mantissas and to form the compressed group . For some conditions no LSBs are removed from the group of N GROUP samples. For example when the magnitude of one or more samples in the N GROUP samples is less than an acceptable minimum the N GROUP mantissas including the original LSBs will be packed. The sequence of compressed samples can include compressed groups with or without reduced mantissas.

A compression controller provides compression control parameters to the compression units for block floating point encoding. There can be multiple alternative lookup tables or formulas for n LSB m exp and n exp. The compression control parameters include N GROUP and selection parameters for alternative lookup tables or formulas for n LSB m exp and n exp. The compression control parameters can be uniform for all the compression units . Alternatively the compression control parameters can have different values for the different compression units . The compression controller can respond to user input to select the compression control parameters.

The compressed samples may be inserted into the data portions of compressed packets for transfer over the digital interface . The sequence of compressed samples corresponding to a received pulse digitized by an ADC may be arranged in one or more compressed packets. Alternatively sequences of compressed samples from multiple ADCs may be combined to form a compressed packet for transfer over a given data port as described with respect to . The header portion of the compressed packet contains identifying information for the packet. The header can also contain control data that represent the compression control parameters for the compressed samples in the packet. The information on the compression control parameters can be used by the decompressor to configure the decompression operations.

For decompression the decompressor applies block floating point decoding to the sequences of compressed samples. For each group of N GROUP compressed samples the decompressor decodes the exponent token to determine the value of n exp. The differentially encoded exponents are integrated to form the value of n exp. The N GROUP mantissas are then reconstructed by unpacking the bits for each mantissa from the compressed group or and mapping the bits to the decompressed sample. The decompressed samples can be represented by the original number of bits per sample or a different number of bits per sample depending on the downstream processing requirements of the ultrasound signal processor . For the block floating point encoder using reduced mantissas the decompressor also includes a lookup table or formula for determining the values n LSB based on the decoded values of n exp. The unpacked bits for the reduced mantissa are appended by n LSB bits which can be zeros or dithered values to approximate the original sample values.

The 533 patent describes algorithms for compression and decompression of certain bandlimited signals. Some of the alternative compression methods described below are modifications of the algorithms of the 533 patent for ultrasound signal samples.

Another alternative for compression of ultrasound signal samples is calculating differences followed by encoding. Calculating first or higher order differences of the ultrasound signal samples can result in difference samples having smaller magnitudes than the original signal samples. Encoding the difference samples can result in greater compression than encoding the samples themselves. Calculating the differences of consecutive samples of the ADC output can be followed by block floating point encoding of the difference samples as described above. In this case the difference samples are input to the block floating point encoder instead of the signal samples of the ADC output . Alternatively Huffman encoding or other encoding can be applied to the difference samples.

Another alternative for compression applies arithmetic operations to the ultrasound signal samples based on the center frequency and sample rate. gives examples that illustrate principles underlying alternatives for compressing signal samples with different center frequencies. Beginning with the example of a baseband signal corresponding to row labeled Band in the center frequency is near DC 0 Hz and the phase increase between consecutive samples is less than 10 degrees. The first phasor diagram shows that since the phase changes between consecutive samples are small the magnitudes of the differences of consecutive samples will be relatively small compared to the magnitudes of the samples themselves. The first example sequence corresponds to samples of a Band baseband signal. Since the differences between consecutive samples are small relative to the sample magnitudes calculating first or higher order differences or differential encoding creates difference samples with smaller data widths than the original samples. Compression using differential encoding described with respect to is effective for the baseband Band example.

For the example of Band in the center frequency is near f 4 and the phase increase between consecutive samples is about 90 degrees. The third phasor diagram shows that samples separated by 180 degrees or 2 sample intervals have similar magnitude and opposite polarity. The third example sequence also shows that every other sample has similar magnitudes and opposite polarities. For Band adding together every other sample will result in modified samples with smaller data widths that can be encoded more efficiently than the original samples.

For the example of Band in the center frequency is near f 3 and the phase increase between consecutive samples is about 120 degrees. The fourth phasor diagram shows that samples separated by 360 degrees or 3 sample intervals will have similar magnitudes. The fourth example sequence shows that every third sample has similar magnitudes. In this case forming a difference between samples separated by 3 sample intervals will give a modified sample with a smaller data width that can be encoded more efficiently than the original samples.

For the example of Band in the center frequency is f 2 and the phase increase between consecutive samples is about 180 degrees. The fifth phasor diagram shows that samples separated by 180 degrees or one sample interval will have similar magnitudes but opposite polarities. The fifth example sequence shows consecutive samples have similar magnitudes and opposite polarities. In this case adding two consecutive samples will form a modified sample with a smaller data width that can be encoded more efficiently than the original samples.

The above examples described for show that magnitude reduction can be achieved by performing operations such as addition or inversion followed by subtraction or subtraction or inversion followed by addition on signal samples that are separated by 1 2 or 3 sample intervals depending on the ratio of the sample rate to the center frequency. The resulting modified samples are then encoded to form compressed samples. Similar operations can be applied to samples that are separated by four or more sample intervals depending on the ratio of the center frequency to the sample rate to produce modified samples with smaller data widths than the original signal samples.

The compression controller provides control parameters to the compressor elements based on the ratio of the sample rate to the center frequency of the signal samples. The reorder demux and arithmetic operator respond to the compression control parameters and respectively to perform the appropriate operations. shows the operations that produce modified samples based on the center frequency. The first column gives the possible center frequencies for this example. The second column gives a corresponding frequency band indicator for each center frequency. The indicators can be used as parameters for compression controls and . The third column gives the different separations of samples x i and x i j at reorder demux output that would be produced in accordance with compression control parameter . The fourth column shows the result of selecting the arithmetic operations of addition or subtraction in accordance with compression control parameter . When the inverter is on the delayed sample x i j is subtracted. The fifth column shows the mathematical results of the arithmetic operator that produce the modified samples or y i . The compression controller also provides control of the encoder . The compression control parameter can indicate a parameter for block floating point encoding or other encoding technique.

The embodiments for the compressor apply simple operations that can compress samples output from the ADCs in real time or at a rate that is at least as fast as the sample rate. The difference operator includes one or more subtractors. The block floating point encoding uses comparators subtractors and lookup tables. Alternatively Huffman encoding uses a lookup table to assign a code to a value. The compression operations described with respect to include demultiplexing adding and subtracting. The embodiments for the decompressor apply simple operations to decompress the compressed sample. The decompressor includes lookup tables and adders for block floating point decoding. The integration operator includes one or more adders for integrating the decoded samples. The operations of the decompressor in include adding subtracting and multiplexing.

The preferred implementation of the present invention in an ultrasound system integrates the compressor and the bank of ADCs in a single application specific integrated circuit ASIC device. Referring to the block diagram of the bank of ADCs is integrated with the compressor in a mixed signal integrated circuit device having analog inputs and digital outputs. The plurality of N independent ADCs convert N input analog ultrasound signals to N digital ultrasound signals in parallel. The ADCS can be implemented by pipeline data converters comprising multiple stages of flash converters or other ADC architecture. Intellectual property IP cores for ADCs are commercially available for ASIC implementations. The ADC output channels are coupled to digital logic implementing the compressor . The preferred implementation of the compressor includes multiple compression cores in parallel where each compression core is coupled to one of the ADCs and implements the compression operations of one compression unit . Alternatively one compression core can implement multiple compression units to compress signal samples from more than one ADC . For this alternative the compression core includes buffers to store signal samples from the different ADCs until they are processed. The compression operations can also be implemented in a field programmable gate array FPGA . The compressed samples can be output over LVDS ports to the digital interface as shown in and . The IP cores for LVDS interfaces are commercially available for ASIC and FPGA implementations. Alternative implementations include compression operations in a separate device that is coupled to the outputs of a parallel ADC device. The compression operations can be implemented in an ASIC FPGA or a programmable processor such as a digital signal processor DSP microprocessor microcontroller multi core CPU such as IBM Cell or graphics processing unit GPU such as Nvidia GeForce .

Depending on the ultrasound system architecture the decompressor may be incorporated into the same device as or a different device from the ultrasound signal processor . The decompression operations can be implemented in an ASIC or FPGA. Alternatively the decompression operations can be implemented in software or firmware programs executable by a programmable processor such as a DSP microprocessor microcontroller CPU or GPU. The preferred implementation of the decompressor is a software program having instructions for the decompression operations executable by a GPU. The GPU may also be programmed to implement at least a portion of the operations such as beamforming operations of the ultrasound signal processor on the decompressed samples. Alternatively the decompressed samples may be transferred to another programmable processor such as a CPU for the ultrasound signal processing operations.

In a preferred system architecture the system controller may be embodied in a motherboard of a computer having a screen for the display . The GPU device may be embodied in a graphics card including the DRAM in communication with the system controller by a PCIe Peripheral Component Interconnect Express backplane link. Alternatively the GPU device may be embodied in an IC mounted on the motherboard. In a system architecture where the ADC bank and compressor are mounted in a data acquisition card the digital interface may be embodied by a PCIe backplane link.

It will be appreciated that in accordance with Moore s Law higher levels of integration will provide for more compact devices so that the system controller and the GPU device may be implemented in a single IC. For example Intel Corporation is developing a many core IC architecture that includes multiple instantiations of an x86 CPU core augmented with a vector processing unit. The architecture referred to as Larrabee is described in the document entitled Larrabee A Many Core x86 Architecture for Visual Computing by Seiler et al. ACM Transactions on Graphics Vol. 27 No. 3 Article 18 August 2008. The Larrabee architecture supports applications requiring parallel processing including graphics processing. The Larrabee Native programming model includes a C C and APIs for parallel programming and vectorization.

In a system architecture where the ADC bank and compressor are housed in the transducer head the digital interface may be a wired or a wireless communication link. For a wired communication link the digital interface may be implemented by a PCIe cable link or an optical fiber link. For a wireless communication link the digital interface may provide digital modulation and transmission of the compressed packets via a radio frequency channel and digital demodulation of the received compressed packets. The wireless link may comply with a wireless communication protocol such as WiFi IEEE 802.11 or an UWB ultra wideband format.

While the preferred embodiments of the invention have been illustrated and described it will be clear that the invention is not limited to these embodiments only. Numerous modifications changes variations substitutions and equivalents will be apparent to those skilled in the art without departing from the spirit and scope of the invention as described in the claims.

