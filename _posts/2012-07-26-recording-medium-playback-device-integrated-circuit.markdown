---

title: Recording medium, playback device, integrated circuit
abstract: A base-view video stream and a dependent-view video stream are recorded on a BD-ROM. The base-view video stream includes picture data constituting a base view of a stereoscopic image. The dependent-view video stream includes offset metadata and picture data constituting a dependent view of the stereoscopic image. The offset metadata includes an offset sequence that defines an offset control of a plane memory when a graphics to be overlaid with the picture data is played back in a one-plane offset mode.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=08705935&OS=08705935&RS=08705935
owner: Panasonic Corporation
number: 08705935
owner_city: Osaka
owner_country: JP
publication_date: 20120726
---
This application is a divisional of application Ser. No. 12 907 323 filed Oct. 19 2010 the contents of which are hereby incorporated by reference which is a continuation of International Application PCT JP2010 000913 with an international filing date of Feb. 15 2010.

The 2D images also called monoscopic images are represented by pixels on an X Y plane that is applied to the display screen of the display device.

In contrast the 3D images have a depth in the Z axis direction in addition to the pixels on the X Y plane applied to the screen of the display device. The 3D images are presented to the viewers users by simultaneously playing back the left view and right view images to be viewed respectively by the left and right eyes so that a stereoscopic effect can be produced. The users would see among the pixels constituting the 3D image pixels having positive Z axis coordinates in front of the display screen and pixels having negative Z axis coordinates behind the display screen.

It is preferable that an optical disc storing a 3D image has compatibility with a playback device that can play back only 2D images hereinafter such a playback device is referred to as 2D playback device . This is because otherwise two types of discs for 3D and 2D images need to be produced so that the 2D playback device can play back the same content as that stored in a disc for 3D image. Such an arrangement will take a higher cost. It is accordingly necessary to provide an optical disc storing a 3D image that is played back as a 2D image by the 2D play back device and as a 2D or 3D image by a play back device supporting both the 3D and 2D images hereinafter such a playback device is referred to as 2D 3D playback device .

Patent Literature 1 identified below is one example of prior art documents describing technologies for ensuring the compatibility in playback between 2D and 3D images with respect to optical discs storing 3D images.

The left view and right view images to be used in the stereoscopic playback are obtained by the shooting with use of a 3D camera. The 3D camera has two lenses separated by a distance corresponding to the parallax of human beings. When the left view and right view images having been shot via the two lenses are played back alternately the parallax of human beings is created.

However the subtitle and menu are not obtained by the shooting with use of a 3D camera but are generated by the authoring process after the shooting is completed seeing the stereoscopic video played back. To create the subtitle and menu for each of the left and right views imagining how the subtitle and menu will appear during the stereoscopic playback takes an enormous amount of time and effort by the authoring staff. Accordingly the process of creating the subtitle and menu in the production of a stereoscopic content with subtitle and menu is desired to be as efficient as possible. Also how far a moving object in the video appears to pop out changes moment by moment for each frame period. Thus when the depths of the subtitle and menu are fixed the subtitle and menu often overlap with an image of a person in the video causing such an odd scene as would invite a derisive laughter as in a case where a rectangular frame of the menu appears to be thrust into the person in the screen. To prevent such a strange scene from being provided the authoring should be done properly even if it takes a lot of time and effort.

Here the efforts required for the authoring might be reduced to some extent by storing control information for the stereoscopic viewing of the subtitle and menu into the graphics stream so that the depths of the graphics can be adjusted automatically. However there are as many as 32 graphics streams that represent the subtitle and menu. Some of them may not be decoded depending on the operation mode of the device the state of the device or the selection by the user. This necessitates a wasteful process of accessing the graphics stream in which the control information is stored to obtain the control information for the stereoscopic viewing.

It is therefore an object of the present invention to provide a recording medium for enabling a high quality stereoscopic video to be played back without increasing the amount of time and effort required for the authoring.

The above described object is fulfilled by a recording medium on which a main view video stream a sub view video stream and a graphics stream are recorded wherein the main view video stream includes picture data constituting a main view of a stereoscopic image the sub view video stream includes metadata and picture data constituting a sub view of the stereoscopic image the graphics stream includes graphics data and a graphics plane on which the graphics data is drawn is overlaid with a main view video plane and a sub view video plane on which the respective picture data are drawn the metadata is control information defining an offset control that applies offsets of leftward and rightward directions to horizontal coordinates in the graphics plane when the graphics plane is overlaid with the main view video plane and the sub view video plane and the control information includes information that indicates by a number of pixels values of the offsets to be applied to the graphics plane.

In the above described structure it is defined that the control information for the offset control is located in the sub view video stream. This makes it possible to easily generate the control information for the offset control when the playback device operates with one plane by generating the control information based on the depth information obtained in the shooting by a 3D camera or the parallax information obtained in the encoding process by the encoder for generating the video stream and incorporating the generated control information into the sub view video stream as the metadata. This reduces the work in the authoring process by a great amount. The control information defines the offset control for the case where the playback device operates with one plane. Thus even if there are no subtitles or menus for the left and right views a stereoscopic playback is available only if there is one subtitle or menu. In this way the structure of the present invention not only reduces the amount of time and effort required for creating a subtitle or menu for each of the main and sub views but can realize a stereoscopic playback even if the memory in the playback device has a size of one plane as the plane memory. It therefore realizes both an efficient authoring and a cost reduction in the playback device.

In the above stated recording medium the picture data in the main view video stream and the picture data in the sub view video stream may each represent a plurality of groups of pictures each of the plurality of groups of pictures may constitute a plurality of frames and may have control information as a parameter sequence in correspondence with each of the plurality of frames. The parameter sequence can define the depth of graphics for each frame constituted from each group of pictures in the video stream time axis. Thus it is possible to define in one parameter sequence a function Z t for calculating from an arbitrary frame time t a depth z that corresponds to the frame time t .

When the function Z t is a parabolic function having the frame time as a variable the playback device can use for the shift control a parameter sequence corresponding to the function Z t to produce a realistic video playback in which for example a graphics representing a baseball ball comes from far to in front of or goes away from the viewer.

With the above described structure it is possible to change the depth in real time as the playback point in the video stream time axis proceeds. It is therefore possible to realize a varied stereoscopic playback of graphics even if there are no graphics materials corresponding to the left and right eyes.

The following describes an embodiment of a recording medium and a playback device provided with means for solving the above described problems with reference to the attached drawings. First a brief description is give of the principle of the stereoscopic view.

In general due to the difference in position between the right eye and the left eye there is a little difference between an image seen by the right eye and an image seen by the left eye. It is this difference that enables the human beings to recognize the image they see in three dimensions. The stereoscopic display is realized by using the parallax of human beings so that a monoscopic image looks as is it is three dimensional.

More specifically there is a difference between the image seen by the right eye and the image seen by the left eye the difference corresponding to parallax of human beings. The stereoscopic display is realized by displaying the two types of images alternately at regular short time intervals.

The short time interval may be a time period that is short enough to provide human beings by the alternate displays an illusion that they are seeing a three dimensional object. The methods for realizing the stereoscopic viewing include one using a holography technology and one using a parallax image.

The former method the holography technology is characterized in that it can reproduce an object three dimensionally in the same manner as a human being recognizes the object normally and that in regards with video generation although it has established a technological theory it requires i a computer that can perform an enormous amount of calculations to generate the video for holography in real time and ii a display device having a resolution in which several thousands of lines can be drawn in a length of 1 mm. It is extremely difficult for the current technology to realize such a product and thus products for commercial use have hardly been developed.

On the other hand the latter method using a parallax image has a merit that a stereoscopic viewing can be realized only by preparing images for viewing with the right eye and the left eye. Some technologies including the sequential segregation method have been developed for practical use from the viewpoint of how to cause each of the right eye and the left eye to view only the images associated therewith.

The sequential segregation method is a method in which images for the left eye and right eye are alternately displayed in a time axis direction such that left and right scenes are overlaid in the brain by the effect of residual images of eyes and the overlaid image is recognized as a stereoscopic image.

In any of the above described methods the stereoscopic image is composed of at least two view point images. The view point image is an image that is deflected to some extent and said at least two view point images include a main view image and a sub view image. When the main view and sub view images are to be supplied from a recording medium via video streams a main view video stream and a sub view video stream are recorded on the recording medium where the main view video stream is a video stream for supplying the main view image and the sub view video stream is a video stream for supplying the sub view image. The recording medium described in the following is provided so that the main view video stream and the sub view video stream can be recorded thereon suitably.

The playback device described in the present application is a 2D 3D playback device player which provided with the 2D playback mode and the 3D playback mode can switch between these playback modes to play back the main view video stream and the sub view video stream.

The television provides the user with an interactive operation environment by displaying a menu and the like as well as the movie work. The user needs to wear the 3D glasses for the television of the present embodiment to realize the stereoscopic viewing. Here the 3D glasses are not necessary when the television displays images by the lenticular method. The television for the lenticular method aligns pictures for the left and right eyes vertically in a screen at the same time. And a lenticular lens is provided on the surface of the display screen such that pixels constituting the picture for the left eye form an image only in the left eye and pixels constituting the picture for the right eye form an image only in the right eye. This enables the left and right eyes to see respectively pictures that have a parallax thereby realizing a stereoscopic viewing.

The 3D glasses are equipped with liquid crystal shutters that enable the user to view a parallax image by the sequential segregation method or the polarization glasses method. Here the parallax image is an image which is composed of a pair of i an image that enters only into the right eye and ii an image that enters only into the left eye such that pictures respectively associated with the right and left eyes respectively enter the eyes of the user thereby realizing the stereoscopic viewing. shows the state of the 3D glasses when the left view image is displayed. At the instant when the left view image is displayed on the screen the liquid crystal shutter for the left eye is in the light transmission state and the liquid crystal shutter for the right eye is in the light block state. shows the state of the 3D glasses when the right view image is displayed. At the instant when the right view image is displayed on the screen the liquid crystal shutter for the right eye is in the light transmission state and the liquid crystal shutter for the left eye is in the light block state.

The remote control is a machine for receiving from the user operations for playing back AV. The remote control is also a machine for receiving from the user operations onto the layered GUI. To receive the operations the remote control is equipped with a menu key arrow keys an enter key a return key and numeral keys where the menu key is used to call a menu constituting the GUI the arrow keys are used to move a focus among GUI components constituting the menu the enter key is used to perform ENTER determination operation onto a GUI component constituting the menu the return key is used to return to a higher layer in the layered menu.

In the home theater system shown in an output mode of the playback device for causing the display device to display images in the 3D playback mode is called 3D output mode and an output mode of the playback device for causing the display device to display images in the 2D playback mode is called 2D output mode .

Embodiment 1 is characterized in that when a pair of the main view video stream and the sub view video stream for realizing the stereoscopic playback is supplied to the playback device by recording these streams on the recording medium control information defining the offset control is embedded in the metadata in the sub view video stream.

The offset control mentioned here is a control to apply the offsets of leftward and rightward directions to horizontal coordinates in the graphics plane and overlay the resultant graphics planes with the main view video plane and the sub view video plane on which picture data constituting the main view and sub view are drawn respectively.

Furthermore the control information used in the shift control functions as parameter sequences that define i information indicating the offset value and ii information indicating the offset direction in correspondence with each of a plurality of frames.

In the following description the main view and the sub view are used to realize the parallax image method. The parallax image method also called a 3D LR mode is a method for realizing the stereoscopic viewing by preparing separately an image for the right eye and an image for the left eye and causing the image for the right eye to enter only into the right eye and the image for the left eye enter only into the left eye. shows the user s head on the left hand side of the drawing and the images of a dinosaur skeleton seen respectively by the left eye and the right eye of the user on the right hand side of the drawing. When the light transmission and block are repeated alternately for the right and left eyes the left and right scenes are overlaid in the brain of the user by the effect of residual images of eyes and the overlaid image is recognized as a stereoscopic image appearing in front of the user.

Among the parallax images the image entering the left eye is called a left eye image L image and the image entering the right eye is called a right eye image R image . A video composed of only L images is called a left view video and a video composed of only R images is called a right view video. Also the video streams which are obtained by digitizing and compress encoding the left view video and right view video are called left view video stream and right view video stream respectively.

These left view and right view video streams are compressed by the inter picture prediction encoding using the correlated property between view points as well as by the inter picture prediction encoding using the correlated property in a time axis. The pictures constituting the right view video stream are compressed by referring to the pictures constituting the left view video stream having the same display times. One of the video compression methods using such a correlated property between view points is a corrected standard of MPEG 4 AVC H.264 which is called Multi view Video Coding MVC . The Joint Video Team JVT which is a joint project of the ISO IEC MPEG and the ITU T VCEG completed in July 2008 the formulation of the corrected standard of MPEG 4 AVC H.264 called the Multi view Video Coding MVC . The MVC is a standard for encoding in bulk images for a plurality of view points. Due to the use in the prediction encoding of the similarity of images between view points as well as the similarity of images in a time axis the MVC has improved the compression efficiency compared with methods for encoding independent images for a plurality of view points.

A video stream among the left view video stream and the right view video stream having been compress encoded by the MVC that can be decoded independently is called base view video stream . A base view indicator which will be described later indicates which of the left view video stream and the right view video stream is specified as the base view video stream. Also a video stream among the left view video stream and the right view video stream that has been compress encoded based on the inter frame correlated property with each picture data constituting the base view video stream and that can be decoded only after the base view video stream is decoded is called dependent view stream .

A video stream among the left view video stream and the right view video stream having been compress encoded with use of the correlated property between view points that can be decoded independently is called base view video stream . A base view indicator in the playitem information indicates which of the left view video stream and the right view video stream is specified as the base view video stream.

At the moment the MVC is considered to be the best method for encoding the stereoscopic images. Accordingly in the description hereinafter it is presumed that main view video stream is base view video stream and sub view video stream is dependent view video stream .

The video stream in the MPEG4 AVC format which forms the basis of the MVC video stream is described in the following.

The MVC video stream has the GOP structure and is composed of closed GOPs and open GOPs. The closed GOP is composed of an IDR picture and B pictures and P pictures that follow the IDR picture. The open GOP is composed of a non IDR I picture and B pictures and P pictures that follow the non IDR I picture.

The non IDR I pictures B pictures and P pictures are compress encoded based on the frame correlation with other pictures. The B picture is a picture composed of slice data in the bidirectionally predictive B format and the P picture is a picture composed of slice data in the predictive P format. The B picture is classified into reference B Br picture and non reference B B picture.

In the closed GOP the IDR picture is disposed at the top. In the display order the IDR picture is not the top but pictures B pictures and P pictures other than the IDR picture cannot have dependency relationship with pictures existing in a GOP that precedes the closed GOP. As understood from this the closed GOP has a role to complete the dependency relationship.

Next the internal structure of the GOP is described. Each piece of picture data in the open and closed GOPs has the video access unit structure of the H.264 encoding method.

The relationship between the video access unit and the picture is 1 video access unit 1 picture . In the BD ROM the relationship is restricted to 1 PES packet 1 frame . Therefore when the video has the frame structure 1 PES packet 1 picture and when the video has the field structure 1 PES packet 2 pictures . Taken these into account the PES packet stores the picture in a one to one ratio.

In the second row of the internal structures of the left view video stream is shown. This stream includes picture data I P Br Br P Br Br and P. These picture data are decoded according to the Decode Time Stamps DTS . The first row shows the left eye image. The left eye image is played back by playing back the decoded picture data I P Br Br P Br Br and P according to the PTS in the order of I Br Br P Br Br and P.

In the fourth row of the internal structures of the right view video stream is shown. This stream includes picture data P P B B P B B and P. These picture data are decoded according to the DTS. The third row shows the right eye image. The right eye image is played back by playing back the decoded picture data P P B B P B B and P according to the PTS in the order of P B B P B B and P.

The fifth row shows how the state of the 3D glasses is changed. As shown in the fifth row when the left eye image is viewed the shutter for the right eye is closed and when the right eye image is viewed the shutter for the left eye is closed.

In for example the starting P picture of the right view video stream refers to the I picture of the left view video stream the B picture of the right view video stream refers to the Br picture of the left view video stream and the second P picture of the right view video stream refers to the P picture of the left view video stream. Here a mode in which video frames of the base view video stream B and video frames of the dependent view video stream D are alternately output at a display cycle of 1 48 seconds like B D B D is called a B D presentation mode .

Also a mode in which a same type of video frame is repeatedly output twice or more while the 3D mode is maintained as the playback mode is called a B B presentation mode . In the B B presentation mode video frames of an independently playable base view video stream are repeatedly output like B B B B .

The B D presentation mode and the B B presentation mode described above are basic presentation modes in the playback device. Other than these a playback mode called 1 plane offset mode is available in the playback device.

The 1 plane offset mode also referred to as 3D offset mode is a playback mode in which the stereoscopic viewing is realized by incorporating a shift unit in the latter half of the plane memory and functioning the shift unit. In each of the left view period and the right view period the plane offset unit shifts the coordinates of the pixels in the plane memory in units of lines leftward or rightward to displace the image formation point of the right eye and left eye view lines frontward or backward so that the viewer can feel a change in the sense of depth. More specifically when the pixels coordinates are shifted leftward in the left view period and rightward in the right view period the image formation point is displaced frontward and when the pixels coordinates are shifted rightward in the left view period and leftward in the right view period the image formation point is displaced backward.

In such a plane shift the plane memory for the stereoscopic viewing only needs to have one plane. It is thus the best method for generating the stereoscopic images with ease. However the plane shift merely produces stereoscopic images in which monoscopic images come frontward or go backward. Therefore it is suited for generating a stereoscopic effect for the menu or subtitle but leaves something to be desired in realizing a stereoscopic effect for the characters or physical objects. This is because it cannot reproduce dimples or unevenness of the faces of characters.

To support the 1 plane offset mode the playback device is structured as follows. For the playback of graphics the playback device includes a plane memory a CLUT unit and an overlay unit. The plane shift unit is incorporated between the CLUT unit and the overlay unit. The plane shift unit realizes the above described change of pixel coordinates by using the offset in the offset sequence incorporated in the access unit structure of the dependent view video stream. With this arrangement the level of jump out of pixels in the 1 plane offset mode changes in synchronization with the MVC video stream. The 1 plane offset mode includes 1 plane zero offset mode . The 1 plane zero offset mode is a display mode which when the pop up menu is ON gives the stereoscopic effect only to the pop up menu by making the offset value zero.

The target of the shift control by the offset sequence is a plurality of plane memories which constitute a predetermined layer model. The plane memory is a memory for storing one screen of pixel data which has been obtained by decoding the elementary streams in units of lines so that the pixel data can be output in accordance with the horizontal and vertical sync signals. Each of a plurality of plane memories stores one screen of pixel data that is obtained as a result of decoding by the video decoder PG decoder or IG decoder.

The predetermined layer model is composed of a layer of the base view video plane and the dependent view video plane a layer of the PG plane and a layer of the IG BD J plane and is structured so that these layers and the contents of the plane memories in these layers can be overlaid in the order of the base view video plane PG plane and IG BD J plane from the bottom.

The layer overlay is achieved by executing a superimposing process onto all combinations of the two layers in the layer model. In the superimposing process pixel values of pixel data stored in the plane memories of the two layers are superimposed. The following describes the plane memories in each layer.

The base view video plane is a plane memory for storing one screen of pixel data that is obtained by decoding view components constituting the base view video stream. The dependent view video plane is a plane memory for storing one screen of pixel data that is obtained by decoding view components constituting the dependent view video stream.

The presentation graphics PG plane is a plane memory for storing graphics that are obtained when a graphics decoder which operates by the pipeline method performs the decoding process. The IG BD J plane is a plane memory that functions as an IG plane in some operation mode and functions as a BD J plane in other operation mode. The interactive graphics IG plane is a plane memory for storing graphics that are obtained when a graphics decoder which operates based on the interactive process performs the decoding process. The BD J plane is a plane memory for storing the drawing image graphics that are obtained when an application of an object oriented programming language performs the drawing process. The IG plane and the BD J plane are exclusive to each other and when one of them is used the other cannot be used. Therefore the IG plane and the BD J plane share one plane memory.

In the above mentioned layer model with regard to the video plane there are a base view plane and a dependent view plane. On the other hand with regard to the IG BD J plane and the PG plane there is neither a base view plane nor a dependent view plane. For this reason the IG BD J plane and the PG plane are the target of the shift control.

As shown in a PG plane and an IG plane are shifted to the left hand side thereof in the base view period. A transparent area is added to the left hand side of each of the PG plane and the IG plane having been shifted leftward and an end portion thereof on the right hand side thereof is cut off. Similarly a transparent area is added to the right hand side of each of the PG plane and the IG plane having been shifted rightward and an end portion thereof on the left hand side thereof is cut off.

As shown in a PG plane and an IG plane are shifted to the right hand side thereof in the base view period. A transparent area is added to the right hand side of each of the PG plane and the IG plane having been shifted rightward and an end portion thereof on the left hand side thereof is cut off. Similarly a transparent area is added to the left hand side of each of the PG plane and the IG plane having been shifted leftward and an end portion thereof on the right hand side thereof is cut off.

When the left view video is to be output in the 1 plane offset mode the coordinates of the image data stored in the plane memory called PG plane are shifted towards the positive direction of the X axis by the offset value. The plane memory is then cropped to prevent it from overlapping with the left view video plane and is provided to be overlaid with the other planes see .

When the right view video is to be output the coordinates of the image data stored in the plane memory are shifted towards the negative direction of the X axis by the offset value. The plane memory is then cropped to prevent it from overlapping with the left view video plane and is provided to be overlaid with the other planes see .

The third row shows the internal structure of the video access unit. As shown there the video access unit is structured as a sequence of an access unit delimiter a sequence parameter set a picture parameter set an MVC scalable nesting SEI message a first view component a sequence end code and a stream end code. The MVC scalable nesting SEI message includes a user data container.

The metadata should be stored in the MVC scalable nesting SEI message in the starting video component of each GOP in the encoding order of the dependent view access unit. A NAL unit including the MVC scalable nesting SEI message should not include data other than the user data container of the metadata.

In the frame rate frame rate field a frame rate of the access unit including the offset metadata is written.

In the offset sequence number number of offset sequence field the number of sequences is written in the range from 0 to 32 .

In the displayed frame number in number of displayed frames in GOP field the number of displayed frames in the GOP including the metadata is written.

The offset metadata further includes as many offset sequences offset sequence 1 through offset sequence number of sequence as the number indicated by the number of sequence . The offset sequences correspond to the respective GOPs in the video stream.

The plane offset direction information Plane offset direction indicates the direction of offset in the plane. When the plane offset direction information is set to a value 0 it indicates the front setting in which the plane memory exists between the TV and the viewer and in the left view period the plane is shifted rightward and in the right view period the plane is shifted leftward.

When the plane offset direction information is set to a value 1 it indicates the behind setting in which the plane memory exists behind the TV or the screen and in the left view period the plane is shifted leftward and in the right view period the plane is shifted rightward. When the plane offset direction information indicates the front setting the Z axis coordinate of the control parameter in the three dimensional coordinate system is a positive coordinate. When the plane offset direction information indicates the behind setting the Z axis coordinate of the control parameter in the three dimensional coordinate system is a negative coordinate.

The plane offset value plane offset value indicates the amount of deviation in the horizontal direction of the pixels constituting the graphics and indicates the offset value of the plane in units of pixels.

The for statement whose control variable is i defines as many pairs of Plane offset direction and Plane offset value as the number indicated by the number of displayed frames in GOP . With use of such for statements the above described offset sequences are defined.

This completes description of the method for causing the subtitle to appear in front of or behind the screen by switching between positive and negative plane offset values.

The offset sequence with the above described data structure makes it possible to define the depth of graphics for each frame in the video stream time axis. Thus the offset sequence can be used to define a function Z t that is used to calculate from an arbitrary frame time t a depth z that corresponds to the frame time t . When the function Z t linearly changes the depth at the frame time t the playback device can change the depth of the graphics linearly with the progress of playback by using an offset sequence corresponding to the function Z t in the 1 plane offset mode. When the function Z t exponentially changes the depth at the frame time t the playback device can change the depth of the graphics exponentially with the progress of playback by using an offset sequence corresponding to the function Z t in the 1 plane offset mode. In this way it is possible to change the depth in real time with the progress of the playback point in the video stream time axis resulting in the realization of a highly realistic graphics image in the stereoscopic playback.

Further since the metadata can store a plurality of offset sequences it is possible to define a plurality of depth functions Z Z Z Z . . . Zn t in each of which the depth changes differently over time by using a plurality of offset sequences . . . n. Here by using the offset sequences . . . n such that the depth function Z is a direct function that changes the depth in accordance with variable t the depth function Z is a quadratic function the depth function Z is a cubic function the depth function Z is a quartic function . . . and the depth function Zn t is an nfunction it is possible to define a plurality of depth functions which differ from each other in correlation between depth and frame period.

By allowing the playback device to select one among the offset sequences . . . n during the operation it is possible to select an optimum depth function among the depth functions Z Z Z Z . . . Zn t and use it in the 1 plane offset mode in response to a change in the state of the playback device or in response to a request from the user. With this structure the depth of the graphics can be changed variously in the 1 plane offset mode.

The plurality of offset sequences defined in the present embodiment respectively specify a plurality of display positions that differ from each other in the change of depth over time. Accordingly by selecting an appropriate offset sequence among the plurality of offset sequences it is possible to arrange the graphics at appropriate positions.

Up to now the first technical meaning of the offset sequence has been described. The following describes the second technical meaning of the offset sequence.

The second technical meaning of the offset sequence is to be able to define depths in correspondence with portions of a moving object in the screen. In the case of the dinosaur skeleton shown in it is obvious that the portions such as the head body legs and tail have different depths. Further in the video image depths of the portions such as the head body legs and tail would change over time. In view of this the metadata has the data structure for defining a plurality of offset sequences having control parameters for each frame of GOP where the control parameters indicate depths that are distances to positions immediately before the portions such as head body legs and tail.

The offset sequences with offset sequence id 1 and 2 specify appropriate depths so that a subtitle menu can be arranged between the user and the dinosaur. The offset sequences with offset sequence id 3 and 4 specify appropriate depths so that a subtitle menu can be arranged behind the dinosaur. Of these the offset sequence with offset sequence id 1 defines a depth so that the subtitle menu is arranged at a position closer to the user between the user and the dinosaur. The offset sequence with offset sequence id 2 defines a depth so that the subtitle menu is arranged at a position closer to the dinosaur between the user and the dinosaur. The offset sequence with offset sequence id 3 defines a depth so that the subtitle menu is arranged on a line along the legs of the dinosaur. The offset sequence with offset sequence id 4 defines a depth so that the subtitle menu is arranged at a position behind the dinosaur.

In this way the present invention can define the control parameters that indicate depths that are distances to positions immediately before the portions of the object such as head body legs and tail and can define the displacement over time of the control parameters. Therefore by using the data structure defined by the syntax shown in it is possible to realize a precise and highly accurate shift control in 1 plane offset mode.

Even when the dinosaur shown in the drawings moves around in the screen and an appropriate depth of the subtitle menu changes momentarily the subtitle menu can be arranged at an appropriate position relative to the dinosaur.

The index table file is management information of the entire recording medium. The index table file is the first file to be read by a playback device after the recording medium is loaded into the playback device so that the playback device is enabled to uniquely identify the disc.

The index table file shows correspondence between the operation mode objects which define the operation modes and a plurality of title numbers that can be stored in the title number register provided in the playback device. Titles recorded on the recording medium are pairs of i an operation mode object identified by a title number and ii a playlist played back from that operation mode object. Here one movie corresponds to one or more titles which can be one or more versions of the movie. That is to say when a movie has only one version the relationship between the movie and titles is represented as movie title . When a movie has a plurality of versions such as a theatrical version a director s cut version and a TV version each of these versions is provided as one title.

It should be noted here that title numbers that can be stored in the title number register include 0 1 through 999 and an undefined value 0xFFFF . A title number 0 is a title number of the top menu title. The top menu title is a title that can be called by a menu call operation performed by the user. The title number by the undefined value 0xFFFF is a title number of the first play title. The first play title is a title that displays a warning to the viewer a logo of the content provider and so on immediately after the recording medium is loaded.

The index table includes entries index table entries in one to one correspondence with title numbers. Each index table entry includes an operation mode object that defines an operation mode. With this structure the index table defines in detail how each title operates in a corresponding operation mode. The index table entries have the following data structure in common the data structure composed of object type movie object reference and object file information . The object type indicates whether the type of the operation mode object associated with the title corresponding to the entry is movie object or BD J object. The object file information indicates a file name of a BD J object associated with the title. The movie object reference indicates an identifier of a movie object associated with the title.

In the playback device the value of the title number register changes in the order of undefined value 0xFFFF any of 1 through 999 0 . This change in the title number stored in the title number register indicates the following. Upon a loading of the recording medium first the first play title is played back after the first play title titles having any of title numbers 1 through 999 are played back and after these title the top menu title is played back to wait for a selection by the user. A title having a title number currently stored in the title number register among the title numbers 1 through 999 is the current playback target namely the current title . How the numbers to be stored in the title number register are set is determined by the user operation made in response to the top menu title and by the setting of the title number register by the program.

The operation mode object program file stores operation mode objects which are programs that defined the operation modes of the playback device. The operation mode object is classified into one that is written as a command and one that is written in an object oriented compiler language. The former type of operation mode object supplies a plurality of navigation commands as a batch job to the playback device in the command based operation mode to operate the playback device based on the navigation commands. The command based operation mode is called HDMV mode .

The latter type of operation mode object supplies instances of class structure to the playback device in the operation mode based on the object oriented compiler language in order to operate the playback device based on the instances. Java applications can be used as the instances of class structure. The operation mode based on the object oriented compiler language is called BD J mode .

The playlist information file is a file storing information that is used to cause the playback device to play back a playlist. The playlist indicates a playback path defined by logically specifying a playback order of playback sections where the playback sections are defined on a time axis of transport streams TS . The playlist has a role of defining a sequence of scenes to be displayed in order by indicating which parts of which TSs among a plurality of TSs should be played back. The playlist information defines patterns of the playlists. The playback path defined by the playlist information is what is called multi path . The multi path is composed of a main path and one or more sub paths . The main path is defined for the main TS. The sub paths are defined for sub streams. A plurality of sub paths can be defined while one main path is defined. The plurality of sub paths are identified by identifiers called sub path IDs. Chapter positions are defined in the playback time axis of the multi path. It is possible to realize a random access by the playback device to an arbitrary time point in the time axis of the multi path by causing the playback device to refer to one of the chapter positions. In the BD J mode it is possible to start an AV playback by the multi path by instructing a Java virtual machine to generate a JMF Java Media Frame work player instance for playing back the playlist information. The JMF player instance is data that is actually generated in the heap memory of the virtual machine based on a JMF player class. In the HDMV mode it is possible to start an AV playback by the multi path by causing the playback device to execute a navigation command instructing to perform a playback according to the playlist. The playback device is provided with a playlist number register storing the number of the current playlist information. The playlist information being played back currently is one of a plurality of pieces of playlist information whose number is currently stored in the playlist number register.

The stream information files are clip information files that are provided in a one to one correspondence with the stream files. The stream information file indicates what ATC sequence is constituted form a sequence of source packets that exist in the stream file what STC sequence is incorporated in the ATC sequence and what TS is the ATC sequence.

The stream information file indicates the contents of the stream file. Therefore when a TS in the stream file is to be played back it is necessary to preliminarily read into the memory a stream information file that corresponds to the stream file. That is to say in the playback of a stream file the prestoring principle in which the stream information file is preliminarily read into the memory is adopted. The reason that the prestoring principle is adopted is as follows. The data structure of the TS stored in the stream file has a compatibility with the European digital broadcast standard. So the stream contains information such as PCR PMT and PAT that enable the stream to be treated as a broadcast program. However it is unwise to extract such information each time a playback is performed. This is because it is necessary each time a playback is performed to access a low speed recording medium to read packets constituting the TS and analyze the payloads of the TS packets. Therefore the stream information files are provided in a one to one correspondence with the stream files storing TSs and the stream information files are read into the memory before the stream is played back so that the information of the TSs can be grasped without analyzing the payloads of the TSs.

The stream file stores one or more sequences of source packets. The source packet is a TS packet that is attached with a 4 byte TP Extra Header. The TP Extra Header is composed of a 2 bit copy permission indicator and a 30 bit ATS Arrival Time Stamp . The ATS included in the TP Extra Header indicates an arrival time in a real time transfer in which the isochronicity is ensured.

Among such sequences of source packets a sequence of source packets whose time stamps are continuous in the Arrival Time Clock ATC time axis is called an ATC sequence . The ATC sequence is a sequence of source packets where Arrival Time Clocks referred to by the Arrival Time Stamps included in the ATC sequence do not include arrival time base discontinuity . In other words the ATC sequence is a sequence of source packets where Arrival Time Clocks referred to by the Arrival Time Stamps included in the ATC sequence are continuous. This is why each source packet constituting the ATC sequence is subjected to continuous source packet depacketizing processes and continuous packet filtering processes while the clock counter is counting the arrival time clocks of the playback device.

While the ATC sequence is a sequence of source packets a sequence of TS packets whose time stamps are continuous in the STC time axis is called an STC sequence . The STC sequence is a sequence of TS packets which do not include system time base discontinuity which is based on the STC System Time Clock that is a system standard time for TSs. The presence of the system time base discontinuity is indicated by a discontinuity indicator being ON where the discontinuity indicator is contained in a PCR packet carrying a PCR Program Clock Reference that is referred to by the decoder to obtain an STC. The STC sequence is a sequence of TS packets whose time stamps are continuous in the STC time axis. Therefore each TS packet constituting the STC sequence is subjected to continuous decoding processes performed by the decoder provided in the playback device while the clock counter is counting the system time clocks of the playback device.

Each of the main TS and the sub TSs in the stream file is managed as a piece of AV stream namely an AV clip by the clip information in the stream information file corresponding to the stream file.

Also the packet sequence stored in the stream file contains packet management information PCR PMT PAT defined in the European digital broadcast standard as information for managing and controlling a plurality of types of PES streams.

The PCR Program Clock Reference stores STC time information corresponding to an ATS that indicates the time when the PCR packet is transferred to a decoder in order to achieve synchronization between an ATC Arrival Time Clock that is a time axis of ATSs and an STC System Time Clock that is a time axis of PTSs and DTSs.

The PMT Program Map Table stores PIDs in the streams of video audio graphics and the like contained in the transport stream file and attribute information of the streams corresponding to the PIDs. The PMT also has various descriptors relating to the TS. The descriptors have information such as copy control information showing whether copying of the AV clip is permitted or not.

The PAT Program Association Table shows a PID of a PMT used in the TS and is registered by the PID arrangement of the PAT itself.

These PCR PMT and PAT in the European digital broadcast standard have a role of defining partial transport streams constituting one broadcast program one program . This enables the playback device to cause the decoder to decode TSs as if it deals with the partial TSs constituting one broadcast program conforming to the European digital broadcast standard. This structure is aimed to support compatibility between the recording medium playback devices and the terminal devices conforming to the European digital broadcast standard. Among the TSs a TS that is the base axis of the multi path is called main TS and a TS that is the base axis of the sub path is called sub TS .

As shown in the first row of each TS packet is a fixed length packet consisting of a 4 byte TS header carrying information such as a PID identifying the stream and a 184 byte TS payload storing data. The PES packets are divided and stored in the TS payloads.

As shown in the second row each TS packet is attached with a 4 byte TP Extra Header to be converted into a 192 byte source packet. Such 192 byte source packets constitute the TS. The TP Extra Header stores information such as an ATS Arrival Time Stamp . The ATS shows a transfer start time at which the TS packet is to be transferred to a PID filter. The source packets are arranged in the TS as shown in the third row. The numbers incrementing from the head of the TS are called SPNs source packet numbers .

The elementary streams ES to be multiplexed in these TSs include the video stream audio stream presentation graphics stream and interactive graphics stream.

The video stream specified as the base view stream constitutes a primary video stream in a picture in picture application. The picture in picture application is composed of the primary video stream and a secondary video stream. The primary video stream is a video stream composed of picture data of the picture in picture application that represents a parent picture in the screen and the secondary video stream is a video stream composed of picture data of the picture in picture application that represents a child picture that is fit in the parent picture.

The picture data constituting the primary video stream and the picture data constituting the secondary video stream are stored in different plane memories after being decoded. The plane memory that stores the picture data constituting the secondary video stream has in the first half thereof a structural element Scaling Positioning that performs changing scaling of the picture data constituting the secondary video stream and positioning display coordinates of the picture data constituting the secondary video stream.

The audio stream is classified into a primary audio stream and a secondary audio stream. The primary audio stream is an audio stream that is to be a main audio when the mixing playback is performed and the secondary audio stream is an audio stream that is to be a sub audio when the mixing playback is performed. The secondary audio stream includes information for downsampling for the mixing and information for the gain control.

The PG stream is a graphics stream that can be synchronized closely with the video with the adoption of the pipeline in the decoder and is suited for representing subtitles. The PG stream falls into two types a 2D PG stream and a stereoscopic PG stream. The stereoscopic PG stream further falls into two types a left view PG stream and a right view PG stream. One of the left view PG stream and the right view PG stream that is specified by the base view indicator becomes the base view PG stream and the other that is not specified by the base view indicator becomes the dependent view PG stream.

The reason that the stereoscopic PG stream is provided as well as the 2D PG stream is as follows. For example when the PG stream represents subtitle characters the subtitle characters from an anterior view to be displayed in the 2D mode and the subtitle characters for the left eye and the right eye to be displayed in the 3D LR mode should be different from each other. For this reason one graphics stream of an image from an anterior view is displayed in the 2D mode and two graphics streams left view PG stream and right view PG stream are displayed in the 3D LR mode. Similarly in the 3D depth mode an image from an anterior view and a grayscale stream indicating the depth information are played back. The 2D offset 2D compatible stream and the 3D LR stream should not be provided in mixture.

It is possible to define up to 32 2D PG streams up to 32 base view PG streams and up to 32 dependent view PG streams. These PG streams are attached with different packet identifiers. Thus it is possible to cause a desired PG stream among these PG streams to be subjected to the playback by specifying a packet identifier of the one to be played back to the demultiplexing unit.

The left view PG stream and the right view PG stream should have the same language attribute so that even if the user switches a display method a subtitle having the same contents is displayed. It is thus presumed that the 2D subtitles and the 3D subtitles correspond to each other on a one to one basis and that a 2D subtitle not having a corresponding 3D subtitle or a 3D subtitle not having a corresponding 2D subtitle should not be provided. This is to prevent the user from being confused when the display method is switched. With this structure streams that respectively correspond to the 2D and 3D display modes are selected when one stream number is specified. In such a case the one stream number should correspond to the same language attribute so that the contents of the subtitles for the 2D and LR are the same.

A close synchronization with video is achieved due to the decoding with the pipeline adopted therein. Thus the use of the PG stream is not limited to the playback of characters such as the subtitle characters. For example it is possible to display a mascot character of the movie that is moving in synchronization with the video. In this way any graphics playback that requires a close synchronization with the video can be adopted as a target of the playback by the PG stream.

The PG stream is a stream that is not multiplexed into the transport stream but represents a subtitle. The text subtitle stream also referred to as textST stream is a stream of this kind as well. The textST stream is a stream that represents the contents of subtitle by the character codes.

The PG stream and the text subtitle stream are registered as the same stream type in the same stream registration sequence without distinction between them in type. And then during execution of a procedure for selecting a stream a PG stream or a text subtitle stream to be played back is determined according to the order of streams registered in the stream registration sequence. In this way the PG streams and text subtitle streams are subjected to the stream selection procedure without distinction between them in type. Therefore they are treated as belonging to a same stream type called PG text subtitle stream .

The PG text subtitle stream for 2D is played back in the 1 plane offset mode. Hereinafter the 2D PG text subtitle stream is referred to as a 1 plane offset PG text subtitle stream.

The IG stream is a graphics stream which having information for interactive operation can display menus with the progress of playback of the video stream and display pop up menus in accordance with user operations.

As is the case with the PG stream the IG stream is classified into a 2D IG stream and a stereoscopic IG stream. The stereoscopic IG stream is classified into a left view IG stream and a right view IG stream. One of the left view IG stream and the right view IG stream that is specified by the base view indicator becomes the base view IG stream and the other that is not specified by the base view indicator becomes the dependent view IG stream. It is possible to define up to 32 2D IG streams up to 32 base view IG streams and up to 32 dependent view IG streams. These IG streams are attached with different packet identifiers. Thus it is possible to cause a desired IG stream among these IG streams to be subjected to the playback by specifying a packet identifier of the one to be played back to the demultiplexing unit.

The IG stream control information called interactive control segment includes information user interface model that defines the user interface model. The person in charge of authoring can specify either always on or pop up menu on by setting the user interface model information where with the always on menus are displayed with the progress of playback of the video stream and with the pop up menu on the pop up menus are displayed in accordance with user operations.

The interactive operation information in the IG stream has the following meaning. When the Java virtual machine instructs the playback control engine which is proactive in the playback control to start playing back a playlist in accordance with a request from an application the Java virtual machine after instructing the playback control engine to start the playback returns a response to the application to notify that the playback of the playlist has started. That is to say while the playback of the playlist by the playback control engine continues the Java virtual machine does not enter the state waiting for end of execution. This is because the Java virtual machine is what is called an event driven type performer and can perform operation while the playback control engine is playing back the playlist.

On the other hand when in the HDMV mode the command interpreter instructs the playback control engine to play back a playlist it enters the wait state until the execution of playback of the playlist ends. Accordingly the command execution unit cannot execute an interactive process while the playback of the playlist by the playback control engine continues. The graphics decoder performs an interactive operation in place of the command interpreter. Thus to cause the graphics decoder to perform the interactive operation the IG stream is embedded with control information defining interactive operations for which buttons are used.

Different 3D display modes are allowed for each stream type. In the primary video stream 3D display mode two playback modes namely the B D presentation mode and the B B presentation mode are allowed. The B B presentation mode is allowed for the primary video stream only when the pop up menu is on. The type of primary video stream when the playback is performed in the B D presentation mode is called stereoscopic B D playback type . The type of primary video stream when the playback is performed in the B B presentation mode is called stereoscopic B B playback type .

In the PG stream 3D display mode three playback modes namely the B D presentation mode 1 plane offset mode and 1 plane zero offset mode are allowed. The 1 plane zero offset mode is allowed for the PG stream only when the pop up menu is on. The type of PG stream when the playback is performed in the B D presentation mode is called stereoscopic playback type . The type of PG stream and PG text subtitle stream when the playback is performed in the 1 plane offset mode is called 1 plane offset type . The type of PG stream and PG text subtitle stream when the playback is performed in the 1 plane zero offset mode is called 1 plane zero offset type .

In the text subtitle stream 3D display mode two playback modes namely the 1 plane offset mode and 1 plane zero offset mode are allowed. The 1 plane zero offset mode is allowed for the text subtitle stream only when the pop up menu is on.

In the IG stream 3D display mode three playback modes namely the B D presentation mode 1 plane offset mode and 1 plane zero offset mode are allowed. The 1 plane zero offset mode is allowed for the IG stream only when the pop up menu is on. It is supposed in the following description except where otherwise mentioned that the picture in picture cannot be used during playback in the 3D playback mode. This is because each of the picture in picture and the 3D playback mode requires two video planes for storing non compressed picture data. It is also supposed in the following description except where otherwise mentioned that the sound mixing cannot be used in the 3D playback mode.

Next the internal structures of the main TS and sub TS will be described. show the internal structures of the main TS and sub TS.

A source packet having packet ID 0x0100 constitutes a program map table PMT . A source packet having packet ID 0x0101 constitutes a PCR.

By specifying a packet identifiers of one of these source packets to the demultiplexing unit it is possible to cause a desired elementary stream among a plurality of elementary streams multiplexed in the main transport streams to be demultiplexed and subjected to the decoder.

Source packet sequences having packet IDs 0x1240 through 0x125F constitute 32 dependent view PG streams.

Source packet sequences having packet IDs 0x1220 through 0x145F constitute 32 dependent view IG streams.

This completes the description of the stream file. Next is a detailed explanation of the playlist information.

To define the above described multi path the internal structures shown in are provided. shows the internal structure of the playlist information. As shown in the playlist information includes main path information sub path information playlist mark information and extension data. These constitutional elements will be described in the following.

1 The main path information is composed of one or more pieces of main playback section information. shows the internal structures of the main path information and the sub path information. As shown in the main path information is composed of one or more pieces of main playback section information and the sub path information is composed of one or more pieces of sub playback section information.

The main playback section information called playitem information is information that defines one or more logical playback sections by defining one or more pairs of an in time time point and an out time time point on the TS playback time axis. The playback device is provided with a playitem number register storing the playitem number of the current playitem. The playitem being played back currently is one of the plurality of playitems whose playitem number is currently stored in the playitem number register.

The stream reference information includes clip Information file name information clip Information file name that indicates the file name of the clip information file that manages as AV clips the transport streams constituting the playitem clip encoding method identifier clip codec identifier that indicates the encoding method of the transport stream and STC identifier reference STC ID reference that indicates STC sequences in which in time and out time are set among the STC sequences of the transport stream.

The playitem as a playback section has a hierarchical structure composed of playitem information clip information and AV clip. It is possible to set a one to many relationship between i a pair of AV clip and clip information and ii playitem information so that one AV clip can be referenced by a plurality of pieces of playitem information. This makes it possible to adopt as a bank film an AV clip created for a title so that the bank film can be referenced by a plurality of pieces of playitem information making it possible to create a plurality of variations of a movie effectively. Note that the bank film is a term used in the movie industry and means an image that is used in a plurality of scenes.

When an AV clip as a bank film can be referenced by a plurality of pieces of playitem information it may be requested to realize that a different section of the bank film can be played back depending on the piece of playitem information referencing the bank film. To satisfy the request namely to enable a different section of the bank film to be played back depending on the piece of playitem information referencing the bank film the playitem information is provided with In Time and Out Time as described above so that arbitrary time points on the stream playback time axis can be used as a start point and an end point of the playback section.

Also when an AV clip as a bank film can be referenced by a plurality of pieces of playitem information it may be requested to realize that a different audio subtitle or menu can be used depending on the piece of playitem information referencing the bank film. To satisfy the request namely to enable a different audio subtitle or menu to be used depending on the piece of playitem information referencing the bank film the playitem information is provided with the stream selection table as described above. With use of the stream selection table it is possible to permit a playback of an elementary stream that is most suitable for the user of the bank film among the elementary streams multiplexed in the AV clip referenced by the playitem information being the main path and among the elementary streams multiplexed in the AV clip referenced by the sub playitem information being the sub main path.

2 The sub playback section information called sub path information is composed of a plurality of pieces of sub playitem information. shows the internal structure of the sub playitem information. As shown in the sub playitem information is information that defines playback sections by defining pairs of an in time and an out time on the STC sequence time axis and includes stream reference information in time out time information sync playitem reference and sync start time information.

The stream reference information as in the playitem information includes clip Information file name information clip encoding method identifier and STC identifier reference .

The in time out time information SubPlayItem In Time SubPlayItem Out Time indicates the start point and end point of the sub playitem on the STC sequence time axis.

The sync playitem reference Sync Playitem Id is information that uniquely indicates a playitem with which the sub playitem is to be synchronized. The sub playitem In Time exists on playback time axis of the playitem specified by this sync playitem identifier.

The sync start time information Sync Start PTS of Playitem indicates a time point on the STC sequence time axis of the playitem specified by the sync playitem identifier that corresponds to the start point of the sub playitem specified by the sub playitem In Time.

3 The playlist mark information is information that defines the mark point unique to the playback section. The playlist mark information includes an indicator indicating a playback section a time stamp indicating the position of a mark point on the time axis of the digital stream and attribute information indicating the attribute of the mark point.

The attribute information indicates whether the mark point defined by the playlist mark information is a link point or an entry mark.

The link point is a mark point that can be linked by the link command but cannot be selected when the chapter skip operation is instructed by the user.

The entry mark is a mark point that can be linked by the link command and can be selected even if the chapter skip operation is instructed by the user.

The link command embedded in the button information of the IG stream specifies a position for a random access playback in the form of an indirect reference via the playlist mark information.

The basic stream selection table shows a list of elementary streams that are to be played back in a monoscopic playback mode and the table when a playitem containing the basic stream selection table itself becomes the current playitem among a plurality of playitems constituting the playlist specifies for each of the plurality of stream types an ES which is permitted to be played back among ESs multiplexed in AV clips referenced by the main path and the sub path of the multi path. Here the stream types include the primary video stream in the picture in picture the secondary video stream in the picture in picture the primary audio stream in the sound mixing the secondary audio stream in the sound mixing the PG text subtitle stream and the interactive graphics stream. It is possible to register an ES which is permitted to be played back for each of these stream types. More specifically the basic stream selection table is composed of sequences of stream registrations. Here the stream registration is information that when a playitem containing the basic stream selection table itself becomes the current playitem indicates what kind of stream is the ES permitted to be played back. Each stream registration is associated with the stream number of the stream. Each stream registration has a data structure in which a pair of a stream entry and a stream attribute is associated with a logical stream number.

The stream number in the stream registration is represented by an integer such as 1 2 or 3 . The largest stream number for a stream type is identical with the number of streams for the stream type.

The playback device is provided with a stream number register for each stream type and the current stream namely the ES being played back currently is indicated by the stream number stored in the stream number register.

A packet identifier of the ES to be played back is written in the stream entry. By making use of this structure in which a packet identifier of the ES to be played back can be written in the stream entry the stream numbers included in the stream registrations are stored in the stream number registers of the playback device and the playback device causes the PID filter thereof to perform a packet filtering based on the packet identifiers stored in the stream entries of the stream registrations. With this structure TS packets of the ESs that are permitted to be played back according to the basic stream selection table are output to the decoder so that the ESs are played back.

In the basic stream selection table the stream registrations are arranged in an order of stream numbers. When there are a plurality of streams that satisfy the conditions playable by playback device and the language attribute of the stream matches the language setting in the device a stream corresponding to the highest stream number in the stream registration sequences is selected.

With this structure when there is found a stream that cannot be played back by the playback device among the stream registrations in the basic stream selection table the stream is excluded from the playback. Also when there are a plurality of streams that satisfy the conditions playable by playback device and the language attribute of the stream matches the language setting in the device the person in charge of authoring can convey the playback device how to select one with priority from among the plurality of streams.

It is judged whether there is a stream that satisfies the conditions playable by playback device and the language attribute of the stream matches the language setting in the device . Also a stream is selected from among a plurality of streams that satisfy the conditions. The procedure for the judgment and selection is called a stream selection procedure . The stream selection procedure is executed when the current playitem is switched or when a request to switch the stream is input by the user.

A sequential procedure for performing the above described judgment and selection and setting a stream number in the stream number register of the playback device when a state change occurs in the playback device such as when the current playitem is switched is called procedure to be executed at state change . Since the stream number registers are provided respectively in correspondence with the stream types the above described procedure is executed for each stream type.

A sequential procedure for performing the above described judgment and selection and setting a stream number in the stream number register of the playback device when a request to switch the stream is input by the user is called procedure at state change request .

A procedure for setting the stream number registers to the initial values of the stream registration sequences when a BD ROM is loaded is called initialization .

Priorities are assigned evenly to the streams specified in the sub playitem information and the streams specified in the playitem information as indicated by the stream registration sequences in the basic stream selection table. As a result even a stream not multiplexed with a video stream is targeted for selection as a stream to be played back in sync with the video stream if the stream is specified by the sub playitem information.

Furthermore when playback device can play back a stream specified by the sub playitem information and when the priority of the stream specified by the sub playitem information is higher than the priority of the graphics stream multiplexed with the video stream the stream specified by the sub playitem information is played back in place of the stream multiplexed with the video stream.

When the playlist constitutes a picture in picture application picture in picture metadata needs to be stored in a data block of extension data in the playlist file. When the playlist information refers to the MVC video stream an extended stream selection table needs to be stored in a data block of extension data in the playlist information file.

When the playlist information refers to the MVC video stream on the disc or the MVC video stream in the stereoscopic IG stream playback menu extension information of the sub path information sub path block extension needs to be stored in a data block of extension data in the playlist information file.

When a 2D playback device finds unknown extension data in the playlist file the 2D playback device should disregard the extension data.

The extension stream selection table shows a list of elementary streams that are to be played back in a stereoscopic playback mode and is used together with the basic stream selection table only in the stereoscopic playback mode. The extension stream selection table defines the elementary streams that can be selected when a playitem is played back or when a sub path related to the playitem is played back.

The extension stream selection table indicates the elementary streams that are permitted to be played back only in the stereoscopic playback mode and includes stream registration sequences. Each piece of stream registration information in the stream registration sequences includes a stream number and a stream entry and a stream attribute corresponding to the stream number. The extension stream selection table means an extension that is unique to the stereoscopic playback mode. Therefore a playlist for which each piece of playitem information is associated with the extension stream selection table STN table SS is called 3D playlist .

Each stream entry in the extension stream selection table indicates a packet identifier that is to be used in the demultiplexing by the playback device when the playback device is in the stereoscopic playback mode and the corresponding stream number is set in the stream number register of the playback device. A difference from the basic stream selection table is that the stream registration sequences in the extension stream selection table are not targeted by the stream selection procedure. That is to say the stream registration information in the stream registration sequences of the basic stream selection table is interpreted as the priorities of the elementary streams and a stream number in any piece of stream registration information is written into the stream number register. In contrast the stream registration sequences of the extension stream selection table are not targeted by the stream selection procedure and the stream registration information of the extension stream selection table is used only for the purpose of extracting a stream entry and a stream attribute that correspond to a certain stream number when the certain stream number is stored in the stream number register.

Suppose that when the playback mode switches from the 2D playback mode to the 3D playback mode the target stream selection table also switches from the basic stream selection table to the extension stream selection table. Then the identity of the stream numbers may not be maintained and the identity of the language attribute may be lost as well.

Accordingly the use of the extension stream selection table is restricted to above described one to maintain the identity of the stream attribute such as the language attribute.

The extension stream selection table is composed of stream registration sequences of the dependent view streams stream registration sequences of the PG streams and stream registration sequences of the IG streams.

The stream registration sequences in the extension stream selection table are combined with the stream registration sequences of the same stream types in the basic stream selection table. More specifically the dependent view video stream registration sequences in the extension stream selection table are combined with the primary video stream registration sequences in the basic stream selection table the PG stream registration sequences in the extension stream selection table are combined with the PG stream registration sequences in the basic stream selection table and the IG stream registration sequences in the extension stream selection table are combined with the IG stream registration sequences in the basic stream selection table.

After this combination the above described procedure is executed onto the stream registration sequences in the basic stream selection table among the two tables after the combination.

The extension stream selection table is composed of length which indicates the entire length of the extension stream selection table fixed offset during pop up Fixed offset during Popup and the stream registration sequences of each stream type corresponding to each playitem.

When there are N pieces of playitems identified as playitems N stream registration sequences respectively corresponding to the playitems N are provided in the extension stream selection table. The stream registration sequences corresponding to each playitem are dependent view stream registration sequence PG stream registration sequence and IG stream registration sequence.

The Fixed offset during Popup is a fixed offset during pop up and controls the playback type of the video or PG text subtitle stream when the pop up menu is set to on in the IG stream. The Fixed offset during Popup field is set to on when the user interface model field in the IG stream is on namely when the user interface of the pop up menu is set to on . Also the Fixed offset during Popup field is set to off when the user interface model field in the IG stream is off namely when the AlwaysON user interface is set.

When the fixed offset during pop up is set to 0 namely when the pop up menu is set to off in the user interface of the IG stream the video stream is in the B D presentation mode the stereoscopic PG stream becomes the stereoscopic playback type and during playback in the 1 plane offset mode the PG text subtitle stream is in the 1 plane offset mode.

When the fixed offset during pop up is set to 1 namely when the pop up menu is set to on in the IG stream the video stream is in the B B presentation mode the stereoscopic PG stream is in the 1 plane offset mode and the PG stream for 1 plane offset is played back as the 1 plane zero offset playback type.

The offset sequence number information number of offset sequence in the drawing indicates the number of offset sequences in the dependent view stream.

The value of the offset sequence number information in the extension stream selection table is identical with the number of offset sequences that is included in the dependent view stream.

The stream entry includes a sub path identifier reference ref to Subpath id specifying a sub path to which the playback path of the dependent view video stream belongs a stream file reference ref to subClip entry id specifying a stream file in which the dependent view video stream is stored and a packet identifier ref to stream PID subclip of the dependent view video stream in this stream file.

The number of offset sequence indicates the number of offsets provided in the dependent view video stream.

The dependent view video stream registration sequences shown in indicate that a plurality of pieces of stream registration information are provided in correspondence with a plurality of dependent view video streams. However merely illustrates the data structure thereof. In the actuality since there is only one base view video stream normally the number of pieces of stream registration information for the dependent view video stream is one.

The lead lines in the drawing indicates the close up of the common internal structure of the PG stream registration sequences.

The PGtextST offset sequence id ref is PG text subtitle stream offset sequence reference information and indicates an offset sequence with respect to the PG text subtitle stream in the 1 plane offset mode.

The offset metadata is supplied by the access unit of the dependent view video stream. The playback device should apply the offset which is supplied by this field to the presentation graphics PG plane of the 1 plane offset mode type.

When the field is an undefined value FF the playback device does not apply this offset to the PG stream plane memory.

The is SS PG is a stereoscopic presentation graphics presence absence flag that indicates the validity and presence of the stream entry of the base view IG and the stream entry and stream attribute of the dependent view IG in the PG stream. When the structure is absent in the stereoscopic PG stream this field should be set to 0 and when the structure is present in the stereoscopic PG stream this field should be set to 1 .

The stream entry for base view includes a sub path identifier reference ref to Subpath id specifying a sub path to which the playback path of the base view PG stream belongs a stream file reference ref to subClip entry id specifying a stream file in which the base view PG stream is stored and a packet identifier ref to stream PID subclip of the base view PG stream in this stream file.

The stream entry for dependent view includes a sub path identifier reference ref to Subpath id specifying a sub path to which the playback path of the dependent view PG stream belongs a stream file reference ref to subClip entry id specifying a stream file in which the dependent view PG stream is stored and a packet identifier ref to stream PID subclip of the dependent view PG stream in this stream file. When the stream file referenced by the stream entry for dependent view in the stream registration information in the extension stream selection table is different from the stream file referenced by the stream entry in the basic stream selection table a stream file storing the dependent view PG stream needs to be read.

The stream attribute includes language attributes of the base view PG stream and the dependent view PG stream.

The SS PG textST offset sequence id ref is reference information for referencing an offset sequence for the PG text subtitle stream and indicates the offset sequence for the PG text subtitle stream. The playback device should apply the offset which is supplied by this field to the PG plane.

When the field is an undefined value FF the playback device does not apply this offset to the PG stream plane memory.

The IG offset sequence id ref is an interactive graphics offset sequence reference and is a reference to the sequence ID of the IG stream in the 1 plane offset mode. This value indicates an offset sequence ID defined for the offset sequence. As described above the offset metadata is supplied by the dependent view video stream. The playback device should apply the offset which is supplied by this field to the IG stream of the 1 plane offset mode type.

When the field is an undefined value FF the playback device does not apply this offset to the interactive graphics IG stream plane.

The IG Plane offset direction during BB video is the user interface of the pop up menu in the B B presentation mode and indicates the offset direction in the IG plane in the 1 plane offset mode while the IG stream is played back.

When this field is set to 0 it is the front setting. That is to say the plane memory exists between the television and the viewer and the plane is shifted rightward during the left view period and the plane is shifted leftward during the right view period.

When this field is set to 1 it is the behind setting. That is to say the plane memory exists behind the television or the screen and the left plane is shifted rightward and the right plane is shifted leftward.

The IG Plane offset value during BB video indicates in units of pixels the offset value of the IG plane in the 1 plane offset mode while the IG stream is played back by the user interface of the pop up menu in the B B presentation mode.

The is SS PG is a stereoscopic interactive graphics presence absence flag that indicates the validity and presence of the stream entry of the base view IG and the stream entry and stream attribute of the dependent view IG in the IG stream. When the data structure of the stereoscopic IG stream is absent this field should be set to 0 and when the IG stream that is permitted to be played back is a stereoscopic IG stream this field should be set to 1 .

The stream entry for base view includes a sub path identifier reference ref to Subpath id specifying a sub path to which the playback path of the base view IG stream belongs a stream file reference ref to subClip entry id specifying a stream file in which the base view IG stream is stored and a packet identifier ref to stream PID subclip of the base view IG stream in this stream file.

The stream entry for dependent view includes a sub path identifier reference ref to Subpath id specifying a sub path to which the playback path of the dependent view IG stream belongs a stream file reference ref to subClip entry id specifying a stream file in which the dependent view IG stream is stored and a packet identifier ref to stream PID subclip of the dependent view IG stream in this stream file. When the stream file referenced by the stream entry for dependent view in the stream registration information in the extension stream selection table is different from the stream file referenced by the stream entry in the basic stream selection table a stream file storing the dependent view IG stream needs to be read.

The stream attribute includes language attributes of the base view IG stream and the dependent view IG stream.

The SS IG offset sequence id ref is a reference to the offset sequence ID for the stereoscopic type IG stream and indicates the offset sequence for the offset metadata of the dependent view video stream. The playback device should apply the offset which is supplied by this field to the stereoscopic type IG plane.

When the field is an undefined value FF the playback device does not apply this offset to the IG plane.

The PG text subtitle stream offset sequence reference information and the IG stream offset sequence reference information are written in the stream registration information in correspondence with stream numbers. Therefore when the stream selection procedure is executed due to a change of the device state or occurrence of a request for stream change and a stream number corresponding to the language setting on the device side is set in the stream number register an offset sequence indicated by a reference corresponding to the new stream number is supplied from the video decoder to the shift unit. With this structure an optimum offset sequence corresponding to the language setting in the playback device is supplied to the shift unit thus it is possible to set the depth of the graphics in 1 plane offset mode to an optimum value corresponding to the language setting in the playback device.

When the type of the stream entry in the stereoscopic dependent view block is the ES type stream type 2 that is used by the sub path the sub path ID reference and the subclip entry ID reference ref to subclip entry id do not change in the playlist.

Only two types of elementary streams are permitted to be the types of the stream entry stream entry for the base view and stream entry for the dependent view. The two types are ES stream type 1 in the AV clip used by the playitem and ES stream type 2 in the AV clip used by the sub path.

In the stereoscopic dependent view block the stream encoding method in the stream attribute is set to 0x20 .

The middle part of shows the demultiplexing unit. The upper part of shows the combination of the basic stream selection table and the extension stream selection table. The left hand side of shows the main TS and the sub TSs and the right hand side of shows the demultiplexed base view video stream dependent view video stream base view PG stream dependent view PG stream base view IG stream dependent view IG stream and primary audio stream.

The portion next to the left hand side of the basic stream selection table shows the stream number registers storing stream numbers of the current streams in the playback device. The portion next to the right hand side of the basic stream selection table shows the language settings in the playback device. The portion under the basic stream selection table shows the demultiplexing unit. The arrow h schematically indicates that the language setting for the PG stream matches the language attribute in the stream registration information X of the PG stream in the basic stream selection table. The arrow h schematically indicates setting of the stream number X into the stream number register of the PG stream.

The arrow h schematically indicates that the language setting for the IG stream matches the language attribute in the stream registration information Y of the IG stream in the basic stream selection table. The arrow h schematically indicates setting of the stream number Y into the stream number register of the IG stream.

The setting of the stream number shown in symbolically indicates that the PG streams and IG streams to be subjected to the demultiplexing are determined depending on the results of the stream selection procedure performed onto the basic stream selection table.

The arrow PD schematically indicates an output of the packet identifier written in the stream entry in the SS dependent view block in the extension stream selection table. This output enables the demultiplexing unit to perform the demultiplexing and the dependent view stream is output.

The arrow PD schematically indicates an output of the packet identifier corresponding to the stream number X among the stream entries of the stream registration information of the PG stream in the in the extension stream selection table. The arrow X indicates that the output of the packet identifier indicated by the arrow PD is linked with the setting of the current stream number X into the stream number register.

The arrow PD schematically indicates an output of the packet identifier corresponding to the stream number Y among the stream entries of the stream registration information of the IG stream in the in the extension stream selection table. The arrow Y indicates that the output of the packet identifier indicated by the arrow PD is linked with the setting of the current stream number Y into the stream number register.

It should be noted here that being linked in the above description means that the output of the packet identifier written in the extension stream selection table is linked with the fact that the stream number X or Y among the stream numbers written in the stream registration sequences of the PG or IG stream in the basic stream selection table is set in the stream number register as the PG or IG stream number of the current stream.

This output enables the demultiplexing unit to perform the demultiplexing and the PG or IG stream is output.

The vertical column on the left hand side of shows the stream numbers video stream audio stream audio stream PG stream PG stream IG stream and IG stream .

The element streams arranged on the left hand side of enclosed by a dotted line are element streams that are targeted for demultiplexing only in the 2D playback mode.

The element streams arranged on the right hand side of enclosed by a dotted line are element streams that are targeted for demultiplexing only in the 3D playback mode.

The element streams enclosed by the combined dotted lines of the left hand side and the right hand side are element streams that are targeted for demultiplexing in both the 2D and the 3D playback modes.

In the video stream is enclosed by the combined dotted lines of the left hand side and the right hand side. This indicates that the video stream is targeted for demultiplexing in both the 2D and the 3D playback modes. It should be noted here that the left view video stream thereof for the 3D mode is also used as the 2D video stream and the right view video stream is played back only in the 3D mode which is suggested by the fact that it is enclosed by only the dotted line on the right hand side of .

The audio streams and are both enclosed by the combined dotted lines of the left hand side and the right hand side. This indicates that the audio streams and are targeted for the playback in both the 2D and the 3D playback modes.

With regard to the PG streams and the 2D PG stream is enclosed only by the dotted line of the left hand side and the base view PG stream and the dependent view PG stream are enclosed only by the dotted line of the right hand side. This indicates that the 2D PG stream is targeted for the playback only in the 2D playback mode and the base view PG stream and the dependent view PG stream are targeted for the playback only in the 3D playback mode. This also applies to the IG streams.

As understood from the above description regarding the stream type video stream the dependent view video stream is added as a target of playback in the 3D playback mode.

It is also understood that as the mode changes from the 2D playback mode to the 3D playback mode the playback target changes from the 2D PG stream to the base view PG stream and the dependent view PG stream.

The extension stream selection table can be created by writing a description in an object oriented compiler language as shown in and subjecting the description to the compiler. shows a syntax for writing the extension stream selection table in an object oriented compiler language.

The for statement whose control variable is PlayItem id forms a loop in which description of the dependent view stream registration sequence the PG text subtitle stream registration sequence and the IG stream registration sequence is repeated as many times as the number of playitems.

The for statement whose control variable is primary video stream id defines the dependent view stream registration sequence and the dependent view stream registration sequence is defined by writing SS dependent view block that is composed of stream entry stream attribute and number of offset sequence as many times as the number indicated by Number of primary video stream entries .

The for statement whose control variable is PG textST stream id defines the PG text subtitle stream registration sequence and forms a loop in which description of PG text offset sequence id ref and is SS PG is repeated as many times as the number indicated by number of PG textST stream number entries . The if statement included in this loop whose control variable is is SS PG defines stream entry for base biew stream entry for dependent view and stream attribute when the is SS PG is . With this if statement the stream entry for base biew stream entry for dependent view and stream attribute are added to the stream registration sequences only when the is SS PG is . The stream entry for base biew stream entry for dependent view and stream attribute are not added to the stream registration sequences when the is SS PG is 

The for statement whose control variable is IG stream id defines the IG stream registration sequence and forms a loop in which description of IG offset sequence id ref IG plane offset direction during BB video IG plane offset value during BB video and is SS IG is repeated as many times as the number indicated by number of IG stream entries . The if statement included in this loop whose control variable is is SS IG defines stream entry for base biew stream entry for dependent view and stream attribute when the is SS IG is . With this if statement the stream entry for base biew stream entry for dependent view and stream attribute are added to the stream registration sequences only when the is SS IG is . The stream entry for base biew stream entry for dependent view and stream attribute are not added to the stream registration sequences when the is SS IG is 

This completes the description of the recording medium. In the following the playback device will be described in detail.

The reading unit reads out from the recording medium the index table program file of the operation mode object playlist information file stream information file and stream file.

The memory stores a combined stream registration sequence that is obtained by combining the basic stream selection table and the extension stream selection table.

The player number register includes a video stream number register for storing the stream number of the video stream a PG stream number register for storing the stream number of the PG stream an IG stream number register for storing the stream number of the IG stream and an audio stream number register for storing the stream number of the audio stream.

The decoder for each stream type is composed of a video decoder a PG decoder and IG decoder and an audio decoder.

The demultiplexing unit is provided with a PID filter for performing the packet filtering and demultiplexes among the TS packets in a plurality of source packets read from the recording medium a TS packet that is identified by the packet identifier recited in the combined stream registration sequence.

These plane memories constitute a layer model and the data stored in each plane memory is supplied for overlaying of the layers.

The transmission reception unit transits to a data transfer phase via a mutual authentication phase and a negotiation phase when playback device is connected with another device in the home theater system via an interface. The transmission reception unit performs data transfer in the transfer phase.

In the negotiation phase the capabilities of the partner device including the decode capability playback capability and display frequency are grasped and the capabilities are set in the player setting register so that the transfer method for the succeeding data transfers is determined. After the mutual authentication phase and the negotiation phase one line of the pixel data in the non compression plaintext format in the picture data after the layer overlaying is transferred to the display device at a high transfer rate in accordance with the horizontal sync period of the display device. On the other hand in the horizontal and vertical blanking intervals audio data in the non compression plaintext format is transferred to other devices including an amplifier and a speaker as well as the display device connected with the playback device. With this structure the devices such as the display device amplifier and speaker can receive the picture data and audio data both in the non compression plaintext format and a reproduced output is achieved. Further when the partner device has the decode capability a pass through transfer of the video and audio streams is possible. In the pass through transfer it is possible to transfer the video stream and audio stream in the compressed encrypted format as they are.

The playback control unit controls the reading unit to read the index table operation mode object playlist information clip information and stream file from the recording medium and performs a playback control based on the playlist information and clip information read from the recording medium. In reading the stream file a random access can be performed to read a source packet corresponding to an arbitrary time point in a time axis from the stream file.

The configuration memory is a nonvolatile memory storing the mode capabilities of the plane memories and the current mode. The contents to be stored in the configuration memory are set by the producer of the playback device. The mode capability indicates whether or not each of a plurality of plane memories such as the video plane PG plane and IG plane can perform a corresponding playback mode as described above. Whether a plane memory can perform a playback mode is determined based on the stream type corresponding to the plane memory and based on whether or not the hardware structure for performing the playback mode is provided in the playback device.

The current mode indicates what among the plurality of playback modes the plurality of plane memories are set to respectively.

This completes the explanation of the playback device. Next the demultiplexing process performed by the playback device of the present embodiment will be described in detail.

The three pieces of stream registration information provided in the extension stream selection table have stream numbers 1 2 and 3 respectively and the stream attributes in the three pieces of stream registration information have English Japanese and Chinese as the language attributes respectively. The stream registration information provided in the basic stream selection table differs in the packet identifier stored in the stream entry from the stream registration information provided in the extension stream selection table. Also the stream registration information provided in the extension stream selection table contains i a packet identifier for a base view PG stream for the B D presentation mode and ii a packet identifier for a dependent view PG stream.

The arrows identified by a a and a schematically indicate i the judgment on whether language settings match each other ii the setting of a stream number in the stream number register and iii the output of a packet identifier to the demultiplexing unit respectively.

In the operation procedure of this example it is judged whether the language setting of the playback device matches the stream attribute contained in the stream registration information whose stream number is 3 and it is judged that they match. As a result of this the stream number 3 of this stream registration information is written into the stream number register. Also the packet identifier written in the stream entry of the basic stream selection table is output to the demultiplexing unit. Following this a TS packet identified by the packet identifier written in the stream entry of the stream registration information whose stream number is 3 in the basic stream selection table is output to the decoder.

The arrows identified by a a and a schematically indicate i the judgment on whether language settings match each other ii the setting of a stream number in the stream number register and iii the output of a packet identifier to the demultiplexing unit respectively.

In the operation procedure of this example it is judged whether the language setting of the playback device matches the stream attribute contained in the stream registration information whose stream number is 3 and it is judged that they match. As a result of this the stream number 3 of this stream registration information is written into the stream number register. Also the packet identifier written in the stream entry of the basic stream selection table is output to the demultiplexing unit. Following this a pair of TS packets identified by a pair of packet identifiers written in the stream entry of the stream registration information whose stream number is 3 in the extension stream selection table are output to the decoder.

The three pieces of stream registration information provided in the extension stream selection table have stream numbers 1 2 and 3 respectively and all of the stream attributes in the three pieces of stream registration information have Chinese as the language attributes. The stream registration information provided in the basic stream selection table differs in the packet identifier stored in the stream entry from the stream registration information provided in the extension stream selection table. Also the stream registration information provided in the extension stream selection table contains i a packet identifier for a base view PG stream for the B D presentation mode and ii a packet identifier for a dependent view PG stream.

The arrows identified by a a and a schematically indicate i the judgment on whether language settings match each other ii the setting of a stream number and iii the output of a packet identifier to the demultiplexing unit respectively.

In the operation procedure of this example it is judged whether the language setting of the playback device matches the stream attribute contained in the stream registration information whose stream number is 1 and it is judged that they match. As a result of this the stream number 1 of this stream registration information is written into the stream number register. Also the packet identifier written in the stream entry of the basic stream selection table is output to the demultiplexing unit. Following this a TS packet identified by the packet identifier written in the stream entry of the stream registration information whose stream number is 1 in the basic stream selection table is output to the decoder.

The arrows identified by a a and a schematically indicate i the judgment on whether language settings match each other ii the setting of a stream number in the stream number register and iii the output of a packet identifier to the demultiplexing unit respectively.

In the operation procedure of this example it is judged whether the language setting of the playback device matches the stream attribute contained in the stream registration information whose stream number is 1 and it is judged that they match. As a result of this the stream number 1 of this stream registration information is written into the stream number register. Also the packet identifier written in the stream entry of the basic stream selection table is output to the demultiplexing unit. Following this a pair of TS packets identified by a pair of packet identifiers written in the stream entry of the stream registration information whose stream number is 1 in the extension stream selection table are output to the decoder.

The arrows connecting the combined stream registration sequence and the demultiplexing unit indicate the stream entries in which the packet identifiers currently referenced are written among a plurality of stream registration sequences in the combined stream registration sequence. indicates that the demultiplexing unit is referencing i a packet identifier written in a stream entry in the base view video stream registration sequence in the basic stream selection table ii a packet identifier written in a stream entry in the dependent view stream registration sequence in the extension stream selection table iii a packet identifier written in a stream entry in the PG text subtitle stream registration sequence in the extension stream selection table and iv a packet identifier written in a stream entry in the IG stream registration sequence in the extension stream selection table.

The arrows connecting the demultiplexing unit and a plurality of decoders indicate the TS packets that are output to the respective decoders among a plurality of source packets existing in the interleaved stream file. As shown in the following TS packets are output from the demultiplexing unit to the decoders a TS packet constituting the base view video stream a TS packet constituting the dependent view video stream a TS packet constituting the base view PG stream a TS packet constituting the dependent view PG stream a TS packet constituting the base view IG stream and a TS packet constituting the dependent view IG stream.

The arrows connecting the combined stream registration sequence and the shift units indicate the referencing in the 1 plane offset mode of i an offset of a stream registration sequence corresponding to the PG stream in the extension stream selection table and ii an offset of a stream registration sequence corresponding to the IG stream in the extension stream selection table.

The arrows connecting the demultiplexing unit and a plurality of decoders indicate the TS packets that are output to the respective decoders among a plurality of source packets existing in the stream file. As shown in the following TS packets are output from the demultiplexing unit to the decoders a TS packet constituting the base view video stream a TS packet constituting the PG stream a TS packet constituting the IG stream and a TS packet constituting the audio stream.

The arrows connecting the video decoder and the shift units indicate that the offset in the dependent view video stream is supplied to the shift unit for the PG stream and to the shift unit for the IG stream based on the above described offset referencing.

The arrows connecting the combined stream registration sequence and the demultiplexing unit indicate the stream entries in which the packet identifiers currently referenced are written among a plurality of stream registration sequences in the combined stream registration sequence. indicates that the demultiplexing unit is referencing i a packet identifier written in a stream entry in the base view video stream registration sequence in the basic stream selection table ii a packet identifier written in a stream entry in the PG text subtitle stream registration sequence in the basic stream selection table and iii a packet identifier written in a stream entry in the IG stream registration sequence in the basic stream selection table.

The arrows connecting the demultiplexing unit and a plurality of decoders indicate the TS packets that are output to the respective decoders among a plurality of source packets existing in the stream file. As shown in the following TS packets are output from the demultiplexing unit to the decoders a TS packet constituting the base view video stream a TS packet constituting the PG stream a TS packet constituting the IG stream and a TS packet constituting the audio stream.

The arrows connecting the combined stream registration sequence and the demultiplexing unit indicate the stream entries in which the packet identifiers currently referenced are written among a plurality of stream registration sequences in the combined stream registration sequence. indicates that the demultiplexing unit is referencing i a packet identifier written in a stream entry in the base view video stream registration sequence in the basic stream selection table ii a packet identifier written in a stream entry in the PG text subtitle stream registration sequence in the basic stream selection table and iii a packet identifier written in a stream entry in the IG stream registration sequence in the basic stream selection table.

The arrows connecting the demultiplexing unit and a plurality of decoders indicate the TS packets that are specified by the stream entries in the stream registration sequences in the basic stream selection table and are output to the respective decoders among a plurality of source packets existing in the interleaved stream file.

The playback control having been described up to now can be realized by causing a computer to execute a program which is generated by writing the processing procedure represented by the flowcharts of in an object oriented compiler language.

In this flowchart the basic stream selection table in the current playitem information is set as the current basic stream selection table step S . This step is followed by a loop constituted from steps S through S. In this loop steps S through S are repeated for each of the PG stream IG stream secondary video stream primary audio stream and secondary audio stream. In step S it is judged whether or not the number of stream entries in the current basic stream selection table corresponding to stream x is 0. In step S it is judged whether or not the number of stream entries in the current basic stream selection table corresponding to stream x is equal to or larger than the stream number stored in the stream number register.

When it is judged YES in step S or S the control goes to step S in which the stream number stored in the stream number register is maintained.

When it is judged NO in both steps S and S the control goes to step S in which it is judged which among a plurality of conditions are satisfied by each PES stream registered in the current basic stream selection table and then in step S it is judged whether there are a plurality of PES streams that satisfy a same combination of conditions.

When it is judged in step S that there is only one PES stream that satisfies the conditions the PES stream satisfying the conditions is selected as the current stream step S .

When it is judged in step S that there are a plurality of PES streams that satisfy a same combination of conditions a PES stream having the highest priority in the current basic stream selection table is selected from among the plurality of PES streams that satisfy a same combination of conditions step S . After the PES stream is selected in this way the stream number of the selected PES stream is written into the stream number register step S .

After the PES stream to be played back in the current playitem is determined as described above the playback of the current playitem needs to be started. The procedure for playing back the current playitem is based on the output mode that is determined in the Procedure when playback condition is changed .

In step S it is judged whether or not the fixed offset during Popup of the extension stream selection table is ON. When it is judged NO in step S and NO in step S the steps S through S are executed.

In the steps S through S the video stream is set to the stereoscopic B D type and the video plane is set to the B D presentation mode step S the demultiplexing based on the packet identifier of Stream entry in SS dependent View block is instructed step S and the process of steps S through S is executed.

In step S it is judged whether or not is SS PG in the stream registration information of the current PG stream is ON. When is SS PG is ON the PG stream is set to the to stereoscopic playback type step S and the demultiplexing based on the packet identifier of Stream entry base view and Stream entry dependent view of the stream registration information corresponding to the current PG stream is instructed step S .

When is SS PG is OFF the PG stream is set to the 1 Plane Offset playback type the PG stream is set to the 1 Plane Offset mode step S and the offset sequence specified by SS PG textST offset sequence id ref of the stream registration information corresponding to the current PG stream is obtained from the dependent view video stream step S and the plane shift is executed based on the obtained offset sequence step S .

In step S it is judged whether or not is SS IG in the stream registration information of the current IG stream is ON. When is SS IG is ON the demultiplexing based on the packet identifier of Stream entry base view and Stream entry dependent view of the stream registration information corresponding to the current IG stream is instructed step S .

When is SS IG is OFF the offset sequence specified by SS IG textST offset sequence id ref of the stream registration information corresponding to the current IG stream is obtained from the dependent view video stream step S and the plane shift is executed based on the obtained offset sequence step S .

When Fixed offset during Popup of the extension stream selection table is ON the judgment in step S results in NO the judgment in step S results in YES and steps S through S are executed.

In steps S through S the video stream is set to the stereoscopic B B playback type the video plane is set to the B B presentation mode step S and steps S through S are executed.

In step S it is judged whether is SS PG in the stream registration information of the current PG stream is ON. When is SS PG is ON the control proceeds to step S in which the PG stream is set to 1 Plane Offset mode type and the PG plane is set to 1 Plane Offset mode. Then the offset sequence specified by SS PG textST offset sequence id ref is obtained from the dependent view video stream step S and the plane shift is performed based on the obtained offset sequence step S . After this the control proceeds to step S.

When is SS PG is OFF the control proceeds to step S in which the PG stream is set to 1 Plane Zero Offset mode type and the PG plane is set to 1 Plane Zero Offset mode. After this the control proceeds to step S.

In step S the plane shift is performed in the direction indicated by IG Plane offset direction during BB video in the stream registration information of the current IG stream by the amount indicated by IG Plane offset value during BB video. With the above described process when Fixed offset during Popup is ON a stereoscopic image which is generated by superimposing a three dimensional subtitle or menu on a monoscopic video image can be played back.

In step S it is judged whether a stream is a PG stream or a text subtitle stream. When it is judged that it is a PG stream the control moves to a loop in which steps S through S are repeatedly performed. In this loop the steps are performed as follow. The variables i and j are initialized to 0 step S . Plane offset direction j and Plane offset value j of GOP i among the offset sequences having offset sequence id specified by PG textST offset sequence id ref of the current stream are obtained from the video decoder step S . The plane shift is executed by using the Plane offset direction j and Plane offset value j of GOP i . The step S defines the condition for ending the loop using the variable i . In step S it is judged whether or not the variable i has become number of offset sequence . Until it is judged that the condition is satisfied a process in which the variable i is incremented in step S and the control returns to step S is repeated.

In another loop steps S through S are performed as follow. A start of the base view horizontal display period in the frame of GOP is waited step S . When it is judged that the period has started the control moves to step S in which the pixels of each line in the picture data of frame j are shifted by the number of pixels indicated by Plane offset value j in the direction indicated by Plane offset direction j of the X axis. After this a start of the dependent view horizontal display period in the frame of GOP is waited step S . When it is judged that the period has started the pixels of each line in the picture data of frame j are shifted by the number of pixels indicated by Plane offset value j in the reverse direction of the direction indicated by Plane offset direction j of the X axis. The step S defines the condition for ending the loop using the variable j . In step S it is judged whether or not the variable j has become number of displayed frame in GOP . Until it is judged that the condition is satisfied a process in which the variable j is incremented in step S and the control returns to step S is repeated.

In step S an interpolation value is obtained for each drawing area of the PG plane of the offset to be used for the frame. In step S the pixels of each drawing area of the PG plane are shifted by the number of pixels equal to Plane offset value j interpolation value in the direction indicated by Plane offset direction j of the X axis.

In step S the pixels of each drawing area of the PG plane are shifted by the number of pixels equal to Plane offset value j interpolation value in the reverse direction of the direction indicated by Plane offset direction j of the X axis.

In step S it is judged whether or not Fixed offset during Popup of the STN table SS is ON. When it is judged as No the control moves to step S and when it is judged as Yes the control moves to step S.

In step S Plane offset direction j and Plane offset value j of GOP i among the offset sequences having offset sequence id specified by SS IG textST offset sequence id ref of the current stream are obtained from the video decoder.

In step S the pixels of each line in the IG plane are shifted by the number of pixels indicated by Plane offset value j in the direction indicated by Plane offset direction j of the X axis.

In step S the pixels of each line in the IG plane are shifted by the number of pixels indicated by Plane offset value j in the reverse direction of the direction indicated by Plane offset direction j of the X axis.

In step S IG Plane offset direction during BB video and IG Plane offset value during BB video of the current stream in the STN table SS are obtained.

In step S the pixels of each line in the IG plane are shifted by the number of pixels indicated by IG Plane offset value during BB video in the direction indicated by IG Plane offset direction during BB video of the X axis.

In step S the pixels of each line in the IG plane are shifted by the number of pixels indicated by IG Plane offset value during BB video in the reverse direction of the direction indicated by IG Plane offset direction during BB video of the X axis.

As described above according to the present embodiment it is defined that the control information for controlling the 1 plane offset mode should be provided within the dependent view stream. With this structure the control information can be generated based on the depth information obtained during shooting by the 3D camera and based on the parallax information obtained in the encoding process by the encoder for generating the video stream and the control information can be incorporated as metadata into the dependent view stream. This facilitates generation of the control information for controlling the offset control in the 1 plane offset mode. This makes it possible to greatly omit working in the authoring process. Since the control information defines the offset control in the 1 plane offset mode a stereoscopic playback is possible when there is only one subtitle or one menu even if there are no left and right subtitles or menus. In this way the structure of the present embodiment not only reduces the time and effort required for creating the subtitle and menu for each of the left view and the right view but makes it possible to realize the stereoscopic playback even if plane memory in the playback device has a size of one plane. This realizes both an efficient authoring and a low cost in the playback device.

In Embodiment 1 sub TSs constituting the dependent view data blocks are referenced from the sub clip entry ID reference. Due to this structure when the sub TSs are recorded separately from the main TSs the sub TSs are read when the playback mode is switched from the 2D playback mode to the 3D playback mode. This might impair the seamlessness of the AV playback. As one improvement with respect to this problem the present embodiment proposes a structure that ensures the main TSs and the sub TSs to be read together into the playback device. More specifically a main TS and a sub TS are interleaved as a pair and recorded as one file.

Here as a premise of the present embodiment files in the UDF file system will be explained briefly. The UDF file is composed of a plurality of Extents managed by the file entry. The file entry includes a descriptor tag an ICB tag and an allocation descriptor .

The descriptor tag is a tag identifying as a file entry the file entry which includes the descriptor tag itself. The descriptor tag is classified into a file entry descriptor tag a space bit map descriptor tag and so on. In the case of a file entry descriptor tag 261 which indicates file entry is written therein.

The allocation descriptor includes a Logical Block Number LBN indicating a recording position of an Extent constituting a low order file under a directory. The allocation descriptor also includes data that indicates the length of the Extent. The high order two bits of the data that indicates the length of the Extent are set as follows 00 to indicate an allocated and recorded Extent 01 to indicate an allocated and not recorded Extent and 11 to indicate an Extent that follows the allocation descriptor. When a low order file under a directory is divided into a plurality of Extents the file entry should include a plurality of allocation descriptors in correspondence with the Extents.

It is possible to detect an address of an Extent constituting a stream file by referring to the allocation descriptor in the file entry described above.

The stereoscopic interleaved stream file FileSS is a stream file 2TS interleaved file in which two TSs are interleaved and is identified by a five digit integer value and an extension ssif indicating an interleave format file for stereoscopic playback. The stereoscopic interleaved stream file is composed of Extent SS n . The Extent SS n also referred to as EXTSS n is identified by the index number n . The index number n increments in order starting from the top of the stereoscopic interleaved stream file.

The dependent view data block and base view data block constituting the Extent SS n are a target of cross reference by the file 2D file base and file dependent. Note that the cross reference means that a piece of data recorded on a recording medium is registered as an Extent of a plurality of files in the file entries thereof. In the present embodiment the starting addresses and continuation lengths of the dependent view data block and base view data block are registered in the file entries of the file 2D file base and file dependent.

The file base FileBase is a virtual stream file that is presumed to store a main TS specified by the Extent start point information in the clip information corresponding to the file 2D. The file base FileBase is composed of at least one Extent 1 i also referred to as EXT1 i . The Extent 1 i is the iExtent in the file base where i is an index number of the Extent and is incremented starting from 0 at the top of the file base. The file base is a virtual stream file used to treat the stereoscopic interleaved stream file which is a 2TS file as a 1TS file. The file base is generated in a virtual manner by building its file entry in the memory of the playback device.

In the actual reading the file base is identified by performing a file open using a file name of the stereoscopic interleaved stream file. More specifically when the file open using a file name of the stereoscopic interleaved stream file is called the middleware of the playback device generates in the memory a file entry identifying an Extent in the file base and opens the file base in a virtual manner. The stereoscopic interleaved stream file can be interpreted as including only one TS and thus it is possible to read a 2TS stereoscopic interleaved stream file from the recording medium as a 1TS file base.

When only a base view data block is to be read in the B B presentation mode only the Extents constituting the file base become the target of the reading. Even if the mode is switched from the B B presentation mode to the B D presentation mode both the dependent view data block and the base view data block can be read by extending the reading range from the Extents constituting the file base to the Extents constituting the stereoscopic interleaved stream file. Thus with this arrangement the efficiency of the file reading is not decreased.

The file dependent FileDependent is a stream file that is presumed to store a sub TS and is composed of Extent 2 i also referred to as EXT2 i . The Extent 2 i is the iExtent in the file dependent where i is an index number of the Extent and is incremented starting from 0 at the top of the file dependent. The file dependent is a virtual stream file used to treat the stereoscopic interleaved stream file which is a 2TS file as a 1TS file storing the sub TS. The file dependent is generated in a virtual manner by building its file entry in the memory of the playback device.

The dependent view video stream is attached with and accessed with use of a file name that is represented by a number generated by adding 1 to the five digit integer representing the file name of the stereoscopic interleaved stream file. The recording medium stores a dummy file and the number generated by adding 1 namely the identification number of the dependent view video stream is attached to the dummy file. Note that the dummy file is a file that stores no Extent namely substantial information but is attached with only a file name. The dependent view video stream is treated as being stored in the dummy file.

The file 2D File2D is a 1TS stream file storing a main TS that is played back in the 2D playback mode and is composed of the Extent 2D. The file 2D is identified by a five digit integer value and an extension ssif indicating an interleave format file for stereoscopic playback.

The following explains the correspondence between the file 2D file base and the file dependent. shows the correspondence between the file 2D file base and the file dependent.

In the first row shows a file 2D file base 00001.m2ts and a file dependent 00002.m2ts. The second row shows Extents that store dependent view data blocks and base view data blocks. The third row shows a stereoscopic interleaved stream file 00001.ssif.

The dotted arrows h h h and h show the files to which Extents EXT1 i and EXT2 i belong the belongingness being indicated by the allocation identifiers. According to the belongingness guided by the arrows h and h Extents EXT1 i and EXT1 i 1 are registered as Extents of the file base 00001.m2ts.

According to the belongingness guided by the arrows h and h Extents EXT2 i and EXT2 i 1 are registered as Extents of the file dependent 00002.m2ts.

According to the belongingness guided by the arrows h h h and h Extents EXT1 i EXT2 i EXT1 i 1 and EXT2 i 1 are registered as Extents of 00001.ssif. As understood from this Extents EXT1 i and EXT1 i 1 have the duality of belonging to 00001.ssif and 00001.m2ts. The extension ssif is made of capital letters of StereoScopic Interleave File indicating that the file is in the interleave format for stereoscopic playback.

The third row in shows the internal structure of the interleaved stream file. As shown in Extents EXT1 1 and EXT1 2 storing base view data blocks and EXT2 1 and EXT2 2 storing dependent view data blocks are arranged alternately in the interleave format in the interleaved stream file.

The first row in shows the internal structure of the file 2D file base. The file 2D file base is composed of only Extents EXT1 1 and EXT1 2 storing base view data blocks among the Extents constituting the interleaved stream file shown in the third row. The file 2D file base and the interleaved stream file have the same name but different extensions.

The second row in shows the internal structure of the file dependent. The file dependent is composed of only Extents EXT2 1 and EXT2 2 storing dependent view data blocks among the Extents constituting the interleaved stream file shown in the third row. The file name of the file dependent is a value higher by 1 than the file name of the interleaved stream file and they have different extensions.

Not all playback devices necessarily support the 3D playback system. Therefore it is preferable that even an optical disc including a 3D image supports a 2D playback. It should be noted here that the playback devices supporting only the 2D playback do not identify the data structure extended for the 3D. The 2D playback devices need to access only the 2D playlists and 2D AV clips by using a conventional identification method provided to the 2D playback devices. In view of this the left view video streams are stored in a file format that can be recognized by the 2D playback devices.

According to the first method the main TS is assigned with the same file name as that in the 2D playback system so that the above described referencing of playlist information can be realized that is to say so that the main TS can be used in the 2D playback as well and stream files in the interleave format have a different extension. shows that files 00001.m2ts and 00001.ssif are coupled with each other by the same file name 00001 although the former is in the 2D format and the latter is in the 3D format.

In a conventional 2D playback device the playlist refers to only the AV clips the main TS and therefore the 2D playback device plays back only the file 2D. On the other hand in a 3D playback device although the playlist refers to only the file 2D storing the main TS when it finds a file that has the same identification number and a different extension it judges that the file is a stream file in the interleave format for the 3D image and outputs the main TS and sub TS.

The second method is to use different folders. The main TSs are stored in folders with conventional folder names for example STREAM but sub TSs are stored in folders with folder names unique to 3D for example SSIF with the same file name 00001 . In the 2D playback device the playlist refers to only files in the STREAM folder but in the 3D playback device the playlist refers to files having the same file name in the STREAM and SSIF folders simultaneously making it possible to associate the main TS and the sub TS.

The third method uses the identification numbers. That is to say this method associates the files based on a predetermined rule regarding the identification numbers. For example when the identification number of the file 2D file base is 00001 the file dependent is assigned with identification number 00002 that is made by adding 1 to the identification number of the file 2D file base as shown in . However the file system of the recording medium treats the file dependent which is assigned with a file name according to the rule as a non substantial dummy file. This is because the file dependent is in the actuality the stereoscopic interleaved stream file.

The file names having been associated with each other in this way are written into i the stream registration information in the basic stream selection table and ii the sub clip entry ID reference ref to STC id 0 in the stream registration information in the extension stream selection table. On the other hand the playback device recognizes a file name which is a value higher by 1 than the file name written in the sub clip entry ID reference as the file name of the dummy file and performs the process of opening the file dependent in a virtual manner. This ensures that the stream selection procedure reads from the recording medium the file dependent that is associated with other files in the above described manner.

The base view data block B i is the idata in the main TS. Note that the main TS is a TS specified as the main element of the main path by the clip information file name information of the current playitem information. The i in B i is an index number that is incremented starting from 0 corresponding to the data block at the top of the file base.

The base view data blocks fall into those shared by the file base and the file 2D and those not shared by the file base and the file 2D.

The base view data blocks shared by the file base and the file 2D and the base view data blocks unique to the file 2D become the Extents of the file 2D and they are set to have a length that does not cause a buffer underflow in the playback device. The starting sector address of the base view data blocks is written in the allocation descriptor in the file entry of the file 2D.

The base view data blocks unique to the file base which are not shared by the file 2D do not become the Extents of the file 2D and thus they are not set to have a length that does not cause an underflow in a single buffer in the playback device. The base view data blocks are set to have a smaller size namely a length that does not cause an underflow in a double buffer in the playback device.

The starting sector addresses of the base view data block unique to the file base are not written in the allocation descriptor in the file entry. Instead of this the starting source pocket in the base view data block is pointed to by the Extent start point information in the clip information of the clip information file corresponding to the main TS. Therefore the starting sector address of a base view data block unique to the file base needs to be obtained by using i the allocation descriptor in the file entry of the stereoscopic interleaved stream file and ii the Extent start point information in the clip information.

When the base view is the left view the base view data block is a block of source packets that store portions of a plurality of types of PES streams for 2D playback and left view playback including source packets that store portions of the left view video stream source packets that store portions of the left view graphics stream source packets that store portions of the audio stream that are played back together with those streams and packet management information PCR PMT PAT defined in the European broadcasting standard. The packets constituting the base view data block have continuous ATCs STCs and SPNs to ensure a seamless AV playback for a predetermined period.

The dependent view data block D i is the idata in the sub TS. Note that the sub TS is a TS specified as the main element of the sub path by the stream entry in the stream registration sequence in the extension stream selection table corresponding to the current playitem information. The i in D i is an index number that is incremented starting from 0 corresponding to the data block at the top of the file dependent.

The dependent view data blocks become the Extents of the file dependent and are set to have a length that does not cause an underflow in a double buffer in the playback device.

Also in the continuous areas in the recording medium a dependent view data block is disposed before a base view data block that is played back in the same playback time together the dependent view data block. For this reason when the stereoscopic interleaved stream file is read the dependent view data block is read before the corresponding base view data block without fail.

The starting sector addresses of the dependent view data blocks are not written in the allocation descriptor in the file entry of the file 2D since the dependent view data blocks are not shared by the file 2D. Instead of this the starting source pocket in the dependent view data block is pointed to by the Extent start point information in the clip information. Therefore the starting sector address of a dependent view data block needs to be obtained by using i the allocation descriptor in the file entry of the file 2D and ii the Extent start point information in the clip information.

When the dependent view is the right view the dependent view data block is a block of source packets that store portions of a plurality of types of PES streams for right view playback including source packets that store portions of the right view video stream source packets that store portions of the right view graphics stream and source packets that store portions of the audio stream that are played back together with those streams. The packets constituting the dependent view data block have continuous ATCs STCs and SPNs to ensure a seamless AV playback for a predetermined period. In the continuous dependent view data blocks and corresponding base view data blocks the source packet numbers of the source packets constituting these blocs are continuous but the ATSs of the source packets constituting these blocs are each the same value. Accordingly a plurality of source packets constituting the dependent view data blocks and a plurality of source packets constituting the corresponding base view data blocks reach the PID filters at the same ATC time.

As described above the Extents of the file 2D fall into those shared by the file base and those not shared by the file base.

Suppose here that the Extents of the file 2D are B B B B 2D and B 2D and that the Extents of the file base are B B B B ss and B ss. Of these B B and B are base view data blocks shared by the file base. B 2D and B 2D are base view data blocks unique to the file 2D not shared by the file base.

The data of B 2D is bit for bit same as data of B ss. The data of B 2D is bit for bit same as data of B ss.

The data blocks B B 2D and B 2D in the file 2D constitute Extents big Extents having a large continuation length immediately before a position at which a long jump is caused. In this way big Extents can be formed immediately before a long jump in the file 2D. Accordingly even when a stereoscopic interleaved stream file is played back in the 2D playback mode there is no need to worry an occurrence of an underflow in the read buffer.

The file 2D and the file base have sameness although being partially different in Extents. Therefore the file 2D and the file base are generically called file 2D file base .

In general when an optical disc is adopted as the recording medium an operation for suspending a reading operation of the optical pickup and during the suspension positioning the optical pickup onto the next reading target area is called jump .

The jump is classified into a jump that increases or decreases the rotation speed of the optical disc a track jump and a focus jump. The track jump is an operation of moving the optical pickup in the radius direction of the disc. The focus jump is available when the optical disc is a multi layer disc and is an operation of moving the focus of the optical pickup from one recording layer to another recording layer. These jumps are called long jumps since they generally require a long seek time and a large number of sectors are skipped in reading due to the jumps. During a jump the reading operation by the optical pickup is suspended.

The length of the portion for which the reading operation is skipped during a jump is called jump distance . The jump distance is typically represented by the number of sectors included in the portion. The above mentioned long jump is specifically defined as a jump whose jump distance exceeds a predetermined threshold value. The threshold value is for example 40000 sectors in the BD ROM standard in accordance with the disc type and the performance concerning the process of reading the drive.

Typical positions at which the long jump is caused include a boundary between recording layers and a position at which one playitem is connected with n playitems namely a multi connection is performed.

Here when a one to n multi connection of playitems is performed the first TS among n pieces of TSs constituting n pieces of playitems can be disposed at a position immediately after a TS that constitutes the playitem that precedes the n playitems. However any of the second TS and onwards cannot be disposed at the position immediately after the TS that constitutes the playitem preceding the n playitems. When at a one to n multi connection a jump is made from the one playitem to any of the second playitem and onwards in the n playitems the reading needs to skip one or more recording areas of TSs. Therefore a long jump occurs at a position where a one to n multi connection exists.

The playback path of the 2D playback mode is composed of Extents of the file 2D referenced by the clip information file name information in the current playitem information.

The playback path of the B D presentation mode is composed of Extents of the stereoscopic interleaved stream file referenced by the clip information file name information in the current playitem information.

The playback path of the B B presentation mode is composed of Extents of the file base referenced by the clip information file name information in the current playitem information.

Switching among these playback paths of the three modes can be made by performing a file open using the file name written in the clip information file name information in the current playitem information as the file name of the file 2D as the file name of the file base or as the file name of the stereoscopic interleaved stream file. Such switching among playback paths does not change the current playlist or current playitem and thus can maintain the seamlessness when the playback mode is changed.

With this structure the playback device can read data blocks suited for each playback mode from the recording medium by opening any of the stereoscopic interleaved stream file file base and file 2D based on the clip information file name information in the current playitem information.

The lowermost value of EXT2D is determined so that when a playback in the 2D playback mode is performed a buffer under flow does not occur in the read buffer of the playback device during a jump period from each base view data block to the next base view data block.

The lowermost value of EXT2D is represented by the following expression for Condition 1 when it takes Tjump2D n of time when a jump from the nbase view data block to the n 1 base view data block is made each base view data block is read into the read buffer at a speed of Rud2D and the base view data block is transferred from the read buffer to the video decoder at an average speed of Rbext2D. Lowermost value of EXT2 2ext2 2ext2 jump2 

It is presumed here that an Extent corresponding to a base view data block B n ss is represented as EXT1 n . In this case the lowermost value of EXT1 n is determined so that when a playback in the B D presentation mode is performed a buffer under flow does not occur in the double buffer during a jump period from each base view data block to the next dependent view data block and during a jump period from said dependent view data block to the next base view data block.

In the present example the double buffer is composed of a read buffer and a read buffer . The read buffer is the same as the read buffer provided in the 2D playback device.

It is presumed here that when a playback in the B D presentation mode is performed it takes Tfjump3D n of time when a jump from the nbase view data block to the pdependent view data block is made and it takes TBjump3D n of time when a jump from the pdependent view data block to the n 1 base view data block is made.

It is further presumed that each base view data block is read into the read buffer at a speed of Rud3D each dependent view data block is read into the read buffer at the speed of Rud3D and the base view data block is transferred from the read buffer to the video decoder at an average speed of Rbext3D. Then the lowermost value of EXT1 n is represented by the following expression for Condition 2. The continuation length of the big Extents is set to a value that is equal to or higher than the lowermost value. Lowermost value of EXT1 3ext3 3ext3 jump3 EXT2 3jump3 

The lowermost value of EXT2 is determined so that when a playback in the B D presentation mode is performed a buffer under flow does not occur in the double buffer of the playback device during a jump period from each dependent view Extent to the next base view data Extent and during a jump period from said base view Extent to the next dependent view Extent.

The lowermost value of EXT2 n is represented by the following expression for Condition 3 when it takes Tfjump3D n 1 of time when a jump from the n 1 base view data block to the p 1 dependent view data block is made and the dependent view data block is transferred from the read buffer to the decoder at an average speed of Rdext3D. Lowermost value of EXT2 3ext3 3ext3 jump3 EXT21 3jump3 1 

When a jump from a reading of an Extent to the next Extent is to be made the buffer should be occupied by a sufficient amount of data immediately before the jump. Accordingly when a stereoscopic interleaved stream file is to be read the read buffer needs to store one Extent and occurrence of a buffer under flow should be avoided.

However the EXTSS needs to be determined based not only on Tjump a time period taken when a jump from an Extent to another Extent but on Tdiff . It should be noted here that the Tdiff represents a delay time that occurs in connection with a preloading of dependent view data blocks in EXTss and a preloading of dependent view data blocks in EXTssnext. The following further explains the meaning of Tdiff. When a stereoscopic interleaved stream file is read while the starting dependent view data block is being preloaded.

In EXTss the playback is delayed as much as the time period required for preloading the dependent view data block. Here the time period required for preloading the starting dependent view data block in EXTss is referred to as delay period because the playback is delayed as much as the period.

On the other hand in EXTssnext immediately after a jump from EXTss to EXTssnext is made the starting dependent view data block is preloaded. Thus the playback by the video decoder is allowed to be delayed for the period of the preloading. Therefore the time period in which the starting dependent view data block is preloaded in the playback of EXTssnext is referred to as grace period because the start of playback by the video decoder is allowed to be delayed for the period.

In view of this a value of Tdiff is obtained by subtracting the delay period from the grace period of the dependent view data block. More specifically the value Tdiff is calculated using the following expression. diff ceil 1EXT1 EXTnext 1EXT1 EXT 1000 872 

In the above expression Tdiff means a difference between the time period for reading S1stEXT2 i EXTss and the time period for reading S1stEXT2 i EXTSSnext S1stEXT2 i EXTss represents the size of EXT2 i which is located at the start of EXTss S1stEXT2 i EXTssnext represents the size of EXT2 i which is located at the start of EXTssnext. EXTssnext is an Extent in the stereoscopic interleaved stream file is located immediately after EXTss and is played back seamlessly with EXTss.

With use of Tdiff and Tjump which is a time period required for jump to EXTssnext Sextss which is the minimum Extent size based on the average bit rate in each Extent is calculated as a value satisfying the following Condition 4. ext Byte ceil jump diff 72 1000 8 ext192 72 188ext192 

In the above Condition 4 Rud72 represents a data rate in transfer from the BD ROM drive in the stereoscopic playback mode.

Rextss represents an average bit rate in EXTss and is obtained using the following expressions. ext ceil 188 8 ext27000000 extstart EXTnext start EXT extlast EXTstart EXT ceil 27000000 188 8 min 12 

ATCstart EXTss represents the minimum ATC value specified by the ATC field of the source packet sequence in EXTss.

ATCstart EXTssnext represents the minimum ATC value specified by the ATC field of the source packet sequence in EXTssnext.

ATClast EXTss represents the maximum ATC value specified by the ATC field of the source packet sequence in EXTss.

Nsp represents the number of source packets which are included in the main TS and sub TS and have ATC values corresponding to ATCs in the range of ATCDexss.

When two playitems are to be played back continuously EXTss includes the first byte of data in the ATC sequence that is used by the previous playitem Playitem .

The data blocks shown in the second row are D B D B D B ss D B ss B 2D and B 2D. The arrows ex ex ex and ex show the belongingness in which among these data blocks data blocks B B B 2D and B 2D constitute the Extents of the file 2D.

The arrows ex and ex show the belongingness in which D B D B D B ss D and B ss constitute the Extents of the stereoscopic interleaved stream file.

The fourth row shows that among these data blocks constituting the stereoscopic interleaved stream file B B B ss and B ss constitute the Extents of the file base. The fifth row shows that among the data blocks constituting the stereoscopic interleaved stream file D D D and D constitute the Extents of the file dependent.

The arrows rf rf and rf show a playback path generated by combining the extension m2ts and a file name 00001 described in clip information file name in the playitem information of the 2D playlist information. In this case the playback path on the base view side is constituted from data blocks B B and B 2D.

The arrows rf rf rf and rf show a playback path specified by the playitem information of the 3D playlist information. In this example the playback path on the base view side is constituted from data blocks B B B ss and B ss.

The arrows rf rf rf and rf show a playback path specified by the sub playitem information of the 3D playlist information. In this example the playback path on the dependent view side is constituted from data blocks D D D and D . These data blocks constituting the playback paths specified by the playitem information and the sub playitem information can be read by opening files that are generated by combining the extension ssif and file names written in clip information file name in the playitem information.

As shown in the clip information file name information in the 3D playlist and the clip information file name information in the 2D playlist have file names in common. Accordingly the playlist information can be written to include description that is common to the 3D playlist and the 2D playlist see as signs df and df indicate so as to define the 3D playlist and the 2D playlist. Accordingly once playlist information for realizing the 3D playlist is written the playlist information functions as the 3D playlist when the output mode of the playback device is the stereoscopic output mode and the playlist information functions as the 2D playlist when the output mode of the playback device is the 2Doutput mode. The 2D playlist and the 3D playlist shown in have in common a piece of playlist information which is interpreted as the 2D playlist or the 3D playlist depending on the output mode of the playback device that interprets the piece of playlist information. This reduces the amount of time and effort made by a person in charge of authoring.

When main TSs and sub TSs are stored in the stereoscopic interleaved stream file a file name of the file 2D is written in clip information file name in the playitem information of the 2D playlist and a file name of the file base is written in clip information file name in the playitem information of the 3D playlist. Since the file base is a virtual file and its file name is the same as that of the stereoscopic interleaved stream file the file name of the stereoscopic interleaved stream file can be written in clip information file name in the playitem information. A file name of the file dependent is written in ref to subclip entry id in the stream registration information in the extension stream selection table. The file name of the file dependent is created by adding 1 to the identification number of the stereoscopic interleaved stream file.

It is possible to display comfortable stereoscopic images based on parallax to the user by changing sub paths to be played back in synchronization with main paths defined by the main TS constituted from the base view data blocks.

With respect to this playlist information realizing the 3D playlist the playlist information functions as the 3D playlist when the output mode of the playback device is the stereoscopic output mode and the playlist information functions as the 2D playlist when the output mode of the playback device is the 2Doutput mode. The 2D playlist and the 3D playlist shown in have in common a piece of playlist information which is interpreted as the 2D playlist or the 3D playlist appropriately depending on the output mode of the playback device that interprets the piece of playlist information. This reduces the amount of time and effort made by a person in charge of authoring.

In general the left view video is generated as the 2D video. However some might think that the right view video is suitable for the 2D video. To support such a demand a base view indicator is set in each piece of playitem information where the base view indicator indicates which of the left view and the right view is set as the base view. The base view indicator set in each piece of playitem information indicates which of the left view video stream and the right view video stream is set as the base view video stream which of the left view PG stream and the right view PG stream is set as the base view PG stream and which of the left view IG stream and the right view IG stream is set as the base view IG stream.

As described above a dependent view data block precedes a base view data block without fail. As a result by referring to the base view indicator it is possible to recognize which of the source packet for playing back the right view and the source packet for playing back the left view is first supplied to the playback device.

When the right view video stream is specified as the base view video stream this information causes the right view video stream to be entered to the video decoder first to obtain non compressed picture data even if the right view is specified by the sub path information. And based on the non compressed picture data obtained by decoding the right view video stream motion compensation is performed. This makes the selection of the base view more flexible.

The base view indicator can be used when the stream are output to the display device. The display device use the base view indicator to differentiate the two types of streams. In a system in which glasses with shutters are used displays of the glasses and the display device cannot be synchronized unless it is recognized which of the left view and the right view is the main image referenced by the playitem. A switch signal is sent to the glasses with shutters so that the light is transmitted through the glass for the left eye when the left view is displayed and the light is transmitted through the glass for the right eye when the right view is displayed.

The information provided by the base view indicator is also used In stereoscopic methods for the naked eye such as the lenticular method in which prism is incorporated in the screen of the display device. This is because the differentiation between the left view and the right view is necessary also in such methods. This completes the description of the base view indicator. The base view indicator is based on the premise that either the left view or the right view among the parallax images can be played back as the monoscopic video.

In step S it is judged whether or not the current output mode is the 3D output mode. When the current output mode is the 2D output mode a loop constituted from steps S through S is performed.

In step S the stream file which is identified by xxxxx described in Clip information file name of the current playitem and extension m2ts is opened. In step S the In time and Out time of the current playitem are converted into Start SPN i and End SPN i by using the entry map corresponding to the packet ID of the video stream.

In step S the Extents belonging to the reading range i are identified to read the TS packet with PID i from the Start SPN i to the End SPN i . In step S the drive of the recording medium is instructed to continuously read the Extents belonging to the reading range i .

When the current output mode is the stereoscopic output mode a loop constituted from steps S through S is performed.

In step S the stream file which is identified by xxxxx described in the Clip information file name of the current playitem and extension ssif is opened. In step S either the left view or right view video stream that is specified by the base view indicator of the current playitem information is set to the base view video stream. The left view or right view video stream that is not set to the base view video stream is set to the dependent view stream.

In step S the In time and Out time of the current playitem are converted to Start SPN i and End SPN i by using the entry map corresponding to the packet ID of the base view video stream.

In step S the sub playitem corresponding to the dependent view stream is identified. In step S the In time and Out time of the identified sub playitem are converted into Start SPN j and End SPN j by using the entry map j corresponding to the packet ID j of the dependent view stream.

The Extents belonging to the reading range i are identified to read the TS packet having the packet ID i from Start SPN i to End SPN i step S . The Extents belonging to the reading range j are identified to read the TS packet having the packet ID j from Start SPN j to End SPN j step S . Following this in step S the Extents belonging to the reading ranges i and j are sorted in the ascending order. In step S the drive is instructed to continuously read the Extents belonging to the reading ranges i and j using the sorted addresses. After this when the source packet sequence is read in step S the base view and dependent view ATC sequences are restored and supplied to the PID filters for the base view and dependent view.

As described above according to the present embodiment base view and dependent view data blocks are stored in one stereoscopic interleaved stream file and when they are supplied to the decoder the base view and dependent view ATC sequences are restored. With this structure the decoder can treat the stereoscopic interleaved stream file in the same manner as a regular stream file. Thus the storage method of the base view and dependent view video streams can be positively used for the storage of the stereoscopic interleaved stream file.

The clip information is information indicating for each ATC sequence what type of AV clip each source packet sequence stored in the stream file is. The clip information includes application type indicating the type such as the movie the slide show which the application constituted from the AV clip in concern falls under stream type indicating the type of stream which the AV clip in concern falls under TS recording rate being a transfer rate of TS packet in the AV clip in concern ATC delta being a difference in ATC from the ATC sequence constituting the preceding AV clip and an identifier of the encoding method used in the encoding.

The sequence information indicates for each ATC sequence information ATC sequence information that indicates what type of ATC sequence one or more source packet sequences stored in the stream file are. The ATC sequence information includes information indicating by the source packet number where the source packet being the start point of the ATC exists offsets between the STC sequence identifiers and the ATC sequence identifiers and STC sequence information corresponding to each of a plurality of STC sequences. Each piece of STC sequence information includes a packet number of a source packet storing the PCR of the STC sequence in concern information indicating where in the STC sequence the source packet being the start point of the STC sequence exists and the playback start time and the playback end time of the STC sequence.

The program information indicates the program structures of the main TS and sub TSs managed as AV clips by the clip information file. The program information indicates what types of ESs are multiplexed in the AV clip. More specifically the program information indicates what types of packet identifiers the ESs multiplexed in the AV clip have and indicates the encoding method. Thus the program information indicates the encoding method such as MPEG2 video or MPEG4 AVC that is used to compress encode the video stream.

The characteristic point information is information indicating for each ES where the characteristic points of a plurality of ESs multiplexed in the AV clip exist. The information indicating the characteristic point for each ES is called entry map .

What becomes the characteristic point is different for each type of stream. In the case of the base view and dependent view video streams the characteristic point is the access unit delimiter of the I picture that is located at the start of the open GOP and closed GOP. In the case of the audio stream the characteristic point is the access unit delimiter indicating the start positions of the audio frames that exist at regular intervals for example every one second. In the case of the PG and IG streams the characteristic point is the access unit delimiter indicating the start positions of the display sets display set of epoch start display set of acquisition point that are provided with all the functional segments necessary for the display among the display sets of the graphics streams.

The ATC sequence and the STC sequence differ in how they represent the characteristic point. The ATC sequence represents the characteristic point by the source packet number. The STC sequence represents the characteristic point by using the PTS that indicates the time point on the STC time axis.

In view of the above described differences the entry map for each ES is composed of a plurality of entry points. More specifically in each entry point constituting the entry map a source packet number that indicates the location of the characteristic point in the ATC sequence is associated with a PTS that indicates the location of the characteristic point in the STC sequence. Further each entry point includes a flag is angle change flag that indicates whether an angle change to the characteristic point is available. Since an angle change is available at the source packet located at the start of the interleave unit constituting the multi angle section the is angle change flag in the entry point indicating the starting source packet of the interleave unit is always set ON. Also the entry point indicating the starting source packet of the interleave unit is associated with In Time in the playitem information by the entry point.

The entry map for each ES indicates the source packet numbers of the characteristic points for respective stream types in correspondence with the PTSs. Accordingly by referencing this entry map it is possible to obtain from an arbitrary time point in the ATC sequence source packet numbers that indicate locations of the characteristic points for the ESs that are closest to the arbitrary time point.

This completes the explanation of the clip information file for 2D. Next is a detailed explanation of the clip information file for 3D. shows the internal structure of clip information file for 3D. The clip information file for 3D includes clip dependent information dependent view management information which is clip information for the file dependent and clip base information base view management information which is clip information for the file base as well as the clip information for file 2D that is regular clip information management information . The reason is as follows. As described in Embodiment 2 the stereoscopic interleaved stream file is stored in a directory that is different from the directory in which the regular stream files are stored to prevent them from mixing each other. Accordingly the clip information files cannot be associated with the stereoscopic interleaved stream file. Thus the clip dependent information and the clip base information are stored in the clip information file for 2D.

The clip dependent information and the clip base information differ from the clip information file for 2D in that the clip dependent information and the clip base information include metadata that has the Extent start point sequence.

As shown in the clip dependent information includes the Extent start point sequence and the clip base information also includes the Extent start point sequence. The Extent start point sequence included in the clip dependent information is composed of a plurality of pieces of Extent start point information and each piece of Extent start point information indicates the source packet number of each source packet that is at the start of each of a plurality of Extents constituting the file dependent.

Similarly the Extent start point sequence included in the clip base information is composed of a plurality of pieces of Extent start point information and each piece of Extent start point information indicates the source packet number of each source packet that is at the start of each of a plurality of Extents constituting the file base.

The following describes the technical meaning of providing the plurality of pieces of Extent start point information.

The TSs stored in the stream files are originally one TS with only one ATC sequence. Accordingly the location of the start of a portion that is created by dividing the original one cannot be determined even if the sequence information of the clip information file is referenced. On the other hand the start of a divisional portion is a start of an Extent as well. Thus it is possible to recognize the start of a divisional portion by referencing the information of the file system such as the file entry or the Extent descriptor. However since the information of the file system is managed by the middleware it is extremely difficult for the application to reference the information of the Extent. In view of this problem in the present embodiment the Extent start point information is used so that the ordinal number of the packet that corresponds to the Extent in concern is indicated in the clip information.

When as shown in the ATC sequence is constituted from dependent view data blocks D D D . . . D n then 0 b b b b . . . bn representing the relative source packet numbers of the dependent view data blocks D D D . . . D n are written in SPN extent start in the Extent start point information of the file dependent.

When the ATC sequence is constituted from base view data blocks B B B . . . B n then 0 a a a a . . . an representing the relative source packet numbers of the base view data blocks B B B . . . B n are written in SPN extent start in the Extent start point information of the file base.

Similarly when the start source packet number of the base view data block B x is ax and the start source packet number of the base view data block B x 1 is a the number of source packets constituting the B x is a ax .

When the start source packet number of the last base view data block B n in the stereoscopic interleaved stream file is an and the number of source packets in the ATC sequence is number of source packets the number of source packets constituting the base view data block B n is number of source packets an .

When the start source packet number of the last dependent view data block D n in the stereoscopic interleaved stream file is bn and the number of source packets in the ATC sequence is number of source packets the number of source packets constituting the dependent view data block D n is number of source packets bn .

The start SPN of D is the sum of the number of source packets b of the preceding D and the number of source packets a of B and thus b a .

The start SPN of B is the sum of the number of source packets b of the preceding D the number of source packets a of B and the number of source packets b b of the preceding D . Thus the start SPN of B is b a b a b b .

The start SPN of D is the sum of the number of source packets b of the preceding D the number of source packets a of B the number of source packets b b of the preceding D and the number of source packets a a of B . Thus the start SPN of D is b a b a b b a a .

The start SPN of B is the sum of the number of source packets b of the preceding D the number of source packets a of B the number of source packets b b of the preceding D the number of source packets a a of the preceding B and the number of source packets b b of D . Thus the start SPN of B is b a b a b b a a b b .

Considered here is a case for obtaining source packet numbers in a stereoscopic interleaved stream file D x which exists at the source packet number bx in the ATC sequence shown in . In this case the start source packet number of D x is a sum of the relative source packet numbers of D B D B D B . . . D x 1 B x 1 . Thus the start source packet number of D x is bx ax as shown in .

Also considered here is a case for obtaining source packet numbers in a stereoscopic interleaved stream file B x which exists at the source packet number ax in the ATC sequence shown in . In this case the start source packet number of B x is a sum of the relative source packet numbers of D B D B D B . . . D x 1 B x 1 D x . Thus the start source packet number of B x is b ax as shown in .

The start LBN of EXT1 x which is an Extent corresponding to B x of the file base and the continuation length are obtained as follows. Also the start LBN of EXT2 x which is an Extent corresponding to D x of the file dependent and the continuation length are obtained as follows.

The LBN is obtained from the start source packet number of D x by converting the source packet to the LBN by a calculation of bx ax 192 2048 . Similarly the LBN is obtained from the start source packet number of B x by converting the source packet to the LBN by a calculation of b ax 192 2048 . In these calculations 192 represents the number of bytes that is the source packet size. 2048 represents the number of bytes that is the sector size logical block size . The LBN of the Extent of the stereoscopic interleaved stream file that is closest to each of these LBNs is calculated by assigning the LBN obtained by the above described conversion to file offset being an argument of the function SSIF LBN file offset . The function SSIF LBN is a function that traces allocation descriptors of SSIF from the file offset and returns an LBN corresponding to the file offset.

Through these calculations the start LBN of EXT2 x is represented as SSIF LBN bx ax 192 2048 and the start LBN of EXT1 x is represented as SSIF LBN b ax 192 2048 .

On the other hand the continuation length of EXT2 x is represented as SSIF LBN b ax 192 2048 SSIF LBN bx ax 192 2048 and the continuation length of EXT1 x is represented as SSIF LBN b a 192 2048 SSIF LBN b ax 192 2048 . It is possible to obtain the file base and the file dependent virtually by generating on the memory a file entry that indicates these LBNs and continuation lengths.

The for statement whose control variable is extent id defines base dependent view extent start address and interleaved base dependent view extent start address as many times as the number specified by number of extents units.

The base dependent view extent start address extent id indicates the start address of each Extent in the LR separate file format. The interleaved base dependent view extent start address extent id indicates the start address of each Extent in the LR in one file format. Of these the base view extent start address extent id indicates a relative address from the start of the file. The relative address is indicated in a unit of 192 bytes SPN and can support up to 768 GB with 32 bits. This is because the judgment in units of SPNs is easier since this is a search for the playback start address using EP map. This may be in a unit of 6 KB since each Extent is 6 KB align. Since 6 KB 192 bytes 32 a 5 bit shift is applicable. A structural element of the Extent start point information that represents the start address of Extent by the source packet number is referred to as SPN extent start .

The entry map header information stores information such as the PIDs of video stream indicated by the entry maps and values of entry points.

The Extent start type indicates which of an Extent constituting the left view video stream and an Extent constituting the right view video stream is disposed first.

The entry map for PID 0x1011 entry map for PID 0x1012 entry map for PID 0x1220 and entry map for PID 0x1221 are entry maps for each PES stream constituted from a plurality of types of source packets. Each entry map includes entry points each of which is composed of a pair of PTS and SPN values. Also and identification number of the entry point is called an entry point ID hereinafter referred to as EP ID where the EP ID of the first entry point is 0 and after this the EP ID for each entry point in the serial order is incremented by 1 . By using the entry maps the playback device can identify a source packet position corresponding to an arbitrary position on the time axis of the video stream. For example when a special playback such as a fast forward or rewinding is to be performed I pictures registered in the entry maps can be identified selected and played back. This makes it possible to process efficiently without analyzing the AV clip. Also the entry maps are created for each video stream which is multiplexed in the AV clip and are managed by the PIDs.

The lead line eh indicates the close up of the internal structure of the entry map for PID 0x1011. The entry map for PID 0x1011 includes entry points corresponding to EP ID 0 EP ID 1 EP ID 2 and EP ID 3. The entry point corresponding to EP ID 0 indicates a correspondence among the is angle change flag having been set to ON SPN 3 and PTS 80000. The entry point corresponding to EP ID 1 indicates a correspondence among the is angle change flag having been set to OFF SPN 1500 and PTS 270000.

The entry point corresponding to EP ID 2 indicates a correspondence among the is angle change flag having been set to OFF SPN 3200 and PTS 360000. The entry point corresponding to EP ID 3 indicates a correspondence among the is angle change flag having been set to OFF SPN 4800 and PTS 450000. Here the is angle change flag indicates whether or not it is possible to decode independent of the entry point itself. When the video stream has been encoded by the MVC or MPEG 4 AVC and an IDR picture exists in the entry point this flag is set to ON . When a Non IDR picture exists in the entry point this flag is set to OFF .

The entry point corresponding to EP ID 2 indicates SPN 3200 and this source packet number is associated with PTS 360000. The entry point corresponding to EP ID 3 indicates SPN 4800 and this source packet number is associated with PTS 450000.

As indicated by the lead line ah the stream attribute information includes stream attribute information of the left view video stream constituted from the TS packet having packet ID 0x1011 stream attribute information of the right view video stream constituted from the TS packet having packet ID 0x1012 stream attribute information of the audio stream constituted from the TS packets having packet IDs 0x1100 and 0x1101 and stream attribute information of the PG stream constituted from the TS packets having packet IDs 0x1220 and 0x1221 . As understood from this the stream attribute information indicates what attributes the PES streams have where the PES streams are constituted from a plurality of types of source packets. As indicated by the lead line ah attribute information of each stream included in the AV clip is registered for each PID.

By using the entry maps the playback device can identify the source packet corresponding to an arbitrary position on the time axis of the video stream. For example when a special playback such as a fast forward or rewinding is to be performed I pictures registered in the entry maps can be identified selected and played back. This makes it possible to process efficiently without analyzing the AV clip.

Also in the third row Extent start point i in the clip dependent information and Extent start point j in the clip base information indicate the start source packet numbers of Extents constituting the dependent view video stream and the base view video stream in the fourth row respectively.

With this structure it is possible to extract only the source packet sequence constituting the base view video stream by reading the source packet indicated by the Extent start point i in the clip dependent information through a source packet immediately before the source packet indicated by the Extent start point j in the clip base information.

It is also possible to extract only the source packet sequence constituting the base view video stream by reading the source packet indicated by the Extent start point j in the clip base information through a source packet immediately before the source packet indicated by the Extent start point i 1 in the clip dependent information.

Further it is possible to restore the ATC sequence that constitutes the base view video stream by combining the source packets constituting the base view video stream and it is possible to restore the ATC sequence that constitutes the dependent view video stream by combining the source packets constituting the dependent view video stream.

The fourth row of shows a plurality of data blocks that constitute the stereoscopic interleaved stream file. The third row shows the source packet sequence multiplexed in the main TS and the sub TS.

The second row shows a set of STC sequence constituting the dependent view an entry map and ATC sequence constituting the dependent view. The first row shows a set of STC sequence constituting the dependent view an entry map and ATC sequence constituting the dependent view. The arrows extending from the third row to the first and the second rows schematically show that the ATC sequences and are restored from the data blocks of the two TSs main TS and sub TS interleaved in the stereoscopic interleaved stream file. These ATC sequences are associated with the STC sequences by the entry map in the clip information.

This completes the description of the recording medium in the present embodiment. The following describes the playback device in detail.

The playback device in the present embodiment has a structure in which the reading unit receives inputs of source packets from two recording mediums. For this purpose the reading unit includes two drives and two read buffers. The two drives are used to access the two recording mediums respectively. The two read buffers are used to temporarily store the source packets input from the two drives and output them to the decoder. An ATC sequence restoring unit is provided between the two drives and the two read buffers. The ATC sequence restoring unit separates the ATC sequence constituting the base view stream and the ATC sequence constituting the dependent view stream from the source packets in the interleaved stream file read from one recording medium and writes the two ATC sequences into the two read buffers respectively. With this structure the playback device can process the ATC sequence constituting the base view video stream and the ATC sequence constituting the dependent view video stream as if they have been read from different recording mediums respectively. shows the internal structure of the reading unit provided with the ATC sequence restoring unit. As described above the ATC sequence restoring unit is provided between the two drives and the two read buffers. The arrow B symbolically indicates the input of the source packet from one drive. The arrow B schematically indicates the writing of the ATC sequence constituting the base view video stream. The arrow D schematically indicates the writing of the ATC sequence constituting the dependent view video stream.

In step S the ATC sequence for base view is set as the ATC sequence and the ATC sequence for dependent view is set as the ATC sequence . In step S the variable x is initialized to 1 . The variable x specifies a base view data block and a dependent view data block. After this the control enters a loop in which steps S through S are repeatedly performed as follows.

It is judged whether or not a source packet number bx specified by the variable x is equal to a source packet number bn specified by the last numeral n of the base view data block step S . When the result of the judgment is in the negative No in step S the source packets from the source packet bx ax which is specified by the source packet number bx ax to the source packet immediately before the source packet b ax specified by the source packet number b ax are added into the ATC sequence step S . Then the source packets from the source packet bx 1 ax to the source packet immediately before the source packet bx 1 ax 1 are added into the ATC sequence step S . And then the variable x in incremented step S . These steps are repeated until it is judged Yes in step S.

When it is judged Yes in step S as many source packets as the number specified by number of source packet starting from the source packet number bn are added into the ATC sequence step S . And as many source packets as the number specified by number of source packet starting from the source packet number an are added into the ATC sequence step S .

After the ATC sequences and are restored through the above described steps the file base is virtually opened by generating in the memory the file entry that indicates the start LBN of the base view data block and the continuation length step S . Similarly the file dependent is virtually opened by generating in the memory the file entry that indicates the start LBN of the dependent view data block and the continuation length step S .

When a random access from an arbitrary time point is to be performed a sector search within a stream file needs to be performed. The sector search is a process for identifying a source packet number of a source packet corresponding to the arbitrary time point and reading a file from a sector that contains a source packet of the source packet number.

Since the size of one Extent constituting the stereoscopic interleaved stream file is large the sector search requires a wide range of searching. In that case when a random access from an arbitrary time point is performed it may take a long time to identify the reading target sector.

This is because in the interleaved stream file data blocks constituting the base view video stream and the dependent view video stream are disposed in the interleaved manner to constitute one long Extent and the allocation descriptor of the file entry of the interleaved stream file merely indicates the start address of the long Extent.

In contrast the file base is composed of a plurality of short Extents and the start address of each Extent is written in the allocation descriptor. As a result the sector search requires a narrow range of searching. Thus when a random access from an arbitrary time point is performed the reading target sector can be identified in a short time.

That is to say since the data blocks constituting the base view video stream are managed as Extents of the file base and the start address of the data block is written in the allocation descriptor in the file entry corresponding to the file base it is possible to quickly reach the sector including the source packet at the target random access position by starting the sector search from the start address of the Extent that contains the target random access position.

With the above described structure in which the data blocks constituting the base view video stream are managed as Extents of the file base and the start address of each Extent and the continuation length are written in the allocation descriptor in the file entry corresponding to the file base it is possible to perform a random access from an arbitrary time point in the base view video stream at a high speed.

More specifically the sector search is performed as follows. First the entry map corresponding to the base view video stream is used to detect a source packet number that is the random access position corresponding to the arbitrary time point.

Next the Extent start point information in the clip information corresponding to the base view video stream is used to detect an Extent that contains the source packet number that is the random access position.

Further the allocation descriptor in the file entry corresponding to the file base is referenced to identify the start sector address of the Extent that contains the source packet number that is the random access position. Then a file read is performed by setting a file pointer to the start sector address and a packet analysis is executed onto the read source packet to identify the source packet with the source packet number that is the random access position. Then the identified source packet is read. With this procedure the random access to the main TS is executed efficiently. This also applies to the sub TS.

As described above according to the present embodiment Extents of the base view video stream and the dependent view video stream in the interleaved stream file are supplied to the demultiplexing unit and the decoder after they are rearranged based on the Extent start point information. Thus the decoder and program can treat as the files virtually existing on the recording medium the file base storing the base view video stream and the file dependent storing the dependent view video stream.

In this structure the base view video stream and the dependent view video stream for the stereoscopic viewing are recorded on the recording medium while the base view video stream and the dependent view video stream can be accessed separately. With this structure the processing efficiency of the playback device is improved.

It should be noted here that while the Extent start point information can indicate the start of Extent in a unit of byte it is preferable that the start of Extent is indicated in a unit of a fixed length when Extents are aligned with reading blocks with a fixed length such as the ECC blocks. This restricts the amount of information that is required for identifying the addresses.

The present embodiment explains about the demultiplexing unit decoder and hardware scale of the plane memory.

The demultiplexing unit of the present embodiment includes as many pairs of a source depacketizer and a PID filter as the number of stream input lines.

As shown in the demultiplexing unit includes a source depacketizer a PID filter a source depacketizer and a PID filter .

The source depacketizer in the state where a source packet is stored in a read buffer in the instant when the value of the ATC generated by the ATC counter and the value of the ATS of the source packet stored in the read buffer become identical transfers only the source packet TS packet to the PID filter in accordance with the recording rate of the AV clip. In the transfer the input time to the decoder is adjusted in accordance with the ATS of each source packet.

The PID filter outputs among the TS packets output from the source depacketizer TS packets whose PIDs match the PIDs required for the playback to the decoders according to the PIDs.

The source depacketizer in the state where a source packet is stored in a read buffer in the instant when the value of the ATC generated by the ATC counter and the value of the ATS of the source packet stored in the read buffer become identical transfers only the source packet TS packet to the PID filter in accordance with the system rate of the AV clip. In the transfer the input time to the decoder is adjusted in accordance with the ATS of each source packet.

The PID filter outputs among the TS packets output from the source depacketizer TS packets whose PIDs match the PIDs required for the playback to the decoders according to the PIDs.

The Transport Buffer TB is a buffer for temporarily storing a TS packet containing the left view video stream as it is after being output from the PID filter .

The Multiplexed Buffer MB is a buffer for temporarily storing a PES packet when the video stream is output from the TB to the EB. When the data is transferred from the TB to the MB the TS header is removed from the TS packet.

The Elementary Buffer EB is a buffer for storing the video access unit in the encoded state. When the data is transferred from the MB to the EB the PES header is removed.

The Transport Buffer TB is a buffer for temporarily storing a TS packet containing the right view video stream as it is after being output from the PID filter.

The Multiplexed Buffer MB is a buffer for temporarily storing a PES packet when the video stream is output from the TB to the EB. When the data is transferred from the TB to the MB the TS header is removed from the TS packet.

The Elementary Buffer EB is a buffer for storing the video access unit in the encoded state. When the data is transferred from the MB to the EB the PES header is removed.

The decoder core generates a frame field image by decoding each access unit constituting the video stream at predetermined decoding times DTSs . Since there are a plurality of compress encoding methods such as MPEG2 MPEG4 AVC and VC1 that can be used to compress encode the video stream that is to be multiplexed into the AV clip the decoding method of the decoder core is selected in accordance with the stream attribute. When it decodes the picture data constituting the base view video stream the decoder core performs a motion compensation using the picture data which exist in the future and past directions as reference pictures. When it decodes each picture data constituting the dependent view video stream the decoder core performs a motion compensation using the picture data which constitute the base view video stream as reference pictures. After the picture data are decoded in this way the decoder core transfers the decoded frame field image to the DPB and transfers the corresponding frame field image to the picture switch at the timing of the display time PTS .

The buffer switch determines from which of the EB and the EB the next access unit should be extracted by using the decode switch information that was obtained when the decoder core decoded the video access units and transfers a picture from either the EB or the EB to the decoder core at the timing of the decoding time DTS assigned to the video access unit. Since the DTSs of the left view video stream and the right view video stream are set to arrive alternately in units of pictures on the time axis it is preferable that the video access units are transferred to the decoder core in units of pictures when decoding is performed ahead of schedule disregarding the DTSs.

The Decoded Picture Buffer DPB is a buffer for temporarily storing the decoded frame field image. The DPB is used by the video decoder to refer to the decoded pictures when the video decoder decodes a video access unit such as the P picture or the B picture having been encoded by the inter picture prediction encoding.

The picture switch when the decoded frame field image transferred from the video decoder is to be written into a video plane switches the writing destination between the left view video plane and the right view video plane. When the left view stream is targeted non compressed picture data is written into the left view video plane in a moment and when the right view stream is targeted non compressed picture data is written into the right view video plane in a moment.

The operation of the video decoder in the mode switching is described. In the LR method the 2D image is displayed when the mode is switched to the mode in which only the left view images are output. In the depth method the 2D image is displayed when the processing of the depth information is stopped and the depth information is not added. Note that the LR method and the depth method require different data. Thus when switching between them is performed the streams to be decoded need to be re selected.

The determination of whether the device is to be provided with one decoder or two decoders or one plane or two planes is made based on the combination of the stream type and the stereoscopic method.

When the 3D LR method is adopted and the playback target is an MVC video stream the playback device is provided with one decoder and two planes.

When the 3D Depth method is adopted the playback device is provided with one decoder and two planes and a parallax image generator is required. This also applies to the primary video stream and the secondary video stream.

The reason that the playback device has one decoder when the MVC video stream is played back is that non compressed left view and right view picture data are used as reference images to realize the motion compensation for the macro blocks of each piece of compressed picture data. The non compressed left view and right view picture data to be used as reference images are stored in a decoded picture buffer.

For the PG stream the playback device is provided with one decoder and one plane when the 1 plane offset method is adopted and the playback device is provided with two decoders and two planes when the 3D LR method or the 3D Depth method is adopted.

For the IG stream the playback device is provided with one decoder and one plane when the 1 plane offset method is adopted and the playback device is provided with two decoders and two planes when the 3D LR method is adopted.

For the text subtitle stream for which the 3D LR method cannot be adopted the playback device is provided with one decoder and one plane when the 1 plane offset method is adopted and the playback device is provided with one decoder and two planes when the 3D Depth method is adopted.

Next the internal structure of the PG stream and the internal structure of the PG decoder for decoding the PG stream will be described.

Each of the left view PG stream and the right view PG stream includes a plurality of display sets. The display set is a set of functional segments that constitute one screen display. The functional segments are processing units that are supplied to the decoder while they are stored in the payloads of the PES packets which each have the size of approximately 2 KB and are subjected to the playback control with use of the DTSs and PTSs.

The epoch start display set is a set of functional segments that start the memory management by resetting the composition buffer code data buffer and graphics plane in the graphics decoder. The epoch start display set includes all functional segments required for composition of the screen.

The normal case display set is a display set that performs the composition of the screen while continuing the memory management of the composition buffer code data buffer and graphics plane in the graphics decoder. The normal case display set includes functional segments that are differentials from the preceding display set.

The acquisition point display set is a display set that includes all functional segments required for composition of the screen but does not reset the memory management of the composition buffer code data buffer and graphics plane in the graphics decoder. The acquisition point display set may include functional segments that are different from those in the previous display set.

The epoch continue display set is a display set that continues the memory management of the composition buffer code data buffer and graphics plane in the playback device as it is when the connection between a playitem permitting the playback of the PG stream and a playitem immediately before the playitem is the seamless connection CC 5 that evolves a clean break. In this case the graphics objects obtained in the object buffer and the graphics plane are kept to be present in the object buffer and the graphics plane without being discarded.

Certain time points on the playback time axis of the STC sequence are assigned to the start point and end point of these display sets and the same times are assigned to the left view and to the right view. Also for the left view PG stream and the right view PG stream the types of the display sets that are present on the same time point on the time axis are the same. That is to say when the display set on the left view side is the epoch start display set the display set on the right view side that is at the same time point on the time axis of the STC sequence is the epoch start display set.

Further when the display set on the left view side is the acquisition point display set the display set on the right view side that is at the same time point on the time axis of the STC sequence is the acquisition point display set.

Each display set includes a plurality of functional segments. The plurality of functional segments include the following.

The object definition segment is a functional segment for defining the graphics object. The object definition segment defines the graphics object by using a code value and a run length of the code value.

The pallet definition segment includes pallet data that indicates correspondence among each code value brightness and red color difference blue color difference. The same correspondence among the code value brightness and color difference is set in both the pallet definition segment of the left view graphics stream and the pallet definition segment of the right view graphics stream.

The window definition segment is a functional segment for defining a rectangular frame called window in the plane memory that is used to extend the non compressed graphics object onto the screen. The drawing of the graphics object is restricted to the inside of the plane memory and the drawing of the graphics object is not performed outside the window.

Since a part of the plane memory is specified as the window for displaying the graphics the playback device does not need to perform the drawing of the graphics for the entire plane. That is to say the playback device only needs to perform the graphics drawing onto the window that has a limited size. The drawing of the part of the plane for display other than the window can be omitted. This reduces the load of the software on the playback device side.

The screen composition segment is a functional segment for defining the screen composition using the graphics object and includes a plurality of control items for the composition controller in the graphics decoder. The screen composition segment is a functional segment that defines in detail the display set of the graphics stream and defines the screen composition using the graphics object. The screen composition falls into the types such as Cut In Out Fade In Out Color Change Scroll and Wipe In Out. With use of the screen composition defined by the screen composition segment it is possible to realize display effects such as deleting a subtitle gradually while displaying the next subtitle.

The end segment is a functional segment that is located at the end of a plurality of functional segments belonging to one display set. The playback device recognizes a series of segments from the screen composition segment to the end segment as the functional segments that constitute one display set.

In the PG stream the start time point of the display set is identified by the DTS of the PES packet storing the screen composition segment and the end time point of the display set is identified by the PTS of the PES packet storing the screen composition segment.

The left view graphics stream and the right view graphics stream are packetized elementary streams PES . The screen composition segment is stored in the PES packet. The PTS of the PES packet storing the screen composition segment indicates the time when the display by the display set to which the screen composition segment belongs should be executed.

The value of the PTS of the PES packet storing the screen composition segment is the same for both the left view video stream and the right view video stream.

The PG decoder includes a coded data buffer for storing functional segments read from the PG stream a stream graphics processor for obtaining a graphics object by decoding the screen composition segment an object buffer for storing the graphics object obtained by the decoding a composition buffer for storing the screen composition segment and a composition controller for decoding the screen composition segment stored in the composition buffer and performing a screen composition on the graphics plane by using the graphics object stored in the object buffer based on the control items included in the screen composition segment.

A transport buffer for adjusting the input speed of the TS packets constituting the functional segments is provided at a location before the graphics plane.

Also at locations after the graphics decoder a graphics plane a CLUT unit for converting the pixel codes constituting the graphics object stored in the graphics plane into values of brightness color difference based on the pallet definition segment and a shift unit for the plane shift are provided.

The pipeline in the PG stream makes it possible to simultaneously executes the following processes the process in which the graphics decoder decodes an object definition segment belonging to a certain display set and writes the graphics object into the graphics buffer and the process in which a graphics object obtained by decoding an object definition segment belonging to a preceding display set is written from the object buffer to the plane memory.

In the graphics decoder itself is represented by a frame drawn by the solid line and a portion that follows the graphics decoder is represented by a frame drawn by the chain line.

The offset sequence is contained in the dependent view video stream. Thus in the plane offset format one graphics decoder is provided and the output from the graphics decoder is supplied to the left view and the right view by switching therebetween.

1. The mutual switching between the 1 plane offset mode and the 2D mode is performed seamlessly. This is realized by invalidating the Offset .

2. When switching between the 3D LR mode and the 2D mode is performed the display of the subtitle temporarily disappears because the switching between the modes requires switching between PIDs. This is the same as the switching between streams.

3. When switching between the 3D LR mode and the L mode is performed switching is made to the display of only L base view side . The seamless switching is possible but there is a possibility that the display position may be shifted.

When switching between the 3D depth mode and the 2D mode is performed it is possible to switch between graphics objects seamlessly by in the background while the 2D is displayed generating the left view and right view graphics objects in advance by decoding the depth information indicated by grayscale.

When the switching is executed by the PG decoder switching from the depth mode or the 1 plane offset to the 2D mode is easy. However in the case of the 3D LR method the graphics objects for the stereoscopic viewing and the 2D are different from each other. Thus the PG stream that is processed when the switching is to be made needs to be changed and there is a possibility that the graphics object is not displayed until the next PG stream is supplied.

To prevent the provision of a period in which the graphics object is not displayed switching to only the base view graphics object not to the front view 2D graphics object is available. In this case an image slightly shifted to the left may be displayed. Also the management data may be set to indicate which method should be used when the stereoscopic PG is switched to the 2D PG.

The text subtitle decoder includes a subtitle processor for separating the text code and the control information from the subtitle description data a management information buffer for storing the text code separated from the subtitle description data a text render for extending the text code in the management information buffer to the bit map by using the font data an object buffer for storing the bit map obtained by the extension and a drawing control unit for controlling the text subtitle playback along the time axis by using the control information separated from the subtitle description data.

The text subtitle decoder is preceded by a font preload buffer for preloading the font data a TS buffer for adjusting the input speed of the TS packets constituting the text subtitle stream and a subtitle preload buffer for preloading the text subtitle stream before the playback of the playitem.

The graphics decoder is followed by a graphics plane a CLUT unit for converting the pixel codes constituting the graphics object stored in the graphics plane into values of brightness and color difference based on the pallet definition segment and a shift unit for the plane shift.

The text subtitle stream differs from the PG stream as follows. That is to say the font data and the character code are sent not the graphics data is sent as the bit map so that the rendering engine generates the subtitle. Thus the stereoscopic viewing of the subtitle is realized in the 1 plane offset mode. When the text subtitle is displayed in the 1 plane offset mode switching between modes is made by switching between font sets or switching between rendering methods. There is also known a method for switching between modes by defining the L R font set or the OpenGL font set. It is also possible for the rendering engine to perform the 3D display.

In the 3D LR mode the stereoscopic playback is realized by defining the font set and the OpenGL font set for the base view independently of the font set and the OpenGL font set for the dependent view. It is also possible for the rendering engine to render the 3D font to realize the stereoscopic playback.

This completes the description of the text subtitle stream and the text subtitle decoder. Next the internal structure of the IG stream and the structure of the IG decoder will be described.

Each of the left view IG stream and the right view IG stream includes a plurality of display sets. Each display set includes a plurality of functional segments. As is the case with the PG stream the display set falls into the following types. epoch start display set normal case display set acquisition point display set and epoch continue display set.

The object definition segment of the IG stream is the same as that of the PG stream. However the graphics object of the IG stream defines the in effect and out effect of pages the normal selected and active states of the button members. The object definition segments are grouped into those that define the same state of the button members and those that constitute the same effect image. The group of object definition segments defining the same state is called graphics data set .

The interactive control segment includes a plurality of pieces of page information. The page information is information that defines a screen composition of the multi page menu. Each piece of page information includes an effect sequence a plurality of pieces of button information and a reference value of a pallet identifier.

The button information is information that realizes an interactive screen composition on each page constituting the multi page menu by displaying the graphics object as one state of a button member.

The effect sequence constitutes the in effect or the out effect with use of the graphics object and includes effect information where the in effect is played back before a page corresponding to the page information is displayed and the out effect is played back after the page is displayed.

The effect information is information that defines each screen composition for playing back the in effect or the out effect. The effect information includes a screen composition object that defines a screen composition to be executed in the window partial area defined by the window definition segment on the graphics plane and effect period information that indicates a time interval between the current screen and the next screen in the same area.

The screen composition object in the effect sequence defines a control that is similar to the control defined by the screen composition segment of the PG stream. Among the plurality of object definition segments an object definition segment that defines the graphics object used for the in effect is disposed at a location that precedes an object definition segment that defines the graphics object used for the button member.

Each piece of button information in the page information is information that an interactive screen composition on each page constituting the multi page menu by displaying the graphics object as one state of a button member. The button information includes a set button page command that when a corresponding button member becomes active causes the playback device to perform the process of setting a page other than the first page as the current page.

To make it possible for the offset in the plane shift to be changed for each page during a playback of the IG stream a navigation command for changing the offset is incorporated into the button information and the auto activate of the navigation command is defined in the corresponding piece of button information in advance. This makes it possible to change automatically the value or direction of the offset defined in the stream registration information of the IG stream.

The end segment is a functional segment that is located at the end of a plurality of functional segments belonging to one display set. A series of segments from the interactive control segment to the end segment are recognized as the functional segments that constitute one display set.

The following are the control items of the interactive control segment that are the same for both the left view graphics stream and the right view graphics stream button adjacency information selection time out time stamp user time out duration and composition time out information.

The button adjacency information is information that specifies a button to be changed to the selected state when a key operation specifying any of upward downward leftward and rightward is performed while a certain button adjacent to the specified button is in the selected state.

The selection time out time stamp indicates a time out time that is required to automatically activate a button member in the current page and cause the playback device to execute the button member.

The user time out duration indicates a time out time that is required to return the current page to the first page so that only the first page is displayed.

The composition time out information indicates a time period that is required to end an interactive screen display by the interactive control segment. With respect to the IG stream the start time point of a display set is identified by the DTS of the PES packet storing the interactive control segment and the end time point of the display set is identified by the composition time out time of the interactive control segment. The same DTS and the same composition time out time are set for both the left view and the right view.

The IG decoder includes a coded data buffer for storing functional segments read from the IG stream a stream graphics processor for obtaining a graphics object by decoding the screen composition segment an object buffer for storing the graphics object obtained by the decoding a composition buffer for storing the screen composition segment and a composition controller for decoding the screen composition segment stored in the composition buffer and performing a screen composition on the graphics plane by using the graphics object stored in the object buffer based on the control items included in the screen composition segment.

A transport buffer for adjusting the input speed of the TS packets constituting the functional segments is provided at a location before the graphics plane.

Also at locations after the graphics decoder a graphics plane a CLUT unit for converting the pixel codes constituting the graphics object stored in the graphics plane into values of brightness color difference based on the pallet definition segment and a shift unit for the plane shift are provided.

These decoders include a circuit for reflecting values of system parameters onto the offsets so that the program can control the depth information of the menu graphics.

The composition controller in the graphics decoder realizes the initial display of the interactive screen by displaying the current button among a plurality of button members in the interactive screen by using the graphics data of the graphics data set corresponding to the selected state and displaying the remaining buttons by using the graphics data set corresponding to the normal state.

When a user operation specifying any of upward downward leftward and rightward is performed it writes into the button number register a number of a button member that is present in the direction specified by the user operation among a plurality of button members in the normal state and adjacent to the current button the writing causing the button member having become newly the current button to change from the normal state to the selected state.

In the interactive screen when a user operation for changing the button member from the selected state to the active state is performed the interactive screen is updated by extracting the graphics data constituting the active state from the graphics data set and displaying the extracted graphics data.

The update of the interactive screen should be executed in common to the left view and the right view. Thus it is preferable that the left view graphics decoder and the right view graphics decoder have in common a composition controller for the two decoder model.

In the above described case the inter changing is realized by using the same navigation command for both the left view and the right view of the stereoscopic IG stream and setting the same button structure for both the 3D graphics object and the 2D graphics object.

When switching between the 2D IG stream and the stereoscopic IG stream it is possible to change only the displayed graphics object when the attribute and number and the like of the navigation command and button information are the same for both. Switching from the 3D LR mode to the display of only the L image can be made without reloading but there is a possibility that the display position may be shifted. It is preferable that the playback device performs the switching based on a flag set to indicate which is adopted by the title producer.

This completes the description of the IG stream and the IG decoder. Next the plane memory will be described in detail.

The layer overlaying in the plane memory is achieved by executing a superimposing process onto all combinations of the layers in the layer model. In the superimposing process pixel values of pixel data stored in the plane memories of the two layers are superimposed. The layer overlaying by the layer overlay unit is achieved by executing a superimposing process onto all combinations of two layers among the layers in the layer model. In the superimposing process pixel values of pixel data stored in the plane memories of the two layers are superimposed in the layer model of the plane memory.

The superimposing between layers is performed as follows. A transmittance as a weight is multiplied by a pixel value in unit of a line in the plane memory of a certain layer and a weight of 1 transmittance is multiplied by a pixel value in unit of a line in the plane memory of a layer below the certain layer. The pixel values with these brightness weights are added together. The resultant pixel value is set as a pixel value in unit of a line in the layer. The layer overlaying is realized by repeating this superimposing between layers for each pair of corresponding pixels in a unit of a line in adjacent layers in the layer model.

A multiplication unit for multiplying each pixel value by the transmittance to realize the layer overlaying an addition unit for adding up the pixels and a scaling positioning unit for performing the scaling and positioning of the secondary video are provided at locations after the plane memory as well as the above described CLUT unit shift unit and the like.

With the plane memory structure for the 3D LR method which is provided with two pairs of a layer model and a portion following the plane memory two pairs of the primary video plane secondary video plane PG plane and IG plane are provided for the left view and the right view and the outputs from each plane memory are overlaid as the layer overlaying separately for the left view and the right view.

The secondary video plane as is the case with the primary video plane can be displayed in the 3D LR mode or in the 3D depth mode. Also with the PG stream it is possible to display a monoscopic image to pop up in front of the background by assigning an offset to the 2D image.

In the layer model composed of the primary video plane for the left view primary video plane for the right view secondary video plane PG plane and IG plane is represented by a frame drawn by the solid line and a portion that follows the plane memory is represented by a frame drawn by the chain line. As shown in there is only one above described layer model. Also there are two portions following the plane memory.

In the 1 plane offset mode method the primary video planes are provided one for each of the left view and the right view. The secondary video plane PG plane and IG plane are provided one for both the left view and the right view. There is only one plane memory for both the left view and the right view. With this structure the above described layer overlaying is performed onto the left view and right view outputs.

The playback device basically has the hardware structure including two decoders and two planes since it is required to support both the B D presentation mode and the 1 plane offset mode. When the mode switches to the 1 plane offset mode or the 2D playback mode the playback device has the 1 decoder 1 plane structure invalidating one of the two pairs of 1 decoder 1 plane .

When the mode switches from the 3D playback mode to the 2D playback mode and the structure of the playback device changes from the 2 decoders 2 planes structure to the 1 decoder 1 plane structure the target of the demultiplexing becomes only the TS packets constituting the L image. And the user having been viewing both the L and R images via the 3D glasses comes to view only the L image as soon as the mode switches from the 3D playback mode to the 2D playback mode.

This change from the viewing by two eyes to the viewing by one eye increases the burden of the eye and the user may catch a chill. In view of this in the present embodiment when such a change occurs the target of the PID filter is changed from the TS packets constituting the L and R images to the TS packets constituting the L image and the memory management in the graphics decoder is reset. In this changing the subtitle is temporarily deleted to prevent the user from catching a chill.

As described above according to the present embodiment the subtitle in the plane memory is temporarily reset when the decoder structure is switched from the 2 decoder structure to the 1 decoder structure. This lessens the burden of the eye that is caused when the viewing of the user changes from the viewing by two eyes to the viewing by one eye.

The present embodiment describes the production of the recording mediums described in the embodiments so far namely the production act of the recording medium.

Each of the recording mediums described in the embodiments so far can be produced as a BD ROM disc that is a multi layered optical disc a BD RE disc having compatibility with the BD ROM disc a BD R disc or an AVC HD medium.

The first row of shows a BD ROM being a multi layered optical disc. The second row shows tracks in the horizontally extended format though they are in reality formed spirally in the recording layers. These spiral tracks in the recording layers are treated as one continuous volume area. The volume area is composed of a lead in area recording layers of recording layers through and a lead out area where the lead in area is located at the inner circumference the lead out area is located at the outer circumference and the recording layers of recording layers through are located between the lead in area and the lead out area. The recording layers of recording layers through constitute one consecutive logical address space.

The volume area is sectioned into units in which the optical disc can be accessed and serial numbers are assigned to the access units. The serial numbers are called logical addresses. A data reading from the optical disc is performed by specifying a logical address. Here in the case of a read only disc such as the BD ROM basically sectors with consecutive logical addresses are also consecutive in the physical disposition on the optical disc. That is to say data stored in the sectors with consecutive logical addresses can be read without performing a seek operation. However at the boundaries between recording layers consecutive data reading is not possible even if the logical addresses are consecutive. It is thus presumed that the logical addresses of the boundaries between recording layers are registered in the recording device preliminarily.

In the volume area file system management information is recorded immediately after the lead in area. Following this a partition area managed by the file system management information exists. The file system is a system that expresses data on the disc in units called directories and files. In the case of the BD ROM the file system is a UDF Universal Disc Format . Even in the case of an everyday PC personal computer when data is recorded with a file system called FAT or NTFS the data recorded on the hard disk under directories and files can be used on the computer thus improving usability. The file system makes it possible to read logical data in the same manner as in an ordinary PC using a directory and file structure.

The fourth row shows how the areas in the file system area managed by the file system are assigned. As shown in the fourth row a non AV data recording area exists on the innermost circumference side in the file system area and an AV data recording area exists immediately following the non AV data recording area. The fifth row shows the contents recorded in the non AV data recording area and the AV data recording area. As shown in the fifth row Extents constituting the AV files are recorded in the AV data recording area and Extents constituting non AV files which are files other than the AV files are recorded in the non AV data recording area.

The BDMV directory is a directory in which data such as AV content and management information used in the BD ROM are recorded. Five sub directories called PLAYLIST directory CLIPINF directory STREAM directory BDJO directory JAR directory and META directory exist below the BDMV directory. Also two types of files i.e. index.bdmv and MovieObject.bdmv are arranged under the BDMV directory.

A file MovieObject.bdmv the file name MovieObject.bdmv is fixed stores one or more movie objects. The movie object is a program file that defines a control procedure to be performed by the playback device in the operation mode HDMV mode in which the control subject is a command interpreter. The movie object includes one or more commands and a mask flag where the mask flag defines whether or not to mask a menu call or a title call when the call is performed by the user onto the GUI.

A program file XXXXX.bdjo XXXXX is variable and the extension bdjo is fixed to which an extension bdjo is given exists in the BDJO directory. The program file stores a BD J object that defines a control procedure to be performed by the playback device in the BD J mode. The BD J object includes an application management table . The application management table in the BD J object is a table that is used to cause the playback device to perform an application signaling with the title being regarded as the life cycle. The application management table includes an application identifier and a control code where the application identifier indicates an application to be executed when a title corresponding to the BD J object becomes a current title. BD J applications whose life cycles are defined by the application management table are especially called BD J applications . The control code when it is set to AutoRun indicates that the application should be loaded onto the heap memory and be activated automatically and when it is set to Present indicates that the application should be loaded onto the heap memory and be activated after a call from another application is received. On the other hand some BD J applications do not end their operations even if the title is ended. Such BD J applications are called title unboundary applications .

A substance of such a Java application is a Java archive file YYYYY.jar stored in the JAR directory under the BDMV directory.

An application may be for example a Java application that is composed of one or more xlet programs having been loaded into a heap memory also called work memory of a virtual machine. The application is constituted from the xlet programs having been loaded into the work memory and data.

In the PLAYLIST directory a playlist information file xxxxx.mpls XXXXX is variable and the extension mpls is fixed to which an extension mpls is given exists.

In the CLIPINF directory a clip information file xxxxx.clpi XXXXX is variable and the extension clpi is fixed to which an extension clpi is given exists.

The Extents constituting the files existing in the directories explained up to now are recorded in the non AV data area.

The STREAM directory is a directory storing a transport stream file. In the STREAM directory a transport stream file xxxxx.m2ts XXXXX is variable and the extension m2ts is fixed to which an extension m2ts is given exists.

The above described files are formed on a plurality of sectors that are physically continuous in the partition area. The partition area is an area accessed by the file system and includes an area in which file set descriptor is recorded area in which end descriptor is recorded ROOT directory area BDMV directory area JAR directory area BDJO directory area PLAYLIST directory area CLIPINF directory area and STREAM directory area . The following explains these areas.

The file set descriptor includes a logical block number LBN that indicates a sector in which the file entry of the ROOT directory is recorded among directory areas. The end descriptor indicates an end of the file set descriptor.

Next is a detailed description of the directory areas. The above described directory areas have an internal structure in common. That is to say each of the directory areas is composed of a file entry directory file and file recording area of lower file .

The allocation descriptor includes a logical block number LBN that indicates a recording position of the directory file. Up to now the file entry has been described. Next is a detailed description of the directory file.

The directory file includes a file identification descriptor of lower directory and file identification descriptor of lower file .

The file identification descriptor of lower directory is information that is referenced to access a lower directory that belongs to the directory file itself and is composed of identification information of the lower directory the length of the directory name of the lower directory a file entry address that indicates the logical block number of the block in which the file entry of the lower directory is recorded and the directory name of the lower directory.

The file identification descriptor of lower file is information that is referenced to access a file that belongs to the directory file itself and is composed of identification information of the lower file the length of the lower file name a file entry address that indicates the logical block number of the block in which the file entry of the lower file is recorded and the file name of the lower file.

The file identification descriptors of the directory files of the directories indicate the logical blocks in which the file entries of the lower directory and the lower file are recorded. By tracing the file identification descriptors it is therefore possible to reach from the file entry of the ROOT directory to the file entry of the BDMV directory and reach from the file entry of the BDMV directory to the file entry of the PLAYLIST directory. Similarly it is possible to reach the file entries of the JAR directory BDJO directory CLIPINF directory and STREAM directory.

The file recording area of lower file is an area in which the substance of the lower file that belongs to a directory. A file entry of the lower entry and one or more Extents are recorded in the file recording area of lower file .

The stream file that constitutes the main feature of the present application is a file recording area that exists in the directory area of the directory to which the file belongs. It is possible to access the transport stream file by tracing the file identification descriptors of the directory files and the allocation descriptors of the file entries.

Up to now the internal structure of the recording medium has been described. The following describes how to generate the recording medium shown in namely a form of a recording method.

The recording method of the present embodiment includes not only the above described real time recording in which AV files and non AV files are generated in real time and are written into the AV data recording area and the non AV data recording area but also a pre format recording in which bit streams to be recorded into the volume area are generated in advance a master disc is generated based on the bit streams and the master disc is pressed thereby making possible a mass production of the optical disc. The recording method of the present embodiment is applicable to either the real time recording or the pre format recording.

When the recording method is to be realized by the real time recording technology the recording device for performing the recording method creates an AV clip in real time and stores the AV clip into the BD RE BD R hard disk or semiconductor memory card.

In this case the AV clip may be a transport stream that is obtained as the recording device encodes an analog input signal in real time or a transport stream that is obtained as the recording device partializes a digital input transport stream. The recording device for performing the real time recording includes a video encoder for obtaining a video stream by encoding a video signal an audio encoder for obtaining an audio stream by encoding an audio signal a multiplexor for obtaining a digital stream in the MPEG2 TS format by multiplexing the video stream audio stream and the like and a source packetizer for converting TS packets constituting the digital stream in the MPEG2 TS format into source packets. The recording device stores an MPEG2 digital stream having been converted into the source packet format into an AV clip file and writes the AV clip file into the BD RE BD R or the like. When the digital stream is written the control unit of the recording device performs a process of generating the clip information and the playlist information in the memory. More specifically when the user requests a recording process the control unit creates an AV clip file and an AV clip information file in the BD RE or the BD R.

After this when the starting position of GOP in the video stream is detected from the transport stream which is input from outside the device or when the GOP of the video stream is created by the encoder the control unit of the recording device obtains i the PTS of the intra picture that is positioned at the start of the GOP and ii the packet number of the source packet that stores the starting portion of the GOP and additionally writes the pair of the PTS and the packet number into the entry map of the clip information file as a pair of EP PTS entry and EP SPN entry. After this each time a GOP is generated a pair of EP PTS entry and EP SPN entry is written additionally into the entry map of the clip information file. In so doing when the starting portion of a GOP is an IDR picture an is angle change flag having been set to ON is added to a pair of EP PTS entry and EP SPN entry. Also when the starting portion of a GOP is not an IDR picture an is angle change flag having been set to OFF is added to a pair of EP PTS entry and EP SPN entry.

Further the attribute information of a stream in the clip information file is set in accordance with the attribute of the stream to be recorded. After the clip and the clip information are generated and written into the BD RE or the BD R the playlist information defining the playback path via the entry map in the clip information is generated and written into the BD RE or the BD R. When this process is executed with the real time recording technology a hierarchical structure composed of the AV clip clip information and playlist information is obtained in the BD RE or the BD R.

This completes the description of the recording device for performing the recording method by the real time recording. Next is a description of the recording device for performing the recording method by the pre format recording.

The recording method by the pre format recording is realized as a manufacturing method of an optical disc including an authoring procedure.

In the authoring step S a bit stream representing the whole volume area of the optical disc is generated.

In the signing step S a request for signature is made to the AACS LA to manufacture the optical disc. More specifically a portion is extracted from the bit stream is sent to the AACS LA. Note that the AACS LA is an organization for managing the license of the copyrighted work protection technologies for the next generation digital household electric appliances. The authoring sites and mastering sites are licensed by the AACS LA where the authoring sites perform authoring of optical discs by using authoring devices and the mastering sites execute mastering by using mastering devices. The AACS LA also manages the medium keys and invalidation information. The AACS LA signs and returns the portion of the bit stream.

In the medium key obtaining step S a medium key is obtained from the AACS LA. The medium key provided from the AACS LA is not fixed. The medium key is updated to a new one when the number of manufactured optical discs reaches a certain number. The update of the medium key makes it possible to exclude certain makers or devices and to invalidate an encryption key by using the invalidation information even if the encryption key is cracked.

In the medium key encrypting step S a key used for encrypting a bit stream is encrypted by using the medium key obtained in the medium key obtaining step.

In the identifier embedding step S an identifier which is unique and cannot be detected by ordinary devices is embedded as electronic watermark into the bit stream to be recorded on the optical disc. This prevents mass production of pirated copies by unauthorized mastering.

In the mastering step S a master disc of the optical disc is generated. First a photoresist layer is formed on the glass substrate a laser beam is radiated onto the photoresist layer in correspondence with desired grooves or pits and then the photoresist layer is subjected to the exposure process and the developing process. The grooves or pits represent values of the bits constituting the bit stream that has been subjected to the eight to sixteen modulation. After this the master disc of the optical disc is generated based on the photoresist whose surface has been made uneven by the laser cutting in correspondence with the grooves or pits.

In the replication step S copies of the optical disc are produced by a mass production by using the master disc of the optical disc.

In step S the reel sets of the main TS and sub TS are defined. A reel is a file which stores the material data of an elementary stream. In the authoring system the reels exist on a drive on a local network. The reels are data representing for example L and R images shot by a 3D camera audio recorded at the shooting audio recorded after the shooting subtitles for each language and menus. A reel set is a group of links to the material files representing a set of elementary streams to be multiplexed into one transport stream. In this example a reel set is defined for each of the main TS and the sub TS.

In step S the prototypes of playitem and sub playitem are defined and the prototypes of the main path and sub path are defined by defining a playback order of playitem and sub playitem. The prototype of the playitem can be defined by receiving via a GUI a specification of a reel that is permitted to be played back by a targeted playitem in the monoscopic playback mode and a specification of In Time and Out Time. The prototype of the sub playitem can be defined by receiving via a GUI a specification of a reel that is permitted to be played back by a playitem corresponding to a targeted sub playitem in the stereoscopic playback mode and a specification of In Time and Out Time.

For the specification of a reel to be permitted to be played back a GUI is provided to make it possible to check a check box corresponding to among the links to the material files in the reel set a link to a material file permitted to be played back. With this GUI numeral input columns are displayed in correspondence with the reels. With use of the numeral input columns the priority of each reel is received and based on this the priorities of the reels are determined. With the setting of the reels permitted to be played back and the setting of the priorities the stream selection table and the extension stream selection table are generated.

The specification of In Time and Out Time is performed when the recording device executes the process in which the time axis of the base view video stream or the dependent view video stream is displayed as a graphic on the GUI a slide bar is moved on the graphic of the time axis and specification of a positional setting of the slide bar is received from the user.

The definition of the playback order of the playitem and the sub playitem is realized by the following process a picture at In Time of the playitem is displayed as a thumbnail on the GUI and the recording device receives from the user an operation made onto the thumbnail to set the playback order.

In step S a plurality of elementary streams are obtained by encoding the material files specified by the reel sets. The plurality of elementary streams include the base view video stream and the dependent view video stream and the audio stream PG stream and IG stream that are to be multiplexed with the base view video stream and the dependent view video stream.

In step S one main TS is obtained by multiplexing thereinto the base view video stream and an elementary stream which among the elementary streams obtained by the encoding belongs to same reel set as the base view video stream.

In step S one sub TS is obtained by multiplexing thereinto the dependent view video stream and an elementary stream which among the elementary streams obtained by the encoding belongs to the same reel set as the dependent view video stream.

In step S the prototype of the clip information file is created based on the parameters having been set during the encoding and multiplexing.

In step S the playlist information is defined by generating the playitem information and the sub playitem information based on the prototype of the playitem and then generating the main path information and the sub path information by defining the playback order based on the playitem information and the sub playitem information.

In the generation of the playitem information the stream selection table is generated in the playitem information so that among the elementary streams multiplexed in the main TS elementary streams that are defined in the basic structure of the playitem to be played back in the monoscopic playback mode are set to playable . Also to define the playback section in the base view video stream the In TIme and Out TIme having been defined by the above described editing are written in the playitem information.

In the generation of the sub playitem information the extension stream selection table is generated in the extension data of the playlist information so that among the elementary streams multiplexed in the sub main TS elementary streams that are defined in the basic structure of the playitem to be played back in the stereoscopic playback mode are set to playable . The playitem information and the sub playitem information are defined based on information in the clip information file and thus are set based on the prototype of the prototype of the clip information file.

In step S the main TS sub TS prototype of the clip information file and prototype of the playlist information are converted into a directory file group in a predetermined application format.

Through the above described processes the main TS sub TS clip information playitem information and sub playitem information are generated. Then the main TS and the sub TS are converted into respective independent stream files the clip information is converted into the clip information file and the playitem information and the sub playitem information are converted into the playlist information file. In this way a set of files to be recorded onto the recording medium are obtained.

When the depths are to be calculated for each frame using the functional expression of the linear function or the parabolic function a function for obtaining a depth for each frame time from the frame time of the video stream is defined in the application program interface of the recording device. Then the frame time of the base view video stream is given to the function and the depth for each frame time is calculated. The depths calculated in this way are converted into the plane offset value and the offset direction information.

After this when the video stream encoding step is executed the plane offset value and the offset direction information obtained the above described conversion are written into the metadata of each GOP. In this way the offset sequence can be generated in the encoding process.

In step S the recording device generates the file entry in the memory of the recording device by creating xxxxx.ssif . In step S it is judged whether the continuous free sector areas have been ensured. When the continuous free sector areas have been ensured the control proceeds to step S in which the recording device writes the source packet sequence constituting the dependent view data block into the continuous free sector areas as much as EXT2 i . After this steps S through S are executed. When it is judged in step S that the continuous free sector areas have not been ensured the control proceeds to step S in which the exceptional process is performed and then the process ends.

The steps S through S constitute a loop in which the process of steps S S and S is repeated until it is judged NO in step S.

In step S the recording device writes the source packet sequence constituting the base view data block into the continuous free sector areas as much as EXT1 i . In step S it adds into the file entry the allocation descriptor that indicates the start address of the source packet sequence and continuation length and registers it as an Extent. In connection with this it writes into the clip information the Extent start point information that indicates the start source packet number thereof.

The step S defines the condition for ending the loop. In step S it is judged whether or not there is a non written source packet in the base view and dependent view data blocks. When it is judged that there is a non written source packet the control proceeds to step S to continue the loop. When it is judged that there is no non written source packet the control proceeds to step S.

In step S it is judged whether or not there are continuous sector areas. When it is judged that there are continuous sector areas the control proceeds to step S. When it is judged that there are no continuous sector areas the control returns to step S.

In step S xxxxx.ssif is closed and the file entry is written onto the recording medium. In step S xxxxx.m2ts is created and the file entry of xxxxx.m2ts is generated in the memory. In step S the allocation descriptor that indicates the continuation length and the start address of Extent of the base view data block unique to the file 2D is added into the file entry of xxxxx.m2ts . In step S xxxxx.m2ts is closed and the file entry is written.

In step S it is judged whether or not there is a long jump occurrence point in the range of EXTss EXT2D . In the present example it is presumed that the long jump occurrence point is a boundary between layers. When it is judged that there is a long jump occurrence point in the range of EXTss EXT2D the control proceeds to step S in which a copy of the base view data block is created and base view data blocks B i ss and B i 2D are written into the area immediately before the long jump occurrence point and then the control proceeds to step S. These become Extents of the file 2D and Extents of the file base.

Next is a description of the recording device to be used for the work in the authoring step. The recording device described here is used by the authoring staff in a production studio for distributing movie contents. The use form of the recording device of the present invention is as follows a digital stream and a scenario are generated in accordance with the operation by the authoring staff where the digital stream represents a movie title and is generated by compress encoding in compliance with the MPEG standard and the scenario describes how the movie title should be played a volume bit stream for BD ROM including these data is generated and the volume bit stream is recorded into a recording medium that is to be delivered to the mastering site.

The video encoder generates left view and right view video streams by encoding left view and right view non compressed bit map images in accordance with a compression method such as the MPEG4 AVC or the MPEG2. In so doing the right view video stream is generated by encoding frames that correspond to the left view video stream by the inter picture prediction encoding method. In the process of the inter picture prediction encoding the depth information for 3D image is extracted from the motion vectors of the left view and right view images and the depth information is stored into a frame depth information storage unit . The video encoder performs an image compression using the relative characteristics between pictures by extracting the motion vectors in units of macro blocks of 8 8 or 16 16.

In the process of extracting the motion vectors in units of macro blocks a moving image whose foreground is a human being and background is a house is determined as a target of extracting the motion vector. In this case an inter picture prediction is performed between a left eye image and a right eye image. With this process no motion vector is detected from the portion of the image corresponding to the house but a motion vector is detected from the portion of the image corresponding to the human being .

The detected motion vector is extracted and the depth information is generated in units of frames when the 3D image is displayed. The depth information is for example an image having the same resolution as the frame having the depth of eight bits.

The material producing unit generates streams such as an audio stream interactive graphics stream and a presentation graphics stream and writes the generated streams into an audio stream storage unit an interactive graphics stream storage unit and a presentation graphics stream storage unit

When generating an audio stream the material producing unit generates the audio stream by encoding a non compressed LinearPCM audio by a compression method such as AC3. Other than this the material producing unit generates a presentation graphics stream in a format conforming to the BD ROM standard based on the subtitle information file that includes a subtitle image a display timing and subtitle effects such as fade in and fade out. Also the material producing unit generates an interactive graphics stream in a format for the menu screen conforming to the BD ROM standard based on the menu file that describes bit map images transition of the buttons arranged on the menu and the display effects.

The scenario generating unit generates a scenario in the BD ROM format in accordance with the information of each stream generated by the material producing unit and the operation input by the authoring staff via the GUI. Here the scenario means a file such as an index file movie object file or playlist file. Also the scenario generating unit generates a parameter file which describes which stream each AV clip for realizing the multiplexing process is constituted from. The file generated here such as an index file movie object file or playlist file has the data structure described in Embodiments 1 and 2.

The BD program producing unit generates a source code for a BD program file and generates a BD program in accordance with a request from a user that is received via a user interface such as the GUI. In so doing the program of the BD program file can use the depth information output from the video encoder to set the depth of the GFX plane.

The multiplexing processing unit generates an AV clip in the MPEG2 TS format by multiplexing a plurality of streams described in the BD ROM scenario data such as the left view video stream right view video stream video audio subtitle and button. When generating this the multiplexing processing unit also generates the clip information file that makes a pair with the AV clip.

The multiplexing processing unit generates the clip information file by associating as a pair i the entry map generated by the multiplexing processing unit itself and ii attribute information that indicates an audio attribute image attribute and the like for each stream included in the AV clip. The clip information file has the structure that has been described in each embodiment so far.

The format processing unit generates a disc image in the UDF format by arranging in a format conforming to the BD ROM standard the BD ROM scenario data generated by the scenario generating unit the BD program file produced by the BD program producing unit the AV clip and clip information file generated by the multiplexing processing unit and directories and files in a format conforming to the BD ROM standard where the UDF format is a file system conforming to the BD ROM standard. The format processing unit writes the bit stream representing the disc image into the BD ROM bit stream storage unit.

In so doing the format processing unit generates the 3D metadata for the PG stream IG stream and secondary video stream by using the depth information output from the video encoder . Also the format processing unit sets by automation the arrangement of an image on the screen so as not to overlap with an object in the 3D image and adjusts the offset value so that depths do not overlap each other. The file layout of the disc image generated in this way is set to have the data structure of the file layout that has already been described. The generated disc image is converted into the data for BD ROM press and the press process is performed onto the data. The BD ROM is produced in this way.

The present embodiment describes the internal structure of a 2D 3D playback device that has integrated functions of the playback devices having been described in the embodiments so far.

The BD ROM drive like a 2D playback device reads out data from a BD ROM disc based on a request from the playback control unit . AV clips read from the BD ROM disc are transferred to the read buffer or

When a 3D image is to be played back the playback control unit issues a read request that instructs to read the base view data block and the dependent view data block alternately in units of Extents. The BD ROM drive reads out Extents constituting the base view data block into the read buffer and reads out Extents constituting the dependent view data block into the read buffer . When a 3D image is to be played back the BD ROM drive should have a higher reading speed than the BD ROM drive for a 2D playback device since it is necessary to read both the base view data block and the dependent view data block simultaneously.

The read buffer is a buffer that may be realized by for example a dual port memory and stores the data of the base view data blocks read by the BD ROM drive .

The read buffer is a buffer that may be realized by for example a dual port memory and stores the data of the dependent view data blocks read by the BD ROM drive .

The switch is used to switch the source of data to be input into the read buffers between the BD ROM drive and the local storage .

The system target decoder decodes the streams by performing the demultiplexing process onto the source packets read into the read buffer and the read buffer

The plane memory set is composed of a plurality of plane memories. The plane memories include those for storing a left view video plane a right view video plane a secondary video plane an interactive graphics plane IG plane and a presentation graphics plane PG plane .

The plane overlay unit performs the plane overlaying explained the embodiments so far. When the image is to be output to the television or the like the output is conformed to the 3D system. When it is necessary to play back the left view image and the right view image alternately by using the shutter glasses the image is output as it is. When the image is to be output to for example the lenticular television a temporary buffer is prepared the left view image is first transferred into the temporary buffer and the left view image and the right view image are output simultaneously after the right view image is transferred.

The HDMI transmission reception unit executes the authentication phase and the negotiation phase described in Embodiment 1 in conformance with for example the HDMI standard where HDMI stands for High Definition Multimedia Interface. In the negotiation phase the HDMI transmission reception unit can receive from the television i information indicating whether or not it supports a stereoscopic display ii information regarding resolution for a monoscopic display and iii information regarding resolution for a stereoscopic display.

The playback control unit includes a playback engine and a playback control engine . When it is instructed from the program executing unit or the like to play back a 3D playlist the playback control unit identifies a base view data block of a playitem that is the playback target among the 3D playlist and identifies a dependent view data block of a sub playitem in the 3D sub path that should be played back in synchronization with the playitem. After this the playback control unit interprets the entry map of the corresponding clip information file and requests the BD ROM drive to alternately read the Extent of the base view data block and the Extent of the dependent view data block starting with the playback start point based on the Extent start type that indicates which of an Extent constituting the base view video stream and an Extent constituting the dependent view video stream is disposed first. When the playback is started the first Extent is read into the read buffer or the read buffer completely and then the transfer from the read buffer and the read buffer to the system target decoder is started.

The playback engine executes AV playback functions. The AV playback functions in the playback device are a group of traditional functions succeeded from CD and DVD players. The AV playback functions include Play Stop Pause On Pause Off Still Off Forward Play with specification of the playback speed by an immediate value Backward Play with specification of the playback speed by an immediate value Audio Change Picture Data Change for Secondary Video and Angle Change.

The playback control engine performs playlist playback functions. The playlist playback functions mean that among the above described AV playback functions the Play and Stop functions are performed in accordance with the current playlist information and the current clip information where the current playlist information constitutes the current playlist.

The management information memory is a memory for storing the current playlist information and the current clip information. The current playlist information is a piece of playlist information that is currently a target of processing among a plurality of pieces of playlist information that can be accessed from the BD ROM built in medium drive or removable medium drive. The current clip information is a piece of clip information that is currently a target of processing among a plurality of pieces of clip information that can be accessed from the BD ROM built in medium drive or removable medium drive.

The register set is a player status setting register set that is a set of registers including a general purpose register for storing arbitrary information that is to be used by contents as well as the playback status register and the playback setting register having been described in the embodiments so far.

The program executing unit is a processor for executing a program stored in a BD program file. Operating according to the stored program the program executing unit performs the following controls 1 instructing the playback control unit to play back a playlist and 2 transferring to the system target decoder PNG JPEG that represents a menu or graphics for a game so that it is displayed on the screen. These controls can be performed freely in accordance with construction of the program and how the controls are performed is determined by the process of programming the BD J application in the authoring process.

The program memory stores a current dynamic scenario which is provided to the command interpreter that is an operator in the HDMV mode and to the Java platform that is an operator in the BD J mode. The current dynamic scenario is a current execution target that is one of Index.bdmv BD J object and movie object recorded in the BD ROM. The program memory includes a heap memory.

The heap memory is a stack region for storing byte codes of the system application byte codes of the BD J application system parameters used by the system application and application parameters used by the BD J application.

The HDMV module is a DVD virtual player that is an operator in the HDMV mode and is a performer in the HDMV mode. The HDMV module has a command interpreter and performs the control in the HDMV mode by interpreting and executing the navigation command constituting the movie object. The navigation command is described in a syntax that resembles a syntax used in the DVD Video. Accordingly it is possible to realize a DVD Video like playback control by executing the navigation command.

The BD J platform is a Java platform that is an operator in the BD J mode and is fully implemented with Java2 Micro Edition J2ME Personal Basis Profile PBP 1.0 and Globally Executable MHP specification GEM1.0.2 for package media targets. The BD J platform is composed of a class loader a byte code interpreter and an application manager.

The class loader is one of system applications and loads a BD J application by reading byte codes from the class file existing in the JAR archive file and storing the byte codes into the heap memory.

The byte code interpreter is what is called a Java virtual machine. The byte code interpreter converts i the byte codes constituting the BD J application stored in the heap memory and ii the byte codes constituting the system application into native codes and causes the MPU to execute the native codes.

The application manager is one of system applications and performs application signaling for the BD J application based on the application management table in the BD J object such as starting or ending a BD J application. This completes the internal structure of the BD J platform.

The middleware is an operating system for the embedded software and is composed of a kernel and a device driver. The kernel provides the BD J application with a function unique to the playback device in response to a call for the Application Programming Interface API from the BD J application. The middleware also realizes controlling the hardware such as starting the interruption handler by sending an interruption signal.

The mode management module holds Index.bdmv that was read from the BD ROM built in medium drive or removable medium drive and performs a mode management and a branch control. The management by the mode management is a module assignment to cause either the BD J platform or the HDMV module to execute the dynamic scenario.

The user event processing unit receive a user operation via a remote control and causes the program executing unit or the playback control unit to perform a process as instructed by the received user operation. For example when the user presses a button on the remote control the user event processing unit instructs the program executing unit to execute a command included in the button. For example when the user presses a fast forward rewind button on the remote control the user event processing unit instructs the playback control unit to execute the fast forward rewind process onto the AV clip of the currently played back playlist.

The local storage includes the built in medium drive for accessing a hard disc and the removable medium drive for accessing a semiconductor memory card and stores downloaded additional contents data to be used by applications and other data. An area for storing the additional contents is divided into as many small areas as BD ROMs. Also an area for storing data used by applications is divided into as many small areas as the applications.

The nonvolatile memory is a recording medium that is for example a readable writable memory and is a medium such as a flash memory or FeRAM that can preserve the recorded data even if a power is not supplied thereto. The nonvolatile memory is used to store a backup of the register set .

Next the internal structure of the system target decoder and the plane memory set will be described. shows the internal structure of the system target decoder and the plane memory set . As shown in the system target decoder and the plane memory set include an ATC counter a source depacketizer a PID filter an STC counter an ATC counter a source depacketizer a PID filter a primary video decoder a left view video plane a right view video plane a secondary video decoder a secondary video plane a PG decoder a PG plane an IG decoder an IG plane a primary audio decoder a secondary audio decoder a mixer a rendering engine a GFX plane and a rendering memory .

The primary video decoder decodes the left view video stream and writes the decoding result namely a non compressed video frame into the left view video plane .

The left view video plane is a plane memory that can store picture data with a resolution of for example 1920 2160 1280 1440 .

The right view video plane is a plane memory that can store picture data with a resolution of for example 1920 2160 1280 1440 .

The secondary video decoder having the same structure as the primary video plane performs decoding of an input secondary video stream and writes resultant pictures to the secondary video plane in accordance with respective display times PTS .

The secondary video plane stores picture data for the secondary video that is output from the system target decoder as a result of decoding the secondary video stream.

The PG decoder extracts and decodes a presentation graphics stream from the TS packets input from the source depacketizer and writes the resultant non compressed graphics data to the PG plane in accordance with respective display times PTS .

The PG plane stores non compressed graphics object that is obtained by decoding the presentation graphics stream.

The IG decoder extracts and decodes an interactive graphics stream from the TS packets input from the source depacketizer and writes the resultant non compressed graphics object to the IG plane in accordance with respective display times PTS .

The IG plane stores non compressed graphics object that is obtained by decoding the interactive graphics stream.

The mixer mixes the decoding result of the primary audio decoder with the decoding result of the secondary audio decoder .

The rendering engine provided with infrastructure software such as Java2D or OPEN GL decodes JPEG data PNG data in accordance with a request from the BD J application. The rendering engine also obtains an image or a widget and writes it into the IG plane or the background graphics plane. The image data obtained by decoding the JPEG data is used as the wallpaper of the GUI and is written into the background graphics plane. The image data obtained by decoding the PNG data is written into the IG plane to be used to realize a button display accompanied with animation. These images and or widgets obtained by decoding the JPEG PNG data are used by the BD J application to display a menu for receiving selection of a title subtitle or audio or to constitute a GUI part for a game that works in conjunction with a stream playback when the game is played. The images and or widgets are also used to constitute a browser screen on a WWW site when the BD J application accesses the WWW site.

The GFX plane is a plane memory into which graphics data such as JPEG or PNG is written after it is decoded.

The rendering memory is a memory into which the JPEG data and the PNG data to be decoded by the rendering engine are read. A cache area is allocated to this image memory when the BD J application executes a live playback mode. The live playback mode is realized by combining the browser screen on the WWW site with the stream playback by the BD ROM. The cache area is a cache memory for storing the current and the preceding browser screens in the live playback mode and stores non compressed PNG data or non compressed JPEG data that constitute the browser screen.

As described above according to the present embodiment a recording medium that includes the characteristics described in the embodiments so far as a whole can be realized as a BD ROM and a playback device that includes the characteristics described in the embodiments so far as a whole can be realized as a BD ROM playback device.

The register set is composed of a plurality of player status registers and a plurality of player setting registers. Each of the player status registers and player setting registers is a 32 bit register and is assigned with a register number so that a register to be accessed is identified by the register number.

The bit positions of the bits 32 bits that constitute each register are represented as b through b . Among these bit b represents the highest order bit and bit b represents the lowest order bit. Among the 32 bits a bit sequence from bit bx to bit by is represented by bx by .

The value of an arbitrary bit range bx by in a 32 bit sequence stored in the player setting register player status register of a certain register number is treated as an environment variable also called system parameter or player variable that is a variable of an operation system in which the program runs. The program that controls the playback can obtain a system parameter via the system property or the application programming interface API . Also unless otherwise specified the program can rewrite the values of the player setting register and the player status register. With respect to the BD J application it is required that the authority to obtain or rewrite system parameters is granted by the permission management table in the JAR archive file.

The player status register is a hardware resource for storing values that are to be used as operands when the MPU of the playback device performs an arithmetic operation or a bit operation. The player status register is also reset to initial values when an optical disc is loaded and the validity of the stored values is checked. The values that can be stored in the player status register are the current title number current playlist number current playitem number current stream number current chapter number and so on. The values stored in the player status register are temporary values because the player status register is reset to initial values each time an optical disc is loaded. The values stored in the player status register become invalid when the optical disc is ejected or when the playback device is powered off.

The player setting register differs from the player status register in that it is provided with power handling measures. With the power handling measures the values stored in the player setting register are saved into a non volatile memory when the playback device is powered off and the values are restored when the playback device is powered on. The values that can be set in the player setting register include various configurations of the playback device that are determined by the manufacturer of the playback device when the playback device is shipped various configurations that are set by the user in accordance with the set up procedure and capabilities of a partner device that are detected through negotiation with the partner device when the device is connected with the partner device.

The left hand side of shows the internal structures of the register set and the right hand side shows the internal structures of the playback control engine

The following describes the player status registers and the player setting registers assigned with respective register numbers.

PSR is set to a value in the range from 1 through 999 to indicate a current chapter number and is set to a value 0xFFFF to indicate that the chapter number is invalid in the playback device.

PSR is set to a value in the range from 0 through 0xFFFFFFFF to indicate a current playback time point current PTM with the time accuracy of 45 KHz.

PSR is used for the setting of Display Capability for Video . This indicates whether or not a display device connected to the playback device has a capability to perform the stereoscopic playback.

PSR is used for the setting of Player Capability for 3D . This indicates whether or not the playback device has a capability to perform the stereoscopic playback.

On the other hand the playback control engine includes a procedure executing unit for determining the output mode of the current playlist uniquely by referring to the PSR PSR PSR PSR and PSR and the stream selection table of the current playlist information in the management information memory . The Player Capability for 3D stored in PSR means the capability of playback device regarding the 3D playback as a whole. Thus it may be simply denoted as 3D Capability .

The general state is maintained unless a state transition occurs. The state transition is caused by a start of playlist playback a navigation command an output mode change requested by a BD J application or a jump to a BD J title. When a state transition occurs a procedure for obtaining a preferable output mode is executed.

The arrows jm jm jm . . . shown in represent events that trigger state transitions. The state transitions in include the following.

The Start presentation means to start playlist playback in the HDMV mode. In the BD J mode it means to branch to a BD J title. This is because in the BD J mode branching to a BD J title does not necessarily mean that a playlist starts to be played back.

The Jump to BD J title means to branch to a BD J title. More specifically it indicates that a title BD J title which is associated with a BD J application in the index table becomes a current title.

The Start Playlist Playback means that a playlist number identifying a playlist is set to a PSR and the playlist information is read onto the memory as the current playlist information.

The Change Output Mode means that the output mode is changed when the BD J application calls the API.

The Terminate Presentation in the HDMV mode means that a playback of a playlist is completed and in the BD J mode means that a BD J title jumps to a title HDMV title that is associated with a movie object in the index table.

When a disc is loaded the state of the output mode transits to a temporary state Initialization . After this the state of the output mode transits to the invalid state.

The output mode selection state is maintained to be invalid until the playback start Start Presentation is made active. The Start Presentation in the HDMV mode means that a playlist has been started to be played back and in the BD J mode means that a BD J title has been started to be played back and some operation of a BD J application has been started. It does not necessarily mean that a playlist has been started to be played back.

When Start Presentation is made active the state of the output mode transits to a temporary state Procedure when playback condition is changed .

The output mode transits to Valid depending on the result of Procedure when playback condition is changed . The output mode transits to Invalid when the output mode is effective and Start Presentation is completed.

The navigation command in the movie object should be executed before a playlist starts to be played back because the content provider sets a preferable output mode with the command. When the navigation command in the movie object is executed the state transits to invalid in this model.

In step S it is judged whether or not a disc unbound BD J application is running. In step S it is judged whether or not the stereoscopic display capability information in PSR indicates there is capability and the initial output mode information in Index.bdmv indicates the stereoscopic output mode .

When it is judged as Yes in step S the current output is maintained in step S. When it is judged as No in step S and Yes in step S the output mode in PSR is set to the stereoscopic output mode in step S. When it is judged as No in step S and No in step S the output mode in PSR is set to the 2D output mode in step S.

When it is judged as Yes in step S the current output mode is not changed in step S. When it is judged as No in step S and Yes in step S the current output mode is not changed step S . When it is judged as No in step S and No in step S the current output mode is set to the 2D output mode step S .

What should be taken into account when a playlist starts to be played back is that PES streams that can be played back in respective playitems are defined in the stream selection tables of the respective playitems. For this reason when the current playitem starts to be played back first it is necessary to select an optimum one for playback from among PES streams that are permitted to be played back in the stream selection table of the current playitem. The procedure for this selection is called stream selection procedure .

The following describes the bit assignment in the player setting register for realizing the 3D playback mode. Registers to be used to realizing the 3D playback mode are PSR PSR PSR and PSR. show the bit assignment in the player setting register for realizing the 3D playback mode.

The lowest order bit b in PSR represents the current output mode. When the output mode is changed the video output of the playback device should be changed in correspondence with it. The value of the output mode is controlled by the selection model.

These values are automatically set before a playback is started when the playback device supports an interface that negotiates with the display device. When these values are not set automatically they are set by the user.

As described above according to the present embodiment the validity of the output mode can be maintained even if the state of the playback is changed or a request to switch between streams is received from the user.

In Embodiment 1 information defining the offset control is imbedded in the metadata of the sub view video stream whereas in the present embodiment control information defining the offset control is imbedded in the metadata of the graphics stream the offset control applying the offsets of leftward and rightward directions to horizontal coordinates in the graphics plane and overlaying the resultant graphics planes with the main view video plane and the sub view video plane on which picture data constituting the main view and sub view are drawn respectively.

The following describes parameters for use in the shift control and data for interpolating the parameters.

It is presumed here that the picture data representing the L image and the picture data representing the R image shown in are constituted from the macroblocks shown in respectively. In these drawings each rectangular box represents a macroblock. Among the macroblocks constituting the L and R images the macroblocks with hatching constitute the three dimensional object.

The four depths can be defined as four offset sequences so that the depth of any of the head body limbs and tail of the dinosaur can be selected appropriately to be used as the depth of the graphics displayed in the 1 plane offset mode.

In the MPEG4 MVC since the encoding is performed by using the correlationships between the L and R images motion vectors of the macroblocks constituting the L image and of the macroblocks constituting the R image are generated. With use of the motion vectors the depths of the macroblocks can be detected and from the depths of the macroblocks shift control parameters corresponding to the respective macroblocks can be obtained.

The generation of the shift control parameters is realized by executing the procedure for defining the offset sequence in parallel with the encoding of the video stream. is a flowchart showing the procedure for defining the offset sequence that is executed in parallel with the encoding of the video stream.

In step S it is judged whether or not encoding of GOP has started. When it is judged in step S that encoding of GOP has started the control moves to step S in which offset sequences corresponding to each macroblock constituting the moving object in the picture of the starting video access unit are generated in the MVC scalable nesting SEI message of the starting video access unit in the GOP. This is because the control parameters for use in the 1 plane offset mode such as the shiftwidth in the X axis direction and the shiftwidth in the Z axis direction are generated in correspondence with each macroblock constituting the picture data of the starting video access unit.

In step S it is judged whether or not motion vectors of the moving object in the screen have been calculated in units of macroblocks wherein this judgment is made each time the L and R images belonging to the GOP are encoded. When it is judged that the motion vectors have been calculated the depth information is calculated. In the present embodiment the depth information is calculated in a simple process of step S in which the horizontal scalar value of the motion vector of each macroblock is converted into shiftwidth and a horizontal component in the movement direction of each macroblock is converted into the shift direction. In this process approximate values of the shiftwidth and shift direction for each frame period are obtained.

In step S the amount of deviation is added to the shiftwidth obtained for each macroblock in the frame period. The scalar values in the horizontal direction which are the source of the conversion indicate the depths of the three dimensional object itself at the portions corresponding to the macroblocks. Thus the process of step S is performed to indicate the depths immediately before the three dimensional object as the shiftwidths in the 1 plane offset mode by adding the amount of deviation.

In step S the shiftblock and shift direction of each macroblock in the frame period added with the interpolation values are additionally written as a new Plane offset value and a Plane offset direction into the offset sequence for each macroblock.

In step S it is judged whether or not the encoding of GOP in the video stream is to continue. When it is judged that the encoding of GOP in the video stream is to continue the control returns to step S. As far as it is judged that the encoding of GOP in the video stream is to continue Plane offset value and a Plane offset direction continue to be added to the offset sequence.

When the encoding of GOP ends the generation of the offset metadata in the video access unit for the GOP ends and the control returns to step S.

Note that when a shooting is done with use of a 3D camera or the base view video stream and the dependent view video stream are encoded the shiftwidth and shift direction of each macroblock may be stored as a database for each GOP then the shiftwidth and shift direction may be subjected to an appropriate conversion and the results of the conversion may be stored in the MVC scalable nesting SEI message in the access unit at the start of the GOP. This makes it possible to define a plurality of offset sequences that define a plurality of depths. Note that when the 3D camera is provided with the codec for the MPEG4 MVC the above described definition of the offset sequence should be executed by the 3D camera.

This completes the description of how parameters for the shift control in the 1 plane offset mode are generated. The following describes interpolation parameters for interpolate the control parameters generated as described above. The interpolation parameters exist in the metadata inside the subtitle stream.

The window definition segment is a functional segment for defining the rectangular area in the graphics plane. As described earlier in the Epoch the continuity is generated in the memory management only when the clearing and the redrawing are performed in a certain rectangular area in the graphics plane. The rectangular area in the graphics plane is called window and is defined by the window definition segment. shows the data structure of the window definition segment. As shown in the window definition segment includes window id uniquely identifying a window in the graphics plane window horizontal position indicating the horizontal position of an upper left pixel in the graphics plane window vertical position indicating the vertical position of the upper left pixel in the graphics plane window width indicating the horizontal width of the window in the graphics plane and window height indicating the vertical width of the window in the graphics plane.

The following explains the values that the window horizontal position window vertical position window width and window height can take. The coordinate system in which these values are represented is an internal area of the graphics plane. In the internal area of the graphics plane the window has a two dimensional size of a vertical length video height and a horizontal length video width .

The window horizontal position is a horizontal address of the upper left pixel in the graphics plane and takes a value in the range from 0 to video width 1 . The window vertical position is a vertical address of the upper left pixel in the graphics plane and takes a value in the range from 0 to video height .

The window width is a horizontal width of the window in the graphics plane and takes a value in the range from 0 to video width window horizontal position 1 . The window height is a vertical width of the graphics plane and takes a value in the range from 0 to video height window vertical position 1 .

With the window horizontal position window vertical position window width and window height of the window definition segment it is possible to define for each Epoch the location of the window in the graphics plane and the size of the window. This makes it possible to make an adjustment during the authoring by for example causing the window to appear above a picture belonging to an Epoch so that a window does not disturb display of the picture while the picture is displayed. This makes the display of the graphics subtitle easy to see. Since the window definition segment can be defined for each Epoch even if an image pattern in the picture changes over time the graphics can be made easy to see in correspondence with the change. As a result of this it is possible to increase the quality of the movie to the same level as the case where the subtitle is embedded in the main body of the movie.

As shown in the PCS includes segment type segment length composition number composition state pallet update flag pallet id ref number of composition object and composition object through composition object m .

The composition number identifies the graphics update in the display set by a numeral ranging from 0 to 65535 . It identifies the graphics update as follows. The composition number is set to satisfy the rule that when there are graphics updates between the start of Epoch and the present PCS the composition number is incremented each time one of the graphics updates is passed through.

The composition state indicates which of Normal Case Acquisition Point and Epoch Start the Display Set starting with the present PCS is.

The pallet update flag indicates whether the Pallet Only Display Update has been done in the present PCS. Note that the Pallet Only Display Update is an update that is made by switching only the previous pallet to a new one. When an update is performed in the present PCS the present PCS is set to 1 .

The 3d graphics offset direction and 3d graphics offset following these are metadata in the graphics stream.

The 3d graphics offset direction is a field for setting a leftward or a rightward direction in which a shift is to be made by the Offset.

The 3d graphics offset is a field for setting specifically how much the target should be moved in the leftward or rightward direction.

The composition object through composition object n are information indicating how to control the Object to be displayed in the Display Set to which the present PCS belongs. The lead line col indicates a close up of the internal structure of an arbitrary composition object i . As the lead line col indicates the composition object i includes object id ref window id ref object cropped flag forced on flag object horizontal position object vertical position cropping rectangle information . . . n .

The object id ref indicates an identifier of an ODS that corresponds to the composition object i and should be referenced.

The window id ref indicates a window to be assigned to the graphics object. Up to two graphics objects can be assigned to one window.

The object cropped flag is a flag to switch between displaying a graphics object having been cropped in the object buffer and displaying a not cropped graphics object. When the object cropped flag is set to 1 a graphics object having been cropped in the object buffer is displayed and when the object cropped flag is set to 0 a not cropped graphics object is displayed. The forced on flag when set to 1 indicates that the graphics object indicates a subtitle that is to be displayed forcibly even if the subtitle has been set to OFF in the setting of the player.

The object horizontal position indicates the horizontal position of the upper left pixel in the graphics object in the graphics plane.

The object vertical position indicates the vertical position of the upper left pixel in the graphics plane.

The cropping rectangle information . . . n are information elements that are valid while the object cropped flag is set to 1 . The lead line wd indicates a close up of the internal structure of an arbitrary cropping rectangle information i . As the lead line wd indicates the cropping rectangle information i includes object cropping horizontal position object cropping vertical address object cropping width and object cropping height .

The object cropping horizontal position indicates a horizontal position of an upper left pixel in the cropping rectangle in the graphics plane. Note that the cropping rectangle is a frame used to cut out a part of the graphics object and corresponds to Region defined in the ETSI EN 300 743 standard.

The object cropping vertical address indicates a vertical position of the upper left pixel in the cropping rectangle in the graphics plane.

The object cropping width indicates a horizontal width of the cropping rectangle in the graphics plane.

The object cropping height indicates a vertical width of the cropping rectangle in the graphics plane.

The unit of the value indicated in the 3D graphics offset may be defined as an amount of shift that is made in a unit of a pixel on the screen or may be defined as an amount of shift that is made in a unit of for example two pixels for the sake of reduction in the number of bits to be used to define the 3D graphics offset .

For example the 3D graphics offset direction may be structured as a one bit field so that when the field is set to 0 the offset is applied in the direction in which the subtitle pops out in front of the display namely before the graphics plane is overlaid with the left eye video plane the graphics plane is shifted rightward by the offset and when the field is set to 1 the offset is applied in the direction in which the subtitle recedes behind the display in the depth direction. Also the 3D graphics offset may have six bits so that leftward and rightward offsets to be applied to the graphics plane to be superimposed with the video plane may each be 64 pixels when the offset indicates the amount of movement in unit of a pixel .

In this case since the leftward and rightward offsets of 64 pixels each do not provide a sufficient 3D subtitle pop out the value of this field is used as an interpolation value for the offset sequence in the dependent view stream. More specifically the offset indicated in the composition object is an interpolation value that is used in combination with the offset sequence in the dependent view stream and indicates an amount of interpolation in support of the offset indicated by the offset sequence in the dependent view stream.

Next how each PCS is described will be explained. show examples of descriptions in the window definition segment and PCS belonging to a display set. shows an example of description in the PCS in the DS.

In the window horizontal position and the window vertical position in the window definition segment indicate an upper left coordinate LP of the window in the graphics plane and the window width and the window height indicate the horizontal and vertical widths of the display frame of the window.

In the object cropping horizontal position and the object cropping vertical position in the crop information indicate a standard point ST of the crop range in the coordinate system whose origin is an upper left coordinate of the graphics object in the object buffer. A range of object cropping width and object cropping height from the standard point the range enclosed by a thick line frame in the drawing is called crop range . The cropped graphics object is placed in a range cpl enclosed by a dotted line whose standard point an upper left point is the object horizontal position and the object vertical position in the coordinate system of the graphics plane. With this arrangement Actually is written into the window in the graphics plane and the subtitle Actually is overlaid with the video image and a resultant overlaid image is displayed.

In this way a predetermined display effect of the subtitle can be realized by describing the PCSs in the DS DS and DS as explained above.

There may be a case where there are two drawing areas in the graphics plane and one drawing area is desired for displaying a spoken text the other desired for displaying a commentary of the director of the movie and it is further desired that the commentary appears to be placed further away from the spoken text so that the subtitle has a stereoscopic effect. In such a case it is possible to increase the depth of the commentary by setting the interpolation value for the second drawing area.

The plane shift is performed in units of lines. Thus a rule should be made to prohibit a plurality of drawing areas from being defined per line or to cause offsets of the drawing areas to be set to the same value when a plurality of drawing areas are defined for one line.

The present embodiment relates to an improvement that the video offset information has offset values corresponding to respective areas obtained by dividing the screen.

Offsets and corresponding to the areas containing the triangular object have large values. In this way the offset information is generated based on the depths of the objects included in the scenes of each frame.

Next the 3D playback device will be explained. The basic part of the structure of the 3D playback device is the same as the structure of the 3D playback devices having been explained in the embodiments so far. Thus the explanation will center on the extension or the different portions.

The 3D video decoder at the same timing as a frame of decoded image is written onto the 2D left eye image plane at the timing of PTS notifies the plane overlay unit of the video offset information contained in the frame.

Also the SPEM 25 among the registers storing player variables stores information indicating which among the nine offsets included in the video offset information are offsets from which the largest value is taken to be used in the plane shift. The SPEM 25 indicates which among Offset  Offset  Offset  Offset  Offset  Offset  Offset  Offset  and Offset  have values from which the largest value is taken.

The SPEM 25 is set by a command or API when the program of the BD program file is executed. The SPEM 25 has for example 9 bit information each of the nine bits indicates valid invalid of each offset value.

The plane overlay unit determines as the value by which the plane is to be shifted the largest value of the offset value based on the video offset information transferred from the 3D video decoder and based on the values of the SPRM 25 . The plane overlay unit then performs overlaying with the plane stored in the plane memory by performing the plane shift and cropping process.

In the example shown in the offsets have the following values Offset  3 Offset  3 Offset  1 Offset  2 Offset  3 Offset  5 Offset  1 Offset  4 and Offset  5. The SPRM 25 is set to indicate that Offset  Offset  and Offset  are valid and the largest values of these offsets are used in the plane shift.

The shift unit determines the largest value in this example MAX 3 2 1 1 among the values of Offset  Offset  and Offset  that are indicated as valid by the SPRM 25 in the video offset information executes the plane shift and the cropping process and performs the superimposing with image plane.

With the structure stated above it is possible to reduce the size of the memory provided in the 3D playback device by including the video offset information into the video stream.

The SPEM 25 may include not only the information indicating offsets having valid values among the offsets of the nine areas but also a base offset value. The plane overlay unit after determining the largest value among the valid values of the offsets may add the base offset value to the largest value. For example when the largest value among the valid values of the offsets is 3 and the base offset value is 2 the offset value used in the plane shift is 5 3 2 5 .

In the present embodiment the SPRM 25 is used to indicate valid offsets among those corresponding to the nine areas constituting the screen. However not limited to this the valid offsets may be determined based on a graphics rectangular area in the graphics plane.

Suppose here that the graphics image to be displayed is the ellipse shown in the lower row of . In this case valid offsets are Offset  Offset  Offset  and Offset . This also applies to the case where information such as the closed caption is played back three dimensionally as well as to the case where the graphics such as IG PG is displayed.

The video offset information may be stored only at the start of a GOP not in each frame contained in the GOP. Also as many pieces of video offset information as the frames contained in the GOP may be stored at the start of the GOP.

The video offset information may be calculated based on the difference between the motion vectors of the left eye and right eye images during the video encoding.

When the video offset information is calculated from the depths of the objects included in the scenes of each frame the depths of the graphics change greatly if the depths of the depth information change greatly. In view of this the values may be set by causing the values to pass through a low pass filter between frames.

In the present embodiment the video offset information is set to have values corresponding to the nine areas constituting the screen. However not limited to this the video offset information may have offset values for each plane. In this case the plane overlay unit changes the offset values depending on the plane and performs the plane shift and cropping.

In the present embodiment the offset values are stored in the 2D left eye video stream. However not limited to this the offset values may be stored in the right eye video stream.

In the present embodiment the 3D depth method is introduced as well as the 3D LR method which realizes the stereoscopic viewing effect by using the L and R images. In the 3D depth method the stereoscopic viewing effect is realized by using the 2D image and the depth information.

The 3D depth method is realized by incorporating a parallax image generator in the latter half of the video decoder and in the 3D depth method the left view picture data and the right view picture data are generated from i each piece of picture data in the video stream and ii the depth information of each pixel that constitutes the picture data.

The depth information may be made of grayscale picture data also referred to as depth information picture data that represents the depth of pixels by a grayscale.

In the 3D depth method a video stream that can be played back as a 2D image becomes the base view video stream and a video stream that is composed of grayscale picture data becomes the dependent view video stream.

The base view video stream can be shared by the 3D depth mode and the 3D LR mode. It is therefore possible to generate images for the 3D depth mode and images for the 3D LR mode by combining the base view video stream and a video stream for the 3D depth mode or a video stream for the 3D LR mode. The data management structure is structured to support these combinations so that the display method is switched in accordance with the properties of the player and the television connected thereto. To achieve the 3D depth mode the playback device needs to be provided with dedicated hardware. As a result it is supposed in the present application except where otherwise mentioned that the recording medium and the playback device do not support the 3D depth mode.

The stream files including data blocks of the base view video stream for 3D playback are stored in the BASE sub directory which is created under the STREAM directory such that the stream files for 3D playback are distinguished from the stream files for 2D playback.

The stream files including data blocks of the dependent view video stream of the LR format for 3D playback are stored in the LR sub directory which is created under the STREAM directory such that the stream files for 3D playback are distinguished from the stream files for 2D playback.

The stream files including data blocks of the base view video stream of the depth format for 3D playback are stored in the DEPTH sub directory which is created under the STREAM directory such that the stream files for 3D playback are distinguished from the stream files for 2D playback.

Similarly the stream management information for managing stream files for playback in the LR format is stored in the LR sub directory which is created under the CLIPINF directory such that the management for 3D playback is distinguished from the management for 2D playback.

The stream management information for managing stream files for playback in the depth format is stored in the DEPTH sub directory which is created under the CLIPINF directory such that the management for 3D playback is distinguished from the management for 2D playback. The extension is also changed in accordance with the format of the file.

A stream file which by itself alone can realize a playback is assigned with the same extension assigned to the corresponding stream file for 2D playback.

A stream file which does not include a data block of the base view video stream cannot realize a playback cannot decode the video by itself alone and can decode the video only when it is executed together with a stream file including a data block of the base view video stream is assigned with an extension such as .3dts for the distinction.

A stream file in which data blocks of the base view video stream and the dependent view video stream are arranged in the interleaved manner and thus a playback cannot be realized if the contents of the file are read in sequence from the start thereof is assigned with an extension such as .ilts which stands for interleaved TS for distinction.

The LR dependent view ES availability LR interleaved file availability Depth dependent view ES availability and Depth interleaved file availability are flags for indicating that the files in the interleave format are not necessary when the dependent view video stream using Out of MUX is supplied.

The 3D base view block is a block that exists without fail. When different Extents are to be referenced for 2D and 3D it references STREAM BASExxxxx.m2ts by the stream entry of type 4 .

When the same Extent is to be referenced for 2D and 3D it references STREAM xxxxx.m2ts by the stream entry of type 1 .

When LR dependent view ES availability has been set ON it specifies STREAM LR xxxxx.3dts by using the stream entry of type 4 . When the LR interleave file is used STREAM LR xxxxx.ilts is specified.

When Depth dependent view ES availability has been set ON and different Extents are to be referenced for 2D and 3D it specifies STREAM DEPTH xxxxx.3dts by using the stream entry of type 4 . When the Depth interleave file is used STREAM DEPTH xxxxx.ilts is specified.

The playitem shown on the left hand side of includes clip information file name Clip filename stream selection table STN table and extension stream selection table STN table extension corresponding to the 3D depth method. The small boxes included in the stream selection table and the extension stream selection table indicate the types of the stream entries of the stream registration information in these tables. As shown in the stream entry in the stream selection table is type 1 type 1 .

In contrast in the extension stream selection table the stream entries of the base view video stream base view stream the dependent view video stream in the 3D LR format LR dependent view stream the stereoscopic interleaved stream in the 3D LR format LR interleaved stream the dependent view video stream in the 3D depth format Depth dependent view stream and the stereoscopic interleaved stream in the 3D depth format Depth interleaved stream are each type 4 type 4 .

The top row of the second column shows the internal structure of the stereoscopic interleaved stream file 00001.ssif . The signs D R L and L in the small boxes indicate Extent of the base view video stream in the depth format Extent of the right view video stream Extent of the left view video stream and Extent for 2D among Extents of the left view video stream respectively.

When the stream file is to be referenced by a 2D player by file path STREAM 00001.m2ts from the clip information file name in the playitem information the Extents L and L among the above described Extents of the stereoscopic interleaved stream file are referenced by the 2D player.

When the stream file is to be referenced by a 3D player in the 3D LR mode by file path STREAM BASE 00001.m2ts from the clip information file name in the playitem information the Extents L and L among the above described Extents of the stereoscopic interleaved stream file are referenced by the 3D player.

When the stream file is to be referenced by a 3D player in the 3D LR mode by file path STREAM LR 00001.3dts from the clip information file name in the playitem information the Extents R R and R among the above described Extents of the stereoscopic interleaved stream file are referenced by the 3D player.

When the stream file is to be referenced by a 3D player in the 3D LR mode by file path STREAM LR 00001.ilts from the clip information file name in the playitem information the Extents R L R and L among the above described Extents of the stereoscopic interleaved stream file are referenced by the 3D player.

When the stream file is to be referenced by a 3D player in the 3D depth mode by file path STREAM DEPTH 00001.3dts from the clip information file name in the playitem information the Extents D D and D among the above described Extents of the stereoscopic interleaved stream file are referenced by the 3D player.

When the stream file is to be referenced by a 3D player in the 3D depth mode by file path STREAM DEPTH 00001.ilts from the clip information file name in the playitem information the Extents D L D L and L among the above described Extents of the stereoscopic interleaved stream file are referenced by the 3D player.

The fourth column of indicates that CLIPINF 00001.clpi is referenced by the 2D player 3D players that perform the 3D LR playback and 3D players that perform the depth playback CLIPINF LR 00001.clpi is referenced by the 3D players that perform the 3D LR playback and CLIPINF DEPTH 00001.clpi is referenced by the 3D players that perform the depth playback.

As described above when the stream entry is type 4 streams files to be read are determined based on the type of 3D playback LR format or Depth format and the file format supported by the player base dependent file format or single file format .

When cross linking is realized between the 2D stream files and 3D stream files so that the same Extents can be referenced for these files a stream file that is the same as the 2D stream file can be referenced by setting the stream entry of the base view stream to type 1 . When multiplication into one transport stream is realized a stream file that is the same as the 2D stream file can be referenced by setting the stream entries of the base view stream and the dependent view stream to type 1 .

Embodiment 11 explains the data structure for reducing the size of the buffer that is used when video data for playback is decoded by the 3D playback device of the present invention and explains the 3D playback device.

As indicated in the previous Embodiment the 3D video decoder is provided with an Elementary Buffer EB for storing the video access unit of the 2D left view video stream in the encoded state and an Elementary Buffer EB for storing the video access unit of the right view video stream in the encoded state.

These buffers correspond to the CPB in the MPEG 4 AVC standard and the buffer size thereof is determined in accordance with a predetermined standard. In general the buffer size is set in proportion to the bit rate. That is to say the greater the bit rate is the larger the necessary buffer size is and the smaller the bit rate is the smaller the necessary buffer size is. The bit rate mentioned here means a transfer rate in a transfer from an MB to an EB and corresponds to the BitRate stored in the HRD parameter in the MPEG 4 AVC standard.

For example when the bit rate of the 2D left view video stream is 40 Mbps and the buffer size necessary therefor is 4 MB the buffer size necessary for the bit stream encoded by the same encoding method whose bit rate is 30 Mbps is 4 MB 30 Mbps 40 Mbps 3 MB.

It should be noted here that the total bit rate of the 2D left view video stream and the right view video stream is determined from the transfer rate from the drive or the like and is set as a fixed value. In the present example it is presumed that the total bit rate of the video streams is 60 Mbps.

Accordingly when the total bit rate is 60 Mbps and the bit rate of the 2D left view video stream is 40 Mbps the bit rate of the right view video stream is 20 Mbps and when the bit rate of the 2D left view video stream is 30 Mbps the bit rate of the right view video stream is 30 Mbps.

Here with regard to the largest value of the bit rate the largest bit rate of the 2D left view video stream is 40 Mbps and the largest bit rate of the right view video stream is 30 Mbps. From the largest values of the bit rates the sizes of the EBs can be defined as follows the size of EB for the 2D left view video stream is 4 MB 40 Mbps 40 Mbps 4 MB and the size of EB for the right view video stream is 4 MB 30 Mbps 40 Mbps 3 MB. Based on this definition of the buffer sizes it would be presumed that the playback of the 3D video is guaranteed if the 3D playback device is provided with 4 MB 3 MB 7 MB of buffer and each video stream is generated so that an underflow or an overflow does not occur with the buffer size as defined above.

However since the total bit rate of the 2D left view video stream and the right view video stream is 60 Mbps there is no combination of the largest bit rate of the 2D left view video stream 40 Mbps and the largest bit rate of the right view video stream 30 Mbps. For this reason the buffer size of each buffer is determined from the largest bit rate of each video stream for the 3D playback device 4 MB 3 MB a buffer size larger than necessary is set.

In view of this problem the following describes the data structure enabling the 3D playback device to set the minimum buffer sizes for the EB and EB and describes the 3D playback device.

The basic part of the data structure is the same as the data structure for storing the 3D video having been described in the previous embodiments. Thus the following description centers on the extended or different parts.

In the data structure of the present embodiment the playitem additionally has fields indicating the sizes of the EB and EB as shown in which is the difference from the structures described earlier. shows the playitem information that includes size information of the elementary buffers.

The EB size field stores size information of EB necessary for decoding the 2D left view video stream referenced from a playitem.

The EB size field stores size information of EB necessary for decoding the right view video stream to be played back together with the playitem.

The total size of EB and EB is determined from the total bit rate of the 2D left view video stream and the right view video stream. For example when the total bit rate of the 2D left view video stream and the right view video stream is 60 Mbps the total size of EB and EB is 4 MB 60 Mbps 40 Mbps 6 MB.

Also the 2D left view video stream to be referenced from the playitem is generated so that an underflow or an overflow does not occur with the buffer size defined in the EB size field and the right view video stream to be played back together with the playitem is generated so that an underflow or an overflow does not occur with the buffer size defined in the EB size field.

The basic part of the 3D playback device is the same as the 3D playback device for playing back the 3D video having been described in the previous embodiments. Thus the following description centers on the extended or different parts.

The 3D playback device of the present embodiment resizes the EBs for the base view and dependent view resizes memory areas to be allocated depending on the playitem to be played back which is the difference from the 3D playback devices described earlier.

The playback control unit before the playback of the playitem obtains the sizes of EB and EB by referring to the EB size field and the EB size field in playitem and notifies the system target decoder of the obtained sizes. Upon receiving the notification of the sizes the system target decoder resizes EB and EB of the 3D video decoder. The playback control unit starts playing back the playitem after the resizing of EB and EB is completed.

When the 3D playback device plays back playitem as the 3D video it identifies i the 2D left view video stream to be referenced from playitem and ii the right view video stream to be played back together with playitem . The 3D playback device resizes EB and EB of the video decoder in the system target decoder based on the EB size field and the EB size field included in playitem . In the present example the 3D playback device resizes EB and EB to 4 MB and 2 MB respectively before starting to play back the video stream. Similarly when the 3D playback device plays back playitem it resizes EB and EB of the video decoder in the system target decoder based on the EB size field and the EB size field included in playitem . In the present example the 3D playback device resizes EB and EB to 3 MB and 3 MB respectively before starting to play back the video stream.

With the above described structure it is possible to control the sizes of EB and EB necessary for the playback of 3D video appropriately depending on the bit rate of the video stream thus making it possible to define the necessary buffer sizes based on the total bit rate of the 2D left view video stream and the right view video stream. This compared with the case where each buffer size is defined based on the largest value of each bit rate reduces the total buffer size of the necessary buffers EB and EB .

Note that when the buffer sizes are resized so that either of the EBs is smaller than the other in size a seamless connection between playitems may not be guaranteed because the data transfer between the playitems may fail. Thus such resizing may be prohibited. More specifically in the playitems whose connection condition is 5 or 6 setting of the buffer sizes for EB and EB may be prohibited or disregarded. Alternatively in a playitems whose connection condition is 5 or 6 it may be made a rule that the values of the buffer sizes for EB and EB should be the same as the values of the buffer sizes for EB and EB in the previous playitem.

Also since the total bit rate of the 2D left view video stream and the right view video stream is determined as a fixed value only the EB size field may be provided and the size of EB may be obtained by subtracting the size of EB from the total buffer size of EB and EB size of EB total buffer size size of EB .

Furthermore the EB size field and the EB size field may take any form as far as the buffer sizes can be calculated. For example the fields may include bit rates of the video stream so that the buffer sizes can be calculated from the bit rates. Alternatively combinations of the EB size and EB size may be defined as a table and the IDs thereof may be set.

The present embodiment relates to an improvement of adding depth information to the 3D metadata in the clip information where the depth information indicates depths added to 2D images represented by the presentation graphics stream interactive graphics stream and sub picture graphics stream.

Note that although the 3D metadata is set for each PID in the present embodiment the 3D metadata may be set for each plane. The structure simplifies the process of analyzing the 3D metadata by the 2D 3D playback device. By taking into account the performance of the 2D 3D playback device in the overlaying process the interval between the offset entries may be limited for example to be not less than one second.

Here video stream attribute information will be explained. In the 3D LR mode the codec frame rate aspect ratio and resolution indicated by the video stream attribute information of the 2D base view video stream with PID 0x1011 should match those indicated by the video stream attribute information of the corresponding right view AV stream with PID 0x1012 respectively. Also in the 3D depth mode the codec frame rate aspect ratio and resolution indicated by the video stream attribute information of the 2D base view video stream with PID 0x1011 should match those indicated by the video stream attribute information of the corresponding depth map AV stream with PID 0x1013 respectively. This is because if the codecs are different the reference relationships between the video streams will not be established and if the frame rates aspect ratios and resolutions are different the user will feel uncomfortable when the images are played back in synchronization with each other as a 3D image.

As a variation of the above described structure the video stream attribute information of the right view AV stream may include a flag that indicates that the video stream in question is a video stream that references the 2D base view video stream. As another variation the video stream attribute information may include information of the reference destination AV stream. With such a structure the tool for verifying whether or not the created data conforms to a predetermined format can check the relationships between the video streams.

An entry map of the 2D left view video stream is stored in the clip information file of the 2D base view video stream. In each entry point of the 2D left view video stream the PTS and SPN of the I picture at the start of GOP of the 2D left view video stream are registered. Similarly an entry map of the right view video stream is stored in the clip information file of the right view video stream. In each entry point of the right view video stream the PTS and SPN of the picture at the start of GOP of the right view video stream are registered.

The present embodiment describes an example structure of a playback device for playing back the data of the structure described in an earlier embodiment which is realized by using an integrated circuit . shows an example structure of a 2D 3D playback device which is realized by using an integrated circuit.

The medium interface unit receives reads out data from the medium and transfers the data to the integrated circuit . Note that the medium interface unit receives the data of the structure described in the earlier embodiment. The medium interface unit is for example a disc drive when the medium is the optical disc or hard disk a card interface when the medium is the semiconductor memory such as the SD card or the USB memory a CAN tuner or Si tuner when the medium is broadcast waves of broadcast including the CATV or a network interface when the medium is the Ethernet wireless LAN or wireless public line.

The memory is a memory for temporarily storing the data received read from the medium and the data that is being processed by the integrated circuit . For example the SDRAM Synchronous Dynamic Random Access Memory DDRx SDRAM Double Date Ratex Synchronous Dynamic Random Access Memory x 1 2 3 . . . or the like is used as the memory . Note that the number of the memories is not fixed but may be one or two or more depending on the necessity.

The integrated circuit is a system LSI for performing the video audio processing onto the data transferred from the interface unit and includes a main control unit a stream processing unit a signal processing unit a memory control unit and an AV output unit .

The main control unit includes a processor core having the timer function and the interrupt function. The processor core controls the integrated circuit as a whole according to the program stored in the program memory or the like. Note that the basic software such as the OS operating software is stored in the program memory or the like preliminarily.

The stream processing unit under the control of the main control unit receives the data transferred from the medium via the interface unit and stores it into the memory via the data bus in the integrated circuit . The stream processing unit under the control of the main control unit also separates the received data into the video base data and the audio base data. As described earlier on the medium AV clips for 2D L including left view video stream and AV clips for R including right view video stream are arranged in an interleaved manner in the state where each clip is divided into some Extents. Accordingly the main control unit performs the control so that when the integrated circuit receives the left eye data including left view video stream the received data is stored in the first area in the memory and when the integrated circuit receives the right eye data including right view video stream the received data is stored in the second area in the memory . Note that the left eye data belongs to the left eye Extent and the right eye data belongs to the right eye Extent. Also note that the first and second areas in the memory may be areas generated by dividing a memory logically or may be physically different memories.

The signal processing unit under the control of the main control unit decodes by an appropriate method the video base data and the audio base data separated by the stream processing unit . The video base data has been recorded after being encoded by a method such as MPEG 2 MPEG 4 AVC MPEG 4 MVC or SMPTE VC 1. Also the audio base data has been recorded after being compress encoded by a method such as Dolby AC 3 Dolby Digital Plus MLP DTS DTS HD or Linear PCM. Thus the signal processing unit decodes the video base data and the audio base data by the methods corresponding thereto. Models of the signal processing unit are various decoders of Embodiment 9 shown in .

The memory control unit mediates the access to the memory from each functional block in the integrated circuit .

The AV output unit under the control of the main control unit performs the superimposing of the video base data having been decoded by the signal processing unit or format conversion of the video base data and the like and outputs the data subjected to such processes to the outside of the integrated circuit .

The device stream interface unit is an interface for transferring data between the interface unit and the integrated circuit . The device stream interface unit may be SATA Serial Advanced Technology Attachment ATAPI Advanced Technology Attachment Packet Interface or PATA Parallel Advanced Technology Attachment when the medium is the optical disc or the hard disk a card interface when the medium is the semiconductor memory such as the SD card or the USB memory a tuner interface when the medium is broadcast waves of broadcast including the CATV or a network interface when the medium is the Ethernet wireless LAN or wireless public line. The device stream interface unit may have a part of the function of the interface unit or the interface unit may be embedded in the integrated circuit depending on the type of the medium.

The demultiplexing unit separates the playback data transferred from the medium including video and audio into the video base data and the audio base data. Each Extent having been described earlier is composed of source packets of video audio PG subtitle IG menu and the like dependent source packets may not include audio . The demultiplexing unit separates the playback data into video base TS packets and audio base TS packets based on the PID identifier included in each source packet. The demultiplexing unit transfers the data after the separation to the signal processing unit . A model of the demultiplexing unit is for example the source depacketizer and the PID filter of Embodiment 9 shown in .

The switching unit switches the output destination storage destination so that when the device stream interface unit receives the left eye data the received data is stored in the first area in the memory and when the integrated circuit receives the right eye data the received data is stored in the second area in the memory . Here the switching unit is for example DMAC Direct Memory Access Controller . is a conceptual diagram showing the switching unit and the peripheral when the switching unit is DMAC. The DMAC under the control of the main control unit transmits the data received by the device stream interface and the data storage destination address to the memory control unit . More specifically the DMAC switches the output destination storage destination depending on the received data by transmitting Address the first storage area to the memory control unit when the device stream interface receives the left eye data and transmitting Address the second storage area to the memory control unit when the device stream interface receives the right eye data. The memory control unit stores data into the memory in accordance with the storage destination address sent from the DMAC. Note that a dedicated circuit for controlling the switching unit may be provided instead of the main control unit .

In the above description the device stream interface unit demultiplexing unit and switching unit are explained as a typical structure of the stream processing unit . However the stream processing unit may further include an encryption engine unit for decrypting received encrypted data key data or the like a secure management unit for controlling the execution of a device authentication protocol between the medium and the playback device and for holding a secret key and a controller for the direct memory access. In the above it has been explained that when the data received from the medium is stored into the memory the switching unit switches the storage destination depending on whether the received data is left eye data or right eye data. However not limited to this the data received from the medium may be temporarily stored into the memory and then when the data is to be transferred to the demultiplexing unit the data may be separated into the left eye data and the right eye data.

The image superimposing unit superimposes the decoded video base data. More specifically the image superimposing unit superimposes the PG subtitle and the IG menu onto the left view video data or the right view video data in units of pictures. A model of the image superimposing unit is for example Embodiment 11 and .

The image superimposing unit superimposes the left view plane and graphics plane and right view plane and left view plane. shows relationships between areas in the memory and each plane in the image superimposing process. The memory includes areas a left view plane data storage area a right view plane data storage area and a graphics plane data storage area for storing data that has been decoded and is to be rendered in each plane. It should be noted here that the planes may be areas in the memory or may be virtual spaces. The memory further includes a data storage area for storing data after image superimposition. are conceptual diagrams of image superimposition. For the sake of convenience the following description presumes that the image superimposing process is performed in the one plane offset mode in which one graphics plane is used and when the graphics plane is superimposed with the left view plane an offset of X is applied to the graphics plane and when the graphics plane is superimposed with the right view plane an offset of X is applied. Note however that two graphics planes may be prepared for the superimposing process and the graphics planes may be superimposed with the left view plane and the right view plane respectively with respective offset values applied thereto. shows that the graphics plane having been translated rightward on paper by the predetermined offset value is superimposed with the left view plane. shows that the graphics plane having been translated leftward on paper by the predetermined offset value is superimposed with the right view plane. As shown in these figures pixels corresponding to each other being positioned at the same coordinates in the horizontal direction on paper are superimposed with each other and the data after the superimposition is stored into the data storage area for storing data after image superimposition in the memory . Note that as described earlier the offset values to be applied to the graphics plane are included in the right view video stream sub view video stream or the playlist. is a conceptual diagram showing another method of image superimposing. According to this method the memory further includes post offset graphics plane data storage areas for left view superimposition and right view superimposition the data to be superimposed with the left view plane and the right view plane is prepared in advance in the memory the image superimposing unit reads out necessary data from the memory and superimposes the read data and stores the data after the superimposition into the data storage area for storing data after image superimposition in the memory . is a conceptual diagram concerning superimposition of the text subtitle different from PG IG . As described earlier the text subtitle has been multiplexed in the text subtitle stream. The text subtitle is rendered in the graphics plane and then superimposed. For the superimposing with the left view plane and the right view plane the text subtitle is rendered in the graphics plane by being shifted by respective offset values and the graphics planes are superimposed with the left view plane and the right view plane respectively. Note that as shown in the memory further includes a text subtitle plane data storage area.

The video output format converting unit performs the following processes and the like as necessary the resize process for enlarging or reducing the decoded video base data the IP conversion process for converting the scanning method from the progressive method to the interlace method and vice versa the noise reduction process for removing the noise and the frame rate conversion process for converting the frame rate.

The audio video output interface unit encodes in accordance with the data transmission format the video base data which has been subjected to the image superimposing and the format conversion and the decoded audio base data. Note that as will be described later the audio video output interface unit may be provided outside the integrated circuit .

The analog video output interface unit converts and encodes the video base data which has been subjected to the image superimposing process and the output format conversion process into the analog video signal format and outputs the conversion result. The analog video output interface unit is for example a composite video encoder that supports any of the NTSC method PAL method and SECAM method an encoder for the S image signal Y C separation an encoder for the component image signal or a DAC D A converter .

The digital video audio output interface unit overlays the decoded audio base data with the video base data having been subjected to the image superimposing and the output format conversion encrypts the overlaid data encodes in accordance with the data transmission standard and outputs the encoded data. The digital video audio output interface unit is for example HDMI High Definition Multimedia Interface .

The analog audio output interface unit being an audio DAC or the like performs the D A conversion onto the decoded audio base data and outputs analog audio data.

The transmission format of the video base data and audio base data may be switched depending on the data receiving device data input terminal supported by the display device speaker or may be switched in accordance with the selection by the user. Furthermore it is possible to transmit a plurality of pieces of data corresponding to the same content in parallel by a plurality of transmission formats not limited to the transmission by a single transmission format.

In the above description the image superimposing unit video output format converting unit and audio video output interface unit are explained as a typical structure of the AV output unit . However the AV output unit may further include for example a graphics engine unit for performing the graphics processing such as the filter process image overlaying curvature drawing and 3D display.

This completes the description of the structure of the playback device in the present embodiment. Note that all of the functional blocks included in the integrated circuit may not be embedded and that conversely the memory shown in may be embedded in the integrated circuit . Also in the present embodiment the main control unit and the signal processing unit have been described as different functional blocks. However not limited to this the main control unit may perform a part of the process performed by the signal processing unit .

The route of the control buses and the data buses in the integrated circuit is designed in an arbitrary manner depending on the processing procedure of each processing block or the contents of the processing. However the data buses may be arranged so that the processing blocks are connected directly as shown in or maybe arranged so that the processing blocks are connected via the memory the memory control unit as shown in .

The integrated circuit may be a multi chip module that is generated by enclosing a plurality of chips into one package and its outer appearance is one LSI. It is also possible to realize the system LSI by using the FPGA Field Programmable Gate Array that can be re programmed after the manufacturing of the LSI or the reconfigurable processor in which the connection and setting of the circuit cells inside the LSI can be reconfigured.

S the data received read in S is separated into various data the video base data and the audio base data the stream processing unit .

S the various data generated by the separation in S are decoded by the appropriate format the signal processing unit .

S among the various data decoded in S the video base data is subjected to the superimposing process the AV output unit .

S the video base data and the audio base data having been subjected to the processes in S through S are output the AV output unit .

S the device stream interface unit of the stream processing unit receives reads out data playlist clip information etc. which is other than the data stored in the medium to be played back and is necessary for playback of the data via the interface unit and stores the received data into the memory the interface unit the device stream interface unit the memory control unit the memory .

S the main control unit recognizes the compression method of the video and audio data stored in the medium by referring to the stream attribute included in the received clip information and initializes the signal processing unit so that the corresponding decode processing can be performed the main control unit .

S the device stream interface unit of the stream processing unit receives reads out the data of video audio that is to be played back from the medium via the interface unit and stores the received data into the memory via the stream processing unit and the memory control unit . Note that the data is received read in units of Extents and the main control unit controls the switching unit so that when the left eye data is received read the received data is stored in the first area and when the right eye data is received read the received data is stored in the second area and the switching unit switches the data output destination storage destination the interface unit the device stream interface unit the main control unit the switching unit the memory control unit the memory .

S the data stored in the memory is transferred to the demultiplexing unit of the stream processing unit and the demultiplexing unit identifies the video base data main video sub video PG subtitle IG menu and audio base data audio sub audio based on the PIDs included in the source packets constituting the stream data and transfers the data to each corresponding decoder in the signal processing unit in units of TS packets the demultiplexing unit .

S each in the signal processing unit performs the decode process onto the transferred TS packets by the appropriate method the signal processing unit .

S among the video base data decoded by the signal processing unit the data corresponding to the left view video stream and the right view video stream is resized based on the display device the video output format converting unit .

S the PG subtitle and IG menu are superimposed onto the video stream resized in S the image superimposing unit .

S the IP conversion which is a conversion of the scanning method is performed onto the video data after the superimposing in S the video output format converting unit .

S the encoding D A conversion and the like are performed onto video base data and the audio base data having been subjected to the above described processes based on the data output format of the display device speaker or the data transmission format for transmission to the display device speaker. The composite video signal the S image signal the component image signal and the like are supported for the analog output of the video base data. Also HDMI is supported for the digital output of the video base data and the audio base data. the audio video output interface unit 

S the video base data and the audio base data having been subjected to the process in S is output and transmitted to the display device speaker the audio video output interface unit the display device speaker .

This completes the description of the operation procedure of the playback device in the present embodiment. Note that the result of process may be temporarily stored into the memory each time a process is completed. Also in the above operation procedure the video output format converting unit performs the resize process and the IP conversion process. However not limited to this the processes may be omitted as necessary or other processes noise reduction process frame rate conversion process etc. may be performed. Furthermore the processing procedures may be changed if possible.

Up to now the present invention has been described through the best embodiments that the Applicant recognize as of now. However further improvements or changes can be added regarding the following technical topics. Whether to select any of the embodiments or the improvements and changes to implement the invention is optional and may be determined by the subjectivity of the implementer.

As described above the depth of each macro block constituting an image may be stored in a different one of a plurality of offset sequences. However this structure is merely one example.

As another example a plurality of pieces of depth information indicating depths that differ from each other in order by 10 or 10 may be set as plane offset direction information of each offset sequence and as plane offset shift values.

In Embodiment 3 as a specific example of association using the identification information the identification number of the right view is generated by adding 1 to the identification number of the left view. However not limited to this the identification number of the right view may be generated by adding 10000 to the identification number of the left view.

When a coupling method is to be realized to associate the files by the file names the playback device side requires a mechanism for detecting the coupled files and a mechanism for detecting the file based on a predetermined rule and playing back files that are not referenced by the playlist. The 3D supporting playback devices require the above described mechanisms when they use any of such coupling methods. However with this structure there is no need to use different types of playlists to play back both the 2D and 3D images and it is possible to make the playlist operate safely in the conventional 2D playback devices that are already prevalent.

As in the Depth method in which the grayscale is used when the stereoscopic image cannot be played back only with one stream it is necessary to distinguish the stream by assigning a different extension thereto to prevent it from being played back singly by the device by mistake. In connection with the identification of the file that cannot be played back singly it is necessary to prevent the user from being confused when the 3D file is referenced from an existing device via DLNA Digital Living Network Alliance . It is possible to realize the pairing information only by the file names by assigning the same file number and different extensions.

According to the parallax image method used in Embodiment 1 the left eye and right eye images are displayed alternately in the time axis direction. As a result for example when 24 images are displayed per second in a normal two dimensional movie 48 images for the combination of the left eye and right eye images should be displayed per second in a three dimensional movie. Accordingly this method is suitable for display devices that rewrite each screen at relatively high speeds. The stereoscopic viewing using the parallax images is used in the play equipment of the amusement parks and has been established technologically. Therefore it may be said that this method is closest to the practical use in the homes. There have been proposed various other technologies such as the two color separation method as the methods for realizing stereoscopic viewing using the parallax images. In the embodiments the sequential segregation method and the polarization glasses method have been used as examples. However the present invention is not limited to these methods as far as the parallax images are used.

Also not limited to the lenticular lens the television may use other devices such as the liquid crystal element that have the same function as the lenticular lens. It is further possible to realize the stereoscopic viewing by providing a vertical polarization filter for the left eye pixels and providing a horizontal polarization filter for the right eye pixels and causing the viewer to view the screen through a pair of polarization glasses that is provided with a vertical polarization filter for the left eye and a horizontal polarization filter for the right eye.

The left view and right view may be prepared not only to be applied to the video stream representing the main story but also to be applied to the thumbnail images. As is the case with the video stream the 2D playback device displays conventional 2D thumbnail images but the 3D playback device outputs a left eye thumbnail image and a right eye thumbnail image prepared for the 3D in compliance with a 3D display system.

Similarly the left view and right view may be applied to menu images thumbnail images of each scene for chapter search and reduced images of each scene.

The application program described in each embodiment of the present invention can be produced as follows. First the software developer writes using a programming language a source program that achieves each flowchart and functional component. In this writing the software developer uses the class structure variables array variables calls to external functions and so on which conform to the sentence structure of the programming language he she uses.

The written source program is sent to the compiler as files. The compiler translates the source program and generates an object program.

The translation performed by the compiler includes processes such as the syntax analysis optimization resource allocation and code generation. In the syntax analysis the characters and phrases sentence structure and meaning of the source program are analyzed and the source program is converted into an intermediate program. In the optimization the intermediate program is subjected to such processes as the basic block setting control flow analysis and data flow analysis. In the resource allocation to adapt to the instruction sets of the target processor the variables in the intermediate program are allocated to the register or memory of the target processor. In the code generation each intermediate instruction in the intermediate program is converted into a program code and an object program is obtained.

The generated object program is composed of one or more program codes that cause the computer to execute each step in the flowchart or each procedure of the functional components. There are various types of program codes such as the native code of the processor and Java byte code. There are also various forms of realizing the steps of the program codes. For example when each step can be realized by using an external function the call statements for calling the external functions are used as the program codes. Program codes that realize one step may belong to different object programs. In the RISC processor in which the types of instructions are limited each step of flowcharts may be realized by combining arithmetic operation instructions logical operation instructions branch instructions and the like.

After the object program is generated the programmer activates a linker. The linker allocates the memory spaces to the object programs and the related library programs and links them together to generate a load module. The generated load module is based on the presumption that it is read by the computer and causes the computer to execute the procedures indicated in the flowcharts and the procedures of the functional components. The program described here may be recorded on a computer readable recording medium and may be provided to the user in this form.

The BD ROM drive is equipped with an optical head that includes a semiconductor laser collimated lens beam splitter objective lens collecting lens and light detector. The light beams emitted from the semiconductor laser pass through the collimated lens beam splitter and objective lens and are collected on the information surface of the optical disc.

The collected light beams are reflected diffracted on the optical disc pass through the objective lens beam splitter and collimated lens and are collected in the light detector. A playback signal is generated depending on the amount of light collected in the light detector.

The recording medium described in each Embodiment indicates a general package medium as a whole including the optical disc and the semiconductor memory card. In each Embodiment it is presumed as one example that the recording medium is an optical disc in which necessary data is preliminarily recorded for example an existing read only optical disc such as the BD ROM or DVD ROM . However the present invention is not limited to this. For example the present invention may be implemented as follows i obtain a 3D content that includes the data necessary for implementing the present invention and is distributed by a broadcast or via a network ii record the 3D content into a writable optical disc for example an existing writable optical disc such as the BD RE DVD RAM by using a terminal device having the function of writing into an optical disc the function may be embedded in a playback device or the device may not necessarily be a playback device and iii apply the optical disc recorded with the 3D content to the playback device of the present invention.

The following describes embodiments of the recording device for recording the data structure of each Embodiment into a semiconductor memory and the playback device for playing back thereof.

First the mechanism for protecting the copyright of the data recorded on the BD ROM will be explained as a presupposed technology.

Some of the data recorded on the BD ROM may have been encrypted as necessitated in view of the confidentiality of the data.

For example the BD ROM may contain as encrypted data the data corresponding to a video stream an audio stream or a stream including these.

The semiconductor memory card playback device preliminarily stores data for example a device key that corresponds to a key that is necessary for decrypting the encrypted data recorded on the BD ROM.

On the other hand the BD ROM is preliminarily recorded with i data for example a medium key block MKB corresponding to the above mentioned device key that corresponds to a key that is necessary for decrypting the encrypted data and ii encrypted data for example an encrypted title key corresponding to the above mentioned device key and MKB that is generated by encrypting the key itself that is necessary for decrypting the encrypted data. Note here that the device key MKB and encrypted title key are treated as a set and are further associated with an identifier for example a volume ID written in an area called BCA of the BD ROM that cannot be copied in general. It is structured such that encrypted data cannot be decrypted if these elements are combined incorrectly. Only if the combination is correct a key for example a title key that is obtained by decrypting the encrypted title key by using the above mentioned device key MKB and volume ID that is necessary for decrypting the encrypted data can be derived. The encrypted data can be decrypted by using the derived key.

When a playback device attempts to play back a BD ROM loaded in the device it cannot play back the encrypted data unless the device itself has a device key that makes a pair or corresponds to the encrypted title key and MKB recorded on the BD ROM. This is because the key title key that is necessary for decrypting the encrypted data has been encrypted and is recorded on the BD ROM as the encrypted title key and the key that is necessary for decrypting the encrypted data cannot be derived if the combination of the MKB and the device key is not correct.

Conversely when the combination of the encrypted title key MKB device key and volume ID is correct the video stream and audio stream are decoded by the decoder with use of the above mentioned key for example a title key that is obtained by decrypting the encrypted title key by using the device key MKB and volume ID that is necessary for decrypting the encrypted data. The playback device is structured in this way.

This completes the description of the mechanism for protecting the copyright of the data recorded on the BD ROM. It should be noted here that this mechanism is not limited to the BD ROM but may be applicable to for example a readable writable semiconductor memory such as a portable semiconductor memory such as the SD card for the implementation.

Next the playback procedure in the semiconductor memory card playback device will be described. In the case in which the playback device plays back an optical disc it is structured to read data via an optical disc drive for example. On the other hand in the case in which the playback device plays back a semiconductor memory card it is structured to read data via an interface for reading the data from the semiconductor memory card.

More specifically the playback device may be structured such that when a semiconductor memory card is inserted into a slot not illustrated provided in the playback device the playback device and the semiconductor memory card are electrically connected with each other via the semiconductor memory card interface and the playback device reads out data from the semiconductor memory card via the semiconductor memory card interface.

The playback device explained in each Embodiment may be realized as a terminal device that receives data distribution data that corresponds to the data explained in each Embodiment from a distribution server for an electronic distribution service and records the received data into a semiconductor memory card.

Such a terminal device may be realized by structuring the playback device explained in each Embodiment so as to perform such operations or may be realized as a dedicated terminal device that is different from the playback device explained in each Embodiment and stores the distribution data into a semiconductor memory card. Here a case where the playback device is used will be explained. Also in this explanation an SD card is used as the recording destination semiconductor memory.

When the playback device is to record distribution data into an SD memory card inserted in a slot provided therein the playback device first send requests a distribution server not illustrated that stores distribution data to transmit the distribution data. In so doing the playback device reads out identification information for uniquely identifying the inserted SD memory card for example identification information uniquely assigned to each SD memory card more specifically the serial number or the like of the SD memory card from the SD memory card and transmits the read identification information to the distribution server together with the distribution request.

The identification information for uniquely identifying the SD memory card corresponds to for example the volume ID having been described earlier.

On the other hand the distribution server stores necessary data for example video stream audio stream and the like in an encrypted state such that the necessary data can be decrypted by using a predetermined key for example a title key .

The distribution server for example holds a private key so that it can dynamically generate different pieces of public key information respectively in correspondence with identification numbers uniquely assigned to each semiconductor memory card.

Also the distribution server is structured to be able to encrypt the key title key itself that is necessary for decrypting the encrypted data that is to say the distribution server is structured to be able to generate an encrypted title key .

The generated public key information includes for example information corresponding to the above described MKB volume ID and encrypted title key. With this structure when for example a combination of the identification number of the semiconductor memory card the public key contained in the public key information which will be explained later and the device key that is preliminarily recorded in the playback device is correct a key for example a title key that is obtained by decrypting the encrypted title key by using the device key the MKB and the identification number of the semiconductor memory necessary for decrypting the encrypted data is obtained and the encrypted data is decrypted by using the obtained necessary key title key .

Following this the playback device records the received piece of public key information and distribution data into a recording area of the semiconductor memory card being inserted in the slot thereof.

Next a description is given of an example of the method for decrypting and playing back the encrypted data among the data contained in the public key information and distribution data recorded in the recording area of the semiconductor memory card.

The received public key information stores for example a public key for example the above described MKB and encrypted title key signature information identification number of the semiconductor memory card and device list being information regarding devices to be invalidated.

The device list is for example information for identifying the devices that might be played back in an unauthorized manner. The information for example is used to uniquely identify the devices parts of the devices and functions programs that might be played back in an unauthorized manner and is composed of for example the device key and the identification number of the playback device that are preliminarily recorded in the playback device and the identification number of the decoder provided in the playback device.

The following describes playing back the encrypted data among the distribution data recorded in the recording area of the semiconductor memory card.

First it is checked whether or not the decryption key itself can be used before the encrypted data is decrypted by using the decryption key.

 1 A check on whether the identification information of the semiconductor memory card contained in the public key information matches the identification number of the semiconductor memory card preliminarily stored in the semiconductor memory card.

 2 A check on whether the hash value of the public key information calculated in the playback device matches the hash value included in the signature information.

 3 A check based on the information included in the device list on whether the playback device to perform the playback is authentic for example the device key shown in the device list included in the public key information matches the device key preliminarily stored in the playback device .

After the above described checks 1 through 3 the playback device performs a control not to decrypt the encrypted data when any of the following conditions is satisfied i the identification information of the semiconductor memory card contained in the public key information does not match the identification number of the semiconductor memory card preliminarily stored in the semiconductor memory card ii the hash value of the public key information calculated in the playback device does not match the hash value included in the signature information and iii the playback device to perform the playback is not authentic.

On the other hand when all of the conditions i the identification information of the semiconductor memory card contained in the public key information matches the identification number of the semiconductor memory card preliminarily stored in the semiconductor memory card ii the hash value of the public key information calculated in the playback device matches the hash value included in the signature information and iii the playback device to perform the playback is authentic are satisfied it is judged that the combination of the identification number of the semiconductor memory the public key contained in the public key information and the device key that is preliminarily recorded in the playback device is correct and the encrypted data is decrypted by using the key necessary for the decryption the title key that is obtained by decrypting the encrypted title key by using the device key the MKB and the identification number of the semiconductor memory .

When the encrypted data is for example a video stream and an audio stream the video decoder decrypts decodes the video stream by using the above described key necessary for the decryption the title key that is obtained by decrypting the encrypted title key and the audio decoder decrypts decodes the audio stream by using the above described key necessary for the decryption.

With such a structure when devices parts of the devices and functions programs that might be used in an unauthorized manner are known at the time of the electronic distribution a device list showing such devices and the like may be distributed. This enables the playback device having received the list to inhibit the decryption with use of the public key information public key itself when the playback device includes anything shown in the list. Therefore even if the combination of the identification number of the semiconductor memory the public key itself contained in the public key information and the device key that is preliminarily recorded in the playback device is correct a control is performed not to decrypt the encrypted data. This makes it possible to prevent the distribution data from being used by an unauthentic device.

It is preferable that the identifier of the semiconductor memory card that is preliminarily recorded in the semiconductor memory card is stored in a highly secure recording area. This is because when the identification number for example the serial number of the SD memory card that is preliminarily recorded in the semiconductor memory card is tampered with unauthorized copying becomes easy. More specifically unique although different identification numbers are respectively assigned to semiconductor memory cards if the identification numbers are tampered with to be the same the above described judgment in 1 does not make sense and as many semiconductor memory cards as tamperings may be copied in an unauthorized manner.

For this reason it is preferable that information such as the identification number of the semiconductor memory card is stored in a highly secure recording area.

To realize this the semiconductor memory card for example may have a structure in which a recording area for recording highly confidential data such as the identifier of the semiconductor memory card hereinafter the recording area is referred to as a second recording area is provided separately from a recording area for recording regular data hereinafter the recording area is referred to as a first recording area a control circuit for controlling accesses to the second recording area is provided and the second recording area is accessible only through the control circuit.

For example data may encrypted so that encrypted data is recorded in the second recording area and the control circuit may be embedded with a circuit for decrypting the encrypted data. In this structure when an access is made to the second recording area the control circuit decrypts the encrypted data and returns decrypted data. As another example the control circuit may hold information indicating the location where the data is stored in the second recording area and when an access is made to the second recording area the control circuit identifies the corresponding storage location of the data and returns data that is read from the identified storage location.

An application which is running on the playback device and is to record data onto the semiconductor memory card with use of the electronic distribution issues to the control circuit via a memory card interface an access request requesting to access the data for example the identification number of the semiconductor memory card recorded in the second recording area. Upon receiving the request the control circuit reads out the data from the second recording area and returns the data to the application running on the playback device. It sends the identification number of the semiconductor memory card and requests the distribution server to distribute the data such as the public key information and corresponding distribution data. The public key information and corresponding distribution data that are sent from the distribution server are recorded into the first recording area.

Also it is preferable that the application which is running on the playback device and is to record data onto the semiconductor memory card with use of the electronic distribution preliminarily checks whether or not the application is tampered with before it issues to the control circuit via a memory card interface an access request requesting to access the data for example the identification number of the semiconductor memory card recorded in the second recording area. For checking this an existing digital certificate conforming to the X.509 standard for example may be used.

Also the distribution data recorded in the first recording area of the semiconductor memory card may not necessarily be accessed via the control circuit provided in the semiconductor memory card.

The information recording medium of the present invention stores a 3D image but can be played back in both 2D image playback devices and 3D image playback devices. This makes it possible to distribute movie contents such as movie titles storing 3D images without causing the consumers to be conscious about the compatibility. This activates the movie market and commercial device market. Accordingly the recording medium and the playback device of the present invention have high usability in the movie industry and commercial device industry.

