---

title: Blood treatment systems and methods
abstract: Dialysis systems are disclosed comprising new fluid flow circuits. Systems may include blood and dialysate flow paths, where the dialysate flow path includes balancing, mixing, and/or directing circuits. Dialysis systems may include a safety system utilizing a field programmable gate array (FPGA) that monitors at least conductivity and temperature of dialysate in the flow circuit upstream of a dialyzer and enters a fail-safe state if the measured conductivity is outside of a range of values. The FPGA may be verified to be operating properly by exposing sensors in fluid paths to temperatures or conductivities that are outside pre-determined permissible ranges of values, and confirming that the FPGA safety system enters a fail-safe state in response to the temperatures or conductivities. The FPGA may be configured to monitor an amount of ultrafiltration fluid withdrawn from a patient during dialysis treatment and to enter a fail-safe state if a maximum amount is exceeded.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09517295&OS=09517295&RS=09517295
owner: DEKA Products Limited Partnership
number: 09517295
owner_city: Manchester
owner_country: US
publication_date: 20120524
---
This application is a continuation in part of U.S. application Ser. No. 12 549 285 now U.S. Pat. No. 8 409 441 entitled Blood Treatment Systems and Methods filed on Aug. 27 2009 which claims the benefit under 35 U.S.C. 119 e of U.S. Provisional Application Ser. No. 61 092 239 filed on Aug. 27 2008 and which is a continuation in part of U.S. application Ser. No. 12 199 452 now U.S. Pat. No. 8 357 298 entitled Hemodialysis Systems and Methods filed on Aug. 27 2008 which is a continuation in part of U.S. application Ser. No. 12 072 908 now U.S. Pat. No. 8 246 826 entitled Hemodialysis Systems and Methods filed on Feb. 27 2008 which claims the benefit under 35 U.S.C. 119 e of U.S. Provisional Application Ser. No. 60 903 582 filed on Feb. 27 2007 and which claims the benefit under 35 U.S.C. 119 e of U.S. Provisional Application Ser. No. 60 904 024 filed on Feb. 27 2007.

This application also claims the benefit under 35 U.S.C. 119 e of U.S. Provisional Application Ser. No. 61 489 544 entitled Blood Treatment Systems and Methods filed on May 24 2011 and U.S. Provisional Application Ser. No. 61 498 394 entitled Blood Treatment Systems and Methods filed on Jun. 17 2011. All of the above referenced applications are incorporated herein by reference in their entireties.

The present invention generally relates to hemodialysis and similar dialysis systems e.g. systems able to treat blood or other bodily fluids extracorporeally. In certain aspects the systems include a variety of systems and methods that would make hemodialysis more efficient easier and or more affordable.

Many factors make hemodialysis inefficient difficult and expensive. These factors include the complexity of hemodialysis the safety concerns related to hemodialysis and the very large amount of dialysate needed for hemodialysis. Moreover hemodialysis is typically performed in a dialysis center requiring skilled technicians. Therefore any increase in the ease and efficiency of the dialysis process could have an impact on treatment cost or patient outcome.

A dialysate pump draws dialysate from a dialysate supply and causes the dialysate to pass through the dialyzer after which the dialysate can pass through a waste valve and or return to the dialysate feed via dialysate pump . A dialysate valve controls the flow of dialysate from the dialysate supply . The dialyzer is a type of filter having a semi permeable membrane and is constructed such that the blood from the blood flow circuit flows through tiny tubes and the dialysate solution circulates around the outside of the tubes. Therapy is achieved by the passing of waste molecules e.g. urea creatinine etc. and water from the blood through the walls of the tubes and into the dialysate solution. At the end of treatment the dialysate solution is discarded.

The present invention generally relates to hemodialysis and similar extracorporeal blood treatment systems. The subject matter of the present invention involves in some cases interrelated products alternative solutions to a particular problem and or a plurality of different uses of one or more systems and or articles. Although the various systems and methods described herein are described in relation to hemodialysis it should be understood that the various systems and method described herein are applicable to other dialysis systems and or in any extracorporeal system able to treat blood or other bodily fluids such as hemofiltration hemodiafiltration etc.

In one aspect the system includes four fluid paths blood inner dialysate outer dialysate and dialysate mixing. In some embodiments these four paths are combined in a single cassette. In other embodiments these four paths are each in a respective cassette. In still other embodiments two or more fluid paths are included on one cassette.

In one embodiment there is provided a hemodialysis system having at least two fluid paths integrated into 1 a blood flow pump cassette 2 an inner dialysate cassette 3 an outer dialysate cassette and 4 a mixing cassette. The cassettes may be fluidly connected one to another. In some embodiments one or more aspects of these cassettes can be combined into a single cassette.

Also provided in another embodiment is a hemodialysis system including a blood flow path through which untreated blood is drawn from a patient and is passed through a dialyzer and through which treated blood is returned to the patient. The blood flow path may include at least one blood flow pump located in a removable cassette. The hemodialysis system also can include a first receiving structure for receiving the blood flow path s cassette a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer a second receiving structure for receiving the dialysate flow path s cassette and a control fluid path for providing a control fluid from an actuator mechanism to the cassettes for actuating each of the blood flow pump and the dialysate pump. In some instances the dialysate flow path can include at least one dialysate pump located in a removable cassette.

In yet another embodiment a hemodialysis system is disclosed. The hemodialysis system in this embodiment includes a blood flow path through which untreated blood is drawn from a patient and is passed through a dialyzer and through which treated blood is returned to the patient. The blood flow path may include at least one blood valve. The hemodialysis system may also include a control fluid path for providing a control fluid from an actuator mechanism to the blood valve for actuating the blood valve a dialysate mixing system fluidly connected to the dialyzer which may include at least one dialyzer valve and a heating means or a heater for heating the dialysate.

A hemodialysis system is disclosed in yet another embodiment that includes a blood flow path through which untreated blood is drawn from a patient and passed through a dialyzer and through which treated blood is returned to the patient. The blood flow path can include at least one blood flow pump. The hemodialysis system also can include a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer. The dialysate flow path may include at least one pneumatic pump.

In one aspect the invention is directed to a hemodialysis system. In one set of embodiments the hemodialysis system includes a blood flow path a first cassette defining an inner dialysate fluid path a dialyzer in fluid communication with the blood flow path and the inner dialysate fluid path a second cassette defining an outer dialysate fluid path and a filter fluidly connecting the first cassette to the second cassette.

In another set of embodiments the hemodialysis system includes a blood flow path an inner dialysate fluid path a dialyzer in fluid communication with the blood flow path and the inner dialysate fluid path an outer dialysate fluid path a filter fluidly connecting the inner dialysate fluid path and the outer dialysate fluid path a first dialysate pump for pumping dialysate through the inner dialysate fluid path and a second dialysate pump for pumping dialysate through the outer dialysate fluid path where the second dialysate pump and the first dialysate pump are operably connected such that flow through the inner dialysate fluid path is substantially equal to flow through the outer dialysate fluid path.

The hemodialysis system in yet another set of embodiments includes a blood flow path through which blood is drawn from a patient and passed through a dialyzer and a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer. In some cases the dialysate flow path comprises a balancing cassette which controls the amount of dialysate passing through the dialyzer a mixing cassette which forms dialysate from water and a directing cassette which passes water from a water supply to the mixing cassette and passes dialysate from the mixing cassette to the balancing cassette.

In still another set of embodiments the hemodialysis system includes a cassette system comprising a directing cassette a mixing cassette and a balancing cassette. In some cases the directing cassette is able to direct water from a water supply to the mixing cassette and direct dialysate from the mixing cassette to a balancing cassette the mixing cassette is able to mix water from the directing cassette with dialysate from a dialysate supply precursor to produce a precursor and the balancing cassette is able to control the amount of dialysate passing through a dialyzer.

In one set of embodiments the hemodialysis system includes a blood flow path through which blood is drawn from a patient and passed through a dialyzer the blood flow path including a blood flow pump a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer where the dialysate flow path includes a dialysate pump and a control fluid path through which a control fluid actuates the blood flow pump and the dialysate pump.

The hemodialysis system in another set of embodiments comprises a blood flow path through which blood is drawn from a patient and passed through a dialyzer and a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer. In some cases the dialysate flow path includes at least one pneumatic pump.

The hemodialysis system in still another set of embodiments includes a first pump comprising a pumping chamber and an actuation chamber a second pump comprising a pumping chamber and an actuation chamber a control fluid in fluidic communication with each of the actuation chambers of the first and second pumps and a controller able to pressurize the control fluid to control operation of the first and second pumps.

In yet another set of embodiments the hemodialysis system includes a first valve comprising a valving chamber and an actuation chamber a second valve comprising a valving chamber and an actuation chamber a control fluid in fluidic communication with each of the actuation chambers of the first and second valves and a controller able to pressurize the control fluid to control operation of the first and second valves.

In one set of embodiments the hemodialysis system includes a blood flow path through which blood is drawn from a patient and passed through a dialyzer a cassette containing at least a portion of the blood flow path and a spike integrally formed with the cassette the spike able to receive a vial of fluid the integrally formed spike in fluidic communication with the blood flow path within the cassette.

The hemodialysis system in another set of embodiments includes a blood flow path through which untreated blood is drawn from a patient and passed through a dialyzer a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer the dialyzer permitting dialysate to pass from the dialysate flow path to the blood flow path and a gas supply in fluidic communication with the dialysate flow path so that when activated gas from the gas supply causes the dialysate to pass through the dialyzer and urge blood in the blood flow path back to the patient.

In yet another set of embodiments the hemodialysis system includes a blood flow path through which untreated blood is drawn from a patient and passed through a dialyzer a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer the dialyzer permitting dialysate to pass from the dialysate flow path to the blood flow path a fluid supply a chamber in fluid communication with the fluid supply and the dialysate fluid path the chamber having a diaphragm separating fluid of the fluid supply from dialysate of the dialysate flow path and a pressurizing device for pressurizing the fluid supply to urge the diaphragm against the dialysate in the chamber so as to cause the dialysate to pass through the dialyzer and urge blood in the blood flow path back to the patient.

The hemodialysis system in still another set of embodiments includes a blood flow path through which untreated blood is drawn from a patient and passed through a dialyzer a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer the dialysate flow path and the blood flow path being in fluidic communication and a pressure device able to urge dialysate in the dialysate flow path to flow into the blood flow path.

In one set of embodiments the hemodialysis system includes a first housing containing a positive displacement pump actuated by a control fluid a fluid conduit fluidly connecting the positive displacement pump with a control fluid pump and a second housing containing the control fluid pump where the second housing is detachable from the first housing.

In another set of embodiments the hemodialysis system includes a housing comprising a first compartment and a second compartment separated by an insulating wall the first compartment being sterilizable at a temperature of at least about 80 C. the second compartment containing electronic components that when the first compartment is heated to a temperature of at least about 80 C. are not heated to a temperature of more than 60 C.

The hemodialysis system in yet another set of embodiments includes a blood flow path through which untreated blood is drawn from a patient and passed through a dialyzer the blood flow path including at least one blood valve a control fluid path for providing a control fluid from an actuator mechanism to the blood valve for actuating the blood valve a dialysate mixing system fluidly connected to the dialyzer including at least one dialyzer valve and a heater for heating the dialysate.

Another aspect of the present invention is directed to a valving system. In one set of embodiments the valving system includes a valve housing containing a plurality of valves at least two of which valves each comprises a valving chamber and an actuation chamber each of the at least two valves being actuatable by a control fluid in the actuation chamber a control housing having a plurality of fluid interface ports for providing fluid communication with a control fluid from a base unit and a plurality of tubes extending between the valve housing and the control housing each tube providing fluid communication between one of the fluid interface ports and at least one of the actuation chambers such that the base unit can actuate a valve by pressurizing control fluid in the fluid interface port.

In one set of embodiments the invention is directed to a valve including a first plate a second plate the second plate having an indentation on a side facing the first plate the indentation having a groove defined therein the groove being open in a direction facing the first plate a third plate wherein the second plate is located between the first and third plate and a diaphragm located in the indentation between the first plate and the second plate the diaphragm having a rim the rim being held in the groove. The second plate may include a valve seat arranged so that the diaphragm may be urged by pneumatic pressure to seal the valve seat closed the groove surrounding the valve seat. In some cases a valve inlet and a valve outlet are defined between the second and third plates. In one embodiment a passage for providing pneumatic pressure is defined between the first and second plates.

Yet another aspect of the present invention is directed to a pumping system. The pumping system in one set of embodiments includes a pump housing containing a plurality of pumps at least two of which pumps each includes a pumping chamber and an actuation chamber each of the at least two pumps being actuatable by a control fluid in the actuation chamber a control housing having a plurality of fluid interface ports for providing fluid communication with a control fluid from a base unit and a plurality of tubes extending between the pump housing and the control housing each tube providing fluid communication between one of the fluid interface ports and at least one of the actuation chambers such that the base unit can actuate a pump by pressurizing control fluid in the fluid interface port.

The invention is generally directed to a pumping cassette in another aspect. In one set of embodiments the pumping cassette includes at least one fluid inlet at least one fluid outlet a flow path connecting the at least one fluid inlet and the at least one fluid outlet and a spike for attaching a vial to said cassette. The spike may be in fluidic communication with the flow path in some cases.

In one aspect the invention is generally directed to a pumping cassette for balancing flow to and from a target. In one set of embodiments the pumping cassette includes a cassette inlet a supply line to the target a return line from the target a cassette outlet a pumping mechanism for causing fluid to flow from the cassette inlet to the supply line and from the return line to the cassette outlet and a balancing chamber. In some cases the pumping mechanism includes a pod pump comprising a rigid curved wall defining a pumping volume and having an inlet and an outlet a pump diaphragm mounted within the pumping volume and an actuation port for connecting the pod pump to a pneumatic actuation system so that the diaphragm can be actuated to urge fluid into and out of the pumping volume wherein the pump diaphragm separates the fluid from a gas in fluid communication with the pneumatic actuation system. In certain instances the balancing chamber includes a rigid curved wall defining a balance volume and a balance diaphragm mounted within the balance volume where the balance diaphragm separates the balance volume into a supply side and a return side each of the supply side and the return side having an inlet and an outlet. In some cases fluid from the cassette inlet flows to the supply side inlet fluid from the supply side outlet flows to the supply line fluid from the return line flows to the return side inlet and fluid from the return side outlet flows to the cassette outlet.

In another set of embodiments the pumping system includes a system inlet a supply line to the target a return line from the target a system outlet a pumping mechanism for causing fluid to flow from the system inlet to the supply line and from the return line to the system outlet and a balancing chamber.

In one embodiment the pumping mechanism includes a pod pump comprising a rigid spheroid wall defining a pumping volume and having an inlet and an outlet a pump diaphragm mounted within and to the spheroid wall and a port for connecting the pod pump to a pneumatic actuation system so that the diaphragm can be actuated to urge fluid into and out of the pumping volume. In some cases the pump diaphragm separates the fluid from a gas in fluid communication with the pneumatic actuation system 

In certain instances the balancing chamber includes a rigid spheroid wall defining a balance volume and a balance diaphragm mounted within and to the spheroid wall. In one embodiment the balance diaphragm separates the balance volume into a supply side and a return side each of the supply side and the return side having an inlet and an outlet. In some cases fluid from the system inlet flows to the supply side inlet fluid from the supply side outlet flows to the supply line fluid from the return line flows to the return side inlet and fluid from the return side outlet flows to the system outlet. The pumping mechanism may also include valving mechanisms located at each of the inlets and outlets of the supply side and the return side. The valving mechanisms may be pneumatically actuated.

Yet another aspect of the invention is directed to a cassette. In one set of embodiments the cassette includes a first flow path connecting a first inlet to a first outlet a second flow path connecting a second inlet to a second outlet a pump able to pump fluid through at least a portion of the second flow path and at least two balancing chambers each balancing chamber comprising a rigid vessel containing a diaphragm dividing the rigid vessel into a first compartment and a second compartment the first compartment of each balancing chamber being in fluidic communication with the first flow path and the second compartment being in fluidic communication with the second flow path.

In another set of embodiments the cassette includes a first flow path connecting a first inlet to a first outlet a second flow path connecting a second inlet to a second outlet a control fluid path at least two pumps each pump comprising a rigid vessel containing a diaphragm dividing the rigid vessel into a first compartment and a second compartment the first compartment of each pump being in fluidic communication with the control fluid path and the second compartment being in fluidic communication with the second flow path and a balancing chamber able to balance flow between the first flow path and the second flow path.

The cassette in still another set of embodiments includes a first flow path connecting a first inlet to a first outlet a second flow path connecting a second inlet to a second outlet and a rigid vessel containing a diaphragm dividing the rigid vessel into a first compartment and a second compartment. In some cases the first compartment are in fluidic communication with the first fluid path and the second compartment being in fluidic communication with the second flow path.

Still another aspect of the invention is generally directed at a pump. The pump includes in one set of embodiments a first rigid component a second rigid component the second rigid component having on a side facing the first plate a groove defined therein the groove being open in a direction facing the first rigid component and a diaphragm having a rim the rim being held in the groove by a friction fit in the groove but without contact by the first rigid component against the rim. In some cases the first and second rigid components define at least partially a pod pump chamber divided by the diaphragm into separate chambers and further define at least partially flow paths into the pod pump chamber wherein the groove surrounds the pod pump chamber.

In another set of embodiments the pump includes a substantially spherical vessel containing a flexible diaphragm dividing the rigid vessel into a first compartment and a second compartment the first compartment and the second compartment not in fluidic communication with each other whereby movement of the diaphragm due to fluid entering the first compartment causes pumping of fluid within the second compartment to occur.

In another set of embodiments the pump is a reciprocating positive displacement pump. In one embodiment the pump includes a rigid chamber wall a flexible diaphragm attached to the rigid chamber wall so that the flexible diaphragm and rigid chamber wall define a pumping chamber an inlet for directing flow through the rigid chamber wall into the pumping chamber an outlet for directing flow through the rigid chamber wall out of the pumping chamber a rigid limit wall for limiting movement of the diaphragm and limiting the maximum volume of the pumping chamber the flexible diaphragm and the rigid limit wall forming an actuation chamber a pneumatic actuation system that intermittently provides a control pressure to the actuation chamber. In some cases the pneumatic actuation system includes an actuation chamber pressure transducer for measuring the pressure of the actuation chamber a gas reservoir having a first pressure a variable valve mechanism for variably restricting gas flowing between the actuation chamber and the gas reservoir and a controller that receives pressure information from the actuation chamber pressure transducer and controls the variable valve so as to create the control pressure in the actuation chamber the control pressure being less than the first pressure.

Still another aspect of the invention is directed to a method. The method in one set of embodiments includes acts of providing a first pump comprising a pumping chamber and an actuation chamber and a second pump comprising a pumping chamber and an actuation chamber urging a common fluid into the actuation chambers of each of the first and second pumps and pressurizing the common fluid to pump fluids through each of the first and second pumps.

In another set of embodiments the method includes acts of providing a first valve comprising a valving chamber and an actuation chamber and a second valve comprising a valving chamber and an actuation chamber urging a common fluid into the actuation chambers of each of the first and second valves and pressurizing the common fluid to at least partially inhibit fluid flow through each of the first and second valves.

In yet another set of embodiments the method is a method for measuring the clearance of a dialyzer the dialyzer being located in a blood flow path through which untreated blood can be drawn from a patient and passed through the dialyzer and in a dialysate flow path through which dialysate can flow from a dialysate supply through the dialyzer the blood flow path being separated from the dialysate flow path by membranes in the dialyzer. In one embodiment the method includes acts of urging a liquid through the dialysate flow path to the dialyzer so as to keep the membranes wet and prevent the flow of a gas through the membranes urging a gas through the blood flow path to the dialyzer so as to fill the blood flow path in the dialyzer with the gas measuring the volume of gas in the dialyzer and calculating the clearance of the dialyzer based on the volume of gas measured in the dialyzer.

The method in still another set of embodiments is a method for measuring the clearance of a dialyzer. In one embodiment the method includes acts of applying a pressure differential across the dialyzer measuring the flow rate of the dialyzer and determining the clearance of the dialyzer based on the pressure differential and the flow rate.

In yet another set of embodiments the method is a method for measuring the clearance of a dialyzer. In one embodiment the method includes acts of passing water through the dialyzer measuring the amount of ions collected by the water after passing through the dialyzer and determining the clearance of the dialyzer based on the amount of ions collected by the water after passing through the dialyzer. In another set of embodiments the method includes acts of passing water through the dialyzer measuring the conductivity of the water and determining the clearance of the dialyzer based on changes in the conductivity of the water.

In one set of embodiments the method is a method for introducing a fluid into blood. The method includes in one embodiment acts of providing a cassette including an integrally formed spike for receiving a vial of fluid and a valving mechanism for controlling flow of the fluid from the vial into the cassette attaching a vial containing the fluid to the spike pumping blood through the cassette and introducing the fluid from the vial into the blood.

In one set of embodiments the method includes acts of providing a hemodialysis system comprising a blood flow path through which untreated blood is drawn from a patient and passed through a dialyzer and a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer putting the blood flow path and the dialysate flow path into fluidic communication and urging dialysate through the dialysate flow path to cause blood in the blood flow path to pass into the patient.

The method in another set of embodiments includes acts of providing a hemodialysis system comprising a blood flow path through which untreated blood is drawn from a patient and passed through a dialyzer and a dialysate flow path through which dialysate flows from a dialysate supply through the dialyzer putting the blood flow path and the dialysate flow path into fluidic communication and urging a gas into the dialysate flow path to cause flow of blood in the blood flow path.

The method is a method of performing hemodialysis in still another set of embodiments. In one embodiment the method includes acts of providing a blood flow path through which untreated blood can be drawn from a patient and passed through a dialyzer providing a dialysate flow path through which dialysate can flow from a dialysate supply through the dialyzer providing ingredients for preparing a total volume of dialysate providing water for mixing with the dialysate ingredients mixing a volume of water with a portion of the ingredients so as to prepare a first partial volume of dialysate the first partial volume being less than the total volume pumping the partial volume of dialysate through the dialysate flow path and through the dialyzer pumping blood through the blood flow path and through the dialyzer while the first partial volume of dialysate is being pumped to the dialyzer and mixing a volume of water with a portion of the ingredients so as to prepare a second partial volume of dialysate and storing the second partial volume of dialysate within a vessel while the blood and the first partial volume of dialysate are pumped through the dialyzer.

In another embodiment the method includes acts of passing blood from a patient and dialysate through a dialyzer contained within a hemodialysis system at a first rate and forming dialysate within the hemodialysis system at a second rate that is substantially different from the first rate wherein excess dialysate is stored within a vessel contained within the hemodialysis system.

Another aspect of the invention is directed to a hemodialysis system comprising a dialysis unit and a user interface unit. The dialysis unit comprises an automation computer and dialysis equipment. The user interface unit comprises a user interface computer and a user interface the user interface being adapted to display information and receive inputs. The automation computer is configured to receive requests for safety critical information from the user interface computer and to access the safety critical information on behalf of the user interface computer. The user interface computer is configured to display information related to a dialysis process via the user interface using the safety critical information.

A further aspect of the invention is directed to a method of managing a user interface in a hemodialysis system. The method comprises receiving an input related to a dialysis process at a user interface associated with a user interface computer and in response to the input transmitting a request for safety critical information from the user interface computer to an automation computer associated with dialysis equipment. The method further comprises accessing the safety critical information on behalf of the user interface computer and using the safety critical information displaying information related to the dialysis process via the user interface.

Still another aspect of the invention is directed to a computer storage media encoded with instructions that when executed perform a method. The method comprising acts of receiving from a user interface associated with a user interface computer an input related to a dialysis process and in response to the input transmitting a request for safety critical information from the user interface computer to an automation computer associated with dialysis equipment. The method further comprises accessing the safety critical information on behalf of the user interface computer transmitting the safety critical information to the user interface computer accessing screen design information stored within the user interface computer and using the safety critical information and the screen design information causing the user interface to display information related to the dialysis process.

In another aspect the present invention is directed to a method of making one or more of the embodiments described herein for example a hemodialysis system. In another aspect the present invention is directed to a method of using one or more of the embodiments described herein for example a hemodialysis system.

In yet another aspect the invention relates to a control architecture for such a hemodialysis system comprising a user interface model layer a therapy layer below the user interface model layer and a machine layer below the therapy layer. The user interface model layer is configured to manage the state of a graphical user interface and receive inputs from a graphical user interface. The therapy layer is configured to run state machines that generate therapy commands based at least in part on the inputs from the graphical user interface. The machine layer is configured to provide commands for the actuators based on the therapy commands.

A further aspect of the invention is directed to a method for disinfecting fluid pathways in a dialysis system. The method comprises storing on at least one storage medium disinfection parameters including a disinfection temperature and a disinfection time. The method further comprises circulating a fluid in the fluid pathways monitoring a temperature of the fluid at each of a plurality of temperature sensors and determining that disinfection of the fluid pathways is complete when the temperature of the fluid at each of the plurality of temperature sensors remains at or above the disinfection temperature for at least the disinfection time.

Another aspect of the invention is directed to at least one computer readable medium encoded with instructions that when executed on at least one processing unit perform a method for disinfecting fluid pathways in a dialysis system. The method comprises electronically receiving disinfection parameters including a disinfection temperature and a disinfection time. The method further comprises controlling a plurality of actuators to circulate a fluid in the fluid pathways monitoring a temperature of the fluid at each of a plurality of temperature sensors and determining whether the temperature of the fluid at each of the plurality of temperature sensors remains at or above the disinfection temperature for at least the disinfection time.

A further aspect of the invention is directed to a method for controlling the administration of an anticoagulant in a dialysis system. The method comprises storing on at least one storage medium an anticoagulant protocol comprising a maximum amount of anticoagulant automatically administering the anticoagulant according to the anticoagulant protocol and prohibiting the administration of additional anticoagulant after determining that the maximum amount of anticoagulant has been administered.

Another aspect of the invention is directed to at least one computer readable medium encoded with instructions that when executed on at least one processing unit perform a method for controlling the administration of an anticoagulant in a dialysis system. The method comprises electronically receiving an anticoagulant protocol comprising a maximum amount of anticoagulant controlling a plurality of actuators to administer the anticoagulant according to the anticoagulant protocol and prohibiting the administration of additional anticoagulant after determining that the maximum amount of anticoagulant has been administered.

A further aspect of the invention is directed to a method for determining a fluid level in a dialysate tank of a dialysis system. The method comprises tracking a first number of strokes delivering fluid to the dialysate tank tracking a second number of strokes withdrawing fluid from the dialysate tank and determining a fluid level in the dialysate tank based at least in part on the first number of strokes the second number of strokes and a per stroke volume.

A further aspect of the invention is directed to a method for determining a fluid level in a dialysate tank of a dialysis system. The method comprises charging a reference chamber of a known volume to a predetermined pressure and venting the reference chamber to the dialysate tank. The method further comprises after venting the reference chamber to the dialysate tank determining a pressure in the dialysate tank. In addition the method comprises determining a fluid level in the dialysate tank based at least in part on the determined pressure in the dialysate tank.

Another aspect of the invention is directed to a method for returning blood to a patient in the event of a power failure condition in a dialysis system that uses compressed air to actuate pumps and or valves during a dialysis process wherein the dialysis system comprises a dialyzer having a membrane that separates a blood flow path from a dialysate flow path. The method comprises identifying a power failure condition in a dialysis system. The method further comprises in response to the identification of a power failure condition releasing compressed air from a reservoir associated with the dialysis system. In addition the method comprises using the released compressed air increasing a pressure in the dialysate flow path to cause blood in the blood flow path to return to the patient.

A further aspect of the invention is directed to a method for returning extracorporeal blood to a patient in an extracorporeal treatment system using a source of compressed gas in the event of a power failure. The extracorporeal treatment system comprises a filter having a semi permeable membrane that separates a blood flow path from an electrolyte solution flow path. The compressed gas is in valved communication with an electrolyte solution container and the electrolyte solution container is in valved communication with the electrolyte solution flow path. The method comprises in response to a termination of electrical power to one or more electrically actuated valves that control a distribution of compressed gas or a distribution of electrolyte solution flow in the extracorporeal treatment system causing one or more first electrically actuated valves to open a first fluid pathway between the compressed gas and the electrolyte solution container causing one or more second electrically actuated valves to open a second fluid pathway between said electrolyte solution container and said filter causing one or more third electrically actuated valves to close an alternate fluid pathway in said electrolyte solution flow path if said alternate fluid pathway diverts electrolyte solution away from said filter and using the compressed gas to increase pressure in the electrolyte solution flow path to cause blood in the blood flow path to return to the patient.

Another aspect of the invention is directed to a method for returning extracorporeal blood to a patient in an extracorporeal treatment system using a source of compressed gas in the event of a power failure. The extracorporeal treatment system comprises a filter having a semi permeable membrane that separates a blood flow path from an electrolyte solution flow path. The compressed gas is in valved communication with an electrolyte solution container and the electrolyte solution container is in valved communication with the electrolyte solution flow path. The method comprises in response to a termination of electrical power to one or more electrically actuated valves that control a distribution of compressed gas or a distribution of electrolyte solution flow in the extracorporeal treatment system causing one or more electrically actuated valves to open a fluid pathway between the compressed gas and the electrolyte solution container and using the compressed gas causing flow of an electrolyte solution from the electrolyte solution container through the filter to cause blood in the blood flow path to return to the patient.

Another aspect of the invention relates to a pressure distribution module. In certain embodiments a pressure distribution module is described that comprises one or more manifold blocks at least one gasket one or more output ports one or more supply lines and

at least one valve wherein a first manifold block includes a face therein in which is formed multiple channels the channels being sealed to form fluid passages by compressing a first gasket against the channels with a rigid backing plate wherein the supply lines are formed as passages through the manifold block that pass under one or more of the channels each supply line being connected to a separate source of pneumatic pressure or vacuum and wherein the valve is fluidically connected to at least one supply line and an output port via holes in the manifold block fluidically connecting the one or more channels to the valve supply line and output port.

In certain embodiments the pressure distribution module comprises two or more manifold blocks two or more gaskets one or more output ports one or more supply lines and

at least one valve wherein a first manifold block includes a face having a plurality of channels formed therein a second manifold block includes a first face having a plurality of channels formed therein and an opposing second substantially smooth face wherein the channels on the first manifold block are sealed to form fluid passages by compressing one of the gaskets against the channels with the second substantially smooth face of the second manifold block wherein the supply lines are formed by passages through the manifold blocks that pass under at least some of the channels each supply line being connected to a separate source of pneumatic pressure or vacuum when the module is configured in an operative configuration and wherein at least one valve is fluidically connected to at least one of the supply lines and to at least one output port via at least one hole penetrating from one or more of the channels to the valve the supply line and the output port.

Another aspect of the invention relates to hemodialysis systems. In certain embodiments a hemodialysis system is disclosed that comprises a plurality of pneumatically operated diaphragm pumps and valves that control the flow of blood and dialysate in a hemodialysis apparatus the pumps and valves being actuated by a pressure source having a first positive pressure a pressure source having a second positive pressure that is less than the first positive pressure or a pressure source having a negative pressure wherein the pumps and valves that contact blood in an extracorporeal circuit of the system when the system is connected to a patient are fluidly connected to the second positive pressure source or the negative pressure source.

In certain embodiments the hemodialysis system comprises a plurality of diaphragm based reciprocating pumps a plurality of diaphragm based valves and a pressure distribution module comprising a plurality of valves requiring electrical power for actuation and configured for supplying a pressurized fluid to operate the diaphragm based reciprocating pumps and the diaphragm based valves to control the flow of blood and dialysate in the hemodialysis system wherein the pressure distribution module is configured to facilitate control of the system to operate the pumps and valves to assume open or closed positions as necessary to allow blood in an extracorporeal circuit of the system as connected to a patient during operation to be pushed back to the patient upon the loss of electrical power or control in the hemodialysis system.

Another aspect of the invention relates to heater circuits for a dialysis unit. In certain embodiments the heater circuit comprises a dialysate path flow for carrying a flow of dialysate for use in a dialysis unit a heater arranged to heat dialysate in the dialysate flow path a heater temperature sensor arranged to sense a heater temperature of a portion of the heater a pump to controllably move fluid in the dialysate flow path a heater control circuit to control the heater using a first control loop to achieve a desired heater temperature by providing a heater control signal to control a heater power wherein one or more gains are used by the heater control circuit to generate the heater control signal and the one or more gains are varied based on an operating mode of the dialysis unit.

Another aspect of the invention relates to dialysis units including a field programmable gate array FPGA . In certain embodiments the dialysis unit includes a dialysate flow circuit including a dialyzer and a field programmable gate array FPGA that monitors at least conductivity and temperature of dialysate in the flow circuit upstream of a dialyzer and enters a fail safe state if the measured conductivity exceeds a value and or is outside of a range of values wherein the value or range of values is different for different modes of therapy or the value or range of values is different for different patients.

In certain embodiments the dialysis unit includes a dialysate flow circuit including a dialyzer and an ultra filtration pump and a field programmable gate array that monitors an amount of ultrafiltration fluid withdrawn from a patient during dialysis treatment by the dialysis unit by setting a given register to a first value and increasing the value of the register by a first incremental value for every pump stroke of the ultra filtration pump and decreasing the value of the register by a second incremental value for each pre determined increment of time wherein the field programmable gate array enters a fail safe state if the value of the register exceeds a pre determined maximum value.

In certain embodiments the dialysis unit includes a dialysate flow circuit including a dialyzer and an automatic computer processing unit that verifies before a start of a treatment that a safety system mediated by a field programmable gate array FPGA is operating properly by exposing sensors in fluid paths in the dialysis unit to temperatures or conductivities that are outside pre determined permissible ranges of values and confirming that the FPGA safety system enters a fail safe state in response to the temperatures or conductivities outside the predetermined permissible ranges of values wherein the computer processing unit resets the FPGA after verifying that the safety system is operating properly by writing to one or more registers in the FPGA within a pre determined interval of time.

Another aspect of the invention relates to methods implemented by an operative set of processor executable instructions configured for execution by a computer processor. In certain embodiments the method comprises determining if a tablet is connected to a base through a physical connection establishing a first communications link between the tablet and the base through the physical connection updating if necessary an interface program on the tablet and the base through the first communications link establishing a second communications link between the tablet and the base using the first communications link and communicating data from the base to the tablet using the second communications link.

In certain embodiments the method comprises communicating data between a tablet and a base as long as a link quality value is above a predetermined threshold entering into a headless state if the link quality value falls below the predetermined threshold remaining in the headless state as long as the link quality value remains below the predetermined threshold and determining if the link quality value returns above the predetermined threshold and exiting the headless state if the link quality value has returned to above the predetermined threshold.

In certain embodiments the method comprises communicating data between a tablet and a base as long as a link quality value is above a first predetermined threshold entering into a headless state if the link quality value falls below the first predetermined threshold remaining in the headless state as long as the link quality value remains below a second predetermined threshold determining if the link quality value increases above the second predetermined threshold and exiting the headless state if the link quality value exceeds the second predetermined threshold.

Another aspect of the invention relates to pumping systems. In certain embodiments the pumping system comprises a reciprocating positive displacement pump comprising a rigid chamber wall a rigid limit structure a flexible membrane attached to the rigid chamber wall and interposed between the rigid chamber wall and the rigid limit structure such that the flexible membrane and rigid chamber wall together define a pumping chamber and the flexible membrane and the rigid limit structure together define an actuation chamber and wherein the rigid limit structure is constructed and positioned to limit movement of the membrane and limit a maximum volume of the pumping chamber an inlet for directing flow through the rigid chamber wall into the pumping chamber and an outlet for directing flow through the rigid chamber wall out of the pumping chamber an actuation system that alternately provides either a positive or a negative pressure to the actuation chamber wherein the actuation system includes a reservoir containing a control fluid at either a positive or a negative pressure and a valving mechanism for controlling a flow of control fluid between the actuation chamber and the reservoir an actuation chamber pressure transducer for measuring a pressure of the actuation chamber and a controller that receives pressure information from the actuation chamber pressure transducer and controls the valving mechanism via a valve control signal to provide a given pressure with a superimposed periodic variation to the actuation chamber and calculates a first cross correlation between the said valve control signal and said actuation chamber pressure and calculates a second cross correlation between the said valve control signal shifted a quarter period and said actuation chamber pressure and calculates a correlation number by the sum of the squares of the said first and second cross correlation values and uses said correlation number in evaluating the flow through the pump.

In certain embodiments the pumping system comprises more than one reciprocating positive displacement pump comprising a rigid chamber wall a rigid limit structure a flexible membrane attached to the rigid chamber wall and interposed between the rigid chamber wall and the rigid limit structure such that the flexible membrane and rigid chamber wall together define a pumping chamber and the flexible membrane and the rigid limit structure together define an actuation chamber and wherein the rigid limit structure is constructed and positioned to limit movement of the membrane and limit a maximum volume of the pumping chamber an inlet for directing flow through the rigid chamber wall into the pumping chamber and an outlet for directing flow through the rigid chamber wall out of the pumping chamber an actuation system that alternately provides either a positive or a negative pressure to the actuation chamber wherein the actuation system includes a reservoir containing a control fluid at either a positive or a negative pressure and a valving mechanism for controlling a flow of control fluid between the actuation chamber and the reservoir an actuation chamber pressure transducer for measuring a pressure of the actuation chamber and a controller that receives pressure information from the actuation chamber pressure transducer and controls the valving mechanism via a valve control signal to provide a given pressure with a superimposed periodic variation to the actuation chamber wherein a frequency of the said superimposed periodic variation is different for each reciprocating positive displacement pump.

In certain by events the pumping system comprises a reciprocating positive displacement pump comprising a rigid chamber wall a rigid limit structure a flexible membrane attached to the rigid chamber wall and interposed between the rigid chamber wall and the rigid limit structure such that the flexible membrane and rigid chamber wall together define a pumping chamber and the flexible membrane and the rigid limit structure together define an actuation chamber and wherein the rigid limit structure is constructed and positioned to limit movement of the membrane and limit a maximum volume of the pumping chamber an inlet for directing flow through the rigid chamber wall into the pumping chamber and an outlet for directing flow through the rigid chamber wall out of the pumping chamber an actuation system that alternately provides either a positive or a negative pressure to the actuation chamber wherein the actuation system includes a reservoir containing a control fluid at either a positive or a negative pressure and a valving mechanism for controlling a flow of control fluid between the actuation chamber and the reservoir an actuation chamber pressure transducer for measuring a pressure of the actuation chamber and a controller that receives pressure information from the actuation chamber pressure transducer and controls the valving mechanism via a valve control signal to provide a given pressure with a superimposed periodic variation to the actuation chamber and calculates a first cross correlation between the said valve control signal and said actuation chamber pressure and uses said first cross correlation value in evaluating the flow through the pump.

In certain embodiments the pumping system comprises a reciprocating positive displacement pump comprising a rigid chamber wall a rigid limit structure a flexible membrane attached to the rigid chamber wall and interposed between the rigid chamber wall and the rigid limit structure such that the flexible membrane and rigid chamber wall together define a pumping chamber and the flexible membrane and the rigid limit structure together define an actuation chamber and wherein the rigid limit structure is constructed and positioned to limit movement of the membrane and limit the maximum volume of the pumping chamber an inlet for directing flow through the rigid chamber wall into the pumping chamber an outlet for directing flow through the rigid chamber wall out of the pumping chamber and an actuation system that alternately provides either a positive or a negative pressure to the actuation chamber wherein the actuation system includes a reservoir containing a control fluid at either a positive or a negative pressure and a valving mechanism for controlling a flow of control fluid between the actuation chamber and the reservoir an actuation chamber pressure transducer for measuring a pressure of the actuation chamber and a controller that receives pressure information from the actuation chamber pressure transducer and in a first time period controls the valving mechanism to complete a full stroke by moving the diaphragm from a position touching the rigid limit structure to a position touching the rigid chamber wall and to record the value of a stroke parameter at the end of said full stroke and in a subsequent time period controls the valving mechanism to complete partial strokes by moving the diaphragm until the said stroke parameter is a fraction of the full stroke value.

Another aspect of the invention relates to methods for performing hemodialysis using and ultrafiltration pump to control the volume of fluid removed from the patient. In certain embodiments the method comprises setting an ultrafiltration pumping rate over a planned duration of hemodialysis to achieve a pre determined volume of fluid to be removed from the patient periodically backflushing a pre determined volume of dialysate from a dialysate source through a dialyzer membrane to an extracorporeal blood circuit connected to the patient and adjusting the ultrafiltration pumping rate to remove the volume of fluid backflushed during the course of hemodialysis.

Another aspect of the invention relates to systems for administering a dose of medication to a patient whose vascular system is fluidly connected to an extracorporeal blood circuit comprising an arterial flow path for delivering fluid from the patient to a dialyzer and a venous flow path for delivering fluid from the dialyzer to the patient. In certain embodiments the system comprises a vial of medication fluidly connected to a medication pump the medication pump in valved fluid communication with a primary fluid pump in the extracorporeal circuit a first gas bubble detector for detecting gas bubbles in the arterial flowpath medication pump valves and primary fluid pump inlet and outlet valves under control of a controller to direct fluid flow from the dialyzer to the patient either via the arterial flowpath or the venous flowpath wherein in a first arrangement the controller arranges the valves to cause medication to flow from the medication pump to the patient via the arterial flowpath and in a second arrangement the controller arranges the valves to cause medication to flow from the medication pump to the patient via the venous flowpath if the controller receives a signal from the gas bubble detector indicating the presence of one or more gas bubbles in the arterial flowpath.

Other advantages and novel features of the present invention will become apparent from the following detailed description of various non limiting embodiments of the invention when considered in conjunction with the accompanying figures. In cases where the present specification and a document incorporated by reference include conflicting and or inconsistent disclosure the present specification shall control. If two or more documents incorporated by reference include conflicting and or inconsistent disclosure with respect to each other then the document having the later effective date shall control.

The present invention generally relates to hemodialysis and similar extracorporeal blood treatment systems including a variety of systems and methods that would make hemodialysis more efficient easier and or more affordable. One aspect of the invention is generally directed to new fluid circuits for fluid flow. In one set of embodiments a hemodialysis system may include a blood flow path and a dialysate flow path where the dialysate flow path includes one or more of a balancing circuit a mixing circuit and or a directing circuit. Preparation of dialysate by the mixing circuit in some instances may be decoupled from patient dialysis. In some cases the circuits are defined at least partially within one or more cassettes optionally interconnected with conduits pumps or the like. In one embodiment the fluid circuits and or the various fluid flow paths may be at least partially isolated spatially and or thermally from electrical components of the hemodialysis system. In some cases a gas supply may be provided in fluid communication with the dialysate flow path and or the dialyzer that when activated is able to urge dialysate to pass through the dialyzer and urge blood in the blood flow path back to the patient. Such a system may be useful for example in certain emergency situations e.g. a power failure where it is desirable to return as much blood to the patient as possible. The hemodialysis system may also include in another aspect of the invention one or more fluid handling devices such as pumps valves mixers or the like which can be actuated using a control fluid such as air. In some cases the control fluid may be delivered to the fluid handling devices using an external pump or other device which may be detachable in certain instances. In one embodiment one or more of the fluid handling devices may be generally rigid e.g. having a spheroid shape optionally with a diaphragm contained within the device dividing it into first and second compartments.

Various aspects of the present invention are generally directed to new systems for hemodialysis and the like such as hemofiltration systems hemodiafiltration systems plasmapheresis systems etc. Accordingly although the various systems and methods described herein are described in relation to hemodialysis it should be understood that the various systems and method described herein are applicable to other dialysis systems and or in any extracorporeal system able to treat blood or other bodily fluids such as plasma.

As discussed above a hemodialysis system typically includes a blood flow path and a dialysate flow path. It should be noted that within such flow paths the flow of fluid is not necessarily linear and there may be any number of branches within the flow path that a fluid can flow from an inlet of the flow path to an outlet of the flow path. Examples of such branching are discussed in detail below. In the blood flow path blood is drawn from a patient and is passed through a dialyzer before being returned to the patient. The blood is treated by the dialyzer and waste molecules e.g. urea creatinine etc. and water are passed from the blood through a semi permeable membrane in the dialyzer into a dialysate solution that passes through the dialyzer by the dialysate flow path. In various embodiments blood may be drawn from the patient from two lines e.g. an arterial line and a venous line i.e. dual needle flow or in some cases blood may be drawn from the patient and returned through the same needle e.g. the two lines may both be present within the same needle i.e. single needle flow . In still other embodiments a Y site or T site is used where blood is drawn from the patient and returned to the patient through one patient connection having two branches one being the fluid path for the drawn blood the second the fluid path for the return blood . In an embodiment a Y or T connection can be made with a single lumen needle or catheter. In another embodiment a dual needle flow effect can be obtained with the use of a single catheter or needle having dual lumens. The patient may be any subject in need of hemodialysis or similar treatments although typically the patient is a human. However hemodialysis may be performed on non human subjects such as dogs cats monkeys and the like.

In the dialysate flow path fresh dialysate is prepared and is passed through the dialyzer to treat the blood from the blood flow path. The dialysate may also be equalized for blood treatment within the dialyzer i.e. the pressure between the dialysate and the blood are equalized i.e. the pressure of dialysate through the dialyzer is closely matched to the pressure of blood through the dialyzer often exactly or in some embodiments at least within about 1 or about 2 of the pressure of the blood. In some cases it may be desirable to maintain a greater pressure difference either positive or negative between the blood flow path and dialysate flow path. After passing through the dialyzer the used dialysate containing waste molecules as discussed below is discarded in some fashion. In some cases the dialysate is heated prior to treatment of the blood within the dialyzer using an appropriate heater such as an electrical resistive heater. The dialysate may also be filtered to remove contaminants infectious organisms debris and the like for instance using an ultrafilter. The ultrafilter may have a mesh or pore size chosen to prevent species such as these from passing therethrough. For instance the mesh or pore size may be less than about 0.3 micrometers less than about 0.2 micrometers less than about 0.1 micrometers or less than about 0.05 micrometers etc. The dialysate is used to draw waste molecules e.g. urea creatinine ions such as potassium phosphate etc. and water from the blood into the dialysate through osmosis or convective transport and dialysate solutions are well known to those of ordinary skill in the art.

The dialysate typically contains various ions such as sodium chloride bicarbonate potassium and calcium that are similar in concentration to that of normal blood. In some cases the bicarbonate may be at a concentration somewhat higher than found in normal blood. Typically the dialysate is prepared by mixing water from a water supply with one or more ingredients an acid which may contain various species such as acetic acid dextrose NaCl CaCl KCl MgCl etc. sodium bicarbonate NaHCO and or sodium chloride NaCl . The preparation of dialysate including using the appropriate concentrations of salts osmolarity pH and the like is well known to those of ordinary skill in the art. As discussed in detail below the dialysate need not be prepared at the same rate that the dialysate is used to treat the blood. For instance the dialysate can be made concurrently or prior to dialysis and stored within a dialysate storage vessel or the like.

Within the dialyzer the dialysate and the blood typically do not come into physical contact with each other and are separated by a semi permeable membrane. Typically the semipermeable membrane is formed from a polymer such as cellulose polyarylethersulfone polyamide polyvinylpyrrolidone polycarbonate polyacrylonitrile or the like which allows the transport of ions or small molecules e.g. urea water etc. but does not allow bulk transport or convection during treatment of the blood. In some cases even larger molecules such as beta 2 microglobulin may pass through the membrane. In other cases convective transfer of fluid ions and small molecules can occur for example when there is a hydrostatic pressure difference across the semi permeable membrane.

The dialysate and the blood do not come into contact with each other in the dialyzer and are usually separated by the membrane. Often the dialyzer is constructed according to a shell and tube design comprising a plurality of individual tubes or fibers through which blood flows formed from the semipermeable membrane surrounded by a larger shell through which the dialysate flows or vice versa in some cases . Flow of the dialysate and the blood through the dialyzer can be countercurrent or concurrent in some instances. Dialyzers are well known to those of ordinary skill in the art and are obtainable from a number of different commercial sources.

In one aspect the dialysate flow path can be divided into one or more circuits such as a balancing circuit a mixing circuit and or a directing circuit. It should be noted that a circuit in reference to fluid flow is not necessarily fluidically isolated i.e. fluid may flow into a fluid circuit and out of a fluid circuit. Similarly a fluid may pass from one fluid circuit to another fluid circuit when the fluid circuits are in fluid communication or are fluidly connected to each other. It should be noted that as used herein Fluid means anything having fluidic properties including but not limited to gases such as air and liquids such as water aqueous solution blood dialysate etc.

A fluid circuit is typically a well defined module that receives a certain number of fluid inputs and in some cases performs one or more tasks on the fluid inputs before directing the fluids to appropriate outputs. In certain embodiments of the invention as discussed below the fluid circuit is defined as a cassette. As a specific example a dialysate flow path may include a balancing circuit a directing circuit and a mixing circuit. As another example a blood flow path may include a blood flow circuit. Within the balancing circuit dialysate is introduced into the balancing circuit and pumps operate on the dialysate such that the pressure of dialysate passing through the dialyzer balances the pressure of blood passing through the dialysate as previously discussed. Similarly within the directing circuit fresh dialysate is passed from the mixing circuit to the balancing circuit while used dialysate is passed from the balancing circuit to a drain. Within the mixing circuit ingredients and water are mixed together to form fresh dialysate. The blood flow circuit is used to draw blood from the patient pass the blood through a dialyzer and return the blood to the patient. These circuits will be discussed in detail below.

An example of a hemodialysis system having such fluid circuits is illustrated schematically in as a high level overview. illustrates a dialysis system that includes a blood flow circuit through which blood passes from a patient to a dialyzer and through which treated blood returns to the patient. The hemodialysis system in this example also includes a balancing circuit part of an internal or inner dialysate circuit which takes dialysate after it passes through an ultrafilter and passes the dialysate through dialyzer with used dialysate returning to balancing circuit from dialyzer . A directing circuit part of an external or outer dialysate circuit handles fresh dialysate before it passes through ultrafilter . A mixing circuit prepares dialysate for instance on an as needed basis during and or in advance of dialysis etc. using various ingredients and water. The directing circuit can also receive water from a water supply and pass it to mixing circuit for preparation of the dialysate and the directing circuit can also receive used dialysate from balancing circuit and pass it out of system as waste via drain . Also shown in dotted lines are conduits that can be connected between blood flow circuit and directing circuit e.g. for disinfection of the hemodialysis system. In one set of embodiments one or more of these circuits e.g. the blood flow circuit the balancing circuit the directing circuit and or the mixing circuit may include a cassette incorporating the valves and pumps needed for controlling flow through that portion. Examples of such systems are discussed in detail below.

Providing two pod pumps may allow for a more continuous flow of blood through the blood flow circuit however a single pod pump such as a single pod pump may be used in other embodiments. The pod pumps may include active inlet and outlet valves instead of passive check valves at their inlets and outlets so that flow in the blood flow circuit may be reversed under some conditions. For instance by reversing flow in the blood flow circuit the hemodialysis system can check whether the outlet of the blood flow circuit is properly connected to the patient so that the treated blood is correctly returned to the patient. If for example the patient connection point has been disconnected e.g. by falling out reversing the blood flow pump would draw air rather than blood. This air can be detected by standard air detectors incorporated into the system.

In another embodiment blood outlet valve and air trap filter which are located downstream of the dialyzer may be incorporated into blood flow cassette . The pod pumps and all the valves including the valves associated with the pod pumps inlets and outlets in the blood flow cassette may be actuated pneumatically. Sources of positive and negative gas pressure in one embodiment are provided by a base unit holding cassette or other device holding the cassette. However in other embodiments the positive and negative gas pressure may be provided by an external device fluidly connected to the cassettes or any device build into the system The pump chamber may be actuated in the manner described in U.S. Provisional Patent Application Ser. No. 60 792 073 filed Apr. 14 2006 entitled Extracorporeal Thermal Therapy Systems and Methods or in U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 entitled Fluid Pumping Systems Devices and Methods referred to hereinabove. For instance the pumps may be controlled and the end of stroke detected in the manner described below. The blood flow cassette may also contain an integrally formed spike for receiving a vial of anticoagulant.

The anticoagulant pump in one embodiment includes three fluid valves which may be controlled with a control fluid and a single pumping compartment although there may be more than one pumping compartment in other embodiments. The valves may connect the compartment to a filtered air vent to a vial of anticoagulant or other anticoagulant supply such as a bag or a bottle etc. or to the blood flow path. The anticoagulant pump can be operated by sequencing the opening and closing of the fluid valves and controlling the pressure in the pump compartment e.g. via the control fluid. When the anticoagulant is removed from the vial it may be replaced with an equal volume of air e.g. to keep pressure within the vial relatively constant. This replacement of anticoagulant volume with air may be accomplished for example by i opening the valve from the filtered air vent to the pump compartment ii drawing air into the compartment by connecting the negative pressure source to the chamber iii closing the air vent valve iv opening the valve connecting the compartment to the vial and v pushing air into the vial by connecting the positive pressure source to the compartment. The anticoagulant can be pumped from the vial into the blood flow path with a similar sequence using the valves to the vial and the blood path rather than the valves to the air vent and the vial.

The components in will be discussed in detail below. Briefly blood flow circuit includes an anticoagulant supply and a blood flow pump which pumps blood from a patient to a dialyzer . The anticoagulant supply although shown in the path of blood flowing towards the dialyzer in other embodiments may be instead located in the path of blood flowing towards the patient or in another suitable location such as upstream or downstream of blood flow pump . The anticoagulant supply may be placed in any location downstream from blood flow pump . Balancing circuit includes two dialysate pumps which also pump dialysate into dialyzer and a bypass pump . Directing circuit includes a dialysate pump which pumps dialysate from dialysate tank through heater and or ultrafilter to the balancing circuit. Directing circuit also takes waste fluid from balancing circuit and directs it to a drain . In some cases the blood flow circuit can be connected via conduits to directing circuit e.g. for disinfection as discussed below. Dialysate flows into dialysate tank from a dialysate supply.

In certain embodiments the invention provides methods for making dialysate from water contained within or supplied to the system and at least one supply of solutes contained within or supplied to the system. For example as is shown in the dialysate is produced in mixing circuit . Water from water supply flows through directing circuit into mixing circuit . Dialysate ingredients e.g. bicarbonate and acid are also added into mixing circuit and a series of mixing pumps are used to produce the dialysate which is then sent to directing circuit . This method and the control thereof to ensure acceptable dialysate quality is produced and maintained during treatment is described in more detail below.

In this example system one of the fluid circuits is a blood flow circuit e.g. blood flow circuit in . In the blood flow circuit blood from a patient is pumped through a dialyzer and then is returned to the patient. In some cases blood flow circuit is implemented on a cassette as discussed below although it need not be. The flow of blood through the blood flow circuit in some cases is balanced with the flow of dialysate flowing through the dialysate flow path especially through the dialyzer and the balancing circuit.

One example of a blood flow circuit is shown in . Generally blood flows from a patient through arterial line via blood flow pump to dialyzer the direction of flow during normal dialysis is indicated by arrows in some modes of operation however the flow may be in different directions as discussed below . Optionally an anticoagulant may be introduced into the blood via anticoagulant pump from an anticoagulant supply. As shown in the anticoagulant can enter the blood flow path after the blood has passed through blood flow pump however the anticoagulant may be added in any suitable location along the blood flow path in other embodiments. For example in the anticoagulant enters the blood flow path before the blood has passed through blood flow pump . This may be useful for example if a blood pump cassette of the type shown in is used and blood flow is directed to cause blood to enter at the top of the cassette and exit at the bottom of the cassette. The blood pump chambers can thus additionally serve to trap air that may be present in the blood before it is pumped to the dialyzer. In other embodiments anticoagulant supply may be located anywhere downstream from the blood flow pump. After passing through dialyzer and undergoing dialysis the blood returns to the patient through venous line optionally passing through air trap and or a blood sample port .

As is shown in blood flow cassette also includes one or more blood flow pumps for moving blood through the blood flow cassette. The pumps may be for instance pumps that are actuated by a control fluid such as is discussed below. For instance in one embodiment pump may comprise two or more pod pumps e.g. pod pumps in . Each pod pump in this particular example may include a rigid chamber with a flexible diaphragm or membrane dividing each chamber into a fluid compartment and control compartment. There are four entry exit valves on these compartments two on the fluid compartment and two on the control compartment. The valves on the control compartment of the chambers may be two way proportional valves one connected to a first control fluid source e.g. a high pressure air source and the other connected to a second control fluid source e.g. a low pressure air source or a vacuum sink. The fluid valves on the compartments can be opened and closed to direct fluid flow when the pod pumps are pumping. Non limiting examples of pod pumps are described in U.S. Provisional Patent Application Ser. No. 60 792 073 filed Apr. 14 2006 entitled Extracorporeal Thermal Therapy Systems and Methods or in U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 entitled Fluid Pumping Systems Devices and Methods each incorporated herein by reference. Further details of the pod pumps are discussed below. If more than one pod pump is present the pod pumps may be operated in any suitable fashion e.g. synchronously asynchronously in phase out of phase etc.

For instance in some embodiments the two pump pumps can be cycled out of phase to affect the pumping cycle e.g. one pump chamber fills while the second pump chamber empties. A phase relationship anywhere between 0 the pod pumps act in the same direction filling and emptying in unison and 180 the pod pumps act in opposite directions in which one pod pump fills as the other empties can be selected in order to impart any desired pumping cycle.

A phase relationship of 180 may yield continuous flow into and out of the pod pump cassette. This is useful for instance when continuous flow is desired e.g. for use with dual needle flow or a Y or T connection. Setting a phase relationship of 0 however may be useful in some cases for single needle flow in situations in which a Y or T connection is made with a single needle or single lumen catheter or in other cases. In a 0 relationship the pod pumps will first fill from the needle then deliver blood through the blood flow path and back to the patient using the same needle. In addition running at phases between 0 and 180 can be used in some cases to achieve a push pull relationship hemodiafiltration or continuous back flush across the dialyzer. are graphical representations of examples of such phase relationships. In these figures the volume or flow of each pod pump the volumes of each pod pumps and the total hold up volume of both pod pumps is shown as a function of time. These times and flow rates are arbitrarily chosen and are presented here to illustrate the relationships between the pod pumps at different phasings. For instance at a 180 phase relationship the total hold up volume remains substantially constant.

In some cases an anticoagulant e.g. heparin or any other anticoagulant known to those of ordinary skill in the art may be mixed with the blood within blood flow cassette as is shown in . For instance the anticoagulant may be contained within a vial or other anticoagulant supply such as a tube or a bag and blood flow cassette may be able to receive the anticoagulant vial with an integrally formed spike which in one embodiment is a needle that can pierce the seal of the vial. The spike may be formed from plastic stainless steel or another suitable material and may be a sterilizable material in some cases e.g. the material may be able to withstand sufficiently high temperatures and or radiation so as to sterilize the material. As an example as is shown in spike may be integrally formed with a blood flow cassette and a vial can be placed onto the spike piercing the seal of the vial such that anticoagulant can flow into blood flow cassette to be mixed with the blood in the blood flow path or in some cases mixed with dialysate as discussed below.

A third pump which can act as a metering chamber in some cases in blood flow cassette can be used to control the flow of anticoagulant into the blood within the cassette. Third pump may be of the same or of a different design than pump . For instance third pump may be a pod pump and or third pump may be actuated by a control fluid such as air. For example third pump may be a membrane based metering pump. For instance as is shown in third pump may include a rigid chamber with a flexible diaphragm dividing the chamber into a fluid compartment and a control compartment. Valves on the control compartment of the chamber may be connected to a first control fluid source e.g. a high pressure air source and the other compartment connected to a second control fluid source e.g. a low pressure air source or a vacuum sink. Valves on the fluid compartment of the chamber can be opened and closed in response to the control compartment thus controlling the flow of anticoagulant into the blood. Further details of such a pod pump are discussed below. In one set of embodiments air may also be introduced into the blood flow path through a filter as discussed below.

Fluid Management System FMS measurements may be used to measure the volume of fluid pumped through a pump chamber during a stroke of the membrane or to detect air in the pumping chamber. FMS methods are described in U.S. Pat. Nos. 4 808 161 4 826 482 4 976 162 5 088 515 and 5 350 357 which are hereby incorporated herein by reference in their entireties. In some cases the volume of liquid delivered by an anticoagulant pump a dialysate pump or other membrane based pump is determined using an FMS algorithm in which changes in chamber pressures are used to calculate a volume measurement at the end of a fill stroke and at the end of a delivery stroke. The difference between the computed volumes at the end of a fill and delivery stroke is the actual stroke volume. This actual stroke volume can be compared to an expected stroke volume for the particular sized chamber. If the actual and expected volumes are significantly different the stroke has not properly completed and an error message can be generated.

If stroke volumes are collected with a scale the calculation can be worked backwards to determine a calibration value for the reference chamber. FMS systems can vent to atmosphere for the FMS measurement. Alternatively the system can vent to a high pressure positive source and a low pressure negative source for the FMS measurement. Doing so provides the following advantages amongst others 1 if the high pressure source is a pressure reservoir with a controlled pressure there is an opportunity to do a cross check on the pressure sensors of the reservoir and chamber to ensure they are similar when the chamber is being vented to the reservoir. This can be used to detect a broken pressure sensor or a failed valve 2 by using higher lower pressures to vent there are larger pressure differences for the FMS measurements so better resolution can be obtained.

Blood flow circuit may also include an air trap incorporated into blood flow circuit in some cases. Air trap may be used to remove air bubbles that may be present within the blood flow path. In some cases air trap is able to separate any air that may be present from the blood due to gravity. In some cases air trap may also include a port for sampling blood. Air traps are known to those of ordinary skill in the art.

In accordance with another aspect of the invention the air trap is placed in the blood flow path after the blood exits the dialyzer and before it is returned to the patient. As shown in air trap may have a spherical or spheroid shape container and have its inlet port located near the top and offset from the vertical axis of the container and an outlet at a bottom of the container. The curved shape of the inside wall of the trap can thus direct the blood to circulate along the inside wall as the blood gravitates to the bottom of the container facilitating the removal of air bubbles from the blood. Air present in the blood exiting the outlet of the dialyzer will enter at the top of the air trap and remain at the top of the container as blood flows out the outlet at the bottom and to the venous blood line . By locating the inlet port near the top of trap it is also possible to circulate blood through the trap with minimal or no air present within the container as a run full air trap . The ability to avoid an air blood interface for routine circulation of blood in the trap can be advantageous. Placing the inlet port at or near the top of the container also allows most or all of the air present in the trap to be removed from the trap by reversing the flow of fluid through the blood tubing i.e. from the bottom to the top of the trap exiting through the inlet port of the trap . In an embodiment a self sealing port such as a self sealing stopper with a split septum or membrane or another arrangement is located at the top of the trap allowing the withdrawal of air from the container e.g. by syringe . The blood side surface of the self sealing membrane can be situated nearly flush with the top of the interior of the trap in order to facilitate cleaning of the self sealing port during disinfection. The self sealing port can also serve as a blood sampling site and or to allow the introduction of liquids drugs or other compounds into the blood circuit. A sealed rubber type stopper can be used if access with a needle is contemplated. Using a self sealing stopper with split septum permits sampling and fluid delivery using a needleless system.

Additional fluid connections may allow blood flow circuit to also be connected to the patient and or to a fluid source for priming or disinfecting the system including blood flow circuit . Generally during disinfection arterial line and venous line are connected directly to directing circuit via conduits such that a disinfecting fluid e.g. heated water and in some embodiments a combination heated water and one or more chemical agent may be flowed through dialyzer and blood flow circuit back to directing circuit for recirculation this disinfection is similar to those shown in U.S. Pat. No. 5 651 898 to Kenley et al. which is incorporated herein by reference. This is also discussed in more detail below.

The pressure within arterial line to draw blood from the patient may be kept to a pressure below atmospheric pressure in some cases. If a pod pump is used the pressure within blood flow pump may be inherently limited to the pressures available from the positive and negative pressure reservoirs used to operate the pump. In the event that a pressure reservoir or valve fails the pump chamber pressure will approach the reservoir pressure. This will increase the fluid pressure to match the reservoir pressure until the diaphragm within the pod pump bottoms i.e. is no longer is able to move due to contact with a surface and the fluid pressure will not exceed a safe limit and will equilibrate with a natural body fluid pressure. This failure naturally stops operation of the pod pump without any special intervention.

A specific non limiting example of a blood flow cassette is shown in . Referring now to the outer side of the top plate of an exemplary embodiment of the cassette is shown. The top plate includes one half of the pod pumps . This half is the liquid half where the source fluid will flow through. The two fluid paths are shown. These fluid paths lead to their respective pod pumps .

The pod pumps include a raised flow path . The raised flow path allows for the fluid to continue to flow through the pod pumps after the diaphragm not shown reaches the end of stroke. Thus the raised flow path minimizes the diaphragm causing air or fluid to be trapped in the pod pump or the diaphragm blocking the inlet or outlet of the pod pump which would inhibit continuous flow. The raised flow path is shown in one exemplary embodiment having particular dimensions and in some cases the dimensions are equivalent to the fluid flow paths . However in alternate embodiments the raised flow path is narrower or in still other embodiments the raised flow path can be any dimensions as the purpose is to control fluid flow so as to achieve a desired flow rate or behavior of the fluid. In some embodiments the raised flow path and the fluid flow paths have different dimensions. Thus the dimensions shown and described here with respect to the raised flow path the pod pumps the valves or any other aspect are mere exemplary and alternate embodiments. Other embodiments are readily apparent.

In one exemplary embodiment of this cassette the top plate includes a spike as well as a container perch . The spike is hollow in this example and is fluidly connected to the flow path. In some embodiments a needle is attached into the spike. In other embodiments a needle is connected to the container attachment.

Referring now to the inside of the top plate is shown. The raised flow paths connects to the inlet flow paths and outlet flow paths of the pod pumps . The raised flow paths are described in more detail above.

The metering pump not shown includes connection to an air vent as well as connection to the spike s hollow path . In one exemplary embodiment the air vent includes an air filter not shown . The air filter may be a particle air filter in some cases. In some embodiments the filter is a somicron hydrophobic air filter. In various embodiments the size of the filter may vary in some instances the size will depend on desired outcome. The metering pump works by taking air in through the air vent pumping the air to the container of second fluid not shown through the spike s hollow path and then pumping a volume of second fluid out of the container not shown through the spike s hollow path and into the fluid line at point . This fluid flow path for the metering pump is shown with arrows on .

Referring now to the liquid side of the midplate is shown. The areas complementary to the fluid paths on the inner top plate are shown. These areas are slightly raised tracks that present a surface finish that is conducive to laser welding which is the mode of manufacture in one embodiment. The fluid inlet and fluid outlet are also shown in this view.

Referring next to the air side of the midplate is shown according to one embodiment. The air side of the valve holes correspond to the holes in the fluid side of the midplate shown in . As seen in diaphragms complete valves while diaphragms complete pod pumps . The metering pump is completed by diaphragm . The valves are actuated pneumatically and as the diaphragm is pulled away from the holes liquid is drawn in and as the diaphragm is pushed toward the holes liquid is pushed through. The fluid flow is directed by the opening and closing of the valves .

Referring to the metering pump includes three holes . One hole pulls air into the metering pump the second hole pushes air to the spike source container and also draws liquid from the source container and the third hole pushes the second fluid from the metering pump to the fluid line to point .

Valves actuate the second fluid metering pump. Valve is the second fluid spike valve valve is the air valve and valve is the valve that controls the flow of fluid to the fluid line to area .

Referring next to the inner view of the bottom plate is shown. The inside view of the pod pumps the metering pump and the valves actuation air chamber is shown. The pod pumps metering pump and the valves are actuated by a pneumatic air source. Referring now to the outer side of the bottom plate is shown. The source of air is attached to this side of the cassette. In one embodiment tubes connect to the features on the valves and pumps . In some embodiments the valves are ganged and more than one valve is actuated by the same air line.

Referring now to an assembled cassette with a container or other source of a second fluid is shown which in this embodiment may be an anticoagulant as described above attached is shown. The container contains the source of the second fluid and is attached to a hollow spike not shown by a container attachment . The spike may be situated within the container attachment directed upward to penetrate the top of the container which is held in an inverted position by the container attachment . The spike is in fluid communication with a fluid channel similar to the hollow path depicted in . The air filter is shown attached to the air vent not shown shown in as . Although not visible in the container perch shown in as is under the container attachment .

In some cases the metering pump is an FMS pump associated with a reference chamber and capable of being monitored with a pressure transducer to determine the volume of fluid that it delivers. The FMS algorithm uses changes in pressures to calculate a volume measurement at the end of a fill stroke and at the end of a delivery stroke. The difference between the computed volumes at the end of a fill and delivery stroke is the actual stroke volume. This actual stroke volume can be compared to an expected stroke volume for the particular sized chamber. If the actual and expected volumes are significantly different the stroke has not properly completed and an error message can be generated. FMS systems can vent to atmosphere for the FMS measurement. Alternatively the system can vent to a high pressure positive source and a low pressure negative source for the FMS measurement. In one set of embodiments the metering pump e.g. the anticoagulant pump is primed. Priming the pump removes air from the metering pump and the flow path and ensures that the pressure in the fluid container e.g. the anticoagulant vial is acceptable.

The metering pump can be designed such that air in the pump chamber flows up into the vial. The test is performed by closing all of the metering pump fluid valves measuring the external volume charging the pump s FMS chamber with vacuum opening valves to draw from the vial into the pumping chamber measuring the external volume again charging the FMS chamber with pressure opening the valves to push fluid back into the vial and then measuring the external volume again . Changes in external volume resulting from fluid flow should correspond to the known volume of the pumping chamber. If the pumping chamber cannot fill from the vial then the pressure in the vial is too low and air must be pumped in. Conversely if the pumping chamber cannot empty into the vial then the pressure in the vial is too high and some of the anticoagulant must be pumped out of the vial. Anticoagulant pumped out of the vial during these tests can be discarded e.g. through the drain.

During routine delivery of heparin or other medication to the blood path the pressure in the vial can be measured periodically. If the vial pressure is approaching a predefined threshold value below atmospheric pressure for example the metering pump can first introduce air into the vial via the metering pump air vent normalizing the pressure in the vial and helping to ensure the withdrawal of a reasonably precise amount of medication from the vial. If the vial pressure approaches a predefined threshold value above atmospheric pressure the metering pump can forego instilling any further air into the vial before the next withdrawal of medication from the vial.

An exploded view of the assembled cassette shown in is shown in . In these views an exemplary embodiment of the pod pump diaphragms is shown. The gasket of the diaphragm provides a seal between the liquid chamber in the top plate and the air actuation chamber in the bottom plate . The dimpled texture on the dome of diaphragms provide amongst other features additional space for air and liquid to escape the chamber at the end of stroke.

A system of the present invention may also include a balancing circuit e.g. balancing circuit as shown in . In some cases blood flow circuit is implemented on a cassette although it need not be. Within the balancing circuit the flow of dialysate that passes in and out of the dialyzer may be balanced in some cases such that essentially the same amount of dialysate comes out of the dialyzer as goes into it however this balance can be altered in certain cases due to the use of a bypass pump as discussed below .

In addition in some cases the flow of dialysate may also be balanced through the dialyzer such that the pressure of dialysate within the dialyzer generally equals the pressure of blood through the blood flow circuit. The flow of blood through the blood flow circuit and dialyzer in some cases is synchronized with the flow of dialysate in the dialysate flow path through the dialyzer. Because of the potential of fluid transfer across the semi permeable membrane of the dialyzer and because the pumps of the balancing circuit run at positive pressures the balancing circuit pumps can be timed to synchronize delivery strokes to the dialyzer with the delivery strokes of the blood pumps using pressure and control data from the blood flow pumps.

A non limiting example of a balancing circuit is shown in . In balancing circuit dialysate flows from optional ultrafilter into one or more dialysate pumps e.g. two as shown in . The dialysate pumps in this figure include two pod pumps two balancing chambers and pump for bypassing the balancing chambers. The balancing chambers may be constructed such that they are formed from a rigid chamber with a flexible diaphragm dividing the chamber into two separate fluid compartments so that entry of fluid into one compartment can be used to force fluid out of the other compartment and vice versa. Non limiting examples of pumps that can be used as pod pumps and or balancing chambers are described in U.S. Provisional Patent Application Ser. No. 60 792 073 filed Apr. 14 2006 entitled Extracorporeal Thermal Therapy Systems and Methods or in U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 entitled Fluid Pumping Systems Devices and Methods each incorporated herein by reference. Additional examples of pod pumps are discussed in detail below. As can be seen in the schematic of many of the valves can be ganged or synchronized together in sets so that all the valves in a set can be opened or closed at the same time.

More specifically in one embodiment balancing of flow works as follows. includes a first synchronized controlled together set of valves where valves are ganged and valves and are ganged as well as a second synchronized controlled together set of valves where valves are ganged and valves and are ganged. At a first point of time the first ganged set of valves is opened while the second ganged set of valves is closed. Fresh dialysate flows into balancing chamber while used dialysate flows from dialyzer into pod pump . Fresh dialysate does not flow into balancing chamber since valve is closed. As fresh dialysate flows into balancing chamber used dialysate within balancing chamber is forced out and exits balancing circuit the used dialysate cannot enter pod pump since valve is closed . Simultaneously pod pump forces used dialysate present within the pod pump into balancing chamber through valve which is open valves and are closed ensuring that the used dialysate flows into balancing chamber . This causes fresh dialysate contained within balancing chamber to exit the balancing circuit into dialyzer . Also pod pump draws in used dialysate from dialyzer into pod pump . This is also illustrated in .

Once pod pump and balancing chamber have filled with dialysate the first set of valves is closed and the second set of valves is opened. Fresh dialysate flows into balancing chamber instead of balancing chamber as valve is closed while valve is now open. As fresh dialysate flows into balancing chamber used dialysate within the chamber is forced out and exits balancing circuit since valve is now closed. Also pod pump now draws used dialysate from the dialyzer into the pod pump while used dialysate is prevented from flowing into pod pump as valve is now closed and valve is now open. Pod pump forces used dialysate contained within the pod pump from the previous step into balancing chamber since valves and are closed and valve is open. This causes fresh dialysate contained within balancing chamber to be directed into the dialyzer since valve is now open while valve is now closed . At the end of this step pod pump and balancing chamber have filled with dialysate. This puts the state of the system back into the configuration at the beginning of this description and the cycle is thus able to repeat ensuring a constant flow of dialysate to and from the dialyzer. This is also illustrated in . In an embodiment the fluid e.g. pneumatic pressures on the control side of the balancing chamber valves are monitored to ensure they are functioning properly.

As a specific example a vacuum e.g. 4 p.s.i. of vacuum can be applied to the port for the first ganged set of valves causing those valves to open while positive pressure e.g. 20 p.s.i. of air pressure 1 p.s.i. is 6.89475 kilopascals is applied to the second ganged set of valves causing those valves to close or vice versa . The pod pumps each urge dialysate into one of the volumes in one of the balancing chambers . By forcing dialysate into a volume of a balancing chamber an equal amount of dialysate is squeezed by the diaphragm out of the other volume in the balancing chamber. In each balancing chamber one volume is occupied by fresh dialysate heading towards the dialyzer and the other volume is occupied by used dialysate heading from the dialyzer. Thus the volumes of dialysate entering and leaving the dialyzer are kept substantially equal.

It should be noted that any valve associated with a balancing chamber may be opened and closed under any suitable pressure. However it may be advantageous to apply a lower or more controlled pressure to initiate and effect valve closure than the pressure ultimately used to keep the valve closed holding pressure . Applying the equivalent of the holding pressure to effectuate valve closure may lead to transient pressure elevations in the fluid line sufficient to cause an already closed downstream valve to leak adversely affecting the balancing of dialysate flow into and out of the dialyzer. Causing the dialysate pump and balancing chamber inlet and or outlet valves to close under a lower or more controlled pressure may improve the balancing of dialysate flow into and out of the dialyzer. In an embodiment this can be achieved for example by employing pulse width modulation PWM to the pressure being applied in the fluid control lines of the valves. Without being limited to the following theories the use of moderate or controlled pressure to slow close the valves may be effective for example because 1 it is possible that in some cases the pressure in a balancing chamber can transiently exceed the holding pressure in the closed balancing chamber outlet valve caused for example by applying excessive pressure to close the balancing chamber inlet valve against the mass of fluid behind the valve diaphragm . The transient elevation of pressure in the fluid line can overcome the holding pressure of the closed outlet valve resulting in a leak of fluid and an imbalance of fluid delivery between the two sides of the balancing chamber. 2 Also the presence of air or gas between the balancing chamber and a balancing chamber valve coupled with a rapid valve closure could cause excess fluid to be pushed through the balancing chamber without being balanced by fluid from the opposite side of the balancing chamber.

As the diaphragms approach a wall in the balancing chambers so that one volume in a balancing chamber approaches a minimum and the other volume approaches a maximum positive pressure is applied to the port for the first ganged set of valves causing those valves to close while a vacuum is applied to the second ganged set of valves causing those valves to open. The pod pumps then each urge dialysate into one of the volumes in the other of the balancing chambers . Again by forcing dialysate into a volume of a balancing chamber an equal amount of dialysate is squeezed by the diaphragm out of the other volume in the balancing chamber. Since in each balancing chamber one volume is occupied by fresh dialysate heading towards the dialyzer and the other volume is occupied by used dialysate heading from the dialyzer the volumes of dialysate entering and leaving the dialyzer are kept equal.

Also shown within is bypass pump which can direct the flow of dialysate from dialyzer through balancing circuit without passing through either of pod pumps or . In this figure bypass pump is a pod pump similar to those described above with a rigid chamber and a flexible diaphragm dividing each chamber into a fluid compartment and a control compartment. This pump may be the same or different from the other pod pumps metering pumps and or balancing chambers described above. For example this pump may be a pump as was described in U.S. Provisional Patent Application Ser. No. 60 792 073 filed Apr. 14 2006 entitled Extracorporeal Thermal Therapy Systems and Methods or in U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 entitled Fluid Pumping Systems Devices and Methods each incorporated herein by reference. Pod pumps are also discussed in detail below.

When control fluid is used to actuate this pump dialysate may be drawn through the dialyzer in a way that is not balanced with respect to the flow of blood through the dialyzer. The independent action of the bypass pump on the dialysate outlet side of the dialyzer causes an additional net ultrafiltration of fluid from the blood in the dialyzer. This may cause the net flow of liquid away from the patient through the dialyzer towards the drain. Such a bypass may be useful for example in reducing the amount of fluid a patient has which is often increased due to the patient s inability to lose fluid primarily water through the kidneys. As shown in bypass pump may be controlled by a control fluid e.g. air irrespective of the operation of pod pumps and . This configuration may allow for easier control of net fluid removal from a patient without the need to operate the balancing pumps inside and outside dialysate pumps in a way that would allow for such fluid to be withdrawn from the patient. Using this configuration it is not necessary to operate the inside dialysate pumps either out of balance or out of phase with the blood pumps in order to achieve a net withdrawal of fluid from the patient.

To achieve balanced flow across the dialyzer the blood flow pump the pumps of the balancing circuit and the pumps of the directing circuit discussed below may be operated to work together to ensure that flow into the dialyzer is generally equal to flow out of the dialyzer. If ultrafiltration is required the ultrafiltration pump if one is present may be run independently of some or all of the other blood and or dialysate pumps to achieve the desired ultrafiltration rate.

To prevent outgassing of the dialysate the pumps of the balancing circuit may be always kept at pressures above atmospheric pressure. In contrast however the blood flow pump and the directing circuit pumps use pressures below atmosphere to pull the diaphragm towards the chamber wall for a fill stroke. Because of the potential of fluid transfer across the dialyzer and because the pumps of the balancing circuit run at positive pressures the balancing circuit pumps may be able to use information from the blood flow pump s in order to run in a balanced flow mode. The delivery strokes of the balancing circuit chambers to the dialyzer can thus be synchronized with the delivery strokes of the blood pumps.

In one set of embodiments when running in such a balanced mode if there is no delivery pressure from the blood flow pump the balancing circuit pump diaphragm will push fluid across the dialyzer into the blood and the alternate pod of the balancing circuit will not completely fill. For this reason the blood flow pump reports when it is actively delivering a stroke. When the blood flow pump is delivering a stroke the balancing pump operates. When the blood flow pump is not delivering blood the valves that control the flow from the dialyzer to the balancing pumps and other balancing valves ganged together with these valves as previously discussed may be closed to prevent any fluid transfer from the blood side to the dialysate side from occurring. During the time the blood flow pump is not delivering the balancing pumps are effectively frozen and the stroke continues once the blood flow pump starts delivering again. The balancing pump fill pressure can be set to a minimal positive value to ensure that the pump operates above atmosphere at minimal impedance. Also the balancing pump delivery pressure can be set to the blood flow pump pressure to generally match pressures on either side of the dialyzer minimizing flow across the dialyzer during delivery strokes of the inside pump.

In some cases it may be advantageous to have the dialysate pump deliver dialysate to the dialyzer at a pressure higher than the delivery pressure of the blood pump to the dialyzer. This can help to ensure for example that a full chamber of clean dialysate can get delivered to the dialyzer. In an embodiment the delivery pressure on the dialysate pump is set sufficiently high to allow the inside pump to finish its stroke but not so high as to stop the flow of blood in the dialyzer. Conversely when the dialysate pump is receiving spent dialysate from the dialyzer in some cases it may also be advantageous to have the pressure in the dialysate pump set lower than the outlet pressure on the blood side of the dialyzer. This can help ensure that the receiving dialysate chamber can always fill in turn ensuring that there is enough dialysate available to complete a full stroke at the balancing chamber. Flows across the semi permeable membrane caused by these differential pressures will tend to cancel each other and the pumping algorithm otherwise attempts to match the average pressures on the dialysate and blood sides of the dialyzer.

Convective flow that does occur across the dialyzer membrane may be beneficial because a constant and repeated shifting of fluid back and forth across the dialyzer in small increments resulting in no net ultrafiltration can nevertheless help to prevent clot formation within the blood tubing and dialyzer which in turn may allow for a smaller heparin dosage prolong the useful life of the dialyzer and facilitate dialyzer cleaning and re use. Backflushing has the additional benefit of promoting better solute removal through convection. In another embodiment a form of continuous backflushing across the dialyzer membrane can also be achieved by making small adjustments to the synchronization of the delivery strokes of blood with the delivery strokes of dialysate through the dialyzer.

In certain embodiments the pod pumps of the inner dialysate cassette may be phased to minimize occlusions in the blood side of the dialyzer . The inner dialysate pop pumps may be phased to work with the blood pumps to alternately flow liquid into the blood side of the dialyzer and back to the dialysate side with each stroke of the inner dialysate pump . The timing of the pump strokes valve openings valve closings and pop pump actuation pressures may be controlled by the automatic computer . The automatic computer may control the pumps valves and receives pressure data via the pneumatic pressure distribution module . Phasing the inner dialysate pumps to push the fluid back and forth across the dialyzer membrane has benefits including but not limited to improved removal of large molecule solutes from the blood and minimized occlusions of the dialyzer 

The flows through the dialyzer may be controlled by the pumps and valves shown schematically in . One example of the timing and function of the blood and dialysate pumps are plotted in . The blood pumps pod pumps may operating 180 degrees out of phase to provide a near continuous flow of blood to the dialyzer . Cleaned blood and some dialysate fluid may flow from the dialyzer to the venous line in the BTS. Fresh dialysate may flow into the dialyzer from the balancing pod while used dialysate and fluid from the blood side flow into a receiving pod pump . Clean dialysate may flow from the balance pod as the other dialysate pump forces used dialysate into the balancing pod . The used and clean dialysate are separated by a diaphragm. The other balancing pod may be filled with fresh dialysate from the outer dialysate pump in preparation for the next pump stroke.

The blood pump A may be caused to deliver blood to the dialyzer by opening the downstream valve closing the upstream valve and raising the pod pressure measured by . The blood pump may be caused to fill from the arterial line by opening the upstream valve closing the downstream line and reducing the pressure below ambient as measured by .

One exemplary sequence to push and pull fluid across the dialyzer membrane may begin at time with blood pump A delivering blood to the dialyzer while blood pump is filled. The measured pressures of the delivering and filling pumps are plotted as and respectively. The pressures may vary periodically in response to the vari valves sinusoidally varying the size of the valve port. The automatic computer may monitor the pressure traces and to detect end of stroke in the blood pumps.

The pumps and valves of the inner dialysate may be controlled to allow fluid from the blood in the dialyzer to flow into the receiving dialysate pump pod between times and . Valve may be closed to prevent the flow of clean dialysate into the dialyzer . Valve may be open and the pump pod pressure may be low to allow fluid from the blood to flow into the dialysate pump pod . The blood pump may flow blood through the dialyzer during this period .

The inner dialysate valves and pumps may be controlled between times and to flow dialysate through the dialyzer with zero or minimal flow across the dialyzer membrane. Valves and may be opened to allow the pneumatic pressure in pump pod to force clean dialysate from the balancing pod through the dialyzer and into pump pod . Pump may force clean dialysate from the balancing pod by flowing used dialysate into back side of membrane C. The blood pump may continue to flow blood through the dialyzer during this period. The pressures in pump pods and may vary periodically in response to the vari valves sinusoidally varying the size of the valve ports. The automatic computer may monitor the pressure traces and to detect end of stroke in the dialysate pumps .

Dialysate may flow into the blood side of the dialyzer during the last part of the dialysate pump stroke. The receiving pump pod may completely fill at time while the delivery pump continues to pump fresh dialysate from the balancing pod until time . The dialysate from the balancing pod may not be able not enter the full pump pod and may instead flow across the dialyzer membrane and enter the blood circuit. The blood pump may continue to flow blood through the dialyzer during part or all of this period. Without wishing to be bound by any theory it is believed that the dialysate flowing into the blood side of the dialyzer may dislodge the larger solutes from the pores centers and ends of the membrane tubes. Once dislodged from the surface the larger solutes are then more likely to flow through or across the membrane.

In one exemplary method the action of the dialysate pumps may be stopped while the blood pump switches from one pump pod to the other if the receiving pump pod is not full. The dialysate pumps may be stopped to avoid a false end of stroke due to pressure signals from the switching blood pumps. If the automatic computer detects an end of stroke condition on the blood pump before the receiving pump pod is full then it may close the balancing chamber outlet valve and the pump inlet valve . The valves and may be reopened once the blood pump restarts. If the blood pump pod completes a stroke after the receive pump pod is full then the blood pump will wait until the delivering pump pod completes its stroke. The automatic computer may determine that pump pod strokes are complete or that the dialysate pump pod is full based on the correlation number to determine an end of stroke condition.

The pump pod pressures in the dialysate circuit may be optimally set to assure the desired direction of dialysate and blood flow without damaging the dialyzer membrane. The pressure in the deliver pod pump may be set to 54 mmHg above the blood delivery pressure. The receiving pump pod may be adjusted to the larger of 25 mmHg above ambient pressure or the blood delivery pressure minus the transmembrane pressure. The delivery pump pod pressure may be increased to the maximum transmembrane pressure of the dialyzer after the fill or receiving pump pod is full.

In one exemplary method the vari valves in the blood pump may be cycled at a different frequency than the vari valves of the dialysate pump to allow the end of stroke detection of each pump to be separately measured. As described elsewhere the restriction of the vari valve on a pump pod is varied sinusoidally about a mean value. This small change in restriction produces a similar small change in the measure pressure in the activation chamber. The correlation filter described elsewhere produces a numerical measure of how well the pressure responds to the vari valve variations. The resulting correlation number may be used to determine end of stroke. The pressure variations in the blood pump pod may be detected by the sensor on the fill pump pod which could produce false end of stroke readings. However correlation filter rejects pressure signals that are at a different frequency than the vari valve frequency. In order to isolate the pressure signals from the two pumps the vari valves may be dithered at a frequency that is 90 of the frequency at which the blood pump vari valve is dithered.

In one exemplary method the deliver pump delay is optimally adjusted to deliver the desired amount of dialysate into the blood circuit at the end of the dialysate stroke. A simple proportional closed loop controller varies the deliver pump delay to achieve the desired time for dialysate flow into the blood circuit . The controller may adjust the pump delay time to adapt to changes in the flow impedances on the blood side and or the dialysate side of the flow circuit or changes in the transmembrane impedance of the dialyzer.

The sequence is then repeated where pump pod is now the receiving pump that begins the process by receiving fluid from the blood size of the dialyzer while the delivering pump is fixed. Then both pumps and move until the receiving pump is full. At this time pump continues and delivers dialysate to the blood side.

The method to create small periodic flows back and forth across the dialyzer with pumps valves and balancing chambers is one exemplary method. Other methods and pump valve embodiments are contemplated.

The described hardware of the inner dialysate and blood cassettes and the method of phasing the dialysate is one implementation. The same method of phasing one or more pumps on at least one side of a semi permeable filter in order to periodically force fluid back and forth across filter could be applied to flows of liquid through other semi permiable filters including but not limited to ultra filters.

It is generally beneficial to keep the blood flow as continuous as possible during therapy as stagnant blood flow can result in blood clots. In addition when the delivery flow rate on the blood flow pump is discontinuous the balancing pump must pause its stroke more frequently which can result in discontinuous and or low dialysate flow rates.

However the flow through the blood flow pump can be discontinuous for various reasons. For instance pressure may be limited within the blood flow pump e.g. to 600 mmHg and or 350 mmHg to provide safe pumping pressures for the patient. For instance during dual needle flow the two pod pumps of the blood flow pump can be programmed to run 180 out of phase with one another. If there were no limits on pressure this phasing could always be achieved. However to provide safe blood flow for the patient these pressures are limited. If the impedance is high on the fill stroke due to a small needle very viscous blood poor patient access etc. the negative pressure limit may be reached and the fill flow rate will be slower than the desired fill flow rate. Thus the delivery stroke must wait for the previous fill stroke to finish resulting in a pause in the delivery flow rate of the blood flow pump. Similarly during single needle flow the blood flow pump may be run at 0 phase where the two blood flow pump pod pumps are simultaneously emptied and filled. When both pod pumps are filled the volumes of the two pod pumps are delivered. In an embodiment the sequence of activation causes a first pod pump and then a second pod pump to fill followed by the first pod pump emptying and then the second pod pump emptying. Thus the flow in single needle or single lumen arrangement may be discontinuous.

One method to control the pressure saturation limits would be to limit the desired flow rate to the slowest of the fill and deliver strokes. Although this would result in slower blood delivery flow rates the flow rate would still be known and would always be continuous which would result in more accurate and continuous dialysate flow rates. Another method to make the blood flow rate more continuous in single needle operation would be to use maximum pressures to fill the pods so the fill time would be minimized. The desired deliver time could then be set to be the total desired stroke time minus the time that the fill stroke took. However if blood flow rate cannot be made continuous then dialysate flow rate may have to be adjusted so that when the blood flow rate is delivering the dialysate flow is higher than the programmed value to make up for the time that the dialysate pump is stopped when the blood flow pump is filling. The less continuous the blood flow the more the dialysate flow rate may have to be adjusted upward during blood delivery to the dialyzer. If this is done with the correct timing an average dialysate flow rate taken over several strokes can still match the desired dialysate flow rate.

A non limiting example of a balancing cassette is shown in . In one structure of the cassette shown in the valves are ganged such that they are actuated at the same time. In one embodiment there are four gangs of valves . In some cases the ganged valves are actuated by the same air line. However in other embodiments each valve has its own air line. Ganging the valves as shown in the exemplary embodiment creates the fluid flow described above. In some embodiments ganging the valves also ensures the appropriate valves are opened and closed to dictate the fluid pathways as desired.

In this embodiment the fluid valves are volcano valves as described in more detail herein. Although the fluid flow path schematic has been described with respect to a particular flow path in various embodiments the flow paths may change based on the actuation of the valves and the pumps. Additionally the terms inlet and outlet as well as first fluid and second fluid are used for description purposes only for this cassette and other cassettes described herein as well . In other embodiments an inlet can be an outlet as well as a first and second fluid may be different fluids or the same fluid types or composition.

Referring now to the top plate of an exemplary embodiment of the cassette is shown. Referring first to the top view of the top plate is shown. In this exemplary embodiment the pod pumps and the balancing pods on the top plate are formed in a similar fashion. In this embodiment the pod pumps and balancing pods when assembled with the bottom plate have a total volume of capacity of 38 ml. However in various embodiments the total volume capacity can be greater or less than in this embodiment. The first fluid inlet and the second fluid outlet are shown.

Referring now to the bottom view of the top plate is shown. The fluid paths are shown in this view. These fluid paths correspond to the fluid paths shown in in the midplate . The top plate and the top of the midplate form the liquid or fluid side of the cassette for the pod pumps and for one side of the balancing pods . Thus most of the liquid flow paths are on the top and midplates. The other side of the balancing pods flow paths are located on the inner side of the bottom plate not shown here shown in .

Still referring to the pod pumps and balancing pods include a groove . The groove is shown having a particular shape however in other embodiments the shape of the groove can be any shape desirable. The shape shown in is an exemplary embodiment. In some embodiments of the groove the groove forms a path between the fluid inlet side and the fluid outlet side of the pod pumps and balancing pods .

The groove provides a fluid path whereby when the diaphragm is at the end of stroke there is still a fluid path between the inlet and outlet such that the pockets of fluid or air do not get trapped in the pod pump or balancing pod. The groove is included in both the liquid and air sides of the pod pumps and balancing pods see with respect to the air side of the pod pumps and the opposite side of the balancing pods .

The liquid side of the pod pumps and balancing pods in one exemplary embodiment include a feature whereby the inlet and outlet flow paths are continuous while the outer ring is also continuous. This feature allows for the seal formed with the diaphragm not shown to be maintained.

Referring to the side view of an exemplary embodiment of the top plate is shown. The continuous outer ring of the pod pumps and balancing pods can be seen.

Referring now to the bottom plate is shown. Referring first to the inside surface of the bottom plate is shown. The inside surface is the side that contacts the bottom surface of the midplate not shown see . The bottom plate attaches to the air lines not shown . The corresponding entrance holes for the air that actuates the pod pumps and valves not shown see in the midplate can be seen . Holes correspond to the second fluid inlet and second fluid outlet shown in respectively. The corresponding halves of the pod pumps and balancing pods are also shown as are the grooves for the fluid paths. Unlike the top plate the bottom plate corresponding halves of the pod pumps and balancing pods make apparent the difference between the pod pumps and balancing pods . The pod pumps include an air path on the second half in the bottom plate while the balancing pods have identical construction to the half in the top plate. Again the balancing pods balance liquid thus both sides of the diaphragm not shown will include a liquid fluid path while the pod pumps are pressure pumps that pump liquid thus one side includes a liquid fluid path and the other side shown in the bottom plate includes an air actuation chamber or air fluid path.

In one exemplary embodiment of the cassette sensor elements are incorporated into the cassette so as to discern various properties of the fluid being pumped. In one embodiment the three sensor elements are included. In one embodiment the sensor elements are located in the sensor cell . The cell accommodates three sensor elements in the sensor element housings . In an embodiment two of the sensor housings accommodate a conductivity sensor element and the third sensor element housing accommodates a temperature sensor element. The conductivity sensor elements and temperature sensor elements can be any conductivity or temperature sensor elements in the art. In one embodiment the conductivity sensor elements are graphite posts. In other embodiments the conductivity sensor elements are posts made from stainless steel titanium platinum or any other metal coated to be corrosion resistant and still be electrically conductive. The conductivity sensor elements can include an electrical lead that transmits the probe information to a controller or other device. In one embodiment the temperature sensor is a thermistor potted in a stainless steel probe. In alternate embodiments there are either no sensors in the cassette or only a temperature sensor only one or more conductivity sensors or one or more of another type of sensor. In some embodiments the sensor elements are located outside of the cassette in a separate cassette and may be connected to the cassette via a fluid line.

Still referring to the actuation side of the metering pump is also shown as well as the corresponding air entrance hole for the air that actuates the pump. Referring now to the outer side of the bottom plate is shown. The valve pod pumps and metering pump air line connection points are shown. Again the balancing pods do not have air line connection points as they are not actuated by air. As well the corresponding openings in the bottom plate for the second fluid outlet and second fluid inlet are shown.

Referring now to a side view of the bottom plate is shown. In the side view the rim that surrounds the inner bottom plate can be seen. The rim is raised and continuous providing for a connect point for the diaphragm not shown . The diaphragm rests on this continuous and raised rim providing for a seal between the half of the pod pumps and balancing pods in the bottom plate and the half of the pod pumps and balancing pods in the top plate not shown see .

As mentioned dialysate flows from a directing circuit optionally through a heater and or through an ultrafilter to the balancing circuit. In some cases the directing circuit is implemented on a cassette although it need not be. An example of a directing circuit can be seen in as directing circuit . Directing circuit is able to perform a number of different functions in this example. For instance dialysate flows from a dialysate supply such as from a mixing circuit as discussed below through the directing circuit to a balancing circuit while used dialysate flows from the balancing circuit to a drain. The dialysate may flow due to the operation of one or more pumps contained within the directing circuit. In some cases the directing circuit may also contain a dialysate tank which may contain dialysate prior to passing the dialysate to the balancing circuit. Such a dialysate tank in certain instances may allow the rate of production of dialysate to be different than the rate of use of dialysate in the dialyzer within the system. The directing circuit may also direct water from a water supply to the mixing circuit if one is present . In addition as previously discussed the blood flow circuit may be fluidically connected to the directing circuit for some operations e.g. disinfection.

Thus in some cases dialysate may be made as it is needed so that large volumes of dialysate do not need to be stored. For instance after the dialysate is prepared it may be held in a dialysate tank . A dialysate valve may control the flow of dialysate from tank into the dialysate circuit . The dialysate may be filtered and or heated before being sent into the dialyzer . A waste valve may be used to control the flow of used dialysate out of the dialysate circuit .

One non limiting example of a directing circuit is shown in . In this figure directing circuit fluidically connects dialysate from a dialysate supply to a dialysate tank then through dialysate pump heater and ultrafilter before entering a balancing circuit as previously discussed. It should be understood that although this figure shows that dialysate in the dialysate flow path flows from the dialysate supply to the dialysate tank the pump the heater and the ultrafilter in that order other orderings are also possible in other embodiments. Heater may be used to warm the dialysate to body temperature and or a temperature such that the blood in the blood flow circuit is heated by the dialysate and the blood returning to the patient is at body temperature or higher. Ultrafilter may be used to remove any pathogens pyrogens etc. which may be in the dialysate solution as discussed below. The dialysate solution then flows into the balancing circuit to be directed to the dialyzer.

Dialysate tank may comprise any suitable material and be of any suitable dimension for storing dialysate prior to use. For instance dialysate tank may comprise plastic metal etc. In some cases dialysate tank may comprise materials similar to those used to form the pod pumps as discussed herein.

The flow of dialysate through directing circuit may be controlled at least in part by operation of dialysate pump . In addition dialysate pump may control flow through the balancing circuit. For instance as discussed above with reference to fresh dialysate from the directing circuit flows into balancing chambers and on balancing circuit pump may be used as a driving force to cause the fresh dialysate to flow into these balancing chambers. In one set of embodiments dialysate pump includes a pod pump similar to those described above. The pod pump may include a rigid chamber with a flexible diaphragm dividing each chamber into a fluid compartment and control compartment. The control compartment may be connected to a control fluid source such as an air source. Non limiting examples of pumps that may be used as pod pumps and or balancing chambers are described in U.S. Provisional Patent Application Ser. No. 60 792 073 filed Apr. 14 2006 entitled Extracorporeal Thermal Therapy Systems and Methods or in U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 entitled Fluid Pumping Systems Devices and Methods each incorporated herein by reference. Pod pumps are also discussed in detail below.

After passing through pump the dialysate may flow to a heater e.g. heater in . The heater may be any heating device suitable for heating dialysate for example an electrically resistive heater as is known to those of ordinary skill in the art. The heater may be kept separated from the directing circuit e.g. as is shown in or the heater may be incorporated into the directing circuit or other circuits as well e.g. the balancing circuit .

In some cases the dialysate is heated to a temperature such that blood passing through the dialyzer is not significantly chilled. For instance the temperature of the dialysate may be controlled such that the dialysate is at a temperature at or greater than the temperature of the blood passing through the dialyzer. In such an example the blood may be heated somewhat which may be useful in offsetting heat loss caused by the blood passing through the various components of the blood flow circuit as discussed above. In addition in some cases as discussed below the heater may be connected to a control system such that dialysate that is incorrectly heated i.e. the dialysate is too hot or too cold may be recycled e.g. back to the dialysate tank or sent to drain instead of being passed to the dialyzer for example via line . The heater may be integrated as part of a fluid circuit such as a directing circuit and or a balancing circuit or as is shown in the heater may be a separate component within the dialysate flow path.

The heater may also be used in some embodiments for disinfection or sterilization purposes. For instance water may be passed through the hemodialysis system and heated using the heater such that the water is heated to a temperature able to cause disinfection or sterilization to occur e.g. temperatures of at least about 70 C. at least about 80 C. at least about 90 C. at least about 100 C. at least about 110 C. etc. In some cases as discussed below the water may be recycled around the various components and or heat loss within the system may be minimized e.g. as discussed below such that the heater is able to heat the water to such disinfection or sterilization temperatures.

The heater may include a control system that is able to control the heater as discussed above e.g. to bring dialysate up to body temperature for dialyzing a patient to bring the water temperature up to a disinfection temperatures in order to clean the system etc. .

A non limiting example of a heater controller follows. The controller may be selected to be capable of dealing with varying inlet fluid temperatures as well as for pulsatile or varying flow rates. In addition the heater control must function properly when flow is directed through each of the different flow paths dialyze disinfect re circulate etc . In one embodiment the heater controller is used on SIP1 boards with an IR infrared temperature sensor on the ultra filter and an IR temperature sensor on the tank. In other embodiments the board is in a box with less heat losses and to uses conductivity sensors for the inlet temperature sensor. Another embodiment of the controller uses a simple proportional controller using both tank heater inlet and ultrafilter heater outlet temperatures e.g. powerHeater massFlow tankGain errorTank Gain error where 

From the heater duty cycle command 0 100 a PWM command is generated. In some embodiments this controller may reduce the mass flow rate if the given temperature is not maintained and the heater is saturated.

An alternative embodiment of the heater in may include a dialysate flow path through which an electrical heater element and a heater temperature sensor are complemented by temperatures sensors located in the fluid path upstream and downstream of the heater. Temperature sensor is located just upstream of the heater to provide information on the temperature of the entering fluid. Redundant temperature sensors and are located downstream of the ultrafilter in order to measure the temperature of the dialysate entering inner dialysate cassette. A temperature sensor may be located on line in order to measure flow diverted from the inner cassette.

Referring to in an alternative embodiment a Heater Control Mode consists of a control loop around the heater. In an embodiment the Heater Control Mode uses a closed loop controller to simple proportional integral controller to bring the heater temperature to the desired temperature by outputting a duty cycle command to the heater . In another example the closed loop controller is a proportional controller. The heater temperature is measured by the heater temperature sensor. The heater temperature sensor is in thermal contact with the flow conduit in the heater . the heater temperature sensor may also be embedded in the heater . The duty cycle command may be converted to a pulse width modulation PWM command with a base frequency of 1 Hz. The heater current may be controlled by the PWM command with SCR electronics that turn on and off at zero crossing. The heater current may also be controlled by a transistor switch such as a FET IGBT or BJT . Assuming a 60 Hz power line frequency the 1 Hz PWM frequency allows a resolution of 1 in 60.

The lower limit on heater duty cycle command may be zero. The heater may be configured to run at 100 duty cycle or at a reduced duty cycle. The maximum duty cycle may be limited by the electrical power available. In one embodiment the maximum duty cycle for the heater may be 70 for a total current draw of 8 amps allowing adequate power to run the balance of components in the Dialysis Machine . In another embodiment the maximum total current draw is 11 amps and the heat duty cycle is limited to 100 . The user or technician may set the maximum duty cycle of the heater controller and the maximum draw of the Dialysis Machine represented in block form in by selecting a high or low power setting via software. The lower power setting may allow the Dialysis Machine to be plugged into the same circuit as a machine to prepare water for the Dialysis Machine . The maximum heater command may be limited by saturation block shown in . The maximum flow rate through the heater may be controlled based on the inlet temperature and available power in order to produce dialysate that achieves the minimum allowed dialysate temperature as measured by sensors .

The heater controller may be considered inherently non symmetrical as it can increase the heater temperature by using more electrical power but depends on heat loss to the ambient air or flowing dialysate to reduce the heater temperature. The control loop in may be operated with different integral and proportional gains to adapt to different levels of heat loss due to external factors which include but are not limited to ambient temperatures incoming dialysate temperature and dialysate flow rates.

The Heater Control Mode may select different gains depending on the operating mode selected in the Therapy Applications . The gains may be set higher when an operating mode is selected that calls for high fluid flow through the heater. The gains may be set lower when an operating mode is selected that calls for low fluid flow through the heater. The gains may be set to minimum or zero values during modes when there is no flow through the heater in order to prevent temperature overshoot. The gains may be set low during a disinfect operating mode to prevent overshoot at high temperatures as disinfection temperatures may be near the material temperature limits and the large temperature increases associated with thermal disinfection are more likely to produce temperature overshoots.

A saturation block may limit the output of the heater control loop to that of the maximum heater duty cycle. In a preferred embodiment the maximum heater duty cycle is selectable between about 70 and about 100 .

In another embodiment to avoid temperature overshoot the value of an integrator may be limited. If the heater command is at its upper limit the integrator value may not be allowed to increase until the heater command drops below its upper limit. The integrator value is allowed to decrease at all times.

In order to minimize heater temperature fluctuations when fluid flow through the heater is momentarily stopped the Heater Control Mode may suspend the heater operation and save one or more control parameters in memory. In a preferred embodiment when fluid flow through the heater stops for a short period the heater may be turned off and the integrator value may be saved. The heater subsequently may be turned back on with the gains appropriate for the operating mode and with the integrator value reloaded from memory.

An alternative embodiment of the heater controller referred to as a Fluid Temp Control Mode is shown in . The Fluid Temp Control Mode may add an outer control loop around the inner control loop of the Heater Control Mode. The outer control loop may bring the actual fluid temperature to the desired fluid temperature by varying the desired heater temperature . The Fluid Temp Control Mode supplies this desired heater temperature to the inner control loop which produces a signal to control the heater as described above in the Heater Control Mode. The inner control loop may include changing the gains based on the operating mode of the dialysis unit and limiting the integrator when the heater command reaches the maximum allowed value. The Fluid Temp Control Mode may include a feed forward command ffCmd based on the desired temperature the inlet fluid temperature the fluid flow rate and a gain factor ffCmd dot over ffGain

The outer control loop may include a saturation block that imposes on the feed forward command an upper and lower limit to values between the desired fluid temperature point and a maximum allowed heater temperature. A second saturation block may limit the output of the outer control loop to the maximum heater temperature. In a preferred embodiment the maximum temperature during dialysis may be set to about 70 C. and to about 112 C. during disinfection.

The Fluid Temp Control Mode may select different gains depending on the operating mode selected in the Therapy Applications . The gains may be set higher when an operating mode calls for high fluid flow through the heater. The gains may be set lower when an operating mode calls for low flows of fluid through the heater . The gains may be set to minimum or zero values during modes when there is no flow through the heater in order to prevent temperature overshoot.

Fluid Temp Control Mode may limit the integrator value in order to avoid temperature overshoot. If either the heater command or desired heater temperature are at the maximum allowed values then the integrator value may not be allowed to increase until both the heater command and desired heater temperature drop below their upper limits. The integrator value is allowed to decrease at all times.

The Fluid Temp Control Mode is optionally able to change the dialysate flow rate from the outer pump to maintain the dialysate within the desired temperature limits. If either the heater command or desired heater temperature are at the maximum allowed values for a pre determined minimum period of time the dialysate flow rate may be reduced to a rate of for example about 30 ml min stroke. If both the heater command and desired heater temperature drop below their upper limits for a pre determined minimum period of time the desired flow rate may be ramped up at a rate of for example 30 ml min until the flow rate returns to its original programmed value. In a preferred embodiment the minimum period of time is set to the time to complete the current and previous strokes. The Fluid Temp Control Mode uses the minimum period of time to produce a smoother temperature response and reduce temperature overshoots. The flow through the heater may be limited to a pre determined minimum value. In a preferred embodiment the minimum flow rate for dialysate through the heater as measured by the outer pump is set to about 100 ml min.

In order to minimize heater temperature fluctuations when fluid flow through the heater is stopped for a short time the Fluid Temp Control Mode is programmed to suspend the heater operation and save one or more control parameters in memory. The fluid flow may be stopped periodically as the dialysis unit performs functional checks that include dialysate levels and performance of the fluid valves. In a preferred embodiment when fluid flow through the heater stops for a short period the heater is turned off while the preceding dialysate flow rate and the integrator values are saved in memory. When the flow restarts the integrator values and dialysate flow rate are reloaded from memory the heater is turned back on and the gains are set as appropriate for the operating mode.

In an alternative embodiment as shown in the heater controller has a Heater Only Power Mode consisting of a control loop around the heater. The Heater Only Power Mode may use a simple proportional integral controller to bring the heater temperature to the heater set point temperature by outputting a duty cycle command to the heater . The heater set point temperature may be the output of a feed forward command limited by a saturation block . The feed forward command may be based a number of parameters such as the measured inlet fluid temperature desired fluid temperature assumed fluid mass flow and a gain factor. In a preferred embodiment the feed forward signal may be calculated as ffCmd ffGain

The feed forward command may be limited by a saturation block to a range of values. In a preferred embodiment the saturation block limits the desired heater temperature to values between the desired fluid temperature and a maximum value such as for example 41 C.

The heater temperature may be measured by the heater temperature sensor. The inlet temperature is measured by sensor . The duty cycle command may be converted to a PWM command which in one aspect has a base frequency of about 1 Hz. The heater current may be controlled by a PWM command with SCR electronics that turn on and off at zero crossing or a transistor switch such as aFET IGBT or BJT. Assuming a 60 Hz power line frequency the 1 Hz PWM frequency allows a resolution of 1 in 60.

The lower limit on heater duty cycle command can be set to zero. The heater may be configured to run at 100 duty cycle or at a reduced duty cycle. The maximum duty cycle may be limited by the electrical power available. In a preferred embodiment the maximum duty cycle is set to about 70 limiting the total current draw to 8 amps which would allow power for running the balance of components in the Dialysis Machine . Alternatively the maximum total current draw is set to 11 amps and the heat duty cycle is limited to 100 . The user or technician may set the maximum duty cycle of the heater controller and the maximum draw of the Dialysis Machine by selecting via software a high or low power setting. The lower power setting may allow the Dialysis Machine to be plugged into the same electrical circuit as a machine that prepares water for the Dialysis Machine . Depending on the available power the maximum flow rate through the heater may be controlled by monitoring the inlet temperature so that the dialysate produced achieves the minimum allowed dialysate temperature as measured at sensors .

The Heater Only Power Mode may select different gains depending on the operating mode selected in the Therapy Applications . The gains may be set higher when an operating mode is selected that calls for high fluid flow through the heater. The gains may be set lower when an operating mode is selected that calls for low fluid flow through the heater. The gains may be set to minimum or zero values during modes when there is no flow through the heater in order to prevent temperature overshoot. The gains may be set low during disinfect operating mode to prevent overshoot at high temperatures as disinfection temperatures may approach material temperature limits and the large temperature increases are more likely to produce temperature overshoots.

Another method to avoid temperature overshoot involves limiting the integrator value . If the heater command is at its upper limit the integrator value is not allowed to increase until the heater command drops below its upper limit. The integrator value is allowed to decrease at all times.

In order to minimize heater temperature fluctuations when fluid flow through the heater is momentarily stopped the Heater Only Power Mode may suspend the heater operation and save one or more control parameters in memory. In a preferred embodiment when fluid flow through the heater stops for a short period the heater may be turned off and the integrator value may be saved in memory. The heater may be turned back on by reloading the integrator value from memory with the gains set as appropriate for the operating mode.

In one embodiment of the heater controller a number of safety checks are performed during start up to confirm the functioning of the heater system including heater function temperature sensors and control electronics. The startup safety checks may include checking that temperature sensor outputs are within an expected range. In an embodiment the expected range for temperature sensors is 0 C. to 110 C.

In order to verify that the heater can be turned on and off the startup safety checks may include a heater system test that turns the heater on for a short period while monitoring the heater temperature sensor during this on period and then for a longer off period. The test may require that the heater sensor value increases during the on period and does not continue to increase during the off period. In a preferred embodiment the heater is turned on for about 5 seconds while the temperature sensor is monitored during the 5 second on period and a subsequent 20 second off period. In an embodiment the test is passed if the heater temperature increases by at least about 1.0 C. and no less than a bout 6.0 C.

In order to verify proper heater function during the operation of the dialysis unit the heater temperature is monitored when the heater command is at its maximum value. In order to pass this test the heater temperature is expected to rise a pre determined amount over a specified time period. In a preferred embodiment the heater temperature is expected to rise more than about 0.5 C. over a 1 minute period. This test may be run during operational modes when the patient is connected to the dialysis unit.

The safety tests may monitor the heater temperature during all operations to avoid excessive fluid temperatures. If the heater temperature exceeds maximum allowed heater temperature for a given operating mode the heater and heater controller are disabled. In a preferred embodiment the maximum heater temperature during patient connected operations is set to about 70 C. The maximum heater temperature during disinfect mode may be set to a higher temperature such as about 100 110 C. The heater may include a secondary safety system composed of a thermal fuse on the heater.

The safety tests may monitor two or more of the fluid temperature sensors and disable the heater and heater controllers if any one of the temperature sensors exceeds a maximum disinfect fluid temperature. Preferably all the fluid temperature sensors are monitored with a maximum disinfect fluid temperature set to about 100 C. One benefit of this test is that protects against failures of a single fluid temperature sensor or failure of the heater temperature sensor.

The safety tests may include monitoring the outer pump during Fluid Temp Control Mode and disabling the heater and heater controllers if fluid flow cannot be verified. The heater and controllers may be disabled in Fluid Temp Control Mode if the outer pump controller detects an occlusion or a pneumatic leak.

It should be understood that the above described heater controls are by way of example only and that other heater control systems and other heaters are also possible in other embodiments of the invention.

The dialysate may also be filtered to remove contaminants infectious organisms pathogens pyrogens debris and the like for instance using an ultrafilter. The filter may be positioned in any suitable location in the dialysate flow path for instance between the directing circuit and the balancing circuit e.g. as is shown in and or the ultrafilter may be incorporated into the directing circuit or the balancing circuit. If an ultrafilter is used it may be chosen to have a mesh or pore size chosen to prevent species such as these from through the filter. For instance the mesh or pore size may be less than about 0.3 micrometers less than about 0.2 micrometers less than about 0.1 micrometers or less than about 0.05 micrometers etc. Those of ordinary skill in the art will be aware of filters such as ultrafilters and in many cases such filters may be readily obtained commercially.

In some cases the ultrafilter may be operated such that waste from the filter e.g. the retentate stream is passed to a waste stream such as waste line in . In some cases the amount of dialysate flowing into the retentate stream may be controlled. For instance if the retentate is too cold i.e. heater is not working or heater is not heating the dialysate to a sufficient temperature the entire dialysate stream or at least a portion of the dialysate may be diverted to waste line and optionally recycled to dialysate tank using line . Flow from the filter may also be monitored for several reasons e.g. using temperature sensors e.g. sensors and conductivity sensors for confirming dialysate concentration e.g. sensor or the like. An example of such sensors is discussed below further non limiting examples can be seen in U.S. patent application Ser. No. 12 038 474 entitled Sensor Apparatus Systems Devices and Methods filed on Feb. 27 2008 and incorporated herein by reference.

It should be noted that the ultrafilter and the dialyzer provide redundant screening methods for the removal of contaminants infectious organisms pathogens pyrogens debris and the like in this particular example although in other cases the ultrafilter may be absent . Accordingly for contaminants to reach the patient from the dialysate the contaminants must pass through both the ultrafilter and the dialyzer. Even in the event that one fails the other may still be able to provide sterility and prevent contaminants from reaching the patient s blood.

Directing circuit may also be able to route used dialysate coming from a balancing circuit to a drain e.g. through waste line to drain in . The drain may be for example a municipal drain or a separate container for containing the waste e.g. used dialysate to be properly disposed of. In some cases one or more check or one way valves e.g. check valves and may be used to control flow of waste from the directing circuit and from the system. Also in certain instances a blood leak sensor e.g. sensor may be used to determine if blood is leaking through the dialyzer into the dialysate flow path. In addition a liquid sensor can be positioned in a collection pan at the bottom of the hemodialysis unit to indicate leakage of either blood or dialysate or both from any of the fluid circuits.

The drain may include an air in line detector AIL to monitor the balancing and directing circuits for leaks and diaphragm ruptures. The dialysate that flows passed the AIL detector has previously flowed through a pump in the directing cassette and a balancing chamber and pump in the balancing cassette as well as a number of valves. If any of the diaphragms on the valves or pod pumps leaked then the leaked air would flow past the AIL detector in the drain . In addition the AIL detector may detect gas evolving from the dialysate possibly as it is heated In a preferred embodiment the AIL detector will be positioned on the drain where the flow is upward. This potentially advantageous position facilitates detection of air bubbles flowing with the dialysate as the drain path which may be made as long as suitable provides ample opportunity for bubbles to consolidate prior to reaching the detector . The positioning of the AIL detector on the drain allows the detector to identify diaphragm rupture from air bubbles.

In addition directing circuit may receive water from a water supply e.g. from a container of water such as a bag and or from a device able to produce water e.g. a reverse osmosis device such as those that are commercially available. In some cases as is known to those of ordinary skill in the art the water entering the system is set at a certain purity e.g. having ion concentrations below certain values. The water entering directing circuit may be passed on to various locations e.g. to a mixing circuit for producing fresh dialysate and or to waste line . In some cases as discussed below valves to drain various recycle lines are opened and conduits may be connected between directing circuit and blood flow circuit such that water is able to flow continuously around the system. If heater is also activated the water passing through the system will be continuously heated e.g. to a temperature sufficient to disinfect the system. Such disinfection methods will be discussed in detail below.

A non limiting example of a directing cassette is shown in . Referring now to the outer side of the top plate of one embodiment of the cassette is shown. The top plate includes one half of the pod pumps . This half is the fluid liquid half where the source fluid will flow through. The inlet and outlet pod pump fluid paths are shown. These fluid paths lead to their respective pod pumps .

The pod pumps can include a raised flow path . The raised flow path allows for the fluid to continue to flow through the pod pumps after the diaphragm not shown reaches the end of stroke. Thus the raised flow path minimizes the diaphragm causing air or fluid to be trapped in the pod pump or the diaphragm blocking the inlet or outlet of the pod pump which would inhibit flow. The raised flow path is shown in this embodiment having particular dimensions. In alternate embodiments the raised flow path is larger or narrower or in still other embodiments the raised flow path can be any dimension as the purpose is to control fluid flow so as to achieve a desired flow rate or behavior of the fluid. Thus the dimensions shown and described here with respect to the raised flow path the pod pumps the valves or any other aspect are mere exemplary and alternate embodiments. Other embodiments are readily apparent. show the inner side of the top plate of this embodiment of the cassette. shows a side view of the top plate .

Referring now to the fluid liquid side of the midplate is shown. The areas complementary to the fluid paths on the inner top plate shown in are shown. These areas are slightly raised tracks that present a surface finish that is conducive to laser welding which is one mode of manufacturing in this embodiment. Other modes of manufacturing the cassette are discussed above.

Referring next to the air side or side facing the bottom plate not shown shown in of the midplate is shown according to this embodiment. The air side of the valve holes correspond to the holes in the fluid side of the midplate shown in . As seen in diaphragms complete pod pumps while diaphragms complete valves . The valves are actuated pneumatically and as the diaphragm is pulled away from the holes liquid fluid is allowed to flow. As the diaphragm is pushed toward the holes fluid flow is inhibited. The fluid flow is directed by the opening and closing of the valves . Referring next to the inner view of the bottom plate is shown. The inside view of the pod pumps and the valves actuation air chamber is shown. The pod pumps and the valves are actuated by a pneumatic air source. Referring now to the outer side of the bottom plate is shown. The source of air is attached to this side of the cassette. In one embodiment tubes connect to the tubes on the valves and pumps . In some embodiments the valves are ganged and more than one valve is actuated by the same air line.

Referring now to an assembled cassette is shown. An exploded view of the assembled cassette shown in is shown in . In these views the embodiment of the pod pump diaphragms is shown. The gasket of the diaphragm provides a seal between the liquid chamber in the top plate and the air actuation chamber in the bottom plate . In some embodiment texture on the dome of the diaphragms provide amongst other features additional space for air and liquid to escape the chamber at the end of stroke. In alternate embodiments of the cassette the diaphragms may include a double gasket. The double gasket feature would be preferred in embodiments where both sides of the pod pump include liquid or in applications where sealing both chambers sides is desired. In these embodiments a rim complementary to the gasket or other feature not shown would be added to the inner bottom plate for the gasket to seal the pod pump chamber in the bottom plate .

Referring now to a cross sectional view of the pod pumps in the cassette is shown. The details of the attachment of the diaphragm can be seen in this view. Again in this embodiment the diaphragm gasket is pinched by the midplate and the bottom plate . A rim on the midplate provides a feature for the gasket to seal the pod pump chamber located in the top plate .

Referring next to this cross sectional view shows the valves in the assembled cassette. The diaphragms are shown assembled and are held in place in this embodiment by being sandwiched between the midplate and the bottom plate . Still referring to this cross sectional view also shows a valve in the assembled cassette. The diaphragm is shown held in place by being sandwiched between the midplate and the bottom plate .

In one set of embodiments dialysate may be prepared separately and brought to the system for use in the directing circuit. However in some cases dialysate may be prepared in a mixing circuit. The mixing circuit may be run to produce dialysate at any suitable time. For instance dialysate may be produced during dialysis of a patient and or prior to dialysis the dialysate may be stored for instance in a dialysate tank. Within the mixing circuit water e.g. from a water supply optionally delivered to the mixing circuit by a directing circuit may be mixed with various dialysate ingredients to form the dialysate. Those of ordinary skill in the art will know of suitable dialysate ingredients for instance sodium bicarbonate sodium chloride and or acid as previously discussed. The dialysate may be constituted on an as needed basis so that large quantities do not need to be stored although some may be stored within a dialysate tank in certain cases.

In one set of embodiments pump comprises one or more pod pumps similar to those described above. The pod pumps may include a rigid chamber with a flexible diaphragm dividing each chamber into a fluid compartment and control compartment. The control compartment may be connected to a control fluid source such as an air source. Non limiting examples of pumps that can be used as pod pumps are described in U.S. Provisional Patent Application Ser. No. 60 792 073 filed Apr. 14 2006 entitled Extracorporeal Thermal Therapy Systems and Methods or in U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 entitled Fluid Pumping Systems Devices and Methods each incorporated herein by reference. Similarly in some cases pumps and or may each be pod pumps. Additional details of pod pumps are discussed below.

In some cases one or more of the pumps may have pressure sensors to monitor the pressure in the pump. This pressure sensor may be used to ensure that a pump compartment is filling and delivering completely. For example ensuring that the pump delivers a full stroke of fluid may be accomplished by i filling the compartment ii closing both fluid valves iii applying pressure to the compartment by opening the valve between the positive pneumatic reservoir and the compartment iv closing this positive pressure valve leaving pressurized air in the path between the valve and the compartment v opening the fluid valve so the fluid can leave the pump compartment and vi monitoring the pressure drop in the compartment as the fluid leaves. The pressure drop corresponding to a full stroke may be consistent and may depend on the initial pressure the hold up volume between the valve and the compartment and or the stroke volume. However in other embodiments of any of the pod pumps described herein a reference volume compartment may be used where the volume is determined through pressure and volume data.

The volumes delivered by the water pump and or the other pumps may be directly related to the conductivity measurements so the volumetric measurements may be used as a cross check on the composition of the dialysate that is produced. This may ensure that the dialysate composition remains safe even if a conductivity measurement becomes inaccurate during a therapy.

Referring now to in this embodiment mixing circuit constitutes dialysate using two sources an acid concentrate source and a combined sodium bicarbonate NaHCO and sodium chloride NaCl source. As shown in the embodiment shown in in some embodiments the dialysate constituting system may include multiples of each source. In embodiments of the method where the system is run continuously the redundant dialysate sources allow for continuous function of the system as one set of sources is depleted the system uses the redundant source and the first set of sources is replaced. This process is repeated as necessary e.g. until the system is shut down.

A non limiting example of a balancing cassette is shown in . In the exemplary fluid flow path cassette shown in valves are open individually. In this exemplary embodiment the valves are pneumatically open. Also in this embodiment the fluid valves are volcano valves as described in more detail elsewhere in this specification.

Referring now to the top plate of one exemplary embodiment of the cassette is shown. In this exemplary embodiment the pod pumps and the mixing chambers on the top plate are formed in a similar fashion. In this exemplary embodiment the pod pumps and mixing chamber when assembled with the bottom plate have a total volume of capacity of 38 ml. However in other embodiments the mixing chamber may have any size volume desired.

Referring now to the bottom view of the top plate is shown. The fluid paths are shown in this view. These fluid paths correspond to the fluid paths shown in in the midplate . The top plate and the top of the midplate form the liquid or fluid side of the cassette for the pod pumps and for one side of the mixing chamber . Thus most of the liquid flow paths are on the top and midplates . Referring to the first fluid inlet and the first fluid outlet are shown.

Still referring to the pod pumps include a groove in alternate embodiments this is a groove . The groove is shown having a particular size and shape however in other embodiments the size and shape of the groove may be any size or shape desirable. The size and shape shown in is one exemplary embodiment. In all embodiments of the groove the groove forms a path between the fluid inlet side and the fluid outlet side of the pod pumps . In alternate embodiments the groove is a groove in the inner pumping chamber wall of the pod pump.

The groove provides a fluid path whereby when the diaphragm is at the end of stroke there is still a fluid path between the inlet and outlet such that the pockets of fluid or air do not get trapped in the pod pump. The groove is included in both the liquid fluid and air actuation sides of the pod pumps . In some embodiments the groove may also be included in the mixing chamber see with respect to the actuation air side of the pod pumps and the opposite side of the mixing chamber . In alternate embodiments the groove is either not included or on only one side of the pod pumps .

In an alternate embodiment of the cassette the liquid fluid side of the pod pumps may include a feature not shown whereby the inlet and outlet flow paths are continuous and a rigid outer ring not shown is molded about the circumference of the pumping chamber is also continuous. This feature allows for the seal formed with the diaphragm not shown to be maintained. Referring to the side view of an exemplary embodiment of the top plate is shown.

Referring now to an exemplary embodiment of the midplate is shown. The midplate is also shown in where this Fig. corresponds with . Thus indicates the locations of the various valves and valving paths. The locations of the diaphragms not shown for the respective pod pumps as well as the location of the mixing chamber are shown.

Referring now to in one exemplary embodiment of the cassette sensor elements are incorporated into the cassette so as to discern various properties of the fluid being pumped. In one embodiment three sensor elements are included. However in this embodiment six sensor elements two sets of three are included. The sensor elements are located in the sensor cell . In this embodiment a sensor cell is included as an area on the cassette for sensor s elements. In one embodiment the three sensor elements of the two sensor cells are housed in respective sensor elements housings and . In one embodiment two of the sensor elements housings and accommodate conductivity sensor elements and the third sensor elements housing accommodates a temperature sensor element. The conductivity sensor elements and temperature sensor elements may be any conductivity or temperature sensor elements in the art. In one embodiment the conductivity sensors are graphite posts. In other embodiments the conductivity sensor elements are posts made from stainless steel titanium platinum or any other metal coated to be corrosion resistant and still be electrically conductive. The conductivity sensor elements will include an electrical lead that transmits the probe information to a controller or other device. In one embodiment the temperature sensor is a thermistor potted in a stainless steel probe. However in alternate embodiments a combination temperature and conductivity sensor elements is used similar to the one described in a U.S. patent application entitled Sensor Apparatus Systems Devices and Methods filed Oct. 12 2007 DEKA 024XX .

In alternate embodiments there are either no sensors in the cassette or only a temperature sensor only one or more conductivity sensors or one or more of another type of sensor.

Referring now to the side view of an exemplary embodiment of the midplate is shown. Referring now to the bottom plate is shown. Referring first to the inner or inside surface of the bottom plate is shown. The inner or inside surface is the side that contacts the bottom surface of the midplate not shown . The bottom plate attaches to the air or actuation lines not shown . The corresponding entrance holes for the air that actuates the pod pumps and valves not shown see in the midplate can be seen. Holes correspond to the first fluid inlet and first fluid outlet shown in respectively. The corresponding halves of the pod pumps and mixing chamber are also shown as are the grooves for the fluid paths. The actuation holes in the pumps are also shown. Unlike the top plate the bottom plate corresponding halves of the pod pumps and mixing chamber make apparent the difference between the pod pumps and mixing chamber . The pod pumps include an air actuation path on the bottom plate while the mixing chamber has identical construction to the half in the top plate. The mixing chamber mixes liquid and therefore does not include a diaphragm not shown nor an air actuation path. The sensor cell with the three sensor element housings and are also shown.

Referring now to the actuation ports are shown on the outside or outer bottom plate . An actuation source is connected to these actuation ports . Again the mixing chamber does not have an actuation port as it is not actuated by air. Referring to a side view of the exemplary embodiment of the bottom plate is shown.

As described above in various aspects of the invention one or more fluid circuits may be implemented on a cassette such as the blood flow circuit the balancing circuit the directing circuit and or the mixing circuit etc. Other cassettes may be present e.g. a sensing cassette as is disclosed in U.S. patent application Ser. No. 12 038 474 entitled Sensor Apparatus Systems Devices and Methods filed on Feb. 27 2008 and incorporated herein by reference. In some embodiments some or all of these circuits are combined in a single cassette. In alternate embodiments these circuits are each defined in respective cassettes. In still other embodiments two or more of the fluid circuits are included on one cassette. In some cases two three or more cassettes may be immobilized relative to each other optionally with fluidic connections between the cassettes. For instance in one embodiment two cassettes may be connected via a pump such as a pod pump as previously described. The pod pump may include a rigid chamber with a flexible diaphragm dividing each chamber into a first side and a second side and the sides may be used for various purposes as noted above.

Non limiting examples of cassettes that may be used in the present invention include those described in U.S. patent application Ser. No. 11 871 680 filed Oct. 12 2007 entitled Pumping Cassette U.S. patent application Ser. No. 11 871 712 filed Oct. 12 2007 entitled Pumping Cassette U.S. patent application Ser. No. 11 871 787 filed Oct. 12 2007 entitled Pumping Cassette U.S. patent application Ser. No. 11 871 793 filed Oct. 12 2007 entitled Pumping Cassette U.S. patent application Ser. No. 11 871 803 filed Oct. 12 2007 entitled Cassette System Integrated Apparatus or in U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008. Each of these is incorporated by reference herein in their entireties.

A cassette may also include various features such as pod pumps fluid lines valves or the like. The cassette embodiments shown and described in this description include exemplary and various alternate embodiments. However any variety of cassettes is contemplated that include a similar functionality. Although the cassette embodiments described herein are implementations of the fluid schematics as shown in the figures in other embodiments the cassette may have varying fluid paths and or valve placement and or pod pump placements and numbers and thus is still within the scope of the invention.

In one example embodiment a cassette may includes a top plate a midplate and a bottom plate. There are a variety of embodiments for each plate. In general the top plate includes pump chambers and fluid lines the midplate includes complementary fluid lines metering pumps and valves and the bottom plate includes actuation chambers and in some embodiments the top plate and the bottom plate include complementary portions of a balancing chamber or a pod pump .

In general the diaphragms are located between the midplate and the bottom plate however with respect to a balancing chamber or a pod pump a portion of a diaphragm is located between the midplate and the top plate. Some embodiments include where the diaphragm is attached to the cassette either overmolded captured bonded press fit welded in or any other process or method for attachment however in the exemplary embodiments the diaphragms are separate from the top plate midplate and bottom plate until the plates are assembled.

The cassettes may be constructed of a variety of materials. Generally in the various embodiments the materials used are solid and non flexible. In one embodiment the plates are constructed of polysulfone but in other embodiments the cassettes are constructed of any other solid material and in exemplary embodiment of any thermoplastic or thermoset.

In one exemplary embodiment the cassettes are formed by placing diaphragms in their correct locations e.g. for one or more pod pumps if such pod pumps are present assembling the plates in order and connecting the plates. In one embodiment the plates are connected using a laser welding technique. However in other embodiments the plates may be glued mechanically fastened strapped together ultrasonically welded or any other mode of attaching the plates together.

In practice the cassette may be used to pump any type of fluid from any source to any location. The types of fluid include nutritive nonnutritive inorganic chemicals organic chemicals bodily fluids or any other type of fluid. Additionally fluid in some embodiments include a gas thus in some embodiments the cassette is used to pump a gas.

The cassette serves to pump and direct the fluid from and to the desired locations. In some embodiments outside pumps pump the fluid into the cassette and the cassette pumps the fluid out. However in some embodiments the pod pumps serve to pull the fluid into the cassette and pump the fluid out of the cassette.

As discussed above depending on the valve locations control of the fluid paths is imparted. Thus the valves being in different locations or additional valves are alternate embodiments of this cassette. Additionally the fluid lines and paths shown in the figures described above are mere examples of fluid lines and paths. Other embodiments may have more less and or different fluid paths. In still other embodiments valves are not present in the cassette.

The number of pod pumps if pod pumps are present within the cassette described above may also vary depending on the embodiment. For example although the various embodiments shown and described above include two pod pumps in other embodiments the cassette includes one pod pump. In still other embodiments the cassette includes more than two pod pumps or there may be no pod pumps present. The pod pumps may be single pumps or multiple pod pumps may be present that can work in tandem e.g. to provide a more continuous flow as discussed above. Either or both may be used in various embodiments of the cassette. However as noted above in some cases there may be pod pumps not present on a cassette but contained between two or more cassettes. Non limiting examples of such systems can be seen in U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008 and incorporated by herein reference.

The various fluid inlets and fluid outlets disclosed herein may be fluid ports in some cases. In practice depending on the valve arrangement and control a fluid inlet may be a fluid outlet. Thus the designation of the fluid port as a fluid inlet or a fluid outlet is only for description purposes. The various embodiments have interchangeable fluid ports. The fluid ports are provided to impart particular fluid paths onto the cassette. These fluid ports are not necessarily all used all of the time instead the variety of fluid ports provides flexibility of use of the cassette in practice.

Another non limiting example of a cassette is shown with reference to . Referring now to the assembled cassette system integrated is shown. The mixing cassette middle cassette and balancing cassette are linked by fluid lines or conduits. The pods are between the cassettes. Referring now to the various views show the efficiency of the cassette system integrated. The fluid lines or conduits are shown in and respectively. The fluid flows between the cassettes through these fluid lines or conduits. Referring now to these fluid lines or conduits represent larger and smaller check valve fluid lines. In the exemplary embodiment the check valves are duck bill valves however in other embodiments any check valve may be used. Referring to fluid line or conduit is a fluid line or conduit that does not contain a check valve. For purposes of this description the terms fluid line and conduit are used with respect to and interchangeably.

Referring now to and the following is a description of one embodiment of the fluid flow through the various cassettes. For ease of description the fluid flow will begin with the mixing cassette . Referring now to and the fluid side of the mixing cassette is shown. The fluid side includes a plurality of ports and that are either fluid inlets or fluid outlets. In the various embodiments the fluid inlets and outlets may include one or more fluid inlets for reverse osmosis RO water bicarbonate an acid and a dialysate . Also one or more fluid outlets including a drain acid and at least one air vent outlet as the vent for the dialysate tank. In one embodiment a tube not shown hangs off the outlet and is the vent to prevent contamination . Additional outlets for water bicarbonate and water mixture dialysate mixture bicarbonate with acid and water added are also included.

The dialysate flows out of the mixing cassette to a dialysate tank not shown shown as in and then through a conduit to the inner dialysate cassette pumped by the outer dialysate cassette pod pumps and not shown shown in . The fluid paths within the cassettes may vary. Thus the location of the various inlet and outlets may vary with various cassette fluid paths.

Referring now to in one embodiment of the cassette system the condo cells conductivity and temperature sensors are included in a separate cassette outside of the cassette system shown in . This outside sensor cassette may be one of those described in U.S. patent application Ser. No. 12 038 474 entitled Sensor Apparatus Systems Devices and Methods filed on Feb. 27 2008 and incorporated herein by reference.

The fluid flow path for this embodiment is shown in . In this embodiment during the mixing process for the dialysate the bicarbonate mixture leaves the mixing cassette and flows to an outside sensor cassette and then flows back into the mixing cassette . If the bicarbonate mixture meets pre established thresholds acid is then added to the bicarbonate mixture. Next once the bicarbonate and acid are mixed in the mixing chamber the dialysate flows out of the cassette into the sensor cassette and then back to the mixing cassette . This method and the control thereof to ensure acceptable dialysate quality is produced and maintained during treatment is described in more detail below.

Referring now to the mixing cassette include a pneumatic actuation side. In the block shown as there are a plurality of valves and two pumping chambers build into the cassette for pumping or metering the acid or bicarbonate. In some embodiments additional metering pumps or less metering pumps are included. The metering pumps can be any size desired. In some embodiments the pumps are different sizes with respect to one another however in other embodiments the pumps are the same size with respect to one another. For example in one embodiment the acid pump is smaller than the bicarbonate pump. This may be more efficient and effective when using a higher concentration acid as it may be desirable to use a smaller pump for accuracy and also it may be desirable for control schemes to have a smaller pump so as to use full strokes in the control rather than partial strokes.

The conduits include a check valve. These conduits allow for one way flow. In the exemplary embodiment these conduits all lead to drain. Referring to the flow path schematic the locations of these check valve conduits are apparent. In the embodiment shown any fluid that is meant for drain flows through the mixing cassette . Referring again to a fluid drain port is located on the fluid side of the cassette .

Once the dialysate is mixed and after the dialysate flows to the sensor cassette in and it is determined that the dialysate is not within set parameters thresholds then the dialysate will be pumped back into the mixing cassette through a plain conduit then to the outer dialysate cassette then back through conduit a check valve conduit and then through the mixing cassette to the drain fluid outlet.

Referring now to the various pods are shown. Each of the pod housings are constructed identically however the inside of the pod housing is different depending on whether the pod is a pod pump a balancing chamber pods or a mixing chamber pod .

Referring now to together with the various pods are shown both in the fluid flow path and on the cassette system. Pod is the water pod pump and is the bicarbonate water pod pump sends water to the bicarbonate of the mixing cassette . Pod is the mixing chamber. Once the dialysate is mixed in the mixing chamber and then flows from the mixing cassette to the sensor cassette and it is determined that the dialysate qualifies as acceptable then the dialysate flows to the dialysate tank through the mixing cassette dialysate tank outlet. However if the dialysate is rendered unacceptable then the fluid is pumped back into the cassette then through a conduit to the outer dialysate cassette and then pumped through a check valve conduit through the mixing cassette and out the drain outlet.

Referring to together with the outer dialysate cassette is shown between the mixing cassette and the inner dialysate cassette . Pod pumps pump the dialysate from the dialysate tank and send it to the balancing chambers in the inner dialysate cassette driving force for the dialysate solution . The outer dialysate cassette pushes the dialysate into the inner dialysate cassette i.e. the pumps in the inner dialysate cassette do not draw the dialysate in . Thus from the outer dialysate cassette the dialysate is pumped from the dialysate tank through a heater and through an ultrafilter and then into the inner dialysate cassette .

Still referring now to together with the inner dialysate cassette includes a metering pod i.e. an ultra filtration metering pod and includes balancing pods and pod pumps . The inner dialysate cassette also includes fluid outlets and inlets. These inlets and outlets include the outlet to the dialyzer the inlet from the dialyzer and a dialysate inlet the ultrafilter connects to a port of the inner dialysate cassette . Fluid inlets and outlets are also included for the DCA and DCV connections during priming and disinfection. Various conduits serve as fluid connections between the cassettes and are used for dialysate fluid flow as well as fluid to pass through in order to drain through the mixing cassette . The largest check valve also shown in is the largest check valve and is used during disinfection. This tube is larger in order to accommodate in the preferred embodiment blood clots and other contaminants that flow through the conduits during disinfection.

The valves and pumps of the cassette system are pneumatically actuated in the exemplary embodiment. The pneumatics attach to the cassettes via individual tubes. Thus each pump balancing pod or valve includes an individual tube connection to a pneumatic actuation manifold not shown . Referring now to the tubes are connected in the exemplary embodiment to at least one block . In some embodiments more than one block is used to connect the various tubes. The block is dropped into the manifold and then connected to the pneumatics actuators appropriately. This allows for easy connection of the pneumatic tubes to the manifold.

Referring again to the cassette system includes springs in one embodiment to aid in holding the system together. The springs hook onto the mixing cassette and inner dialysate cassette via catches . However in other embodiments any other means or apparatus to assist in maintaining the system in appropriate orientation may be used including but not limited to latching means or elastic means for example.

Referring now to the exemplary embodiment of the pod is shown. The pod includes two fluid ports an inlet and an outlet and the pod may be constructed differently in the various embodiments. A variety of embodiments of construction are described in U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 and entitled Fluid Pumping Systems Devices and Methods which is hereby incorporated herein by reference in its entirety.

Referring now to the groove in the chamber is shown. A groove is included on each half of the pod housing. In other embodiments a groove is not included and in some embodiments a groove is only included on one half of the pod.

Referring now to the exemplary embodiment of the membrane used in the pod pumps is shown. An exploded view of a pod pump according to the exemplary embodiment is shown .

Various aspects of the invention include one or more pod pumps used for various purposes. The structure of a general pod pump will now be described although as noted above this structure may be modified for various uses e.g. as a pump a balancing chamber a mixing chamber or the like. In addition a pod pump may be positioned anywhere in the system for instance on a cassette or between two or more cassettes etc.

Generally a pod pump includes a rigid chamber which may have any suitable shape e.g. spherical ellipsoid etc. and the pod pump may include a flexible diaphragm dividing each chamber into a first half and a second half. In some cases the rigid chamber is a spheroid. As used herein spheroid means any three dimensional shape that generally corresponds to a oval rotated about one of its principal axes major or minor and includes three dimensional egg shapes oblate and prolate spheroids spheres and substantially equivalent shapes.

Each half of the pod pump may have at least one entry valve and often but not always has at least one exit valve in some cases the same port may be used for both entry and exit . The valves may be for instance open closing valves or two way proportional valves. For instance valves on one side of a chamber may be two way proportional valves one connected to a high pressure source the other connected to a low pressure or vacuum sink while the valves on the other half may be opened and closed to direct fluid flow.

In some embodiments the diaphragm has a variable cross sectional thickness. Thinner thicker or variable thickness diaphragms may be used to accommodate the strength flexural and other properties of the chosen diaphragm materials. Thinner thicker or variable diaphragm wall thickness may also be used to manage the diaphragm thereby encouraging it to flex more easily in some areas than in other areas thereby aiding in the management of pumping action and flow of subject fluid in the pump chamber. In this embodiment the diaphragm is shown having its thickest cross sectional area closest to its center. However in other embodiments having a diaphragm with a varying cross sectional the thickest and thinnest areas may be in any location on the diaphragm. Thus for example the thinner cross section may be located near the center and the thicker cross sections located closer to the perimeter of the diaphragm. In one embodiment of the diaphragm the diaphragm has a tangential slope in at least one section but in other embodiments the diaphragm is completely smooth or substantially smooth.

The diaphragm may be made of any flexible material having a desired durability and compatibility with the subject fluid. The diaphragm may be made from any material that may flex in response to fluid liquid or gas pressure or vacuum applied to the actuation chamber. The diaphragm material may also be chosen for particular bio compatibility temperature compatibility or compatibility with various subject fluids that may be pumped by the diaphragm or introduced to the chambers to facilitate movement of the diaphragm. In the exemplary embodiment the diaphragm is made from high elongation silicone. However in other embodiments the diaphragm is made from any elastomer or rubber including but not limited to silicone urethane nitrile EPDM or any other rubber elastomer or flexible material.

The shape of the diaphragm is dependent on multiple variables. These variables include but are not limited to the shape of the chamber the size of the chamber the subject fluid characteristics the volume of subject fluid pumped per stroke and the means or mode of attachment of the diaphragm to the housing. The size of the diaphragm is dependent on multiple variables. These variables include but are not limited to the shape of the chamber the size of the chamber the subject fluid characteristics the volume of subject fluid pumped per stroke and the means or mode of attachment of the diaphragm to the housing. Thus depending on these or other variables the shape and size of the diaphragm may vary in various embodiments.

The diaphragm may have any thickness. However in some embodiments the range of thickness is between 0.002 inches to 0.125 inches 1 inch 2.54 cm . Depending on the material used for the diaphragm the desired thickness may vary. In one embodiment high elongation silicone is used in a thickness ranging from 0.015 inches to 0.050 inches. However in other embodiments the thickness may vary.

In the exemplary embodiment the diaphragm is pre formed to include a substantially dome shape in at least part of the area of the diaphragm. Again the dimensions of the dome may vary based on some or more of the variables described above. However in other embodiments the diaphragm may not include a pre formed dome shape.

In the exemplary embodiment the diaphragm dome is formed using liquid injection molding. However in other embodiments the dome may be formed by using compression molding. In alternate embodiments the diaphragm is substantially flat. In other embodiments the dome size width or height may vary.

In various embodiments the diaphragm may be held in place by various means and methods. In one embodiment the diaphragm is clamped between the portions of the cassette and in some of these embodiments the rim of the cassette may include features to grab the diaphragm. In others of this embodiment the diaphragm is clamped to the cassette using at least one bolt or another device. In another embodiment the diaphragm is over molded with a piece of plastic and then the plastic is welded or otherwise attached to the cassette. In another embodiment the diaphragm is pinched between a mid plate and a bottom plate. Although some embodiments for attachment of the diaphragm to the cassette are described any method or means for attaching the diaphragm to the cassette may be used. The diaphragm in one alternate embodiment is attached directly to one portion of the cassette. In some embodiments the diaphragm is thicker at the edge where the diaphragm is pinched by the plates than in other areas of the diaphragm. In some embodiments this thicker area is a gasket in some embodiments an O ring ring or any other shaped gasket.

In some embodiments of the gasket the gasket is contiguous with the diaphragm. However in other embodiments the gasket is a separate part of the diaphragm. In some embodiments the gasket is made from the same material as the diaphragm. However in other embodiments the gasket is made of a material different from the diaphragm. In some embodiments the gasket is formed by over molding a ring around the diaphragm. The gasket may be any shape ring or seal desired so as to complement the pod pump housing embodiment. In some embodiments the gasket is a compression type gasket.

Due to the rigid chamber the pod pump has a generally constant volume. However within the pod pump the first and second compartments may have differing volumes depending on the position of the flexible diaphragm dividing the chamber. Forcing fluid into one compartment may thus cause the fluid within the other compartment of the chamber to be expelled. However the fluids are typically not able to come into direct contact with each other within the pod pump due to the presence of the flexible diaphragm.

Accordingly in one embodiment a pod pump used for pumping is constructed to receive a control fluid in a first compartment and a fluid to be pumped in a second compartment. The control fluid may be any fluid and may be a liquid or a gas. In one embodiment the control fluid is air. Drawing control fluid away from the pod pump e.g. through a vacuum or at least a pressure lower than the pressure within the pod pump causes the pod pump to draw in fluid e.g. blood dialysate etc. into the other compartment of the pod pump. Similarly forcing control fluid into the pod pump e.g. from a high pressure source causes the pod pump to expel fluid. By also controlling the valves of the second compartment fluid may be brought in through a first valve and then expelled through a second valve due to action of the control fluid.

As another example a pod pump may be used for fluid balancing e.g. of dialysate as discussed above. In such cases instead of a control fluid a fluid may be directed to each compartment of the pod pump. As mentioned the volume of the pod pump remains generally constant due to the rigid chamber. Accordingly when a first volume of fluid is drawn into a first compartment of a balancing pod an equal volume of fluid is expelled from the second compartment of the balancing pod assuming the fluids to be generally incompressible under conditions in which the pod is operated . Thus using such balancing pods equal volumes of fluid can be moved. For instance in a balancing pod may allow fresh dialysate to enter a first compartment and used dialysate to enter a second compartment the volumetric flows of fresh dialysate and used dialysate can be balanced against each other.

In some cases a pod pump is used that does not contain a flexible diaphragm dividing the chamber. In such instances the pod pump can be used as a mixing chamber. For instance mixing chamber in may be such a pod pump.

A non limiting example of a pod pump is shown in . This figure is a sectional view of a pneumatically controlled valve that may be used in embodiments of the cassettes. Pneumatic as used herein means using air or other gas to move a flexible diaphragm or other member. It should be noted that air is used by way of example only and in other embodiments other control fluids such as nitrogen N CO water an oil etc. may be used . Three rigid pieces are used a top plate a middle plate and a bottom plate. The terms top and bottom only refer to the orientation shown in . The valve may be oriented in any direction in actual use. The top and bottom plates may be flat on both sides while the middle plate is provided with channels indentations and holes to define the various fluid paths chamber and ports. A diaphragm along with the middle plate defines a valving chamber . Pneumatic pressure is provided through a pneumatic port to either force with positive gas pressure the diaphragm against a valve seat to close the valve or to draw with negative gas pressure the diaphragm away from the valve seat to open the valve. A control gas chamber is defined by the diaphragm the top plate and the middle plate . The middle plate has an indentation formed on it into which the diaphragm is placed so as to form the control gas chamber on one side of the diaphragm and the valving chamber on the other side.

The pneumatic port is defined by a channel formed on the top surface of the middle plate along with the top plate . By providing fluid communication between several valving chambers in a cassette valves may be ganged together so that all the valves ganged together may be opened or closed at the same time by a single source of pneumatic pressure. Channels formed on the bottom surface of the middle plate along with the bottom plate define the valve inlet and the valve outlet . Holes formed through the middle plate provide communication between the inlet and the valving chamber through the valve seat and between the valving chamber and the outlet .

The diaphragm is provided with a thickened rim which fits tightly in a groove in the middle plate . Thus the diaphragm may be placed in and held by the groove before the top plate is ultrasonically welded to the middle plate so the diaphragm will not interfere with the ultrasonic welding of the two plates together and so that the diaphragm does not depend on the two plates being ultrasonically welded together in just the right way to be held in place. Thus this valve may be manufactured easily without relying on ultrasonic welding to be done to very tight tolerances. As shown in the top plate may include additional material extending into control gas chamber so as to prevent the diaphragm from being urged too much in a direction away from the groove so as to prevent the diaphragm s thickened rim from popping out of the groove .

Pressure sensors may be used to monitor pressure in the pods. For instance by alternating applied air pressure to the pneumatic side of the chamber the diaphragm is cycled back and forth across the total chamber volume. With each cycle fluid is drawn through the upstream valve of the inlet fluid port when the pneumatics pull a vacuum on the pods. The fluid is then subsequently expelled through the outlet port and the downstream valve when the pneumatics deliver positive pressure to the pods.

A diaphragm separates the central cavity of the pod pump into a chamber the pumping chamber that receives the fluid to be pumped and another chamber the actuation chamber for receiving the control gas that pneumatically actuates the pump. An inlet allows fluid to enter the pumping chamber and an outlet allows fluid to exit the pumping chamber. The inlet and the outlet may be formed between middle plate and the bottom plate . Pneumatic pressure is provided through a pneumatic port to either force with positive gas pressure the diaphragm against one wall of pod pump s cavity to minimize the pumping chamber s volume as shown in or to draw with negative gas pressure the diaphragm towards the other wall of the pod pump s cavity to maximize the pumping chamber s volume.

In some embodiments of the pod pump various configurations including grooving on one or more plates exposed to the cavity of the pod pump are used. Amongst other benefits grooving can prevent the diaphragm from blocking the inlet or outlet or both flow path for fluid or air or both .

The diaphragm may be provided with a thickened rim which is held tightly in a groove in the middle plate . Thus like in the valving chamber of the diaphragm may be placed in and held by the groove before the top plate is ultrasonically welded to the middle plate so the diaphragm will not interfere with the ultrasonic welding of the two plates together and so that the diaphragm does not depend on the two plates being ultrasonically welded together in just the right way to be held in place. Thus this pod pump can be manufactured easily without relying on ultrasonic welding to be done to very tight tolerances.

In pressure actuation system alternately provides positive and negative pressurizations to the gas in the actuation chamber of the pod pump . The pneumatic actuation system includes an actuation chamber pressure transducer a variable positive supply valve a variable negative supply valve a positive pressure gas reservoir a negative pressure gas reservoir a positive pressure reservoir pressure transducer a negative pressure reservoir pressure transducer as well as an electronic controller .

The positive pressure reservoir provides to the actuation chamber the positive pressurization of a control gas to urge the diaphragm towards a position where the pumping chamber is at its minimum volume i.e. the position where the diaphragm is against the rigid pumping chamber wall . The negative pressure reservoir provides to the actuation chamber the negative pressurization of the control gas to urge the diaphragm in the opposite direction towards a position where the pumping chamber is at its maximum volume i.e. the position where the diaphragm is against the rigid actuation chamber wall .

A valving mechanism is used in this example to control fluid communication between each of these reservoirs and the actuation chamber . In a separate valve is used for each of the reservoirs a positive supply valve controls fluid communication between the positive pressure reservoir and the actuation chamber and a negative supply valve controls fluid communication between the negative pressure reservoir and the actuation chamber . These two valves are controlled by an electronic controller . Alternatively a single three way valve may be used in lieu of the two separate valves . In some cases the positive supply valve and the negative supply valve are variable restriction valves as opposed to binary on off valves. An advantage of using variable valves is discussed below.

The controller also receives pressure information from the three pressure transducers shown in an actuation chamber pressure transducer a positive pressure reservoir pressure transducer and a negative pressure reservoir pressure transducer . As their names suggest these transducers respectively measure the pressure in the actuation chamber the positive pressure reservoir and the negative pressure reservoir . The controller monitors the pressure in the two reservoirs to ensure they are properly pressurized either positively or negatively . A compressor type pump or pumps may be used to attain the desired pressures in these reservoirs .

In one embodiment the pressure provided by the positive pressure reservoir is strong enough under normal conditions to urge the diaphragm all the way against the rigid pumping chamber wall. Similarly the negative pressure i.e. the vacuum provided by the negative pressure reservoir is preferably strong enough under normal conditions to urge the diaphragm all the way against the rigid actuation chamber wall. In some embodiments however these positive and negative pressures provided by the reservoirs are within safe enough limits that even with either the positive supply valve or the negative supply valve open all the way the positive or negative pressure applied against the diaphragm is not so strong as to harm the patient.

In one embodiment the controller monitors the pressure information from the actuation chamber pressure transducer and based on this information controls the valving mechanism valves to urge the diaphragm all the way to its minimum pumping chamber volume position and then after this position is reached to pull the diaphragm all the way back to its maximum pumping chamber volume position.

The pressure actuation system including the actuation chamber pressure transducer the positive pressure reservoir pressure transducer the negative pressure reservoir pressure transducer the variable positive supply valve the variable negative supply valve the controller the positive pressure gas reservoir and the negative pressure gas reservoir is located entirely or mostly outside the insulated volume item of . The components that come into contact with blood or dialysate namely pod pump the inlet valve and the outlet valve may be located in some cases in the insulated volume so that they can be more easily disinfected.

Another example of a pressure actuation system for a pod pump is illustrated in . In this example pod pump includes a pumping chamber an actuation chamber and a diaphragm separating the two sides. Fluid ports and allow access of fluid in and out of pumping chamber e.g. through the use of fluid valves not shown . Within pod pump however fluid ports and include a volcano port generally having a raised shape such that when diaphragm contacts the port the diaphragm is able to form a tight seal against the port. Also shown in is a 3 way valve connecting pressure reservoirs . The 3 way valve is in fluid communication with actuation chamber by a single port in this example.

It will be appreciated that other types of actuation systems may be used to move the diaphragm back and forth instead of the two reservoir pneumatic actuation system shown in .

As noted above the positive supply valve and the negative supply valve in the pneumatic actuation system of are preferably variable restriction valves as opposed to binary on off valves. By using variable valves the pressure applied to the actuation chamber and the diaphragm can be more easily controlled to be just a fraction of the pressure in reservoir instead of applying the full reservoir pressure to the diaphragm. Thus the same reservoir or set of reservoirs may be used for different pod pumps even though the pressures for operating the pod pumps may differ from pod pump to pod pump. Of course the reservoir pressure needs to be greater than the desired pressures to be applied to various pod pump s diaphragms but one pod pump may be operated at say half of the reservoir pressure and another pod pump may be actuated with the same reservoir but at say a quarter of the reservoir pressure. Thus even though different pod pumps in the dialysis system are designed to operate at different pressures these pod pumps may all share the same reservoir or set of reservoirs but still be actuated at different pressures through the use of variable valves. The pressures used in a pod pump may be changed to address conditions that may arise or change during a dialysis procedure. For example if flow through the system s tubing becomes constricted because the tubes get twisted one or both of the positive or negative pressures used in the pod pump may be increased in order to over compensate for the increased restriction.

After the positive variable valve is closed the negative variable valve item in is partially opened to allow the negative pressure reservoir to draw gas from the actuation chamber and thus draw fluid into the pumping chamber. As can be seen in from a time shortly after Tto about time T a negative pressure is applied to the actuation chamber . As with the expelling positive pressure stroke described above repeatedly reducing and increasing the flow restriction caused by the negative variable valve can cause the pressure being applied to the actuation chamber can be held at about the desired negative control pressure P which is weaker than the pressure in the negative pressure reservoir . The pressure varies in a sinusoidal manner around the desired control pressure. The actuation chamber pressure transducer passes pressure measurement information to the controller which in turn controls the variable valve so as to cause the actuation chamber s pressure to vary around the desired control pressure P. If there are no fault conditions the diaphragm is pulled against a rigid wall of the actuation chamber thereby ending the draw negative pressure stroke. As described above the controller determines that the end of stroke has been reached when the partial vacuum measured in the actuation chamber no longer drops off even though the restriction created by the variable valve is reduced. In the end of the draw stroke occurs around time T. When the end of stroke is sensed the controller causes the variable valve to close completely so that the actuation chamber s vacuum does not increase much beyond the desired negative control pressure P. Once the draw stroke has ended the positive variable valve can be partially opened to begin a new expelling stroke with positive pressure.

Thus each pod pump in this example uses the two variable orifice valves to throttle the flow from the positive pressure source and into the negative pressure. The pressure in the actuation chamber is monitored and a controller uses this pressure measurement to determine the appropriate commands to both valves to achieve the desired pressure in the actuation chamber. Some advantages of this arrangement are that the filling and delivering pressure may be precisely controlled to achieve the desired flow rate while respecting pressure limits and that the pressure may be varied with a small sinusoidal signature command. This signature may be monitored to determine when the pump reaches the end of a stroke.

Another advantage of using variable valves in this way instead of binary valves is that by only partially opening and closing the variable valves the valves are subject to less wear and tear. The repeated banging of binary valves all the way opened and all the way closed can reduce the life of the valve.

If the end of stroke is detected and the integrated value of the correlation function is very small this may be an indication that the stroke occluded and did not complete properly. It may be possible to distinguish upstream occlusions from downstream occlusions by looking at whether the occlusion occurred on a fill or a delivery stroke this may be difficult for occlusions that occur close to the end of a stroke when the diaphragm is near the chamber wall . depict occlusion detection the chamber pressure drops to 0 when an occlusion is detected .

Under normal operation the integrated value of the correlation function increases as the stroke progresses. If this value remains small or does not increase the stroke is either very short as in the case of a very low impedance flow or an occlusion or the actual pressure may not be tracking the desired sinusoidal pressure due to a bad valve or pressure signals. Lack of correlation can be detected and used for error handling in these cases.

Under normal circumstances when the flow controller is running the control loop will adjust the pressure for any changes in flow rate. If the impedance in the circuit increases dramatically and the pressure limits are saturated before the flow has a chance to reach the target rate the flow controller will not be capable of adjusting the pressures higher to reach the desired flow rate. These situations may arise if a line is partially occluded such as when a blood clot has formed in the circuit. Pressure saturation when the flow has not reached the target flow rate can be detected and used in error handling.

If there are problems with the valves or the pneumatics such as a leaking fluid valve or a noisy pressure signal ripple may continue on the stroke indefinitely and the end of stroke algorithm may not see enough of a change in the pressure ripple to detect end of stroke. For this reason a safety check is added to detect if the time to complete a stroke is excessive. This information can be used for error handling.

In a dual pump such as pump in the two pump chambers may be cycled in opposite directions to affect the pumping cycle. A phase relationship from 0 both chambers act in the same direction to 180 chambers act in opposite directions can be selected. Phase movement may be modified somewhat in certain cases because it may not be possible to move both chambers in the same direction simultaneously doing so could have both input or output valves open and end of stroke will not be detected properly.

Selecting a phase relationship of 180 yields continuous flow into and out of the pod. This is the nominal pumping mode when continuous flow is desired. Setting a phase relationship of 0 is useful for single needle flow. The pods will first fill from the needle and then deliver to the same needle. Running at phases between 0 and 180 degrees can be used to achieve a push pull relationship hemodiafiltration continuous back flush across the dialyzer. are graphical representations of such phase relationships.

The pod pumps may control flow of fluid through the various subsystems. For instance a sinusoidal pressure waveform may be added to a DC pressure command to make up the commanded pressure signal for the pod pumps. When the diaphragm is moving the pressure in the pods tracks the sinusoidal command. When the diaphragm comes in contact with the chamber wall and is no longer moving the pressure in the pod remains constant and does not track the sinusoidal input command. This difference in the pressure signal command following of the pods is used to detect the end of a stroke. From the end of stroke information the time for each stroke is calculated. Knowing the volume of the pods and the time to complete a stroke a flow rate for each pod can be determined. The flow rate is fed back in a PI loop in order to calculate the required DC pressure for the next stroke.

The amplitude of the sinusoidal input may be selected such it is large enough for the actual pressure to reasonably track the command and small enough such that when it is subtracted from the minimum DC pump pressure and applied to the pod the pressure is sufficient to cause the diaphragm to move under expected operating conditions of fluid viscosity head height and fluid circuit resistance. The frequency of the sinusoidal input was selected empirically such that it is possible to reliably detect end of stroke. The more cycles of the sine wave per stroke the more accurate the end of stroke detection algorithm.

At the end of a pump stroke or during an occlusion in the outlet line of a pod pump the measured pressure deviates from expected pressure. In an embodiment to detect a deviation in the measured pressure of a pod pump from a commanded pressure the commanded and measured pressure signals in the pods may be sent through a cross correlation filter. Preferably the size of the sampling window for the cross correlation filter is equivalent to the period of the input sine wave. For every sample in the window the commanded pressure signal is multiplied by the previous sample of the actual pressure and added to the previous correlation value. The window is then shifted by one frame and the process is repeated. In an embodiment the resulting product is then differentiated and passed through a second order filter with a corner frequency the same as the input sine wave frequency and a damping ratio of one. The effect of this filter is to act as a band pass filter isolating correlated signals at the input sinusoidal frequency. Optionally the absolute value of the output of this filter may then be passed through a second order low pass filter with the same frequency of the sinusoidal frequency and a damping ratio of for example about 3.0. This second filter is used integrate the differentiated signal to and to reduce noise in the resulting signal. If the two signals are correlated the resulting filtered value will be large. If the two signals are not correlated for example at end of stroke the resulting filtered value will be small. The end of stroke can be detected when the filtered cross correlation signal drops below a particular pre determined threshold or when the signal drops off a by a percentage of its maximum value throughout the stroke. To tune performance for a particular pumping scenario this threshold or percent drop can be varied as a function of pressure or flow rate.

Because the end of stroke algorithm typically takes about one cycle of the sinusoidal ripple to detect end of stroke minimizing this cycle time maximizing the sine wave frequency reduces the delay at the end of stroke. Low pressure high frequency flows are not well tracked by the controller. Lower pressure strokes tend to have lower flow rates and thus the delay at the end of stroke is a lesser percentage of the total stroke time. For this reason the frequency can be lower for low pressure strokes. The frequency of the sine wave can be adjusted as a linear or other function of the delivery pressures. This ensures minimum delays when the strokes short. When the frequency of the sine wave for the desired pressure is changed the filters for the cross correlation function should also be adjusted. Filters are set up to continuously calculate the filter coefficients based on this changing frequency.

The pressure in the pod chambers may also be controlled using two variable solenoid valves one connecting the plenum to a higher pressure source the second connecting the plenum to a lower pressure or vacuum sink. Solenoid valves tend to have a large dead band region so to compensate a non linear offset term may be added to the algorithm of the controller.

A system controller can analyze in a number of ways the pressure response to changes in the flow restriction of the valves such as vari valves operating pressure driven reciprocating pumps . One technique is to use a cross correlation filter that is insensitive to phase shifts in the pressure signal of the pump s actuation chamber relative to the signals controlling the operation of the valves. Applying a phase insensitive cross correlation filter to the above pressure and valve signal data generates a set of values that herein will be referred to as the correlation numbers. The correlation numbers are a quantitative measure of the correlation between the pressure measured in the actuation chamber and the periodically varying signal that operates the opening and closing of either the vari valve that supplies positive pressure to the pump actuation chamber or the vari valve that supplies negative pressure to the pump actuation chamber.

In an embodiment the signal that operates the vari valves may be the output of a closed loop controller that varies the valve command signal in order to achieve a desired pressure in the actuation chamber . In this embodiment the desired pressure is varied in a periodic manner and the controller varies the valve command signal to minimize the difference between the desired and measured pressure at each time increment. In this embodiment the correlation number may be calculated between the desired pressure driving the valve controller and the measured pressure in the actuation chamber.

In an embodiment the correlation number may be used to provide an estimate of the instantaneous flow rate of the liquid being pumped as well as a number of other conditions including end of stroke partial occlusions and complete occlusions. The correlation number may be calculated using a number of inputs including but not limited to pressure signals received from the pump pressure sensor the amplitude of the electronic signal that operates valves vari valves in this example and the frequency of a time varying signal e.g. a ripple wave form that is applied to the valve operating signal. In the exemplary embodiment this correlation number can be used to describe various operating parameters of a pod pump in hemodialysis machine represented in block form in . It may also be used in other systems in which a liquid is pumped in or out of a pressure driven reciprocating pump having a control or actuating chamber that is subjected to positive or negative fluid pressure e.g. such as pneumatic pressure through the operation of a variable valve fluidly connected to a positive and or negative pressure source.

In one aspect the correlation number may be considered to be the vector sum of the cross correlation between the time varying command signal to the supply valve and the responsive pump pressure signal and a second cross correlation between a delayed command signal and the unaltered pressure signal. This mathematical operation yields a correlation number that may be insensitive to the phase angle between the vari valve signal and the signal associated with pressure changes in the pump actuation chamber. In one embodiment the cross correlation is calculated for the pressure signal and the valve command signal in which it has been delayed or shifted by a quarter of a period of the input sine wave.

The principle underlying the calculation of the correlation number is illustrated in . In this example a vari valve is used to supply positive or negative pneumatic pressure to a pressure driven reciprocating pump. The size of the sampling window for the cross correlation filter is equivalent to the period of the vari valve signal . The vari valve signal is preferably a DC signal onto which a sinusoidal wave form has been superimposed. In other embodiments other time varying periodic signals may be applied to a DC signal such as for example a triangular or square wave. The controller can calculate the cross correlation between the vari valve command signal and pressure signal by digitally sampling the vari valve command signal and the pump pressure signal and multiplying the AC component of the vari valve signal with the AC component of the measured pressure signal for each sample in the sampling window. The products of the two AC signals for each sample point in the sampling window are then summed.

A second cross correlation is calculated from the AC signals of the pressure and the vari valve command signal which has been shifted in time one quarter period or 90 degrees. This second cross correlation is calculated by multiplying the AC component of the shifted vari valve signal times the AC component of the measured pressure signal for each sample point in the sampling window. The products of the two AC signals for each sample point in the sampling window are then summed.

Next the amplitude of the vector addition of these two cross correlations is calculated by taking the square root of the sum of the squares of the first cross correlation and the squares of the second correlation to yield the correlation number. One benefit of doing a vector addition of the first cross correlation with the second cross correlation at a quarter period shift includes a reduction in the sensitivity of the correlation number to changes in the phase between the pressure and vari valve signal. Finally in order to reduce noise the pressure signal may be passed through a second order filter having a cutoff frequency which for example can be equal to the vari valve frequency.

A correlation angle may be calculated from the first and second cross correlations by considering the first cross correlation as a horizontal vector and the second cross correlation as a vertical vector. The correlation angle is the angle of the summed vector relative to the first cross correlation. The angle can be considered to be a measure the phase shift of the actuation chamber pressure relative to the valve driving signals.

A controller may be programmed in a number of ways to calculate the correlation number. For example the AC component of each signal may be calculated by subtracting the average value of the signal from the sampled value. The average value of the vari valve and pressure signal may be determined from the first several samples before the cross correlation calculations begin. This method helps to reduce the effects of noise in the pressure signal. In a preferred embodiment the AC component of the vari valve and pressure signals is determined by taking the derivative of the vari valve and pressure signals with respect to time. The derivative calculation is relatively flexible and robust. One exemplary implementation of this calculation for the first cross correlation A for the discrete sampled points of the vari valve and pressure signals is given by Equation 1 

Where V j and P j are the sampled vari valve and pressure signals respectively for sample j V j 1 and P j 1 are the vari valve and pressure signals for the sample before sample j n is the number of samples in the window and is the window period. In one example the width of the window n is one period of the input sine wave or imposed periodic valve command fluctuation. The value of the first correlation A may be calculated at each time step beginning for example 1.25 n time steps after the start of the stroke command and continues to the end of the stroke command.

The same calculations may be repeated to calculate the second cross correlation with the vari valve signal shifted by a quarter period as shown in Equation 2 

The value of the second correlation B may be calculated at each time step beginning for example 1.25 n time steps after the start of the stroke command and continues to the end of the stroke command.

The raw correlation number may be defined as the square root of the sum of squares of the first and second cross correlation values A and B as shown in Equation 3 Raw square root over Equation 3

The correlation number may then be filtered by a 2order low pass filter with a cut off frequency for example equal to the frequency of the varying valve signal as shown in Equation 4. Corr Raw 1 Raw Corr 1 Equation 4

where A 1 B 1 are the initial values of A i and B i . The correlation angle may be considered to be a measurement of the phase shift between the valve command signal and the measured actuation pressure signal. The correlation angle may be indicative of the progress of a stroke or the relative location of the diaphragm within the pumping chamber. One possible theory among others is that the correlation angle is small when the volume of the actuation chamber is small and may increase with the volume of the actuation chamber .

Graphical representations of the first cross correlation A the second cross correlation B the phase insensitive cross correlation and the phase insensitive cross correlation angle are shown in . The cross correlation results are calculated from the two sinusoidal sets of values plotted in . The phase difference between the two sinusoidal sets varies over time in a fashion that may be similar to the change in phase relationship between the vari valve command signal and the actuation chamber pressure in a reciprocating positive displacement pump. One possible theory on the changing phase angle between the vari valve command signal and pressure signal is that as the pump chamber fills or empties of liquid the volume of the actuation chamber gets smaller or larger respectively which changes the responsiveness of the pressure to the valve command.

The phase insensitive cross correlation is approximately constant despite changes in the phase angle between the two signals . The first cross correlation value and second cross correlation value vary significantly as the phase angle changes between the two signals.

One exemplary use of this phase insensitive correlation number is shown in in which pressure data and correlation values are plotted for a deliver and fill stroke for a pressure driven reciprocating pump using the hardware described in . The deliver stroke may be initiated by controlling one or both the vari valves to pressurize the actuation chamber to the desired pressure as measured by the sensor . Once the pressure rises to the desired level the pressure is controlled by only the positive pressure vari valve . The control signal to positive pressure vari valve may be a function of the vari valve signals during pressurization and the currently measured pressure. The restriction or opening of the positive pressure vari valve may be varied sinusoidally to produce a responsive variation in the measured pressure . In an embodiment the controller may be programmed to begin the calculation of the correlation number as described above after a few cycles in order to allow the signals to stabilize.

A high correlation number may indicate that the measured pressure is tracking the vari valve command signal and that the diaphragm is moving. The controller may store the maximum correlation number during the stroke. The integral of the correlation number over time may additionally provide a measure of the amount of liquid displaced by the pump .

In one exemplary method in a membrane type pressure driven reciprocating pump the physical end of stroke on the deliver stroke may be defined as occurring when the membrane has displaced all or most of the liquid in the pump and has reached the limit of its excursion against the wall of the pump chamber. A designated end of stroke may be defined as a point in time at which the correlation number becomes approximately zero. At the physical end of stroke the volume of the actuation or control chamber becomes fixed and the pressure within the chamber may stop fluctuating in response to the valve command signal. At the designated end of stroke the correlation number drops toward zero within a short time after the pressure signal loses its periodicity. Although slightly delayed from the physical end of stroke the designated end of stroke based on the correlation number provides a more reliable indication of the physical end of stroke because the effects of signal noise and variations due to signal strength are reduced.

The fill stroke follows a similar process as the delivery stroke. The fill stroke begins when one or both vari valves bring the actuation chamber to a desired low pressure . Once the pressure drops to the desired low pressure the actuation pressure may be controlled by only the negative pressure vari valve . The control signal to negative pressure vari valve may be a function of the vari valve signals during pressurization and the currently measured pressure. The negative pressure vari valve command signal may be varied sinusoidally to produce a responsive variation in the measured pressure. To improve reliability of the computation the controller may be programmed to begin the calculation of the correlation number as described above after a few cycles. In one exemplary method in a membrane type pressure driven reciprocating pump the physical end of stroke on the fill stroke may defined as occurring when the pump chamber is full of liquid and the membrane has reached the limit of its excursion against the wall of the actuation chamber. A designated end of stroke may be defined as a point in time at which the correlation number becomes approximately zero. At the physical end of stroke the volume of the actuation chamber becomes fixed at near zero and the pressure within the chamber stops fluctuating in response to the valve command signal. At the designated end of stroke the correlation number will drop toward zero within a short time as the pressure signal loses its periodicity.

The dialyzer is permeable to pressure waves generated by the inner dialysate pumps and the blood pumps. The cross correlation procedure tends to reject pressure signals in the dialysate pump for example that are at a sufficiently different frequency from the vari valve command signal. The correlation number calculations for the inner dialysate pumps and blood pumps may therefore be isolated from one another by programming the controller to vary the vari valve command signals of the dialysate and blood pumps at different frequencies.

The controller may declare an end of stroke when the correlation number drops below a pre determined fraction of the maximum correlation number . In another exemplary implementation the controller may declare an end of stroke when the correlation number drops below a pre determined fraction of the maximum correlation number and is not increasing with time. In other embodiments the designated end of stroke may be declared when the correlation number drops below a pre determined fraction of the average correlation number during a pre determined interval of time during the pump stroke with or without the further condition that the value is no longer increasing over a pre determined period of time . In another exemplary implementation the controller may declare an end of stroke when the correlation number drops below a pre determined threshold value. In another exemplary implementation the controller may declare an end of stroke when the correlation number drops below a pre determined threshold value and is not increasing with time.

The instantaneous flow rate out of the pump may be determined from the correlation number during most of the pump stroke. The flow rate may be proportional to correlation number. shows three exemplary pressure traces in the actuation chamber in response to the sinusoidally varied restriction in valve . The pressure responses in the actuation chamber tend to track the varied restriction of the vari valves when the actuation chamber volume is changing as the membrane moves. Pressure trace is an example of the pressure response if flow from the liquid side of the chamber stops during a delivery stroke. If the flow stops the volume of the actuation chamber becomes constant and the chamber fills until the pressure reaches the reservoir pressure . If the volume of the actuation chamber is constant changes in the restriction of the inlet valve can only change the rate of pressure increase. Pressure trace is an example of the pressure response when liquid flow from the pump is relatively unrestricted in which the membrane may be moving quickly and the actuation chamber volume may be quickly increasing so restricting the flow of air significantly reduces the pressure in the chamber . Pressure trace is an example of low flow where the pressure in the chamber changes only slightly as the valve restriction varies. The correlation numbers are proportional to the amplitude of pressure waveforms for a given amplitude of vari valve restriction. High amplitude pressure waves may indicate fast membrane movement and high flow rates of liquid into or out of the pump. Thus high correlation numbers may be proportional to flow rates. The benefits of this method of measuring the instantaneous flow include improved reliability of therapies improved accuracy in the therapies better flow control and lower cost instrumentation.

In another exemplary implementation the controller may declare an end of stroke when the correlation value is undefined. The controller may calculate the progress of the stroked from the value of the correlation angle. The instantaneous flow rate may be calculated from the rate of change of the correlation angle .

An occlusion is considered to be present when the liquid flow from or to a pump chamber is restricted. As shown in partial and full occlusions may be detected based on the correlation number as calculated above. A partial occlusion may produce low correlation numbers and a low integrated correlation number. The controller may compensate for the partial occlusion by commanding more pump strokes or increasing the maximum applied pressure. A full occlusion may resemble an end of stroke and produce similar responses in the correlation number integrated correlation number and correlation angle. In an embodiment the controller may monitor for occlusion detection by tracking the stroke to stroke correlation and integrated correlation numbers. A full occlusion may be declared for example if any of the maximum correlation number integrated correlation number or the absolute value of the correlation angle at end of stroke are reduced by a pre determined amount from the previous full stroke values such as for example a reduction to less than about 70 of the previous full stroke values . In another aspect a full occlusion may be declared when the maximum correlation number integrated correlation number or the absolute value of the correlation angle at end of stroke are less than 90 of the full stroke values for 3 sequential strokes. The full stroke maximum correlation number integrated correlation number or the absolute value of the correlation angle at end of stroke may be taken from the most recent full stroke. In another aspect a full occlusion may be declared if the maximum correlation number integrated correlation number or the absolute value of the correlation angle at end of stroke are less than a pre determined minimum value for at least 2 strokes. This last test may be used for example to detect chambers that are occluded from the start rendering stroke to stroke comparisons difficult at best.

The vari valves may be calibrated to determine the minimum electrical current required to open the valve for a given pressure difference across the valve. The minimum current may be referred to as the cracking current. In some embodiments the cracking current may vary linearly with the pressure difference between the actuation chamber and the reservoir . A mathematical relationship between the measured pump actuation chamber pressure and the cracking current may be established through a calibration procedure. One example of a calibration procedure uses one or both vari valves to establish a pre determined back pressure in actuation chamber . After both valves are closed the current to one valve is increased as the pressure in the actuation chamber is measured by the pressure sensor . The cracking current is the measured current when the measured pressure is found to increase as the current delivered to the valve gradually increases. The cracking current may be determined for two or more pre determined back pressures and the controller may use this data to fit an equation that relates the cracking current of the valve to the existing back pressure in the pump actuation chamber. In an embodiment of the pump and valve system the equation may be a linear equation.

In one aspect of the calibration procedure the controller determines the cracking current at 4 initial back pressure values in the pump actuation chamber for each vari valve associated with the pump. This determination may be repeated several times e.g. 3 times for a total of twelve measurements . The controller may be programmed to ignore outlier current values and to develop a linear equation of cracking current as a function of initial back pressure using the remaining data.

The outgassing of air or other gas from either fresh or used dialysate may cause a cumulative imbalance between the fresh dialysate volume pushed through the dialyzer by the balance chamber and the used dialysate volume in the balance chamber used to push the fresh dialysate. For example if a gas bubble fails to be expelled from a passageway on the used dialysate side of the balance chamber its alternating expansion and contraction may cause an additional amount of used dialysate to be expelled from the balance chamber that is unaccounted for by the fresh dialysate that is being pushed to the dialyzer. As the inner dialysate pump pushes used dialysate into the balance chamber and as an equivalent volume of fresh dialysate is being pushed to the dialyzer the gas bubble becomes compressed under the pressure of the pump. However at the end of the pump stroke as pressure within the balance chamber decreases the gas bubble may expand causing an additional small amount of used dialysate to be expelled from the balance chamber outlet. This small additional amount of used dialysate being expelled from the used dialysate side of the balance chamber cumulatively over many pump strokes may result in a significant imbalance between the fresh dialysate being pushed into the dialyzer and the fresh dialysate being expelled to drain. In an embodiment this potential fluid imbalance may be mitigated by ensuring that gas bubble expansion at the end of an inner dialysate pump stroke pushes dialysate back toward the pump chamber rather than toward the drain line. The procedure to mitigate this unaccounted fluid flow may be illustrated by considering a delivery stroke from pump to balancing chamber in . At the end of a pump stroke to fill balance chamber with dialysate from pump outlet drain valve is closed. The balancing chamber may then be fluid locked by closing valves while keeping delivery pump outlet valve open. Next the controller may release the pneumatic pressure on the delivery pump which allows any gas bubbles in the fluid path to the balance chamber to expand. Any liquid displaced by the gas bubble expansion will be free to move back toward pump rather than to drain. Finally the controller may close the outlet valve on the delivery pump and open valve to prepare for expulsion of the dialysate in balance chamber to drain. This same procedure may be applied to pump and balancing pump . In addition a similar procedure may be used on the fresh dialysate side of the balance chambers . In that case the controller may release the pressure in the outer dialysate pump at the end of its pump stroke to fill one of the balance chambers while the valve between the outer dialysate pump and the balance chamber is still open. Any expanding gas bubble in the fluid path between the outer dialysate pump and the balance chamber will tend to displace dialysate back toward the pump rather than downstream toward the dialyzer.

The pod pumps in the blood cassette may execute shortened strokes to reduce damage to blood elements. Damage to blood elements may be reduced by stopping the membrane in a pod pump from fully touching the wall of the pumping chamber at the end of a pumping stroke. The blood pump may be short stroked while a system controller monitors blood flow rate and monitors for occlusions. At the start of pumping full strokes are performed in order to achieve steady state flow and determine parameters that are used to control short stroking including the required delivery pressure required fill pressure and time to fill the pumping chamber. The flow rate may be determined from the time required to deliver a full chamber of fluid. Steady state flow conditions may be indicated by a the average flow changing less than about 3 ml min b the maximum pump flow rate is within about 15 ml min of the target for both the fill and deliver pressures and c the average chamber delivery flow rate is within about 10 of the pump flow rate at the minimum actuation pressure.

The blood pump may be short stroked by having the controller reduce the delivery stroke to a pre determined fraction e.g about 80 of the delivery pressure determined during the steady state phase. The reduced pressure may cause the delivery stroke to be for example approximately 90 complete by the time the pump diaphragm turns around and the nearly empty chamber begins the pump fill stroke. The pump diaphragm turns around when the chamber executing the fill stroke reaches end of stroke. The fill stroke occurs at pressure that was determined by the controller during the steady state phase. The nature of the short stroke may be monitored by examining the maximum and integrated correlation number and time to end of stroke of the same chamber during the subsequent fill stroke. The controller may monitor the time to fill the pump using the end of stroke detection algorithm described above. The controller may adjust the deliver pressure in the actuation chamber so that the time to fill the chamber is 90 of the fill time that was determined during the steady state phase. Alternatively the integrated correlation value may be monitored and the end of fill is deemed to be for example 90 of the integrated correlation number corresponding to a complete end of stroke cycle.

The blood pump and controller may detect full occlusions either upstream or downstream of the pump during short stroking using the correlation number during the fill stroke. A full occlusion downstream will result in more blood left in the chamber which will shorten the fill time. The end of stroke may be detected by a large drop in the correlation number. The short fill time may be detected by a low integrated correlation number. Similarly an occlusion upstream of the pump will produce a large drop in correlation number and a lower integrated correlation number.

The short stroking scheme assumes the delivery impedance is constant. However changes in flow resistance across the dialyzer or blood lines or changes in the patient s access may cause the blood pump to do full strokes. This problem may be mitigated by relearning the required delivery pressure fill pressure and fill time by returning to full strokes every 100 strokes. If the delivery and fill impedance have not changed the check may not require more than 8 full strokes. In order to limit hemolysis the controller may end the therapy if an excessive number or percentage of the blood pump strokes are full strokes. In one example the controller will end therapy if more than 200 full strokes to occur or if 20 of the strokes after the initial steady state phase are full strokes.

A positive or negative pressure source connected to the activation chamber of a pod pump via a pulsed valve and a pressure sensor coupled to the activation chamber of a pod pump may be used to determine pump operating parameters including the end of stroke occlusions and fluid pressures upstream and downstream of the pump. One exemplary configuration is shown in . The binary valve may supply positive pressure via the FMS valve to the actuation chamber of the pod pump to order deliver fluid from pump through valve . The FMS valve may rapidly open and close to incrementally increase the pressure in the actuation chamber . A closely coupled pressure sensor may measure the pneumatic pressure in the chamber and transmits the pressure to a controller . The FMS volume and FMS Pressure sensor may be present but are not used to in this embodiment.

The controller may control the opening and closing of the FMS valve and record the pressure sensor data in order to produce the time history of the valve operation and the resulting pressure in the actuation chamber shown in . The valve may be pulsed in a periodic fashion with the frequency duration of the open period and duration of the closed period controlled by the controller . The duty frequency may be selected heuristically. The frequency may be low enough to differentiate between membrane movement and system compliance. The frequency may be selected to be low enough to allow fluid to be displace but high enough to meet the maximum required flow rates.

The response of the membrane and flow from the pump may be analytically monitored by summing the pressure decrease during each pump step . When the FMS valve is closed the controller may calculate the change in pressure between each time step or sample and sums the differences over one closed valve period 

The pressure data may be filtered to reject signal noise. The chamber pressure may be filtered with a low pass filter before calculating the pressure change. A positive pressure change may be rejected from the sum. The pressure summation may be reset to zero when the FMS valve opens. The controller may detect flow of fluid from the pump when the absolute value of the sum of pressure change exceeds a defined value . The controller may detect an end of stroke on the first summation that does not meet the defined value after a summation that does exceed the defined value. The controller may command the FMS valve to be held open to assure that all fluid is expelled from the pod pump . The FMS valve is held open to improve stroke to stroke repeatability which in turn increases flow rate accuracy.

The hardware configuration in and the pressure data in may provide information on the fluid pressure downstream of the pod pump. The fluid will not flow out of the pod pump until the pneumatic pressure in the actuation chamber is greater than the fluid pressure downstream of the pump and valve . The controller may detect flow of fluid and movement of the membrane when the absolute value of the sum of the pressure change exceeds a defined value as occurs in step . The controller may store the average the pressure during this step as the downstream pressure. Alternatively the pressure at the end of step before the FMS valve is reopened may be stored as the downstream pressure.

Full occlusions downstream of the pod pump may determined with the hardware configuration in and the pressure plots in . An occlusion downstream of the pump may be declared by the controller when no fluid flow or membrane movement is detected as the pressure in the actuation pressure is increased to the maximum pressure . The controller determines that the fluid has not flowed when the pressure summation does not exceed the given value .

The hardware configuration in and the pressure data in may provide information on the fluid pressure upstream of the pod pump during a fill stroke. A fill stroke may begin by opening the binary valve to supply negative pressure via the FMS valve to the actuation chamber of the pod pump to order to draw fluid into the pump through valve . The FMS valve may rapidly open and close to incrementally decrease the pressure in the actuation chamber . A closely coupled pressure sensor may measure the pneumatic pressure in the chamber and transmits the pressure to a controller . The controller may control the opening and closing of the FMS valve and record the pressure sensor data in order to produce the time history of the valve operation and the resulting pressure in the actuation chamber shown in .

Fluid will not flow into the pod pump until the pneumatic pressure in the actuation chamber is less than the fluid pressure upstream of the pump and valve . The controller may detect flow of fluid and movement of the membrane when the sum of the pressure change exceeds a defined value as occurs in step . The controller may store the average the pressure during the step as the upstream pressure. Alternatively the pressure at the end of step before the FMS is valve is reopened may be stored as the downstream pressure.

Full occlusions up stream of the pod pump may determined with the hardware configuration in and the pressure plot in . An occlusion upstream of the pump may be declared by the controller when no fluid flow or membrane movement is detected as the pressure in the actuation pressure is decreased to the minimum pressure . The controller may determine that the fluid has not flowed when the pressure summation does not exceed the given value .

One exemplary hardware configuration is shown in . The valve may be used opened and closed rapidly to step wise increase the pressure in the actuation chamber . The rapid opening and closing of the binary valve may produce a pressure plot similar to . The end of stroke downstream pressure and downstream occlusions may be determined by the same methods described above. The upstream pressure can be determined by closing valve and rapidly opening and closing valve to step wise decrease the pneumatic pressure in the actuation chamber . The rapid opening and closing of valve may produce a pressure plot similar to . The upstream pressure and upstream occlusions may be determined in the same method described above.

In some cases the controller needs to know if air is present in the liquid side of the heparin metering pump because it pumps both liquid from and air into the heparin vial . In one exemplary method to detect air in the metering pumps herein named the Air Detect procedure the controller may execute a first FMS volume measurement using the positive pressure source followed by a second FMS volume measurement using the negative pressure source . The difference in the calculated volume of the actuator chamber may be named the Air Volume Metric. The controller may declare air is present in the liquid side of the metering pump if the Air Volume Metric exceeds the Air Volume Limit. The Air Volume limit may be determined separately by running the Air Detect procedure twice to determine the Air Volume Metric when the metering pump full of air then repeating the procedure when the pump is full of liquid. The Air Detect Limit may be set at the average of the two Air Volume Metrics for the pump full of air and full of liquid. The procedure to determine the Air Detect Limit may be repeated if the two values of the Air Volume Metric are too close or if the Air Volume Metric for a liquid filled pump is larger than the Air Volume Metric for gas filled pump. The Air Volume limit may be determined for each metering pump. This method provides an accurate and reliable way to detect air without additional hardware and despite large changes in manifold temperature tubing volume and flex or machine to machine reference volume variation.

A diagram of an example control algorithm is shown in . The controller in this example is a standard discrete PI controller. The output of the PI controller is split into two paths one for the source valve one to the sink valve. An offset term is added to each of these paths to compensate for the valve dead band. The resulting command is then limited to valves greater than zero after being inverted in the case of the sink valve .

The offset term is positive in the case of the source valve and negative in the case of the sink valve. As a result both valves will be active even as the error goes to zero. These offsets do improve the trajectory following and disturbance rejection ability of the controller but can also result in leakage from both valves at steady state if the command offsets are slightly larger than the actual valve dead band. If this is the case the valves will have equal and opposite leakage mass flows at steady state.

To eliminate this leakage mass flow when the control system is idle a power save block can be added to turn off the valves if the absolute value of the error term remains small for a period of time. This is analogous to using mechanical brakes on a servomotor.

Referring now to the controller in this example uses a standard discrete PI regulator a diagram of the PI regulator is shown. The integrator can be limited to prevent wind up when the commands are saturated. The integrator will always be capable of unwinding. Because there are different amounts of air in the pod for a fill and a deliver stroke the response of the pod can be very different for a fill and deliver stroke. The proportional gain is adjusted differently for a fill and deliver stroke to better tune for the different pod responses.

The saturation limits chosen for the PI regulator should take into account the offset that will be added to the result. For example if the valve saturates at 12V and a 5V fixed offset will be added after the PI loop the saturation limit in the PI loop should be set to 7V. This positive and negative saturation limits will likely be different due to the different dead band in the source and sink valves.

During a fill stroke the upstream fluid valve is closed and the down stream fluid valve is opened to allow fluid flow into the chamber. During a delivery stroke the upstream fluid valve is opened and the downstream fluid valve is closed to allow fluid flow out of the chamber. At the end of stroke and until the next stroke starts both fluid valves are closed.

As discussed in certain aspects a pod pump may be operated through action of a control fluid for example air nitrogen water an oil etc. The control fluid may be chosen to be relatively incompressible and in some cases chosen to be relatively inexpensive and or non toxic. The control fluid may be directed into the system towards the pumps using a series of tubes or other suitable conduits. A controller may control flow of control fluid through each of the tubes or conduits. In some cases the control fluid may be held at different pressures within the various tubes or conduits. For instance some of the control fluid may be held at positive pressure i.e. greater than atmospheric pressure while some of the control fluid may be held at negative pressures less than atmospheric pressure or even zero pressure i.e. vacuum . As a specific non limiting example a pod pump such as the one illustrated in may be controlled through operation of the control fluid by the controller. As previously discussed the controller may open and close valves e.g. valves and to expose the pneumatic side of the pod pump to a positive pressure or a vacuum pressure at different points during a pumping cycle.

In addition in certain embodiments the controller typically electronic may also be kept separate from the various fluid circuits such that there is no electronic contact between the controller and the various fluid circuits although the control fluid e.g. air is able to pass between the controller and the various pumps. This configuration has a number of advantages including ease of maintenance the controller and the various circuits can be repaired independently of each other . In one embodiment the fluid circuits may be heated to disinfection temperatures and or exposed to relatively high temperatures or other harsh conditions e.g. radiation to effect disinfection while the electronic controller which is typically more delicate is not exposed to such harsh conditions and may even be kept separate by an insulating wall e.g. a firewall or the like.

Thus in some embodiments the system may include a cold section which is not heated and a hot section portions of which may be heated e.g. for disinfection purposes. The cold section may be insulated from the hot section through insulation. In one embodiment the insulation may be molded foam insulation but in other embodiments can be any type of insulation including but not limited to a spray insulation or an insulation cut from sheets.

In some cases the hot section may be heated to relatively high temperatures e.g. the hot section may be heated to temperatures sufficient to sterilize components within the hot section. As many electronics can not go above 50 C. without failing or other adverse consequences it may be advantageous in some embodiments to separate the electronics from other components that may be disinfected. Thus in some cases the components that may need to be disinfected are kept in the hot section while components that cannot be heated to such temperatures are kept in the cold section. In one embodiment the cold section includes a circulation system e.g. a fan and or a grid to allow air to flow in and out of the cold box.

All or a portion of the hot section may be encased in insulation. In some cases the insulation may be extended to cover access points to the hot section e.g. doors ports gaskets and the like. For instance when the hot section is sealed the insulation may completely surround the hot section in some cases.

Non limiting examples of components that may be present within the cold section include power supplies electronics power cables pneumatic controls or the like. In some cases at least some of the fluids going to and from the hot section may pass through the cold section however in other cases the fluids may pass to the hot section without passing through the cold section.

Non limiting examples of components that may be present within the hot section include cassettes if present fluid lines or the like. In some cases some electrical components may also be included in the hot section. These include but are not limited to a heater. In one embodiment the heater can be used to heat the hot box itself in addition to fluid see e.g. heater of . In some embodiments the heater heats the entire hot section to reach a desired temperature.

In one embodiment the hot section includes some or all of the fluidic lines. In addition in some cases the hot section may include but is not limited to temperature and conductivity sensors blood leak sensors heaters other sensors switches emergency lights or the like.

In some cases a manifold may transition from the cold section to the hot section e.g. a manifold for air or another control fluid.

Separating the components into hot and cold sections may offer several advantages those include but are not limited to longevity of electrical components reliability or efficiency. For example by separating the components into hot and cold the entire hot box may be heated. This may allows for more efficient use of heat which leads to a more energy efficient system. This also may allow for the use of standard off the shelf electronics which leads to lower cost.

In some embodiments the control fluid used for controlling the pumps valves etc. is air and the air may be brought into the system through the operation of one or more air compressors. In some cases the air compressor may be kept separate from the blood flow path and the dialysate flow path systems within the system and air from the air compressor may be brought to the various pumps through various tubes conduits pipes or the like. For example in one embodiment a pneumatic interface is used to direct air from the air compressor to a series of tubes or conduits fluidically connected with the various pumps or chambers.

A non limiting example can be seen in which shows a schematic representation of a dual housing arrangement according to one embodiment. This arrangement may be advantageously used with cassettes that include many pneumatically actuated pumps and or valves. If the number of pneumatically actuated pumps and or valves in a cassette is large enough the cassette containing these pumps and valves can become so large and the pressures involved can become so great that it may become difficult to properly seal and position all of the pumps and valves. This difficulty may be alleviated by using two or more different housings. The valves and pumps such as pod pumps are placed in a main housing from which connecting tubes lead from pneumatic ports . The main housing also has inlet and outlet tubes which allow liquid to flow into and out of the main housing. The connecting tubes provide pneumatic communication between valves and pumps in the main housing and a smaller secondary tube support housing which is provided with a pneumatic interface for each of the tubes. The proper positioning and sealing of all the pneumatic interfaces against receptacles in the base unit can be accomplished more easily with the smaller tube support housing than it would be if the pneumatic actuation was applied to the larger main housing directly.

The control fluid e.g. air may be supplied to the system with one or more supply tanks or other pressure sources in one set of embodiments. For instance if two tanks are used one supply tank may be a positive pressure reservoir and in one embodiment has a set point of 750 mmHg gauge pressure 1 mmHg is about 133.3 pascals . The other supply tank can be a vacuum or negative pressure reservoir and in one embodiment has a set point of 450 mmHg gauge pressure . This pressure difference may be used for instance between the supply tanks and the required pod pressure to allow for accurate control of the variable valves to the pod pumps. The supply pressure limits can be set based on maximum pressures that can be set for the patient blood flow pump plus some margin to provide enough of a pressure difference for control of the variable valves. Thus in some cases the two tanks may be used to supply pressures and control fluids for the entire system.

In one embodiment two independent compressors service the supply tanks. Pressure in the tanks can be controlled using any suitable technique for instance with a simple bang bang controller a controller that exists in two states i.e. in an on or open state and an off or closed state or with more sophisticated control mechanisms depending on the embodiment. As an example of a bang bang controller for the positive tank if the actual pressure is less then the desired pressure minus a hysteresis the compressor servicing the positive tank is turned on. If the actual pressure is greater then the desired pressure plus a hysteresis the compressor servicing the positive tank is turned off. The same logic may be applied to the vacuum tank and control of the vacuum compressor with the exception that the sign of the hysteresis term is reversed. If the pressure tanks are not being regulated the compressor is turned off and the valves are closed.

Tighter control of the pressure tanks can be achieved by reducing the size of the hysteresis band however this will result in higher cycling frequencies of the compressor. If very tight control of these reservoirs is required the bang bang controller could be replaced with a PID controller and using PWM signals on the compressors. Other methods of control are also possible.

However other pressure sources may be used in other embodiments and in some cases more than one positive pressure source and or more than one negative pressure source may be used. For instance more than one positive pressure source may be used that provides different positive pressures e.g. 1000 mmHg and 700 mmHg which may be used to minimize leakage. For example high positive pressure can be used to control valves whereas lower positive pressures can be used to control pumps. This limits the amount of pressure that can potentially be sent to the dialyzer or to the patient and helps to keep actuation of the pumps from overcoming the pressures applied to adjacent valves. A non limiting example of a negative pressure is 400 mmHg. In some cases the negative pressure source may be a vacuum pump while the positive pressure pump may be an air compressor.

The pressure distribution module in may comprise a manifold cartridge valves surface mount valves pressure sensors ports connected to pressure reservoirs and ports connected to corresponding port s on fluid handing cassettes such as those shown in . The pneumatic module may be connected to the fluid handling cassettes via pneumatic lines not shown that connect to interconnect with the several ports via a connector. In one example the pneumatic lines connect directly from the ports on the pressure distribution module to ports on fluid handling cassettes. In another example a group of pneumatic lines connect ports on the fluid handing cassettes to corresponding ports on one or more interface blocks that can reversibly mate with the pressure distribution module via an interface block mounted to the output side of the pressure distribution module .

The reservoirs valves and ports are connected to a multi part pneumatic manifold . The valves are controlled in certain embodiments by electrical signals from a hardware interface board see block in . The pressure sensors may be electrically connected to the interface board . An automatic computer may be configured to control the flow of blood dialysate water etc. through control of fluid valves and pumps in cassettes in the dialysis unit in by opening and closing the pressure distribution valves based in part on the signals received from the pressure sensors . The pod pumps and valves of the cassettes are pneumatically actuated by selective connection to the pressure reservoirs by the operation of electro mechanical valves comprising two way and three way digital valves and proportional valves on the pressure distribution module . The digital valves have two positions. A two way digital valve is either open or closed. A three way digital valve connects a common port to either a first or second port. The proportional valves provide a variable resistance to flow that is controlled by a driving electrical signal having a variable current. In an example the proportional valves may achieve a variable resistance by varying the area of the minimum opening. In another example the proportional valve varies the flow resistance by varying the fraction of the time that the valve is open while the valve rapidly moves between open and closed positions. In another example a valve may oscillate between a more closed position and a more open position without fully closing. The flow resistance is varied by changing the fraction of time that the valve is commanded to be in the more open position.

In one embodiment the surface mount valves shown in may be proportional valves also referred to as vari valves . In the illustrated embodiment the multiple surface mount valves mount on the top face of end manifold block the top face being parallel to the channeled face . In certain embodiments the first port of the surface mount valve threads into a first port and connects the first port to the second port see . In some embodiments the surface mount valves may be any of a variety of commercially available variable valves such as proportional solenoid valves in one embodiment the valves are Clippard Minimatic EV PM 20 6025 valves available from Clippard Instrument laboratory Inc. Cincinnati Ohio. In another embodiment the valve may be any digital two way or three way valve suitable for surface mounting such as model 11 15 3 BV 12 P 0 0 from Parker Hannifin Corporation in Hollis N.H. The surface mounted two way or three way valves may selectively connect ports and or a third port not shown on the surface of the top face .

As shown in the pressure sensors may be directly mounted to the top face of the end manifold block . The pressure sensors may be integrated circuits soldered to a printed circuit board PCB . As shown in a printed circuit board including one or more pressure sensors may be mounted on the top face that is parallel to the channeled face of the manifold end block with a gasket to pneumatically isolate each sensor and with a plate to hold the PCB in place and compress the gasket enough to isolate each pressure sensor. In one example the pressure sensor may be obtained from Freescale Semiconductor Inc. in Tempe Ariz. part no. MPXH6250A . The PCB may be mounted as a unit to the end manifold block . The pressure sensing face of each pressure sensor may be fluidly connected via port and channels to the desired pressure sources such as reference volumes or more remotely to the actuation chambers of pod pumps to dialysate reservoir tank in many cases to monitor the liquid pressures in the liquid handling cassettes.

The pressure reservoirs described above may be fluidly connected to the pneumatic manifold via fittings on the mid manifold block and the end manifold block . A reservoir of negative pneumatic pressure or vacuum may connect via fitting shown in . A high pressure reservoir may connect via fitting . The low pressure reservoir may connect to both the mid manifold block and the end manifold block . The low pressure reservoir may be connected to the mid manifold block via fitting . The low pressure reservoir may also be connected to the end manifold block via fitting . There is a flow path not shown from the digital valve block through the mid plate and the mid plate gaskets to the end manifold block shown in . Both blocks have connections to ambient pressure or the atmosphere. Each connection or hole may be covered with a water guide that does not seal the hole but directs any water in the manifold in a preferred direction. The pressure reservoirs to which the pressure distribution module may be connected are volumes maintained at specified or pre determined pressures by pumps controlled by a system controller. In an embodiment a high pressure reservoir can be maintained at a pressure of about 1050 PSI and a positive pressure reservoir can be maintained at a pressure of about 850 PSI. The pressures actually delivered to various pneumatically actuated pumps and valves may vary based on the pressure reservoir ported by the two way three way and vari valves on pressure distribution module . Furthermore intermediate pressures may also be delivered through a combination of rapid opening and closing of the on off valves or through a variation of the orifices of the vari valves.

The manifold may comprise one or two end manifold blocks one or more mid manifold blocks and one or more mid plates and gaskets . An exploded view of a multi part pneumatic manifold is shown in . The two manifold blocks may be clamped together with a gasketed mid plate between them. The mid plate may also be referred to as a backing plate as it provides a rigid surface that forces the gasket to seal against multiple channels . The channels on the underside of end manifold block are visible in . Each manifold block may comprise at least one face with channels and various ports and FIG Pneu A on other faces. The channels and may be configured as a groove that includes a solid bottom and two side walls with an open top. The channel may be cut into one face of the manifold block or it may be formed with walls that extend above the surface of the manifold block face . As shown in the open top of the channels may be sealed by clamping a gasket backed by a rigid flat mid plate against the channels. The mid plate is a backing plate that forces the gasket to seal against all of the channels . The channels are linked to pressure sources valves sensors and outlet ports that reside on other faces of the blocks. The manifold blocks may sandwich the gaskets and the mid plate between them with mechanical fasteners to seal the multiple channels on the channeled faces of each of the manifold blocks. This sandwich construction allows the compact assembly of multiple manifold blocks with sets of channels on one face of each block .

In some embodiments there are ports or channels on five of the six faces of the manifold blocks. The end manifold block may have channels on face . Pressure sensors and surface mount valves may be attached to the top face of the end manifold block . The end manifold block may include supply lines which run the length of the manifold block. The ports for the supply lines are at each end of the end manifold block . The ports that connect to the liquid handling cassettes may be on the front face . The back face may include additional ports to connect to the liquid handling cassettes or cavities for cartridge valves.

The mid manifold block may have channels on the top face . Cartridge valves may mount on the back face . The front face may include ports that connect to the liquid handling cassettes. Both end faces of the mid manifold block include ports that connect to the supply lines that are cavities that run the length of the mid manifold block . In one embodiment the bottom face not shown of mid manifold block may include additional ports that connect to the supply lines . In another embodiment the bottom face not shown of mid manifold block may be flat. In another embodiment the bottom face not shown of mid manifold block may include additional channels that provide fluid connections between some of the following but not limited to ports cartridge valves and supply lines.

In certain embodiments the pneumatic channels connect many of the ports to a cartridge valve and many of the cartridge valves to one of the supply lines . The supply lines may be in the form of long cavities that run the length or a substantial portion thereof of the manifold block. In the mid manifold block the supply lines from the end faces may run generally perpendicular to the path of the channels . Thus any channel may be connected to any one of the supply lines . The channels also generally run from the front face to the back face thereby allowing connection between the ports to the liquid pumping cassettes and the cartridge valves. In a similar way the channels in end manifold block allow connection to the supply lines ports and surface mounted valves . The three supply lines high pressure low pressure and vacuum may be plumbed to one of the three pressure reservoirs. The fourth line may be vented to atmosphere. In certain embodiments one or more of the channels connect a valve to a reference volume in the end manifold block which is used to determine volume changes in remotely connected pneumatically actuated membrane pumps via FMS techniques . The reference or FMS volumes in the end manifold block are visible in .

An example of the fluid connections to and from the channels shown e.g. in are shown in which present 3 views of the same part of the mid manifold block . The cartridge valve cavities shown e.g. in and may be connected to three channels via vertical holes from each of the three channels to the cartridge valve cavity . The vertical holes may intersect the cartridge valve cavity at different axial depth from the back face so that a three way cartridge valve may connect the second hole to either the first or the third hole. The second hole may be connected to the liquid handling cassette where the pneumatic pressure will open or close a liquid valve or may actuate a pod pump. The first and third holes may be connected to pressure reservoirs.

An example of the connections between the pressure reservoirs and liquid valves in the liquid handling cassette can be seen in . The cartridge valve cavity A on the extreme right receives valve . The cartridge valve cavity A is connected to the vacuum reservoir via supply line . The channel on the extreme right of has a vertical hole A that connects the channel to the supply line and a second hole B that connects to the cartridge valve cavity A. The second hold B can be seen in . The next channel connects the Mix Acid In valve D in the mixing cassette to the cartridge valve via a vertical hole C to a port and a vertical hole B to the cartridge valve cavity A. The cavity A can be seen in . The high pressure flows from supply line via hole A through the third channel and into the cartridge valve cavity A via vertical hole B. Similar connections are made for the next 4 valves and . The cartridge valve cavities are formed in two rows with one row offset so that the cartridge valve cavities are staggered. The staggered arrangement allows two cartridge valve cavities A and A to share a single channel that supplies pressure. A single hole B may supply high pressure to both cartridge valve cavities A B by passing through both near the back of the cartridge valve cavities. The channel on the extreme right is in part aligned perpendicular to the supply lines and in part parallel to the supply lines to allow vertical hole B to passes through both cartridge valve cavities A and A and to supply vacuum to both valves. The vertical holes B B and B intersect the cartridge valve cavities A A at different distances from the back face of the manifold block . The arrangement of vertical holes allows the cartridge valves to connect the liquid valves E E on the mixing cassette to either the high pressure supply line or to the vacuum supply line . The mid plate and gaskets may include holes that connect channels in the mid manifold block to any of number of elements in the end manifold block including but not limited to channels pressure ports and surface mount valve ports .

An exemplary description of manifold plumbing including a pump with an FMS system is presented in and . The mid manifold block incorporates channel features to implement different pneumatic control features. The channel carries a pneumatic pressure source to the hole which goes down to valve station . The channel carries a different pneumatic pressure source to the hole which goes down to valve station . Hole does down to a different port on station and channel carries this pneumatic signal over to hole which intercepts both valve stations and . These features implement a portion of the pneumatic schematic with valves A A and A corresponding to valve stations and respectively.

The channels are sealed with the gasket see e.g. which is advantageously pressed essentially evenly against the channels by the mid plate . The manifold block and gasket can include features to assure an essentially even distribution of pressure on the gasket. The mid manifold block may include raised sections that fit through matching slots in the gasket . The mid plate sits on the raised features assuring essentially even compression of the gasket. In certain embodiments screws are used to clamp the gaskets and mid plate between the two manifold blocks . The mid plate provides a substantially smooth and rigid backing for the gaskets so that more than one manifold block may be assembled into the multi part pneumatic manifold .

The gaskets and mid plane include holes to allow pressure and flow communication between the mid manifold block and the end manifold block . Some of the holes may allow flow from the mid manifold block up to the surface mount valves and back. Some of the holes may allow pressure sensors to measure pressures in channels on the mid manifold block . Some of holes through the gasket and mid plane may connect the supply lines in the mid manifold block to supply lines in the end manifold block . The gaskets in one embodiment are made of ethylene propylene diene monomer M class rubber EPDM with a 40 Shore A hardness or similar elastomer. The mid plate is preferably a relatively stiff plate that provides a rigid and substantially planar surface to urge the gaskets against the grooves in both manifold blocks. In one embodiment the mid plate is 0.2 inch thick aluminum.

An alternative embodiment is presented in where a third mid manifold block A is added. In this embodiment the under side of mid manifold block unseen in is smooth with holes for communication between the second mid manifold block and the third mid manifold block A. A gasket A seals the channels A of mid manifold block A. The channels of mid manifold block A serve the same function as and connect the exhaust ports A valves A and supply ports A. The second and third manifold blocks can be stacked because the cartridge valves A are on the back face A the exhaust ports are on the front face A and the supply ports are on the end faces .

Further alternative embodiments of the pressure distribution system may comprise an end manifold block and 2 or more mid manifold blocks with channels on one face and a smooth surface on the opposite surface. The cartridge valves may be mounted on the back face on one side while the exhaust ports may mount on the opposite face. The supply lines may extend the length of the manifold blocks. The smooth face of this embodiment of the mid manifold block acts as the backing plate for the gasket A that seals the channels A on the second mid manifold block A. In other embodiments multiple mid manifold blocks can be added with gaskets A between to create more channels and more output ports to control more complex pneumatically or fluidically driven systems.

In another alternative embodiment mid manifold block has channels both on the top visible surface and on the lower unseen surface. The channels on the lower surface of may be sealed via both a gasket and a mid plate between and A. Multiple mid manifold blocks can stacked together with channels on both the upper and lower surfaces by placing gasketed mid plates between each. In this way multiple mid manifold blocks with channels on two surfaces can be combined to form more complex pneumatic supply systems.

In another example the manifold may comprise one or more mid manifold blocks between two end manifold blocks . Gasketed mid plates may be placed between each pair of manifold blocks to create fluid channels.

The ports for the pneumatic lines that connect the pressure distribution manifold to the cassettes are visible on the front face in . In certain embodiments pneumatic lines from ports may connect to the integrated cassette system e.g. that of via interface blocks that quickly separate to allow the integrated cassette system to be easily replaced. The fixed interface block is shown in relation to the pressure distribution system in . Two removable interface blocks shown in are clamped against by the two clamps against the front side of the fixed interface block. A gasket not shown on the face of the removable interface blocks provides an air tight seal. Alignment pins pressed into the fixed interface block align removable blocks so that the matching ports are aligned. The removable interface blocks can be located within the hot box cavity of the dialysis unit within which the fluid pumps and valves are located. This cavity may be subject to a high temperature environment during disinfection of the dialysate carrying pumps and valves. In contrast the fixed interface block may be located in a section of the dialysis unit cold box section that is thermally segregated from the hot box section to protect the temperature sensitive elements of the dialysis system electronic and electromechanical components .

The integrated cassette system e.g. of may be connected via flexible lines to the two removable interface blocks . Alternatively the integrated cassette system may be equipped with raised rigid ports spatially arranged to connect and form sealing engagements with mating ports on either fixed interface block or the removable interface blocks . The flexible lines are secured to the ports at the top of the blocks. The blocks may be fabricated from polysulfone or another tough thermoplastic with good stability at high temperatures. The integrated cassette system may be connected to the pneumatic controls of the dialysis machine by placing the removable blocks and against the fixed block and then turning the handles of the clamps to secure the removable blocks. The removable blocks provide a reliable and quick design to align and seal the many connections between the integrated cassette system and the pressure distribution module . They provide for rapid connection to and disconnection from the pressure distribution module greatly increasing the efficiency with which the integrated cassette system is periodically replaced.

The fixed interface block thermally isolates the pressure distribution system in the ambient temperature part of the dialysis machine to reduce heat flow from the insulated hot box where the heated dialysate disinfection fluid flows through the integrated cassette system. In certain embodiments the fixed interface block is fabricated from polysulfone or another tough thermoplastic material with good stability at high temperatures. In certain embodiments the fixed interface block may be bolted to pressure distribution system and the ports may be sealed with a gasket which may also aid in thermally insulating the pressure distribution module from the ambient temperatures in the hot box section of the dialysis unit.

Ports connect the pressure distribution system to the blood cassette e.g. of and the FMS reservoir for the dialysate tank not shown . The twelve ports shown in are connected via flexible tubes to plate on the surface of the hot box of the dialysis machine. A second plate with flexible tubes is bolted to the first plate at the surface of the hot box. The second plate not shown is connected via flexible tubes to the FMS volume for the dialysate tank and to the control port assembly not shown . The control port assembly has pneumatic receptacles that connect to the ports on the bottom plate of blood cassette .

The manifold block can be fabricated in advance and customized by the installer or product developer if desired. A mass produced manifold block may be fabricated without the vertical holes connecting the channels and the supply lines and then configured for a particular application by connecting a given channel to a specific supply line.

The detailed plumbing schematic of an embodiment of the vary valve manifold and digital valve manifold is described in the pneumatic schematics and with corresponding flow schematics of the blood dialysate and mixing cassettes shown in . In the pneumatic schematics the supply lines are represented as vertical lines. The three way valves for example may be plumbed to two different supply lines and to a liquid valve E in the liquid handling cassettes . The three way valve for a blood pump may connect the liquid valve E to the vacuum supply line when not powered. In the non powered position the liquid valve E is preferably in a default open position so that the blood is not trapped during a loss of power. In the powered position the liquid valve E is connected to the low pressure supply line to close the liquid valve. The blood pumps may be actuated by a pair of proportional valves for example that connect to a low pressure supply line and vacuum supply line . The pressure supplied to the blood pump may be monitored by a pressure sensor . Some pneumatic circuits for pumps may include a FMS chamber to allow accurate measurement of the volume pumped. One example is a drug metering or heparin pump actuated by valves and connected to the vacuum and high pressure lines respectively. The actuating fluid path is connected to an FMS chamber and flows through a third valve toward the heparin pump E. Pressure sensors may monitor the pressure up and down stream of valve .

The pressure supply lines and default valve positions may be selected to achieve safe conditions in the event of a failure. The liquid valves E E E E and pumps that handle blood in the blood cassette may be powered by the vacuum supply line and the low pressure supply line . The low pressure plumping may be elected for the pumps or valves that handle blood elements to avoid the possibility of exposing the biological fluid and thereby the patient s vascular system to pressures in excess of the low pressure reservoir. In the inner dialysate cassette the dialysate pumps may be connected to the low pressure supply line and the ambient pressure line . The inner dialysate pumps preferably are not be connected to the vacuum supply line to avoid lowering the dialysate pressure below ambient and therein minimizing the amount of gas evolving out of the dialysate solution. In this case the outer dialysate pump may supply positive pressure to the dialysate entering the inner dialysate cassette thereby filling the inner dialysate pumps when the upstream valves are open.

The un powered positions of the three way valves in the pressure distribution system may be selected to provide a safe condition during power loss or failure of the controller or FPGA safety system. The blood pump valves the ODP valves and the BTS clamp default to a vacuum connection which opens the liquid valves allowing blood to be pushed out of the blood cassette. The unpowered position for the heparin pump valves ultrafiltration pump valves acid pump valves and the bicarbonate pump valves disconnects the pump from the pressure reservoirs so they do not pump any fluid. The balance of the valves may default to connecting high and low pressure to the liquid valves so that the liquid valves close when power is lost. Rinseback of blood to the patient is possible in a power failure scenario through the default positioning of the valves leading from the low or high positive pressurized tank through the pressure distribution manifold valve and into the dialysate tank via valve for example. Pressure applied to the dialysate fluid in the dialysate tank can be directed to the blood side of the dialyzer through the outer dialysate pumps and valves the ultrafilter and the inner dialysate fluid path to the dialyzer with the appropriate distribution manifold valves being arranged in either a default open position for the pathway to the dialyzer or a default closed position for other dialysate pathways ultimately leading to drain. The dialysate fluid may thus be transferred to the blood side of the dialyzer membrane through hydrostatic pressure which allows the blood in the blood tubing set to be rinsed back to the patient s vascular system.

Certain aspects of the invention include various sensors. For example in various embodiments of the inventions described herein fluid handling may include sensor apparatus systems comprising a sensor manifold. The sensor manifold may be arranged to include most of the fluid sensors used in the system including for example dialysate conductivity and dialysate temperature sensors. A sensor manifold may include other types of sensors. Examples of such embodiments may include systems and methods for the diagnosis treatment or amelioration of various medical conditions including embodiments of systems and methods involving the pumping metering measuring controlling and or analysis of various biological fluids and or therapeutic agents such as various forms of dialysis cardiac bypass and other types of extracorporeal treatments and therapies. Further examples include fluid treatment and preparation systems including water treatment systems water distillation systems and systems for the preparation of fluids including fluids used in diagnosis treatment or amelioration of various medical conditions such as dialysate.

Examples of embodiments of the inventions described herein may include dialysis systems and methods. More specifically examples of embodiments of the inventions described herein may include hemodialysis systems and methods of the types described in U.S. patent application Ser. No. 11 871 680 filed Oct. 12 2007 entitled Pumping Cassette or U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008 each of which is incorporated herein by reference.

In such systems and methods the utilization of one or more sensor manifolds may allow subject media to be moved from one environment to another environment that is more conducive to obtaining sensor readings. For example the cassette manifold may be contained in an area that is less subject to various types of environment conditions such as temperature and or humidity which would not be preferable for sensor apparatus such as a sensing probe. Alternatively sensing apparatus and sensing apparatus system may be delicate and may be more prone to malfunctions than other components of a system. Separating the sensor apparatus and the sensor apparatus systems from other components of the system by use of a sensor manifold may allow the sensing apparatus and sensing apparatus systems to be checked calibrated repaired or replaced with minimal impact to other components in the system. The ability to check calibrate repair or replace the sensor manifold with minimal impact to the remainder of the system may be advantageous when utilized in connection with the integrated cassette systems and methods described in U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008. Alternatively the sensor manifold may be replaced either more or less frequently than other components of the system.

With reference to various embodiments of an exemplary sensor manifold are shown. One or more subject media e.g. a liquid in these exemplary embodiments may be contained in or flow through cassette manifold . For example one subject media may enter cassette manifold via pre molded tube connector and exit the cassette manifold via pre molded tube connector . Between tube connector and there is a fluid path though the cassette best shown as fluid path in . Likewise fluid paths shown as fluid paths and respectively in extend between sets of tube connectors and and and and and and . In certain embodiments each fluid path may contain subject media of different composition or characteristics. In other embodiments one or more fluid paths may contain the same or similar subject media. In certain embodiments the same subject media may be flowed through more than one flow path at the same time to check and or calibrate the sensor apparatus systems associated with such fluid paths.

Referring now to in these exemplary embodiments of sensor manifold that may be used in conjunction with the sensor apparatus and sensor apparatus systems described herein the cassette includes a top plate and a base . Fluid paths such as the fluid path as shown in extending between tube connectors and extend between the base and top plate. The cassettes may be constructed from a variety of materials. Generally in the various exemplary embodiment the materials used are solid and non flexible. In the preferred embodiment the plates are constructed of polysulfone but in other embodiments the cassettes are constructed of any other solid material and in exemplary embodiments of any thermoplastic. Some embodiments of sensor manifold may be fabricated utilizing the systems and methods described in U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008.

Referring again to in these exemplary embodiments of sensor manifolds that may be used in conjunction with the sensor apparatus and sensor apparatus systems described herein the sensor manifold may also include printed circuit board PCB and a PCB cover . Various embodiments may also include connector also shown in which may be utilized to mechanically connect the cassette manifold to the system such as a hemodialysis system. Cassette manifold may also utilize various methods to hold the layers of sensor manifold together as a unit. In various embodiments as shown in connectors also shown in which in one embodiment is a screw but in other embodiments may be any means for connection are utilized but any means known to one of skill in the art such as other types of screws welds clips clamps and other types of chemical and mechanical bonds may be utilized.

Referring now to in exemplary embodiments of the sensor manifold tube connectors such as tube connector is utilized to bring subject media into or remove subject media from fluid path . Sensing probes such as sensing probe extending into fluid path are incorporated into sensor manifold so as to determine various properties of the subject media contained in or flowing through the particular fluid path in the sensor manifold. In various embodiments one sensing probe may be utilized to sense temperature and or other properties of the subject media. In another embodiment two sensing probes may be utilized to sense temperature and or conductivity and or other properties of the subject media. In yet further embodiments three or more sensing probes may be included. In some embodiments one or more combination temperature and conductivity sensing probes of the types generally described herein may be utilized. In other embodiments the conductivity sensors and temperature sensor can be any conductivity or temperature sensor in the art. In one embodiment the conductivity sensor elements or sensor leads are graphite posts. In other embodiments the conductivity sensors elements are posts made from stainless steel titanium or any other material of the type typically used for or capable of being used for conductivity measurements. In certain embodiments the conductivity sensors will include an electrical connection that transmits signals from the sensor lead to a sensor mechanism controller or other device. In various embodiments the temperature sensor can be any of the temperature sensors commonly used or capable of being used to sense temperature.

Referring again to sensing probe is electrically connected to PCB . In certain embodiments an electrically conductive epoxy is utilized between sensor element and PCB to ensure appropriate electrical connection although other methods known to those of skill in the art may be used to obtain an appropriate electrical connection between sensor element and PCB . PCB is shown with edge connector . In various embodiments edge connector may be used to transmit sensor information from cassette manifold to the main system. Edge connector may be connected to a media edge connector such as media edge connector shown in . In various embodiments media edge connector may be installed in a hemodialysis machine not shown . In such embodiments guide tracks and as shown in may be utilized to assist in the connection of edge connector and media edge connector . Various embodiments may also include connector as shown in which may be utilized to mechanically connect the cassette manifold to the system such as a hemodialysis system.

Referring again to air trap is shown. In certain embodiments an air trap such as air trap may be utilized to trap and purge air in the system. As may be best shown in subject media may flow through fluid path between tube connectors and in sensor manifold . As the flow of the subject media is slowed around the turn in fluid path near tube connector air may be removed from the subject media through connector .

Referring now to PCB cover is shown. PCB cover may be connected to sensor manifold by connectors . Edge connector is also shown.

In accordance with certain embodiments sensor manifold is passive with respect to control of the fluid flow. In such embodiments sensor manifold does not contain valves or pumping mechanisms to control the flow of the subject media. In such embodiments the flow of the subject media may be controlled by fluid control apparatus external to sensor manifold . In other embodiments the sensor manifold may include one or more mechanical valves pneumatic valves or other type of valve generally used by those of skill in the art. In such embodiments the sensor manifold may include one or more pumping mechanisms including pneumatic pumping mechanisms mechanical pumping mechanisms or other type of pumping mechanisms generally used by those of skill in the art. Examples of such valves and pumping mechanisms may include the valves and pumping mechanisms described in U.S. patent application Ser. No. 11 871 680 filed Oct. 12 2007 entitled Pumping Cassette or U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008.

Referring now to tube connector is shown in base . Top plate is shown along with connector . Sensing probes such as sensing probe extend through top plate into fluid path . Sensing probe may be various types of sensors including the embodiments of sensing probes generally discussed herein.

The sensing probes such as sensing probe may be all the same may be individually selected from various sensors based on the type of function to be performed or the same probe may be individually modified based on the type of function to be performed. Similarly the configuration of the fluid paths such as the length of the fluid path and the shape of the fluid path may be selected based on the function to be performed. By way of example to detect the temperature of the subject media in a fluid path a temperature sensor such as a thermistor may be used. Again by way of example to measure the conductivity of the subject media one sensing probe configured to measure temperature and conductivity and one sensing probe configured only to measure conductivity may be utilized. In other embodiments two or more sensing probes configured to measure both temperature and conductivity may be utilized. In various embodiments of such configurations by way of example the second temperature sensor may be present but not utilized in normal operation or the second temperature may be utilized for redundant temperature measurements or the or the second temperature may be utilized for redundant temperature measurements.

Referring again to PCB is shown with electrical connection . As further shown in PCB is shown with electrical connection for connection to a sensing probe shown as in . PCB also contains opening for attachment to top plate shown as in . In certain embodiments electrical connection is mounted onto or manufactured with PCB with air gap . In such embodiments air gap may be utilized to provide protection to the electrical connection between sensing probe and PCB by allowing shrinking and expansion of the various components of sensor manifold with lesser impact to PCB .

Referring again to PCB is also shown with edge connector . As described herein edge connector may interface with edge connector receiver which may be connected to the system such as the hemodialysis system to which sensor manifold interfaces.

Various embodiments of exemplary sensor manifold shown in may be utilized in conjunction with hemodialysis systems and methods described in U.S. patent application Ser. No. 11 871 680 filed Oct. 12 2007 entitled Pumping Cassette or U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008. In certain embodiments sensor manifold contains all of the temperature and conductivity sensors shown in . depicts a fluid schematic in accordance with one embodiment of the inventions described in the patent applications reference above.

By way of example in various embodiments the temperature and conductivity of the subject media at position as shown in may be determined utilizing sensor manifold . In such embodiments subject media flows into tube connector as shown in through fluid path as shown in and exits at tube connector as shown in . The conductivity of the subject media is measured by two sensing probes not shown extending into fluid path at least one of which has been configured to include a temperature sensing element such as a thermistor. The conductivity measurement or the temperature measurement of the subject media may be utilized to determine and or correlate a variety of information of utility to the hemodialysis system. For example in various embodiments at position in the subject media may be comprised of water to which a bicarbonate based solution has been added. Conductivity of the subject media at position may be utilized to determine if the appropriate amount of the bicarbonate based solution has been added prior to position . In certain embodiments if the conductivity measurement deviates from a predetermined range or deviates from a predetermined measurement by more than a predetermined amount then the subject media may not contain the appropriate concentration of the bicarbonate based solution. In such instances in certain embodiments the hemodialysis system may be alerted.

Again by way of example in various embodiments the conductivity of the subject media at position as shown in may be determined utilizing sensor manifold . In such embodiments subject media flows into tube connector as shown in through fluid path as shown in and exits at tube connector as shown in . The conductivity of the subject media is measured by two sensing probes not shown extending into fluid path at least one of which has been configured to include a temperature sensing element such as a thermistor. The conductivity measurement or the temperature measurement of the subject media may be utilized to determine and or correlate a variety of information of utility to the hemodialysis system. For example in various embodiments at position in the subject media may be comprised of water to which a bicarbonate based solution and then an acid based solution has been added. Conductivity of the subject media at position may be utilized to determine if the appropriate amount of the acid based solution and the bicarbonate based solution in a previous step has been added prior to position . In certain embodiments if the conductivity measurement deviates from a predetermined range or deviates from a predetermined measurement by more than a predetermined amount then the subject media may not contain the appropriate concentration of the acid based solution and the bicarbonate based solution. In such instances in certain embodiments the hemodialysis system may be alerted.

By way of further example in various embodiments the temperature and conductivity of the subject media at position as shown in may be determined utilizing sensor manifold . In such embodiments subject media may flow into or out of tube connector as shown in through fluid path as shown in and may flow into or out of tube connector as shown in . As described herein air may be removed from the subject media as it moves past the turn in fluid path . In such instances a portion of the subject media may be removed through tube connector to the drain bringing with it air from the air trap. The conductivity of the subject media is measured by two sensing probes not shown extending into fluid path at least one of which has been configured to include a temperature sensing element such as a thermistor. The conductivity measurement or the temperature measurement of the subject media may be utilized to determine and or correlate a variety of information of utility to the hemodialysis system. For example in various embodiments the conductivity measurement at position in may be utilized to correlate to the clearance of the dialyzer. In such instances in certain embodiments this information may then be sent to the hemodialysis system.

Again by way of further example in various embodiments the temperature of the subject media at position as shown in may be determined utilizing sensor manifold . In such embodiments subject media flows into tube connector as shown in through fluid path as shown in and exits at tube connector as shown in . The temperature of the subject media is measured by one or more sensing probes not shown extending into fluid path . The temperature measurement of the subject media at position may be utilized to determine and or correlate a variety of information of utility to the hemodialysis system. For example in various embodiments at position in the temperature of the subject media is determined down stream of a heating apparatus . If the temperature deviates from a predetermined range or deviates from a predetermined measurement by more than a predetermined amount then the hemodialysis system may be alerted. For example in certain embodiments the subject media may be re circulated through the heating apparatus until the temperature of the subject media is within a predetermined range.

Again by way of further example in various embodiments the temperature and conductivity of the subject media at position as shown in may be determined utilizing sensor manifold . In such embodiments subject media flows into tube connector as shown in through fluid path as shown in and exits at tube connector as shown in . The conductivity of the subject media is measured by two sensing probes not shown extending into fluid path at least one of which has been configured to include a temperature sensing element such as a thermistor. The conductivity measurement or the temperature measurement of the subject media may be utilized to determine and or correlate a variety of information of utility to the hemodialysis system. For example the temperature and conductivity measurement at position may be used as a further safety check to determine if the temperature conductivity and by correlation the composition of the subject media is within acceptable ranges prior to the subject media reaching the dialyzer and thus the patient. In certain embodiments if the temperature and or conductivity measurement deviates from a predetermined range or deviates from a predetermined measurement by more than a predetermined amount then the hemodialysis system may be alerted.

For the various embodiments described herein the cassette may be made of any material including plastic and metal. The plastic may be flexible plastic rigid plastic semi flexible plastic semi rigid plastic or a combination of any of these. In some of these embodiments the cassette includes one or more thermal wells. In some embodiments one or more sensing probes and or one or more other devices for transferring information regarding one or more characteristics of such subject media are in direct contact with the subject media. In some embodiments the cassette is designed to hold fluid having a flow rate or pressure. In other embodiments one or more compartments of the cassette is designed to hold mostly stagnant media or media held in the conduit even if the media has flow.

In some embodiments the sensor apparatus may be used based on a need to separate the subject media from the sensing probe. However in other embodiments the sensing probe is used for temperature conductivity and or other sensing directly with subject media.

Another aspect of the invention is generally directed to methods and operations of the systems as discussed herein. For instance a hemodialysis system may be primed flow balanced emptied purged with air disinfected or the like.

One set of embodiments is generally directed to priming of the system with a fluid. The fluid to be primed is first directed to a dialysate tank e.g. dialysate tank . Ultrafilter is then first primed by pushing fluid from dialysate tank to ultrafilter and caused to exit line through waste line to the drain as is shown by the heavy black lines in . Any air present in ultrafilter naturally rises to the priming port and is flushed to the drain.

Next as is shown in the balancing circuit and pump of the directing circuit are primed by pushing fluid through the ultrafilter through the balancing circuit and out to the drain. Pump is primed by running fluid forwards through the ultrafilter to the drain . Air entering dialyzer bubbles to the top of the dialyzer and leaves through the dialyzer exit to the drain.

Next the blood flow pump and tubing are primed by circulating fluid through the blood flow circuit and the air trap back to the directing circuit via conduit . As can be seen in fluid passes through the ultrafilter and dialyzer forcing flow through the air trap and down the drain. The air trap traps air circulating in the blood flow circuit and sends it to the drain. Priming can be stopped when the air sensors stop detecting air and some additional fluid has been passed through the system as a safety margin .

Another set of embodiments is directed to adding air to the system e.g. to empty the system of various fluids. For example in one operation the dialysate tank is emptied. Vent on dialysate tank is opened and pump is used to pump fluid from the dialysate tank to the drain until air is detected in pump discussed below . This is shown in .

Air may also be pumped into the balancing circuit in certain embodiments. This is shown in . Vent on dialysate is opened so that air may enter the dialysate tank. Pump is used to pump air through the outside of ultrafilter . This air pressure displaces fluid outside the ultrafilter to the inside then it flows through the dialyzer and down the drain. During this operation pump and the outside of the ultrafilter will fill with air.

In addition air can be drawn in through the anticoagulant pump into the blood flow circuit as is shown in . The air is first brought into pod pumps then may be directed from the pod pumps to the arterial line and down the drain or to the venous line through dialyzer and down the drain .

In one set of embodiments integrity tests are conducted. As the ultrafilter and the dialyzer may be constructed with membrane material that will not readily pass air when wet an integrity test may be conducted by priming the filter with water then applying pressurized air to one side of the filter. In one embodiment an air outlet is included on one of the blood flow pumps and thus the pumping chamber may be used to pump air for use in the integrity test. This embodiment uses the advantage of a larger pump. The air pressure pushes all of the water through the filter and the air flow stops once the water has been displaced. However if the air flow continues the membrane is ruptured and must be replaced. Accordingly the system is primed with water. First the mixing circuit is primed first to eliminate air prior to the dialysate tank. Then the outside of the ultrafilter is primed next as the ultrafilter will not pass water to the balancing circuit until the outside is primed. The balancing circuit and the dialyzer are primed next. Finally water is pushed across the dialyzer to prime the blood flow circuit.

The mixing circuit is primed by first pushing water with pump through line and bicarbonate source then through each of the pumps and through line to dialysate tank . Dialysate tank is vented so air that is pushed through bubbles to the top and leaves through vent . Once air has been primed out of dialysate tank the tank is filled with water then the priming flow continues from the dialysate tank through ultrafilter to the drain. This can be seen in . Water is then primed as previously discussed see . Next the blood flow pod pumps are filled with water from dialysate tank as is shown in while balancing pumps are emptied as is shown in .

The test is conducted by using the blood flow pump to push each chamber of water across dialyzer to balancing pump chambers which start empty and are vented to the atmosphere so that they are present at atmospheric pressure on the dialysate side of dialyzer . See . Each of the blood flow circuit chambers delivers using a specific pressure and the end of stroke is determined to determine the flow rate.

Another integrity test is the ultrafilter flow test. In this test the dialysate tank is filled with water the ultrafilter is primed by pumping water from the dialysate tank through the ultrafilter and out line and water is pumped through the ultrafilter controlling flow rate monitoring the delivery pressure required to maintain flow.

Another set of embodiments are directed to disinfection and rinsing of the system. This process removes any material which may have accumulated during therapy and kills any active pathogens. Typically heat is used although in some cases a disinfectant may be added. Water is maintained using the dialysate tank and replenished as necessary as water is discharged.

A recirculating flow path is shown in . The flow along this path is essentially continuous and uses conduits to connect the blood flow circuit with the directing circuit. The main flow path is heated using heater which is used to increase the water temperature within the recirculating flow path e.g. to a temperature that can kill any active pathogens that may be present. Most of the water is recirculated although some is diverted to drain. Note that lines and are kept open in this example to ensure that these lines are properly disinfected. In addition the flow paths through ultrafilter can be periodically selected to purge air from the ultrafilter and or to provide recirculating flow through this path. Temperature sensors e.g. sensors and can be used to ensure that proper temperatures are met. Non limiting examples of such sensors can be seen in U.S. patent application Ser. No. 12 038 474 entitled Sensor Apparatus Systems Devices and Methods filed on Feb. 27 2008 and incorporated herein by reference.

In one set of embodiments the ingredients of the mixing circuit may be primed as follows. Initially and as shown schematically in a mix water pod pump is filled with water which is pushed backwards through a bicarbonate pump and into a bottom of the bicarbonate source so that air is expelled from the top of bicarbonate source and into a line leading to a bicarbonate water supply pump . As a result air in the bicarbonate source is collected in the bicarbonate water supply pump . See . The air in pump is then transferred to the mix water pump which moves the air into the line toward the dialysate tank . See . Air pushed by the mix water pump may be moved into the dialysate tank where a vent in the dialysate tank is opened to release the air from the system or the air can be pushed toward the drain through suitable valve control. See . The process of moving water backwards from the mix water pump through the bicarbonate pump the bicarbonate source the bicarbonate water supply pump and to the mix water pump may be repeated as many times as necessary to remove air from the flow path and thoroughly wet the bicarbonate supply as needed. Also by pushing the air and priming liquid from the mix water pump to the drain instead of the dialysate tank the system may avoid adding improperly mixed bicarbonate water material to the tank .

With the bicarbonate supply and related circuitry the bicarbonate path primed in reverse the bicarbonate path may be primed in the forward direction. That is water may be moved by the bicarbonate water supply pump into the bicarbonate source through the bicarbonate pump and to the mix water pump as needed to remove any remaining air and prepare the bicarbonate path for providing bicarbonate at a suitable concentration to the water mix pump for dialysate preparation. Liquid delivered to the water mix pump during forward priming of the bicarbonate path may be directed by the pump to the drain .

To prime the acid path i.e. the circuit portion including the acid supply and the acid pump the acid pump may be operated to deliver liquid to the mix water pump which can subsequently direct the priming liquid to the drain . See . This can be repeated as necessary until the acid path is suitably primed. Typically the acid supply will be in liquid form ready for use unlike the bicarbonate supply but if not the mix water pump can be used to direct water in reverse direction through the acid pump and into the acid supply . Any needed air venting may be performed at the acid supply e.g. through a valve or opening in an acid container. After priming is complete the mix water pump may direct water through the line to drain to clear the line and other components of any remaining air or other materials.

The acid and bicarbonate solutions and sodium chloride solution if a separate sodium chloride source is present are then metered with incoming water to prepare the dialysate. Sensors and are used to ensure that the partial mixtures of each ingredient with water is correct. Dialysate that does not meet specification is emptied to the drain while good dialysate is pumped into dialysate tank .

As discussed above in the context of D D E and B the present invention in certain embodiments provides methods and control systems configured for making dialysate in system from a water supply and one or more supplies of concentrated sources of solutes e.g. bicarbonate source and acid source . Described below are exemplary embodiments for implementing and controlling such methods the incremental assembly of the dialysate to ensure that the specifications on concentration remain within acceptable quality criteria.

Referring to mixing circuit of in certain embodiments a hemodialysis system of the invention is configured to make dialysate for hemodialysis therapy using standard commercially available 45 acid concentrate e.g. from acid concentrate supply . In other embodiments any of a variety of other standard or custom recipes may be implemented using the methods described herein. Sodium bicarbonate is drawn from a flow through cartridge e.g. a Baxter Altracart cartridge or similar . Essentially pure water is pumped into the top of this cartridge and concentrated solution is drawn from the bottom. The strength of the concentrated solution varies with the temperature of the cartridge and may also be affected by any channeling through the powder that develops while the cartridge is in use.

Water is drawn into the mixing water pump . The concentrated sodium bicarbonate solution is metered into the water stream by the bicarbonate pump as the chamber of pump is filling. This gives the water bicarb mixture a chance to mix in the pumping chamber. This partial mixture of water and sodium bicarbonate is pumped out of the pump and through the conductivity measurement cell for conductivity measurement. The target conductivity of this partial mixture in one embodiment is approximately 3.7 mS cm so in such an embodiment conductivity measurement cell may be optimized for measurements near this value. The acid pump then meters acid concentrate solution e.g. 45 acid concentrate into the partial mixture. This flow proceeds through mixing chamber and then to the conductivity measurement cell . The final conductivity to yield a target dialysate concentration in one embodiment is approximately 14 mS cm so for such an embodiment the conductivity measurement cells for measuring dialysate conductivity e.g. cells and see e.g. may be optimized for measurements near this value.

In certain embodiments because the conductivity measurement cells and measure solutions that may not be homogenous there still may be significant variations in concentration of the solutions as they pass through these sensors to get a more accurate value for the conductivity a plurality of individual measurements are taken and these measurements are averaged at high speed e.g. 200 Hz only while the solution is flowing through the conductivity measurement cells. The resulting averaged measurement has been found to correlate well with a measurement obtained by collecting the solution in a container and mixing it thoroughly prior to measuring conductivity.

Because the conductivity of these solutions may be highly dependent on temperature e.g. changing about 2 per degree C. in certain embodiments to improve the accuracy of conductivity measurements a temperature correction may be applied. In certain cases the effect of temperature change on change in measured conductivity is almost linear but the nonlinear characteristic may in certain cases be significant enough that a second or third order curve fit of conductivity vs temperature data may provide a significant benefit in the context of performing temperature correction. In certain embodiments two conductivity vs temperature curves are utilized one for correction of conductivity measurements of the sodium bicarbonate solution and another for conductivity measurements of the final dialysate solution. These corrections may be expressed as a multiplier to be chosen based on temperature. By convention conductivity is normally expressed at 25 C. The correction curves thus may be constructed to yield a value of 1.0 for 25 C with a correction factor other than 1.0 at different measurement temperatures. The correction factors derived from the curves for the bicarbonate solution correction and the dialysate correction can be slightly different due to the different compositions but they both vary in typical embodiments from about 0.6 at 5 C to about 1.3 at 40 C.

Conductivity is a strong function of the ion density in solution so the amount of sodium bicarbonate in the first solution and the amount of sodium chloride and other ions in the final solution may be inferred or directly determined from conductivity measurements if desired in certain embodiments. Like the temperature corrections the relationships between measured conductivity and solute concentration may be nearly linear but the non linear characteristic may be significant enough that a second or third order curve fit of conductivity vs. concentration data to use as a correlation standard may provides a significant benefit in determining concentrations from measured conductivity data.

The desired amount of sodium bicarbonate in the final dialysate may be specified in grams per liter or equivalently milligrams per milliliter . To compute the compositions from conductivity the conductivity measurement made by sensor may first be corrected for temperature as described above and then the composition may be computed using the conductivity vs. concentration data curve fits described above. The determination of an actual concentration from conductivity data can be beneficial for certain embodiments for at least two reasons it puts the composition into the correct units for concentration allowing the controller to focus on the relevant measurement and it facilitates prediction of the composition on a pump stroke by pump stroke basis which can facilitate a safety check that prevents off spec dialysate from being added to the dialysate tank as described in more detail below . The acid concentrate contains multiple ingredients with sodium chloride being the dominant contributor to the additional conductivity. With the sodium bicarbonate already in solution at measurement cell the relevant conductivity measurement for determining just the contribution of the added acid concentrate is the difference between the conductivity measured by sensor and the conductivity of the bicarbonate mixture measured by sensor .

In certain embodiments a control system for controlling mixing and production of the dialysate may be configured and implemented as described below. An inner control loop may be configured to operate the pumps to deliver the concentrated solutions into the mix stream e.g. to mixing chamber . At this control level the target mix fractions may be specified in the target number of pump strokes of each concentrate to be added for each water pump stroke. For each water pump stroke the meter pumps may deliver the closest integer number of strokes to the respective target number and carry the leftover fraction forward to the next water pump stroke. This can allow the control system to adjust the ratios as floating point quantities even though they are implemented as integers.

In certain embodiments a control system may be configured so that the conductivity measurements are used as the primary guidance function to make dialysate that meets a dialysate concentration quality control criteria e.g. is within an acceptable range of concentration surrounding a prescription recipe. The strength of the concentrated ingredients may vary somewhat during the therapy. The stroke volume delivered by the water pump may vary from stroke to stroke to a degree. Volume metering via use of conductivity feedback can ensure that these effects are mitigated and the dialysate comes out as close to the specified composition as possible or desirable. A bicarbonate control loop of the overall control protocol may be provided that uses the composition of the sodium bicarbonate partial mixture determined as described above as the an input measurement and determined the number of strokes of the bicarbonate pump per stroke of the water pump for subsequent dialysate mixing as its output. Similarly an acid concentrate control loop may be configured to use the measured conductivity change as a result of adding the acid as described above as the input measurement and the number of strokes of the acid pump per stroke of the water pump for subsequent dialysate mixing as its output.

The control loops described above can be configured to correct for and handle routine variations in pump delivery volume reagent concentration etc. that may affect the dialyate composition. Additional safety features may be configured into the system design and or control system to mitigate account for significant disturbances and special circumstances that could lead to substantially off spec dialysate. The dialysate stored in the tank must be within a certain percentage of a target composition to ensure patient safety e.g. in one embodiment the dialysate is maintained within 2.5 of the prescription target composition at all times. For example with such a safety criteria for an exemplary embodiment in which one complete stroke of the water pump is 50 ml and the minimum volume of dialysate maintained in the dialysate tank is 1 liter i.e. a pump stroke volume in such case is 1 20 or 5 of the minimum one liter volume in the tank one stroke of pure water inadvertently added to the tank could pull the dialysate composition off spec by 5 . To prevent such an occurrence from happening the tubing hold up volume between conductivity sensor and the valve positioned just upstream of the dialysate tank e.g. valve in is sized to hold a complete stroke of the mixing water pump . In general if the measured composition of any stroke is determined by to be off spec by enough to compromise the acceptability of the concentration of dialysate in the tank should it be added to the tank that stroke is diverted to drain e.g. in .

In one particular example the following three safety checks are performed by the system and must all succeed before adding newly mixed dialysate to the tank 1 the mix composition for the stroke bolus being measured as determined by conductivity measured by sensor must approximately match the target stroke composition for the volume of water and concentrate added since as described above in certain embodiments these quantities are quantized to full strokes the target composition of a given stroke may be significantly different than the prescribed composition of the dialysate in the dialysate tank 2 the running average composition for the previous 20 mixing strokes 1 liter for a pump stroke volume of 50 ml must be within an acceptable percentage of the target prescription dialysate composition e.g. within 2 and 3 the calculated projected composition of dialysate in the tank after adding the newly mixed but not yet added stroke bolus must be within an acceptable percentage of the target prescription dialysate composition e.g. within 2 .

The control and safety system may also be configured in certain embodiments to prevent hazards created by certain user error. For example for embodiments in which conductivity is used as a parameter to determine solute concentration in mixed dialysate there is a risk that a user mistakenly use a container that does not contain the proper acid concentrate called for in the therapy and expected by the system e.g. 45 acid concentrate and attempt to start a therapy with such incorrect reagents. With an unlimited conductivity feedback system there is a significant risk that whatever material is drawn into mixing circuit could be mixed with water to make the expected conductivity for dialysate. To minimize the possibility of this happening the control system may be configured to enforce pre set limits on the water acid concentrate mixing ratio. Both the pump and the acid concentrate pump are in preferred embodiments reasonably accurate volumetric pumps. The pre set limits on the water acid concentrate mixing ratio may be chosen to facilitate therapy in the face of normal variations while prohibiting therapy if it appears that the acid concentrate is not that called for by the therapy protocol e.g. standard 45 concentrate .

In another set of embodiments the anticoagulant pump is primed. Priming the pump removes air from the heparin pump and the flow path and ensures that the pressure in the anticoagulant vial is acceptable. The anticoagulant pump can be designed such that air in the pump chamber flows up into the vial. The test is performed by closing all of the anticoagulant pump fluid valves measuring the external volume charging the FMS chamber with vacuum opening valves to draw from the vial into the pumping chamber measuring the external volume again charging the FMS chamber with pressure opening the valves to push fluid back into the vial and then measuring the external volume again . Changes in external volume that result from fluid flow should correspond to the known volume of the pumping chamber. If the pumping chamber cannot fill from the vial then the pressure in the vial is too low and air must be pumped in. Conversely if the pumping chamber cannot empty into the vial then the pressure in the vial is too high and some of the anticoagulant must be pumped out of the vial. Anticoagulant pumped out of the vial during these tests can be discarded e.g. through the drain.

In yet another set of embodiments the system is rinsed with dialysate while the patient is not connected. This can be performed before or after treatment. Prior to treatment dialysate may be moved and a portion sent to the drain to avoid accumulating sterilant in the dialysate. After treatment this operation rinses the blood path with dialysate to push any residual blood to the drain. The flow paths used in this operation are similar to the flow paths used with water as discussed above.

Acid concentrate may be pumped out of the mixing chamber. Pump is activated so that pod pump can draw out acid from pump and acid source to be mixed in line and sent to the drain. Similarly bicarbonate may be pumped out of the mixing chamber as is shown in . Pump is used to draw water from bicarbonate source then pod pump is used to pass the water into line to the drain.

In still another set of embodiments dialysate prime is removed from the blood flow circuit to avoid giving the patient the priming fluid. show fluid leaving each of the balancing pump chambers and being expelled to the drain. Next the dialysate side of dialyzer is closed while blood is drawn into the blood flow path from the patient . The patient connections are then occluded while the blood flow pump chambers push the priming fluid across the dialyzer to the balancing circuit . This fluid is then pushed to drain as previously discussed. This operation can be repeated as necessary until sufficient priming fluid has been removed. Afterwards the balancing pumps are then refilled with fresh dialysate keeping the patient connections occluded as is shown in .

In yet another set of embodiments a bolus of anticoagulant may be delivered to the patient. Initially a bolus of anticoagulant is pumped from the vial or other anticoagulant supply to one chamber of pump as is shown in . The anticoagulant pump alternates between pumping air into the vial and pumping anticoagulant out of the vial thereby keeping the pressure relatively constant. The remaining volume is then filled with dialysate . The combined fluids are then delivered to the patient down arterial line as shown in . In some cases the same pump chamber may be refilled with dialysate again see and that volume delivered to the patient also to ensure that all of the anticoagulant has been properly delivered.

If air is detected by the air in line detector during the arterial bolus delivery the bolus may be delivered via the venous line see . The air detected in the arterial line may be pulled back into the pump chamber along with the heparin bolus. The heparin bolus may next be sent to the patient by delivering the chamber containing heparin in pump toward the dialyzer followed by delivering the 2chamber of pump toward the dialyzer. The heparin bolus and dialysate then flow through the air trap to remove the air and past the venous air in line detector to the patient. The path from the pump to the patient via the venous line has a larger hold up volume. The heparin bolus may be flushed into the patient with additional dialysate delivered from the outer dialysate pump through the dialyzer .

In still another set of embodiments the system may perform push pull hemodiafiltration. In such cases blood flow pump and balancing pumps can be synchronized to pass fluid back and forth across the dialyzer. In hemodiafiltration hydrostatic pressure is used to drive water and solute across the membrane of the dialyzer from the blood flow circuit to the balancing circuit where it is drained. Without wishing to be bound by any theory it is believed that larger solutes are more readily transported to the used dialysate due to the convective forces in hemodiafiltration.

In one set of embodiments solution infusion may be used to delivery fluid to the patient. As is shown in pump in the directing circuit is used to push fluid across dialyzer into the blood flow circuit which thus causes delivery of fluid e.g. dialysate to the patient.

According to another set of embodiments after repeated use the dialyzer can lose its efficiency or even the ability to function at all as a result of compounds adhering to and building up on the membrane walls in the dialyzer. Any standard measure of dialyzer clearance determination may be used. However as noted below in certain embodiments inventive methods of determining dialyzer clearance may be employed.

In one aspect the invention involves methods for measuring the clearance of a dialyzer in a hemodialysis system to determine if the dialyzer has degraded to the point where it should no longer be used. While the inventive methods for determining the clearance of a dialyzer are described herein in the context of the illustrated blood treatment systems and methods described herein in the context of other aspects of the present invention the inventive methods of determining a measure of dialyzer clearance are not limited to use only with the presently described systems and could be employed in essentially any hemodialysis system using a membrane based dialyzer. Also described below are inventive data reduction methods for determining a dialyzer clearance parameter related to a measured small molecule e.g. ion clearance of a dialyzer and for determining an equivalent urea clearance of the dialyzer from such data. In certain embodiments the dialyzer clearance measurement is determined by measuring the passage of ions in solution through the semipermeable membrane s separating a blood side of the dialyzer from a dialysate side of the dialyzer. Conveniently the ions in solution used for such methods may be the same as those present in the acid concentrate contained in acid concentrate source used to form dialysate during operation of the system for treatment protocols. In certain embodiments such as described below acid concentrate source is used as the source for the ions whose passage through the dialysis membrane is determined. The acid concentrate typically comprises an aqueous solution of electrolytes NaCl CaCl and other salts at a concentration several times e.g. 40 45 concentrated over that of the dialysate that is used for treatment. Na and Cl are the major ions in solution that contribute to the measurements made in the methods described herein for determining dialyzer clearance however in typical embodiments described below it is the total ion clearance that is measured. In other embodiments specific ions such as Na or any other ion choice may be added individually in solution for measurement of specific ion clearance if desired. Described below are several exemplary embodiments of inventive dialyzer clearance measurement techniques which are useful in the context of the present hemodialysis system and which also may be used in other hemodialysis systems and methods not specifically described herein.

In certain embodiments in one method of measuring how much build up has accumulated on the dialyzer membrane i.e. how much the dialyzer s clearance has deteriorated a gas is urged into the blood side of the dialyzer while a liquid is held on the dialysate side of the dialyzer. By measuring the volume of gas in the dialyzer the clearance of the dialyzer may be calculated based on the volume of gas measured in the dialyzer.

Alternatively in another embodiment because of the pneumatic aspects of the present system clearance may be determined as follows. By applying a pressure differential along the dialyzer membrane and measuring the flow rate of liquid through the membrane i.e. flux of the dialyzer the clearance of the dialyzer may then be correlated determined or calculated based on the pressure differential and the flow rate. For example based on a known set of correlations or pre programmed standards including a correlation table or mathematical relationship. For example although a look up table may be used or a determined mathematical relationship may also be used.

The dialyzer s clearance can also be measured using a conductivity probe in the blood tube plug back recirculation path and or in the dialysate flow pathway. After treatment the patient connects the blood tubes back into the disinfection ports. The fluid in the blood tubes and dialyzer may be recirculated through these disinfection port connections and the conductivity of this solution may be measured as it passes through the conductivity measurement cell in this recirculation path. Various implementation examples of this method are described in more detail below.

To measure the dialyzer clearance in certain embodiments substantially pure water may be circulated through the dialysate path and the conductivity of the fluid flowing through the blood recirculation path may be continuously monitored. The pure water takes ions from the solution in the blood flow circuit recirculation path at a rate which is proportional to the concentration gradient and the clearance of the dialyzer. The clearance of the dialyzer may be determined by measuring the rate at which the conductivity of the solution in the blood flow circuit recirculation path changes and or by measuring the rate at which the conductivity of the solution in the dialysate flow path changes.

In certain embodiments the dialyzer s clearance can be measured by circulating pure water on one side and dialysate on the other and measuring the amount of fluid passing through the dialyzer using conductivity.

In certain embodiments and advantageously a hemodialysis system of the present invention is configured to test small molecule clearance e.g. ion clearance of a dialyzer of the system prior to each usage of the system for a therapy treatment protocol. The dialyzer clearance test may be conducted after a user of the system provides new acid and bicarbonate concentrates for an upcoming therapy and while the blood tubes of the blood tubing set are still plugged into the disinfection ports on the dialyzer machine e.g. at a point in which the blood flow tubing is interconnected with the directing circuit via conduit see e.g. .

In certain embodiments the method for measuring the clearance of the dialyzer involves creating flow of one liquid through the blood flow circuit pathway of the hemodialysis system while creating a flow of a second liquid through the dialysate flow circuit pathway. In certain embodiments small molecules such as ions or salts yielding ions in solution are added to either or both of the liquids in the blood flow pathway and the dialysate flow pathway to create a time varying change in the ionic strength of the liquid on one side of the dialysis membrane with respect to the other side. The liquid may then be pumped through the dialyzer and a parameter indicative of the concentration of ions in either or both of the liquid circulating through the blood flow path and the dialysate flow path may be measured to enable determination of the clearance of the dialyzer.

In certain such embodiments the ions are added only to one of the liquid flow pathways i.e. either to the liquid flowing in the blood flow pathway or the liquid flowing in the dialysate flow pathway while essentially pure water is initially added to and circulated in the other flow pathway. In such embodiments the measurement of the conductivity of the liquid in either or both of the blood flow pathway and dialysate flow pathway can provide a measure of the passage of ions across the dialysis membrane from the flow path to which the ions have been added to the flow path initially charged with essentially pure water. Although conductivity is a convenient means to determine a measure of the ionic strength of the liquid in the liquid flow pathway s for determination of dialyzer clearance it should be understood that in other embodiments other measures of ion concentration could be used and or small molecules other than those that are ionic or charged species could be used for measurement of clearance.

In certain embodiments ions are added to one of the flow paths and the liquid of such flow path is pumped through the dialyzer in a manner such that there is a change in the ionic strength of the liquid flowing through the dialyzer over the time period in which the dialyzer clearance is determined. As described in more detail below in certain such embodiments a concentrated ion or salt containing solution may be added in one or more pulses or boluses to water supplied to such flow path of the system in order to create one or more boluses or pulses of liquid having a higher ionic strength flowing through such flow path to facilitate measurement of conductivity and determination of dialyzer clearance.

In certain embodiments for example for those described immediately above wherein the change such as a bolus or pulse of high ionic strength solution is added to a flow path of the system it may be desirable for such flow path to be configured to be non recirculating and pass through the dialyzer a single time. In certain such embodiments it may be further advantageous for the flow path in fluid communication with the other side of the dialysate membrane to be continuously recirculating. For example in one such embodiment the dialysate flow path is the one to which one or more pulses of high ionic strength solution are added e.g. by an acid concentrate source and the dialysate flow pathway is configured for once through flow through the dialyzer while the blood flow circuit is configured for continuous recirculation of liquid through the blood side of the dialyzer and is initially primed with essentially pure water as described in further detail below.

Advantageously in certain embodiments in which a change in ionic strength with time is created in the liquid flowing on at least one side of the dialyzer during measurement of clearance and especially in embodiments wherein one flow path is configured to be non recirculating while the flow path in communication with the opposite side of the dialyzer membrane is configured to be continuously recirculating conditions are created within the dialyzer wherein the ionic strength of the fluid on one side of the dialysis membrane with respect to the other side will change in magnitude with respect to time such that in certain embodiments ion passage through the dialysate membrane will during certain periods of the test move from the dialysate flow pathway across the membrane to the blood flow pathway while during other periods of the test will move from the blood flow pathway across the dialysate membrane to the dialysate flow pathway.

As mentioned above and as described in more detail below a convenient but not exclusive means for measuring small molecule e.g. ion clearance of the dialyzer membrane is afforded by measuring the conductivity of one or both of the liquid streams flowing in the dialysate flow pathway and the blood flow pathway during the course of the dialysate clearance measurement. Described below in a specific example employed in the context of an embodiment of the present dialysis system as illustrated for example in . In this exemplary embodiment conductivity measurements are made for both the liquid flowing through the dialysate flow pathway and the liquid flowing through the blood flow pathway and both sets of conductivity measurement data are used in determining dialyzer clearance. However in alternative embodiments conductivity could alternatively be measured only for one of the fluid pathways and or multiple measurements of conductivity could be made at different points in the fluid circuit than illustrated in the system shown in and . So long as the location and number of conductivity measurement points enables detection of a change in conductivity resulting from passage of ions across the dialysis membrane during the test such a configuration of measurement may be used in order to obtain a measure of dialyzer clearance. For example referring to in the specific exemplary protocol for determining dialyzer clearance discussed below conductivity of the liquid flowing in the blood side flow pathway of the dialysis system is measured at point by conductivity probe while conductivity of the liquid flowing in the dialysate flow pathway is measured at position by conductivity probe . In alternative embodiments more or fewer conductivity measurements could be made and or the conductivity probes could be differently positioned. For example in one alternative embodiment instead of using conductivity probe on the blood side circuit an additional conductivity probe on the dialysate flow circuit positioned downstream of dialyzer could be used to measure ion concentration of the liquid both entering and exiting dialyzer thereby providing a measure of the ions passing through the dialyzer membrane during the test.

The following is a description of one exemplary embodiment of an inventive conductivity based dialyzer clearance test according to the invention. Reference is made to which reproduces the embodiment of the dialysis system of with the fluid lines and equipment corresponding to the setup used for performing the dialyzer clearance test highlighted with thickened lines. In the figure the dialysate flow pathway is shown in solid lines while the blood flow pathway is shown in dashed lines. In summary in the present example flow pathways of the system are first primed with essentially pure water all the way through the blood set which is interconnected for recirculation at location as shown. The test is conducted while the dialysate and blood flow circuits contain liquid flowing at a specific flow rate which may be chosen to be similar to that used during dialysis treatment protocols e.g. between about 250 ml min 500 ml min in certain embodiments and in one particular example at about 350 ml min . In certain embodiments the flow rate of liquid through the dialysate flow circuit is maintained to be essentially the same as the flow rate recirculating in the blood flow circuit. During the test the conductivity of the liquid in the blood flow pathway is measured using conductivity probe while the conductivity of the liquid flowing in the dialysate flow pathway is measured using conductivity probe . During the test as is described in more detail below one or more pulses or boluses of higher conductivity dialysate are generated by the mixing circuit e.g. see and added to the liquid pumped through the dialysate flow circuit and the transfer of ions across the membrane in dialyzer to the blood side results in a corresponding pulse of higher conductivity fluid flowing through the blood flow circuit. After passage of the pulse the conductivity of the liquid returns toward lower values and may approach zero in certain instances as the liquid supplied by the mixing circuit switches from concentrated dialysate to water. The small molecule e.g. ion clearance of the dialyzer may be computed by analyzing a transfer function of ion passage from the dialysate side to the blood side of the dialyzer measured during passage of the pulse of higher conductivity liquid. The dialyzer clearance test may be used to verify that the dialyzer is capable of providing adequate clearance for additional therapy sessions in certain embodiments. Certain methods described herein measuring dialysate clearance based on conductivity measurements are useful in approximating urea clearance which is a clinically conventional means for determining and expressing dialyzer clearance. As described in more detail below one aspect of the present invention also involves techniques and algorithms for converting conductivity based dialyzer clearance measurements into estimated urea clearance determinations.

As noted previously in certain embodiments the dialyzer clearance test occurs prior to conducting a treatment protocol but after a user has connected the acid concentrate and bicarbonate reagents to the system. At this point in time the lines of the system typically will contain a certain amount of water with residual disinfectant and a certain amount of air. As an initial step water may be supplied to the system via water supply line see to fill the lines with water and prime both the dialysate flow pathway and the blood flow pathway as illustrated for example in and and described above in the context of those figures.

Water may be supplied via supply inlet to water pump and is pumped to the outer dialysate directing circuit to dialysate tank . The dialysate tank is filled and the water is pumped from the dialysate tank to the balancing circuit via pumps the water in transit passing through ultrafilter . The water then flows into dialyzer as shown and through the dialyzer to fill the dialyzer and to fill the remaining portions of the dialysate flow pathway as illustrated. During at least a portion of the prime sequence flow exiting the dialysate pathway via drain may be restricted to force water through the dialyzer membrane and into the blood flow pathway. The blood flow pathway may be initially directed to drain until it is completely primed with water and residual air and disinfectant has been removed. At the conclusion of the priming the dialyzer flow pathway is configured so that liquid entering the pathway makes a single loop around the dialysate flow circuit and exits the system via drain . By contrast the blood flow pathway is configured for continuous recirculation as illustrated. It should be understood that in alternative embodiments the blood flow pathway could be configured for non recirculating flow while the dialysate flow pathway is configured for recirculating flow or both flow pathways could be either recirculating or non recirculating. At the conclusion of the priming sequence all of the lines the dialysate tank ultrafilter and dialyzer should be completely filled with water and substantially free of air.

After priming with water the system can be prepared for performing the clearance test. In certain embodiments to reduce the degree of dilution of the high conductivity pulse added to the dialysate side fluid dialysate tank is emptied see e.g. and associated discussion for process to do so and then only partially refilled with water so that it contains enough water to perform the test but not so much to dilute the high concentration pulse s to an undesirable degree e.g. for an embodiment in which the dialysate tank has a capacity of about 2 liters it may be filled at this stage with 100 milliliters to a few hundred milliliters of water. A small portion of this liquid may prior to taking measurements be pumped to drain as illustrated in in order to re prime ultrafilter .

To perform the test the blood flow pathway is configured for continuous recirculation and the dialysate flow pathway is configured to pump once through to drain as described previously. In certain embodiments in which the blood flow pathway flow rate is matched to the dialysate flow pathway flow rate each of the pumps operating on the blood side and dialysate side circuits in the system e.g. pumps and are operated in concert to provide a desired matched flow rate on the dialysate side and blood side of dialyzer . In order to create the bolus es pulse s of high concentration dialysate during certain strokes of water pump acid from acid source is pumped into the dialysate flow pathway via acid pump described previously. For example in one particular embodiment the acid pump supplies 2 3 full strokes of acid concentrate for every 20 40 strokes of water supplied via water pump .

In certain embodiments the flow direction of the recirculating flow in the blood flow pathway is counter current to the flow direction of liquid in the dialysate flow pathway. In other embodiments the flow may be circulated in a co current fashion. The bolus es pulse s of high conductivity liquid formed by the mixing circuit passes to the outer dialysate directing circuit into partially filled dialysate tank and is pumped from there through dialyzer . During the pumping of the liquids through the dialysate side and blood side pathways during the test during each pump stroke of the aforementioned pumps utilized for creating fluid motion a plurality of conductivity measurements may be made by blood side conductivity probe and dialysate side conductivity probe and for each pump stroke the plurality of conductivity measurements e.g. 100 200 measurements may be averaged to produce an average conductivity for the particular pump stroke number. Such measurements continue to be made during some or all of the course of the testing.

In certain embodiments the test comprises passage of a single bolus pulse of high conductivity high ionic strength dialysate through the dialysate flow pathway the results of such a test are shown and described below in the context of . However in other embodiments multiple pulses may be added to create more complex conductivity versus time pump stroke number functions. In yet other embodiments instead of spiking the dialysate flow pathway with high concentration dialysate such addition of concentrated solution may be made to the blood side flow pathway instead of or in addition to spiking of the liquid circulating in the dialysate flow pathway. Accordingly if desired a wide variety of functional forms of conductivity versus time pump stroke number may be generated for analysis. For example in certain embodiments the conductivity versus time pump stroke number data may take the form of a sine wave or other periodic function.

An example of data generated by the above described exemplary dialysate clearance test in which a single bolus pulse of concentrated dialysate was passed through the dialysate flow pathway and dialyzer against a recirculating blood flow pathway containing water is shown in . The graph in this figure plots the measured conductivity versus pump stroke number which correlates to the time of measurement and the total volume that has passed through the dialyzer during the test. Each data point for pump stroke number represents the average of a plurality of individual conductivity measurements made during the test as described above. The plot showing the conductivity of the dialysis side liquid as measured by conductivity probe is shown by line while the plot of the conductivity measured in the blood side recirculating liquid as measured by conductivity probe is shown by line .

As is apparent from the graph the reactive conductivity measured on the blood side compared to the stimulus conductivity measured on the dialysate side is characterized both by having a lower maximum conductivity amplitude and by a measurement time lag i.e. the maximum conductivity occurs at a later pump stroke number . The time lag displacement of the data is believed to be in the system illustrated in caused primarily by hold up volume effects in the system as opposed to being primarily caused by the kinetics of ion transport across the dialyzer membrane. In other embodiments one or both of conductivity probes and could be placed in closer proximity to dialyzer in order to reduce or minimize the illustrated phase lag behavior. It is believed that the difference in amplitude between the dialysate side conductivity measurements and the blood side conductivity measurements is a factor that is primarily related to the dialyzer clearance. In certain embodiments the measured amplitude difference and optionally the phase lag phase shift can be used directly as a measure of clearance and may be employed by the control circuitry software of the system as a parameter by which to determine suitability of the dialyzer for continued use. However in certain embodiments and as described in more detail below it may be desirable to develop a mathematical model correlated to the transfer function and fitting the measured blood side conductivity data so that a single optionally dimensionless parameter may be derived from the data that may be utilized or further manipulated to determine a parameter used as the measure of dialyzer clearance by the system. Depending on the functional form of the data and the desired number and type of fitting parameters it will be apparent to those skilled in the art that a very wide variety of statistical and mathematical data fitting protocols and algorithms could be potentially used for fitting the data and deriving a parameter indicative of dialyzer clearance. In certain embodiments however an inventive method and protocol are used to derive a single coefficient K representing a dimensionless ion clearance which parameter is substantially linearly related to measured urea clearance for the same dialyzer. In certain such embodiments the model may be based on a weighting function and may have the functional form given below in Equation 6 Model 1 Average Model 1 CondDialysate Equation 6 

In the above equation K is a dimensionless fitting constant indicative of the ion clearance of the dialyzer membrane. i is a selected time interval e.g. pump stroke number Model i is a calculated value of a conductivity measured in the blood flow pathway liquid at time interval i plotted in as curve 

Average Model i n i 1 is the average value of previous values of Model i determined over a range of intervals from i n to i 1 CondDialysate i m is a measured value of the conductivity of the dialysate side fluid determined at a time m intervals prior to interval i e.g. the average of measured conductivity values that particular pump stroke number as described above wherein n is greater than or equal to 2 and m is greater than or equal to zero. K is determined by fitting the equation for Model i to CondBloodSide i data i.e. curve over the tested range of measurement intervals. The portion of the equation indicated by K CondDialysate i m represents a correction due to the phase shift behavior discussed above and the value of m may be selected such that the phase of the measured dialysate side conductivity curve is approximately aligned with that of the measured blood side conductivity curve . For the illustrated data shown in m may be chosen for this purpose to be about 7. In certain embodiments n is chosen to be greater than m. In one particular embodiment n m 1. In certain embodiments data over the entire range of measured pump stroke number may by utilized for fitting the model however in certain embodiments it may only be necessary or desirable to fit data bracketing the maximum peak amplitude e.g. data for pump stroke numbers between about 30 and about 45 in the graph shown in .

The model form shown above in Equation 6 is fitted to the data in certain embodiments by determining the value of K which minimizes to a desirable degree the total error between the model calculation Model i and the measured values of conductivity for blood side liquid over the range of data analyzed i.e. the data represented by curve . As mentioned above there are a number of statistical and curve fitting algorithms that may be used for determining an optimal value for K. In one particular method an iterative process is used in which a pair of model estimates for K are calculated and it is determined which of the two model estimates yields a lower error between the observed data points and the model. For example a first pair of model estimates may use a value of K 0.0 and a value of K 1.0. Whichever model is closer to the actual measured data point is next used to narrow the range of possible values of K. Thus if a better fit is obtained with a value of K 1.0 the next set of model estimates may be K 0.5 and K 1.0. If this set of estimates shows the optimum value of K to be closer to 0.5 the next set of model estimates may use K 0.5 and K 0.75. This procedure may be repeated until the two estimates of K chosen are equal to each other within for example three decimal places.

In one aspect of the invention it has been determined that the coefficient K a dimensionless clearance coefficient related to ion clearance is essentially linearly related to urea clearance of the dialyzer. This linear relationship may be used to transform clearance coefficient K into an estimated urea clearance for a desired combination of blood and dialysate flow rate for a particular dialyzer. The graph shown in shows data comparing the clearance coefficient K determined as described previously on the X axis versus measured urea clearance of the same dialyzer tested using a commercially available device used for quantitatively measuring urea clearance Baxter Model no. insert model no. here insert model no. here . This substantially linear relationship may be used to transform the dimensionless conductivity based clearance coefficient K into an estimated urea clearance. This may be advantageous in that clinicians and patients are typically familiar with the concept of urea clearance. The system controller and software may then be configured to suggest that the user replace the dialyzer after the next therapy if such estimated urea clearance is below a clinician s settable percentage of the nominal urea clearance for a new dialyzer of the particular model being utilized.

In one set of embodiments in case of a power failure it may be desirable to return as much blood to the patient as possible. Since one embodiment of the hemodialysis system uses compressed gas to actuate various pumps and valves used in the system a further embodiment takes advantage of this compressed gas to use it in case of power failure to return blood in the system to the patient. In accordance with this procedure and referring to dialysate is pushed across the dialyzer rinsing blood residing in the blood flow circuit back to the patient. Compressed gas which in a preferred embodiment is compressed air can be used to push dialysate across the dialyzer . A valve releases the compressed air to initiate this function. This method may be used in situations where electrical power loss or some other failure prevents the dialysis machine from rinsing back the patient s blood using the method normally employed at the end of treatment.

As compressed air is used to increase the pressure on the dialysate side of the dialyzer and force dialysate through the dialyzer to the blood side thereby pushing the patient s blood back to the patient the patient or an assistant monitors the process and clamps the tubes between the blood flow circuit and the patient once adequate rinse back has been achieved.

In one embodiment a reservoir is incorporated into the hemodialysis system and is filled with compressed air prior to initiating treatment. This reservoir is connected to the dialysate circuit through a manually actuated valve . When the treatment is finished or aborted this valve is opened by the patient or an assistant to initiate the rinse back process. The membrane of the dialyzer allows dialysate to pass through but not air. The compressed air displaces dialysate until the patient tubes are clamped or the dialysate side of the dialyzer is filled with air.

In another embodiment a reservoir containing compressed air is provided as an accessory to the dialysis machine. If the treatment is terminated early due to a power failure or system failure of the dialysis machine this reservoir may be attached to the dialysate circuit on the machine to initiate the rinse back process. As in the previous embodiment the rinse back process is terminated when the patient tubes are clamped or the dialysate side of the dialyzer is filled with air.

In yet another embodiment shown in an air reservoir is incorporated into the system and attached to a fluid reservoir with a flexible diaphragm separating the air from the dialysate fluid. In this case the compressed air pushes the diaphragm to increase the pressure in the dialysate circuit rather than having the compressed air enter the dialysate circuit. The volume of the dialysate that is available to be displaced is determined by the volume of the fluid chamber . The rinse back process is terminated when the patient tubes are clamped or when all of the fluid is expelled and the diaphragm bottoms out against the wall of the fluid chamber .

In any of these embodiments the operation of the systems or methods may be tested periodically between treatments by running a program on the dialysate machine. During the test the user interface prompts the user to actuate the rinse back process and the machine monitors the pressure in the dialysate circuit to ensure successful operation.

In the systems depicted in blood is drawn from the patient by the blood flow pump pushed through the dialyzer and returned to the patient. These components and the tubing that connects them together make up the blood flow circuit . The blood contained in the blood flow circuit should be returned to the patient when the treatment is finished or aborted.

The dialysate solution is drawn from the dialysate tank by the dialysate pump and passed through the heater to warm the solution to body temperature. The dialysate then flows through the ultrafilter which removes any pathogens and pyrogens which may be in the dialysate solution. The dialysate solution then flows through the dialyzer to perform the therapy and back to the dialysate tank.

The bypass valves may be used to isolate the dialyzer from the rest of the dialysate circuit . To isolate the dialyzer the two valves connecting the dialysate circuit to the dialyzer are closed and the one shunting dialysate around the dialyzer is opened.

This rinse back procedure may be used whether or not the dialyzer is isolated and is used when the treatment is ended or aborted. The dialysate machine is turned off or deactivated so the pumps are not running. When the patient is ready for rinse back air valve is opened by the patient or an assistant. The air in the compressed air reservoir flows toward the dialysate circuit increasing the pressure on the dialysate side of the dialyzer . This increase in pressure may be achieved by allowing the air to enter the dialysate circuit directly as shown in or indirectly by pushing on the diaphragm shown in .

The air pressure on the dialysate side of the dialyzer forces some dialysate solution through the dialyzer into the blood flow circuit. This dialysate solution displaces the blood rinsing the blood back to the patient. The patient or an assistant can observe the rinse process by looking at the dialyzer and the blood tubes. The dialysate solution starts in the dialyzer displacing the blood and making it appear much clearer. This clearer solution progresses from the dialyzer toward the patient. When it reaches the patient the blood tube clamps are used to pinch the tubing to terminate the rinse back process. If one line rinses back sooner than the other the quicker line may be clamped first and the slower line may be clamped later.

Once the rinse back is completed and the blood lines are clamped the patient may be disconnected from the dialysis machine.

The implementation of one embodiment of the system and method is shown in takes advantage of the hydrophilic nature of the material used to make the tiny tubes in the dialyzer . When this material is wet the dialysate solution can pass through but air cannot. Where the embodiment shown in is implemented air may enter the dialyzer but it will not pass across to the blood flow circuit .

In either implementation the volume of dialysate that may be passed through the dialyzer is limited. This limitation is imposed by the size of the compressed air reservoir the volume of dialysate solution contained in the dialyzer and in the case of the implementation shown in the size of fluid reservoir . It is advantageous to limit the volume of dialysate that may be pushed across the dialyzer because giving too much extra fluid to the patient counteracts the therapeutic benefit of removing fluid during the therapy.

In another embodiment in a loss of power the air pressure to move dialysate from the dialysate circuit through the dialyzer can be derived from a pressurized air reservoir that normally powers the membrane pumps and also provides a pressure source for FMS measurements. As shown in for example this source of air pressure can be accessed via the FMS pathway used to monitor the dialysate tank . In an embodiment the manifold valves that direct air pressure or vacuum to the various pumps and valves in the liquid flow paths of the hemodialysis machine are electrically operated. In some embodiments the valves in the liquid flow paths of the hemodialysis machine can themselves be electrically actuated. In the absence of electrical power they can be chosen or pre set to have default open or closed positions. If the default position of a manifold valve is closed for example then no air pressure or vacuum can be transmitted to its target. Similarly if the default position of a manifold valve is open then the pressure or vacuum source to which it is connected can pressurize the downstream device such as a membrane based pump a membrane based valve or another type of valve . If a valve that directly controls flow in a liquid flow path is itself electrically actuated the valve can be chosen to have a default position either to close off or to open its respective flow path. In the example illustrated in by configuring the manifold valve and the FMS valve to have a default open position for example pressure from a pressurized air tank can be transmitted to the dialysate tank . By configuring various other manifold valves to the appropriate default positions the corresponding flow path valves controlled by the manifold valves can be made to open a pathway from the dialysate tank through the outer dialysate pump circuit the ultrafilter a portion of the balancing circuit and ultimately to the dialyzer . Thus in the absence of electrical power and if the blood flow side of the dialyzer offers no impedance dialysate from the dialysate tank can be made to flow to the dialyzer allowing for rinseback of blood. During normal dialysis the control software can ensure that there is a sufficient supply of dialysate in the dialysate tank to allow for the rinseback of all of the blood residing in the blood tubing set.

In alternative embodiments if the valves that directly control flow in the dialysate flow paths between the dialysate tank and the dialyzer are themselves electrically actuated they can be chosen to have an open default position. Conversely other valves that control flow in pathways that divert flow away from the dialyzer can be selected to have a default closed position.

For example in the default configuration for the appropriate manifold valves can cause the inlet and outlet valves of the outer dialysate pump circuit and the balancing circuit valves to remain in an open position providing a flow path to the dialyzer . Conversely the inlet feed valve and the recirculation valve of the dialysate tank and the drain valve of the ultrafilter can be made to have closed default positions in an unpowered state to prevent the dialysate from being pushed to drain. In addition the inlet valves of the inner dialysate pump circuit and the inlet valve of the bypass or ultrafiltration pump circuit can be made to have closed default positions to prevent dialysate flow into those pathways from the dialyzer in an unpowered state.

In order to avoid uncontrolled rinseback the arterial supply and venous return lines of the blood tubing set can be compressed by an occluder mechanism that maintains a default occluded position in the absence of power and that is moved to an unoccluded position during normal dialysis. The occluder can be positioned to simultaneously occlude both the arterial line before it reaches the blood pump cassette and the venous line after exiting from the dialyzer or an air bubble trap. In a preferred embodiment before rinseback is allowed a patient operator or assistant withdraws the arterial line from the patient s vascular access site when a rinseback is planned or a power loss related rinseback is initiated. A suitable connector such as a needle or needle less spike or Luer lock connector is placed on the end of the arterial line and is then connected to an air trap such as air trap in the venous return line. This helps to prevent any air caught in the blood flow path at the top of the blood pump cassette or the top of the dialyzer from being inadvertently rinsed back toward the patient s vascular access. Once the arterial line is connected to the air trap the patient operator or assistant may then manually move the occluder to an unoccluded position decompressing the venous return line and allowing the pressurized dialysate from the dialysate circuit to push the blood in the blood tubing set toward the patient s vascular access. If the patient observes air in the venous line downstream from the air trap he or she may simply re engage the occluder and stop the rinseback process.

Although the above rinseback procedures are described with dialysate as the solution that ultimately moves the blood in the blood flow path toward the patient s vascular access any electrolyte solution that is physiologically compatible and can safely be mixed with blood can be used in a rinseback procedure. Furthermore rinseback technology need not be limited to a dialysis system. Any system that circulates a patient s blood extracorporeally could potentially benefit from an emergency rinseback system and method. It would therefore be possible to introduce a filter having a semipermeable membrane such as a dialyzer or ultrafilter into the blood flow path of the extracorporeal system. The other side of the semipermeable membrane would then be exposed to an electrolyte solution in a flow path that can be pressurized by a compressed gas source with which it is in valved communication.

In one aspect of the invention a dialysis system may include a chamber such as a balancing chamber in a dialysate circuit that has a membrane which is movable in the chamber and fluidly separates a first portion of the chamber from a second portion of the chamber. One such balancing chamber is discussed above with reference to and reference numbers and . The chamber may include a first inlet to the first portion and a second inlet to the second portion e.g. so that fluid may enter and exit the chamber via the first inlet to fill the first portion of the chamber and may enter and exit the chamber via the second inlet to fill the second portion of the chamber. The first and second portions and the membrane may be arranged so that a volume of fluid provided into the first portion displaces a corresponding volume of fluid in the second portion and vice versa. Thus when the first chamber is substantially filled the second chamber may be substantially empty and vice versa.

A blood leak sensor may be associated with the chamber and arranged to detect blood either red blood cells hemoglobin other cellular constituents or other proteins among other elements in the first portion of the chamber. For example the blood leak sensor may include a light emitter and detector arranged to measure an amount of light that is absorbed attenuated or otherwise operated on by fluid in the chamber which may be indicative of the presence of blood or its constituent elements in the chamber. In one embodiment the light emitter may introduce light having a wavelength of about 570 nm which is generally absorbed or otherwise attenuated by hemoglobin and or other blood components. Thus by determining a light level of illumination transmitted through the first portion of the chamber and comparing it to a reference level of illumination a determination may be made whether blood is present in the chamber or not.

In one arrangement the first inlet may be fluidly coupled to receive used dialysate from a dialyzer so that used dialysate may be introduced into the chamber. Since the used dialysate is received from the dialyzer this may allow the blood leak sensor to make a determination whether blood is present in used dialysate exiting the dialyzer e.g. whether the dialyzer is leaking blood or blood components across the dialyzer membrane. It is also possible to have the second inlet connected to receive clean dialysate e.g. which is to be provided to the dialyzer. Thus the blood leak sensor may be operated to determine a reference level of signal detection associated with clean dialysate thereby allowing the blood leak sensor to continually or periodically compare the signal transmission characteristics of used dialysate to clean blood free dialysate holding substantially all other variables affecting the signal transmission constant since the only variation in the transmission media will be attributable to the unique characteristics of the used dialysate. That is optical and other characteristics of clean dialysate as well as portions of the balancing chamber optionally involved in blood detection such as the transparent or translucent portions of the walls of the balancing chamber and or of the chamber membrane may vary during treatment which may in some cases affect the operation of the blood leak sensor. For example chamber structures may become increasingly opacified over the course of a single treatment multiple treatments or disinfection processes and may attenuate detection light. However by allowing the blood leak sensor to operate alternately on clean and used dialysate in the same chamber during the treatment process the blood leak sensor may be desensitized to variations other than those attributable to the used dialysate itself allowing the sensor to reliably and accurately detect the presence of blood in dialysate flowing from the dialyzer.

Although in the embodiments discussed above the blood leak sensor detects optical characteristics of fluid to determine a presence or absence of blood the blood leak sensor may detect other characteristics that may indicate a defect in the dialyzer membrane such as chemical characteristics such as binding of blood components to an antibody or other receptor electrical characteristics such as changes in fluid conductivity the effects of leaked large proteins on the turbidity of the used dialysate and others. Moreover the blood leak sensor may also be used to detect the presence of other non blood compounds that may affect the transmission of a signal from emitter to detector. Therefore aspects of the invention are not necessarily limited to detecting optical characteristics of a fluid to determine the presence of blood or to its sole use as a blood sensor where other compounds may affect signal transmission through the fluid.

In one embodiment the blood leak sensor may be arranged to measure the transmission of a signal associated with a blood level a first measurement in fluid occupying the first portion of the chamber and to measure the transmission of a similar signal in blood free fluid a second measurement occupying the second portion of the chamber for comparison of the first and second measurements to each other. By comparing the first and second measurements e.g. where the first measurement is associated with used potentially blood contaminated dialysate and the second measurement is associated with clean blood free dialysate any confounding or biasing effects on light transmission and detection may be eliminated from blood detection. The blood leak sensor may be arranged to make a first measurement of the blood level with the first portion substantially full of fluid e.g. of used dialysate and the second portion substantially empty of fluid and may be arranged to make a second measurement with the first portion substantially empty of fluid and the second portion substantially full of fluid e.g. of clean dialysate .

In one embodiment the blood leak sensor may be arranged to measure a first level in the first portion of the chamber and a second level in the second portion of the chamber for comparison of the first and second levels to each other. By comparing the first and second levels e.g. where the first level is associated with used dialysate and the second level is associated with clean dialysate any affect of dialysate variation may be eliminated from blood detection. The blood leak sensor may be arranged to measure the first level with the first portion substantially full of fluid e.g. of used dialysate and the second portion substantially empty of fluid and may be arranged to measure the second level with the first portion substantially empty of fluid and the second portion substantially full of fluid e.g. of clean dialysate .

The chamber may include a wall that defines an interior volume of the chamber and the membrane may be arranged to contact a chamber wall when the first and second portions are substantially full of fluid. For example the membrane may be arranged so that fluid may be introduced into the first portion so that the membrane moves to expel fluid from the second portion until the second portion is substantially empty and the membrane is in contact with one aspect of the chamber wall. Conversely fluid may be introduced into the second portion so that the membrane moves to expel fluid from the first portion until the first portion is substantially empty and the membrane is in contact with another aspect of the chamber wall e.g. on an opposite side of the chamber . Thus the chamber may be alternately substantially filled with clean or used dialysate allowing the blood leak sensor to operate to detect a signal associated with the presence of blood while the first portion is substantially full of used dialysate and to detect a signal associated with the absence of blood when the second portion is substantially full of clean dialysate.

The blood leak sensor may include a light emitter arranged to emit light into the chamber and a light detector arranged to detect light emitted by the light emitter. For example the light emitter and light detector may be arranged on opposed sides of the chamber so that a straight light path extends from the light emitter to the light detector. As a result the emitter may emit light that passes through fluid in the chamber and is received at the light detector. In one embodiment the light emitter and the light detector may be arranged so that light emitted by the light emitter and received by the light detector passes through the membrane. For example the membrane and suitable portions of the chamber wall may be transparent or have a transparent or otherwise suitably translucent portion so that light may pass through the first portion of the chamber through the membrane and through the second portion of the chamber. Thus the same emitter detector pair may be used to detect the transmission of the emitter signal in both the first and second chambers. In one embodiment the light emitter and the light detector may be arranged so that light emitted by the light emitter and received by the light detector passes through a wall of the chamber. Thus the blood leak sensor may include a light emitter positioned outside of the chamber and a light detector positioned outside of the chamber so that light passes through the wall of the chamber and into the chamber interior space. In one arrangement the blood leak sensor may be arranged to detect blood in a dialysate solution where the blood has a hematocrit of 40 and is in a concentration of about 0.4375 ml blood per liter or more. In another arrangement the blood leak sensor may be arranged to detect blood in a dialysate solution where the blood has a hematocrit of 40 and is in a concentration of about 0.2 ml blood per liter or more. In other arrangements the blood leak sensor may be arranged to detect blood in a dialysate solution where the blood is in a concentration equal to or less than half the threshold concentration specified by international standards setting organizations for dialysis equipment.

In another aspect of the invention a method for detecting blood in a dialysate circuit of a dialysis system includes transmitting light through a first portion of a chamber having a movable membrane that separates the first portion of the chamber from a second portion of the chamber and determining a presence of blood in liquid in the first portion based on a light level detected for light transmitted through the first portion. For example the chamber may be a balancing chamber in the dialysate circuit and the first portion of the balancing chamber may be fluidly coupled to receive used dialysate from the dialyzer. Attenuation or other effect on light transmitted through the first portion may be detected and represent a presence of blood components or other compounds in the used dialysate. In one arrangement a first light level may be detected for light transmitted through fluid in the first portion of the chamber and a second light level may be detected for light transmitted through fluid in the second portion of the chamber. A presence of blood in the first portion may be determined based on a comparison of the detected first and second light levels. For example the first light level may be determined by filling the first portion of the chamber with used dialysate and transmitting light through the first portion of the chamber while the first portion is substantially filled with used dialysate. Similarly the second light level may be determined by filling the second portion with clean dialysate and transmitting light through the second portion of the chamber while the second portion is substantially filed with clean dialysate. As a result a single emitter detector pair may be used to measure blood or turbidity levels in the used dialysate volume using the second light level as a reference measurement associated with blood free or turbidity free fluid.

In another aspect of the invention a method for detecting blood in a dialysate circuit of a dialysis system includes providing a chamber having a movable membrane that separates the first portion of the chamber from a second portion of the chamber providing used dialysate received from a dialyzer into the first portion of the chamber and determining whether blood is present in the used dialysate in the first portion based on a detected characteristic of the used dialysate in the first portion. For example a characteristic of the used dialysate detected may include an absorption of light by the used dialysate which may indicate the presence of blood. As also discussed above clean dialysate for delivery to the dialyzer may be provided into the second portion of the chamber and a characteristic of the clean dialysate in the second portion may be measured e.g. based on impairment of light transmission by the clean dialysate the chamber walls and the membrane in the chamber as represented by a light level detected for light transmitted through the clean dialysate. The detected characteristics of the used dialysate and the clean dialysate may be compared and any difference may be used to determine a presence of blood in the used dialysate. The characteristic of the used dialysate may be detected with the first portion substantially filled with used dialysate and the second portion substantially empty e.g. with the membrane in contact with the chamber wall on one side of the chamber and the characteristic of the clean dialysate the chamber and the membrane may be detected with the second portion substantially filled with clean dialysate and the first portion substantially empty e.g. with the membrane in contact with the chamber wall on another side of the chamber .

In another aspect of the invention a method for detecting blood in a dialysate circuit of a dialysis system includes providing a blood leak sensor associated with a chamber having a membrane that separates a first portion of the chamber from a second portion of the chamber. The chamber may be a balancing chamber used to balance inflow of clean dialysate with outflow of used dialysate with respect to a dialyzer. The blood leak sensor may determine a blood free reference measurement by detecting a characteristic of clean dialysate in the second portion of the chamber such as by detecting an absorption or attenuation of light passing through the clean dialysate as well as potentially through other elements such as the membrane and or chamber wall from a light emitter to a light detector. Determining a reference level for use in blood detecting may be as simple as detecting and storing a light level at a light detector or may involve other processes such as adjusting a detector sensitivity calculating a correction value to be applied to measured light values determining a concentration of light absorbing constituents in the clean dialysate and so on. Additionally the blood sensing operation may include adjusting the radiant output of the light emitter in order for the detector to receive a reference signal sufficient to discriminate between blood contaminated dialysate and clean dialysate. A controller may be used to continually or periodically adjust the radiant output of the light emitter to allow a reference signal of pre determined strength to be received by the detector. For example the reference signal may be adjusted to be at a high end of the operating range of the detector so that a degradation of the received signal intensity will more likely remain within the operating range of the detector.

The reference signal adjusted blood leak sensor may be used to determine whether blood is present in used dialysate in the first portion of the chamber. For example the blood leak sensor may be used to measure light attenuation or other characteristics of used dialysate in the first portion of the chamber which is received from the dialyzer. The detected light level or other characteristic may be compared to a light level or other characteristic detected for clean dialysate in the same chamber with the same membrane and a difference between the two values used to determine whether blood is present in the used dialysate. As discussed above the light level or other characteristic of the clean dialysate may be detected for a condition in which the second portion of the chamber is substantially filled with clean dialysate and the characteristic of the used dialysate may be detected for a condition in which the first portion of the chamber is substantially filled with used dialysate.

In another aspect of the invention a method for detecting blood in a dialysate circuit of a dialysis system includes operating the dialysis system to provide dialysis treatment to a patient by at least in part circulating dialysate through a dialysate circuit including a balancing chamber and a dialyzer. A blood leak sensor may be provided which is arranged to determine a presence of blood in used dialysate flowing from the dialyzer. In one embodiment the blood leak sensor may be used to measure a characteristic of clean dialysate while the dialysis system is in operation to provide the dialysis treatment to the patient. For example the blood leak sensor may measure light absorption or attenuation by clean dialysate in a balancing chamber while the system is in operation during a treatment. This characteristic may be used to determine whether blood is present in used dialysate. For example the blood leak sensor may be arranged to detect light attenuation or the absorption of light within a specified frequency range caused by blood present in the used dialysate in the balancing chamber. Thus the blood leak sensor may employ a potentially variable reference measurement representing blood free dialysate by causing the blood leak sensor to operate to determine the amount of light transmitted through clean dialysate in a chamber while the dialysis system is in operation to provide the dialysis treatment to the patient. That is the blood leak sensor may repeatedly make a reference measurement during normal system operation when providing dialysis treatment for a patient. This arrangement may provide for accurate measurement of blood in used dialysate occupying the same chamber potentially reducing false positive or other erroneous operation of the blood leak sensor. Moreover the repeated reference measurement process may make the blood sensor insensitive to changes in clean dialysate used in the treatment process or in changes in the transparency or translucency of portions of the chamber wall or of the flexible membrane.

In one embodiment the dialysis system may be operated so as to alternately substantially fill the balancing chamber with clean dialysate and with used dialysate. As will be understood from the discussion of the operation of the balancing chamber herein the balancing chamber may be operated during treatment so that the balancing chamber alternately fills with clean dialysate and used dialysate with the membrane in the chamber moving to maintain separation of the clean and used dialysate. When the balancing chamber is substantially filled with clean dialysate the blood leak sensor may be operated to determine a signal associated with transmission through a blood free or turbidity free balancing chamber. Since no blood is present in clean dialysate a characteristic of the clean dialysate detected by the blood leak sensor can provide a baseline or reference value which can be used in subsequent measurements of used dialysate to determine if blood is present.

In one aspect of the invention a blood leak sensor may be used to determine whether blood is passing or has passed across the dialyzer membrane from the blood flow circuit to the balancing circuit or other dialysate circuit in a dialysis system. The ability to detect such blood leakage is required for hemodialysis systems and has previously been done using an optical detector e.g. like the sensor shown in associated with a piece of translucent tubing through which spent dialysate passes when moving to the drain. Some such detection techniques have suffered from problems with accuracy and reliability e.g. as the drain tube with which the sensor is associated becomes dirty or opacified or otherwise affects the optical transmission of light necessitating frequent re calibration or adjustment.

In one illustrative embodiment blood may be detected at a balancing chamber in the balancing circuit or other dialysate flow path. One potential advantage of detecting blood in a balancing chamber is that the sensing system can be continually or periodically adjusted in relation to known clean dialysate at any desired frequency such as for every filling and emptying cycle of the balancing chamber. That is since a balancing chamber will alternately fill with clean dialysate then fill with used dialysate followed by another fill of clean dialysate and so on a sensor used to detect blood in the balancing chamber can determine a baseline or reference blood free measurement level when the chamber is filled with clean dialysate and compare the reference level with a detected level sensed when the chamber is filled with used dialysate. As a result it is possible to effectively adjust the blood sensor for every dialysate inflow and outflow cycle during patient treatment although less frequent adjustment frequencies can be used. The sensor used to detect blood in the balancing chamber can operate on the same or similar principles used by prior blood sensors e.g. the sensor can include a light emitter that introduces light into liquid in the balancing chamber and a detector that detects light transmitted through the liquid. However other sensors may be used to determine the presence of blood such as chemical detectors that detect the presence of blood proteins or other compounds and be subject to similar re adjustment with respect to repeated determinations of a reference measurement using clean dialysate.

The blood leak sensor in this embodiment includes a light emitter assembly including e.g. a light emitting diode LED that emits a suitable wavelength or set of wavelengths of light into the balancing chamber in the direction of a light detector assembly including e.g. a photodiode or other suitable detecting element . The light emitted by the emitter assembly may be suitably arranged to be absorbed or otherwise altered by blood components in the fluid in the chamber but generally not be affected or least affected less by dialysate that is free of blood. For example the light may be generally green in color e.g. include light having a wavelength of around 570 nm which is an approximate peak absorption wavelength for hemoglobin. Of course other wavelengths or sets of wavelengths may be used e.g. to exploit other optical characteristics of blood components as desired. In this embodiment the blood leak sensor can detect the presence of blood in used dialysate based on attenuation of light passing through the used dialysate. That is light emitted by the emitter assembly passes through the membrane and used dialysate or clean dialysate depending on the measurement cycle to the detector assembly . If hemoglobin or other suitable blood components are present in the used dialysate those components will absorb scatter or otherwise reduce the amount of light that reaches detector assembly . The detected light levels for used and clean dialysate volumes may be used e.g. compared to each other to determine whether blood is present in the used dialysate.

The intensity of the illuminating element in emitter assembly e.g. an LED can be controlled to provide enough light to obtain a clear and unambiguous signal intensity at the receiving detector assembly . For example the intensity of an LED output can be controlled by having a controller adjust the current flow through the LED using pulse width modulation. This may allow the blood leak sensor to continue to provide optimal functionality if the optical pathway is degraded for any reason. The current to the LED can be set when clean dialysate is present in the chamber and in the light path and then left at this value when used dialysate is introduced into the chamber and the light path. The current may be set such that the intensity observed by the detector assembly is toward the high end of its range of sensitivity for clean dialysate. This makes most of the range of sensitivity available to observe the attenuation caused by the transition to used dialysate.

In this illustrative embodiment the membrane and the wall of the balancing chamber are made of a transparent material or at least transparent to light emitted by the emitter assembly . Thus light from the emitter assembly may pass through the chamber wall and the membrane to the detector assembly . However other arrangements are possible. For example the chamber wall may be made of an opaque material and the emitter assembly and detector assembly may be embedded in the wall e.g. co molded with the wall so that light emitter detector sections are exposed to the interior of the chamber . In another embodiment the chamber wall may be formed to have a transparent window light tube or other path through which the emitter assembly and detector assembly are exposed to the chamber interior.

In other embodiments the membrane may be opaque and include one or more windows or other portions in suitable locations on the membrane that are transparent to the light used by the blood leak sensor . Alternately the emitter assembly and detector assembly may be arranged to transmit light through portions of the chamber without passing light through the membrane . For example a first emitter assembly and detector assembly pair may be positioned on one side of the membrane e.g. on a used dialysate side and a second emitter assembly and detector assembly pair may be positioned on the other side of the membrane e.g. on a clean dialysate side . While this arrangement may not be ideal e.g. because the emitter assembly and detector assembly pairs use different light paths in the chamber the pairs may be suitably calibrated relative to each other at the time of manufacture of the hemodialysis system e.g. by making measurements with each pair using identical solutions in the respective chamber portions or at other times such as by circulating clean dialysate through the balancing circuit prior to providing treatment to a patient . In another embodiment a single emitter assembly and detector assembly pair may be used to measure the presence of blood in the chamber without passing light through the membrane e.g. by using a suitable light pipe arrangement e.g. having a Y shape that splits light from a single emitter assembly to opposite sides of the membrane and directs the two light beams into the chamber and another suitable light pipe arrangement that receives the two light beams on an opposite side of the chamber and conducts the light beams to a single detector assembly

While in the embodiments discussed above light from an emitter assembly traverses a portion of the chamber to an opposed detector assembly other arrangements are possible. For example light emanating from an emitter assembly may traverse the chamber and be reflected by the opposite chamber wall and or a portion of the membrane so the reflected beam transits to a detector assembly located on a same side of the chamber as the emitter assembly . This arrangement may provide advantages such as allowing electrical and other connections to the emitter assembly and detector assembly on a same side of the chamber . In addition or alternately transiting the light beam through a dialysate volume two or more times may increase the sensitivity of the blood leak sensor e.g. by allowing the sensor to detect the presence of relatively small concentrations of blood components.

As described above when dialysate is circulated through the dialyzer the pod pumps pull used dialysate from the dialyzer and push the used dialysate to the drain via the balancing chambers . That is the pod pumps essentially drive with coordinated control of the valves the balancing chambers to act as pumps themselves so that the balancing chambers alternately substantially fill completely with used dialysate followed by a substantial fill with clean dialysate. The blood leak sensor operation may be timed so that the emitter assembly emits light and the detector assembly detects light while the respective balancing chamber is substantially filled with either used dialysate or clean dialysate. During each of these stages which may be momentary the membrane may be pressed into contact with the chamber wall so that little or no fluid is between the membrane and the adjacent emitter or sensor . Thus the membrane may have little or no effect on light used to detect a blood component level in the chamber .

A light level measurement made while the chamber is filled with clean dialysate may be compared to a light level measurement made while the chamber is filled with used dialysate and a difference if any between the two signals may be used to determine if blood is included in the used dialysate. For example if a difference between the two measurement signals exceeds a suitable threshold the presence of blood may be determined and the system control may take suitable action. Blood presence detection may be performed by comparing light level measurements for consecutive balancing chamber fill operations or each light level measurement for used dialysate may be compared to a different stored threshold. Comparison of a light level measurement made for a balancing chamber filled with clean dialysate to a stored threshold may be used to determine whether the threshold should be changed e.g. replacement of the stored threshold with the recent light level measurement for clean dialysate or some other adjustment . On the other hand comparison of a light level measurement made for a balancing chamber filled with used dialysate to a stored threshold may be used to determine whether sufficient blood is present in the used dialysate to trigger an alarm condition. How ever the light measurements are used the system may be able to update or otherwise verify suitable measurement discrimination of the blood leak sensor by the regular measurement of light transmission in the chamber when filled with clean dialysate. Thus if the optical characteristics of the chamber membrane or clean dialysate change during a treatment the blood level sensor may take such changes into account on a ongoing basis and avoid false positive blood detections or other problems due to improper sensor reference level.

While the embodiments described above detect the presence and or absence of blood based on absorption of light by blood components other optical characteristics or properties may be exploited. For example the blood leak sensor may determine the presence of blood based on scattering or reflection of light by blood components by light emission from blood components e.g. caused by an excitation illumination etc. Alternately or in addition the blood leak sensor may include other sensor types than or in addition to an optical detector. For example one or more sensors associated with a balancing chamber may use a chemical detector to sense the presence of blood components e.g. by the binding of a blood protein with a suitable receptor. Thus aspects of the invention are not necessarily limited to optical detection of blood but rather may employ any suitable sensor to detect the presence and or absence of blood components in used dialysate.

As shown in the emitter assembly and detector assembly may be removably mounted to the bracket . Although other arrangements are possible in this embodiment the emitter assembly and detector assembly each include a generally planar body which may conveniently be the circuit board to which optical electronic and other components are mounted and which is received in a corresponding slot of the bracket . The planar body e.g. circuit board of the emitter assembly and detector assembly may also include a cutout forming a flexible or spring like tab with a distal jog that keeps the emitter assembly and detector assembly engaged with the bracket . Manufacturing a circuit board to include a cutout to create a spring tab may obviate the need to attach additional parts to the emitter and detector assemblies and in order to mount them reliably and accurately onto bracket . To remove the emitter and or detector assembly the spring tab may be depressed to release the jog allowing the emitter assembly and detector assembly to be removed from its slot on the bracket . This arrangement may allow for the replacement of a damaged or otherwise faulty emitter assembly and detector assembly as needed.

Although not shown the emitter assembly and detector assembly may include any suitable optical electrical or other components as needed to perform desired functions. For example the emitter assembly may include a suitable LED light source a filter to remove unwanted light frequencies from light emitted into the chamber a lens e.g. to focus collimate disperse or otherwise operate on the emitted light in a desired way electronic drive circuitry such as a circuit capable of using PWM or other technique to control the intensity timing or other characteristics of light emitted by the LED electronic circuitry for communication with a system controller and so on. The detector assembly may likewise include any suitable light detector such as a photodiode or other light sensitive device an optical filter and or lens suitable circuitry to smooth sample or otherwise process signal data from the optical sensor circuitry for communication with the system controller and so on.

The blood leak sensor may be arranged to detect any suitable blood concentration where the blood has a hemocrit percentage at any suitable level. For example the blood leak sensor may be arranged to be capable of detecting a leak rate across the dialyzer of 0.35 ml min or more or less of blood having a hematocrit of 25 where the flow rate of dialysate out of the dialyzer is at a rate of about 1 L per minute. Thus in one embodiment the blood leak sensor may need to be configured to detect a concentration of 25 hematocrit blood equivalent to about 0.35 ml blood per liter of clean fluid such as a saline solution. In another embodiment the blood leak sensor may be arranged to detect blood having a 40 hematocrit at a concentration of about 0.2 ml per 1 L of fluid. In other embodiments the blood leak sensor may be arranged to determine the signal strength associated with dialysate having a pre determined concentration of blood relative to a reference signal strength associated with blood free fluid e.g. clean dialysate . This relative or differential signal strength may be chosen as the threshold measurement that triggers an alarm condition. As the reference signal strength varies over time the threshold value for triggering an alarm will also change to maintain the pre determined relative or differential signal strength associated with the presence of blood at the specified concentration. In some arrangements the blood leak sensor is capable of reliably discriminating between blood free clean dialysate and used dialysate having a blood concentration less than half that specified by international standards setting organizations for hemodialysis equipment e.g. ANSI AAMI RD5 2003 section 4.2.4.7 . Moreover a controller may be programmed to adjust the current to the emitter element e.g. LED in order to generate a pre determined minimum reference signal strength received by the detector. This may help to prevent the reference signal strength received by the detector from becoming too weak to permit reliable signal strength discrimination between used dialysate and clean dialysate.

In another aspect of the invention a dialysis system may include a water supply air trap arranged to remove air from water that is provided to the dialysis system e.g. for use in making dialysate for treatment. The removal of air from water may help improve system performance e.g. by reducing the interference of air with conductivity or other measurements made to confirm that dialysate has been properly formed. For example air that is released from or otherwise present in dialysate may attach to an area between electrodes used to make a conductivity measurement of the dialysate. These air bubbles may cause an artificially low conductivity measurement or otherwise faulty measurement which may lead the system to improperly determine that the dialysate was not properly made and or cause the system to improperly adjust the dialysis production process. That is the dialysis system controller may use conductivity readings of dialysate to control amounts of acid bicarbonate or other ingredients that are subsequently added to water to form dialysate. Faulty conductivity readings may cause the system to add improper amounts of such ingredients causing the system to create unusable dialysate or may cause the system to discard good dialysate that was identified as improperly made because of the faulty conductivity reading. Although improperly formed dialysate may be identified by another sensor such as a safety conductivity sensor in the balancing circuit downstream of the ultrafilter the improperly formed dialysate may cause a disruption in patient treatment as the unusable dialysate is cleared and replacement dialysate made and supplied.

Air bubbles can cause other problems as well such as disrupting the system s ability to balance an amount of clean dialysate supplied to a dialyzer with an amount of used dialysate received from the dialyzer. This balance can be important e.g. to ensure that a patient receives no excess fluids during the dialysis process or when operating the system to remove fluids from the patient during treatment. For example air bubbles out gassing from the clean dialysate being delivered to the dialyzer after leaving the clean dialysate side of a balance chamber may be transported to the used dialysate side of the balance chamber ultimately causing more liquid to be delivered to the dialyzer than is being pulled from the dialyzer.

As will be appreciated from the above air may be present in water provided to the dialysis system in at least two possible ways e.g. as air bubbles in the water flowing from the water supply and or as dissolved gas that is carried in the water and released to form bubbles within the mixing circuit or other locations in the system. Aspects of the invention may involve the removal of air bubbles in water supplied to the system and or removal of dissolved air from water supplied to the system. Thus aspects of the invention may not only remove air bubbles but also dissolved gas from a water supply.

In one illustrative embodiment a dialysis system may include a mixing circuit arranged to combine at least water and one ingredient to form dialysate used in a dialysis treatment a water supply arranged to provide water to the mixing circuit via a water supply conduit and a water supply air trap arranged to trap air in the water supply conduit. The air trap may be provided in fluid communication with a water supply conduit that is fluidly coupled between the water supply such as a bag or other container of water a reverse osmosis filtration system or other suitable arrangement and a mixing circuit of the dialysis system. In one embodiment the air trap may include a chamber having an inlet near a top of the air trap and an outlet near a bottom of the air trap. Thus the air trap may capture air at the top of the chamber and release only liquid at the bottom of the chamber to the outlet thereby removing air from the water as it passes from the water supply to the mixing circuit.

It should be understood that aspects of the invention are not necessarily limited to use in systems that include a water supply and mixing circuit. For example aspects of the invention involved with air removal may be used in systems that include a dialysate supply such as a reservoir of dialysate ready for use in treatment and a directing circuit or other dialysate circuit that receives the dialysate from the dialysate supply and provides the dialysate to a dialyzer. In this case aspects of the invention may be used to remove air from dialysate supplied from the dialysate supply. Thus in one aspect a dialysis system may include a liquid supply arranged to provide liquid for use in dialysis treatment a liquid supply conduit fluidly coupled between the liquid supply and a directing circuit or other dialysate circuit of the dialysis system and a water supply air trap arranged to trap air in the water supply conduit. The liquid supply may be a water supply or dialysate supply and may provide the liquid whether water or dialysate in any suitable way.

In one embodiment a relatively low pressure may be present at least during some periods in the water supply conduit that tends to release dissolved gas from the water. This gas once released from dissolution may be captured by the air trap. For example the water supply may include a pressure regulator flow restrictor vent or other arrangement to provide a suitable supply pressure for water provided to the water supply conduit. In addition or alternately the water supply conduit itself and or other components may be arranged e.g. with a suitably small cross sectional size for its flow path flow restrictor etc. that helps to provide a relatively low pressure in the water supply conduit to help release dissolved gas from the water.

The mixing circuit may include one or more pumps that draw water from the water supply conduit such as pumps that intermittently draw water from the water supply conduit. For example the mixing circuit may include one or more pod pumps like those discussed above a reciprocating piston pump a syringe pump or other arrangement that intermittently draws fluid from the water supply conduit. This arrangement may allow the mixing circuit to periodically create a relatively low negative pressure in the water supply conduit to cause the release of dissolved gas without necessarily requiring constant flow in the water supply conduit. A negative pressure may be a pressure below that experienced by the water or dialysate in the water supply and or elsewhere in the dialysis system. In some embodiments the negative pressure may be a pressure below atmospheric pressure. Of course other arrangements are possible such as peristaltic or other pumps in the mixing chamber that provide an approximately constant draw of water from the water supply conduit. Alternately a gang of two or more pod pumps or other intermittent type pumps may be operated to provide a constant or approximately constant draw of water from the water supply conduit. In contrast to the pumps of the mixing circuit at least in some embodiments the water supply may be arranged to provide water on a continuous basis. The water supply may do this by using a continuous flow pump a connection to city water or other plumbed connection a water storage reservoir or other.

The air trap may be arranged to trap any suitable volume of air e.g. up to about 1.5 ml of air or more depending on requirements. For example the air trap may be arranged to trap air at a rate of up to about 10 ml hour with a flow of water of about 1200 ml minute through the air trap. Other capture rates for the same or different water flow rates may be used depending on system requirements. Air in the air trap may be purged in any suitable way such as reversing flow in the water supply conduit so as to force air from the air trap into the water supply into a drain line or other suitable location. A controller may actuate one or more valves in the fluid path to allow diversion of reversed flow through the air trap to a drain line. Placing the inlet of the air trap at or near the top of the air trap helps to ensure that most or all of the air within it is preferentially pushed to drain. Alternately the air trap may have a discharge port that can be opened to vent the trapped gas.

In another aspect of the invention a method for operating a dialysis system includes receiving water from a water supply at a mixing circuit via a water supply conduit and trapping air in the water at an air trap in communication with the water supply conduit. As discussed above the step of receiving water may include drawing water from the water supply conduit using one or more pumps in the mixing circuit. For example the one or more pumps may be operated to intermittently draw water from the water supply conduit. In one embodiment a negative pressure may be created in the air trap during at least a portion of a period in which the mixing chamber receives water from the water conduit. The negative pressure may cause air in the water to be released from the water and be trapped in the air trap. The negative pressure may be created in any suitable way such as at least in part by one or more pumps of the mixing circuit drawing water from the water supply conduit. In some embodiments valves or other flow control elements may also cooperate with the pump operation to create a desired negative pressure in the air trap. For example the water supply or water supply conduit may include a flow regulator valve or other element that slows or otherwise adjusts flow of water during a period when the mixing circuit draws water from the water supply conduit. This reduced flow in water supply conduit may cause a negative pressure to be produced in the water supply conduit.

A function of the water inlet module may be to connect the water ports on the cassette system to the water ports on the outside of the hemodialysis machine while protecting the electronics in the cold section from water leaks. The water inlet module may be located in the cold section of the hemodialysis machine with connections and to connect to the water supply and drain of the cassette system. The external ports and may extend through the exterior of the hemodialysis machine . The tubing and connections between the ports are all contained in a case with a cover not shown that directs any leaked fluid to exit out the drain slot . Water exiting the drain slot may collect in the bottom of the cold section away from the electronics. The water inlet module may include a water detector placed a given distance above the bottom of the case and able to discriminate between condensation and a significant leakage.

A number of functional elements are located in the water inlet module including but not limited to a water supply valve a water supply pressure regulator drain air in line detector or a pneumatic line from dialysate tank . The water supply valve may be a normally closed electro mechanical valve that may prevent the flow of water through the dialysate circuit in the event of a power failure. In one example the water supply valve may be located immediately downstream of the supply port . The regulator may limit the water pressure supplied to the liquid handling cassettes shown in to pressures against which the liquid valves can close. In one example the regulator may be located immediately downstream of the water supply valve . In an example regulator and valve may be hard plumbed together and to the inlet port without flexible lines. The drain air in line may be located on a vertical portion of the drain line downstream of a p trap . The p trap followed by a vertical section may serve to collect gas bubbles and allow them to coalesce in order to improve the detectability of the bubbles by the AIL sensor .

In order to protect the electronics in the cold section from water damage it is important to detect water leaks or breaks in the lines components and fittings between the external ports and the hot box ports . When a water leak is detected the AC processing unit may close the water supply valve and initiate a shutdown procedure to minimize the amount of water entering the cold section. It is also important to only signal the AC processing unit when a significant leak has occurred. In the event of operating in a humid ambient environment the cold water flow through line may condense significant amounts of water that may migrate to the bottom of the case. The water sensor may be a liquid level sensor that signals the AC processing unit when the tip is immersed in water. One example water sensor is the LLE105000 sensor from Honeywell Sensing and Control in Golden Valley Minn. USA. The water sensor may be mounted a given distance above the base next to the drain slot . The water sensor may detect water if the leak of water is larger than the allowable flow out the drain slot . Smaller leaks and condensation may not trigger the water sensor but will drain out and evaporate in the hemodialysis machine .

In another aspect of the invention a dialysis system may include an accumulator arranged to receive and release water in fluid communication with the water supply conduit. The accumulator may be arranged for example so that when a negative pressure is present in the water supply conduit the accumulator may release water into the water supply conduit e.g. at a rate that helps to maintain a negative pressure in the water supply conduit to cause dissolved gas to be released from the water. In addition the accumulator may be arranged so that when a positive pressure is present in the water supply conduit water may be received into the accumulator. Thus an accumulator may be used with an air trap e.g. in cooperation to help establish and maintain at least temporarily a negative pressure in the water supply conduit and or the air trap to help remove dissolved gas from the water. Alternately an accumulator may be used without an air trap e.g. to help smooth a pressure or flow rate in the water supply conduit when the mixing circuit includes an intermittently operating pump to draw water from the water supply conduit.

As with aspects of the invention related to an air trap and or removal of dissolved gas from a liquid for use in dialysis treatment aspects of the invention related to an accumulator may be used with any liquid provided to a dialysis system for use in treatment. For example a dialysis system may employ the use of an accumulator in a supply conduit that provides dialysate from a dialysate supply to a directing circuit or other dialysate circuit of the dialysis system. Accordingly aspects of the invention relating to an accumulator may be equally applicable to systems that do not include a water supply or mixing circuit but instead use a pre prepared dialysate supply.

In one embodiment the accumulator may include a moveable diaphragm that separates a liquid side of the accumulator from a gas side of the accumulator. For example the accumulator may include a spherical chamber with a diaphragm that has a hemispherical shape and is movable to accommodate variable volumes of water in the liquid side of the accumulator. The gas side of the accumulator may be vented to atmospheric pressure or otherwise have a static or variable pressure in the gas side to provide a desired pressure or other flow affect on the water supply conduit. The accumulator may be arranged to store a volume of water of any suitable size such as equal to about 27 ml. In one embodiment the volume of liquid capable of being stored in the accumulator may be equal to about half or more of a stroke volume of a pod pump used by the mixing circuit to draw water from the water supply conduit. Thus the accumulator may be arranged to receive and hold water from the water supply conduit during periods when the mixing circuit is not drawing water from the water supply conduit and be arranged to supply water to the water supply conduit during periods when the mixing circuit is drawing water from the water supply conduit.

In another aspect of the invention a method for operating a dialysis system includes receiving water from a water supply at a mixing circuit via a water supply conduit providing water from an accumulator into the water supply conduit when the mixing circuit draws water from the water supply conduit and receiving water from the water supply conduit in the accumulator when the mixing circuit does not draw water from the water supply conduit. In one embodiment a water supply may provide water to the water supply conduit at a pressure that is greater than a maximum negative pressure that is used by the mixing circuit to draw water from the water supply conduit. As a result when the mixing circuit draws water from the water supply circuit the accumulator may provide water to the supply circuit and when the mixing circuit stops drawing water the accumulator may receive water from the water supply. This arrangement may smooth and or help maintain a negative pressure in the water supply circuit e.g. to help remove dissolved gas from the water for trapping in an air trap if present. The mixing circuit may intermittently draw water from the water supply circuit where for example the mixing circuit includes one or more pod pumps or other similar device to draw water from the water supply circuit. Thus the accumulator may provide water to the water supply conduit when a negative pressure is present in the conduit e.g. when the mixing circuit draws water from the water supply conduit and may receive water from the water supply conduit when a positive pressure is present in the conduit e.g. when the mixing circuit does not draw water from the water supply . In one embodiment the water supply may be arranged to provide water to the water supply conduit at a flow rate that is less than an instantaneous flow rate employed by the mixing circuit when drawing water from the water supply conduit. In this case the accumulator may provide water to the water supply conduit to make up for a flow rate deficiency of the water supply. Water may be provided from the accumulator in a way that helps to maintain a negative pressure in the water supply conduit e.g. the gas side of the accumulator may be vented to provide a desired total amount of liquid to the water supply conduit.

In this embodiment the water supply may include any suitable source of water such as a reverse osmosis filtration system connected to a plumbed water line e.g. city water a bag or other container of water and or others. The water source may be arranged to provide water to the water supply conduit at a desired pressure such as about 7 psi and or at a desired flow rate so that a desired negative pressure may be created in the water supply conduit such as in the air trap . For example the pumps may be operated to draw water from the water supply conduit and into the mixing circuit e.g. for use in making dialysate and or supplying water to the ingredients as needed. The negative pressure created by the pumps in the water supply conduit may be greater in an absolute sense and at least momentarily than a positive pressure provided by the water supply to provide water to the water supply conduit. As a result the pump may generate a desired negative pressure in the air trap or other locations e.g. a pressure below atmospheric pressure or other suitable reference level pressure. For example a suitable reference level pressure may be a lowest pressure that the water or dialysate experiences when coursing through the dialysis system. Accordingly the water supply may provide water to the water supply conduit at a positive pressure that is less in an absolute sense than a negative pressure used by the mixing circuit to draw water from the water supply conduit.

The negative pressure created in the water supply conduit e.g. a pressure below atmospheric pressure may help to release dissolved gas from the water. Various components of the system may cooperate with the pump operation to create a desired negative pressure such as closing or otherwise controlling valves leading from the water supply to control a flow rate of water from the water supply providing flow restrictors or other components in the water supply conduit venting or otherwise controlling a gas side of the accumulator so as to help maintain a negative pressure induced by the pump and others. For example the accumulator may be arranged to store a volume of water equal to about half or more of a volume drawn by the pump in a single stroke. At some point before or during the draw stroke of the pump a valve leading from the water supply may be closed allowing the pump to develop a negative pressure in the water supply conduit and drawing water from the accumulator . In other embodiments a valve leading from the water supply need not be closed but may be left open and other elements such as a flow restrictor may allow a suitable negative pressure to be developed at the accumulator . The accumulator gas side may be vented to atmospheric pressure with a suitably sized orifice so that air may enter the gas side of the accumulator at a rate that allows a desired negative pressure to be established and maintained over a period of time at the accumulator and in the air trap . This sustained period of negative pressure may help bring dissolved gases in the water out of solution which can then be trapped in the air trap .

Once the pump stops drawing water from the water supply conduit e.g. because a pump membrane has bottomed out the positive pressure of water supplied by the water supply may cause water to flow into the accumulator causing air in the gas side of the accumulator to be vented and the accumulator to be filled with water in preparation for a next draw stroke of the pump . Thus the pump the water supply conduit e.g. by way of a flow restrictor cross sectional size of a portion of the water supply conduit etc. the accumulator and or the water supply e.g. including one or more valves pressure regulators etc. may be arranged to provide a suitable negative pressure to release dissolved gases for removal from the water. Of course not all of these elements need be specially arranged or even provided to provide a negative pressure in the water supply conduit. For example the accumulator may be omitted and a negative pressure established in the air trap and or in other regions of the water supply conduit by the pump and operation of a valve or pressure regulator in the water supply . In other arrangements the accumulator may be operated to provide a negative pressure e.g. by exposing the gas side of the accumulator to a suitably low pressure.

While the discussion above mainly relates to the release of dissolved gases from water in the water supply conduit the air trap may function to trap air bubbles that are already present in the water provided from the water supply . Thus the dialysis system may include an air trap that is arranged to trap air and yet not necessarily operate to establish a negative pressure in the water supply conduit or elsewhere to help liberate dissolved gases from the water. Also aspects of the invention may be used with systems that receive prepared dialysate for use in treatment. For example the water supply may actually provide prepared dialysate e.g. from a reservoir and the mixing circuit may be eliminated from the system. Thus the air trap and or accumulator may be provided in a supply conduit between the water supply dialysate supply and the directing circuit or other dialysate circuit of the system.

Air collected in the air trap may be removed in any suitable way. For example the air trap of may have the air removed by reversing the flow of water from the outlet to the inlet which may cause air to exit the inlet and travel in the water supply conduit toward the water supply . The air may be forced to the drain e.g. by suitable control of valves to the water supply where the air may be released for example into a reservoir or may be released via a vent or other feature whether in the air trap or another location in the water supply conduit. Reversed flow of water in the air trap may be caused by the pump of the mixing circuit reversing operation so as to push water toward the water supply .

Referring to for example a controller may periodically reverse through air trap by first opening valves and and having pump fill with water. Then valve may be closed and valves and opened. The chamber of pump may then be delivered backward to drain by closing alternative flow paths for example by ensuring that valves and remain closed. Preferably the inlet of air trap is located above the fluid inlet of accumulator as shown in and .

The air trap may have any suitable volume such as an arrangement to trap an air volume of up to 1.5 ml or more. In one embodiment the air trap may be arranged to trap air at a rate of up to 10 ml hour when experiencing water flows of up to about 1200 ml minute. Of course other air volume and or air trapping rates may be used for the air trap .

While in some embodiments the accumulator may be arranged to help provide a negative pressure in the water supply conduit the accumulator need not be so arranged and instead may function to help maintain a relatively constant positive pressure in the water supply conduit. For example the gas side of the accumulator may be charged with a positive pressure so that when the pump draws water from the water supply conduit the accumulator expels water from the port to help maintain a positive pressure in the water supply conduit.

The accumulator may have any suitable volume such as a capability to store at least 27 ml of water or up to half or more of a volume drawn from the water supply conduit by a single stroke of the pump . Of course the accumulator may be arranged to store smaller or larger volumes of water if desired. Also while the orifice in one embodiment has a size of about 0.004 inches the orifice may have other sizes or arrangements such as including a controllable valve that is operated to provide a desired flow rate into out of the gas side of the accumulator . The diaphragm may have an arrangement like that used for the membrane in the pod pumps discussed above. Thus the diaphragm may have a hemispherical shell arrangement and be made of a flexible material such as a silicone rubber. Again the diaphragm may be arranged in any suitable way.

Another aspect of the invention is generally directed to a user interface for the system. The user interface may be operated by an individual such as the patient a family member assistant professional care provider or service technician to input options such as treatment options and to receive information such as information about the treatment protocol treatment status machine status condition and or the patient condition. The user interface may be mounted on the treatment device and controlled by one or more processors in the treatment device. In another embodiment the user interface may be a remote device that may receive transmit or transmit and receive data or commands related to the treatment protocol treatment status and or patient condition etc. The remote device may be connected to the treatment device by any suitable technique including optical and or electronic wires wireless communication utilizing Bluetooth RF frequencies optical frequencies IR frequencies ultrasonic frequencies magnetic effects or the like to transmit and or receive data and or commands from or to the treatment device. In some cases an indication device may be used which can indicate when data and or a command has been received by the treatment device or the remote device. The remote device may include input devices such as a keyboard touch screen capacitive input device or the like to input data and or commands to the treatment device.

In some embodiments one or more processors of the treatment device may have a unique identification code and the remote device may include the capability to read and learn the unique identification code of the treatment. Alternatively the user can program in the unique identification code. The treatment device and the remote device may use a unique identification code to substantially avoid interference with other receivers including other treatment device.

In one set of embodiments the treatment device may have one or more processors that are connected to a web enabled server and the user interface device may be run on this web enabled server. In one embodiment the device uses an external CPU e.g. a GUI graphical user interface to communicate via Internet protocol to the embedded web server in or connected to the treatment device. The web page may be served up inside the device and the GUI may communication directly via 802.11b or other such wired or wireless Ethernet equivalent. The GUI may be operated by an individual such as the patient a family member assistant professional care provider or service technician to input options such as treatment options and to receive information such as information about the treatment protocol treatment status machine status condition and or the patient condition.

In another embodiment the embedded web server in or connected to the treatment device may communicate to an appropriate site on the Internet. The Internet site may require a password or other user identification to access the site. In another embodiment the user may have access to different information depending on the type of user and the access provider. For example a patient or professional caregiver may have full access to patient treatment options and patient information while a family member may be given access to certain patient information such as the status and duration remaining for a given treatment or frequency of treatments. The service technician dialysis center or treatment device provider may access other information for troubleshooting preventive maintenance clinical trials and the like. Use of the web enabled server may allow more than one individual to access patient information at the same time for a variety of purposes.

The use of a remote device e.g. via wired or wireless communication Internet protocol or through an Internet site utilizing a web enabled server could allow a dialysis center to more effectively monitor each patient and or more efficiently monitor a larger number of patients simultaneously. In some embodiments the remote device can serve as a nocturnal monitor or nocturnal remote alert to monitor the patient during nocturnal dialysis treatment and to provide an alarm if the patient s condition does not meet certain parameters. In some cases the remote device may be used to provide alarms to the patient a family member assistant professional care provider or service technician. These alarms could alert an individual to certain conditions such as but not limited to a fluid leak an occlusion temperature outside normal parameters and the like. These alarms may be audible alarms visual alarms and or vibratory alarms.

An exemplary embodiment of a user interface treatment device combination is shown in . In particular shows a perspective view of an exemplary hemodialysis system comprising a dialysis unit and a user interface unit . In this embodiment the dialysis unit comprises a housing that contains suitable components for performing hemodialysis. For example the dialysis unit may include the mixing circuit blood flow circuit balancing circuit and external or outer dialysate circuit described for example in connection with . The dialysis unit may also include all patient access connections and dialysate fluidic connections needed for operation of the system .

The user interface unit comprises a user interface that a user such as a hemodialysis patient may use to control operation of the dialysis unit via a connection . The connection may comprise any suitable data connection such as a bus a wireless connection a connection over a local area network e.g. an Ethernet local area network and or a connection over a wide area network e.g. the Internet . The user interface unit further comprises a housing that contains components for enabling operation of the user interface. In the example of the user interface comprises a display screen with a touch sensitive overlay to allow touch control and interaction with a graphical user interface presented on the screen. However many other types of user interfaces are possible such as a screen with a separate input mechanism such as a keyboard and or pointing device. The user interface may also include other features such as push buttons a speaker a microphone for receiving voice commands and so on.

Method can facilitate communications between a tablet and a base by using a wired connection to establish a wireless connection through a pairing protocol. For example the tablet may be physically connected to the base through a USB cable which is used pair the two devices together using the Bluetooth protocol after pairing the devices can communicate with each other wirelessly using the Bluetooth protocol. The tablet may provide the user interface to the base. For example an interface program running on the tablet may provide an interface to a hemodialysis apparatus to control and or monitor a dialysis treatment of a patient.

Method may be implemented by an operative set of processor executable instructions configured for execution by one or more processors. The one or more processors may be on the base and or on the tablet. The operative set of processor executable instructions may be stored in a non transitory processor readable memory such as a random access memory a read only memory a disk memory an EEPROM an optical based drive or other memory. The memory may be in the base in the tablet and or the base and the tablet may each have a respective memory and one or more respective processors. The one or more processors may be in operative communication with the memory to read the operative set of processor executable instructions from the memory. The one or more processors can execute the instructions to perform the method of .

The one or more processors may be one or more of a microprocessor a microcontroller an assembly based processor a MIPS processor a RISC processor a CISC processor a parallel or multi core processor a CPLD a PLA a FPGA a virtual processor the like or some combination thereof.

In some embodiments of the present disclosure method includes acts . Act determines if a tablet is connected to a base through a physical connection. For example a tablet may be connectable to a hemodialysis apparatus through a dock a cable a wire a fiber optic link or the like. The tablet and or the base may determine that the tablet and the base are physically connected to each other through a USB connection for example. Act establishes a first communications link between the tablet and the base through the physical connection. For example act may establish the appropriate software interfaces and or may perform handshaking between the tablet and the base such that data may be communicated therebetween.

Act updates if necessary the interface program on the tablet through the first communications link. illustrates one specific embodiment of act and is described below. Act may for example determine if the tablet includes the latest version of the interface program. If the tablet does not include the latest version of the interface program the base and or the tablet downloads e.g. from a server the latest version of the interface software which replaces e.g. overwrites the old version of the interface software. The interface software on the tablet provides a user interface e.g. a touchscreen a keyboard and or a microphone to receive voice commands and functionality for a user to communicate with the base using the tablet.

Act establishes a second communications link between the tablet and the base using the first communications link. illustrates one embodiment of act and is described below. In one specific embodiment act establishes a second communications link by pairing the tablet and the base together using a Bluetooth protocol. After pairing data may be communicated using the second communications link. The data may be communicated over the second communication link using any know encryption algorithm include symmetrical encryption asymmetrical encryption public key infrastructure encryption and the like. Act transmits data from the base to the tablet using the second communications link. The data may include information concerning the treatment progress of the base the operation of the base and or any error messages from the base. Act displays data on the tablet in accordance with the data communicated from the base. Act initializes treatment of a patient using the tablet. For example a user may select treatment parameters for treating a patient using the base e.g. hemodialysis parameters. The treatment parameters may be communicated via the first or second communications link. In some embodiments the treatment parameters may be communicated using a predetermined preferred one of the first and second communications link. For example the second communications link may communicate the treatment parameters when the first communications link is unavailable. However in another specific embodiment treatment parameters are always communicated via the second communications link.

In act the base proceeds to operate. For example the base may be a hemodialysis apparatus and the tablet communicates a start command to the hemodialysis apparatus. In another exemplary embodiment a start button on the hemodialysis apparatus may be pressed to commence treatment of a patient. In yet additional embodiments the user is not required to commence operation and the base automatically starts to operate.

Act removes the physical connection between the tablet and the base. For example a user may disconnect or undock the physical connection between the tablet and the base. Act communicates data between the tablet and the base as long as a link quality value of the second communications link is above a threshold. Act enters into a headless state if the link quality value falls below the threshold. The headless state is described below with reference to . The tablet and the base may both or individually enter into a headless state when the link quality value falls below a threshold. The link quality value may be part of the Bluetooth standard may be based upon a bit error rate a throughput rate signal strength or may use any metric known to one skilled in the relevant art.

In act the tablet and or the base remain in the headless state as long as the link quality value remains below the threshold. Act determines if the link quality value returns above the predetermined threshold and act exits the headless state when the link quality value returns above the predetermined threshold. In some embodiments once the tablet or the base enter into a headless state a second link quality value greater than the first link quality value causes the tablet and or the base exit the headless state.

In a legend is shown to facilitate understanding of the state diagram . The legend displays the operation of each of the buttons and a status light on the dialysis apparatus for each of the states including the operation of a respective backlighting LED for the buttons and the status light . Additionally the legend may be used in conjunction with each of the states to determine the state of a speaker of the dialysis apparatus. Circles with the letters A B C or D therein are used to link the states of with the states of . For example the arrow leading into the circle designated A shown in continues from the circle designated A in . That is each letter designation within each circle is used to link two states where one state is in and the other state is in .

As previously mentioned the state diagram illustrates the states that a dialysis apparatus e.g. a hemodialysis apparatus may exists in when used with a tablet having a user interface. The tablet may be used to 1 monitor the operation of the dialysis apparatus 2 control the operation of the dialysis apparatus 3 receive error conditions from the dialysis apparatus 4 monitor the operation of the dialysis apparatus to determine if any error conditions exits 5 monitor the operation of the dialysis apparatus to determine if an unsafe condition exists 6 store an error or operating parameter for transmission to a server 7 store an error or operating parameter for transmission to the dialysis apparatus for storage therein or for relaying to a server 8 and or provide the patient entertainment e.g. video games movies music or web browsing while receiving treatment.

In some embodiments of the present disclosure the tablet is used with a dialysis apparatus having a redundant user interface coupled thereto such as a redundant graphical user interface. In yet additional embodiments of the present disclosure the tablet includes a graphical user interface and the dialysis apparatus includes buttons and lights but no graphical user interface.

The state diagram may be implemented as a method or process. Additionally a machine may be configured to exist in the states of the state diagram . For example and as previously mentioned a hemodialysis apparatus may be configured to exist in states in accordance with the state diagram of .

The state diagram of may implemented by an operative set of processor executable instruction configured for execution by one or more processors e.g. a method implemented by a processor . The one or more processors may be on the dialysis apparatus. The operative set of processor executable instruction may be stored in a memory such as a non transitory processor readable memory a random access memory a read only memory a disk memory an EEPROM an optical based drive or other memory. The memory may be in the dialysis apparatus. The one or more processors may be in operative communication with the memory to read the operative set of processor executable instructions from the memory. The one or more processors can execute the instructions to perform the state diagram of .

The one or more processors may be one or more of a microprocessor a microcontroller an assembly based processor a MIPS processor a RISC processor a CISC processor a parallel or multi core processor a CPLD a PLA a FPGA a virtual processor the like or some combination thereof.

Referring again to in state the dialysis apparatus is in a treatment operation and communication between the dialysis apparatus and the tablet is occurring. That is in state the dialysis apparatus is treating a patient and the tablet is in sufficient communication with the dialysis apparatus. The communications between the dialysis apparatus may be through a wireless link such as a Bluetooth link. The protocol of the wireless link may require pairing between the dialysis apparatus and the tablet. The pairing may be configured or initiated utilizing a wired link such as through a USB connection. In some embodiments the wireless communications may be one of Bluetooth LE WiFi Zigbee X bee ultra wideband communication wideband communication code division multiple access time division multiplexing carrier sense multiple access multiplexing with or without collision avoidance space division multiplexing frequency division multiplexing circuit mode wireless multiplexing wireless statistical multiplexing orthogonal frequency division multiplexing or the like.

When a link quality indicator that described the quality of the wireless link between the tablet and the dialysis apparatus falls below a predetermined threshold the dialysis apparatus enters into state . In state the dialysis apparatus continues to treat a patient and ignores communications from the tablet. When an alarm occurs as long as the alarm is not a blood pump stop level alarm the state diagram will continue to operate in state e.g. if an alarm occurs that is not a stop pump level alarm the dialysis apparatus will re enter state as is shown by the loop back arrow .

If the link quality value returns to above the predetermined threshold the dialysis will return to state . However state may go to states or . The dialysis apparatus will enter into state if a user presses and holds the stop button for 5 seconds. If the treatment completes prior to leaving state the dialysis apparatus will enter into state see . If while in state the user presses the infuse fluid button the hemodialysis apparatus will enter into one of state if the infusion limit or tank limit have been reached or into state when additional infusion fluid is available e.g. neither of the infusion limit nor the tank limit has been met . The infusion limit is a limit on the amount of fluid that may be infused into a patient during a treatment session. The tank limit is a threshold amount of fluid e.g. about 1 to 1.1 liters that may be removed from the tank. After the tank limit has been reached an infusion of fluid into the patient s blood is not permitted because there needs to be sufficient fluid to perform the rinseback operation. If the a blood pump stop level alarm has occurred the dialysis apparatus will enter into one of state if a rinseback flag indicates that a rinseback is allow or into state if the rinseback flag indicates that a rinseback is not allowed.

If the dialysis apparatus enters into state it is because the patient or user has requested from the dialysis apparatus using the stop button to stop treatment. State is an entryway into a trap formed by states and form trap states for the dialysis apparatus. That is once the dialysis apparatus enters into state the dialysis apparatus can only enter into one of state or thereafter. A reset or reboot of the dialysis apparatus is the only way to leave this trap. State is a patient initiated failsafe PIF . In state the speaker will audibly beep. If the user presses the stop button again the dialysis apparatus will enter into state in which case the dialysis apparatus is in a PIF state but the speaker is not beeping. If the patient or user presses the stop button yet again the dialysis apparatus will enter into state and turn off the front panel light . An additional stop button press will return the dialysis apparatus to state which will turn the front panel light back on.

As previously mentioned if the dialysis apparatus is in state and the user presses the infuse fluid button the dialysis apparatus will enter into state if there is additional fluid available to deliver across the dialyzer s membrane and into the patient s blood. If in state after the fluid infusion has been infused into the patient s blood the dialysis apparatus returns to state .

In state if an alarm that is predetermined to be a stop blood pump level alarm the dialysis apparatus enters from state into one of states and State is entered into when the rinseback flag indicates that rinseback is allowed and state is entered into by the dialysis apparatus if the rinseback flag indicates that rinseback is not allowed.

Referring again to state the dialysis apparatus enters into state when either the treatment completes from state or when the user presses the infuse fluid button and one of the infusion limit or the tank limit has been reached. In state the dialysis apparatus performs a rinseback operation. In the rinseback operation a blood pump of the dialysis apparatus is stopped and fluid is infused into the dialyzer to displace the blood from the dialyzer such that blood is returned back into the patient via both of the arterial and venous blood tubes.

After rinseback has completed in state the dialysis apparatus enters into state if additional rinseback is allowed or state if no further rinseback is allowed. A rinseback allowed flag may be used to indicate whether or not a rinseback is allowed.

If a further rinseback is allowed the dialysis apparatus enters into state at which time the use can press the infuse fluid button to return to state if a user closes the door which in turns causes the dialysis apparatus to enter into state .

If no further rinseback is allowed and the dialysis apparatus enters into state from state the front panel speaker will beep 3 times every 3 minutes to notify the user that the rinseback operation completed. From state when the door is shut the dialysis apparatus enter into state . A closed door prevents the patient from being connected to the arterial or venous tubes.

The dialysis apparatus may transition from state into state if the user presses the infuse fluid button to perform additional rinseback. Otherwise the dialysis apparatus will leave state and enter into state .

In state the dialysis apparatus will enter into state when the door is closed. When the dialysis apparatus is in state various routines are performed within the dialysis apparatus including self test checks to determine if the arterial drain connector is coupled to the arterial tube e.g. a patient has disconnected this tube from themselves check to determine if the venous drain connector is coupled to the venous tube cleaning the blood path disinfect the fluid pathways and the like. While in state if the door is opened the dialysis apparatus will enter into state to issue a door open alarm by beeping the front panel speaker continuously until the door is shut where the dialysis apparatus returns to state .

If the communications link between the tablet and the dialysis apparatus has a link quality value that returns above the predetermined threshold while in state the dialysis apparatus will enter into state for normal recycle operation which commences communication between the tablet and the dialysis apparatus. If while in state the tablet again has the link quality that is below a predetermined threshold the dialysis apparatus will enter into state which may return back to state if the link quality returns to above the predetermined threshold. States and continue the recycle operation. While in state if the treatment is still preparing for a treatment and the door closed signal is detected the apparatus will return to state .

While the hemodialysis system of comprises a user interface unit remote from and physically coupled to a dialysis unit many alternative arrangements are possible. For example the user interface unit may be mounted to or within dialysis unit . For convenience a user interface unit so mounted may be moveable from its mount for use in different locations and positions.

The computer readable media may comprise any available media that can be accessed by the processing unit . For example computer readable media may comprise computer storage media and or communication media. Computer storage media may include any one or more of volatile and or nonvolatile memory and removable and or non removable media implemented in any method or technology for storage of information such as computer readable instructions data structures program modules or other data. Examples of such computer storage media includes but is not limited to RAM ROM solid state disks EEPROM flash memory or other memory technology CD ROM digital versatile disks DVD or other optical disk storage magnetic cassettes magnetic tape magnetic disk storage or other magnetic storage devices or any other medium which can be used to store the desired information and which can be accessed by the processing unit . Communication media typically embodies computer readable instructions data structures program modules or other data in a modulated data signal such as a carrier wave or other transport mechanism and includes any information delivery media. The term modulated data signal means a signal that has one or more of its characteristics set or changed in such a manner as to encode information in the signal. By way of example communication media may include wired media such as a wired network or direct wired connection and or wireless media such as acoustic RF infrared and other wireless media.

The various components of the automation computer including the computer readable media and the processing unit may be electrically coupled via a system bus. The system bus may comprise any of several types of bus structures including a memory bus or memory controller a peripheral bus and a local bus using any of a variety of bus architectures. By way of example such architectures may include Industry Standard Architecture USA Micro Channel Architecture MCA Enhanced ISA EISA Video Electronics Standards Associate VESA and Peripheral Component Interconnect PCI .

The automation computer may further include a universal serial bus USB interface so that various input and or output devices may be coupled to the control unit . Examples of such input and or output devices include a monitor speakers a printer a keyboard a pointing device e.g. a mouse a scanner personal digital assistants a microphone and other peripheral devices. USB is merely one exemplary type of interface that may be used to connect peripheral devices. Other interfaces may alternatively be used.

As discussed above dialysis unit includes components for performing and monitoring hemodialysis processes. Such components include sensors and actuators . To couple the control unit to the sensors and actuators the automation computer may include a hardware interface . The hardware interface may provide inputs to and receive outputs from the sensors and actuators .

Automation computer may further comprise a network interface to allow the computer to connect with networked devices such as those within a local area network LAN and or a wide area network WAN . For example the network interface may allow the dialysis unit to exchange data with the user interface unit over a network which may comprise a LAN such an Ethernet LAN and or a WAN such as the Internet and may be wired or wireless. Of course the dialysis unit may alternatively or additionally exchange data with the user interface unit over a bus or other data connection.

The user interface unit comprises a user interface computer that controls a user interface such as graphical user interface that displays information to and receives inputs from the user. Like the automation computer the user interface computer comprises a control unit having a processing unit and computer readable media a USB interface and a network interface each of which may be the same as or similar to their counterparts in the automation computer . In addition the user interface computer may include a graphics interface to couple the control unit to the graphical user interface . In a preferred implementation the user interface computer software is not tasked to interpret data received from the automation computer but rather is tasked to display the data in a user friendly manner.

As shown in the example of the AC processing unit includes an I O Server Process . The I O Server Process directly accesses hardware such as sensors and actuators of the dialysis unit and provides an interface to allow other processes to request read and write operations. For example the I O Server Process may provide an interface for the Machine Controller to read from and write to the sensors and actuators thereby isolating the Machine Controller from the details of the hardware. In the embodiment described only the Machine Controller may communicate with the I O Server Process . The interface may be a synchronous message queue.

The Machine Controller mentioned above serves as an interface for controlling machine operations and reporting machine operational status. In particular the Machine Controller implements controllers that read sensors and set actuators via the I O Server Process . These controllers are designed to allow functions e.g. pumping and heating to be programmed with a variety of parameters e.g. flow rates phases pressures and temperatures in order to support the various hemodialysis therapies that may be performed. The configuration of the controllers may be established by state machines that implement high level machine functions such as priming and disinfection. The state machines configure flow paths and controller set points based on the capabilities of the machine and the high level commands received from the Therapy Applications described below. The Machine Controller may also perform safety cross checks on various sensors to maintain a safe effective therapy. Machine status and health information may be recorded by the Machine Controller to a database.

The Therapy Applications drive the patient s therapy by commanding the Machine Controller to perform individual operations relating to hemodialysis processes. In particular the Therapy Applications may run state machines that implement therapies and control the modes of the system. The state machines may for example control priming the system with dialysate connecting the patient to the machine dialyzing the patient rinsing the patient s blood back to their body cleaning the machine disinfecting the machine running tests on the machine components replacing old or worn out components and waiting for the patient to return for their next treatment. The Therapy Applications issue commands to and request status information from the Machine Controller in order to implement the therapy operations. In order to obtain patient therapy and machine information the Therapy Applications may interface with a database to access information and store treatment status information. The Therapy Applications may be used as an interface by the User Interface Model process discussed below to forward user selections and report therapy status back to the user interface. The Therapy Applications implements state machines that include treatment preparation patient connection dialysis solution infusion patient disconnect recycle preparation disinfect rinse and disposable replacement. The Therapy Applications process also contains a master control module responsible for sequencing the activity of all other therapy applications that prepare for and deliver daily treatment.

Like the Therapy Applications the User Interface UI Model runs on the AC processing unit . The UI Model aggregates information describing the current state of the system and patient and supports changes to the state of the system via operator input. The UI Model separates the content of the user interface display from non content related aspects e.g. presentation by allowing the content of the user interface to change without affecting the underlying software that controls the user interface display. Thus changes to the UI Model may be made without affecting the visual experience provided by the user interface. The UI Model does not have a display directly associated with it rather it commands the GUI of the user interface unit to display screens and return information. For example when a user navigates to a new screen the UI Model may send information to the user interface unit to be used in generating the new screen. The UI Model may also validate user data received from the user interface unit and once validated and forward the user data or commands based thereon to the Therapy Applications .

To create the interactive displays for the GUI of the user interface unit the UI View Process runs on the UI processor of the user interface computer. The UI View Process need not keep track of screen flow or therapy state. Instead the UI View Process may receive from the UI Model running on the AC processing unit information specifying what and how to display the current state of a treatment to the user as well as what may be input. As a result the GUI may terminate and restart without impacting the system s operation. In addition the GUI need not be responsible for validating user inputs. All inputs and commands received by the UI View may be sent to and validated by the UI Model . Thus all safety critical aspects of the user interface may be handled by the UI Model . Certain processes such as those not safety related do not require the participation of the UI Model . For example allowing access to information stored in a database on the user interface computer may not require any functions to be performed by the UI Model .

Also running on the UI processor a Remote Access Application provides an interface for external equipment. For example the Remote Access Application may provide an interface for therapy monitoring remote service online assistance and other external services when authorized by a user. The Remote Access Application may be responsible for initiating a remote connection validating the access and supporting the communication from the remote site to the UI Model .

A Database Access Application stores data to and retrieves data from one or more databases which may for example be located on the user interface computer . The Database Access Application allows for record storage and retrieval and provides a common access point for information required by the system such as prescription schedule and history information. The Database Access Application may also manage database files to ensure they are backed up periodically.

As discussed in connection with the functionality of the user interface software may be divided between the AC processing unit and the UIC processing unit . The UI Model and UI Controller may cooperate to isolate the control of the UI data and state information on the automation computer so that software and screen design changes to the UI View will only affect the non safety critical software on the user interface computer . Thus while the UI Model may be tested and run at a safety critical level the UI View may run as a non safety critical process.

In general therapy and machine state information displayed on the user interface computer originates only from the UI Model . According to one exemplary embodiment all data displayed on the user interface computer originates from the UI Model is taken directly from a database layer or is temporary editing data entered by a user. The only local state information displayed or stored in the UI View may be this temporary editing data and details that allow for the local rendering of the information. In this manner the UI Model may maintain and control the display of all validated data. Non safety related data may be handled solely by the UI View if desired. For example changes in the display language or other display changes that do not impact safety related content may be performed using the UI View without any effect on the UI Model .

It should be appreciated that the software processes shown in and their association with processing units and represents just one example of a software configuration for performing the functions described above. The processes may be distributed in various alternative manners among processing units and and or other local or remote processors. Further not all processes may be required in the hemodialysis system. Certain processes may be omitted or modified while maintaining the functionality of a hemodialysis system.

Referring again to an exemplary hardware configuration for the dialysis unit and the user interface unit is shown wherein the automation computer of the dialysis unit includes a hardware interface that provides inputs to and receives outputs from sensors actuators . According to an alternative implementation a hardware interface may be provided separate from the automation computer . This interface may provide an alternative safety system or a redundant safety system as discussed in connection with .

The interface board may include a safety system independent of the automation computer . For example the interface board can command a fail safe condition if any of a set of electrical signals is outside of an acceptable range. The safety system may be programmed at the start of each therapy by the I O Server Process of the AC processing unit described in connection with . The I O Server Process may set the acceptable ranges of values for selected sensors and the acceptable ranges for these sensors may be read back to the I O Server Process to confirm that they were correctly transmitted and stored. According to one exemplary implementation the interface board communicates with only the automation computer of the dialysis unit so that the dialysis unit enters a fail safe condition when unsafe conditions occur regardless of the automation computer the UI computer or the state of the control software.

In one embodiment the interface board includes Field Programmable Gate Arrays FPGAs . The I O Server Process of the AC processing unit may load patient or dialysate formula specific limits including acceptable conductivity levels for selected sensor signals. The use of patient or dialysate formula specific safety levels in a gate array safety system may allow the safety system to be customized for each patient or dialysate formula while providing the robustness independence and speed of a safety system operating substantially independently from a main system processor.

The FPGA safety system on the interface board may monitor one or more of the following measurements dialysate temperature and conductivity ultrafiltrate flow rate valve states door front panel and Occluder door switches air leaks fluid leaks and or the absence of communication from the AC processing unit . The FPGA may enter a fail safe state if one or more measurement exceeds its pre programmed acceptable value or range of values indicating the presence of an unsafe condition. The FPGA safety system on the interface board may command a fail safe state that allows manual rinse back of blood to the patient for a first set of measurement values that are outside of their acceptable ranges. For a second set of measurement values that are further outside their acceptable ranges or indicative of unsafe fluid conditions the interface board may command a fail safe state in which blood cannot be rinsed back. The integrity of the FPGA safety system may be checked via operational tests that expose the sensors to physical conditions that produce measurements that may be outside the allowed range of acceptable conditions and in which the entry into a fail safe state is verified by the automatic computer. The automatic computer may reset the FPGA by writing to two or more registers within a given time limit.

In one example the conditions that may generate a fail safe state without rinse back in the FPGA safety system include but are not limited to conductivities more than about 7 outside the nominal conductivity specified by the formula for a period of seven seconds while the patient is connected temperature exceeds 41.5 C. air at the AIL Venous or AIL Arterial and the patient is connected and the occluder does not close within 200 ms the heprarin BTS valve and the heparin Vial valve are both open or the heparin BTS valve and the heparin Air valve are both open.

The FPGA safety system may be programmed to enter a fail safe state when the patient is connected if the measured conductivity of fluid e.g. dialysate falls outside a range predefined by a formula programmed into the device the calculated range of acceptable conductivity being determined by for example the temperature of the fluid or the stage of dialysate production . In one example the allowable range for final conductivity is 13.6 to 14.6 mS cm. In some conditions the AC processing unit may alert the user of a potentially unsafe condition and work with the user to resolve the condition. One example of an unsafe condition that the AC processing unit works with the user to resolve is air in the blood lines. The FPGA safety system will only initiate a fail safe state if the AC processing unit does not react properly. In the example of air in the blood lines the AC processing unit should close the occluder. The FPGA safety system will initiate a fail safe state if it does not detect a closed occluder.

In an embodiment the FPGA calculations are limited to integer calculations to improve the processing speed and reduce the cost and complexity of the interface board . The I O Server Process of the AC processing unit may be responsible for performing the calculations to convert conductivities temperatures and or pressures into analog to digital A D values. Acceptable values such as for the various conductivities temperatures and or pressures may be stored as A D converted integer values.

The safety shutdown functionality of the FPGA safety system may be tested prior to every therapy by intentionally exposing the sensors to conditions that should trigger safety shutdown also referred to as a fail safe state . The verification of the safety shutdown functionality is performed by the AC processing unit while the patient is not connected. In one example the AC processing unit sets the patient connected status to yes and pumps fluid from the dialysate that does not have the correct conductivity through the condo safety sensor at position and verifies that the safety monitor enters a fail safe state. In another example the AC processing unit sets the patient connected status to yes and pumps dialysate that has been heated to 42 C. and that does not have the correct conductivity past the Temperature Safety sensor at position and verifies that the safety monitor enters a fail safe state. In another example the AC processing unit sets the patient connected status to yes sets the ultrafiltration or UF pump rate register to 60 ml hr operates the UF pump at 120 ml hr and verifies that the safety monitor enters a fail safe state. In another one of several possible examples the AC processing unit sets the patient connected status to yes and opens the outlet valves of both inner dialysate pumps to drain i.e. the DP Outside and the DP Outside valves shown in and verifies that the safety monitor enters a fail safe state. In another example the AC processing unit sets the patient connected status to yes and ensures that air is present in at the AIL Venus and AIL Arterial sensors sets the occluder open and verifies that the safety monitor enters a fail safe state.

The AC processing unit may reset the FPGA safety circuit in order to perform the next checkout test or to arm the FPGA safety circuit for use when a patient is connected to the dialysis unit. The AC processing unit may reset the FPGA safety circuit by writing to two registers within a given time frame. In one example the AC processing unit toggles a first signal from a first value to a second value and then back to a first value while a second signal is held constant at given value. Then the second signal is toggled from a first value to a third value and back to the first value within a pre determined period of time.

The electrical conductivity of heated dialysate and partially mixed dialysate may be measured in connection with a dialysis treatment. The conductivity of the fluid may indicate the concentration of acid bicarbonate and other additives in the dialysis solution. Although allowable concentrations for a given patient or dialysate formula may be known the electrical conductivity changes as a function of temperature. The FPGA safety system may be programmed with a table of high and low acceptable conductivities for a plurality of temperatures. The high and low conductivity limits for different temperatures may be specific to selected dialysate formulae. A user or clinician may select a dialysate formula and the AC processing unit may download the corresponding high and low conductivity limits to the FPGA. These high and low conductivity limits may be stored as A D counts for each temperature range in order to minimize computing time and demand on computing resources. In one embodiment these temperatures are selected to be about 1 C. apart. Temperatures may be measured next to each of the conductivity sensors. The FPGA safety system may compare the measured conductivity to the high and low acceptable conductivity values corresponding to the measured temperature. In an exemplary implementation the electrical conductivity of the media may be determined at positions and or described in connection with . Temperatures may be measured in the vicinity of these positions.

The temperature of the dialysate leaving the ultrafilter may be monitored. In one embodiment a fail safe state is trigged if this temperature is outside an acceptable temperature set by the I O Server Process of the AC processing unit . A fail safe state may also be triggered if an unacceptable combination of valves is commanded open and or closed. This safety mechanism may prevent the balancing circuit from getting into a hydraulic lock and or prevent unsafe flows in the blood and dialysate circuits.

The FPGA safety system may include logic to monitor the average flow rate through the ultrafiltration pump and enter a fail safe state if the average flow is too high. The maximum allowed ultrafiltration flow rate can be fixed or it can be one of the parameters that is programmable on the FPGA being either therapy specific or patient specific or both. A challenge of calculating the average flow rate is that flow through the ultrafiltration pump may be intermittent only occurring during set time intervals. Thus a cumulative average flow rate may be very low until the UF pump is activated at which point the high instantaneous flow rate will quickly exceed a maximum allowed flow rate. In one example the logic of the FPGA safety system calculates the average flow rate by creating a register with a maximum value either fixed or programmable and initializing the register at a second intermediate value. The register value is decreased by one for each ultrafiltration pump stroke and increased by one for each pre determined time period when the pump can be active. If the register value either drops to zero or increases to the maximum value the interface board may command a fail safe state.

Certain fail safe states can be implemented through commands from the interface board . In one example the fail safe state with manual rinse back may be achieved by commanding pneumatic manifold valves with the interface board to close the occluder turning off the binary pneumatic valves and holding the high pressure valve closed. The pneumatic valves in the pressure distribution module may be selected to be either normally closed or normally open so that in the powered down condition manual rinse back can be achieved. In another example the fail safe state without rinse back may be achieved by commanding the pneumatic manifold valves with the interface board to close the occluder and de pressurizing the positive pressure supply reservoir either by venting it or by opening a positive pressure valve to a negative pressure valve on the pressure distribution manifold so that there is no pneumatic pressure available to the dialysate tank to push dialysate across the dialyzer membrane and blood in the blood tubing set toward the patient. The pneumatic valves may also be unpowered during a fail safe state without rinse back.

As shown in the UI Model UI Controller and Therapy Applications discussed in the connection with run on the automation computer . The UI View runs on the user interface computer along with Auxiliary Applications . A database or an interface thereto e.g. a database server may also reside on the user interface computer . The UI Model aggregates the information describing the current state of the system and patient and commands the graphical user interface to display screens and return information. It validates and forwards user data and commands to the therapy applications in order to give the user control over the system. The UI Model keeps the content of the user interface independent from the display. The graphical user interface preferably does not maintain machine state information allowing the user interface to be changed or temporarily disconnected without affecting the underlying software. Although the graphical user interface is not responsible for validating user inputs it may constrain ranges of various inputs the validation being the responsibility of the UI Model .

Considering first the flow of information between the UI View and UI Model the UI View operates as a client of the UI Model as explained below. The UI View requests the current screen state from the UI Model and the UI Model answers the request. The answer dictates the major screen state of the UI View . The UI Model may publish data and state information in sufficient detail so that the UI View can present various subsets of display information according to a level of detail requested by a user. For example the UI View could present the same therapy state as either a summary or a step by step guide using the same information from the UI Model . The presentation of the information may be based for example on a mode selected by a user e.g. expert or novice . The UI Model may provide the ability for the UI View to record sub state information such as a current presentation mode in the UI Model. This allows the GUI to resume operation in its prior state in the event of a user interface computer reset.

The UI Model may accept user input data and requests such as a request to start a therapy from the UI View . Data integrity of any information submitted via the UI View may be enhanced or ensured in several ways such as by sending data submitted via the UI View through the UI Model for verification. That is while data may be edited locally in the UI View the accepted data may be transferred to the UI Model to be verified and recorded into database and or sent to the Therapy Applications . Verification may comprise for example verifying that entered data is within an expected range. Any entered information may be then read back from the database by the UI Model and sent to the UI View for display to the user. This process may be used to ensure that data stored in the database is correct or as a user intended. Data integrity may also be enhanced by requesting verification by the user or another party of entered data.

As shown in direct authority to control the Therapy Applications in response to inputs received from the user interface and thereby affect machine state may be limited to the UI Model UI Controller running on the automation computer . In addition direct authority to change information in the database may be limited to the UI Model UI Controller . In this case the UI View and Auxiliary Applications may have read access to the database for actions such a viewing a log but may not have write access to the database at least under most circumstances. In this way actions that could have safety critical implications may be isolated on the automation computer . Of course in some situations it may be desirable to allow the UI View and Auxiliary Applications to have limited write access to the database such as to write to a particular portion of the database or to write non safety related data to the database. In addition in some embodiments it may be desirable to allow the UI View to directly control aspects of the Therapy Applications .

The Auxiliary Applications discussed above may comprise log or documentation viewers for example. These Applications may run on the user interface computer and operate in their own process space. However to enable the UI View to control these applications the Auxiliary Applications may be clients of the UI View . This allows the UI View to communicate with the applications in a standard manner and allows the UI View to monitor these processes.

The UI Controller may comprise a table based hierarchical state machine HSM that determines the state of the screens displayed by the UI View based on data polled from the Therapy Applications local timeouts and command requests or data received from the UI View . As represented in the UI Controller may access and write data to the database as required. The state of the HSM in the UI Controller may determine the major state of the set of screens displayed by the UI View .

An exemplary HSM that may be used by the UI Controller to determine the state of the screens displayed by the UI View is schematically shown in . As shown the HSM determines the state of normal i.e. non alarm level interactions including the current functional state of the user interface and the current menu state . The HSM shown in is merely exemplary and may be implemented in a much more detailed manner. For example the state designated Prepare may involve several states relating to preparation for treatment including a gather supplies state an install chemicals state the entering of patient information and a validation screen. The validation screen gives the user the opportunity to return to any of the prior data entry screens so that inaccurate information can be corrected before the Prepare state is exited. The HSM also shows an alarm state that may be triggered. The alarm state is described in connection with .

The UI View may have the ability to take over the screen display at any time in order to display alarms. An alarm condition may be triggered in certain circumstances to notify a user or other individual of an abnormal or otherwise noteworthy condition such as a fluid leak an occlusion or an out of range temperature. When an alarm condition occurs the state of the UI Controller may change. As shown in when the UI View polls the UI Model for the current state the UI View will change the display view from a normal state to an alarm state displaying alarm information . When in an alarm condition the UI View may prevent other information from blocking the display of the alarm. However even during an alarm condition the display may be configured such that a user may activate a help button to access additional information. In this case help information may be laid out so that the help information covers only a portion of the view. Safety critical logic of the alarm display such as silencing logic may be controlled in the automation computer . For example if a user would like an alarm to be silenced an indication of the silencing request may be relayed back to the UI Model UI Controller which can allow the audible alert to be silenced temporarily. In each of the alarm state and the normal state alternate views and respectively may be possible.

As explained above when an alarm occurs the normal UI View state is terminated so that the alarm state information can be displayed. Any local screen selection and or editing data may be lost when the screen is changed. Since it may be desirable to preserve this information the UI View may request that the UI Model UI Controller stores information related to the screen displayed just prior to the alarm condition i.e. the screen related to the normal state . At the conclusion of the alarm if the normal state has not changed the UI View may retrieve the stored information and restore the screen display. As an additional benefit this feature may be used to restore the prior view in the event that the user interface computer is inadvertently reset.

Therapy behavior is modeled and implemented as hierarchical state machines that define each activity and user interaction as discrete states. As shown in the Therapy Layer is between the User Interface Model Layer and the Machine Layer . The Therapy Layer both generates data and uses data stored in the Database which also shares data with the User Interface Model Layer.

The Therapy Layer controls the state of the system as a whole and dictates available user interface interactions. The Therapy Layer is polled for state status information by the User Interface Model Layer . The Therapy Layer accepts user state change requests and changes to the Therapy Settings from the therapy settings on the User Interface Model Layer . The Therapy Layer directs the Machine Layer in controlling the fluid path flows by issuing commands from Therapy Control and Applets . The Therapy Layer polls status information from the Machine Layer to determine the state of processes.

Information read from and written to the Database may include Component Status Component History User Parameters Therapy Limits Therapy Settings and Therapy History . For example replaceable component information may be read from and updated to the Database and required fluid use and disinfect information may be read from the Database . The Therapy Layer periodically writes Therapy Status information to the Database for logging purposes and to facilitate recovery in the event of a temporary power loss. The Therapy Layer also updates the Database with Component Status information .

All inter processor communications may be performed via server defined client application programming interfaces APIs as remote process calls. The Therapy Layer may block when making Machine Layer and Database interface calls via their respective Client APIs. However during critical functions such as while performing patient therapy the Therapy Layer generally will not perform any blocking database accesses. Generally only non critical updates to the database are performed using asynchronous one way writes.

The User Interface Model Layer may block when making Therapy Layer calls via the Therapy Client API. The processes of the Therapy Layer may be considered higher priority than those of its clients such as the User Interface Model Layer .

The system may handle exception conditions or errors generally in one of at least three ways. A system error detected in the software or associated with the CPU such as for example a memory failure call the reliability of the system into question and trigger a failsafe state. A therapy error or condition may occur if a therapy variable approaches or exceeds permissible bounds. At least an alert or alarm an event requiring user action are triggered and the condition is logged. Finally system operation conditions can be triggered and logged to the database for later retrieval and analysis if problems are reported by an operator or service technician.

Generally the Machine Layer will not change state unless explicitly requested by the Therapy Layer . Thus the Machine Layer generally should not generate an error in response to a change requested by the Therapy Layer assuming that the Therapy Layer makes change requests that are valid for the current operating state. As a result Machine Layer command errors may not be tolerated. An exception is when a Pause Freeze Stop button is acted upon directly by the Machine Layer prior to Therapy Layer interaction. In this case the Machine Layer will ignore any subsequent Therapy Layer commands until the Therapy Layer confirms the Pause Stop Freeze action.

Exception cases e.g. in the event of a blood leak or air in a line and orthogonal states may be prioritized such that the state presented to the external User Interface Model Layer can be resolved to a unique current state. If multiple orthogonals attempt to set the user interface state generally only the last orthogonal processed will be presented. Unexpected exceptions may be handled by commanding a Fail Safe state.

As explained above the Therapy Layer software is a state based control layer between the Machine Layer and the User Interface Model Layer . The interface and access methodology that the Therapy Layer presents to the User Interface Model Layer are discussed below.

The Therapy Layer is a state based layer that receives command requests from the User Interface Model Layer . Some commands are valid from any state. Others are state specific and the Therapy Layer will decide if the current command request will be acted upon or not. If the current state is not valid for the command request the request from the User Interface Model Layer will be rejected and an appropriate reason for the rejection will be returned to the client. In this way safety critical operations will be protected from commands that are inappropriate in the current state. Only safe and validated operator command activities may be processed. The Therapy Layer interface to the User Interface Model Layer may be a server and the User Interface Model Layer may access it as a client process using standard IPC client server connection methods.

Synchronization between the Therapy Layer and the User Interface Model Layer may be based on two state based enumerated types the Master State and the Sub State. The Master State indicates the currently active Therapy Layer state machine. The Sub State provides a unique state indication that can identify all of the alarms user interaction or the therapy sub states that have duration. These state variables are updated in Therapy Status messages. This allows the Therapy Layer to verify what the active user operation is in a response to and provides the context to commands like continue. 

Turning now to the Machine Layer shown in an exemplary implementation of the Machine Layer is shown in . The machine software is a layer of abstraction that provides the ability to implement a specific set of operations. These operations include priming the system performing dialysis disinfecting draining and self testing. The machine software operates specific valves runs pumps controls flow paths and takes measurements. During the operations of the Machine Layer status information can be requested at any time without interfering with operations.

With reference to one state of the Machine Layer State Machine is the Primed With Water state . This state is reached by sending the primeWater command and allowing the operation Prime with Water to complete. In the Primed With Water state the fluid paths are filled with reverse osmosis RO water and purged of air. In addition this state is used to rinse disinfect and perform various tests including flow tests and hydraulic integrity tests.

The Air Filled state is used to run the dialyzer and ultra filter integrity tests and for replacing components. In this state the system may have had as much of the fluids removed as practically possible.

Dialysis treatment is performed in the Treatment state . This state is entered by sending a command to set up the parameters of the dialyzer and the ultrafilter. For example the setupDialyzeParams command may communicate the parameters of the installed disposable filters and the size of the needle catheter. The initial state of the Treatment state is the Setup Dialyze Parameters state .

The command issued by the Setup Dialyze Parameters state depends on the dialysate source. If the source is bagged dialysate the primeDialysate command is issued and the process proceeds directly to Prime with Dialysate . If the system is making dialysate from a bicarbonate cartridge and acid the connections have to be verified. In this case the CheckChem command is issued and the process proceeds to the Check Chem Connections state . A dry test can be used to verify that an empty chemical container is connected. A wet test can be used to verify that a primed chemical container is connected by detecting the presence of no or minimal air in the container. Positive or negative pressure can be applied to the chemical container to detect the presence of loose connections or leaks. Conversely a CheckBypass test can be performed to verify that the bypass connector is in place. Positive or negative pressure in the flow path can be measured to determine whether the chemical concentrate containers and tubing or the bypass connector are present. Positive or negative pressure can also be applied to determine the presence of any leaks associated with the connector. When this state is complete the primeDialysate command is issued and the process proceeds to Prime with Dialysate .

When using bagged dialysate the priming process begins immediately. When making dialysate from reverse osmosis water the system should prime the bicarbonate cartridge and cause the conductivity of the dialysate to stabilize at the requested level. Then the dialysate tank should be filled to a minimum level. The system primes itself by running the pumps in the dialysate circuit forward and backward to drive air out of the cassette. The conductivity sensors can be checked during priming to ensure that their readings remain consistent. The system finishes priming by driving dialysate through the dialyzer and into the blood loop. Priming here can also involve forward and backward flow to help purge any air from the blood loop. The arterial and venous lines can also be isolated at times to purge the air more efficiently. Priming of the blood loop also serves to meet the minimum rinse volume required for the dialyzer before treatment. When this process is complete the patient can be connected.

Before the start of a treatment a Set Fluid Production Parameters command may be sent to the machine layer . This command communicates the necessary information to either make dialysate or use pre made dialysate. For example the following dialysate information may be provided bicarbonate cartridge priming volume ml bicarbonate volumetric ratio mg ml target dialysate conductivity mS cm 25 C. after addition of acid and salt final dialysate composition and acid volumetric mixture ml acid ml water . The following dialysate source information may be provided reverse osmosis RO water or premade dialysate RO Bagged and pre made dialysate volume ml .

The Pneumatic Integrity Test operation verifies the pneumatic devices in the system. This operation may check for leaks and verify sensors. This operation may comprise the following individual tests which may be run individually or all in sequence a cassette leak test a pressure pump test a dialysate tank test and a valve speed test. The system may be prevented from initiating a therapy if any of these tests fails.

The cassette leak test is configured to identify gross pneumatic leaks in the system and determine whether they exist in the cassette or the manifold. An exemplary implementation of the cassette leak test is described below. At the beginning of the test the pneumatic tank controller is disabled so that the test can control the positive and negative compressors manually. First all valves and pumps are opened to positive pressure while all pathways to negative pressure are closed off. The tanks are charged and then turned off in order to perform a leak down test. A leak may be detected by monitoring system pressures with respect to a predetermined threshold for a predetermined period of time. A leak in the positive reservoir pressure reflects a leak in the cassette since everything is opened to the positive source. A leak in the negative reservoir pressure reflects a leak in the manifold since little is drawing off the negative source. Next all valves and pumps are opened to negative pressure while all pathways to positive pressure are closed off. The tanks are again charged and turned off in order to perform a leak down test. In this case a leak in the negative reservoir pressure reflects a leak in the cassette since everything is opened to the negative source. A leak in the positive reservoir pressure reflects a leak in the manifold since little is drawing off the positive source. The pneumatic tank controller is then re enabled the fluid valves are closed and the pumps are closed off from both pressure sources.

The cassette leak test also tests the air flow capacity of the positive and negative compressors. To test the negative air flow a positive valve and a negative valve associated with the bicarbonate pump are opened at the same or substantially the same time. The negative reservoir pressure is then monitored while the negative compressor is turned on. The test may fail if the negative pressure exceeds a predetermined threshold. To test the positive air flow a positive variable valve and a vent variable valve associated with pod pump are opened to a full open position at the same or substantially the same time. The positive reservoir pressure is then monitored while the positive compressor is being controlled by the pneumatic tank controller. The test may fail if the positive pressure is less than a predetermined threshold.

The metering pump test is configured to detect pneumatic leaks in the reference and pump chambers of the metering pumps described herein. According to an exemplary implementation of the metering pump test all reference and pump chambers are first charged with positive pressure by opening the positive source and FMS valves. The test verifies that each chamber reaches a predetermined pressure and that the reference and pump chamber pressure readings are in agreement. Next the positive source valve is closed and a leak down test is performed on the pump and reference chambers at the same or substantially the same time. The same test may be repeated using the negative source valve. Afterwards each pump chamber is charged with negative pressure. The FMS valve is then closed and the reference chamber is charged positive. The chamber pressures are checked against their target pressures before the positive source valve is closed to perform a leak down test on both chambers. In some cases the pressure decay rate is used to determine whether a leak test passes.

The pressure pump test is configured to detect pneumatic leaks in the eight pressure pump chambers. According to an exemplary implementation of the pressure pump test the chambers are first charged close to the low positive pressure and a leak down test is performed. Next the chambers are charged close to the negative pressure and another leak down test is performed. An additional leak down test on the inner pump chambers is then performed at a lower pressure with tighter constraints. Finally all chambers are actively controlled to four different pressures to check that the pods can be accurately charged and controlled.

The dialysate tank test is configured to detect pneumatic leaks in the dialysate tank and the FMS reference chamber used to take fluid level readings. According to an exemplary implementation of the dialysate tank test the reference chamber is first charged with the two way binary FMS valve associated with the dialysate tank in a closed position. A leak test is then performed. Next the dialysate tank is charged by closing the surrounding valves and then stepping up the pressure by repeatedly charging up the reference chamber and opening the two way binary FMS valve associated with the dialysate tank. Once the tank is sufficiently charged a leak down test is performed. Afterwards the three way low pressure vent valve associated with the dialysate tank is opened and it is verified that the tank can successfully vent pressure.

The valve speed test is configured to measure the open speed of the variable valves metering pump valves and select fluid valves. The close speed of the select fluid valves may also be measured.

The Hydraulic Integrity Test operation verifies the fluid valves in the system. In particular the operation tests whether each of the fluid valves opens and closes properly. If the operation reveals that any of the fluid valves is not operating properly as evidenced by a failure the dialysis system may be prevented from initiating a therapy. The operation is divided up into test sets based on which pump chambers drive fluid through which valves. Each test set comprises a pump chamber a set of test valves and a set of valves to open. The pump chamber is used to fill and charge the test pathway with fluid. The set of test valves are the valves that are under test for that test set. The set of valves to open are the valves that are left open in order to create a path to drain or back to the tank.

In this test the fluid pathways associated with a pump chamber are first primed with a fluid e.g. water and the pump chamber is filled with the fluid. Then the pump chamber is pressurized. The steps involved in pressurizing the pumping chamber may comprise for example 1 closing the valves associated with the pump chamber 2 opening any valves necessary to provide a clear path away from the valve under test to atmospheric pressure e.g. to drain or back to the tank 3 pressurizing the pump chamber to a predetermined pressure e.g. 600 mmHg above atmosphere from the positive pressure gas reservoir and 4 closing the connection to the reservoir. After pressurizing the pump chamber a test may be performed to verify proper operation of the test valves in the closed state. In particular the pressure of the pump chamber may be monitored and a failure may be logged if the pressure decays more than a predetermined maximum decay limit over a predetermined minimum decay time. Such a failure may indicate that one or more valves is leaking sufficiently to allow the current pump chamber to deliver fluid.

Next for each test valve the following test may be performed to verify proper operation of a test valve in the open position. First the pump chamber may be pressurized according to steps 1 through 4 described above and the test valve may be opened. Next the pressure of the pump chamber may be monitored and a failure may be logged if the pressure decays less than a predetermined minimum decay limit over a predetermined maximum decay time. Once this test is completed for a current test valve the test valve is closed and the test is performed for another test valve. If all the valves in the current test set have been tested all the test valves and opened valves are closed and the test set may be deemed complete.

One some or all of the test sets or portions thereof may be tested during the Hydraulic Integrity Test operation . It should be appreciated that any of the predetermined maximum decay limit predetermined minimum decay limit predetermined minimum decay time and predetermined maximum decay time may correspond to a particular test set such that the predetermined values may vary from one test set to the next. Further it should be appreciated that the operation described above is merely exemplary and that variations are possible. For example the test valves may be tested in just one of the open position and the closed position and different factors may be used to determine a failure.

The Ultrafilter Integrity Test operation is a pressure test of the ultrafilter membrane to check for leakage. Air pressure is applied to the inlet side of the ultrafilter. Air pressure is maintained since air generally will not pass through a wet intact filter. This test is performed in the Air Filled state and verifies the ultrafilter by pressurizing the outer dialysate side and measuring the pressure drop over time.

The BTS Dialyzer Integrity Test operation is a pressure test of the blood loop including the dialyzer. In this test the blood loop is pressurized with air drawn from the anticoagulant pump air filter e.g. and the pressure is monitored over time. If the measured pressure drop is less than the input decay threshold the test passes. As the blood tubing pump and dialyzer are replaced as a unit this test need not determine where the leak is.

The Dialyzer Impedance Clearance operation verifies that the blood path through the dialyzer has low enough resistance to provide efficient dialysis therapy. Before starting the impedance test the system is primed with water. During the test flow is forced across the dialyzer. As water flows across the dialyzer the pumping pressures will be monitored which provides a measure of the dialyzer impedance. Alternatively a constant pressure can be applied and the time taken for a fixed volume to cross the filter membrane can be measured. The dialysate circuit is set to provide a constant low impedance destination of the fluid being pushed through the membrane. If the dialyzer impedance is too high a failure will be reported and the dialyzer will need to be replaced. An Ultrafilter Flow Test operation may be also performed to ensure that the ultrafilter impedance is low enough to support the flow rate required for therapy. This test has the benefit of ensuring that the result of the integrity test will be valid.

The Empty Dialysate Tank state may stop fluid production and run the dialysate pump at the fastest reasonable rate to pump the contents of the dialysate tank to drain until some amount e.g. 3000 ml has been transferred or air is detected in the drain. The Deprime operation is used to purge the system of fluid filling the blood tube set and the dialysate circuit outside of the ultrafilter with air. This condition is used to perform pressure decay tests to verify the integrity of the dialyzer and ultrafilter as well as to change the fluid components and to prepare the unit for transport. The inner dialysate circuit generally cannot be deprimed because it may not be possible to pump air through an intact dialyzer or ultrafilter and there may be no air vent in the inner circuit. However if depriming the inner dialysate circuit is necessary then one may first deprime all other components and then remove the top of the ultrafilter to allow air to enter the system. The dialysate mixing water pump e.g. pump in can then be used to pull air from the ultrafilter connection and to deliver it to the inner dialysate circuit alternating the inner dialysate pump flow paths to pull as much water out of the system as possible.

The Prime with Water operation fills the system with water and purges the air. It may fill the system in stages starting with the fluid production section and moving to the outer dialysate inner dialysate and then the blood loop. The bicarbonate cartridge and acid bag should be removed and a bypass connector should be in place before this operation is performed. According to one exemplary implementation the bypass connector comprises three connection points respectively corresponding to a bicarbonate charge line an acid flow line and a bicarbonate return line of the mixing circuit . The bypass connector has three parallel prongs respectively corresponding to the three connection points. Channels in the prongs of the bypass connector terminate within a common chamber within the bypass connector. Thus during a disinfect procedure the bicarbonate charge line acid flow line and bicarbonate return line are all interconnected permitting disinfection of each of these flow lines during the disinfect procedure. An exemplary embodiment of such a bypass connector is the disinfect connector described in U.S. patent application Ser. No. 12 199 055 filed on Aug. 27 2008 and incorporated by reference herein.

The Disinfect Rinse state is used to run reverse osmosis water through all fluid paths at a specified temperature. Before this operation the system should be in the Primed With Water state . Disinfection occurs when this operation is performed at an elevated temperature. The tank is filled with reverse osmosis RO water at the start of the operation. The water in the dialysate tank is recirculated from the Dialysate Circuit disinfect path through all Fluid Production fluid paths and blood tubing set paths and back into the dialysate tank. As recirculated water is lost sent to drain reverse osmosis water may be added to maintain a minimum level in the dialysate tank. Alternatively in a preferred embodiment no further water is introduced in order to avoid the possibility of contamination. The chemical cartridge is not attached during this operation.

The Prime with Dialysate operation described above is used to flush dialysate through all fluid paths and remove any air or water in the system. This operation must be completed before the system can move on to the Patient Connected state . This operation activates the fluid production sub system which is responsible for mixing the RO water with the chemicals and for maintaining the dialysate tank level. If the tank is less than 75 full priming may be delayed until that level is reached. The tank level is preferably maintained at more than 1.1 liters otherwise a signal may be generated to stop therapy. This amount allows for a sufficient rinseback volume and a sufficiently large averaging volume needed for mixing control accuracy. During prime the air in line sensors the blood leak sensor and the safety system are tested.

In the Patient Connected state a dialysis treatment can be performed. Prior to issuing the RinseDialysate command the blood tubes are returned to drain connections. For safety purposes while in the Patient Connected state the dialysate temperature may be constrained and the dialysate conductivity and flow rates may be monitored.

The Prime With Blood operation removes dialysate from the blood circuit and replaces it with patient blood. Dialysate is pulled across the dialyzer membrane into the dialyze circuit and is discarded to drain. Blood is pulled into the blood circuit from the patient to replace the dialysate pulled across the membrane. Thus most of the priming fluid occupying the BTS need not be administered to the patient at the start of dialysis. Optionally the patient can choose to be administered the priming fluid by canceling this operation. This may be desirable for example if the patient is in need of additional fluid at the start of dialysis. This operation transitions the machine software into the Patient Connected state activating safety constraints such as temperature limiting.

The Heparin Bolus operation delivers a bolus of heparin before treatment without requiring patient interaction. Before normal dialysis operation and to minimize the amount of fluid administered to the patient the bolus can be delivered down the arterial line which is a shorter route to the patient s vascular access. In the event of the detection or presence of an air in line condition the heparin bolus can optionally be delivered down the venous line which incorporates air trapping mechanisms or devices. Prior to the Heparin Bolus operation a Heparin Vial Connection test may be performed to verify that a heparin vial is attached to the heparin medication infusion spike on the blood pump cassette.

The Dialyze operation is used to administer dialysis treatment to the patient. The rate of the blood circuit and the dialysate circuit may be specified independently. This operation can have a time limit or be terminated with a stop command. By way of example the following parameters may be specified the temperature at which the dialysate flowing through the system is heated and maintained the rate at which dialysate is circulated through the blood circuit the rate at which basal or maintenance heparin is added to the blood circuit the rate at which dialysate is circulated through the dialysate circuit and the rate at which dialysate is pumped through the ultrafiltration pump among other parameters. During dialysis the ultrafilter is periodically burped to remove any gas that has accumulated within it during treatment. This can be accomplished by opening the pathway from the top of the ultrafilter to drain while closing the pathway from the top of the ultrafilter to the dialysate circuit. Any air trapped in the top of the dialyzer can then be flushed to drain. After two or more pump strokes to divert the air and fluid to drain the valves are reset and dialysis operations can continue.

During dialysis the flow of dialysate may be adjusted automatically based on one or more factors. One such factor is the amount of remaining dialysate which may include both the dialysate in the tank and the dialysate that can be produced from the remaining dialysate ingredients . For example if it is determined that the remaining dialysate would be exhausted before the treatment was completed at the current dialysis flow rate the rate can be slowed so that the remaining dialysate will last for the full length of treatment. According to an exemplary implementation the dialysis system automatically adjusts dialysate production based on the actual or predicted dialysate tank level and or the actual or predicted remaining ingredients used in dialysate production. Another factor that may serve as the basis for adjusting the flow of dialysate is the potential for clogging the dialyzer. In particular the flow of dialysate may also be adjusted automatically to minimize clogging of the dialyzer during therapy. For example to avoid clogging the dialyzer fibers the flow back and forth across the dialyzer may be timed and balanced. In addition to automatically adjusting the flow of dialysate the dialysis system may automatically adjust dialysate production based on one or more factors.

For example using a current or average rate of use of dialysate and an expected length of treatment remaining an estimate of the volume of dialysate required to complete a treatment may be calculated. To calculate the amount of additional dialysate that needs to be produced to complete the treatment the liquid volume of dialysate in the tank may be subtracted from the estimate of the volume of dialysate required to complete a treatment as calculated above. The determination of how much additional dialysate should be produced may be implemented for example by a processor applying the algorithm described above. It should be appreciated that the determination is not limited to the amount of additional dialysate that needs to be produced to complete a treatment as the amount of additional dialysate that needs to be produced to complete some other operation may be performed in a corresponding manner.

The amount of remaining dialysate may be calculated from the amount of dialysis ingredients that have been used. Full containers with known masses of bicarbonate powder and acid liquid may be installed in the dialysis unit at the start of a therapy. With reference to the mix cassette adds these chemicals to the RO water to make dialysate. Some RO water flows through the bicarbonate container to produce a saturated bicarbonate water mixture. The bicarbonate pump and acid pump each have RMS systems to accurately measure the flow rate of these chemicals into the water to form the dialysate that flows into the dialysate tank . The amount of remaining chemicals can be calculated from the assumed full container amount minus any material pumped out by the two pumps . The amount of bicarbonate removed by the pump may be calculated by assuming the fluid is a fully saturated mixture. The amount of water used may be measured based on the number strokes by the water pump . The automation computer calculates the remaining amount of dialysate that can be produced using the remaining amount of bicarbonate and acid and the amount of these chemicals it takes to produce a unit of dialysate. According to one exemplary implementation the amount of dialysate produced per unit of chemical is a known number. Alternatively the amount of dialysate produced per unit of chemical can be determined from the measured flow of chemicals through the pumps and the measured flow of water in the water pump .

The Power Loss Recovery command may be sent to tell the machine software that there was loss of power while it was in the Patient Connected state . This forces the machine software into a Patient Disconnected state so that the dialysis machine can recover properly and prepare itself for the next treatment e.g. Recycle Preparation .

The Solution Infusion operation delivers dialysate into the patient. Dialysate is pushed across the dialyzer by the outer dialysate pump and delivered to the patient by the blood pump. This command causes the system to prepare for the infusion by stopping dialyzing freezing the inner pump and filling the outer pump with dialysate to deliver to the patient. After receiving this command the machine software expects one of the following commands Solution Infusion Confirm proceed with solution infusion Solution Infusion Stop do not perform solution infusion resume dialyzing instead or StopCmd return the system to an idle state . Preferably the blood pump continues to run during solution infusion.

A Backflush operation can be programmed during dialysis to periodically flush dialysate backwards across the dialyzer membranes in order to help prevent clogging of the membranes. The Rinse Back operation pushes dialysate into the patient to return their blood in preparation for disconnection. Dialysate is pushed across the dialyzer by the outer dialysate pump and delivered to the patient. This is automated for both venous and arterial paths. The arterial path can use the blood pump for delivery.

The Check Bypass operation checks for the presence of the bypass connector for the acid container and the bicarbonate cartridge or container. In a preferred embodiment the operation causes a vacuum to pull on the bypass connector to detect leaks. Referring to an exemplary method of performing the Check Bypass operation to detect the presence of bypass connector may include filling the bicarbonate water pump with air obtained by opening the dialysate tank air vent valve dialysate tank recirculation valve and the disinfection pathway valve . The pump chamber may then be filled with air and positively pressurized. The contents of the dialysate mixing water pump may then be delivered to drain via dialysate mix drain . Acid metering pump is also depressurized in this step. A flow path is then established between the bicarbonate water pump bicarbonate cartridge and bypass connector through acid metering pump to the dialysate mixing water pump closing dialysate mix drain valve . Having set the dialysate mixing water pump to atmospheric pressure a pre determined increase in pressure measured by pressure sensor indicates that bypass connector is properly installed.

The Drain Chemicals operation empties the contents of the chemical containers to the drain. In a preferred embodiment the contents of the chemical containers are discarded after each treatment making cleanup easier for the patient and discouraging potential problems in trying to reuse chemicals. Referring to for example the controller can initiate an Acid Drain state in which the dialysate mixing pump can pump fluid from the acid container to drain via valve . This can be accomplished by opening the valves of the acid pump and using the outlet of acid pump as the inlet of dialysate mixing pump by opening valve closing valve and actuating a fill stroke in pump . After filling pump its contents can be discharged by closing valves and and opening valve . Pressure sensor for example can be used to determine whether acid container is empty by detecting that air is being pumped by pump . The pressure signal generated by the pumping of air e.g. rapid movement of the flexible membrane to an end of stroke position is sufficiently different from the signal generated by pumping of liquid that the controller can be programmed to distinguish them. Upon this determination the controller can infer that the acid container is empty and that further pumping from the acid container can be halted.

The controller can initiate a Bicarb Drain state in which the dialysate mixing pump can also pump fluid from the bicarbonate container to drain via valve . This can be accomplished by first venting the top of the bicarbonate container . For example a fluid path can be opened from the top of the bicarbonate container through the bicarbonate mixing pump valves and at the dialysate tank . Bicarbonate pump valves and can be opened and pump can then draw fluid from the bottom of bicarbonate container and pump it to drain via valve . In an embodiment the pump can be set to pump about twice the volume contained in bicarbonate container in order to ensure that it has been completely emptied of liquid.

A CheckDoors operation verifies that the doors of the hemodialysis machine are closed helping to ensure that the patient is disconnected. A CheckDCA operation can then verify that the patient has plugged the vascular access connectors of the blood tubing set back into the DCA DCV ports of the machine for rinsing and disinfecting after a treatment session.

Referring to the system can automatically check that the venous and arterial line connectors have been plugged back into the DCA DCV ports of the machine by selectively pressurizing the lines and monitoring for a pressure decay. For example valves and may be opened and valves and may be closed to allow outer dialysate pumps to pump dialysate from dialysate tank through dialyzer and into blood flow circuit . Both blood pumps may be filled with fluid. Then valves on the dialysate side may be closed to prevent fluid from crossing over from the blood side to the dialysate side of the dialyzer . For example valves and may be closed on the dialysate side.

To determine that the venous line is properly plugged into its port tubing clamp and valve may be opened and valve may be closed. Then blood pump valve may be opened while blood pump valves are closed. Blood pump chamber may then be pressurized with a pre determined amount of pressure e.g. 400 mm Hg . The test may be considered to have failed if the pressure monitored by pressure sensor drops at a pre determined rate or greater e.g. 130 mm Hg drop over 1 sec. . The proper operation of valve may then be tested by opening the valve and having pressure sensor monitor the pressure drop e.g. test considered to fail if the monitored pressure does not drop by at least about 130 mm Hg over 1 sec. .

To determine that the arterial line is properly plugged into its port both valves and may be closed. Then blood pump valve may be opened while blood pump valves are closed. Blood pump chamber may then be pressurized with a pre determined amount of pressure e.g. 400 mm Hg . This test may be considered to have failed if the pressure monitored by pressure sensor drops at a pre determined rate or greater e.g. 130 mm Hg drop over 1 sec. . The proper operation of valve may then be tested by opening the valve and having pressure sensor monitor the pressure drop e.g. test considered to fail if the monitored pressure does not drop by at least about 130 mm Hg over 1 sec. .

In addition a Clean Blood Path operation may be performed to push the contents of the dialysate tank through the blood circuit and out the drain. Rinsing is used to flush residual blood from the blood circuit and dialyzer after the dialysis treatment. In an embodiment air is introduced into the fluid to enhance the mechanical action of loosening debris from the dialyzer and tubing components. During this operation fluid production may deliver water which will dilute the dialysate in the tank.

A Circulate Dialysate operation may be used to maintain the temperature and dialysate freshness in the system after it has been primed when the patient is not yet connected. This is accomplished by running dialysate through the heater ultrafilter into the inner pump and passing it through the dialyzer while also running the blood pump. A small amount of the dialysate can be constantly sent to drain.

The Machine Layer may also respond to stop freeze resume and shut down commands. The stop command terminates the operation being performed by machine. When the stop command is issued the current pump cycle is completed then the appropriate valves are closed. Because the stroke is completed all fluid accounting will be accurate. After the valves are closed and pumping completes the state machine returns to the idle condition where it waits for the next command. This command does not affect the getStatusCmd setupDialyzeParams or setupFluidParams commands because they do not start operations.

The freeze command causes the system to close all valves on its current cycle. This includes the fluid production valves. The heater is turned off to prevent overheating of the fluid within it. Fluid volume accounting will be correct if the resume command is issued after the freeze command. If the freeze command is followed by a stop command and then another command to enter an operation other than the one that was frozen fluid volumes are assigned to the new operation regardless of the fact that there may be partial fluid delivery in the original state. State history of the current operation is retained so the resume command can be used to continue the operation. The resume command causes the machine to continue processing the command that was frozen. The shut down command is used to terminate the machine software process.

The operations described above in connection with may be implemented by corresponding state machines at the machine layer level. Described below in connection with are exemplary implementations of state machines performing the following operations 1 Dialyzer Impedance Clearance 2 Circulate Dialysate 3 Heparin Vial Connection Test 4 Heparin Bolusing and 5 Empty Tank.

The Dialyzer Impedance Clearance operation may be used to measure the water permeability of the dialyzer which may indicate the fitness of the dialyzer for performing additional treatments. A failure of a Dialyzer Clearance operation may indicate that the dialyzer is clogged and needs to be replaced. According to one exemplary implementation the Dialyzer Impedance Clearance operation is performed prior to each treatment before a patient is connected. There may be two modes of operation one checking the flow of fluid across the dialyzer fiber membranes and one checking flow along the hollow fibers.

During the operation water is forced across the dialyzer. As water flows across the dialyzer the pumping pressures are monitored which gives a measure of the dialyzer impedance. An impedance above a predetermined threshold may indicate that the dialyzer needs to be replaced. The dialyzer impedance is measured from the blood side flowing to the dialysate side. To prepare for the test both chambers of the blood pump are filled with water and both chambers of the inner dialysate pump are emptied to drain. shows an exemplary implementation of the Dialyzer Impedance Clearance operation described in connection with .

Referring to the operation transitions to the Run state from the Idle state . Once idle the test transitions to the Start state . The Start state configures the outer inner and blood pump.

Next the Fill Blood Pumps state sets up the valves so that the blood pumps may be filled. A first blood pump chamber is filled with water from the outer dialysate pump which is used to pump dialysate through the outer dialysate fluid path. Then a second blood pump chamber is filled with water from the outer dialysate pump. Each chamber is filled individually with a path being opened through the inner pump from the outer pump to the blood pump.

In the Empty Inner Dialysate Pumps state the valves are set up based on the flow path e.g. across the dialyzer fibers . In the Empty Inner Dialysate Pump state a first inner dialysate pump is emptied to the drain. Similarly in the Empty Inner Dialysate Pump state a second inner dialysate pump is emptied to the drain.

To conduct the dialyzer impedance clearance test the blood pump pushes each chamber of water across the dialyzer to the inner dialysate pump chambers. The inner dialysate pump chambers start out empty and are vented to atmosphere during this test so the chambers present atmospheric pressure on the dialysate side of the dialyzer. Each blood pump chamber delivers water using a specific pressure and monitors for end of stroke to determine the flow rate. Each chamber provides one pressure flow data point and the process is repeated to obtain additional data points.

In the First Blood Pump Chamber Test Flow state the valves are set up based on the flow path. If the flow path is across the dialyzer fibers the inner dialysate pump is opened to the drain. If the flow path is along the dialyzer a flow path is opened to the blood tubing set drain. In state the first blood pump chamber is delivered. Once the chamber is idle test data is calculated. The state then transitions back to the Fill Blood Pumps state so that the second blood pump chamber can be tested.

In the Second Blood Pump Chamber Test Flow state the valves are set up based on the flow path. Again if the flow path is across the dialyzer fibers the inner dialysate pump is opened to the drain. If the flow path is along the dialyzer a flow path is opened to the blood tubing set drain. In state the second blood pump chamber is delivered. Once the chamber is idle test data is calculated. The state checks how many total passes are needed through the test e.g. 9 passes before it can average out the test data and determine a pass fail condition. If the test needs to run through again the operation transitions to the Fill Blood Pumps state. If the test is complete the average impedance is calculated and the operation transitions to the Stop state .

The Freeze command is commanded from the therapy layer to freeze the operation. This command is handled in the Run state . The Freeze state pauses the running pumps and closes the valves used in this operation. The state of the pumps and valves do not need to be saved in response to the Freeze command since the test and check operations may be restarted when the operation is resumed.

The Resume command is commanded from the therapy layer to resume the operation from a frozen state. This command transitions the Operation to the Resume state . As noted above when the operations resumes the Dialyzer Impedance Clearance operation may be restarted so that the test begins anew.

The Stop command is commanded from the therapy layer to terminate the test. This state is also called at the end of the operation to insure that all pumps are stopped and all valves are closed. In particular this state stops fluid production the outer pump the inner pump and the blood pump. The state then waits for the pumps to be idle and closes the operation valves before transitioning to the Idle state .

Once the dialysis system is primed with dialysate a user may connect to the system. While waiting for the user to connect the dialysis system may circulate dialysate to keep the dialysate warm and remove any air that arises in the blood tubing set. The system may refresh the dialysate by pumping the blood circuit backwards with respect to normal therapy flow at a predetermined rate e.g. 200 mL min and pumping fresh dialysate from the tank to the blood tubing set at another predetermined rate e.g. 100 mL min . Backwards flow in the blood circuit encourages any air that arises from the dialysate to migrate to the air trap between the arterial and venous lines. Pumping fresh dialysate all the way to the blood tubing set drain refreshes the entire prime.

According to one exemplary implementation there are four different paths through which dialysate may be circulated. These paths are as follows 1 the Dilute Blood Path which is used to keep dilute blood that is in the blood tubing system circulating and warm 2 the Dialysate Path which is used to keep fresh dialysate in the blood tubing set and in the inner pump which would push to the user 3 the Blood Sample Path which is used to circulate the blood tubing set for a blood sample and to keep the fluid in the tank fresh and 4 the Tank Path which is used to keep fluid in the tank fresh.

From the Start state the operation transitions to the Check Tank Level state . This state ensures that the outer pump is stopped and if dialysate is being circulated through the Dialysate Path also ensures that the blood pump is stopped. The Check Tank Level state initiates a tank FMS reading and waits for the tank to be full.

The Park Pumps state which is used only in connection with the Dialysate Path parks the blood pump so that blood pump chamber is full and blood pump chamber is empty.

Likewise the Recirculate Dialysate state is used only in connection with the Dialysate Path. This state uses a flow path through the bottom of the inner pump to the blood tubing set. The blood pump is chamber level driven according to outer pump fill strokes so that the pumps can remain synchronized. If a fluid production operation requests a tank level reading the Recirculate Dialysate state may transition to the Check Tank Level state .

The Recirculate Dialysate state may also monitor aspects related to a user connection to the dialysis system. For example this state may notify the therapy layer when the system is at a predetermined temperature. Thus the therapy layer may notify a user who wishes to connect to the system that the system is not as warm as desired if it has not yet reached the predetermined temperature. In addition this state may perform checks to ensure for example that a user is not connected if the conductivity is out of range or the temperature is too hot. If one of the checks fails the operation will transition to the Stop state .

A patient may be connected after the Circulate Dialysate operation if dialysate is being circulated through the Blood Sample Path or the Dilute Blood Path. Safety checks may be performed the machine layer may send a freeze command to the application and notify the therapy layer if a check fails. For example if monitored sensors such as temperature or dialysate conductivity go out of range a freeze command may be issued and the therapy layer may be notified. The therapy layer may then inform the user and or instruct them to disconnect from the machine.

The Recirculate Ultrafilter Prime state is used to keep fresh dialysate in the tank. In particular this state is used in connection with the Blood Sample Path so that fresh dialysate is kept in the tank while the blood pump is circulating for a blood sample. In this case dialysate should not make it to the inner pump.

The Refresh Inner Pump Ultrafilter Prime Drain state is used to keep fresh dialysate in the inner pump and in the tank. This state is used in connection with the Dilute Blood Path to run the blood pump backwards so that dialysate does not stagnate. This state is also used in connection with Tank Path to keep fresh dialysate in the tank and the inner pump.

The Freeze command which is handled in the Run state is commanded from the therapy layer to freeze the operation. The Freeze state freezes the blood pump and outer pump. The Freeze state may be exited by the Resume command or the Stop command . If a patient connect flag is set during this operation indicating that a user may be connected to the dialysis system the machine layer may freeze itself by transitioning to the Freeze Machine state . This state will ignore all commands until the therapy layer sends another Freeze command causing the operation to transition to the Freeze Therapy state . Likewise if the therapy layer rather than the machine layer sends a freeze command the operation will transition to the Freeze Therapy state

The Resume command which may be handled from the Freeze Therapy state is commanded from the therapy layer to resume the operation from a frozen state. This command resumes the pumps and transitions the operation to its prior saved state. The Stop state is commanded from the therapy layer to cause dialysate to stop circulating and is handled in the Run state . The Stop state stops the blood pump and outer pump. It then waits for the pumps to be idle and closes the operation valves. Once completed the operation transitions to the Idle state .

As discussed herein a Heparin Vial Connection test may also be performed to verify that a vial is attached to the heparin medication infusion spike on the blood pump cassette. A patient is typically not connected during this operation. shows an exemplary implementation of the Check Heparin Vial operation. Throughout this application the words heparin and anticoagulant are used interchangeably. It should be appreciated that reference to heparin is not limited to that particular anticoagulant. It refers to an exemplary anticoagulant that may be suitably substituted for another anticoagulant.

The initial state of the Check Heparin Vial operation is the Idle state . In response to the Check Heparin Vial machine command the operation transitions to the Run state . The Run state catches the Stop command and the Freeze command . The Run state is the super state for all operation code of this operation e.g. start freeze stop . The Start state which is under the Run state is the super state for all running operation code. The Start state stops the anticoagulant pump e.g. anticoagulant pump .

The Check for Vial state opens a flow path to the blood tubing set drain and commands the anticoagulant pump to check the anticoagulant e.g. heparin vial. Once the heparin pump is complete the state checks if the vial is detected and will register a fail if it is not.

The Freeze command is commanded from the therapy layer to freeze the operation. This command is handled in the Run state . The Freeze state freezes the anticoagulant pump. The Freeze state may be exited by the Resume Command or the Stop Command .

The Resume command is commanded from the therapy layer to resume the operation from a frozen state. This command transitions the operation to the Start state which will restart the check for the anticoagulant vial.

The Stop state is commanded from the therapy layer to terminate the test. This state is also called at the end of the operation to insure that all pumps such as the anticoagulant pump are stopped. The state then waits for the pumps to be idle and closes the operation valves before transitioning to the Idle state . If the Stop state is called before the operation finishes the operation will fail.

Other checks of the anticoagulant vial not shown in may also be performed. For example the system may check for 1 an empty anticoagulant vial 2 an occluded anticoagulant vial 3 excessive anticoagulant delivery 4 a leak in the anticoagulant pump valves and or 5 excessive pressure inside the anticoagulant vial.

If an empty anticoagulant vial is detected during therapy the system may halt operation of the anticoagulant pump and alert the patient. This prevents the anticoagulant pump from adding air to the blood flow. Similarly if the anticoagulant vial becomes occluded during a therapy the system may halt operation of the anticoagulant pump and alert the patient.

If the anticoagulant delivered to the patient exceeds the prescribed value by a particular amount e.g. more than 1 mL the system may perform a forced disconnect and rinse back. This mitigates the risk that the machine subsystem executes the anticoagulant delivery erroneously e.g. due to isolated data corruption. In some cases for example where the anticoagulant bolus is potentially unsafe a forced disconnect without rinse back may occur prior to delivering any anticoagulant to the patient.

If any of the anticoagulant pump valves leak fluid while in the closed state and while the patient is connected the system may perform a forced disconnect without rinse back. This mitigates the risk that anticoagulant is pulled from the vial into the blood flow in an uncontrolled fashion. This check may be run frequently during therapy while the patient is connected.

If the pressure inside the anticoagulant vial is observed to be more than a predetermined threshold e.g. 50 mmHg above atmosphere during a therapy the system may perform a forced disconnect without rinse back. The vial pressure may be observed when filling for a basal delivery stroke. This check may protect the patient from an unsafe off label usage.

The Heparin Bolus operation is responsible for administering a heparin bolus to the patient before treatment begins. Conventionally a heparin bolus is administered by a nurse via syringe into an access line. Advantageously the Heparin Bolus operation allows a heparin bolus to be delivered by the dialysis system itself without intervention by a nurse or other individual. shows an exemplary implementation of the Heparin Bolus operation described in connection with .

Referring to the operation transitions to the Run state from the Idle state then to the Start state and finally to the Remove Dialyzer Air state . The Remove Dialyzer Air state mitigates the air at the top of the dialyzer. To do so both chambers of the blood pump are delivered down the dialysate drain. An air settle time helps the air come together before it is mitigated. The left blood chamber i.e. chamber is filled with dialysate. This dialysate is then transferred into the right blood chamber i.e. chamber over the top of the blood pump. The outer pump chamber is left full of fluid so that it can be used to quickly fill blood pump chamber after the air mitigation.

Next the Prep Blood Pump Chamber for Heparin state sets blood pump chamber to atmosphere. To do this the chamber is delivered to a pressure of 0.0. This is done so that the heparin pump can pump the bolus volume into blood pump chamber in the Draw Heparin state . The Fill Blood Pump Chamber with Dialysate state fills what is remaining in blood pump chamber with dialysate so that a known volume can be pumped to the patient.

According to one implementation the bolus is delivered down the arterial line which is a shorter route to the patient s vascular access than the venous line. As a result of the shorter route less fluid needs to be delivered to and subsequently removed from the patient when the arterial line is used. The Deliver Bolus down Arterial Line state delivers both blood pump chambers down the arterial line to the patient. Blood pump chamber which contains the bolus is delivered first. Next blood pump chamber is filled with dialysate from the outer dialysate pump and blood pump chamber is delivered. The net result is that two full blood pump chambers containing the prescribed heparin or about 56 mL of fluid total is given to the patient.

If air is detected during the arterial bolus delivery or if venous delivery is selected by the patient the bolus may alternatively be delivered down the venous line which incorporates air trapping mechanisms or devices. The Deliver Bolus down Venous Line state first delivers blood pump chamber which contains the bolus then delivers blood pump chamber down the venous line toward the dialyzer. The remainder of the bolus is chased down the venous line across the dialyzer by a set volume of dialysate e.g. 200 mL of the outer pump. Before the outer pump is started it may need to be parked since filling the chambers with dialysate could leave it in a state where both chambers are delivered. The Park Pumps state parks the blood pump and outer pump so that one chamber is full and the other is empty.

The Run Outer Dialysate Pump To Drain Hot state is used when the dialysate gets too hot to deliver to the patient. In such a case a path is opened down the dialysate drain through the ultrafilter prime path . Once the temperature of the dialysate is back within range and the heater has cooled off the operation transitions back to its prior state.

The Freeze command is commanded from the therapy layer to freeze the operation. This command is handled in the Run state . The Freeze state freezes the blood pump and outer pump. The only exit from the Freeze state is by a Resume command or Stop command .

Since the patient is connected during the Heparin Bolus operation the safety system is enabled. The machine layer monitors patient connected checks and informs the therapy layer of pass or fail results. If a patient disconnection is detected during the Heparin Bolus operation the machine layer may freeze itself. If this happens the operation will transition to the Freeze Machine state . The operation will remain in this state until the therapy layer sends another Freeze command which will transition the algorithm to the Freeze Therapy state

The Resume command is commanded from the therapy layer to resume the operation from a frozen state. This command which is handled in the Freeze Therapy state causes the pumps to resume and the operation to transition to the saved state to continue the operation.

If the machine layer sees air in the air sensors it will send a freeze command preventing the operation from delivering air to the patient. If air is detected during an arterial line deliver the chambers are forced idle and the remainder of the heparin bolus is delivered down the venous line.

The Stop state is commanded either from the therapy layer or automatically when the when the operation is complete. After all the pumps are stopped and valves closed a transition to the Idle state occurs.

The Empty Tank operation is used to drain a fluid tank of its contents e.g. dialysate water and or citric acid . For example the Empty Tank operation may be used to drain the dialysate tank . Fluid is pumped out of the tank down the dialysate drain. This operation may be performed after a treatment is complete when the patient is not connected to the dialysis system. shows an exemplary implementation of the Empty Tank operation described in connection with .

Referring to the operation transitions to the Run state from the Idle state . The Start state is under the Run state . The Start state transitions to the Empty Tank state once fluid production and the outer pump are idle.

The Empty Tank state configures the outer pump in a manner so that occlusions can be detected and it can be known when the tank is empty. A flow path is opened via the ultrafilter prime line down the dialysate drain. According to one exemplary implementation the pump is started with a flow rate of 1000.0 mL min and is pumped for a total of 40 strokes e.g. 2 Liters to empty the tank. If an occlusion is detected the pump may be stopped. Following the Empty Tank state the operation transitions to Pump a Few More Strokes state .

The Pump a Few More Strokes state is used to ensure that the tank is empty. The same flow path that is used in the Empty Tank state that is the ultrafilter prime line down the dialysate drain is used in this state. According to one exemplary implementation the outer pump is started with a flow rate of 600.0 mL min for a total of 10 strokes. Since the fluid tank is presumed empty air is expected in the drain line. A drain air in line sensor is used to detect the presence of air. If air is detected the Empty Tank operation passes. If air is not detected the Empty Tank operation fails. A failure could indicate that the drain line is occluded such that the tank did not empty or that the drain air in line sensor is not working.

In response to the Freeze command the Freeze state freezes the outer pump. This state may be exited by either the Resume command or the Stop command . The Resume command resumes the operation from the frozen state. In particular the outer pump is restarted and transitions to the state that was saved when the Start state was exited. The Stop state stops the outer pump waits for the outer pump to be idle and closes the operation valves. The operation then transitions to the Idle state . If the Empty Tank operation is stopped prematurely the operation fails.

Attention is now turned to the Therapy Applications shown in . The Therapy Applications shown and described in connection with run state machines that implement therapies implemented by the Machine Controller and I O Server Process. The state machines may perform such functions as treatment preparation patient connection dialysis solution infusion patient disconnect recycle preparation disinfect rinse and disposable replacement. The Therapy Applications also comprise a master control module responsible for sequencing the activity of all other therapy applications that prepare for and deliver daily treatment.

Referring to the Therapy Applications provide an interface that allows the UI Model to start stop and configure therapies as well as report therapy status. The Therapy Applications also interface with the Machine Controller. In particular the Therapy Applications issue commands to and request status from the Machine Controller in order to implement the therapy operations. In order to access patient therapy and machine information the Therapy Applications interface with the database . It also uses this interface to store treatment status information.

Described below are individual applications of the Therapy Applications . These applications are 1 Recycle Preparation 2 Clean Blood Path 3 Disinfect 4 Rinse Endotoxins 5 Treatment Preparation 6 Patient Connect 7 Dialyze 8 Solution Infusion 9 Rinseback 10 Take Samples 11 Replace Components and 12 Install Chemicals.

Next the system prompts the user to remove and discard the chemical concentrate cartridge. The system first drains any remaining chemicals to minimize any spillage upon removal. The user may elect to bypass this draining step if they wish to remove their cartridge immediately. Once the cartridge is removed and discarded the user prepares the system for recycling by installing the chemical bypass connector.

During chemical cartridge drain and removal the system simultaneously performs pressure tests to ensure that the operator has connected the blood tubing set BTS properly including installing a vial on the heparin connector. In this way the operator can be notified of and correct any problems while they are present. Then the system can successfully navigate through the remainder of recycling unattended. Testing is achieved by sequentially pressurizing the various sections of the BTS to ensure there are no kinks clamps closed or clots. BTS integrity can also be checked by pressurizing the entire BTS and dialyzer with air after the dialyzer has been wet and monitoring for a threshold pressure decay value that would indicate a leak in the blood tubing blood tubing connections dialyzer or dialyzer connections. The disinfection ports are also checked to confirm that the venous and arterial lines are securely locked into their ports. If any of these tests fail the user may be notified of the specific failure and instructed on how to correct it. The tests are repeated until all have passed.

If the dialyzer and blood tubing set have reached the treatment or disinfection usage limits or the operator chooses to replace them then they may be replaced prior to recycling. If the ultrafilter has exceeded the ultrafilter transmembrane pressure TMP or impedance test limit reached its disinfection usage limit or the operator chooses to replace it then the ultrafilter may be replaced prior to recycling. To replace these components the user may invoke the Replace Components application described in connection with .

With reference to Recycle Preparation application is shown. The Monitor state monitors for a Pause request or a dialysate leak . Further during this state the system will confirm that the doors are closed. The fact that the doors are closed implies that the patient is not currently connected to the machine. This check will be performed in the Checking Doors state . If the doors are closed the process proceeds to the Post Treatment Data Entry state .

The Post Treatment Data Entry state may prompt the patient operator to enter miscellaneous post treatment data. If system indicates that pre treatment data was entered the system will prompt the operator patient to enter the post treatment data. The following post treatment data may be requested Post Treatment Weight Blood Pressure and Pulse Rate. The information from these entries may be included in a systems log of treatment report information. In addition the system will not require this information to be entered in order to continue on with the recycling process. If the system indicates that pre treatment data was not entered the system will not prompt the operator patient to enter the post treatment data.

The Check Source And Drain state confirms that the inlet water source and drain are properly connected. This ensures that the system can successfully perform recycling. The Check Source And Drain Recovery state provides the operator with information pertaining to a source drain failure detected as well and required corrective actions. For example the user may be notified that the inlet water source or drain is not installed properly and may be instructed on how to correct the problem.

The Chemical Concentrate Removal Check BTS state will run two operations concurrently. Completion of both operations will allow the system to continue on with the recycling operations. The operations that take place during this state are disposal and removal of the chemical concentrates and checking the BTS connections. The BTS and Dialyzer replacement is also evaluated at this time. In the first operation the Checking Chemical Concentration Presence state detects whether chemicals are present or not to determine the next step. In particular through the use of an air integrity test the system will be able to detect the presence of the chemical concentrate container. This may be achieved for the bicarbonate cartridge for example by applying a negative pressure or vacuum to the air inside the bicarbonate chemical cartridge isolating cartridge while in fluid communication with water pump and monitoring the pressure in pump to determine whether the cartridge is able to hold a negative pressure. Applying a negative pressure may be preferable to a positive pressure when testing the integrity of the cartridge connections in order to avoid unintended external leaking of chemicals if the cartridge connections are loose .

For example referring to and assuming that bypass connector is not present a path for air to be introduced into the bicarbonate water pump which provides water to bicarbonate cartridge to create a saturated solution of bicarbonate can be created by opening the dialysate tank vent valve dialysate tank recirculation valve disinfection path valve and the inlet valve of the bicarbonate water pump . The path may be isolated by closing dialysate tank inlet valve dialysate drain valve water inlet valve and ultrafilter priming valve . Bicarbonate water pump may then be actuated to fill the pumping chamber with air. The inlet valve of bicarbonate water pump may then be closed. The pressure in the bicarbonate water pump can then be set to atmosphere. Next the inlet valve of the dialysate mixing pump may be closed whereas the inlet valve of the bicarbonate metering pump and the dialysate mixture drain valve are opened. Then using the bicarbonate metering pump outlet valve as an inlet valve to dialysate mixing pump air may be pumped out of bicarbonate cartridge to drain. The decreasing pressure in bicarbonate cartridge can be monitored by the pressure transducer connected to bicarbonate water pump . When a pre determined negative pressure has been generated the dialysate mixing pump outlet valve can be closed and the pump turned off. The pressure transducer can then be used to monitor the pressure in bicarbonate water pump pump chamber and bicarbonate cartridge to ensure that the vacuum generated is held. If not an alarm condition may be triggered by the controller and an appropriate message may be provided to the graphical user interface to advise the user.

In the Chemical Drain state the system will perform the necessary operations to drain any residual chemical concentrates from the containers. The purpose is to make removal and disposal of the containers cleaner and easier producing as little waste as possible. The user may be prompted that they can choose to bypass draining. The Removal of Chemical Concentrates state provides instructions to the user to remove the chemical concentrates and close the chemical bypass doors and may provide instructions. Included in the instructions may be how to configure the machine so that it will be able to effectively disinfect the chemical concentrate ports. The Wait for Check BTS state is an end point for the Chemical Disposal and Removal operations. The system will remain in this state until other concurrently performed operations are complete.

Turning to the second operation that is run by the Chemical Concentrate Removal Check BTS state during the Check BTS state the system evaluates whether BTS and Dialyzer replacement is required. An option may also be displayed allowing the operator to choose dialyzer and BTS replacement. This option may include data entry as to the clotting status of the dialyzer and may remain available to the user until the Chemical Concentrate Removal Check BTS state is complete. If no replacement of the BTS and Dialyzer is required or requested the system ensures that the BTS is properly connected for recycling and then recirculates the BTS fluid to prevent clotting. The BTS Connection Test confirms that the BTS has been connected properly for recycling. This may include ensuring that the patient connectors have been properly installed into their disinfection ports that the clamps have been opened and the BTS is not kinked and that the BTS is properly installed in the air detectors and occluders. The Connection Recovery state provides the user with information that pertains to the failure detected as well as corrective actions that are required. For example the user may be notified that the BTS is not installed properly and indicate the specific problem. The notification may include corrective actions that should be performed based upon a failure code from the BTS Connection test . A DC Connection test may be performed to verify that the patient has plugged the vascular access connectors of the blood tubing set back into the DCA DCV ports of the machine for rinsing and disinfecting after a treatment session. A Heparin Vial Connection test may also be performed to verify that a vial is attached to the heparin medication infusion spike on the blood pump cassette. This ensures that disinfection fluid can enter and exit the vial and clean the vial spike and heparin fluid path in the process.

The Recirculate BTS Fluid state will start recirculating the fluid in the BTS to prevent the residual patient blood from becoming stagnant and developing clots. The system may be configured such that this process can only be performed once the system has detected that the BTS connections are properly inserted into the disinfection ports. The Wait for Chemical Concentrate Removal state acts as a wait state that will allow the other operations that are concurrently taking place to complete. Once the system indicates that chemical concentrate removal is complete the system will continue.

Regardless of which components are being replaced the Check Component Replacement state may act as a transition point for the component replacements. It also evaluates whether ultrafilter replacement is required. If the ultrafilter has exceeded its TMP test limit or reached its disinfection usage limit then ultrafilter replacement may be required. If BTS and dialyzer replacement was previously determined to be required or was requested by the user then the BTS and dialyzer should be replaced. If any replacement is required this data is transferred to the Pause state where Replace Components executes the activity. Once the replacement process has been completed by the system and the operator the Recycle Preparation application will resume.

The Final Door Check state will perform a final check of the doors to confirm that the doors are still closed. This is intended to prevent any unnecessary alarms that might prevent the machine from recycling. The Doors Open Recovery state notifies the patient the doors are open and prompts the user to close the door.

The Pause state will halt operation and may allow the patient to choose to perform additional activities. The Stop for Pause state halts all machine operations. For example the state may stop all flows. The Pause Menu state allows the patient to choose to perform additional activities and may display the following options Replace Components Shutdown Power Standby and Resume Recycling Prep .

The Dialysate Leak Alarm state will stop operation and notify the user that a dialysate leak has been detected. The Leak Resolution state waits for the user to clear the leak and for an indication from the user of the same.

Next a method may be performed to clean blood and dialysate from pathways prior to disinfection. Residual blood and dialysate left over from treatment is rinsed from the dialysis unit prior to performing disinfection. It is desirable to remove these substances because the disinfect process makes subsequent removal more difficult. Further is desirable to remove residual blood and dialysate as they are sources of bacteria. Special care may be taken to clean the dialyzer effectively so that its performance degrades as little as possible over multiple reuses.

Cleaning the blood and dialysate pathways may be accomplished by flushing a certain amount of fluid through those pathways and directing that fluid to a drain. Cleaning the blood pathways may take more effort and require more thoroughness than cleaning the dialysate pathways due to the blood and blood clots that reside in the blood pathways. Clots typically attach themselves to the venous and arterial headers of the dialyzer which may reduce dialyzer efficiency by obstructing its fibers. Cleaning the arterial and venous headers may be difficult because their large volumes provide spaces of low flow where clots can migrate. In order to remove these residual clots from the dialyzer headers it is desirable to first loosen or dislodge them. This may be accomplished by pushing fluid both through the dialyzer and across it while increasing or maximizing flow rates thereby creating or maximizing turbulence. Turbulence or other disruption in flow may also be caused by the addition of air to the BTS and circulating the air containing liquid so as to increase mechanical action in loosening clots or other debris. Blood clots may also be loosened by moving fluid inside the BTS back and forth by controlling each blood pump chamber individually. In this case the inner dialysate pumps and the BTS drain are closed and blood chamber one of the blood pump pods is made to deliver fluid as blood chamber the other blood pump pod fills. Once both are idle blood chamber fills as blood chamber delivers. This cycle may be repeated a number of times e.g. approximately 20 cycles . To introduce air into the BTS air may be drawn through the anticoagulant air filter see filter in by the anticoagulant pump and subsequently provided to one or both of the blood pumps . For example the valve between the pump and the air filter may be opened and the pump operated to draw air into the pump with the valves between the pump and the anticoagulant source and the main blood circuit closed. Thereafter the valve between the pump and the air filter may be closed and the valve between the pump and the main blood circuit opened to allow the pump to deliver the air to one of the pumps or other portions of the BTS. Any fluid in the BTS that is displaced by the air introduced into the BTS may be discharged to the drain . With air introduced into one or both of the pumps the blood pump s can then be run for a number of cycles e.g. 40 cycles at a specified rate and direction e.g. 500 ml min in a backwards direction .

The Rinse Pathways state shown in rinses all fluid pathways in order to flush residual blood and dialysate out of the system. This state will also start fluid production. With reference to the Recirculate state recirculates fluid in both the blood circuit and the dialysate circuit. The Blood Circuit Drain Arterial state flushes fluid out through the arterial blood circuit line to a drain. The Blood Circuit Drain Venous state flushes fluid out through the venous blood circuit line to drain. Flushing blood out with physiological fluid such as dialysate prior to sending water to the BTS is done in order to minimize the hemolysis and foaming that occurs when blood is exposed to water.

A swishing procedure in which the cleaning fluid e.g. water is pushed back and forth within a fluid flowpath may improve the dislodgment of debris e.g. blood components or proteinaceous material from the flowpath. The swishing procedure may be further enhanced by using an increased pressure gradient in the flowpath by having a system controller direct the application of a negative pressure to a receiving or downstream pump and a positive pressure to a delivering or upstream pump. In an embodiment the flow velocity of the water used to clean the fluid flow paths in a cassette housing a pair of reciprocating positive displacement pumps in a connected tubing set and in any other connected components may be enhanced by applying a negative pneumatic pressure to the diaphragm of the receiving or downstream pump whose pumping chamber has been emptied of fluid and then applying a positive pneumatic pressure to the diaphragm of the delivering or upstream pump whose pumping chamber has been filled with fluid . The valving within the flowpath is arranged to cause the upstream pump to deliver its fluid charge ultimately to the downstream pump that is under negative pressure. During this time the valves in the flowpath defining a desired cleaning path are open while valves in other flow paths remain closed. The application of positive and negative pressure on the pumps may be reversed to cause a reverse high pressure fluid flow from one pump to the other in order to swish the fluid back and forth and increase the effectiveness of the cleaning. This cycle may be repeated a pre determined number of times to ensure adequacy of the cleaning process. In an alternate embodiment the increased pressure gradient may be created by applying a negative pressure on the downstream pump while applying a positive pressure on the upstream pump while the pump inlet and outlet valves are closed and then opening the valves corresponding to the flowpath that is intended to be cleaned.

Referring to in order to dislodge debris or proteinaceous material from the blood pump cassette a system controller may establish an isolated flow path that includes the outlet valves or the inlet valves of the blood pump cassette . Fluid present in one of the pump chambers may be swished back and forth between the two pumps using an increased pressure gradient by applying a negative pressure to the downstream pump diaphragm and applying a positive pressure to the upstream pump diaphragm. The pressure gradient may then be reversed to allow enhanced flow velocity in alternating directions along the flowpath being cleaned.

For example to clean outlet path see a flowpath is created by closing the inlet valves of the blood pump cassette and the flow path leading to the dialyzer. The flow path leading to the dialyzer may be closed in a number of ways one of which is accomplished by activating the arterial and venous line occluder and closing off flow through the dialyzer by closing valves associated with the inner dialysate pumps e.g. valves and the ultrafiltration pump e.g. valve and by closing valves associated with the balance chambers e.g. valves see . The system controller may control the opening and closing of the various valves above and may then direct the application of a negative pneumatic pressure on pump for example and finally direct the application of positive pneumatic pressure on pump . In an embodiment negative pressure or vacuum is first applied placing the fully extended diaphragm of pump under tension. After a short time e.g. about one second to allow for full development of negative pressure from the diaphragm of pump through the flowpath to be cleaned the pneumatic manifold valve supplying pump may be actuated to supply positive pressure on the fully retracted diaphragm of fluid filled pump . The pre existing negative pressure on pump magnifies the pressure differential in the selected flow path and pump rapidly delivers its chamber of fluid to the pumping chamber of pump while producing highly turbulent flow through the selected path see and enhancing the dislodgment of any debris therein. The time delay between the application of negative pressure on the downstream pump and positive pressure on the upstream pump may depend among other things on the length of the fluid path between the upstream and downstream pumps. The controller may then reverse the application of positive and negative pressure on pumps and once the fluid in pump has been transferred to pump . In this example the controller causes the application of a negative pressure on the diaphragm of pump adds a short delay e.g. one second and then causes the application of positive pressure on the diaphragm of pump causing a reversal of flow along path under a heightened pressure differential. This cycle may be repeated several times to ensure a thorough washing of path .

Debris dislodged in path may then be sent to drain via arterial line see or venous line see also . Preferably line is used first in order to prevent any large fragments of debris from passing through dialyzer on its way to drain. Whichever pump or contains the residual fluid from the washing procedure may deliver the fluid to line thence see via that pump s inlet valve or . Pumps and may then be re filled with water from dialysate tank via dialyzer this water then being used for repeated rinses to drain for a pre selected number of times. This can be accomplished by the controller directing the opening of valves and or see. and the activation of outer dialysate pump set to draw water from dialysate tank and deliver it through dialyzer to flowpath see . In the illustrated embodiment shown in for each rinse to drain via arterial line the controller is programmed to open occluder close venous line valve and open drain valve see . Of course the specific opening and closing of valves may vary depending on how the hemodialysis flowpath has been structured and where valves have been positioned.

An additional rinse to drain may optionally be performed via line to dialyzer through line then to venous line see . In this case pumps and can be primed with water through dialyzer from dialysate tank through the opening and closing of the appropriate valves. Both pumps and may then deliver fluid to venous line by closing inlet valves opening valves blocking flow across the dialyzer membrane by closing the appropriate valves on the dialysate side opening occluder venous line valve and drain valve . This sequence may be repeated a pre selected number of times.

As shown in the procedure to clean flowpath may follow an equivalent procedure to that used for flowpath this time having the controller direct the closure of outlet valves and the opening of inlet valves . The back and forth swishing procedure between the pumps and may be enabled by alternating the application of negative and positive pressure to the respective pumps in order to enhance the pressure gradient in alternating directions. Following the high pressure swishing of fluid in flowpath a rinse to drain via arterial line may be performed a pre determined number of times as discussed above. Optionally a rinse to drain may also be performed via venous line following a procedure similar to that discussed above.

The high pressure cleaning procedure may also be applied to the arterial and venous tubing and any attached components such as the dialyzer and an air trap . As shown in a flowpath comprising the inlet path of one pump and the outlet path of the opposing pump allows for a back and forth swishing procedure under high pressure involving the entire arterial and venous blood tubing. In this case the circuit is completed by having the controller close drain valve and open venous line valve . The inlet path of the pump or may be selected as long as the outlet path of the opposing pump or is also selected. In the example illustrated in the inlet path of the pump and the outlet path of the pump have been selected. Alternatively the inlet path of the pump and the outlet path of the pump may be selected. As in the procedure described to rinse to drain via the venous line flow through the dialyzer to the dialysate circuit is prevented by the closure of the appropriate valves in the flowpaths on the dialysate circuit side of the dialyzer . As described above for the cleaning of flowpaths and the upstream pump or is charged with a chamber full of cleaning fluid e.g. water with its diaphragm in a retracted position and the opposing downstream pump or is empty with its diaphragm in an extended position. The controller first directs the application of negative pressure to the downstream diaphragm and then directs the application of positive pressure to the upstream diaphragm with the appropriate valves closed such as for example valves and in . The controller may then switch the application of the positive and negative pneumatic pressures to cause a reversal of fluid flow through the selected flowpath under high pressure. The cycle may be repeated a pre determined number of times to achieve an adequate amount of cleaning of the venous and arterial lines. Finally the venous and arterial lines may be rinsed to drain using the rinsing procedures described above.

The Dialysate Circuit Drain state flushes fluid out to drain from the dialysate circuit while recirculating fluid in the blood tubing set. The Fluid Prep Circuit Drain state flushes fluid out to drain from the fluid preparation circuit while reverse recirculating fluid in the blood tubing set. The Recirculate UFTR state recirculates fluid through the ultrafilter flush port while recirculating fluid in the blood tubing set. The fluid optionally may be recirculated to the dialysate tank or to drain. In choosing whether to recirculate fluid to the dialysate tank one consideration is the amount of time spent in this state because as dialysate ages some of its characteristics such as pH may change which may prompt the system to direct the fluid to drain in favor of continued production of fresh dialysate. The Dialysate Tank Upper Level state maintains the dialysate tank at a full level. Cycling the fluid level in the tank up and down acts to rinse the tank. The Dialysate Tank Lower Level state maintains the dialysate tank at a near empty level.

Either at this stage or near the beginning Disinfect the metering pump e.g. heparin pump on the blood pump cassette may be directed to empty the medication e.g. heparin container. The medication may be replaced with either dialysate or water but preferably the container is filled with air in preparation for the instillation and withdrawal of disinfection fluid during Disinfect. If the medication is heparin any residual heparin remaining in the container or vial after a treatment session can be emptied into the BTS at this stage. Circulating the residual heparin through the BTS during Clean Blood Path or Disinfect may help to reduce clot formation and thus increase the efficiency of the cleaning process. Alternatively the heparin may be discarded to drain.

Referring again to the Stop Rinse state stops the rinsing process. The Completion state finishes the application by emptying the dialysate tank. The Occlusion Recovery state handles the correction of any occlusions that have been detected by the system. The Occlusion Alarm state will stop Clean Blood Path and notify the patient there is an occlusion. The Occlusion Resolution state waits for the patient to clear the occlusion.

The Inlet Water Recovery state may handle the correction of any inlet water occlusion that has been detected by the system. The Inlet Water Alarm state will stop Clean Blood Path and notify the patient there is a problem with the incoming water. The Fill Dialysate Tank state attempts to fill the dialysate tank. The Pause state will halt operation. Additionally the patient can choose to perform additional activities. The Stop for Pause state will halt all machine operation. The Pause Menu state allows the patient to choose to perform additional activities. The following options may be displayed Take Samples RO Sample Replace Component Power Standby Shutdown and Continue Operation .

The Dialysate Leak Alarm state will stop operation and notify the patient a dialysate leak has been detected. The Leak Resolution state waits for the patient to clear the leak and may allow the continue button to be displayed on the GUI.

Following the recycle preparation and the cleaning of the blood path the Disinfection Application may implement the disinfection of fluid pathways. Disinfection is performed to provide fluid that is of infusible quality. To achieve this goal the disinfection process may kill all vegetative bacterial cells fungi and all small or non lipid viruses. Because the machine is generally dedicated to one patient it is not imperative that the disinfection process eliminate viral contamination. Switching the machine between patients may require steps beyond this process. Disinfection may be achieved by bringing all fluid pathways to a certain temperature and holding that temperature for a minimum amount of time. For example water circulated through the dialyzer blood treatment set ultrafilter and dialysate set may be heated to a temperature of 85 C. 5 C. for approximately one hour. Hot water pasteurization may be suitable for high level disinfection. Exemplary conditions for hot water pasteurization may comprise a temperature of approximately 68 C. for a minimum of about 30 minutes. The Disinfect state is able to monitor the temperature at various points in the system and delays disinfection until the sensors are at least about 1 C. above the target temperature for example at pre determined temperature thresholds such as 85 degrees C. and 75 degrees C. The state monitors the temperature at various points and takes action to increase fluid heating if any sensor falls below the target temperature for example for more than 10 consecutive seconds.

The various circuits through which fluid is routed during disinfection may be arranged in any suitable way e.g. to help ensure that all desired portions of the system reach a suitable temperature for a suitable period of time to help flush endotoxins and other debris from the system to help ready the system for a next treatment and so on. In one illustrative embodiment and with reference to a primary flow path of fluid during disinfection may include 

During disinfection fluid may be circulated around the main flow path continuously with some amount of the disinfecting liquid being optionally directed to the drain e.g. to help purge endotoxins and other materials and help disinfect additional flow circuits of the system. However in some embodiments no liquid exits or enters the system during disinfection. Instead liquid may be directed to drain during a cleaning or rinsing operation prior to or after disinfection. For example liquid may be directed from the venous and arterial patient conduits to the drain e.g. as shown in prior to during or after disinfection. In addition liquid flowing from the mixing circuit to the dialysate tank may be at least partially directed along a path as shown in and or liquid may be directed from the ultrafilter to along a path as also shown in during disinfection as desired. While flow through these secondary pathways may be intermittent the circuits through which fluid is moved during disinfection may include those circuits shown in bold in .

To cause flow in the main disinfection flow path all of the pumps in the mixing circuit except for the mix water pump see pump in the pumps in the directing circuit the bypass pump in the dialysate circuit and the blood pumps in the blood circuit may run continuously. The mix water pump and the inner dialysate pumps may remain completely open to accommodate continuous flow through the main disinfection flow path. In addition various valves are opened and closed to cause desired flow in the system e.g. to cause flow into and out of the balancing chambers of the dialysate circuit . Flow may also be permitted in the paths and by suitable valve control to allow these flow paths to received disinfecting fluid. Although the mix water pump may normally remain open the pump may be exercised along with suitable valve control to ensure that disinfecting fluid flows into and out of an accumulator if provided. See . 

Flow through the heater in the directing circuit allows the heater to heat the liquid to a suitable temperature for disinfection e.g. to 85 degrees C. 5 degrees. The control system may monitor the fluid or other system component temperature at a plurality of locations e.g. to help ensure that portions of the system are exposed to suitably high temperatures for a sufficient time period to achieve disinfection. For example the temperature immediately downstream of the mix water pump the temperature at the mixing chamber for acid with water bicarbonate the temperature at the ultrafilter and or the temperature at a front panel connection where the venous and arterial conduits are connected may be monitored. In one embodiment if any of these temperatures vary relative to each other or relative to some other reference by more than about 5 degrees C. the system may take suitable action such as alerting a user to a problem stopping the disinfection process attempting to identify a problem causing the temperature variation etc. Temperature variations may indicate that flow in one or more system components is not suitably high or low which may be caused by a pump valve or other malfunction a clog or kink in a flow line or other problem. When temperatures at a desired number of system locations have exceeded a threshold such as 85 degrees C. for fluid temperatures in the main flow path and 75 degrees C. for a system front panel temperature the system may start a time accumulation and continue disinfection until a desired time such as 1 hour has elapsed. If at any point in the disinfection process a temperature at one or more locations drops below a particular value such as below 76.5 degrees C. for fluid temperatures in the main flow path or 67.5 degrees C. for a temperature at the system front panel the system may take suitable action such as discontinuing disinfection preventing future use of the system until a repair or other correction is made and the system successfully completes a disinfection process notification of a user or other. Similarly if any system temperature exceeds a particular value such as 100 degrees C. the system may take suitable action such as discontinuing disinfection preventing future use of the system prior to system repair etc.

As mentioned above the anticoagulant vial shown for example in may be emptied prior to disinfection during disinfection and or after disinfection. In addition disinfecting liquid may be introduced into the anticoagulant vial during the disinfection process e.g. to help raise the temperature in the vial to a desired level. Emptying of the vial may be done by forcing air into the vial so as to pressurize the vial and then releasing the pressure to cause the pressure to force any liquid in the vial to exit the spike . Disinfecting liquid may be introduced into the vial by lowering a pressure in the vial e.g. below atmospheric pressure and pumping liquid into the vial. Subsequently the vial may be emptied of the disinfecting liquid.

In the Monitor state the Fill Tank state starts reverse osmosis RO water production and fills the tank prior to priming the flow path. The Prime Flow path state primes the entire flow path with water in preparation for disinfection. The Disinfect Flow path state oversees disinfection of the machine and determines when it is complete. It starts flows and recirculates fluid in both the blood circuit as well as the dialysate circuit. Disinfection may be deemed complete when all temperature sensors remain at least 1 C. above the target temperature or in another aspect at or above a threshold temperature at the heater e.g. 95 degrees C. for a selected number of consecutive minutes. Of course alternative parameters may be used to deem the disinfection complete. When such a determination is made the event Disinfect Complete is generated. The Warm Up state monitors the temperature at various points and waits for portions of the dialysis unit to heat up. When all temperature sensors are at least 1 C. above the target temperature the event Flowpath At Temp may be is generated. The Hold Temperature state monitors the temperature at various points and takes action if the monitored temperatures drop too low. For example the event Flowpath Below Temp may be generated when the temperature at any sensor falls below the target temperature for more than 10 consecutive seconds. Other parameters may alternatively be used. The Empty Tank state empties the dialysate tank. In this way the drain line receives a final round of disinfection. Further an empty tank end condition allows for future applications to start with a known tank level. The Done state is the completion state for Disinfect.

The Occlusion Stopping state stops all flows and notifies the user that an occlusion has been detected. The Occlusion state waits for the user to indicate that the obstruction has been cleared. Once the User indicates that the problems have been corrected the event User OK is accepted. The Doors Open Stopping state stops all flows. The Doors Open state prompts the user to close the doors of the dialysis unit. Once the user indicates the doors have been closed the event User OK is accepted.

Referring now to the pause behavior will be discussed. The Pause Wait for Stop state waits for all operations to stop. When the machine is stopped the event is generated. The Pause Wait For User Choice state prompts the user to choose the next step and waits for the user to choose what they want to do. The patient will have the following options Take RO Sample Power Standby and Shutdown . The User Take RO Sample state waits while the user takes an RO Sample the Power Standby state waits for Power Standby and the Shutdown state waits for Shutdown. The user may also select a Resume operations option to generate a Resume Requested event .

Following disinfection of the fluid pathways endotoxins and dead biofilm may be rinsed from the pathways via the Rise Endotoxins Application. Endotoxins are part of the outer cell wall of bacteria and are released when bacteria are killed. Biofilm is a complex collection of microorganisms that attach to available surfaces. While the disinfection process kills viable biofilm bacteria it may not remove all the biomass components including endotoxins.

To remove dead biofilm and endotoxins a certain amount of fluid is flushed throughout the flow path at a certain flow rate. This application is designed to rinse each tubing segment with at least three times the holding volume of that segment although other implementations are possible. According to one exemplary implementation the dead biofilm may be removed to achieve a Reynolds number of at least 100. According to another exemplary implementation the Rinse Endotoxins application may be designed to achieve a Reynolds number of 200 or more.

Each of the remaining states are alternative pathways of the flow path that allow certain segments to be drained. The subsequent states will be performed for a percentage of the time or a percentage of fluid delivered. The Dialysate Circuit Drain state flushes fluid out to drain from the dialysate circuit while recirculating fluid in the blood tubing set. The Fluid Prep Circuit Drain state flushes fluid out to drain from the fluid preparation circuit while reverse recirculating fluid in the blood tubing set. The Ultrafilter Recirculation state recirculates fluid through the ultrafilter flush port while recirculating fluid in the blood tubing set. The Blood Circuit Drain state flushes fluid out through the blood circuit to drain. The Dialysate Tank Upper Level state maintains the dialysate tank at a full level. Cycling the fluid level in the tank up and down acts to rinse the tank. The Dialysate Tank Lower Level state maintains the dialysate tank at a near empty level.

The Empty Tank state removes any residual dialysate from the dialysate tank by sending it to drain. The Occlusion Recovery state notifies the user that an occlusion has been detected but does not stop any flows. The Pause state will halt operation. Additionally the patient can choose to perform additional activities. The patient will have the following options Replace Components ultrafilter or Dialyzer blood tubing set Take Samples RO Sample Restart Recycling Power Standby and Shutdown.

The Treatment Preparation application performs a series of actions that prepare the system to perform a dialysis session. During this application the chemical concentrates are installed dissolved and mixed to produce the prescribed dialysate composition. The system also tests the integrity of the ultrafilter the dialyzer and blood tubing set as well as key valves pumps and pneumatics. Fresh dialysate is used to fully prime the system and then flush the blood tubing set and dialyzer. Further during this application the clearance of the dialyzer and the transmembrane pressure of the ultrafilter are tested and the protective systems are self tested by simulating trigger conditions through electrical offsets.

When the user requests that a dialysis session be initiated the system will allow the user to collect any scheduled samples. The user is also prompted to install their prescribed chemical concentrate cartridge. To mitigate possible user errors the system prompts the user to verify that their chemical concentrate cartridge matches their prescription. Furthermore the system checks to ensure that the cartridge is present and installed properly once the user indicates it to be so.

Reverse osmosis water is added to the powder chemicals and they are agitated to uniformly dissolve them. Once the powder chemicals are dissolved they are mixed with the acid concentrate and the conductivity of the finished dialysate solution is checked against the expected conductivity. Acceptable dialysate is routed to the dialysate tank while unacceptable dialysate is routed to drain.

While the dialysate is being mixed a series of integrity tests are performed. In each case the component under test is pressurized and then isolated while the pressure decay is measured over time. If pressure escapes too quickly the component fails the test and should be replaced. The dialyzer blood tubing set and ultrafilter are generally replaced by the user while other items are generally replaced by service personnel. The functionality of the blood line clamps is verified to ensure that the system can successfully isolate the patient from the machine in the event of a hazard detection. Daily integrity testing of the ultrafilter is desirable because repeated heat disinfection and high pressure flow may damage the filter fibers. If the ultrafilter fails integrity testing endotoxins may be present downstream including the dialyzer and blood tubing set. Therefore all three components should be replaced in this case. Next daily integrity testing of the dialyzer and blood tubing set is desirable because repeated treatments and heat disinfections may damage these disposables. A broken dialyzer fiber could cause a blood leak out of the blood side of the dialyzer and into the system and or compromise its ability to prevent endotoxins from crossing from the dialysate side of the dialyzer and into the blood.

Key valves pumps pneumatics and various replaceable cartridges are tested using pressure and vacuum tests. Either a pressure or a vacuum may be delivered to the component in test and then isolated while the pressure decay is measured over time. If pressure escapes too quickly the component fails the test indicating that it should be replaced.

The system is primed with the fresh dialysate. The dialyzer clearance is measured to determine whether its solute removal performance is acceptable. As the dialyzer is reused the fibers can become clogged with blood clots and biofilm reducing the effective surface area available for solute transfer diffusion and convection . As this happens the dialyzer s ability to clear the blood of toxins is reduced hence the term clearance. If the clearance value has declined more than the allowable prescribed percentage the operator may be notified and replacement may be performed following the completion of treatment.

The ultrafilter transmembrane pressure TMP may be tested daily to ensure that it does not exceed the maximum operating limit. The TMP limit is typically a manufacturer s specification used to prevent damage to the ultrafilter fibers or housing which could lead to an external leak or endotoxins crossing the ultrafilter. Over time the ultrafilter gradually becomes clogged with biofilm and other debris which causes the pressure drop across its fibers to increase. The TMP test sends the maximum system flow rate used through the ultrafilter and measures the pressure drop. If the pressure drop exceeds the maximum operating limit the ultrafilter should be replaced following the completion of treatment.

The reverse osmosis water in the dialyzer and blood tubing set should be replaced with physiological fluid prior to treatment in order to prevent hemolysis. Further any residual ethylene oxide ETO that may be present in the dialyzer prior to treatment should be flushed out in order to prevent First Use Syndrome 1 FUS 1 . Since dialysate is a microbial growth medium the blood tubing prime is late in the application process to reduce stagnant time in the set.

Protective system self tests may be performed. This is accomplished by creating offsets in safety sensors to simulate unsafe conditions and then confirming that each protective system reacts as intended.

Upon successful completion of the Chemical Presence Test the system will transition to Chemical Dissolution and Integrity Tests . During the Chemical Dissolution and Integrity Tests state the system will start the process of dissolving and combining the chemical concentrates to achieve the prescribed dialysate prescription. In addition this state will perform routine daily integrity tests of the particular components. The actions of Dialysate Preparation and performing the Integrity Tests will be performed by the system concurrently to use time more efficiently.

The Integrity Tests state will handle the integrity testing of the Ultrafilter Blood Tubing Set and Dialyzer and the dialysate circuit. The Ultrafilter UFTR Integrity Test verifies the integrity of the Ultrafilter. The water in the housing is forced out and then the air is pressurized and held against the fibers from the outside. If the allowable decay limit is exceeded the filter should be replaced. During this state in the event that the UFTR integrity test returns an indication that the test has failed the system will relay this information to the user. The user will be instructed to Replace the UFTR via the transition to Replace Components. Upon completion of the installation of the new ultrafilter the system will re perform the integrity test and resume normal operation. The Blood Tubing Set BTS Dialyzer Integrity Test sub state is intended to test the integrity of the Blood Tubing Set and Dialyzer. This is accomplished by generating a pressure and then measuring the decay. If the dialyzer blood tubing set fails the integrity test the user is notified to replace the dialyzer and blood tubing set. During this state if the system returns a Failed status for the BTS and or Dialyzer Integrity the system will notify the operator that the BTS and or Dialyzer Integrity test failed. The user will be provided with information and the ability to replace these components through the Replace Components option. Once the component s have been replaced the system will re perform the integrity test. If desired a general system integrity test may be performed during a Valves Pumps Pneumatics Integrity state .

The Integrity Test Failure Recovery state provides instructions to handle any integrity test failures identified during the integrity tests. If the system indicates that there was an integrity test failure the user will be notified by the system of the failure as well which component failed. The user may then perform the necessary actions to perform the replacement. Upon the user s indication that the new component has been installed the system will resume normal operation.

The System Prime with Dialysate state will perform the necessary actions to prime the system with dialysate. This state includes a Prime with Dialysate state a Dialyzer Clearance state an Ultrafilter Transmembrane Pressure UFTR TMP state and a Flush ETO Prime state . The Prime with Dialysate state begins chemical production and primes the system with dialysate. The Dialyzer Clearance state quantifies the amount of sodium clearance used as a surrogate for urea clearance that can pass across the dialyzer membrane under given flow rate and temperature conditions. The UFTR TMP state measures the transmembrane pressure TMP across the ultrafilter at the maximum system flow rate to ensure that is does not exceed the specified maximum ultrafilter TMP. In the event that the UFTR TMP exceeds the acceptable limit the system may continue with its normal operation. The user will be notified that the ultrafilter UFTR requires replacement due to a failed TMP test and that the replacement will be performed during Recycle Preparation. The Flush ETO Prime state flushes the dialyzer of ethylene oxide ETO that may have leached out.

During the Sample Notification state the system will identify if any samples have been previously scheduled by the patient or clinical representative. This state also notifies the operator of the samples scheduled. The following are samples that the operator may be notified to collect Blood Samples Chlorine Sample Test Chloramines Sample Test and RO Water Sample. During the Perform Sample state the system will notify the user that there are samples scheduled to be taken. During this state the user will have the opportunity to accept or decline taking these samples. The system will evaluate whether there are samples scheduled or not. If the system indicates that there are sample s scheduled and the user elects to perform the sample the system will transfer responsibility to Pause where each of the samples will be handled.

The system will create conditions that allow self testing of the protective systems before a patient is connected to the machine. Upon the detection of a protective systems test failure the Protective Systems Tests state will initiate corrective action if applicable. The following protective systems may be tested prior to patient connection Air Detection Venous and Arterial Dialysate Conductivity Dialysate Temperature Blood Leak Test Fluid Leak Test and Doors Open. This may be accomplished by offsetting each of the sensors to simulate a condition where the protective system will trigger. The system will confirm that the proper protective system was initiated.

The Protective Systems Test Failure Recovery is triggered in the event that one of self tests returns a failed status. This state is entered upon the completion of all of the Protective System Tests . In the event that any of the Dialysate Conductivity Protective System Test Dialysate Temperature Protective System Test Blood Leak Protective System Test and Fluid Leak Protective System Test return the failed status the operator may be instructed that operation cannot continue. In the event that either of the Air Detection Protective System Test or the Door Protective System Test return the failed status the operator may be instructed to perform the corrective actions related to the failure.

Following the treatment preparation the patient connection to the system is made and the extracorporeal blood tubing circuit is primed with blood. There are at least two priming prescription options the first method is Prime Discarded or Prime Not Returned where the dialysate priming solution is drawn into the machine as blood is introduced into the extracorporeal circuit. The second method is Prime Returned where the dialysate priming solution is given to the patient as blood is introduced into the extracorporeal circuit. Choice of these two methods depends on how much volume the patient wants to remove during the priming process and whether their venous access can tolerate fluid being drawn from it.

For Prime Discarded blood is drawn from the patient s arterial and venous access sites simultaneously into the machine as the priming solution is discarded to drain. This priming method is often preferred because patients typically begin dialysis treatment volume overloaded and therefore wish to accomplish priming without taking on additional fluid. The user may chose to switch priming methods to Prime Returned if their access cannot tolerate the reverse flow up the venous line. The arterial and venous flow rates may be matched as closely as possible such that the blood fronts just meet inside the dialyzer fibers. The extracorporeal circuit may be purposefully slightly underprimed in order to avoid localized hemoconcentration that could occur if the blood is ultrafiltrated during the priming process.

For Prime Returned blood is drawn up the arterial line and the priming solution is displaced down the venous line to the patient. This priming method may be prescribed for those patients whose accesses cannot tolerate the reverse flow up the venous line used during Prime Discarded or who are sensitive to hypovolemia. If the patient cannot tolerate losing volume quickly this method allows them to keep their volume during prime.

Additionally if the patient still needs extra volume they can initiate a solution infusion any time they are connected. Especially for patients who are sensitive to hypovolemia they may choose to start treatment with a slight excess of fluid.

For either priming method the operator may choose to change the priming blood flow rate at any time. However any changes do not affect the prescribed setting for the subsequent treatment. Access site compromise and pressure flow problems are common at the initiation of treatment and therefore the operator may wish to slow down the blood flow rate during priming.

While the dialyzer and blood tubing set have already been flushed to match the dialyzer manufacturer s instructions sheet there is an industry concern about further leaching of sterilant out of dialyzers when they sit with fluid stagnate in them. Therefore if the dialyzer sits stagnant for too long it may be re flushed.

There is an industry concern about leaching of sterilant out of dialyzers when they sit with fluid stagnant in them. Therefore if the previous flush of the dialyzer occurred 15 minutes ago for a new dialyzer or 30 minutes ago for a dialyzer that has one or more disinfects the dialyzer may be re flushed. This flush will remove any residual ethylene oxide ETO that may be present in the BTS in order to prevent First Use Syndrome 1 FUS 1 . The rationale for differing times between a brand new dialyzer and a dialyzer with one or more heat disinfects is that a brand new dialyzer will likely have more ETO that can leach out. A used dialyzer will have little or no residual ETO.

The Collection Decision state determines whether a priming sample is scheduled or not based on certain database items. The Connect to Machine state prompts the patient to enter their weight and connect to the machine. It waits until they indicate they are connected. The state will post a message indicating the connection procedure and the means for entering patient weight. If heparin is prescribed it will also prompt the patient to load a heparin vial into the pump.

The Priming Sample Collection state allows the patient to collect a priming sample. The priming solution sample is used to perform a microbiological evaluation of the dialysate fluid used to prime the dialyzer and blood tubing set. Within the Priming Sample Collection state the Prompt for Sample state prompts the patient to collect a priming sample. The Deliver Sample state pushes fluid across the dialyzer and out the venous line providing the patient with a sample of the priming solution. A notice may be provided to the patient allowing them to terminate sample collection at any time.

The allowable volume for a priming solution sample may be 500 ml for example. Typically a sample of 150 ml is needed for microbiological evaluation. Sterile sample collection generally requires that some fluid flow into a waste container prior to taking the sample. A maximum volume of 500 ml also allows the user to take an additional sample if the first sample gets contaminated. The request for sample collection duration may be approximately 30 seconds or less. To obtain a 150 ml sample the desired flow rate from the venous line may be 300 ml min. The dialysate may be heated to the prescribed temperature in preparation for priming with blood. Should the patient elect to receive the dialysate prime in the blood tubing set it will be a comfortable temperature.

The Stop Collection state stops fluid flow and waits for the machine stop to be completed. This state is entered either due to a sample volume limit being reached or due to patient request. When the machine has stopped a Collection Stopped event is triggered causing a transition to the Collection Stopped state . The Collection Stopped state waits for the patient to indicate they are ready to move on to connection. Alternatively the patient may request additional sample collection.

The Reprime state ensures the patient reconnects the blood tubing set and closes the doors. The dialysate and blood tubing set are then re flushed. The Close Doors state prompts the user to close the doors. Referring to The Doors Wait For Stop state issues a stop command and waits for the machine to stop. The Doors Wait For User state waits for the common monitoring application to indicate that the doors are closed either because the user or a detector indicated that the doors are closed. The Repriming blood tubing set state re flushes any residual ETO that may have leached out during a period of inactivity.

Referring again to the Dialysate Production Recovery state allows the machine to recover from a scenario where the dialysate temperature is out of specification. Once the temperature of the dialysate is within 1 C. of the prescription temperature for example the process may transition to the Reprime state .

The Prime With Blood state primes the blood tubing set and dialyzer using either the Prime Returned or Prime Not Returned method. If a blood leak is detected an alarm event is generated. The Prime Not Returned state primes the blood tubing set by pulling blood up both the arterial and venous lines and displacing the dialysate through the dialyzer and down to drain. The system may notify the patient that at any time during the state they can select Prime Returned or modify the priming blood flow rate. The arterial priming rate is a prescription item and may be modified by the patient. The blood tubing set and dialyzer volume may be slightly less than nominal in order to reflect dialyzer bundle volume decreases over time and also to avoid hemoconcentration. The Monitor Prime Not Returned state monitors priming of the blood tubing set by checking the status of the priming process.

The Stop Discard Prime state stops fluid and waits for the machine stop to be completed. When the machine has stopped the Discard Stopped event is triggered causing a transition to Prime Returned . The Prime Returned state primes the blood tubing set by pulling blood up the arterial line and displacing dialysate down the venous line to the patient. Arterial air may be monitored. The patient may be notified of the ability to modify the priming blood flow rate at any time during the state. The Start Prime Returned state starts priming the blood tubing. While blood is being drawn up the arterial line the priming solution will be given to the patient through the venous line. Rate is a prescription item and may be modified by the patient. The Monitor Prime Returned state monitors priming of the blood tubing set by accumulating the total volume pumped and comparing it to the total volume in the dialyzer and blood tubing set. When the volume pumped is greater than total dialyzer and blood circuit volume priming is complete. If the patient started Prime Not Returned the amount primed during that state will be carried forward to this state. The patient is notified when they can begin treatment. If the patient indicates they are ready to begin treatment the Patient Connection application is stopped and the Dialyze Application will be started.

The Air Recovery state shown in allows the user to recover from air intrusion into the blood tubing set. The Air Wait for Stop state waits for the flow to stop. The Air Wait For User state waits for the common monitoring application to indicate that the alarm is cleared.

The Occlusion Recovery state notifies the user that an occlusion has been detected but does not stop any flows. Within the Occlusion Recovery state an Occlusion Wait For Stop state issues a stop command and waits for the machine to stop. An Occlusion Wait For User state waits for the common monitoring application to indicate that the occlusion is cleared.

Referring to the Pause state is shown in detail. The Pause state will halt operation. Additionally the patient can choose to perform additional activities. In particular the patient may have the following options Take RO Sample Resume Active Rinseback Disconnect Power Standby and Shutdown. Since the Pause state does not have history the state machine transitions to Pause Wait For Stop which issues the stop functions. Again if the patient selects to resume operation the process returns to the Connection And Priming state which dispatches to the prior sub state s via a history mechanism. When the user selects a Pause button the User Requests Pause event may be sent causing the Patient Connect state machine to transition into Pause and then into the initial state Pause Wait For Stop. The entry action on Pause Wait For Stop calls the machine stop functions. Once the machine has stopped the state machine transitions to Pause Wait For User Choice . If the user selects Resume the event User Requests Resume is accepted.

If the patient chooses to run another application such as the Replace Components Application the Master Control triggers the Patient Connect Stop event causing the Patient Connect state machine to transition to the Idle state . Once the machine has stopped the state machine transitions to Pause Wait For User Choice . When the User Requests Resume event is triggered e.g. by the user pressing the resume button the state machine transitions back to Connection And Priming and will resume according to the history within that state and its sub states.

Referring again to the Nonrecoverable Alarm state notifies the patient that there is an unrecoverable alarm. The current application stops and the patient may be instructed to disconnect from the system after acknowledging the alarm.

Following connection to the dialysis unit dialysis therapy may be delivered to a patient. Dialysis therapy removes toxins and excess fluid from a patient s blood using diffusion forward ultrafiltration and backward filtration convection . In addition heparin may be administered to the blood to prevent coagulation during treatment.

Diffusion is accomplished by exposing the patient s blood to a dialysate solution through a semi permeable membrane. Blood may be drawn from the patient s arterial access and returned to their venous access. Simultaneously fresh dialysate may be produced from reverse osmosis water and chemical concentrates heated to the prescribed temperature and delivered to the dialysate side of the dialyzer while spent dialysate is routed to drain. The concentration gradient at the dialyzer membrane causes toxins of various molecular sizes to equilibrate by moving from the blood into the dialysate. The prescribed blood and dialysate flow rate settings and their accuracy is important in achieving the desired amount and rate of toxin removal. The flow of the blood and dialysate is countercurrent in order to maximize the concentration gradient at all points increasing the amount of diffusion that will occur. Diffusion is also enhanced by the fact that dialysate delivered to the dialyzer is fresh rather than recirculated. Further factors that may affect dialysis therapy dose delivered include patient size prescribed treatment duration dialyzer effective surface area and dialyzer clearance.

Forward ultrafiltration removes excess fluid from the patient s blood. The prescribed fluid volume is removed by generating a lower pressure on the dialysate side of the dialyzer thereby pulling fluid from the blood. The ultrafiltration rate is calculated using the prescribed fluid volume to be removed and also takes into account any dialysate volumes delivered to the patient during the priming backflushing and rinseback processes.

Backward filtration or backflushing is the inverse of forward ultrafiltration. Instead of pulling fluid from the blood side of the dialyzer to the dialysate side fluid is pushed from the dialysate side to the blood side. This process helps to prevent clot formation within the blood tubing and dialyzer which in turn may allow for a smaller heparin dosage prolong the useful life of the dialyzer and facilitate dialyzer cleaning and re use. Backflushing has the additional benefit of promoting better solute removal through convection. Like diffusion convection removes toxins from the blood. But unlike diffusion which relies on a concentration gradient convection relies on the active movement of fluid across the dialyzer to carry solutes. Backflushing is controlled by the synchronization of the blood and dialysate portions of the flow path. By changing the phase between blood and dialysate sides there is constant and repeated shifting of fluid across the dialyzer in small increments. This shifting of fluid pushes dialysate into the blood circuit and then pulls it back but results in no net ultrafiltration.

While dialysis is occurring heparin may be administered. This administration can be handled either as a series of one or more boluses of fluid or on a continuous basis. The patient may also choose to receive an additional bolus or boluses of heparin in the event that unexpected coagulation occurs.

The Active state of the dialyze application is where all dialysis related processing occurs. Dialysis is complete when the dialysis time remaining expires. The Monitor state is responsible for initiating the blood and dialysate flow rates so that treatment can be performed. Blood leak monitoring and air monitoring may be requested and ultrafiltration monitoring may be enabled. The Initial Blood Flow state starts the blood pump at a low rate in order for the patient to check their access before starting treatment. The Start Blood and Dialysate Flow state increases the blood flow rate to the prescribed flow rate. It also starts dialysate flow by heating the fluid from the dialysate tank and diverting it around the dialyzer.

The Dialysis and UF Control state is responsible performing hemodialysis. Dialysis will occur with ultrafiltration and heparin administration. A dialysate temperature alarm may be generated if the temperature is not within acceptable limits. Complete blood side occlusion monitoring may be is requested and partial blood side occlusion monitoring may be requested to stop. The Steady State Dialysis state performs dialysis by circulating blood and dialysate through the dialyzer. It also collects certain treatment related information. The Partial Occlusion state notifies the user that an occlusion has been detected but does not stop any flows. The Administer Heparin state will administer heparin at a prescribed rate. Heparin will be stopped if the amount of heparin delivered is equal to the prescribed amount or the patient requests that heparin delivery be stopped. The Heparin Bolus state will deliver a bolus of heparin.

The Ultrafiltration state performs ultrafiltration. The ultrafiltration rate is determined by taking the amount of fluid needed to be removed divided by the time remaining in the treatment. If the target ultrafiltration volume differs by more than 500 ml from the current ultrafiltration volume an ultrafiltration alarm may result. If either of the following is true ultrafiltration may be stopped 1 the amount of ultrafiltration is greater then or equal to Prescribed volume needed to be removed Rinseback Volume Priming Volume or 2 the patient requests ultrafiltration to stop and the amount of ultrafiltration is greater then or equal to the Rinseback Volume Priming Volume.

A counting algorithm may be used to compare the actual strokes of the ultrafiltration UF pump with the predicted number of strokes to achieve the target volume of ultrafiltrate. The expected number of strokes can be synthesized based on the requested volume and rate of ultrafiltration. The actual strokes of the pump can be counted by having the controller monitor the valve states of the ultrafiltration pump. In one implementation if the actual strokes exceed the expected strokes by greater than a safety threshold the machine can be placed in a safe state. If the actual strokes fall behind the expected strokes by a threshold amount the pumping rate or duration can be extended to avoid having the treatment session undershoot the desired ultrafiltration amount.

The Recirculate Blood and Dialysate state recirculates blood and dialysate with dialysate bypassing the dialyzer in order to bring the temperature of the dialysate into treatment limits.

The Occlusion Stopping state stops blood flow if the blood flow rate drops too far notifies the user that a problem exists. When no occlusion is detected in the Occlusion state the machine will continue to the Initial Blood Flow state .

The Air Recovery Stopping state notifies the user that air intrusion into the blood tubing set has occurred and waits for the function to stop. The Air Recovery state allows the user to recover from air intrusion into the blood tubing set.

The Pause Monitor state is responsible for pausing the device and displaying pause menu options. Referring to the Monitor Stopping state will stop the device and give visual feedback to the user that the pause button was processed. The Pause Monitor Options state will display all the Pause menu options. The Monitor Disconnect application will wait in the state to be stopped by master control. The Monitor Solution Infusion application will wait in the state to be stopped by master control. The Monitor Take Samples application will wait in the state to be stopped by master control. The Monitor Power Standby application will wait in the state to be stopped by master control. The Monitor Shutdown application will wait in the state to be stopped my master control.

Referring again to the Data Handler Init state is responsible for initializing all the data of interest for the Dialyze application. Upon completion of this initialization it will generate a Dialyze Launch Ok event to indicate to Master Control the application is ready to be started. The Update Data state is responsible for maintaining up to date values or all the data of interest for the Dialyze application.

To counteract a hypotensive event the system may deliver a bolus of fluid volume to a patient. As the system removes fluid volume from the patient during treatment it is possible that an unexpected drop in patient systemic blood pressure may occur. This hypotensive event can lead to patient lightheadedness fainting or even more serious complications. To prevent these outcomes the user need only request a solution infusion. The system may then deliver a prescribed bolus of ultrapure dialysate.

Once the user has requested a solution infusion the blood pump may be left running to prevent clotting. The Solution Infusion application will assess whether there is enough dialysate volume available to deliver the infusion and still have enough reserve volume to rinse back the patient s blood. If not the user may be notified that infusion is not possible and may be instructed to either select rinseback or resume treatment. If there is enough dialysate a short countdown be displayed to the user prior to starting the infusion. Since solution infusion is available via a single button press it is possible that the user may have pressed the button in error. This delay gives them the opportunity to cancel the infusion before it begins.

Following the delay fresh heated dialysate fluid is sent across the dialyzer and down the venous line to the patient. At the same time the blood pump is slowly run forward to continue circulating blood and prevent clotting. In order to deliver relief as quickly as possible the flow rate used for the infusion is as fast as reasonably tolerable by most patients accesses and vasculature. A flow rate that is too high may create high pressures in the blood tubing set and lead to nuisance interruptions of the infusion delivery. Further the infusion flow rate approximates the flow from a saline bag that a nurse might hang to counteract a hypotensive episode on other devices.

After the prescribed solution infusion volume has been delivered if the patient continues to experience hypotensiveness they may choose to infuse smaller additional boluses as long as enough dialysate volume is available. Once the patient leaves this application and returns back to the previous activity e.g. Patient Connect or Dialyze subsequent requests for a solution infusion may be for the full prescribed solution infusion volumes.

The Monitor state watches for common hazards such as Blood Leak Arterial and Venous Air and Occlusion . The Monitor state starts the monitors by sending events to the monitoring process and Starts dialysate production in case it has been stopped by a Pause or other interruption.

The Delay for Possible Cancellation state allows the patient to cancel the Solution Infusion if they choose. During the delay e.g. 3 seconds the user interface may give the user an updating visual indication of the time until the infusion will start and the ability to cancel the infusion. If the delay elapses without cancellation the Delay Done event will occur.

The Fluid Delivery Evaluation state evaluates whether there is sufficient dialysate available to deliver the requested infusion. It also calculates the solution infusion volume to be given in the Infusing Fluid state. The Fluid Unavailable state will notify the patient that there is not enough fluid to perform the requested infusion. The blood pump will continue to circulate while the patient responds. If there is sufficient fluid the Stop Circulation state will stop the circulation of blood so that the solution infusion may begin.

The Infusing Fluid super state encapsulates the behavior of the application while the solution infusion machine layer command is running. The solution infusion operation pushes ultrapure dialysate across the dialyzer and down the venous line to the patient. Dialysate is heated before it is pushed across the dialyzer. At the same time the blood pump is slowly run forward to minimize blood clotting. The volume of fluid left to be infused may be updated during this state. A static variable representing this volume may be initially set in the Fluid Delivery Evaluation state and then updated in this state as volume is accumulated in the machine layer status variable Dialysate Circuit Volume. The volume to be infused should be decremented by the delivered volume. If the Dialysate Temperature Out of Spec event occurs the transition will be to the Dialysate Temperature Recovery state . If the volume to be infused is less than 25 ml due to interruption and re entrance the Pump Stopped event may be immediately issued and no infusion should be given.

In the Start Infusing state the solution infusion machine layer command is started. The volume to be infused is being continually updated as volume is delivered so that the correct volume is entered whenever the infusion is started or restarted. When the machine layer status indicates that the command has been started the SI Started event is issued to cause the transition to the next state.

The Dialysate Temperature Recovery state allows the machine to recover from a situation in which the dialysate temperature is out of specification. Dialysate is routed directly to the drain while the temperature is monitored for a return to its acceptable range. If the temperature of the dialysate is within the target range for five consecutive readings for example the recovery is complete and the Dialysate Temperature Recovered event is issued.

The Completion super state starts blood circulation to prevent clotting and waits for the patient to either indicate they would like an additional infusion or that they are done with infusions. If a Pause occurs during any state within this super state the Pause state will stop the circulation. Upon returning from Pause circulation will be restarted and the user will again be asked whether an additional bolus is required. The Wait for Response state waits for the patient to either indicate they would like an additional infusion or that they are done with infusions. If no further infusions are desired this application is ended. The patient will be notified by the user interface that Solution Infusion is complete and they have the option of performing additional bolus infusions. If the user indicates that an additional infusion is needed the local variable solution infusion volume may be set to deliver equal to 100 ml and transition to the Fluid Delivery Evaluation state .

Referring to the Air Recovery state allows the user to recover from air intrusion into the blood tubing set. The machine layer fluid delivery function will be stopped the user will be notified that air is present and the application will remain in this state until the user indicates that the air has been cleared and the sensors do not detect air. The state machine history will return the application to the state that was interrupted. Following the Air Wait for Stop state the Air Wait for User state notifies the user that air is present in the blood tubing and provides instruction for removing the air then waits for the user to indicate that the air is no longer present. When the user indicates that the air has been removed the application will transition to the Recheck Air state .

Referring to the Occlusion Recovery state notifies the user that an occlusion has been detected and waits for the user to respond. Following the Occlusion Wait for Stop the Occlusion Wait for User state notifies the user that an occlusion is present in the blood tubing and provides instruction for removing the occlusion then waits for the user to indicate that the occlusion is no longer present.

Referring to the Pause state will halt operation. Additionally the patient can choose to perform additional activities. When the Pause operation has finished and the user chooses to resume this application the history mechanism will return this application to the interrupted state. Following the Pause Wait for Stop state the Pause Wait for User Choice state presents options for the user and waits for the user to choose an option. In particular the following options may be presented Rinseback Patient Disconnect Resume Treatment Interrupt Treatment Power Standby and Resume Solution Infusion .

Referring to the Blood Leak state stops the current operation in state and notifies the patient that there is a nonrecoverable alarm in state .

The Rinseback application implements the process of returning the patient s blood and guiding the patient through disconnection from the extracorporeal circuit. This process occurs at the end of treatment. Treatment may end once the prescribed dialysis duration has elapsed at any time as requested by the user or due to a hazard detection by the system.

When the patient has requested that their blood be rinsed back the system forces a FMS reading of the dialysate tank as discussed below to confirm that actual dialysate level. Next the system begins sending fresh heated ultrapure dialysate across the dialyzer to send the blood back to the patient. At the same time the blood pump is run slowly in reverse such that both the arterial and venous lines clear simultaneously. The prescribed rinseback volume includes the total volume of the blood tubing set and dialyzer plus additional dialysate volume to flush the patient access and rinse the tubing lines clear of nearly all blood traces.

After this volume has been delivered the user may choose to infuse an additional smaller rinseback bolus. This may be done to counteract patient hypotensive sensations and or return visible blood traces remaining in the tubing. The user can request additional rinseback boluses in 50 mL increments until for example the total additional bolus volume delivered reaches 500 mL. The limit may be selected to prevent operator misuse leading to fluid overload. Furthermore rinseback fluid delivery may be limited by fresh dialysate availability.

In order to complete rinseback as quickly as possible the flow rate used may be as fast as reasonably tolerable by most patients accesses and vasculature. A flow rate that is too high may create high pressures in the blood tubing set and lead to nuisance interruptions of the rinseback process. Further the flow rate may approximate the flow from a saline bag that a nurse might hang to rinseback blood on other devices.

The air trapped in the blood pumps and the top of the dialyzer must be segregated before any fluid can be pushed back along the arterial line toward the patient. The system isolates any air trapped in the blood pump and dialyzer header by collecting this air in one of the blood pod pumps e.g. the upper pump and isolating that pod while using the other blood pod pump e.g. the lower pump to flow dialysate back through the arterial line . Alternatively the air is collected in lower blood pod pump and the upper pump is used to flow dialysate back through the arterial line . The steps to collect and isolate the air are 1 Deliver both upper and lower blood pump chambers toward the dialyzer this will force all the air in blood pumps into the dialyzer where it will collect at the top 2 Fill a first blood pod pump by pulling liquid and any air back from the dialyzer 3 Fill a second blood pod pump by delivering the liquid and any air in the first blood pod pump through the two inlet valves and this step sweeps any air in the first pod pump along with the air from the dialyzer into the second pod pump 4 Isolate any collected air in the second pod pump by leaving it full and closing the inlet and outlet valves of the second pod pump . 5 Use only the first blood pod pump to push fluid to the patient via the arterial blood line.

If air in line detector detects air in the arterial line the operator will be notified and rinseback will continue down the venous line only where air can be trapped by the air trap .

With reference to the Monitor state monitors for Pause requests venous air in the blood tubing set dialysate leaks and dialysate production problems .

The Administer Fluid state administers the infusion and monitors for occlusions dialysate temperature out of limits conditions of unavailable fluid and inlet water out of limits. The Arterial and Venous Infusion state pushes ultrapure dialysate across the dialyzer. Dialysate may be heated as it is pushed across the dialyzer. Arterial air and venous air may be monitored by air in line detectors . The Arterial Air Recovery state handles a recovery from an arterial air alarm. The Stop A V Infusion state stops the infusion and posts an alarm to the GUI. The Arterial Air Resolution state waits for the user to indicate they are ready to continue with Venous only Rinseback. The Venous Infusion state pushes ultrapure dialysate across the dialyzer. Again dialysate may be heated as it is pushed across the dialyzer.

Ultrafiltration UF may be considered to be a process that removes water from the blood across a semi permeable membrane of a dialyzer in the presence of either an osmotic or hydrostatic trans membrane pressure gradient. It is a measure of the net amount of fluid that is removed from the patient s body while on dialysis. Typically patients with renal failure receiving dialysis begin treatment sessions with some degree of fluid overload manifested by their wet weight and have a goal of achieving their dry weight a weight representing a euvolemic state by the end of treatment. UF can be measured as the amount of net fluid flow out of the dialyzer via the dialysate outflow path that exceeds the net fluid flow into the dialyzer via the dialysate inflow path. A system controller can adjust the UF flow rate to meet a prescribed net patient fluid removal goal over the planned duration of dialysis therapy. Generally a goal of dialysis is to return a patient to his or her target weight an established dry weight based on the patient s particular physical and medical characteristics. The UF flow rate is primarily determined by the rate at which the UF pump draws fluid from the dialyzer when the blood pumps are circulating blood through the dialyzer. The activity of the UF pump is generally independent of the overall dialysate flow through the dialyzer which is controlled by the inner and outer dialysate pumps. The UF flow rate may be subject to an upper safety limit for each treatment session and may additionally be subject to an upper operational limit to avoid excessive hemo concentration on the blood side of the dialyzer membrane during treatment. Furthermore a clinician may modify a prescription for clinical reasons to limit the maximum UF rate. For example the average UF flow rate may be set at less than or equal to about 10 of the blood flow rate through the dialyzer. The maximum instantaneous UF flow rate on the other hand may be somewhat higher for example about 15 of the instantaneous blood flow rate because of various interruptions in ultrafiltration that may occur during a dialysis treatment. As a first approximation the UF pumping goal can be considered to be the amount of fluid removal desired plus volume of dialysate or other electrolyte solution used to rinse back blood to the patient at the end of therapy minus the volume of priming solution discarded from the blood circuit blood tubing dialyzer blood pumps air trap etc. at the start of treatment when the patient s blood is being pulled into these components of the hemodialysis machine. The UF pumping goal may also be adjusted up to account for fluid infusions during treatment IV medications such as heparin oral fluid intake IV solution infusions etc. . . . or adjusted down to account for fluid losses during treatment such as e.g. gastrointestinal or urinary fluid losses . The rinseback volume should be sufficient to deliver nearly all of the patient s blood back into his or her circulation by filling the blood circuit with dialysate and optionally adding an additional nominal rinseback volume.

A system controller can set the UF pumping rate by dividing the UF pumping goal by the estimated treatment time. In some embodiments the UF pumping rate may be limited by the maximum prescribed UF pumping rate the blood pumping rate as well as by the available flow rate of the dialysate flowing through the dialyzer via the inner and outer dialysate pumps.

In addition in some embodiments the system controller may adjust the UF pumping rate to account for planned periodic pauses in dialysis and ultrafiltration. For example dialysis may be suspended periodically to allow one or more controllers to perform maintenance functions on components of the hemodialysis machine. In one aspect the hemodialysis system may be programmed to pause dialysis every 50 100 pump strokes of the outer or inner dialysate pumps to purge air from an inline ultrafilter to run integrity checks on valves in the system and to perform FMS based volume measurements of the dialysate tank to ensure an accurate accounting of dialysate in the tank. During this process the outer inner and UF pumps may be halted while the blood pumps continue to pump blood on the blood side of the dialyzer. These maintenance functions typically may take several seconds to a minute or more. The duration of maintenance procedures may occasionally be greater for example if the system determines that additional dialysate should be produced and placed in the dialysate tank prior to resumption of dialysis. The system controller can account retrospectively for variable maintenance periods as well as for projected future maintenance periods during treatment to adjust the UF pumping rate to meet the UF pumping goal.

In an embodiment the hemodialysis system is also capable of performing periodic backflushing of dialysate solution through the membrane of the dialyzer. Periodic backflushing may be useful for example in keeping proteinaceous or other debris from accumulating on the dialyzer membrane and maintaining or extending its operational life. In addition a backflushing feature may allow the use of high flux dialyzers in convective filtration such as e.g. hemodiafiltration in which high UF flow rates are used to enhance the flow of larger solutes across a dialyzer membrane through convective flow or other mechanisms . Backflushing can be accomplished for example by bypassing the inner dialysate pumps and balancing circuit and having the outer dialysate pump push a pre determined amount of fresh dialysate e.g. about 100 200 ml of fluid into the dialyzer via the dialysate inlet of the dialyzer while closing the appropriate valves on the dialysate outflow path of the dialyzer. The controller may be programmed to perform a backflushing operation for example every 10 to 40 minutes during a dialysis treatment session. The UF pump flow rate may be adjusted between backflushes to recover over a defined period of time the amount backflushed plus an amount of fluid to maintain a pre determined base rate of ultrafiltration. The controller may be programmed to perform backflushing at pre determined intervals of time during treatment and preferably the controller is programmed to have the UF pump pull off the fluid necessary for a backflushing operation prior to the backflush. Optionally the controller may delay a backflush procedure if the UF pump has not met its expected pumping volume by the time a backflush procedure is scheduled to occur. Optionally the timing of each backflush procedure may be reset at a pre determined time interval from the last performed backflush so that the interval between backflushing operations remains relatively constant.

In an embodiment backflushing may be terminated if the amount of fluid removed from the patient exceeds a pre determined threshold volume at any time or if the controller predicts that it will be exceeded within the next backflush period. For example the controller can estimate whether the volume ultrafiltered at the current rate will likely exceed the threshold amount before the next backflushing operation. In another embodiment the controller may terminate a backflush procedure if it occurs within a pre determined amount of time before the expected end of treatment. For example the controller may be programmed to terminate backflushing if it occurs within 50 of a backflush duration of the expected end of treatment.

In one embodiment the user may request a solution infusion via a user interface on the hemodialysis machine. A solution infusion may be characterized as a pre determined volume of dialysate solution that the system controller can deliver to the patient across the dialyzer membrane. The user may be permitted to request and obtain two or more solution infusions during the course of a dialysis treatment. In an embodiment an entry by the user on a user interface device e.g. touch sensitive graphical user interface requesting a solution infusion automatically triggers the controller to reset the UF pumping goal to the amount already pumped and set the remaining UF pumping rate to zero. If the user has obtained fluid through a request for a solution infusion the volume infused may be subtracted from the UF pumping goal or the amount of fluid that the user planned to have removed. In one aspect the user has the option to reset the UF pumping goal to the original UF pumping goal which may be interpreted by the controller as a command to remove from the patient the originally planned volume of fluid plus the amount of the solution infusion. In this case the UF pumping rate is adjusted to ultimately remove the additional fluid infused through the solution infusion. Optionally the user may set the UF pumping goal to the original UF pumping goal minus the amount infused. This optional mode allows a user to preserve the volume of fluid gained from a solution infusion during treatment.

Both backflushing and solution infusions may be performed by turning off the inner dialysate pumps and the UF pump and pushing dialysate fluid across the dialyzer membrane using the outer dialysate pump. In a preferred embodiment the outlet valves of the blood pumps may be closed during a solution infusion in order to maximize the amount of dialysate solution being pushed through the venous blood line into the patient. In contrast it may be preferable to keep the outlet valves of the blood pumps open during a backflushing procedure to help take up the volume of dialysate being backflushed.

In another embodiment a user may enter a new UF pumping goal at any time during treatment adjusting for example for liquids he or she may consume during treatment or for intravenous infusions of medications or for unanticipated gastrointestinal or urinary fluid losses. The system controller may then re calculate and reset the UF pumping rate to achieve the new UF pumping goal before the remaining treatment time has expired. If the new UF pumping goal is less than or equal to the ultrafiltration volume already pumped then the UF pump may be halted for the remainder of the treatment session.

Additionally the system controller may be programmed to automatically adjust the UF pumping rate upon the occurrence of an unplanned addition of fluid to or loss of fluid from the user. For example the system controller may be programmed to account for the infusion of a pre determined amount of fluid to the patient when a heparin bolus is administered at the start of treatment. The amount of this fluid is generally a function of the volume of blood tubing and blood pump conduit between the location where heparin enters the blood pump and the intravenous catheter connected to the blood tubing. In general the most direct route to the patient is via the arterial blood tubing and in one embodiment this volume can be approximately 65 cc s. However if air is detected at the air in line detector of the arterial tubing a system controller may be programmed to stop the blood pump from infusing heparin via this route cause the blood pump to pull the fluid and air back toward the blood pump and then configure the blood pump valves to cause the heparin to be administered to the patient via the venous tubing. In one embodiment the venous tubing route to the patient from the blood pump includes the blood side volume of the dialyzer as well as the volume of the air trap in the blood circuit. In this case the volume of fluid necessary to deliver a bolus of heparin to the patient may be significantly greater than via the arterial tubing route. In one embodiment this venous route may require as much as 260 cc s of fluid to deliver the heparin bolus to the user . Thus the system controller can be programmed to adjust the UF pumping goal to be greater than the original goal if the alternate venous tubing route is used for the heparin bolus.

In some embodiments the maintenance periods are timed according to the number of dialysate pump strokes and their number may therefore increase or decrease depending on the dialysate flow rate through the dialyzer as well as the total planned treatment time. The dialysate flow rate can vary for each patient and can be a function of the blood flow rate achievable the rate of dialysate production and storage and the duration of a dialysis therapy desired by the patient. The system controller may calculate the predicted cumulative effect of the number and length these delays in determining the time of actual treatment and adjust the UF pumping rate accordingly. In an embodiment the controller may be programmed to set the UF pumping rate at a calculated base rate plus an additional factor e.g. about 5 10 above the basal rate in order to ensure that the UF pumping goal is reached before the predicted end of therapy. If a maximum UF pumping rate is reached then the controller may increase the total planned treatment time and so inform the user via a message or other alert on the graphical user interface.

In addition the system controller may adjust the UF pumping rate to account for unanticipated pauses in dialysis and ultrafiltration. For example if the monitored temperature of the dialysate exiting the ultrafilter is outside of a pre determined range e.g. above 41 deg.C. the output of the outer dialysate pumps may be diverted to drain or to the dialysate tank until the monitored temperature of the dialysate returns to the specified range. During this time the system may enter a state e.g. a DivertHot state in which the inner dialysate pumps and UF pump are paused and the inner pump valves are closed. Furthermore the system may account for any pause in dialysis caused by a user request for dialysate solution infusion by a user request to pause dialysis treatment or by alarm states that may occur e.g. air in line detection or fluid leaks . Calls for a solution infusion may prompt the system to undergo a maintenance check of the dialysate tank level after the infusion. Thus a solution infusion state may trigger an additional delay in dialysis treatment. Following any of these or other pauses in dialysis treatment the system controller may then adjust the UF pumping rate upon resumption of dialysis to meet the originally calculated UF pumping goal.

In an embodiment the system controller may periodically perform a UF re assessment recalculating the remaining treatment time as well as the remaining UF pumping volume periodically during therapy e.g. about every 20 minutes to adjust the UF pumping rate and to ensure that the UF pumping goal can be achieved. The remaining treatment time may be extended for example because the cumulative duration of one or more suspensions of dialysis has exceeded a minimum value. In an embodiment the UF re assessment can be programmed to occur in approximate 20 minute intervals. At the time of re assessment the controller will have tracked 1 the amount of fluid already pumped by the UF pump 2 the UF pumping goal whether as originally entered or updated by the user during treatment and 3 the remaining treatment time. From this data the controller may then adjust the UF pumping rate with or without the 5 10 additional margin described above to ensure that the UF pumping goal will be achieved by the end of treatment. Once the UF pumping goal has been reached the system may cease further ultrafiltration and backflushing.

The total available treatment time may be limited however because of other system constraints or because of medical constraints. For example to reduce the risk of complications total treatment time may be limited to about 10 hours from the start of a dialysis treatment session and to about 16 hours from the time that anything such as reverse osmosis water is brought into the hemodialysis system. Should the calculated treatment time approach a maximum the system controller may default to a lowered UF pumping goal and so inform the user via the graphical user interface.

1 stop ultrafiltration if the user modifies the UF pumping goal down to the UF volume already removed 

2 lengthen the planned total treatment time if the user modifies the UF pumping goal above that which can be achieved at the maximum allowable UF pumping rate 

3 adjust the UF pumping rate up to reach the UF pumping goal if the user decreases the planned treatment time or change the UF pumping goal downward if the maximum UF pumping rate has been reached 

4 reset the UF pumping goal to the UF volume actually removed in response to a user command to suspend further ultrafiltration unless the UF pumping goal is later reset by the user and

5 in response to a user command for a solution infusion reset the UF pumping goal to the UF volume actually removed minus the solution infusion volume unless the UF pumping goal is later reset by the user .

In other embodiments the system controller may adjust the UF pumping rate periodically to catch up with temporary or unexpected suspensions of dialysis and the catch up period may be programmed to occur before the next scheduled maintenance pause subject to the maximum UF pumping rate set by prescription or otherwise . Also in cases in which backflushing is enabled the controller may adaptively reduce the number of backflushes depending on the available remaining ultrafiltration volume. For example the high limit for ultrafiltration volume may be set to be no more than a small percentage above the patient s fluid loss goal plus the total of the backflush volumes plus the rinseback volume in order to keep the net fluid loss by the patient at or only slightly above the final rinseback volume plus the patient s fluid loss goal.

In other embodiments the system controller may be programmed to vary the UF pumping rate during treatment. For example the controller may be programmed to set the UF pumping rate higher at the start of therapy at a time in which it is presumed that the patient may be relatively fluid overloaded and able to comfortably sustain a higher rate of fluid removal and to reduce the UF pumping rate later in the course of therapy keeping the average UF pumping rate sufficient to meet the UF pumping goal by the end of therapy. In other cases more complex patterns of ultrafiltration may be desirable and the controller may be programmed to accommodate such patterns when setting the UF pumping goal. In some embodiments a UF pumping rate profile may be individualized for a particular patient as part of the patient s prescription parameters initially set and modifiable by the patient s physician at any time.

The Dialysate Tank Empty Alarm state will stop Rinseback and notify the patient there is not enough dialysate to continue with Rinseback. A dialysate tank low alarm may be posted to the GUI. Fluid production may be restarted if stopped. The Wait for Fluid state waits for fluid to become available. Once the dialysate tank volume reaches a certain level e.g. 300 ml a Dialysate Tank Filled event may be generated. If the tank has not reached the given level in a selected period of time e.g. 2 minutes an error event may be generated.

It may be possible to improve the accuracy of liquid volume determinations in the dialysate tank by using at least two independent methods of measurement. One method for example counts the number of pump chamber strokes that deliver liquid to the tank and subtracts the number of pump chamber strokes that withdraw fluid from the tank. Assuming that each pump stroke moves a known fixed quantity of liquid a cumulative net liquid volume in the tank can be tracked. A second exemplary method involves taking an FMS measurement by charging a reference chamber from a reservoir measuring the resulting pressure and then venting the reference chamber to the dialysate tank. The volume of air in the dialysate tank can then be calculated from the equalized pressure between the tank and the reference chamber. A third exemplary method involves taking an FMS measurement by charging a reference chamber to a predetermined pressure and then venting the reference chamber to the dialysate tank. The volume of air in the dialysate tank can then be calculated from the equalized pressure between the tank and the reference chamber. Although an FMS based method may yield more accurate results it may also be more time consuming. Thus it may be desirable to have the system controller keep track of the tank volume continuously by pump stroke accounting and have it perform an FMS measurement periodically to verify the ongoing accuracy of the pump stroke accounting. A controller applying one or both of these methods can use this data to determine whether fluid should be added to or removed from the tank and whether the fluid level is below the minimum deemed necessary to safely continue therapy.

The following section describes a method of measuring the volume of dialysate in a container by a first method of counting known volumes pumped into or out of the container and a second method using an improved FMS measurement. The improved FMS measurement is used periodically to correct the first method if necessary. The improved FMS method assumes a form of an equation that relates FMS pressure drop and the gas volume in the container. In one embodiment constants in the equation are correlated to measured FMS pressure drop and measured volumes during a calibrated filling of the container.

Pump stroke accounting operates by polling the pumps that can deliver fluid into and out of the tank continuously accounting for completed strokes and discounting incomplete strokes due to occlusions. New fluid can be supplied to the dialysate tank by the mixing pump and the bicarbonate and acid pumps and pump strokes may be tallied when the outflow valve to the tank is registered as being open and the mix drain valve is registered as being closed. The state of the valves can be monitored by reading the valve state via the I O subsystem or in a simpler arrangement the valve state can be assumed according to the particular operation being performed at the machine level. Fluid can be removed from the dialysate tank by the outer dialysate pump when the dialysate drain valve is open and the tank recirculation valve and disinfection valve are closed. Fluid is also removed by the outer dialysate pump when the disinfect path is open tank recirculation valve and dialysate drain valve are closed while the disinfection valve and mix drain valve are open . The pumps can be polled for completed strokes and strokes can be discounted if a chamber fill occlusion is detected. In a second exemplary method incomplete strokes by the mixing pump are discounted but all incomplete strokes by the dialysate pump are counted as full strokes. The incomplete strokes are discounted only on the fill side in order to bias the measured tank level low so the dialysate tank is more likely to be overfilled than empty. Should an occlusion be detected with any of the pumps the pump stroke accounting value can be flagged as suspect or invalid and a tank volume measurement can be taken using an independent method for example the FMS method.

The FMS method of measuring the air and therefore the liquid volume in the dialysate tank is based on Boyle s law. A reference volume is pressurized and then vented into the closed dialysate tank the volume then being calculated from the final pressure reached by the combined reference and tank air volumes. This method may be prone to some error because of delays in or incomplete closures of the valves that communicate with the tank or because of physical distortion of the tank under pressure. The measurement may also take a substantial amount of time which could reduce the efficiency of dialysate delivery for dialysis. Thus some of the physical characteristics of the dialysate tank and valves may introduce measurement error if the classical FMS equation P1V1 P2V2 is used e.g. distortion of the dialysate tank may introduce error in a measurement using this equation as a model of the system.

The FMS measurement method may be improved by using a third order equation which may increase the accuracy of the volume determination at the target tank fluid level of 50 75 . Such an equation can take several forms and is based on fitting experimentally derived pressure volume data to a curve defined by the third order equation. The measurement of the volume in the dialysate tank can be calibrated for example by incrementally filling the tank and performing FMS measurements on the tank at each increment. Data points are collected and a mathematical model correlating the FMS data to the actual fluid volume within the tank can then be generated. For example the controller can perform an AutoCal or other calibration function that empties the tank and then fills it incrementally with seven 300 ml volumes of liquid making an FMS volume measurement with each incremental fill. These measurements can then be inputted in the form of a vector into a function that calculates the coefficients for the third order equation using a least squares algorithm for example to minimize the error between the observed and predicted volumes. The function may then update the coefficients used in the third order FMS equation that are stored in a calibration data file on a hard drive or in the system memory. Thereafter the third order equation including the coefficient values determined during calibration may be used with an FMS measured pressure difference value to determine a volume of liquid in the dialysate tank.

In one illustrative embodiment the FMS measurement is not used for primary dialysate tank level determination e.g. because the measurement takes approximately 20 seconds to perform and performing this measurement on every outer pump stroke could degrade pumping capacity. Instead a primary determination of the volume of dialysate in the dialysate tank is computed based on an accounting of the number of pump strokes used to place dialysate into the tank and the number of pump strokes used to remove dialysate from the tank. In addition FMS is used to measure the volume of dialysate in the dialysate tank for example about every 20 minutes during treatment or approximately once for every 100 pump strokes of dialysate placed into the dialysate tank. The FMS determination of the dialysate volume is compared to the volume predicted by the accounting of the number of pump strokes of dialysate into and out of the dialysate tank. If the difference between the measured volume and the volume from pump stroke accounting is greater than a threshold amount e.g. 100 ml an error is returned and therapy may be discontinued. If the difference is smaller e.g. less than 100 ml then the accounting volume is adjusted and updated to the newly measured value and therapy may be continued.

As mentioned above in this embodiment a third order equation is used to determine volume in the dialysate tank. Coefficients for the third order equation are determined during a calibration function by providing known quantities of liquid to the tank and effectively plotting the liquid volumes for a plurality of measured pressure differences and minimizing the error between the curve representing the known liquid volumes and the measured pressure differences and a curve representing calculated volumes and measured pressure differences using the third order equation. In one example a pressure measurement may be taken every time an additional fixed amount of liquid e.g. 150 or 300 ml is placed into the dialysate tank where the calibration process is limited to a typical operating range of the dialysate tank volume e.g. between 1 2 liters of a 2 liter tank . The FMS pressure differences measured at each volume step are plotted and the sum of the squares of the errors between the known volume pressure difference at each step and the calculated volume pressure difference using the third order equation at each step is minimized to determine the coefficients of the third order equation which are stored in a calibration data file and used in future FMS determinations of liquid volume in the dialysate tank. The accuracy of the coefficients may be checked e.g. by again filling the dialysate tank with known volumes of liquid measuring the liquid volume using the FMS pressure measurements and the third order equation and comparing the known and determined volumes. If a difference between the known and determined volumes is below a threshold e.g. a difference of 5 or less a determination may be made that the calibration process was accurately done and the coefficients for the third order equation can be used for accurate measurement.

In one illustrative embodiment to perform the calibration function and determine the coefficients for the third order function the system initially empties the dialysate tank and adds 300 ml amounts of liquid to the tank in seven intervals. After each 300 ml interval the system makes an FMS pressure difference measurement of the dialysate tank e.g. determines a pressure difference before and after the tank is fluidly coupled to the pressurized reference chamber. These measurements are inputted in the form of a vector into a function that calculates the coefficients for a least square fit curve for the third order equation that closely approximates a curve defining the known volumes for each of the seven fill intervals.

where f x gives the calculated fluid volume in the dialysate tank based on the measured FMS pressure difference x is the measured FMS pressure difference and a b c and d are coefficients to be determined in the calibration process. Note that the liquid volume in the dialysate tank is equal to the total tank volume less the gas volume. Thus by determining a gas volume in the tank a liquid volume in the tank is determined. 

To obtain the least square fit of the third order equation to the actual fluid volumes for each measured FMS pressure difference the error of third order equation f x in relation to the known volume measured pressure difference curve is determined and minimized. The solutions that minimize error are the coefficients a b c and d for the third order equation. Equation 8 gives the errors in this embodiment

where y is the known liquid volume xis the measured pressure difference between the initial pressure of the dialysate tank before being coupled to the reference chamber and the final pressure after being coupled to the reference chamber i.e. the FMS pressure difference i is the current iteration and n is the total number of instances. By inserting the third order function for f x of Equation 7 into Equation 8 we get Equation 9

To find the minimum error the partial derivative of the error function is taken with respect to each coefficient and set equal to zero as shown in Equation 10.

A least square fit function uses the augmented matrix in Equation 14 to solve for the coefficients of the third order equation. Specifically the AutoCal function first declares two vectors and inputs in them the measured pressure differences and the known volume values for each fill and measurement interval. AutoCal then calls a leastSquareFit function which calls an inputMatrix function to make a matrix a makeResutVector function to make the result vector for that matrix an augmentedMatrix function to combine the two into an augmented matrix a triangularMatrix function to reduce the augmented matrix into a triangular matrix matrix with only one pivot per column a reduceEchelonForm function to reduce the triangular matrix into its echelon form matrix with only one pivot per row and column and a coefficients function to update and display the calculated coefficients. inputMatrix and makeResultVector perform the summations before inputting the pressure difference and volume values so that the end augmented matrix only has numbers.

Some of these operations called by the leastSquareFit function call smaller functions as well inputMatrix calls sumVectorPower triangularMatrix calls swapRows normalizeRow subtractRows and absolute Value and reduceEchelonForm calls backwardsMultiply. inputMatrix inputs summation terms into a matrix. makeResultVector inputs summation terms into the result vector for the augmented matrix. augmentedMatrix converts the 4 4 matrix and the result vector into an augmented matrix. triangularMatrix reduces an augmented matrix into a triangular matrix. reduceEchelonForm reduces a triangular matrix to Echelon form by backwards multiplication. coefficients updates the default coefficients to the new ones and displays them. sumVectorPower performs a summation of the elements of a vector raised to the desired power. swapRows swaps the elements from two rows in a matrix. normalizeRow divides all the elements of a row in a matrix by the first element making that element equal one. substractRows subtracts the elements in one row from the corresponding ones from another. absolute Value returns the absolute value of a number. backwardsMultiply subtracts one row from another after multiplying one of the rows by the integer needed so that the subtraction makes one of the elements in the row equal zero.

Having determined the values for the coefficients a b c and d the control system may use the third order equation f x along with the measured FMS pressure difference to determine the liquid volume in the dialysate tank. That is for a given FMS measurement f x of Equation 7 calculates the liquid volume using the values for a b c and d determined in the calibration process.

The Occlusion Alarm state will stop Rinseback and notify the patient there is an occlusion e.g. by posting an occlusion alarm to the GUI. The Occlusion Resolution state waits for the patient to clear the occlusion.

The Dialysate Temperature Alarm state will stop Rinseback and notify the patient the dialysate temperature is out of range e.g. by posting a temperature alarm to the GUI. The Recirculate Dialysate state allows the machine to recover from a scenario where the dialysate temperature is out of specification. At the same time blood may continue to circulate to prevent clotting. In this state dialysate may be routed directly to drain as the machine attempts to bring the limits within range.

The High Inlet Water Temp Alarm state will stop Rinseback and notify the patient the water entering the machine is too hot e.g. by posting an inlet water temperature high alarm to the GUI. This state diverts hot water to drain and waits for the water to reach nominal temperature.

The Wait state is intended to handle the transitions between Rinseback and Disconnection. This state will essentially put the system into an idle state. Besides handling the transitions between Rinseback and Disconnection this state will also control the ability to perform additional bolus infusions. The Wait for User state waits for the user to either request an additional Rinseback or to indicate they are done with this process. If the patient indicates they are done with Rinseback an event may be generated to terminate Rinseback.

The Venous Air Alarm state will stop Rinseback and notify the patient venous air has been detected. The Venous Air Resolution state waits for the patient to clear the air bubble and for an indication of the same from the patient.

The Dialysate Leak Alarm state will stop operation and notify the patient a dialysate leak has been detected. A dialysate leak alarm may be posted to the GUI. The Leak Resolution state waits for the patient to clear the leak and for an indication of the same from the patient.

The Dialysate Production Alarm state will stop operation and notify the patient a dialysate leak has been detected. A dialysate production alarm may be posted to the GUI. The End Rinseback state waits for the patient to acknowledge the alarm. Upon acknowledgement of the alarm an event may be generated to end Rinseback.

The Pause Menu state allows the patient to choose to perform additional activities. The following options may be displayed and selected by a user Patient Disconnect Power Standby and Shutdown.

The Take Samples application gives the operator the ability to take certain fluid samples. In order to safely and effectively administer dialysis treatment it may be necessary to periodically collect samples of dialysate and reverse osmosis water for laboratory analysis. This application allows the user to more easily collect these samples by presenting the fluid for sampling at a convenient location for collection.

For dialysate sample collection dialysate is circulated through the dialyzer. For reverse osmosis RO sample collection the reverse osmosis system is turned on and flushed for a predetermined amount of time to initiate production of reverse osmosis water. Then the user is prompted to collect the sample by tapping into this flow.

Collection of a blood sample by the user can occur during or at the end of a therapy. In one arrangement the system may set a blood flow rate of about 100 ml min. in the blood set while setting the ultrafiltration pump flow rate and dialysate pump flow rate to zero. Optionally during this time dialysate production may continue at a pre determined rate to maintain fresh dialysate and additions of fresh dialysate to the dialysate tank may be used to replace an equivalent amount of dialysate sent from the dialysate tank and from the outer dialysate circuit to drain.

The Replace Components application gives the user the ability to replace certain components when they have reached the end of their life. shows an exemplary implementation of the Replace Components application.

The Requesting Component Replacement state of the application shows which components should be replaced and allows the user to request additional replacements. The Deprime Flow path state decides which if any part of the machine needs to be deprimed. The Evaluating Blood Side Drain state determines if the blood side needs to be drained. It evaluates the different ways in which the dialyzer and blood tubing set could require replacement. If the dialyzer and blood tubing set need to be changed but are not clotted off then the state may request that they be drained of fluid. The Evaluating Dialysate Side Drain state determines if the dialysate side needs to be drained. It evaluates the different ways in which the dialysate side components could require replacement if so then the state will request they be drained of fluid. The Empty Dialysate Tank state removes any residual dialysate or reverse osmosis water from the dialysate tank by sending it to drain. When the Empty Tanks command has completed the event Tank Empty is emitted. The Draining Dialysate Side state removes fluid from the ultrafilter.

The Evaluating Dialyzer Replacement state determines whether the dialyzer and blood tubing set require replacement. The Replacing Dialyzer state steps the patient through dialyzer and blood tubing set replacement. For example directions for replacing the dialyzer may be displayed. When the user indicates the dialyzer has been replaced the Dialyzer Replaced event may be emitted. The Evaluating Ultrafilter Replacement state determines if the ultrafilter requires replacement. The Replacing Ultrafilter state steps the patient through ultrafilter replacement. The Replacing Drain Cassette state steps the patient through ultrafilter replacement. For example directions for replacing the drain cassette may be displayed. When the user indicates the drain cassette has been replaced a Drain Cassette Replaced event may be emitted. The Evaluating Dialysate Cartridge Replacement state determines if the Dialysate Cartridge requires replacement. For example directions for replacing the dialysate cartridge may be displayed. When the user has indicated they have completed replacement the Components Replaced event may be emitted.

The Evaluating Dialyzer Connections state determines whether the dialyzer and blood tubing set connections require testing. The Checking Dialyzer state may ensure that the dialyzer has been replaced correctly and that there are no leaking connections. If the dialyzer check is okay the Dialyzer Check Okay event may be emitted. The Fixing Dialyzer Connections state allows the patient to correct a misplaced connection. For example instructions for fixing the dialyzer connection may be displayed. The Evaluating Ultrafilter Connections state determines whether the dialyzer and blood tubing set connections require testing. The Fixing Ultrafilter Connections state allows the patient to correct a misplaced connection. For example instructions for fixing the ultrafilter connection may be displayed. If the ultrafilter check is okay the Ultrafilter Check Okay event is emitted. The Evaluating Drain Cassette Connections state determines whether the drain cassette connections require testing. The Fixing Drain Connections state allows the patient to correct a misplaced connection. Instructions for fixing the drain cassette connections may be displayed. The Checking Dialysate Cartridge state ensures the dialysate cartridge has been replaced correctly and that there are no leaking connections. If the dialysate cartridge check is okay the Connections Checked event may be emitted. The Fixing Dialysate Cartridge Connections state allows the patient to correct a misplaced connection.

The Install Chemicals application allows the user to install chemical concentrates in preparation for dialysate production. Dialysate is made from chemical concentrates that are diluted with reverse osmosis water. The chemical concentrates are connected to the machine prior to dialysate production but not during recycling. The machine checks the connection of the chemical concentrates following their installation. In the case that the chemical concentrates are not properly connected to the machine the user will have the opportunity to correct the situation.

Referring to the Install new Concentrates state prompts the user to replace the chemical concentrate container. The Ensure Connection test detects whether the chemicals have been installed properly in the system. The Connection Recovery state handles the user interaction in the event that the system detects that the chemical concentrates are not installed properly. The system may notify the user to verify that the chemicals are properly installed and all connection are securely fastened. The Dilute Chemicals state fills the chemical bags with water to dilute the chemicals. The Start Dialysate Production state is responsible for starting Dialysate production.

The Dialysate Leak Alarm state will stop Operation and notify the user a dialysate leak has been detected. The Leak Resolution state waits for the user to clear the leak and for an indication from the user of the same.

Referring again to the Data Handler Init state is responsible for initializing the data items for Install Chemicals. On completing this initialization it will generate a Install Chemicals Launch OK event to indicate that Install Chemicals is ready for activation. The Update Data state is responsible for maintaining up to date values for the data items for Install Chemicals such as the treatment prescription and mix.

A number of features or attributes may be desirable in the hemodialysis system embodiments described herein. These features or attributes may relate for example to automation safety usability the user interface therapy programming prescription data patient entry data summary data and or therapy display data. Exemplary features or attributes of the hemodialysis system embodiments are described below. Various features or attributes or combinations of such features or attributes may be incorporated in embodiments of the hemodialysis systems described herein. However such features and attributes may not be required by the system. Thus while the features or attributes described may be advantageously incorporated into one or more hemodialysis system embodiments in some circumstances the hemodialysis system need not include any of the described features or attributes and the system is not limited to the inclusion of any such features or attributes.

Exemplary features or attributes of the automation of the system will be described first. Embodiments of the hemodialysis system described herein may be designed to permit the patient to operate the system and or be treated from a standing sitting and or reclining position. As described herein the hemodialysis system may automatically perform a number of functions including priming the blood set and dialysate pathways prior to treatment rinsing and disinfecting testing the integrity of ultrafilters and dialyzers priming blood into the blood set either through a prime returned or prime discarded operation and rinsing back blood at the conclusion of a treatment. The hemodialysis system may minimize the residual red blood cells in the blood set at the completion of rinseback and may ensure that the per treatment red cell loss is less than or equal to the per treatment red cell loss for traditional thrice weekly hemodialysis treatments. The hemodialysis system may automatically perform a solution infusion upon request at any time from the moment priming has started until rinseback is completed. The treatment device may automatically deliver heparin during treatment. The hemodialysis system may automatically record patient blood pressure and weight. This may be accomplished through the use of wireless communications with external stand alone sensor modules. The hemodialysis system may confirm that components have been loaded correctly and that the correct and sufficient supplies i.e. solutions concentrates etc. have been connected. The hemodialysis system may verify that the blood treatment set has been loaded correctly.

The hemodialysis system may comply with the FDA and AAMI guidelines on dialyzer reuse in testing and monitoring of the dialyzer s performance. The hemodialysis system may allow the patient to schedule their next treatment to reduce preparation time at the time of treatment. The hemodialysis system may provide a feature to allow the user to safely disconnect temporarily with a rinse back during treatment for 30 minutes or less. Alternatively the hemodialysis system may permit a user to temporarily disconnect without rinseback of blood to the user. Upon disconnecting from the arterial and venous lines the user can connect the arterial line to the venous line via a pass through connector. The system may then circulate the blood in the blood set pause the dialysate pumps and pause heparin infusion for the duration of the disconnect period. The hemodialysis system may provide the ability for the Healthcare Professional to disable the temporary disconnect feature. The hemodialysis system may minimize therapy interruptions by preventing or attempting to self resolve conditions that may lead to an interruption i.e. an alarm .

Next exemplary safety features and attributes will be described. The hemodialysis may be designed to meet certain safety standards. For example the hemodialysis system may meet all relevant AAMI and IEC safety requirements for hemodialysis machines and may be designed such that exterior exposed surfaces stay below the levels indicated in the IEC 60601 1 standard during operation. Further the user interface for the dialysis system may certain safety control features. For example the hemodialysis system may provide a mechanism for the patient to terminate a therapy and rinseback at any point during treatment. Further a method for the patient to rinse back their blood even if a nonrecoverable alarm occurs or power is lost may be provided. The user may also be able to bring the instrument to a safe state i.e. pause all instrument activities at any time during operation with a single button press.

As described herein air bubbles may be dangerous to a patient. Thus the hemodialysis system may be constructed to prevent air bubbles sized 20 microliters or larger from reaching the patient. The hemodialysis system may trigger an alarm when streams of bubbles greater than or equal to 1 microliter accumulate to exceed 20 microliters total within 30 sec. Further the hemodialysis system may trigger an alarm when streams of bubbles greater than or equal to 3 microliters accumulate to exceed 20 microliters total within 30 sec.

The hemodialysis system may include a number of safety detection features. For example the hemodialysis system may include or interface to a feature to detect venous needle dislodgement. The hemodialysis system may detect the passage of blood across the dialyzer membrane. The hemodialysis system may also detect and alert the user to dripping leaks from the portions of the blood circuit contained within the confines of the device. In addition fluid in the blood circuit that the patient is exposed to may be of dialysate for injection quality.

The hemodialysis system may be designed to be usable to patients of varying physical and mental abilities. For example the hemodialysis system user interface may be compatible with dialysis operators suffering from retinopathy and neuropathy and readable by someone who is color blind. In particular critical information displayed by the user interface may be viewable from a distance of 3 feet by a user with 20 70 vision and non critical information displayed by the user interface may be viewable from a distance of 2 feet by a user with 20 70 vision. The hemodialysis system user interface may be designed to be intuitive so that it may be understood by an operator with a 5grade reading level. In addition the hemodialysis system may be designed to be operated one handed including during therapy. This assists patients who have one arm immobilized due to needles being present in the access site.

The user interface may also be designed to be flexible and functional. For example the hemodialysis system user interface may be splash spill resistant and cleanable with the following cleaning solutions without degradation of operation wiped 5.25 sodium hypochlorite bleach diluted 1 10 wiped accelerated hydrogen peroxide made by Virox Tech Inc and wiped PDI Sani Cloth Plus.

Illumination may be controllable by the user or based on certain factors. For example the hemodialysis system may be provided with a mechanism to dim the user interface and minimize all other light emissions either by request or automatically. In addition it may be possible to turn off all light emitting sources except those necessary to locate safety critical controls such as the stop button. In the event of a power outage illumination of the blood set and dialyzer may be provided to support the patient managing their blood lines and access. The hemodialysis system may provide illumination to the appropriate controls when user interaction with the controls is necessary. This assists the user in finding necessary controls when performing therapy in a dark environment.

As discussed herein alarms may be triggered during use of the dialysis system. The hemodialysis system may provide audible and visual indication of alarm conditions. Further the hemodialysis system may distinguish the importance of an alarm condition. The audio abilities of the hemodialysis system may allow for a range of frequencies and sound levels e.g. for alarm and alert situations which may be adjustable by a user. The hemodialysis system may provide the ability for the user to mute an alarm. The hemodialysis system may have a visual indicator in addition to the GUI to call attention to alarms and alerts. For example the hemodialysis system may generate a light pole or other such visual alarm indicator that can be viewed from a significant distance in all directions e.g. 20 feet .

The hemodialysis system GUI may explain possible causes of an alarm and whether the alarm is correctable or not correctable. If an alarm is correctable the hemodialysis system user interface may guide the user through resolving the alarm. The hemodialysis system may also provide instructions on when to call service or a Healthcare Professional.

The user interface and labeling may support a number of different languages and alternative character sets. Further the hemodialysis system may provide voice guidance in the supported languages. Where possible connections may be keyed and color coded to facilitate correct connections.

The hemodialysis system user interface may provide the user with an option to receive a notification at the end of treatment and may allow the user to review relevant treatment data at the end of the treatment.

It may be desirable that the hemodialysis system be easy to operate and user friendly for non professionals. The user interface and industrial design of the hemodialysis system may allow the device to look and feel like a home product and have a simple interface. Operations to be performed by a patient may be graphically simulated on screen. A properly trained patient may be able to initiate treatment within 10 minutes of requesting a therapy. The hemodialysis system user interface may be configurable into novice and advanced modes that help encourage and guide novice users while providing quick navigation for advanced users.

The hemodialysis system may allow the user to recover from missteps and mistakes for example through use of back navigation in the user interface or an undo function. Further the hemodialysis system user interface may minimize the user time and effort required to obtain help. The hemodialysis system may provide Healthcare Professional specific training manuals patient specific training manuals and an operator s manual.

The hemodialysis system may support Healthcare Professional localization of the device consisting of setting the language for display of text elements setting the time and setting units for parameters i.e. lbs or kgs . The hemodialysis system may support Healthcare Professional configuration of the patient prescription including setting the patient s target weight the allowable therapy configurations i.e. short daily extended treatment and the associated blood flow rate the flexibility to set either dialysate flow rate and time or the dialysate volume and time for each therapy configuration i.e. short daily extended treatment the prescribed heparin protocol the maximum ultrafiltration rate the dialysate composition the dialyzer identification solution infusion bolus size and limits arterial and venous pressure limits rinseback volume and prime method prime return or prime dump . The hemodialysis system may provide the option to prevent the patient adjustment of each prescription parameter and provide maximum minimum limits on patient adjustment of the prescription parameters.

The hemodialysis system may support manual and electronic input of the patient prescription. The hemodialysis system may be designed to minimize the amount of information that is required to be manually entered for each therapy.

The device may require the patient to provide the following inputs at the start of therapy therapy type e.g. short daily extended duration and pre dialysis weight. Prior to and during therapy the hemodialysis system may allow the user to adjust the therapy end time. The hemodialysis system may provide the ability for input of the sitting and or standing patient blood pressure both prior to therapy and after therapy completion.

The device may display for confirmation the following calculated parameters at a minimum on the summary screen prior to the start of treatment therapy duration end time and the patient s end weight. The hemodialysis system may allow the user to adjust the end weight for the therapy prior to and during therapy. in addition prior to and during therapy the hemodialysis system may allow the user to adjust the therapy end time duration for the therapy.

Unless superseded by an alarm or user request the hemodialysis system may always display the following information current system state i.e. priming therapy etc. current blood flow rate current patient weight and target patient weight cumulative therapy time and therapy end time and volume of heparin delivered. When using an associated blood pressure monitor cuff the hemodialysis system may display a new blood pressure measurement for 5 minutes after that measurement was taken. The hemodialysis system may display on demand real time feedback on actual blood flow. This facilitates needle adjustment for optimal blood flow. On demand the hemodialysis system may provide a means for the user to view the following information dialysate conductivity and flow rate the most recent blood pressure measurement current ultrafiltration removal rate cumulative bolus volume infused dialysate temperature current arterial and venous pump pressures and the blood volume processed.

The following are each incorporated herein by reference in their entireties U.S. Provisional Patent Application Ser. No. 60 903 582 filed Feb. 27 2007 entitled Hemodialysis System and Methods U.S. Provisional Patent Application Ser. No. 60 904 024 filed Feb. 27 2007 entitled Hemodialysis System and Methods U.S. patent application Ser. No. 11 787 213 filed Apr. 13 2007 entitled Heat Exchange Systems Devices and Methods U.S. patent application Ser. No. 11 787 212 filed Apr. 13 2007 entitled Fluid Pumping Systems Devices and Methods U.S. patent application Ser. No. 11 787 112 filed Apr. 13 2007 entitled Thermal and Conductivity Sensing Systems Devices and Methods U.S. patent application Ser. No. 11 871 680 filed Oct. 12 2007 entitled Pumping Cassette U.S. patent application Ser. No. 11 871 712 filed Oct. 12 2007 entitled Pumping Cassette U.S. patent application Ser. No. 11 871 787 filed Oct. 12 2007 entitled Pumping Cassette U.S. patent application Ser. No. 11 871 793 filed Oct. 12 2007 entitled Pumping Cassette and U.S. patent application Ser. No. 11 871 803 filed Oct. 12 2007 entitled Cassette System Integrated Apparatus. In addition the following are incorporated by reference in their entireties U.S. Pat. No. 4 808 161 issued Feb. 28 1989 entitled Pressure Measurement Flow Control System U.S. Pat. No. 4 826 482 issued May 2 1989 entitled Enhanced Pressure Measurement Flow Control System U.S. Pat. No. 4 976 162 issued Dec. 11 1990 entitled Enhanced Pressure Measurement Flow Control System U.S. Pat. No. 5 088 515 issued Feb. 18 1992 entitled Valve System with Removable Fluid Interface and U.S. Pat. No. 5 350 357 issued Sep. 27 1994 entitled Peritoneal Dialysis Systems Employing a Liquid Distribution and Pumping Cassette that Emulates Gravity Flow. Also incorporated herein by reference are U.S. patent application Ser. No. 12 038 474 entitled Sensor Apparatus Systems Devices and Methods filed on Feb. 27 2008 U.S. patent application Ser. No. 12 038 648 entitled Cassette System Integrated Apparatus filed on Feb. 27 2008 and U.S. patent application Ser. No. 12 072 908 filed Feb. 27 2008 entitled Hemodialysis Systems and Methods. 

In addition incorporated herein by reference in their entireties and filed on an even date herewith are the following U.S. patent application Ser. No. 12 198 947 entitled Occluder for a Medical Infusion System U.S. patent application Ser. No. 12 199 055 entitled Enclosure for a Portable Hemodialysis System U.S. patent application Ser. No. 12 199 062 entitled Dialyzer Cartridge Mounting Arrangement for a Hemodialysis System U.S. patent application Ser. No. 12 199 068 entitled Modular Assembly for a Portable Hemodialysis System U.S. patent application Ser. No. 12 199 077 entitled Blood Circuit Assembly for a Hemodialysis System U.S. patent application Ser. No. 12 199 166 entitled Air Trap for a Medical Infusion Device U.S. patent application Ser. No. 12 199 176 entitled Blood Line Connector for a Medical Infusion Device U.S. patent application Ser. No. 12 199 196 entitled Reagent Supply for a Hemodialysis System and U.S. patent application Ser. No. 12 199 452 filed Aug. 27 2008 and entitled Hemodialysis System and Methods. 

While several embodiments of the present invention have been described and illustrated herein those of ordinary skill in the art will readily envision a variety of other means and or structures for performing the functions and or obtaining the results and or one or more of the advantages described herein and each of such variations and or modifications is deemed to be within the scope of the present invention. More generally those skilled in the art will readily appreciate that all parameters dimensions materials and configurations described herein are meant to be exemplary and that the actual parameters dimensions materials and or configurations will depend upon the specific application or applications for which the teachings of the present invention is are used. Those skilled in the art will recognize or be able to ascertain using no more than routine experimentation many equivalents to the specific embodiments of the invention described herein. It is therefore to be understood that the foregoing embodiments are presented by way of example only and that within the scope of the appended claims and equivalents thereto the invention may be practiced otherwise than as specifically described and claimed. The present invention is directed to each individual feature system article material kit and or method described herein. In addition any combination of two or more such features systems articles materials kits and or methods if such features systems articles materials kits and or methods are not mutually inconsistent is included within the scope of the present invention.

All definitions as defined and used herein should be understood to control over dictionary definitions definitions in documents incorporated by reference and or ordinary meanings of the defined terms.

The indefinite articles a and an as used herein in the specification and in the claims unless clearly indicated to the contrary should be understood to mean at least one. 

The phrase and or as used herein in the specification and in the claims should be understood to mean either or both of the elements so conjoined i.e. elements that are conjunctively present in some cases and disjunctively present in other cases. Multiple elements listed with and or should be construed in the same fashion i.e. one or more of the elements so conjoined. Other elements may optionally be present other than the elements specifically identified by the and or clause whether related or unrelated to those elements specifically identified. Thus as a non limiting example a reference to A and or B when used in conjunction with open ended language such as comprising can refer in one embodiment to A only optionally including elements other than B in another embodiment to B only optionally including elements other than A in yet another embodiment to both A and B optionally including other elements etc.

As used herein in the specification and in the claims or should be understood to have the same meaning as and or as defined above. For example when separating items in a list or or and or shall be interpreted as being inclusive i.e. the inclusion of at least one but also including more than one of a number or list of elements and optionally additional unlisted items. Only terms clearly indicated to the contrary such as only one of or exactly one of or when used in the claims consisting of will refer to the inclusion of exactly one element of a number or list of elements. In general the term or as used herein shall only be interpreted as indicating exclusive alternatives i.e. one or the other but not both when preceded by terms of exclusivity such as either one of only one of or exactly one of. Consisting essentially of when used in the claims shall have its ordinary meaning as used in the field of patent law.

As used herein in the specification and in the claims the phrase at least one in reference to a list of one or more elements should be understood to mean at least one element selected from any one or more of the elements in the list of elements but not necessarily including at least one of each and every element specifically listed within the list of elements and not excluding any combinations of elements in the list of elements. This definition also allows that elements may optionally be present other than the elements specifically identified within the list of elements to which the phrase at least one refers whether related or unrelated to those elements specifically identified. Thus as a non limiting example at least one of A and B or equivalently at least one of A or B or equivalently at least one of A and or B can refer in one embodiment to at least one optionally including more than one A with no B present and optionally including elements other than B in another embodiment to at least one optionally including more than one B with no A present and optionally including elements other than A in yet another embodiment to at least one optionally including more than one A and at least one optionally including more than one B and optionally including other elements etc.

It should also be understood that unless clearly indicated to the contrary in any methods claimed herein that include more than one step or act the order of the steps or acts of the method is not necessarily limited to the order in which the steps or acts of the method are recited.

In the claims as well as in the specification above all transitional phrases such as comprising including carrying having containing involving holding composed of and the like are to be understood to be open ended i.e. to mean including but not limited to. Only the transitional phrases consisting of and consisting essentially of shall be closed or semi closed transitional phrases respectively as set forth in the United States Patent Office Manual of Patent Examining Procedures Section 2111.03.

