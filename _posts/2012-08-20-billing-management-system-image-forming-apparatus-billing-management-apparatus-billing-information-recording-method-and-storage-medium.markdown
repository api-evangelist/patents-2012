---

title: Billing management system, image forming apparatus, billing management apparatus, billing information recording method, and storage medium
abstract: A management system is implemented by one or more information processing apparatuses connected via a network to one or more execution apparatuses that execute processes constituting a process flow. The management system includes a first registration unit that registers, in a storage unit, an information structure that is generated when the process flow is executed and that is used to store at least one of billing information and an execution result of each of the processes in the process flow. The system also includes a receiving unit that receives at least one of the billing information and the execution result from each of the execution apparatuses. Further, the system includes a second registration unit that registers at least one of the billing information and the execution result received by the receiving unit in the information structure.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09141978&OS=09141978&RS=09141978
owner: RICOH COMPANY, LTD.
number: 09141978
owner_city: Tokyo
owner_country: JP
publication_date: 20120820
---
This application is a continuation of and claims the benefit of priority under 35 U.S.C. 120 from U.S. Ser. No. 12 795 163 filed Jun. 7 2010 now U.S. Pat. No. 8 275 679 and claims the benefit of priority under 35 U.S.C. 119 from Japanese Patent Application No. 2009 174609 filed Jul. 27 2009 the entire contents of both of which are hereby incorporated herein by reference.

A certain aspect of the present invention relates to a billing management system an image forming apparatus a billing management apparatus a billing information recording method and a storage medium.

Mechanisms for enabling an image forming apparatus to operate in cooperation with an application running on a separate computer connected via a network to the image forming apparatus have been proposed in these years see for example Japanese Patent Application Publication No. 2008 10993 .

Meanwhile an image forming apparatus may include a billing function in addition to its inherent functions for copying printing faxing and or scanning. For example an image forming apparatus may include counters for recording usage of the respective functions and a mechanism for increasing the counters according to the usage of the functions. In the case of a leased image forming apparatus installed in an office for example a service person of the manufacturer of the image forming apparatus regularly checks the counters and charges the office based on the values of the counters. As another example there is an image forming apparatus with a coin box for charging a user on site for use of a function e.g. copying .

Here when an image forming apparatus operates in cooperation with a fee based external application charges for a service provided by the application are billed separately by the provider of the application. In other words even if it seems like one service for a user charges for a service provided by the image forming apparatus and charges for a service provided by the external application are separately billed to the user. This is particularly bothersome for the user if the charges are billed e.g. invoices are sent at different timings. Also if the charges are on a pay as you go basis it is bothersome for the user to compare the actual usage of the services with that written on multiple invoices and determine whether the charges are correct.

An aspect of the present invention provides a billing management system including an image forming apparatus and a billing management apparatus. The image forming apparatus includes a process information receiving unit configured to receive process information indicating a list of processes to be performed in a process flow requested by an information processing apparatus connected via a network to the image forming apparatus a registration unit configured to generate identification information for the process flow and to transmit the identification information to the billing management apparatus a process execution unit configured to perform a first process in the list of processes which is assigned to the image forming apparatus a billing information transmitting unit configured to transmit billing information for the first process performed by the process execution unit together with the identification information to the billing management apparatus and a data transfer unit configured to transfer output data of the first process performed by the process execution unit together with the identification information to a service providing apparatus that is to perform a second process in the list of processes. The billing management apparatus includes an identification information receiving unit configured to receive and register the identification information transmitted from the image forming apparatus a billing information receiving unit configured to receive the billing information for the first process and the second process together with the identification information from the image forming apparatus and the service providing apparatus and a billing information fixing unit configured to record the billing information for the first process and the second process in a billing information storing unit in association with the identification information.

Another aspect of the present invention provides a method of recording billing information performed by an image forming apparatus and a billing management apparatus. The method includes the steps performed by the image forming apparatus of receiving process information indicating a list of processes to be performed in a process flow requested by an information processing apparatus connected via a network to the image forming apparatus generating identification information for the process flow and transmitting the identification information to the billing management apparatus performing a first process in the list of processes which is assigned to the image forming apparatus transmitting billing information for the first process together with the identification information to the billing management apparatus and transferring output data of the first process together with the identification information to a service providing apparatus that is to perform a second process in the list of processes. The method further includes the steps performed by the billing management apparatus of receiving and registering the identification information transmitted from the image forming apparatus receiving the billing information for the first process and the second process together with the identification information from the image forming apparatus and the service providing apparatus and recording the billing information for the first process and the second process in a billing information storing unit in association with the identification information.

Preferred embodiments of the present invention are described below with reference to the accompanying drawings. is a drawing illustrating an exemplary configuration of an information processing system according to an embodiment of the present invention. An information processing system shown in includes at least one image forming apparatus and at least one user terminal that are connected via a wired or wireless network such as a local area network LAN . The information processing system further includes an OCR server a translation server and a billing management server billing management apparatus that are connected via a wide area network to the network . Here the image forming apparatus and the billing management server may constitute a billing management system.

The image forming apparatus is a multifunction peripheral including multiple functions image forming functions such as printing scanning copying and facsimile transmission and reception in a body. Alternatively the image forming apparatus may be implemented by an apparatus such as a printer a scanner a copier or a facsimile machine providing a single function. The image forming apparatus records billing information for a used image forming function in a non volatile recording medium such as a hard disk drive HDD .

The user terminal may be implemented by any type of device that can store and execute a software program and has a communication function. For example the user terminal may be implemented by an information processing apparatus such as a desktop personal computer PC a notebook PC a personal digital assistance PDA or a cell phone.

The OCR server is an example of a service providing apparatus and implemented by a computer including an application program that provides an optical character recognition OCR function as a Web service OCR service via a network.

The translation server is another example of a service providing apparatus and implemented by a computer including an application program that provides a function for translating e.g. from English into Japanese document data e.g. text data as a Web service translation service via a network.

The OCR server and the translation server charge for their services. Here it is assumed that the OCR server and the translation server are being operated by service providers different from the provider of the image forming apparatus .

The billing management server is a computer providing a Web service billing management service for integrally managing or consolidating billing information for services performed processes provided by the image forming apparatus the OCR server and the translation server . In this embodiment it is assumed that the billing management server is being operated by the manufacturer of the image forming apparatus . A service person of the image forming apparatus bills a user based on billing information recorded in the billing management server .

The controller includes a CPU a RAM a ROM and an HDD . The ROM stores for example programs and data used by the programs. The RAM is used for example as a storage area into which programs are loaded and as a work area for the loaded programs. The CPU executes the programs loaded into the RAM to implement various functions. The HDD stores for example programs and data used by the programs.

The scanner is hardware for scanning a document to obtain image data. The printer is hardware for printing print data on a recording medium such as paper. The modem is hardware for connecting the image forming apparatus to a telephone line and is used to send and receive image data by facsimile communications. The operations panel is hardware including an input unit such as buttons for receiving user inputs and a display unit such as a liquid crystal display panel. The network interface is hardware for connecting the image forming apparatus to a wired or wireless network such as a local area network LAN . The SD card slot reads for example programs stored in an SD card . Thus with the image forming apparatus of this embodiment in addition to the programs stored in the ROM programs stored in the SD card can be loaded into the RAM and executed.

The scanning widget the printing widget and the translation and copying widget are application programs and are collectively called widgets in this embodiment. In these years simple application programs are often called widgets or gadgets. In this embodiment application programs that can be easily installed and used are called the widgets and the term widget is not used to limit the technical scope of application programs. Each of the widgets may be simply called the widget of this embodiment performs or controls a process flow by using services provided by the image forming apparatus and or services provided on the network .

The scanning widget requests the image forming apparatus to scan a document to obtain image data and stores the obtained image data in the user terminal .

The printing widget requests the image forming apparatus to print document data stored in the user terminal .

The translation and copying widget requests the image forming apparatus to scan a document to obtain image data requests the OCR server to perform an OCR process on the obtained image data requests the translation server to translate text data obtained by the OCR process and then requests the image forming apparatus to print the translated text data. In other words the translation and copying widget performs for example a process flow where a document in Japanese is output as a result of copying a document in English.

The widget manager functions as a framework for the widgets and interfaces communications between the widgets and the image forming apparatus . Each of the widgets includes an interface and a protocol defined by the widget manager . In other words the widgets of this embodiment are application programs that operate in cooperation with the widget manager .

The OS is an operating system. Software programs in the user terminal run as processes or threads on the OS .

The image forming apparatus includes standard applications SDK applications an SDK platform a control service and an OS .

The standard applications are default applications installed in the image forming apparatus before the factory shipment. In the exemplary configuration shown in the standard applications include a scanning application a printing application a copying application and a fax application . The scanning application performs a scan job. The printing application performs a print job. The copying application performs a copy job. The fax application performs a facsimile transmission job and a facsimile reception job.

The control service is implemented by software modules that for example provide upper layer applications with functions for controlling various hardware resources. The functions for example include a network communication function a scanner control function a printer control function and a memory management function.

The SDK applications are plug in applications that are additionally installed to expand the functions of the image forming apparatus after its factory shipment. In a provider application is shown as an example of the SDK applications . The provider application enables the user to operate the widgets from the image forming apparatus and causes the image forming apparatus to perform processes requested by the widgets .

The SDK platform provides an execution environment for the SDK applications . The SDK applications are developed using application programming interfaces API provided by the SDK platform . For example the SDK platform provides the SDK applications with a scanning function interface a print function interface and a copy function interface. APIs provided by the SDK platform are made public to allow a third party to develop the SDK applications .

The OS is an operating system. Software programs in the image forming apparatus run as processes or threads on the OS .

The widget the widget manager and the provider application are described below in more detail. is a block diagram illustrating exemplary functional configurations of the widget the widget manager and the provider application according to a first embodiment of the present invention.

As shown in the widget includes a widget UI unit a widget information transmitting unit a linkage unit a logic unit and an attribute information management file .

The widget UI unit displays various screens related to the widget on a display unit of the user terminal . The widget information transmitting unit transmits a registration request for widget information to the widget manager when the widget is activated. The widget information process information includes information necessary to execute the widget e.g. information regarding a process flow . The linkage unit controls communications transmission and reception of information with the widget manager . The attribute information management file contains configuration information widget information for the widget . The logic unit implements a function unique to the widget .

The widget manager includes a widget information registration unit an advertising unit a widget information providing unit a relay unit and a widget information management table .

The widget information registration unit receives a registration request for widget information from the widget and stores the widget information in the widget information management table . The widget information management table stores widget information of the widgets running on the user terminal and is generated in a storage unit of the user terminal .

The advertising unit advertises broadcasts or multicasts for example a user ID contained in the widget information received by the widget information registration unit on the network. The advertisement is issued for each user each user ID . That is after an advertisement for user A is issued in response to the activation of a widget of the user terminal no advertisement is issued even if another widget of the same user terminal is activated. In this embodiment for descriptive purposes it is assumed that the user terminal corresponds one to one to a user. Accordingly the advertisement issued by the advertising unit is used to report to the image forming apparatus new entry of a user allowed to use a widget . Alternatively the advertisement may be issued for each set of widget information. In this case the image forming apparatus may be configured to remove duplicate advertisements issued for the same user.

In response to a request from the image forming apparatus the widget information providing unit provides transmits the widget information registered in the widget information management table to the image forming apparatus . The relay unit relays communications between the widget and the provider application .

The provider application includes a user detection unit a UI control unit a widget information obtaining unit process information receiving unit a job tracking data registration unit a billing information transmitting unit a data transfer unit a data receiving unit a service control unit process execution unit and a user management table .

The user detection unit detects a user allowed to use the widget based on an advertisement issued by the widget manager and registers for example a user ID contained in the advertisement in the user management table . The user management table is used to manage a list of users who have activated the widgets on the network.

The UI control unit receives user inputs such as commands for operating the widgets . Thus although the widgets are stored in the user terminal they can also be operated by using the operations panel of the image forming apparatus . The widget information obtaining unit obtains from the widget manager the widget information of a selected widget that belongs to a user user ID selected from the users user IDs registered in the user management table .

The job tracking data registration unit when starting a process flow of the selected widget generates job tracking data JTD or a job tracking ID for the process flow and transmits the generated job tracking data or the job tracking ID to the billing management server i.e. registers the job tracking data in the billing management server . The job tracking data are used to record for each service used in the process flow performed by the widget billing information indicating a charge count and information processing result indicating success or failure of a process performed to provide the service. The job tracking data registration unit also generates unique identification information job tracking ID and assigns the identification information to the corresponding job tracking data.

The billing information transmitting unit transmits to the billing management server billing information for a service s process in the process flow which is performed by the image forming apparatus together with the job tracking ID.

The data transfer unit transfers for example output data of a service s process that is in the process flow of the selected widget and performed by the image forming apparatus together with the job tracking ID to the widget manager .

The data receiving unit receives for example output data of services performed by servers e.g. the OCR server and the translation server other than the image forming apparatus together with the job tracking ID from the widget manager .

The service control unit controls execution of services requested by the widget . Actual processes for providing the services are performed by the standard applications and the SDK applications other than the provider application .

Details of the billing management server are described below. is a block diagram illustrating an exemplary hardware configuration of the billing management server . As shown in the billing management server includes a drive unit a secondary storage unit a memory a CPU and an interface that are connected to each other via a bus B.

Programs for implementing various processes at the billing management server may be provided by a storage medium such as a CD ROM. When the storage medium containing programs is mounted on the drive unit the programs are installed from the storage medium via the drive unit into the secondary storage unit . The programs may not necessarily be installed from the storage medium but may instead be downloaded via a network from another computer. The secondary storage unit stores the installed programs and other necessary files and data.

The memory temporarily stores programs retrieved from the secondary storage unit when the programs are executed. The CPU performs functions of the billing management server according to the programs temporarily stored in the memory . The interface connects the billing management server to a network.

The job tracking data receiving unit receives job tracking data or a job tracking ID from the job tracking data registration unit of the image forming apparatus and stores the job tracking data or the job tracking ID in the memory . The billing information receiving unit receives a job tracking ID and billing information for services processes performed in a process flow from the corresponding servers e.g. the image forming apparatus the OCR server and the translation server and records the billing information in the job tracking data corresponding to the job tracking ID. The job tracking data fixing unit records the job tracking data in the job tracking data storing unit when the process flow is completed or terminated . The job tracking data storing unit is a storage area for permanently managing the job tracking data and may be provided in the secondary storage unit .

Exemplary processes in the information processing system are described below. is a sequence chart showing a process performed when a widget is activated. In it is assumed that the widget manager has already been activated.

For example when the translation and copying widget is activated in response to a user request the widget information transmitting unit of the translation and copying widget obtains the corresponding widget information from the attribute information management file and transmits the obtained widget information to the widget information registration unit of the widget manager S .

The widget ID is identification information for uniquely identifying the translation and copying widget . The user ID is an identifier of the user of the translation and copying widget . Thus the widgets are associated with the user user ID of the user terminal where they are installed. The widget address is identification information e.g. a URL for uniquely identifying the translation and copying widget in network communications. The display name is a character string to be displayed to represent the translation and copying widget

The process flow information includes a service name a provider name a URL and configuration information for each service a process to be performed used in a process flow performed by the translation and copying widget . The service name is an identifier of the corresponding service. In the service names are written in English. However the service names may instead be represented by any other codes that are suitable for processing by programs. The provider name is the name of a business providing the corresponding service. For example the provider name ABC for the scanning service and the printing service indicates the manufacturer of the image forming apparatus . Meanwhile the provider names for the OCR service and the translation service indicate businesses operating the OCR server and the translation server . The URL is an identifier used by the provider application of the image forming apparatus to identify the corresponding service on the network. Although URLs are used in this embodiment to identify services on the network different types of identifiers may be used depending on the communication protocol employed. The configuration information includes parameters execution conditions for the corresponding service. For example the configuration information for the scanning service may include parameters such as a resolution and a color mode. The configuration information for the OCR service may include parameters such as a document orientation horizontal or vertical and a language type. The configuration information for the translation service may include parameters such as a source language and a target language. The configuration information for the printing service may include parameters such as a paper size a color mode an N up processing option and a duplex printing option.

In this embodiment the services are arranged in the process flow information in the order they are used. In the process flow of the translation and copying widget shown in the scanning service the OCR service the translation service and the printing service are used the corresponding processes are performed in the order mentioned. Alternatively services may be arranged in the process flow information regardless of the order they are used. In such a case the process flow information may further include information indicating the order in which the services are used. Although the configuration of the widget information of the translation and copying widget is described above as an example widget information of other widgets may have similar configurations.

The widget information is obtained from the attribute information management file . Therefore the user can customize the configuration information of services by editing the attribute information management file .

Referring back to the widget information registration unit registers the received widget information in the widget information management table corresponding to the user ID contained in the widget information S . If no widget information management table corresponding to the user ID is found the widget information registration unit generates a widget information management table for the user ID and registers the widget information in the generated table . In this embodiment it is assumed that the user terminal corresponds one to one to a user. Also it is assumed that the widget information management table is deleted when the widget manager is terminated. Accordingly in this embodiment when a widget is activated for the first time after the user terminal is turned on the widget information management table is generated.

When the widget information management table is newly generated i.e. when widget information related to a user user ID is registered for the first time the advertising unit issues on the network an advertisement including the user ID contained in the widget information and a widget information URL uniform resource locator for obtaining the widget information. The widget information URL is unique to the widget manager i.e. to each user terminal .

Assuming that there are multiple image forming apparatuses the advertisement is received by the user detection units of the image forming apparatuses that are ready to communicate with the user terminal . When receiving the advertisement the user detection unit of each image forming apparatus registers the user ID and the widget information URL contained in the advertisement in the user management table S .

Through the above process the existence of the translation and copying widget is recognized by the widget manager and also the existence of the user of the user terminal is recognized by the image forming apparatus . As a result the user can use the translation and copying widget via the image forming apparatus . If the same user successively activates other widgets such as the scanning widget and the printing widget the widget information of those widgets is also registered in the widget information management table . In this case however no advertisement is issued because the advertisement for the user has already been issued.

After the process of the user moves to the location where the image forming apparatus is installed to execute the translation and copying widget . When there are multiple image forming apparatuses that are ready to communicate with the user terminal the user may select any one of them. In other words the user can execute the translation and copying widget using any one of the image forming apparatuses .

Next a process performed according to user operations at the image forming apparatus is described. is a sequence chart showing a process of selecting a widget to be executed.

When the user inputs a request to use the provider application via the operations panel S the UI control unit of the provider application displays a user selection screen on the operations panel based on information registered in the user management table S . Alternatively in step S the UI control unit may be configured to obtain user information from the widget manager and to display a user selection screen based on the obtained user information. In this case it is not necessary to perform steps S and S of in advance.

In the next step in the user presses a button corresponding to its own user ID on the user selection screen S . When the button is pressed the widget information obtaining unit retrieves from the user management table a widget information URL corresponding to the user ID associated with the pressed button. Here user authentication may be performed when a button corresponding to a user ID is pressed so that subsequent steps are performed only when the user is successfully authenticated.

Next the widget information obtaining unit transmits a request for obtaining widget information to the retrieved widget information URL S . The request for obtaining widget information transmitted to the widget information URL is received by the widget information providing unit of the widget manager . The widget information providing unit obtains sets of widget information of all widgets registered in the widget information management table and transmits the sets of widget information to the provider application S . In this step the widget information providing unit generates URLs widget relay URLs that are unique to the respective widgets or the respective sets of the widget information and used to relay communications between the provider application and the widgets . The widget information providing unit attaches the generated widget relay URLs to the sets of widget information of the widgets and transmits the sets of widget information with the widget relay URLs to the provider application . For example each set of the widget information to be transmitted in step S has a configuration as shown in .

The widget information of includes a widget relay URL in addition to items of the widget information shown in . In step S sets of widget information as shown in are transmitted. Needless to say there is a case where only one set of widget information is transmitted.

The widget relay URL may be generated and attached to widget information when the widget information is registered in the widget information management table .

Next when the sets of widget information are received the UI control unit of the provider application stores the received sets of widget information in the RAM and displays a screen widget selection screen including a list of widgets available to the user S .

If for example the button for the translation and copying widget is selected on the widget selection screen and a start key on the operations panel is pressed after setting a document on the scanner S the process flow of the translation and copying widget is started.

A procedure for executing the process flow of the translation and copying widget is described below. are sequence charts showing a procedure for executing the process flow of the translation and copying widget according to the first embodiment. Here the procedure is divided into two simply because of space limitations.

When the translation and copying widget is selected for execution the job tracking data registration unit of the provider application generates job tracking data JTD in the RAM based on the widget information hereafter called current widget information of the translation and copying widget S .

The job tracking data can also contain a charge count and a processing result for each service in the process flow information. The charge count indicates the amount of charge for the service. Instead the charge count may be represented by the amount of money itself. The processing result indicates whether the service has been successfully completed or not. In the charge counts and the processing results of all services are not recorded yet because none of the services has been performed. The job tracking data do not include the configuration information for the services. This is because the job tracking data are not used by servers including the image forming apparatus that provide the services according to the configuration information.

The job tracking data registration unit records information associating the current widget information with the job tracking ID of the generated job tracking data in the RAM . For example the job tracking data registration unit records a pair of the widget ID of the current widget information and the job tracking ID in the RAM .

Next the job tracking data registration unit transmits the job tracking data to the billing management server S . When receiving the job tracking data the job tracking data receiving unit of the billing management server stores the received job tracking data in a temporary management area in the memory S . Identification information an IP address or a URL of the billing management server used to communicate with the billing management server is stored for example in the HDD of the image forming apparatus in advance.

Next the service control unit of the provider application detects that the service name of the first entry record of the process flow information in the current widget information is scanning and no URL is specified for the first entry and therefore determines to request the scanning application to perform the scanning service. That is if no URL is specified for an entry or a service the service control unit determines that the service needs to be performed in the image forming apparatus i.e. the corresponding process is assigned to the image forming apparatus . In the above case since the application for performing the scanning service in the image forming apparatus is the scanning application the service control unit determines to request the scanning application to perform the scanning service.

Then the service control unit inputs a request to perform a scanning process to the scanning application together with the configuration information for the scanning service contained in the current widget information S . The scanning application causes the scanner to scan one page of a document according to the configuration information S . The scanning application outputs image data scanned image obtained by scanning the document and information scanning result information including a charge count for scanning one page of the document and a processing result of the scanning process to the service control unit S .

The billing information transmitting unit of the provider application transmits the scanning result information together with the job tracking ID JTID corresponding to the current widget information to the billing management server S . The billing information receiving unit of the billing management server records the scanning result information in the job tracking data that are stored in the memory and correspond to the received job tracking ID S . More specifically the billing information receiving unit updates the charge count and the processing result for the scanning service in the job tracking data based on the scanning result information.

Next the service control unit of the provider application detects that the service name of the second entry record of the process flow information in the current widget information is OCR and a URL is specified for the second entry and therefore determines to request an external Web service to perform the OCR service. Then the data transfer unit of the provider application transmits a scanning completion report including the scanned image and the job tracking ID to a widget relay URL contained in the current widget information S . The scanning completion report transmitted to the widget relay URL is received by the relay unit of the widget manager . The relay unit obtains widget information corresponding to the widget relay URL from the widget information management table and transfers the scanning completion report to the widget address contained in the obtained widget information. The scanning completion report transmitted to the widget address is received by the logic unit of the translation and copying widget

Thus the data transfer unit transfers data to the translation and copying widget via the widget manager . In however the intermediation process performed by the widget manager is omitted for brevity. Also the intermediation process performed by the widget manager is omitted in the descriptions below.

When receiving the scanning completion report the logic unit of the translation and copying widget transmits a request to perform an OCR process on the scanned image to the OCR server S . The request includes the scanned image and the job tracking ID contained in the scanning completion report and the configuration information for the OCR service. Here it is assumed that the logic unit of the translation and copying widget has information regarding the process flow performed by the translation and copying widget the services used in the process flow the configuration information for the services and the locations e.g. URLs of servers providing the services. This information may be built into or hard coded in the logic unit as logic or may be dynamically obtained from the attribute information management file of the translation and copying widget

The OCR server performs an OCR process on the scanned image according to the received configuration information S . Then the OCR server transmits information OCR result information including a charge count for the OCR process and a processing result of the OCR process together with the job tracking ID to the billing management server S . The identification information of the billing management server used by the OCR server to communicate with the billing management server may be stored in advance in the OCR server or may be transmitted from the provider application together with the scanned image and the job tracking ID. The same applies to the translation server .

The billing information receiving unit of the billing management server records the OCR result information in the job tracking data that are stored in the memory and correspond to the received job tracking ID S . More specifically the billing information receiving unit updates the charge count and the processing result for the OCR service in the job tracking data based on the OCR result information.

Next the OCR server returns an OCR completion report including text data OCR data obtained by the OCR process and the job tracking ID to the translation and copying widget S .

When receiving the OCR completion report the logic unit of the translation and copying widget transmits a request to perform a translation process on the OCR data to the translation server S . The request includes the OCR data the job tracking ID and the configuration information for the translation service.

The translation server performs a translation process on the OCR data according to the received configuration information S . Then the translation server transmits information translation result information including a charge count for the translation process and a processing result of the translation process together with the job tracking ID to the billing management server S . The billing information receiving unit of the billing management server records the translation result information in the job tracking data that are stored in the memory and correspond to the received job tracking ID S . More specifically the billing information receiving unit updates the charge count and the processing result for the translation service in the job tracking data based on the translation result information.

Next the translation server returns a translation completion report including text data translated data obtained by the translation process and the job tracking ID to the translation and copying widget S .

When receiving the translation completion report the logic unit of the translation and copying widget transmits a request to perform a printing process on the translated data to the provider application of the image forming apparatus S . The request includes the translated data and the job tracking ID. To be precise the request from the translation and copying widget is relayed by the relay unit of the widget manager to the provider application . However for brevity the relaying process by the widget manager is omitted in and the descriptions below.

When receiving the request for the printing process the data receiving unit of the provider application reports the request to the service control unit . The service control unit inputs a request for printing to the printing application together with the translated data in the reported request and the configuration information for the printing service contained in the current widget information corresponding to the job tracking ID S . The printing application causes the printer to print the translated data according to the configuration information S . Then the printing application outputs information printing result information including a charge count for printing one page and a processing result of the printing process to the service control unit and thereby reports the completion of the printing process to the service control unit S .

The billing information transmitting unit of the provider application transmits the printing result information together with the job tracking ID JTID corresponding to the current widget information to the billing management server S . The billing information receiving unit of the billing management server records the printing result information in the job tracking data that are stored in the memory and correspond to the received job tracking ID S . More specifically the billing information receiving unit updates the charge count and the processing result for the printing service in the job tracking data based on the printing result information.

After the processing results and the charge counts for all of the services in the job tracking data are recorded the job tracking data fixing unit of the billing management server records the job tracking data in the job tracking data storing unit S .

Next the data transfer unit of the provider application transmits a printing completion report to the translation and copying widget S . When receiving the printing completion report the logic unit of the translation and copying widget terminates the process flow.

The job tracking data recorded in the job tracking data storing unit of the billing management server are used as billing information for the corresponding user. Thus the charge counts for all the services used by the translation and copying widget are recorded in the job tracking data and integrally managed or consolidated by the billing management server . This in turn makes it possible to bill the user for all the services used by the translation and copying widget with a single invoice based on the job tracking data. For example a service person of the manufacturer of the image forming apparatus may bill the user for all the services used based on the job tracking data. Thus this embodiment makes it possible to allow the user to pay charges for all used services to a single business instead of paying the charges to separate service providers.

In this case after receiving the payments for all the services used by the user the manufacturer of the image forming apparatus distributes the received money to other service providers e.g. the operators of the OCR server and the translation server according to the charge counts recorded in the job tracking data. For such handling of payments agreements may be made between the manufacturer of the image forming apparatus and other service providers.

In the above configuration information regarding charges e.g. the charge counts and the processing results is directly transmitted from the respective servers providing the services to the billing management server without going through the widgets . This configuration makes it possible to reduce the possibility that the charge counts and the processing results are tampered with by an unauthorized widget developed by a malicious developer and thereby makes it possible to prevent a free ride on a service.

When a document includes multiple pages as the easiest approach steps S through S may be repeated looped for the number of pages example 1 . As another approach the translation and copying widget may be configured to buffer data of multiple pages so that only some of the steps are looped. For example the translation and copying widget may be configured to wait until steps S through S are performed for all pages and scanned images of all pages are received example 2 . In this case in step S the translation and copying widget transmits the scanned images of all the pages at once to the OCR server . Therefore in processes including OCR translation and printing after step S the data of all pages are treated as a unit.

As still another approach the translation and copying widget may be configured to wait until steps S through S are performed for all pages and translated data of all pages are received example 3 . In this case in step S the translation and copying widget transmits the translated data of all pages at once to the provider application . Therefore in processes including printing after step S the data of all pages are treated as a unit.

Outlines of examples 1 through 3 described above are shown in . is a drawing illustrating variations of the procedure for executing the process flow of the translation and copying widget described above. In for brevity the OCR server and the translation server are shown on the same axis. Also in d indicates a job tracking ID. The same job tracking ID is used throughout the procedure of each of the examples 1 through 3.

Let us assume a document includes three pages. In example 1 a process flow or a loop including scanning OCR translation and printing is repeated three times. In all cycles of the loop the same job tracking ID d is used. Accordingly the charge counts and the processing results for the three pages are recorded in the same job tracking data.

In example 2 three pages of the document are scanned successively the OCR and translation processes are performed on scanned images of the three pages and translated data of the three pages are printed. In this case one job tracking ID d is assigned to three sets pages of data in a request for the OCR process and a response to the request in a request for the translation process and a response to the request and in a request for the printing process. Accordingly also in example 2 the charge counts and the processing results for the three pages are recorded in the same job tracking data.

In example 3 a process flow including scanning OCR and translation is repeated three times and translated data of the three pages are buffered by the translation and copying widget . Then the translated data of the three pages are printed. In this case one job tracking ID d is assigned to three sets pages of translated data in a request for the printing process. Accordingly also in example 3 the charge counts and the processing results for the three pages are recorded in the same job tracking data.

Next a case where an error occurs in a process flow is described. is a sequence chart showing an exemplary procedure performed when an error occurs in the process flow of the translation and copying widget of the first embodiment. The same step numbers as shown in are assigned to the corresponding steps in and descriptions of those steps are omitted here.

In it is assumed that an error has occurred in an OCR process S by the OCR server . In this case the OCR server transmits OCR result information indicating that the OCR process has failed an error has occurred together with a job tracking ID to the billing management server S . The billing information receiving unit of the billing management server records the OCR result information in job tracking data that are stored in the memory and correspond to the received job tracking ID S . More specifically the billing information receiving unit records an error in the OCR service in the job tracking data.

When an error occurs in the middle of the process flow the job tracking data fixing unit of the billing management server records the job tracking data in the job tracking data storing unit S .

Meanwhile the OCR server returns an error report message including the job tracking ID to the translation and copying widget S . When receiving the error report message the logic unit of the translation and copying widget cancels remaining processes transfers the error report message including the job tracking ID to the provider application and thereby aborts the process flow S . When the error report message is received by the data receiving unit of the provider application the service control unit recognizes that the process flow corresponding to the job tracking ID in the error report message has been aborted.

In the case of the job tracking data are fixed as shown in . Even in this case the user is charged for the scanning service. This is because the scanned image obtained by the scanning service has already been transmitted to the translation and copying widget and stored by the translation and copying widget in the user terminal . Since the scanned image has been made available to the user it is reasonable to assume that the user has received the scanning service. Similarly even if an error occurs in the translation service or the printing service the user is charged for services that have been completed before the occurrence of the error.

Also in a case where a document with multiple pages is processed the user is charged for services performed before the occurrence of an error.

A second embodiment of the present invention is described below. is a block diagram illustrating exemplary functional configurations of the widget the widget manager and the provider application according to the second embodiment of the present invention. The same reference numbers as those shown in are assigned to the corresponding components in and descriptions of those components are omitted.

In the provider application further includes a common key providing unit . The common key providing unit generates an encryption key a common key or a private key used to encrypt data such as output data of a service and job tracking data. Also the common key providing unit securely transmits the generated common key for example to the OCR server the translation server and the billing management server .

In the billing management server further includes a common key receiving unit . The common key receiving unit receives the common key transmitted from the common key providing unit of the provider application .

Exemplary processes in the information processing system according to the second embodiment are described below. Here differences between the first embodiment and the second embodiment are mainly described and descriptions in the first embodiment may also apply to the second embodiment unless otherwise mentioned.

In step S similarly to step S of the job tracking data registration unit of the provider application generates job tracking data JTD in the RAM . Next the common key providing unit of the provider application generates in the RAM an encryption key hereafter called a common key A for encrypting data transmitted via the network and associates the common key A with the job tracking ID S . Any algorithm may be used to generate the common key A. For example a random number generated by a random number generator may be used as the common key A.

Following step S the common key providing unit requests the OCR server the translation server and the billing management server to transmit their digital certificates based on the URLs of the servers in the job tracking data and the identification information of the billing management server prerecorded in the HDD S S S . The digital certificates are issued by a certificate authority CA . When receiving the digital certificates from the OCR server the translation server and the billing management server S S S the common key providing unit verifies the received digital certificates S S S . Verification of the digital certificates may be performed by any known method. After successfully verifying the digital certificates the common key providing unit encrypts the common key A using public keys contained in the digital certificates S S S . Then the common key providing unit transmits the encrypted common key A together with the job tracking ID JTID to the OCR server the translation server and the billing management server S S S . In brackets indicate encrypted data items. For example at steps S S and S indicates the encrypted common key A.

Each of the OCR server the translation server and the billing management server decrypts the encrypted common key A using its own secret key and stores the decrypted common key A in a storage unit in association with the job tracking ID received together with the common key A S S S . In steps S through S processing performed at the billing management server is controlled by the common key receiving unit . The common key receiving unit stores the received common key A in the memory in association with the job tracking ID.

Through the above steps the common key A is securely shared by the image forming apparatus the OCR server the translation server and the billing management server .

Next similarly to step S of the job tracking data registration unit of the provider application transmits the job tracking data to the billing management server S . When receiving the job tracking data the job tracking data receiving unit of the billing management server stores the received job tracking data in a temporary management area in the memory S .

Next similarly to step S of the service control unit of the provider application inputs a request to perform a scanning process to the scanning application S . The scanning application causes the scanner to scan a document in a manner similar to step S of S and outputs a scanned image and scanning result information including a charge count and a processing result to the service control unit S .

Next the billing information transmitting unit of the provider application encrypts the scanning result information using the common key A S . Then the billing information transmitting unit transmits the encrypted scanning result information together with the job tracking ID JTID corresponding to the current widget information to the billing management server S . The billing information receiving unit of the billing management server decrypts the scanning result information using the common key A corresponding to the received job tracking ID S . Next the billing information receiving unit records the decrypted scanning result information in the job tracking data corresponding to the received job tracking ID S .

Meanwhile the data transfer unit of the provider application encrypts the scanned image using the common key A S . Then the data transfer unit transmits a scanning completion report including the encrypted scanned image and the job tracking ID to the translation and copying widget S . When receiving the scanning completion report the logic unit of the translation and copying widget transmits a request to perform an OCR process to the OCR server S . The request includes the encrypted scanned image and the job tracking ID contained in the scanning completion report.

In response the OCR server identifies the common key A for decrypting the scanned image based on the received job tracking ID and decrypts the scanned image using the identified common key A S . Next the OCR server performs an OCR process on the decrypted scanned image S and encrypts obtained OCR data and OCR result information using the common key A S . Then the OCR server transmits the encrypted OCR result information together with the job tracking ID to the billing management server S . The billing information receiving unit of the billing management server decrypts the OCR result information using the common key A corresponding to the received job tracking ID S . Next the billing information receiving unit records the decrypted OCR result information in the job tracking data corresponding to the received job tracking ID S .

The OCR server also returns an OCR completion report including the encrypted OCR data and the job tracking ID to the translation and copying widget S . When receiving the OCR completion report the logic unit of the translation and copying widget transmits a request to perform a translation process on the OCR data to the translation server S . The request includes the job tracking ID and the encrypted OCR data contained in the OCR completion report.

In response the translation server identifies the common key A for decrypting the OCR data based on the received job tracking ID and decrypts the OCR data using the identified common key A S . The translation server performs a translation process on the decrypted OCR data S . Next the translation server encrypts translated data and translation result information using the common key A S . Then the OCR server transmits the encrypted translation result information together with the job tracking ID to the billing management server S . The billing information receiving unit of the billing management server decrypts the translation result information using the common key A corresponding to the received job tracking ID S . Next the billing information receiving unit records the decrypted translation result information in the job tracking data corresponding to the received job tracking ID S .

The translation server also returns a translation completion report including the encrypted translated data and the job tracking ID to the translation and copying widget S . When receiving the translation completion report the logic unit of the translation and copying widget transmits a request to perform a printing process on the translated data to the provider application of the image forming apparatus S . The request includes the job tracking ID and the encrypted translated data.

When receiving the request to perform the printing process the data receiving unit of the provider application identifies the common key A for decrypting the translated data based on the job tracking ID in the request and decrypts the translated data using the identified common key A S . Then the data receiving unit inputs a request for printing including the decrypted translated data to the service control unit .

Steps S through S are substantially the same as steps S through S of . Following step S the billing information transmitting unit of the provider application encrypts printing result information using the common key A S . Then the billing information transmitting unit transmits the encrypted printing result information together with the job tracking ID corresponding to the current widget information to the billing management server S . The billing information receiving unit of the billing management server decrypts the printing result information using the common key A corresponding to the received job tracking ID S . Next the billing information receiving unit records the decrypted printing result information in the job tracking data corresponding to the received job tracking ID S . Then similarly to step S of the job tracking data fixing unit of the billing management server records the job tracking data in the job tracking data storing unit S .

Meanwhile the data transfer unit of the provider application transmits a printing completion report to the translation and copying widget S . When receiving the printing completion report the logic unit of the translation and copying widget terminates the process flow.

Encrypting intermediate data such as a scanned image OCR data and translated data before transmission as described above makes it possible to prevent leakage of the intermediate data document information by an unauthorized widget. Here the unauthorized widget indicates for example a widget that is developed by a malicious Web service provider and can be downloaded from the network. Such an unauthorized widget may be configured to leak the intermediate data to a malicious Web service. Compared with plaintext data encrypted data provides higher security even if the data are leaked by an unauthorized widget.

In step S the data transfer unit may be configured to transmit the common key A together with the printing completion report to the translation and copying widget . This enables the translation and copying widget to decrypt intermediate data such as a scanned image OCR data and translated data retained at the translation and copying widget by using the common key A. In this case the provider application may be configured to receive a digital certificate from the translation and copying widget and to transmit the common key A to the translation and copying widget if the digital certificate is successfully verified. Also the provider application may be configured to encrypt the common key A using a public key in the received digital certificate to securely transmit the common key A.

Alternatively the provider application may be configured to transmit the common key A to the widget manager that is more reliable than the widget . In this case using the common key A the widget manager decrypts intermediate data stored for example in a folder by the translation and copying widget

A procedure involving encryption of intermediate data as shown in may also be modified in a manner similar to when an error occurs in the middle of a process flow. In this case if an error report message is received as in step Sof the provider application is preferably configured to not transmit the common key A to the translation and copying widget . This is because if an error occurs in a procedure involving encryption of intermediate data it is highly likely that an unauthorized process has been performed. For example there is a case where intermediate data are tampered with by a unauthorized translation and copying widget or by an unauthorized Web service used by the translation and copying widget and at a later stage the intermediate data cannot be successfully decrypted by an authorized service. Also there is a case where an unauthorized process by an unauthorized widget fails and results in an error because intermediate data are encrypted. Further there is a case where an unauthorized widget intentionally causes an error to evade payment of charges. For example if the billing management server is configured to nullify all charge counts recorded in a process flow in a procedure involving encryption of intermediate data when an error occurs in the process flow it is possible to evade payment of charges by intentionally causing an error.

As described above if the provider application is configured to not transmit the common key A to the widget when an error occurs in a process flow in a procedure involving encryption of intermediate data the billing management server may be configured to nullify all charge counts recorded in the process flow. This is because if the common key A is not transmitted to the widget the user cannot decrypt and use the intermediate data. That is it is unreasonable to assume that the user has received services provided before the occurrence of an error and therefore it is unreasonable to charge for the services.

For the above reasons when receiving result information indicating an error as in step Sof the billing information receiving unit of the billing management server records failed in the job tracking data as the processing result of the corresponding service and nullifies all charge counts of other services that have been recorded in the job tracking data. For example the billing information receiving unit resets the recorded charge counts to 0 or clears the recorded charge counts so that the user will not be charged for the services.

After an error occurs and the charge count s is nullified by the billing information receiving unit the job tracking data fixing unit records the job tracking data in the job tracking data storing unit . As a result the charge count s is fixed as exemplified in .

Instead of autonomously nullifying a charge count s the billing information receiving unit may be configured to nullify a charge count s in response to a request from the provider application that has received an error report message. In this case when receiving an error report message as in step Sof the billing information transmitting unit of the provider application transmits a charge count nullification request together with a job tracking ID to the billing management server . When receiving the nullification request the billing information receiving unit of the billing management server nullifies a charge count s in the job tracking data corresponding to the received job tracking ID.

By the way the processing load for encryption and decryption may become high depending on the encryption method used. Therefore when a document including multiple pages is to be processed encrypting all the pages may degrade the performance. Meanwhile it is highly likely that technologies such as secure socket layer SSL and IPSec are employed as the network infrastructure to enhance the security of network communications between the widgets and the servers providing services. With such a network infrastructure it may be redundant to employ common key cryptography also at the application level.

For these reasons when a document includes multiple pages when there are multiple sets of data to be processed only some one or more of the pages or some of the sets of data may be encrypted. For example when the number of pages is small less than a predetermined value only the first page may be encrypted or when the number of pages is large greater than or equal to the predetermined value the pages may be encrypted at intervals.

Even when only some of the pages are encrypted charge counts are handled in substantially the same manner as described above when an error occurs in a process flow employing encryption hereafter called an authentication flow . That is all charge counts recorded in job tracking data corresponding to the process flow are nullified. Here a process flow employing encryption is called an authentication flow because encrypting data also makes it possible to check the validity of processes in the process flow i.e. to authenticate the process flow. Accordingly encrypting pages at intervals makes it possible to authenticate the process flow at intervals and thereby to improve the security.

Meanwhile charge counts are handled in substantially the same manner as described in the first embodiment when an error occurs in a process flow not employing encryption hereafter called a plaintext flow . That is the user is charged for services successfully completed. The reasons for charging for successfully completed services are already described in the first embodiment. An additional reason is that an error in a plaintext flow is often caused by a problem at the user side. Examples of problems at the user side include a case where the widget is configured to perform a process that intentionally causes an error in a plaintext flow and deterioration in network communication conditions.

For the above reasons the job tracking data registration unit is preferably configured to generate new job tracking data when an authentication flow and a plaintext flow are switched and to register the new job tracking data in the billing management server . This configuration makes it possible to easily identify charge counts to be nullified when an error occurs in an authentication flow. In this case since charge counts received together with the same job tracking ID are recorded in the same job tracking data the billing information receiving unit may be configured to nullify all charge counts in job tracking data corresponding to a job tracking ID received together with result information indicating an error in an authentication flow.

Considering the difference between an authentication flow and a plaintext flow in handling charge counts when an error occurs it is preferable to process one page or a small number of pages that is less than a predetermined value at once in an authentication flow. Even if an error is intentionally generated in an authentication flow to nullify all charge counts and thereby to evade payment of charges limiting the number of pages to be processed at once in the authentication flow makes it possible to minimize the resulting loss.

Meanwhile a large number of pages that is greater than a predetermined value are preferably processed at once in a plaintext flow. In a plaintext flow since the user is charged for successfully completed services even when an error occurs it is unlikely that payment of charges can be evaded. Also processing a large number of pages at once in a process flow makes it possible to improve the efficiency.

As shown in an authentication flow and a plaintext flow may be combined. is a sequence chart showing an exemplary combination of an authentication flow and a plaintext flow.

In an authentication flow based on example 1 of is performed for each of the first and fifth pages and a plaintext flow based on example 2 of is performed for each set of three pages the second through fourth pages and the sixth through eighth pages.

Alternatively the plaintext flow may be based on example 3 of . Also the plaintext flow may be performed by repeating the loop of example 1 for the number of pages. Similarly the authentication flow may be based on example 2 or example 3 of . Even in this case however the number of pages to be processed at once in the authentication flow is preferably small.

Pages or data to be processed in the authentication flow may be selected by the data transfer unit of the provider application . The authentication flow may be performed either regularly or randomly. Randomly performing the authentication flow makes it difficult for an unauthorized widget to detect the process pattern.

When the authentication flow is to be performed randomly the common key providing unit may be configured to transmit in addition to a common key information encryption page information indicating pages to be encrypted to the OCR server and the translation server . However the encryption page information may not necessarily be reported in advance. For example the OCR server and the translation server may be configured to determine whether received intermediate data are encrypted by analyzing a part of the intermediate data and to decrypt the intermediate data using a common key if the intermediate data are encrypted.

In a case where a common key is transmitted to the widget when an authentication flow is completed the common key providing unit may be configured to update the common key or generates a new common key in the next authentication flow and to transmit the updated common key to the OCR server and the translation server . This configuration makes it possible to encrypt intermediate data using a different common key for each authentication flow. For example the data transfer unit encrypts a scanned image using a different common key for each authentication flow the OCR server encrypts OCR data using a different common key for each authentication flow and the translation server encrypts translated data using a different common key for each authentication flow. Taking as an example this configuration makes it possible to prevent the translation and copying widget from performing an unauthorized process on intermediate data of the fifth page using a common key provided for the first page.

Meanwhile result information e.g. scanning result information OCR result information and translation result information including charge counts and processing results of services is not transmitted to the widget . Therefore it may not be necessary to encrypt the result information using a common key.

Some Web services provided on the Internet charge a fixed monthly fee or charge for each job. Unlike the image forming apparatus of this embodiment charge counts for such Web services may not be recorded for each page or each set of data .

In the above descriptions a widget the translation and copying widget that requests the image forming apparatus to perform the first service scanning service in a process flow is used. However the process flow of a widget may be flexibly configured and the starting point of the process flow is not limited to the image forming apparatus . For example a widget hereafter called a translation and printing widget may be configured to perform an OCR process on image data stored in the user terminal to translate the OCR data and to print the translated data. The above embodiments may also be applied to the translation and printing widget. More particularly the processes described with reference to may also be applied to the translation and printing widget. If the translation and printing widget is selected in steps other than steps S through S in are performed. Accordingly in this case no scanned image is transmitted to the translation and printing widget in step S.

Thus an aspect of the present invention provides a billing management system an image forming apparatus a billing management apparatus a billing information recording method and a storage medium that make it possible to simplify a charging system for services provided by a combination of an image forming apparatus and external applications.

The present invention is not limited to the specifically disclosed embodiments and variations and modifications may be made without departing from the scope of the present invention.

