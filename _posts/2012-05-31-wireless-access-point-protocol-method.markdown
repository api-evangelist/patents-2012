---

title: Wireless access point protocol method
abstract: The performance and ease of management of wireless communications environments is improved by a mechanism that enables access points (APs) to perform automatic channel selection. A wireless network can therefore include multiple APs, each of which will automatically choose a channel such that channel usage is optimized. Furthermore, APs can perform automatic power adjustment so that multiple APs can operate on the same channel while minimizing interference with each other. Wireless stations are load balanced across APs so that user bandwidth is optimized. A movement detection scheme provides seamless roaming of stations between APs.
url: http://patft.uspto.gov/netacgi/nph-Parser?Sect1=PTO2&Sect2=HITOFF&p=1&u=%2Fnetahtml%2FPTO%2Fsearch-adv.htm&r=1&f=G&l=50&d=PALL&S1=09019936&OS=09019936&RS=09019936
owner: Piccata Fund Limited Liability Company
number: 09019936
owner_city: Wilmington
owner_country: US
publication_date: 20120531
---
This application is a continuation of U.S. patent application Ser. No. 10 780 843 filed Feb. 18 2004 which claims priority to U.S. Provisional Ser. No. 60 472 320 filed May 21 2003 U.S. Provisional Ser. No. 60 472 239 filed May 21 2003 U.S. Provisional Ser. No. 60 466 448 filed Apr. 29 2003 and U.S. Provisional Ser. No. 60 449 602 flied Feb. 24 2003 all of which are incorporated herein by reference.

The invention relates generally to wireless networks and more particularly to wireless network configuration and power level adjustment for network performance optimization.

The proliferation of laptop and hand held portable computers has produced a concomitant need for robust reliable and high performance wireless networks to maximize the mobility advantages of these devices and increase the ease of construction and management of these wireless networks. Current wireless networks such as IEEE 802.11b 802.11a 802.11g etc networks are subject to certain limitations that can limit a mobile user s network performance and reliability. For instance only a very limited number of radio channels are available. In the current state of the art wireless access points cannot effectively share the same channel in the same area because of radio and control protocol interference. So bandwidth over a given area is limited by the number of non overlapping channels available. Also current wireless networks require manual site engineering to control the placement of access points and channel distribution between access points raising the cost and complexity of the wireless network installation process. Furthermore user roaming between wireless access points is inconsistent. Once associated with an access point a user will tend to remain associated with that access point even if another access point is capable of providing higher performance for the user. It would be desirable to provide wireless networking solutions which overcome the above described inadequacies and shortcomings of current wireless networks.

In accordance with the principles of the invention various apparatus methods and computer program products are provided to improve the performance and ease of management of wireless communications environments. For example a mechanism is provided to enable access points APs to perform automatic channel selection. A wireless network can therefore include multiple APs each of which will automatically choose a channel such that channel usage is optimized. Furthermore APs can perform automatic power adjustment so that multiple APs can operate on the same channel while minimizing interference with each other. Further aspects of the invention are used to cause load balancing of stations across APs so that user bandwidth is optimized. Novel movement detection schemes provide seamless roaming of stations between APs. These and further aspects of the invention enable the provision of automatically configurable high performance wireless communications environments.

In accordance with the present invention a fully automatic control system is provided for wireless communications environments. Referring to a typical wireless communications environment includes access devices one shown that interface between a wired communications medium and wireless devices to provide network access to the wireless devices . Wireless devices can thus communicate with wired devices and with each other via the access device . These access devices are referred to by various names depending upon the wireless architecture employed and are herein referred to as access points or APs . The wireless devices also have various architecture dependent names and are herein referred to as stations or STAs. A wireless communications capable device may be an AP or a STA or both.

Various types of wireless communications environments exist. Wireless communications environments include for example wireless data networks and wireless I O channels. An example of a wireless data network is described in IEEE Standard for Information technology Telecommunications and information exchange between systems Local and metropolitan area networks Specific requirements Part 11 Wireless LAN Medium Access Control MAC and Physical Layer PHY specifications Amendment 1 High speed Physical Layer in the 5 GHz band incorporated herein by reference hereinafter 802.11 . Furthermore various different 802.11 modes are defined. For example in IEEE 802.11 compatible wireless networks wireless devices may be arranged in an infrastructure mode whereby the network is configured such that STAs communicate with other network devices via an AP as shown in . 802.11 compatible devices may also be arranged in ad hoc mode whereby all the STAs are within transmission range and can communicate directly with each other. Furthermore wireless mesh technologies exist whereby each wireless device acts as both an AP and a STA. Wireless I O channels can be used to provide I O communications for example between servers and storage devices via the Bluetooth Standard or between home entertainment audio and video components or between wireless telephone handsets and base stations. The various aspects of the invention apply to generally to wireless networking architectures including those used in wide area networks metropolitan area networks enterprise networks and home networks and wireless I O channel architectures as they exist now and as they are developed.

According to aspects of the invention an arbitrary number of wireless access points APs can be placed in arbitrary positions and all APs and STAs will automatically configure themselves for optimal channel usage power levels and STA AP associations. So in a wireless networking environment channel usage is optimized while interference between APs is minimized. Wireless devices such as wireless enabled laptops or hand held computing devices or Internet protocol telephones are transparently and seamlessly distributed between APs such that network performance is optimized from the perspective of the user of the wireless device. And in a wireless I O channel environment that might be employed for example in a home audio video and other appliances may be moved without performance degradation and channel usage for each appliance may be optimized so that the appliances do not interfere with each other.

In order to expedite the understanding of the invention certain examples will be described as they apply to the relatively well known 802.11 wireless LAN architecture with the understanding that the principles of the invention apply more generally to any wireless communications environment. A preferred implementation of the inventive principles will then be described as embodied in an 802.11 wireless network

The following aspects of the invention contribute to its advantages and each will be described in detail below.

Since exemplary examples will refer to the 802.11 networking environment the following information provides relevant context while understandably not limiting the invention to 802.11 environments.

In an 802.11 network APs periodically send frames called Beacons . STAs listen for Beacons. When an unassociated STA i.e. a STA that is not yet able to communicate on the wireless network hears Beacons at what it deems to be a reasonable power level it can attempt to authenticate with the AP sending the Beacons and then associate with that AP. Once authenticated and associated the STA is able to send data frames to other STAs on the wireless network via the AP.

More particularly APs and STAs send and respond to three different types of frames known as Class 1 Frames Class 2 Frames and Class 3 Frames. Class 1 Frames include control frames and management frames and can be sent regardless of whether a STA is authenticated and associated with an AP. A Beacon is a type of Class 1 frame. Class 2 Frames are sent only once a STA is authenticated and include for example association request response messages. Class 3 Frames can be sent only if associated and include data frames.

In order to maximize user bandwidth and throughput the invention automatically optimizes the operation of multiple APs for a given wireless communications environment. In accordance with the exemplary IEEE 802.11a networking standard 13 non overlapping frequencies are available for use by the APs. Each AP is capable of transmitting and receiving data at a maximum rate of 54 Mbps. The actual rate at which data is transmitted and received between an AP and a STA depends upon many factors including the distance between the AP and the STA the structures located between the AP and the STA and the environmental interference occurring on the particular frequency. One skilled in the art will realize that the invention is not limited by the maximum data rates of current wireless technology nor is it limited by currently understood radio frequency attenuation factors. The principles of the invention will continue to be applicable as wireless technology evolves.

Consider an area such as the wireless network shown in wherein 8 users shown as STAs which may be mobile laptops PDAs and the like share a space including a single AP operating on one of the 13 available 802.11a frequencies denoted f . The 8 users share the bandwidth provided by the AP . If all 8 users are located close enough to the AP such that the AP provides a 54 Mb bit maximum data rate then all 8 users share the APIs bandwidth such that each user maintains 6.75 Mb throughput on average. The invention contemplates the fact that data traffic is bursty and that a user in the present example may attain 54 Mb throughput for a short interval but for purposes of simplicity the average throughput over time for a given user is discussed. 

Now referring to a second AP has been added in the area. The second AP operates on a different one of the 13 frequencies denoted f such that the two APs do not interfere nor do their associated STAs . As shown 4 of the 8 users have roamed to the second AP . Now each user maintains 13.5 Mb throughput on average. Addition of further APs on different frequencies further increases user average throughput.

In accordance with the invention a Dynamic Radio Control Protocol DRCP provides a mechanism for an arbitrary collection of STAs and APs to automatically control the frequency and power of their radios in order to extend the properties exemplified in to maximize overall system performance. DRCP messages are passed between APs and APs as well as between APs and STAs to implement this functionality. Eight types of messages are used DRCP Preclaim DRCP Claim DRCP Announce DRCP Bid DRCP Accept DRCP Registration Request and DRCP Registration Acknowledge.

DRCP Preclaim and Claim messages are exchanged between APs during AP initialization and are used to aid automatic channel selection in accordance with the invention. DRCP Announce messages are sent by APs and received by STAs during STA optimization. These Announce messages inform invention enabled STAs of available invention enabled APs to which they may choose to associate and provide information about APs that STAs can use to aid a decision as to whether to request to roam to another AP. DRCP Bid messages are sent by STAs to APs during STA optimization. These messages inform invention enabled APs of invention enabled STAs that are requesting association to the APs. DRCP Accept messages are sent by APs to STAs in response to DRCP Bid messages. These messages inform a STA that it may associate with the AP it is requesting to associate with. DRCP registration request and acknowledge messages are exchanged by invention enabled APs and STAs to indicate to each that the other is DRCP capable.

The DRCP protocol employing these messages will first be described as used in a generic wireless communications environment. The detailed implementation of each of these messages will then be further described in terms of a preferred embodiment in an 802.11 environment.

The aspects of the invention are now described as they apply to AP initialization and optimization and then as they apply to STA initialization and optimization. It is noted that though many of the inventive aspects described herein with regard to STAs and APs are advantageous when implemented they are not required to be implemented in a wireless communications environment. Performance advantages are achieved when only the APs or only the STAs or both implement one or more of the various aspects of the invention.

During AP initialization APs perform automatic channel selection. In accordance with the channel selection aspect of the invention APs located in the same wireless network automatically select channels for operation such that they do not interfere with nearby APs. The invention contemplates that different bands of frequencies are available for example based on 802.11 version and the country in which the network is deployed. According to a preferred embodiment APs attempt to select a channel in each band in which the AP is equipped to operate which is least likely to interfere with other APs that are already deployed. APs also quarantine channels in accordance with rules associated with regulatory domains Europe etc. so they don t interfere with other wireless applications radar etc. . In the event that one AP selects a free channel and another AP selects the same free channel at the same time i.e. a channel selection Collision the APs media access control MAC addresses are used as a tie breaker. If the other AP is a standard AP that does not include the improvements associated with the current invention then the invention enabled AP will direct its own radio to the next best channel. The AP repeats the channel selection phase for each band of frequencies.

More particularly referring to before a newly added AP starts to Beacon i.e. broadcast management packets to other APs and STAs the AP first examines a list of RF bands supported by the AP and the list of channels supported and not quarantined by the radio which implements the Physical Layer PHY for each RF band. The AP then selects a channel in each band according to the following algorithm 

Scan Intervals occur periodically. During a Scan Interval step the AP passively scans all channels which the AP supports within the band step . The AP gathers a list of active APs the channels on which they are operating and the power at which the beacons from each AP was heard. This information is used to build a table called a channel map step which contains a list of all APs heard from the channel on which they were heard and the signal strength at which they were heard. There is a separate channel map for each band. The AP sorts the channel map to produce a list of APs in ascending order of power level step .

Referring to a channel is now selected by the AP as follows. First the AP peruses the channel map step and if there is a channel on which no AP is operating i.e. signal strength 0 step then the AP selects that channel step . Otherwise the AP peruses the list for the channel transmitting the weakest signal step . The AP now enters a time interval referred to as the claiming period step .

If the AP selected a channel having the weakest signal strength the AP notes the channel ID of the channel that it has selected the received power level on the channel and the AP ID of the AP that generated that power level step . It will use the power level value as a baseline against which to detect increases in received power on its selected channel. If the AP selected an empty channel the baseline power level will be the AP s noise floor.

The AP then advertises its intention to use the selected channel by periodically transmitting DRCP Claim messages during the claiming period step . Claim messages are transmitted at full power. During this claiming period the AP receives all Beacons DRCP Claim messages and DRCP Announce messages transmitted on the currently chosen channel step and uses the information contained therein to build an Other APs table step . For each Beacon it receives the AP notes the AP ID and the received power level in the Other APs table . For each Claim or Announce message it receives the AP notes the AP ID of the AP that sent the message the received power level and the transmit power backoff TP backoff in the Other APs table . The TP Backoff value indicates how far from maximum power the sending AP s radio has been turned down and will be explained in more detail in the AP Power Adjustment section. The AP also marks the entry for that AP ID as being DRCP capable. A normalized received power value is calculated by adding the TP Backoff value to the received power value. The normalized received power value equalizes the AP power levels for comparison purposes. When the AP receives a Beacon or DRCP message from an AP for which it already has an entry it updates the entry and stores the received power and Tp backoff values as a list.

If another AP starts to radiate significant energy on the selected channel one of two events must have occurred. The new AP is either not running DRCP or a conflict has occurred with another DRCP active AP where a race condition has caused the other DRCP active AP to select the same channel at the same time. This is called a Channel Selection Collision CSC .

At the end of the claim period step the AP stops sending Claim messages and evaluates the information it has collected its CSC data to determine if a CSC has occurred. It looks to see if the received power in any entry is greater than the baseline power level it recorded for the channel step . If so it looks to see if the received power is exceeded in at least half of the power level values for the entry step . If so the AP checks to see whether the AP in the entry is DRCP capable step .

If the other AP is not DRCP active the AP defers to the non DRCP active AP and starts the entire channel selection process over again.

If the other AP is DRCP active then a CSC is assumed to have occurred. When a CSC has occurred the MAC address of the other AP is compared to the MAC Address of this AP . If the MAC address of this AP is numerically higher than the observed MAC address step this AP starts the channel selection process over again.

If at the end of the claiming period the AP has succeeded in claiming the selected channel it begins running on the channel. The AP starts beaconing begins sending DRCP Announce messages and prepares to enter the Optimization stage in order to run its Auction and Power Adjustment functions step .

A variation on the channel selection process of can be employed to improve channel selection coverage when several APs are powered on all at once. Referring to each AP upon power up sends a claim message on a first channel chosen from the channel map for purposes of example designated channel steps . All APs scan all channels. All APs scanning on channel will hear each other s claim messages. During the claiming period an AP will ascertain whether channel is in fact available for use by it. Accordingly the AP listens for other DRCP Claim messages on the same channel which would indicate that another invention enabled AP is trying to use the same channel step . The AP keeps track of the number of different APs it hears based on AP IDs the claim messages received and the average signal strength of claim messages from each AP. The AP builds an adjacency vector adjacency count adjacency power total step . Adjacency count represents the number of APs heard on the channel. Adjacency power total represents the sum of the average power levels for each AP heard. Each AP sends its adjacency vector to all the other APs in its claim messages step . If a DRCP claim message is received step in this case on channel the AP first compares its adjacency count with the adjacency count received in the claim message step . If the AP s adjacency count is higher than that received in the claim message this probably indicates that the AP is closer to the center of the network. The AP therefore continues to claim the channel during the claim period. If the AP s adjacency count is the same as the adjacency count received in the claim message step the AP then compares its own adjacency total power to the adjacency total power value received in the claim message. If the AP s own adjacency total power is higher than that received in the claim message step this may also indicate that the AP is closer to the center of the network and therefore the AP continues to send claim messages on the channel. If the AP s own adjacency total power is the same as that received step then the AP performs the previously described MAC address test step . If the AP finds that its own adjacency count or adjacency power are lower than any received in claim messages or that in the event of a tie on these values that its MAC address is higher it ceases to send claim messages on the channel and returns to peruse the channel map step . Otherwise the AP continues to send claim messages including its adjacency vector step . If at the end of the claiming period step the AP s adjacencies are greater than other AP s adjacencies the AP has won the channel and proceeds to the AP optimization phase step . According to this method the APs closest to the center of a multi AP network obtain the first channel assignments and subsequent channels are assigned to the other APs.

Scan Intervals occur periodically. During a Scan Interval step the AP scans all channels which the AP supports within the band receiving Beacons and Announce messages step . The information received in the Beacon and Announce messages is used to build a table called the Scan table step . An example of a Scan table is shown in . The Scan table includes an entry for each AP from which a Beacon or Announce message has been received. For each entry there is stored the AP ID and the channel on which that AP was heard. Also stored is a rxPowerRunningTotal value that represents the sum of the signal strengths of each message received from that AP . Also stored is a rxPowerSampleCount value that represents the number of messages received from the AP . A DRCP flag is set if an Announce message has been received from the AP . The entryAge entry is incremented every time the channel is scanned. The rxPowerAvg is calculated during a Preclaim interval as will be further described.

As the scan progresses the rxPowerSampleCount values in the Scan table are monitored and if any one of them exceeds a threshold herein labeled threshold step the AP proceeds to step to build a channel map. In addition if any entryAge value in the table exceeds a certain threshold threshold step the AP will proceed to step . Also if the number of scans completed exceeds a certain threshold threshold step the AP will proceed to step . Otherwise the AP continues scanning and updating the Scan table .

An example of a preferred channel map is shown in . The channel map contains an entry for each channel ID. To build the channel map the AP peruses the Scan table and calculates the rxPowerAvg value for each entry as RxPowerAvg Scan table .rxPowerRunningTotal Scan table rxPowerSamplecount 

For each channel the AP ID with the highest rxPowerAvg value is entered in the channel map . The AP s rxPowerAvg value is entered into the channel map as the highestPwrlevel parameter.

In certain network implementations it is undesirable to locate two operating APs within a certain distance of each other because doing so does not increase network performance and may reduce it. So according to a preferred option once the channel map has been assembled the AP checks the channel map to see if any of the highestPwrlevel values in the map exceed a certain threshold power level step . The threshold power level is chosen to indicate that the AP is located too close to another AP. If any highestPwrlevel exceeds the threshold power level the AP is placed in Standby mode step . The AP in Standby mode waits for a period of time herein referred to as Standby Interval before returning to start another scan interval step .

If no highestPwrlevel values are found to exceed the threshold power level the AP proceeds to assemble a triplet channel map step . As shown in the AP sorts a channel map into triplets for example channels and channels and channels and etc. The power heard on each channel in the triplet is averaged into a triplet average. The list of triplets is sorted in ascending order with the triplet with the lowest average power at the top of the list. The AP starts at the top of the list and looks for the first triplet in which the power heard on the center channel of the triplet is less than or equal to the power heard on the two adjacent channels and selects this channel step . If no such triplet is available the AP selects the channel with the lowest triplet average. In the example shown in AP chooses channel . This process advantageously minimizes interference between channels by selecting channels that do not tend to have high power adjacent channel usage.

The AP then records the baseline power for the selected channel as the highestPwrlevel value for the channel and records the AP ID of the AP at that power level step . A Preclaim Interval is now entered step . During the Preclaim interval the AP transmits Preclaim messages on the selected channel step . The AP also receives Beacon Announce and Preclaim messages on the channel step . The AP uses the received messages to update the Scan table step . The AP continues to update the Scan table until one of two Preclaim intervals expires. During the min Preclaim interval step the rxPowerSampleCount value for each AP ID on the selected channel is checked to see if a minimum sample size threshold has been exceeded. If so the Preclaiming interval ends and the AP proceeds to check to see whether too many APs are operating on the selected channel step . Otherwise the Preclaiming period extends until the end of the max Preclaim interval step .

In some network environments and in particular environments of limited area the operation of too many APs on the same channel does not increase network performance and may cause a performance reduction. So according to a preferred option the AP checks to see if there are too many APs operating on the network step . The number of different AP IDs present in the Preclaim APs table is used to make this determination. If there are too many APs operating on the selected channel at a power level greater than a defined threshold the AP enters Standby mode

If there are not too many APs operating on the selected channel the AP calculates an adjacency vector sum step . The adjacency vector sum is calculated over all APs on all channels as Adjacency vector sum sum Preclaim APs .ReceivedPowerTotal Preclaim APs .count The adjacency vector sum is used as a tiebreaker if necessary during the Claiming interval to be further described.

The AP now enters the Claiming interval step . During the Claiming interval the AP transmits Claim messages on the selected channel step . Claim messages include the adjacency vector sum. The AP also receives all Beacon Announce and Claim messages on the selected channel step . The AP uses the information contained in the received messages to build a Claim APs table step . An example of the Claim APs table is shown in . The Claim APs table contains an entry for each AP ID. The received power level of each message received from a given AP is stored in the Claim APs table as a list of values shown as column ReceivedPowerlevel . Furthermore for each Announce or Claim message received a DRCP flag is set. The AP continues to update the Claim APs table until the end of the Claiming interval step .

The AP then evaluates the Claim APs table step to ascertain whether any other APs were heard from. If no entries exist in the Claim APs table step the AP has won the selected channel. The AP can then begin Beaconing and sending Announce messages on the channel step . If the Claim APs table includes one or more entries then if the selected channel was empty at the beginning of the Claiming Interval step the AP concedes the channel and returns to re scan step . Otherwise if the channel was not empty then if the ReceivedPowerlevel values for all entries in the table are less than the baseline level recorded during Preclaiming plus a threshold level e.g. 2 db step then the AP has won the channel step . However if the AP does find a ReceivedPowerlevel value that exceeds the baseline power level plus the threshold level and that entry is associated with an AP ID that was not the one recorded on the channel during the Preclaiming Interval then the AP checks the entry s DRCP flag step . If the DRCP flag indicates that the AP ID associated with the entry is not DRCP capable then the AP returns back to the scan interval to re start the channel selection process. If the DRCP flag indicates that the AP ID associated with the entry is DRCP capable then the AP compares its adjacency vector with the adjacency vector received in the other AP s claim messages step . If the AP s adjacency vector is less than the other AP s adjacency vector the AP concedes the channel and returns to re scan. If the AP s adjacency vector is not less than the other AP s adjacency vector then the AP checks to see if the adjacency vectors are equal step . If they are the MAC addresses of the two APs are compared step . If the AP s MAC address is greater than the other AP s MAC address the AP has won the channel step . Otherwise the AP concedes the channel and returns to re scan step . One skilled in the art will realize that the MAC address comparison decision is arbitrary and can be made in the opposite manner.

Once an AP is running on a channel it continuously performs the following functions to optimize its configuration in the wireless LAN 

In order to perform Radio Power Adjustment the AP maintains a number of tables. The tables include information received from other APs and STAs operating on the selected channel. This information is used to ascertain such things as power levels of other devices on the channel and distances between devices on the channel in order to control the AP s power level.

Each AP maintains a number of tables that it consults to perform power adjustment. One such table is the AP KnownAPs Table . As shown in once initialized on a channel an AP receives Beacons and DRCP Announce messages from all other APs operating within the range of its radio on its channel steps . The AP uses these received messages to build the AP KnownAPs table . For each message it receives the AP checks to see if it has an entry in the AP knownAPs table for the AP ID in the message step . If found the AP updates the entry step otherwise it creates a new one step up to a maximum of Max APs entries step . The value of Max AP is design dependent.

The AP ID TP Backoff and Max Power fields are extracted from each DRCP Announce and Hello message received. The TP Backoff value is stored as a list of values for each message received from each AP ID. The sample size is the number of TP Backoff values received for each AP ID.

Since Announce messages are only sent by DRCP enabled APs the AP also marks the entry as DRCP active. APs sending Beacons which contain no DRCP fields are not marked DRCP active. For each message received the AP adds the TP Backoff value to the received power level to determine a normalized received power level as follows normalized power avg received power tp backoff 

Accounting for the TP backoff in the normalized power level provides a value that is consistent and can be used for comparison with power level measurements from other APs.

Received beacons do not explicitly carry a TP backoff value however since beacons are always transmitted at full power they effectively carry a TP backoff value of zero. Thus the AP can update the AP KnownAPs table based on a received Beacon. In this case the AP stores the TP backoff value as zero and sets the normalized power and the Max Power to the received power level value.

Additionally the AP keeps an Age for each entry. The Age is reset to zero 0 each time a Beacon or DRCP Announce is received from the AP corresponding to the entry. Entries are aged as part of the AP Power Adjustment process.

APs also continuously maintain a table of the STAs that are associated with it the AP AssociatedSTA table. Referring to for every associated STA the AP monitors and collects signal strength information for data packets received step . If an entry for the STA already exists in the AP AssociatedSTAs table step that entry is updated step . Otherwise a new entry is created for the STA step . The collected data is periodically analyzed by the AP for AP power adjustment purposes. In addition whenever a DRCP active STA becomes associated with an AP it sends a Registration Request message to the AP . Registration Request messages are sent by the STA to the AP periodically until a Registration Acknowledge message is received by the STA . Upon receipt of a Registration Request from an STA step the AP updates the entry in the AssociatedSTA Table and marks it as a DRCP active STA step and sends a Registration Acknowledge message to the STA step .

During the channel selection process the AP transmits at maximum power that is it uses a TP backoff value of zero. Once the AP has successfully claimed a channel it calculates a TP Backoff value and adjust its transmit power for data transmissions down in accordance with this value to minimize same channel interference and maximize channel bandwidth re use. The calculation of the TP Backoff value is now further described.

Generally with reference to AP power adjustment is accomplished as follows The AP peruses its AP KnownAPs table step . The AP finds the AP in the table with the highest TP Backoff value. The AP then sets its own Max TP backoff value to the highest TP Backoff value step . This Max TP Backoff value if used as the AP s TP Backoff value would reduce the AP s transmit power to a level just below the range of the nearest AP operating on the same channel.

Once the Max TP backoff is calculated the AP then scans the AssociatedSTA table to ascertain the distance to the farthest associated STA step . The distance to the farthest associated STA is compared to the distance to the closest AP operating on the same channel step . If the distance to the farthest associated STA is less than the distance to the closest AP the AP s TP Backoff value is left at Max TP Backoff step . If the distance to the farthest associated STA is greater than the distance to the closest AP operating on the same channel step then the Max TP backoff value is adjusted back down to accommodate this STA step and the AP s TP backoff is set to this adjusted value step . This power adjustment is periodically repeated to account for changes in the AP KnownAPs table and the AP AssociatedSTAs tables change step . Power adjustment may be repeated every second for example in an 802.11 environment.

In accordance with the preferred embodiment for use in a wireless data networking environment as shown in and B APs perform the above described power adjustment as follows. First the AP checks to see if its Avoid Other WLANs flag is set step . The AvoidOtherWLANs flag is a configuration parameter which can affect Power Adjustment. In many wireless networking architectures it is possible for several APs to occupy the same channel while serving different physical networks. For example in the 802.11 architecture several APs can serve different ESSs. The AvoidOther WLANs flag is false by default. When set to false the AP will ignore any other APs on the same channel who s physical network is different from this AP s physical network e.g. ESS ID . This option is useful for cases when there are multiple APs in relatively close proximity that are on different networks. In this case the operator may prefer to run his AP at the maximum power level to provide the best possible signal for all stations on his network.

If the Avoid Other WLANs flag is not set the AP sets its TP Backoff to 0 step . The AP will therefore transmit at full power as long as the Avoid Other WLANs flag is not set. If the Avoid Other WLANs flag is set the AP proceeds with the power adjustment process and will not interfere with other APs even if they are operating on a different network.

The AP processes the information in the AP KnownAPs table every Hello Interval step to perform power adjustment. The Hello Interval is architecturally and design dependent. In an 802.11 environment the Hello Interval may be for example the 100 ms beacon interval. The knownAPs table entries are first aged before other processing is performed. The age of each entry is incremented step and any entries whose age exceeds Max AP Entry Age are deleted steps . Thus if an AP hasn t been heard from in a while it is aged out of the table to prevent it from affecting this AP s power adjustment calculations.

As previously described the normalized power field of an entry n of the AP KnownAPs table is determined by averaging over several received power measurement samples. The greater the number of samples used to derive the value the more accurate the measurement. The AP accounts for the inaccuracy in this value by subtracting a standard error based on the sample size from the normalized power level as shown in the following formula. Note in an 802.11 environment the normalized power level is expected be a negative number ranging in value from 25 to 90 dBm. AP knownAPs .corrected power AP knownAPs .normalized power getStandardError sample size 

In this formula the function getStandardFrror would return the standard error for the sample size of sample size in each entry n . For example table I in shows the standard error values for a number of sample sizes for RF signal measurements. This formula is applied to each entry n in the AP KnownAPs table to calculate the corrected power values for each entry step .

The AP KnownAPs table is then scanned for the entry corresponding to the AP which was heard at the highest corrected power level. This corrected power level is compared to the AP s noise floor step . The AP s noise floor is a measure of background power on the channel. If the AP finds that the highest corrected power level is less than the AP s noise floor then the AP may transmit at maximum power without interfering with the other APs on the channel. It therefore leaves its Max TP Backoff value at 0 step . If the AP however finds that the highest corrected power level is higher than the AP s noise floor it needs to set a TP Backoff to avoid interfering with that AP. In this case the AP calculates Max TP Backoff by subtracting its noise floor from the corrected sower associated with that AP step .

Once it has calculated Max TP Backoff the AP must then determine if there are any associated STAs that are farther away ie who s signal strength is weaker than the highest power AP. The AP s AssociatedSTAs table is analyzed to find the STA that is the greatest distance from the AP step . The normalized power and sample size values for this STA are used to calculate a corrected power value for this STA as previously described. The lowest power STA s corrected power level is compared to the AP s noise floor step . If the corrected power level is less than the noise floor then the AP needs to run at full power to cover the STA so the AP TP Backoff value is set to 0 step . If the corrected power level is greater than the AP s noise floor then the STA TP Backoff value is set to the corrected power level minus the noise floor step .

Next Max TP Backoff is compared to STA TP Backoff step . The AP s TP Backoff my TP Backoff is set to the lower of the two backoff values to avoid interference with the closest AP while ensuring coverage for the farthest STA. So If STA TP Backoff is less than Max TP Backoff then my TP Backoff is set to the Max TP Backoff value step . If STA TP Backoff is greater than Max TP Backoff then the my TP Backoff value is set to the STA TP Backoff value plus some minimum signal to noise ratio step .

The AP then adjusts its transmit power by the value of my TP Backoff step and uses my TP Backoff as the value of TP Backoff in its Announce messages. According to the preferred embodiment the AP will transmit data at a power level adjusted by TP Backoff but will transmit DRCP management messages e.g. Claim Announce Accept at full power. So APs can always hear management messages passed between each other.

Furthermore various different wireless networking architectures may provide a mechanism for clearing the wireless channel further increasing the probability that the management messages will be received. For example in the 802.11 architecture the AP issues a Clear to Send CTS message to clear the channel step and then sends a DRCP Announce message at maximum power step . After sending the Announce message at maximum power level the AP resumes use of its calculated TP backoff value for data packets to minimize same channel interference as described above.

When a STA is associated with an AP the AP keeps track of the distance between the STA and the AP . If the AP is using a non zero TP Backoff value and the AP ascertains that the STA is moving out of range of the AP at backed off power then the AP can adjust its TP Backoff value to accommodate the STA s movement.

The distance between an AP and an associated STA is calculated and stored in the AssociatedSTAs table in units of Banzais . The Banzai is a unit of distance derived from a measurement of received signal strength from an AP operating with a known transmit power backoff. In an 802.11 environment for example a received signal strength measurement is generally expected to range in value from 25 dBm to 90 dBm but depending upon possible antenna gain at the high end or sensitivity at the low end may range from 0 dBm down to 100 dBm. A transmit power backoff is generally expected to range in value from 0 dB to 65 dB. Given a received signal strength measurement of received power and transmit power backoff of TP Backoff from an AP the distance to that AP in Banzais is calculated as follows distance in banzais ABS MIN 0 received power tpbackoff 

Algorithms for movement detection are described in more detail later. For purposes of AP power adjustment as previously described the AP collects multiple samples of received power and TP Backoff values for each STA over time and the distance between the AP and the STA is calculated over all these samples. The AP detects movement by continuously checking to see if the difference between the distance to each station derived from a set of long term samples is sufficiently smaller that the current distance measurement based on the most recently collected samples to indicate that the STA is moving away from its AP .

If the AP detects that the STA is moving away and the STA is within a given Short Term Standard Error Banzais of the current edge of the transmit signal based on the current TP Backoff then the AP switches to a TP Backoff of 0 until it no longer has any moving STAs associated with it.

More particularly referring to to detect STA movement the AP collects a long term samples of distance values for a STA step and then continuously collects short term sample size distance values for the STA step . The difference between the long term distance and short term distance values is compared to a Moving Threshold value plus the standard error in the two distance measurements in order to eliminate false movement detection. See section for more information. A station is considered to be moving when the short term distance exceeds the long term distance by more than the Moving Threshold plus the sum of the errors in the two measurements. The following pseudo code describes this comparison.

If the AP detects that the STA is moving the AP sets its TP Backoff to 0 so that it transmits data at maximum power step . The AP remains at maximum power until it detects that the STA is no longer moving or quiet. If the AP determines that it is no longer moving before the STA loses the association to its AP the AP resumes normal processing of received signal strength to determine a new appropriate TP Backoff value as previously described step .

Once the AP detects that the STA is moving it begins using another test to detect when the STA has stopped moving. To detect that the STA has stopped moving the AP compares the distance to the STA derived using the Long Term Sample Size to the distance derived from the most recent Short Term Sample Size samples. The AP looks to see when this difference is less than just the standard error in the two measurements to determine that the STA has stopped moving. This test is performed as follows step 

The purpose of the Auction is to accomplish the distribution of STAs across APs in a manner that optimizes wireless communications performance. The goal is to have STAs associate to their nearest AP while taking loading the sum of the individual loads of the STAs already associated to the AP into account. This allows the RF footprints of the APs and STAs to be minimized while ensuring that no AP is overloaded.

STAs learn of available APs through the Announce messages transmitted by the APs . As will be further described with regard to STA optimization a STA calculates a biased distance to each AP it hears from including its own AP using the received power and loading information from the Announce messages. A STA will send a Bid message to an AP that is better than the STA s current AP where better means that the AP has a lower biased distance. The Bid message contains the value of the difference between the biased distance from the STA to the destination AP and the biased distance to the STA s current AP. This value is called the biased distance delta.

In particular referring to the AP collects any received Bids over a period of Auction Interval steps . If a Bid is received from a STA from which a Bid has already been received step the new bid information replaces the previous bid information step . Otherwise a new entry is created for the STA step . In either case the bid entry s age is reset step .

At the end of Auction Interval step the AP processes the received bid information. The Auction Interval in an exemplary 802.11 environment may be on the order of for example 7.5 seconds. The age of all bid entries is incremented by one step and then any bid entry whose age is greater than Max Bid Age is deleted step . The list is then sorted by biased distance delta value step .

The AP selects the bid entries with the highest biased distance delta values up to acceptsPerAuction entries and sends a DRCP Accept message to each of the STAs corresponding to those entries step . The IDs of each STA being sent an Accept is put in a list of outstanding accepts step and a count of accepted STAs who have not yet associated and registered is noted as numAcceptsOut step . At this point the next auction period begins.

In addition to receiving DRCP Bids the AP also receives an indication any time a STA associates to the AP . Referring to on receipt of the indication step the AP checks to see if it has bid information from the newly associated STA step . Any bid information found for the newly associated STA is deleted step . The AP also checks to see if the STA is in the list of outstanding accepts step and if the STA is in the accepts outstanding list that entry is deleted step and the numAcceptsOut count is decremented step . At the end of the Auction Interval any outstanding accepts from the previous auction cycle are considered to have timed out hence the list of outstanding accepts is emptied and numAcceptsOut is reset. These processes continue as long as the AP is active on a given channel.

The purpose of the STA initialization phase is to find and associate to a suitable AP to provide the STA with access to the wireless LAN and to prepare for the operation of the DRCP protocol and algorithms.

Referring to when started the STA produces a list of channels supported by the STA step . In multi PHY variant STAs e.g. STAs supporting multiple bands such as 802.11a b g the channel list will include all of the channels that are supported across the various supported bands.

First the STA scans for beacons on all channels across all supported bands e.g. STAs supporting multiple bands such as 802.11a b g will scan all channels in each of the a b and g bands. step The AP that is received at the greatest signal strength is selected step .

Preferably where multiple bands are supported the selection of an AP also takes into account a preference for the higher bandwidth bands so that for example as implemented in an 802.11 environment an AP on an 802.11a or 802.11g channel is given some preference to one operating on an 802.11b channel.

Once an AP is chosen the STA authenticates and associates to that AP step . Any security policies that control association are executed at this point.

During initialization the STA also enables the DRCP protocol so that the STA will receive DRCP Announce messages step . The STA then proceeds to the STA optimization phase step .

Once it has made its initial association and has access to the wireless LAN the STA continuously performs the following functions to optimize its configuration 

The process by which the STA canvasses the other channels to determine whether to send a DRCP Bid message is now described in further detail. In order to monitor DRCP Announce messages a STA periodically tunes its radio to the channels other than the one to which it is currently associated. However the STA must remain associated to its current AP so that it does not lose data packets. So packets must be buffered during the time that the STA is canvassing. Various wireless communications architectures may provide different means for packet buffering.

Generally referring to during a periodic scan interval step the STA causes the AP to which it is currently associated to temporarily buffer the packets destined for the STA step . Packet buffering can be initiated in a variety of ways. For example the STA may send a DRCP message to the AP to cause the buffering or the AP may periodically turn on buffering and notify the STA that it has done so. While the STA s packets are being buffered the STA tunes its radio to another channel and listens for Beacons and DRCP Announce messages on that channel step . This information is used by the AP to determine whether to bid for another AP. When the scan interval is complete packet buffering is turned off and the STA receives its buffered packets from the AP step .

The 802.11 power save mode is intended for use by STAs so that they can turn off their radios for periods of time in order to save power. STAs can indicate to APs that they are entering this power save mode. In response APs buffer the STAs packets while the STAs are sleeping . APs periodically send special Beacon messages to the STAs . STAs wake up in response to these special Beacon messages. These Beacon messages include information as to whether any data is buffered for the STA . The STA wakes up if data is buffered for it.

STAs operating in an 802.11 environment in accordance with the preferred embodiment of the invention use the 802.11 power save mode to go off channel and canvass other channels for DRCP Announce messages. After the channel canvass is complete the STA reverts to normal power save mode. Stations that have not been set to Power Save Mode by management are caused by the STA to act as if they ve been set to the Power Save Mode. STAs that have already been set to Power Save Mode by management will have even more time to canvass.

In particular referring to at the start of a scan interval step the STA inquires about the current state of its power save mode. The power save mode that was set by management active power save is remembered step . The power save mode is set to power save and the listen time time the STA stays asleep if any is increased by a period of time herein referred to as scan time step . At the beginning of the power save cycle the STA actually stays awake temporarily instead of dozing as it told the AP it was going to do. It is during this time that other channels are canvassed for beacons and DRCP Announce messages step . After the canvass is done the STA resumes its power save cycle step . This process repeats every scan interval. Whenever the STA is not canvassing it restores the remembered management set power save mode. The scan interval may be for example twice per Beacon interval.

Stations that have not been set to Power Save Mode by management are caused by the STA to act as if they ve been set to Power Save Mode with listen interval set to the minimum value i.e. every Beacon . STAs that have already been set to Power Save Mode by management will have the most amount of time to canvass.

During the canvass time the STA tunes its radio to a different channel in order to passively listen for beacons and DRCP Announce messages. The STA keeps track of which channels have been canvassed stepping through all of the channels until all supported channels have been canvassed. The STA keeps track of all DRCP Announce messages and the power level at which they were received.

The STA receives beacons and DRCP Announce messages from all APs within the range of its radio. These are processed to build a table of all known APs the STA knownAPs table as shown in . The STA knownAPs table includes the following parameters for each entry 

The STA Known APs table is built as shown in . For each Beacon or Announce message received steps the STA checks to see if it has an entry in the STA KnownAPs table for the AP ID in the message step . If found the STA updates the entry step otherwise it creates a new one step up to a previously set maximum herein referred to as Max APs entries step .

The STA stores the following fields from received Announce messages in the corresponding STA knownAPs table entry 

The STA also notes the received power level that accompanied the beacons and Announce messages and uses these values along with the TP backoff values to calculate the distance to the APs in Banzais as previously described. Again since non DRCP APs will always send beacons at full power the TP Rackoff value for these is set to 0. 

The Received Power and TP Backoff entries are lists where each entry in each list corresponds to a Beacon or Announce message received for the corresponding AP ID. The received power level value and correspondingly the distance in Banzais are subject to variability in the RF channel. The STA saves a number of these distance measurements for each entry in the knownAPs table so that it can use averaging to compensate for this variance to be further described. For its own AP i.e. the AP to which the STA is currently associated the STA averages over a relatively large number of distance values herein referred to as Long Term Sample Size distance values. For all other entries the STA uses fewer Bid Sample Size distance values.

Additionally the STA keeps an Age for each entry. The Age is reset to zero 0 each time an Announce message is received from the AP corresponding to the entry. Entries are aged as part of the STA Bidding process described below.

Referring to an associated and registered STA receives all Announce messages from the AP to which it is associated. Upon receipt of an Announce message step the STA notes the TP Backoff value in the Announce message and adopts that value as the STA s own TP Backoff step .

Each time the STA Canvassing function completes a canvass of all channels the STA analyzes the information in the STA knownAPs table to see if there is a potential better AP with which to associate. The notion of what constitutes a better AP takes into account the distance to the AP in Banzais the available data rate and the loading number of associated STAs on the AP if known.

Referring to the STA Bidding process operates generally as follows. When the canvass is complete and a sufficient number of samples have been collected on each channel step the STA knownAPs table entries are aged before other processing is performed step . The age of each entry is incremented and any entries whose age exceeds Max AP Entry Age are deleted step . Since the age field is cleared each time an Announce message or Beacon is received this aging process will eliminate APs from whom nothing has been heard for Max AP Entry Age bidding cycles.

As mentioned the STA uses averaging to compensate for variance in its distance measurements. It requires Long Term Sample Size distance values for the STA knownAPs entry corresponding to its AP before it performs further processing of the table step . Once the STA has Long Term Sample Size distance values for its own AP it then waits until it has Bid Sample Size distance values for all entries in the knownAPs list at that time before it begins looking for a better AP step . This is to avoid making a decision to move to a new AP before it has sufficient information about the other APs in the network. However to avoid the potential for waiting indefinitely it will not delay processing the knownAPs list for any new APs that were added after it has Long Term Sample Size distance values for its own AP.

Working with the entries for which there are sufficient distance measurement samples the STA looks for a potential better AP. In summary a biased distance is calculated for each entry which takes into account the available data rate as well as the loads on the APs step . The data rate is deduced based on the received signal strength and the technology being used i.e. in an 802.11 environment the 802.11 mode of operation a b g . After calculating the biased distances for all of the entries in the STA knownAP table the AP with the lowest biased distance is considered to be the best candidate and if it appears better than its current AP step a Bid is sent step .

More particularly referring to for each entry n in the STA knownAPs table denoted KnownAPs n the following processing is performed on entry knownAPs n . An index of myAP corresponds to the entry for the AP to which the STA is currently associated i.e. knownAPs myAP is the entry for the STA s current AP.

As previously described the distance field in the STA knownAPs table knownAPs n .distance per entry is the distance in Banzais to the corresponding AP averaged over a number Bid Sample Size of measurement samples. As previously noted this value is subject to variance in the RF channel. The bid selection process should preferably yield the choice of a better AP only when the new AP actually would provide better performance for the STA and not when the new AP simply appears to be better due to this variance. The variance in the new AP s distance measurement is represented by a Bid Sample Std Error value related to the bid sample size and the variance in the current AP s distance measurement is represented by a Long Term Std Error value related to the long term distance sample size. It is advantageous to minimize the error in the distance measurement for a given entry n in comparison to the STA s current AP. This is done by using a corrected distance that is set to the distance to the STA s current AP if the entry falls within the sum of the standard errors on the two distance measurements. The corrected distance corrected distance is determined as follows 

The corrected distance to each AP is recorded in the STA knownAPs list. This distance is then used in conjunction with data related to the particular wireless environment in which the AP is operating to derive an estimate on the expected load factor for the STA. For example in an 802.11 environment the distance and 802.11 mode a b g are used to retrieve the expected data rate for the STA from the distance to rate table knownAPs .data rate distance to rate knownAPs .mode knownAPs .corrected distance step 376 

Then the expected load for this datarate is retrieved from the rate to load table knownAPs .my load factor rate to load knownAPs n .data rate step 478 

An example of a rate to load table for 802.11 networks is shown in Table III in . One skilled in the art will realize how to implement distance to rate and rate to load tables from specifications for other wireless environments. The corrected  distance and my load factor parameters are determined in this manner for each entry n in the STA Known APs table .

Any entries in the knownAPs list that represent non DRCP APs need to be given default values for their load factors so that they can be considered by the Stations for associations as well. These default load factors are derived from a default number of STAs per AP value that should be consistent across the network and a default average data rate per technology. That is 

When determining the load of the STA s current AP myAP when myAP is a non DRCP AP then its default load factor value is preferably incremented by the STA s load on that AR. This helps to support a consistent view of the load of that AP both before and after a STA associates with it that is since the STA adds its own load to the default load of its prospective non DRCP AP before it makes a decision to associate with it it must also add its load to the default load for this AP after it has associated with it.

Using the my load factor to the AP the load factor currently on the AP received from Announce messages and the corrected distance to the AP the STA calculates a biased distance value to account for the loading on the prospective AP in comparison to the loading on the STA s current AP as shown in . The biased distance is calculated as described by the following formula knownAPs .biased distance knownAPs .corrected distance knownAPs .load factor knownAPs .my load factor knownAPs myAP .load factor step 490 

Next a biased distance to the STA s current AP is calculated to account for the loading on the current AP relative to the loading on the prospective AP. This calculation is made as follows knownAPs .my ap rel biased distance knownAPs myAP .distance knownAPs myAP .load factor knownAPs .load factor knownAPs .my load factor step 492 Finally the difference between the biased distance to the prospective AP and the relative biased distance to the STA s current AP is determined as follows knownAPs .biased distance delta knownAPs .my ap rel biased distance knownAPs .biased distance step 494 

After calculating the biased distances and biased distance deltas for all of the APs in the knownAPs list the STA checks to see if any of the biased distance delta values are positive step . If not then the STA s current AP is still the best AP so the STA remains associated with its current AP step . Of any positive biased distance delta values the best AP is the one with the highest positive biased distance delta value step . If the best AP is not DRCP enabled step then the STA associates with that AP step . If the best AP is a DRCP AP step then a Bid is sent step and the STA resumes normal operation until it either receives a DRCP Accept or it completes another Canvass Sample Number passes of all channels. If there is more than one AP with the same highest biased distance delta values step the STA checks to see if any of them is the last AP to which it Bid step and if so it selects that one again step .

If a DRCP Accept is received with the AP ID matching the selected APs AP ID step the STA sets its TP backoff value to zero step and associates with the AP from which the Accept was received step . The STA now sends a DRCP Registration Request to the AP step and starts a timer step to go off every Registration Timeout Interval. When the timer expires step the STA sends out another DRCP Registration Request and resets the timer. Upon receipt of a DRCP Registration Acknowledge step the timer is disabled step .

If no DRCP Accept is received step in response to the STA s Bid message after a certain period of time step the STA remains associated with its current AP.

After the STA has associated with a new AP the STA waits until it has collected a large number Long Term Sample Size of distance measurements to its new AP before it resumes this process of evaluating the knownAPs table for bidding.

When a STA is associated with an AP the STA receives DRCP Announce messages from all APs within the range of its radio. Referring to once the STA has collected Long Term Sample Size of distance measurements from Announce messages received from its AP step it can begin the movement detection process.

The STA continuously collects Short Term Sample Size distance values to the current AP step . To detect movement the STA compares the distance to its AP derived from averaging over the long term using Long Term Sample Size to the short term distance derived from averaging the most recent Short Term Sample Size samples. This difference is compared to a Moving Threshold value plus the standard error in these two measurements in order to eliminate false movement detection. A station is considered to be moving when the short term distance exceeds the long term distance by more than the Moving Threshold plus the sum of the errors in the two measurements. The following pseudo code describes this comparison.

Once the STA detects that it is moving step and as long as the STA does not detect that it has stopped moving the STA refrains from participating in the bidding process step seeking a new AP only if warranted by the deterioration of its current association. If the STA determines that it is no longer moving before the STA loses the association to its AP the STA resumes normal operation including participation in the bidding process.

As in movement detection to detect that the STA has stopped moving the STA compares the distance to its AP derived using the Long Term Sample Size to the distance derived from the most recent Short Term Sample Size samples. The STA looks to see when this difference is less than just the standard error in the two measurements to determine that the STA has stopped moving. The following pseudo code describes this test.

In accordance with the preferred embodiment the previously described functionality is implemented in software in APs and STAs respectively. Referring to the software is implemented in accordance with a layered architecture such that it contains a platform dependent module that interacts with a platform independent module. This architecture is advantageous for porting the inventive functionality between different wireless architecture platforms. As shown each AP includes a platform independent module that interacts via an AP API with an AP platform dependent module . Likewise each STA one shown includes a STA platform independent module that interacts via a STA API with a STA platform dependent module . In environments where the APs are connected to each other via a wired network DRCP messages may be passed directly between the APs via the wired network . In environments where the APs are interconnected via only the wireless network APs interact with each other and with STAs by passing DRCP messages to the respective platform dependent layer which causes wireless platform specific protocol messages to be passed between the APs and STAs to implement the DRCP protocol.

Referring to there is shown a representation of the AP architecture of as it applies to in an 802.11 networking environment. The AP Radio Management Agent ARMA is the platform independent layer of the software. The AP Radio Manager ARM is the platform dependent layer of the software. The ARM software is actually implemented within several different 802.11 platform specific elements of the AP. More information on these elements can be found in the incorporated 802.11 specification.

Referring to the Station Radio Manager SRM is the platform dependent portion of the STA software. As shown the SRM communicates with various 802.11 platform specific elements. The Station Radio Management Agent SRMA is the platform independent portion of the STA software. Likewise the AP radio manager is the platform dependent portion of the AP software communicating with 802.11 platform specific elements. SRMAs communicate with ARMAs through the use of DRCP messages as previously described.

These DRCP messages are now described in further detail. Generally DRCP messages could be encoded as standard LLC data frames and the invention does not preclude such an implementation. But according to the preferred embodiment as implemented in an 802.11 networking environment DRCP management messages are encoded as new types in existing Class 1 Frames. DRCP messages are addressed either to a Group MAC Address or to an individual MAC address and are distinguished by the presence of the DRCP Protocol Identifier in the Protocol Identification Field of a SNAP PDU.

The DRCP messages are now described in detail as they operate on an IP WLAN. Some DRCP messages are transmitted as IEEE 802.11 MAC management frames of subtype Beacon on the wireless LAN only while others are transmitted as data frames encoded as LLC 1 Unnumbered SNAP PDUs on the wireless LAN or the wired wireless network between APs.

In accordance with the preferred embodiment the SRMAs and ARMAs interact with the SRMs and ARMs to generate and or collect information needed to produce or interpret DRCP protocol messages. It is noted that the DRCP protocol could be implemented over non 802 11 primitives without departing from the principles of the invention. The following describes the primitives used in an 80231 environment.

The ARMAs and SRMAs transmit and receive DRCP messages over a standard 802 MAC Service Interface with some enhancement. The receive interface is enhanced in both the STA and the AP to allow the SRM and the ARM to indicate to the SRMA and ARMA respectively the power at which DRCP messages are received. In particular the semantics of the 802.11 MA UNITDATA.indication service primitive are modified as shown by the underlined text to add a received power parameter as follows 

The received power parameter specifies the signal strength expressed in dBm at which the MSDU was received. The received power value indicates the current level at which the sending device is heard but does not provide an indication of whether or not the sending device is transmitting at full power. The potential power level at which a device might be heard can be determined when the transmit power backoff i.e. the amount in dB by which the radio is turned down in use by the device is also known.

The BSSDescription Parameter contains a list of elements that describe the BSS. An additional element is added to this list 

This mechanism is provided to allow the ARMA to send DRCP Messages encoded in 802.11 Management frames of type Beacon.

This primitive is used by the ARMA to request that the ARM send a DRCP Message over the wireless media encoded in an 802.11 Management frame of type Beacon. As shown in this is a special type of Beacon frame wherein the fixed portion of the Beacon frame is as defined as in the 802.11 standard and the variable portion of the frame is replaced by a single information element that carries the DRCP message.

This primitive is generated by an ARMA to request that a DRCP Message be sent on the wireless media encoded in an 802.11 Management frame of type Beacon. DRCP Claim and Hello messages are sent in this manner. As previously described the ARMA may optionally quiet the channel before sending a DRCP Hello message by first by sending a CTS frame. In particular if the Quiet Channel parameter is TRUE the ARM transmits a Clear To Send CTS frame immediately prior to the Beacon transfer. The DRCP Hello CTS Destination MAC Address is placed in the Receiver Address RA of the CTS frame. The duration field of the CTS is set to the value of the CTS Duration parameter.

The fixed portion of the Beacon frame is as defined in the 802.11 standard. The DA is set to the Destination Address parameter value the SA is the AP s MAC address and the BSS ID is the DRCP Default BSS ID. The variable portion of the frame is replaced by a single information element with an Element ID of DRCP Protocol with a Length field value of the Message Length parameter and the Information field containing the DRCP Message.

This primitive confirms the transmission of a DRCP message to the ARMA. The primitive parameters are as follows 

This primitive is generated by the MLME as a result of an MLME SENDDRCP.request to send a DRCP message encoded in an 802.11 Management frame of type Beacon. The ARMA is thus notified of the result of the Send DRCP request.

As previously described one way that a STA can support periodic canvassing is to indicate to the AP that it is in power save mode thereby causing the AP to buffer the STAs packets while the STA is canvassing. This mechanism supports a STA s ability to indicate to the AP that it is in power save mode without actually going into power save mode.

This primitive requests the SME to use the power save mode interaction with the AP to allow time to canvass other channels. The primitive parameters are as follows 

This primitive is generated by an SRMA to cause the MLME to borrow part of the doze time if the STA is in power save mode or all of the doze time if the STA is in active mode in order to canvass other channels.

This primitive confirms the change in power management mode to the SRMA. The primitive parameters are as follows 

This primitive is generated by the MLME as a result of an MILME POWERMGTFIB.request to mimic power save mode. The SRMA is thus notified of the change of power mode indicated.

This primitive indicates to the SRMA the start of the power save cycle. The STA does not actually power off its radio and enter the sleep state at this point but preferably it should not transmit outgoing frames after sending this indication until it receives an MLME PWRMGMTFIBCONTINUE.request The primitive parameters are as follows 

This primitive is generated by an SME to indicate the start of power save cycle. The SRMA is thereby notified of the start of the power save cycle.

This mechanism further supports a STA s ability to indicate to the AP that it is in power save mode without actually going into power save mode.

This primitive tells the MLME that it should restore the user configured power save mode. This primitive allows the SRMA to tell the MLME that it no longer needs to lie to the AP about power save that control over power save is passed back to the MLME . The primitive parameters are as follows 

This primitive is generated when the canvass mechanism is taken out of service. The receipt of this primitive causes the SRM to restore the saved power management mode settings and 

This primitive confirms the change in power management mode to the SRMA. The primitive parameters are as follows 

This primitive is generated by the MLME to confirm that the SME has executed an MLME PWRMGMTRESTORE.request. It is not generated until the change has been indicated. Upon receipt of this primitive the SRMA is notified of the change of power mode indicated.

Once canvassing is complete this mechanism informs the SRMA that it has control of the radio and communicates power save state awake or doze .

This primitive tells the MLME that it s safe to enter the awake state and transmit frames if desired. The primitive parameters are as follows 

This primitive is generated when the SRMA is has completed canvassing. Upon receipt the MLME enables transmission of user data frames if necessary.

This primitive confirms the change in allowed power management state. The primitive parameters are as follows 

This primitive is generated by the MLME to confirm that the SME has executed an MLME PWRMGMTFIBCONTINUE.request. It is not generated until the change has been indicated. Receipt by the SRMA serves as notification of the change of the allowed power save mode.

This primitive reports to the ARMA that a channel that was previously available has become unavailable. The primitive parameters are as follows 

This primitive is generated by the MLME when a channel becomes unavailable. Receipt of this primitive causes the ARMA to remove the channel from its channel map.

This primitive reports to the ARMA that a channel that was previously unavailable has become available. The primitive parameters are as follows 

This primitive is generated by the MLME when a channel becomes available. Receipt of this primitive causes the ARMA to add the channel to its channel map.

This primitive requests the MLME to notify the ARMA whenever a beacon is received. There is one indication for each Beacon received. An indication is generated any time a Beacon is received on the current channel. The primitive parameters are as follows 

This primitive is generated by an ARMA when it wants to be notified of any beacons received on its own channel. Receipt of this primitive by an MLME causes the MLME to enable a mode whereby the ARMA will be notified if any Beacon is received.

This primitive confirms the change in the beacon notification mechanism. The primitive parameters are as follows 

This primitive is generated by the MLME as a result of an MLME BEACONNOTIFY.request. Reciept of this primitive by the ARMA serves as notification of the change of Beacon Notify as indicated.

This primitive reports to the ARMA that a Beacon was received on the data channel. The primitive parameters are as follows 

This primitive is generated by the MLME if a beacon is received on the data channel. Note that a separate MLME BEACONNOTIFY.indication is generated for each beacon received so the primitive parameter will only ever contain a single BSSDescription. Upon receipt of this primitive The ARMA is notified of the Beacon and the signal strength at which it was received.

The following describes the manner in which the above described primitives are used to implement DRCP messages in an 80231 environment. shows a summary of the DRCP messages that are used to implement the previously described functionality. shows field definitions used in DRCP messages as follows 

As previously described APs and STAs ascertain movement based upon evaluation of short and long term averages of parameters along with expected error measurements. In accordance with an aspect of the invention movement detection is achieved through application of a broader inventive concept that provides a way to ascertain the dynamic attributes of a system based upon short and long term averages of discrete data measurements. The principles of this invention apply to any system in which a discretely measured variable may change widely. For purposes of clarity however the invention is now described in terms of its particular application to wireless networks.

In a wireless network such as the one shown in a wireless networking user heretofore also referred to as STA is associated with an access point AP . The AP provides associated users with network connectivity via radio frequency RF signals. Various APs are used to provide seamless RF coverage so that when the user moves away from one AP toward another AP the user will associate with the closer AP or the AP that is more lightly loaded and seamless network functionality is thereby maintained. It is therefore important to be able to ascertain the location of a user relative to an AP so that a determination can be made as to whether the user is currently moving. This allows the system to assure that the user rapidly becomes associated with the closest AP so the overall system performance is maximized. As a user moves toward or away from an AP the received power level i.e. the power of the RF signal received by the user from the AP goes up or down respectively. Thus one way to ascertain user movement is by monitoring received power levels.

However received power levels can appear to vary greatly even when a user is not moving. For example the opening or closing of a doorway can cause either a gain or attenuation in the user s received power level. A person waving their hand near the user s antenna can even cause a gain or attenuation in received power level. Environmental interference can also cause changes in received power levels. These various changes in power level can cause a user to appear to be moving when in fact he or she is not. This can cause the user to roam needlessly between APs particularly in environments where APs are close together and their transmit power levels are lower than maximum power. Alternatively variations in signal power due to these effects can mask the fact that the user is indeed moving. In this case the system could fail to detect the motion and fail to associate the user with the appropriate AP. shows an example graph of discrete measurements of received power vs. time for a user who is not moving. As can be seen the inaccuracies in data sampling prevent any assumption of movement in one direction or the other.

As a more particular example consider an 802.11a wireless network. APs in such a network provide a maximum bandwidth of 54 Mbps. Bandwidth drops with distance from the AR Assume that adjacent APs have their transmit power adjusted so that each provides a 54 Mbps cell on the order of about 10 feet in diameter. A walking user might be able to transition through such a cell in 2 seconds. On the other hand a user sitting at his desk near the center of the cell right next to the AP who gets up and leaves travels only 5 ft not 10 ft to the edge of the cell so it may take the user only just over a second to be in the aisle and out of the cell. These examples provide a motivation for why rapid power estimates based on discrete measurements must be made. Increasing sampling rates increases accuracy but this also causes more overhead in terms of wireless channel bandwidth interrupt activity and processing overhead on the user device. Some user devices could be simple appliances such as phones digital assistants etc. and have very limited processing power. So a trade off must be made between sample rate and overhead.

According to one possible implementation power levels are measured at intervals over a window of time and a roaming decision is made. In an 802.11a network when a user is about 1 ft from an AP whose power is set so that it has a 54 Mbps cell which is about 10 ft in diameter the user s true mean power level should be about 38 dbm. Assume a 99 confidence interval around the true mean i.e. the power level to be estimated is desired. Yet there is a variability to the measurements because of environmental effects hand waving etc. as well as inherent inaccuracy in the implementation measurement itself. Assume these inaccuracies and statistical variability in the data result in distribution of the data with a standard deviation 15 dbm. Referring to if only 8 samples are taken in such a statistical distribution then the 99 confidence interval around this true mean is 23.4 dbm to 52.6 dbm.

The 99 confidence interval has a range of 52.6 23.4 29.2 dbm or about 30 dbm. This is about 115 dbm. So because of the variability in the signal if only 8 samples are taken all that can be known is that the true power lies somewhere between 23.4 dbm and 52.6 dbm and that such conclusion can be drawn with 99 assurance.

If less accuracy can be tolerated for example 95 or even 90 confidence the resultant range would be narrower. But lower confidence intervals increase the likelihood of false positives . A false positive occurs when a user is ascertained to be moving when in fact he or she is not causing the user to needlessly roam to another AP. It is desirable to minimize such false positives as they needlessly consume valuable bandwidth.

When a user doubles his or her distance from an AP the user s received power decreases by 6 db. So when a user moves from 1 foot away to 2 feet to 4 feet away from the AP almost to the edge of the cell the true average received power has decreased from 38 dbm to 44 dbm to 50 dbm respectively. But as seen in when trying to estimate the average received power from eight samples taken during this motion with a 99 confidence interval in the data it cannot be ascertained that the user has moved. This is because the true mean is really unknown. All that is known is that it lies somewhere between 23.4 dbm and 52.6 dbm. So when only these few samples are taken it cannot be ascertained whether the user is moving away from the AP getting closer to the AP or not moving at all.

Of course increasing the number of samples taken decreases the range of error. If 20 power samples are taken then the 99 confidence interval is 29.1 dbm to 46.9 dbm. But taking lots and lots of samples will take too long unless channel overhead is increased.

Now consider taking n samples to produce an estimate and then taking n more to produce a second estimate. The two estimates are then compared to see if a conclusion can be drawn as to whether the user is moving. If the confidence intervals around each estimator are large e.g. 99 then there exists a spectrum of outcomes and again it cannot be ascertained as to whether the user is moving toward or away from the AP or not moving at all. In to tell that the user is moving away from the AP with 99 assurance the upper edge of the right confidence interval must be positioned below the lower edge of the left confidence interval.

In the instance of scenario which describes the very large majority of user activity in wireless networks the accuracy of the power estimate can be greatly improved. In accordance with the principles of the invention two averages of the received signal strength are maintained as above. But one is the most recent Nsamples taken over a sliding window and the other is a long term average using Nsamples. So both a long term average and a short term average are maintained. Referring to the confidence interval around the long term average is very small. The error in the estimate is almost completely removed. Therefore the potential uncertain outcomes in the decision are reduced.

In when the user is moving away from the AP the upper edge of the right confidence interval will fall below the long term average which has essentially a confidence interval of close to 0 db. 

For a given application one needs to ascertain how many samples N must be taken such that the long term average estimate has essentially 0 error. Also it is desirable to ascertain how few samples N are needed in the short term average to be able to make a decision with 99 accuracy.

Assume a user starts at a position foot away from the AP and moves towards the edge of the 10 ft cell. The goal is to find out how few samples are required to ascertain that the user is moving with 99 accuracy in order to produce the most robust implementation from an overall performance perspective. If it were possible to perfectly measure power a 6 db drop would be observed each time the user doubles his distance from the AP. Referring to if the power level is 38 dbm when the user is at 1 foot it is 44 dbm at 2 feet and 50 dbm at 4 feet which is almost at the edge of the cell. As can be seen in the Figure when the short term average is 50 dbm and the upper edge of the 99 confidence interval is just below 38 dbm then the confidence interval has a width of 12 db. To achieve such a confidence interval 14 samples N are required in the short term given the previously assumed standard deviation of the data 15 db. With these 14 samples the 99 confidence interval is 60.7 dbm

In this wireless network example it has been assumed that a user can walk from the center of the cell to the edge of the cell in 1.5 seconds. So samples need be taken every 1.5 14 100 milliseconds. As a further improvement it would be desirable to use 16 samples so that division can be done by a processor via a shift operation. This increases computational efficiency on the user s machine. This increases the sample rate a negligible amount.

Regarding the long term average it may be reasonable to tolerate a 1 db confidence interval around the long term estimate. The tighter this interval needs to be the longer the user has to stay near the AP or stay relatively stationary within a certain area to cause the average to converge. It is desirable to calculate how little time the user needs to stay in place to achieve an accuracy of 1 db with 99 confidence. Assume reasonably that signal strength samples are taken based on messages received from the AP every 50 milliseconds. Referring to the table shown in it is seen that if the user stays near the AP 1 ft for about 1.5 minutes and samples occur every 50 milliseconds the accuracy of the power estimate becomes less than 1 db.

The preferred implementation for the current wireless network example thus utilizes a a short term average over N 16 samples b a long term average over 2048 samples and c N which is the number of samples taken so far in computing the long term average. The process is as follows 

In an environment where users tend to remain in a cell for less than 1 second the long term estimate could be used based on fewer samples. However this will result in an increased risk of false positives. Several alternatives can be considered to mitigate the occurrence of false positives 

To generalize in a system wherein particular dynamic attributes are to be ascertained e.g. is the wireless network user in motion short term and long term averages of a system variable e.g. signal strength are calculated. An acceptable difference between the short and long term averages is calculated which positively identifies the system characteristic e.g. the user has moved. 

In there is shown a block diagram showing a wireless networking system that implements the invention. A user STA communicates with an AP over the wireless network. The user sends messages to the AP that indicate the received signal strength from the AP as perceived by the user. These messages are collected by the AP . A processor in the AP uses the messages to compute the short and long term averages according to the process as described in . When it is ascertained that the user has moved an indication is set.

In there is shown a block diagram of a preferred embodiment of a wireless networking system that implements the invention. A user device STA communicates with an AP over the wireless network. The user message collection mechanism receives messages from the AP and monitors the received signal strength of the messages. A processor or hardware state machine in the user device uses the signal strength of the messages to compute the short and long term averages according to the process as described in . When the user device ascertains that it is moving the user sends an indication or message to the AP requesting to roam.

In there is shown one mechanism that can be used by the processor in the implementations of either or to maintain the short and long term averages needed to perform the process of to ascertain movement. Two ring buffers and are maintained one for the short term average and one for the long term average. Ring buffers are used so that power sample averaging can be accomplished over a sliding window in time. In a ring buffer as a new sampled is added to the buffer the oldest sample is removed. In the wireless networking example previously described the short term average ring buffer stores the most recent 16 samples and the long term average ring buffer stores on the order of 1024 or 2048 samples. Of course these sample sizes will vary depending on the application. It may also be reasonable to use an accumulator based average for the long term average but such an approach could be subject to buffer overflow.

A short term average 656 and long term average 658 are calculated based on the contents of the respective ring buffers and . A comparator uses a stored allowed range 662 and the short term average 556 and long term average 658 to produce the movement indication in accordance with the process of .

In there is shown an alternate mechanism that can be used by the processor in either or to maintain the short and long term averages needed to perform the process of to ascertain movement. According to this mechanism a ring buffer accumulates a small number of samples for example 16 for computation of the short term average. Each short term average computation is saved . After a certain number of short term averages have been computed and saved the long term average is computed as the average of all the accumulated short term averages. This approach is known as batched means . This approach is advantageous for use in systems containing limited memory resources.

Though the above described aspects of the invention have been exemplified as they apply to wireless networks and in some particularity 802.11 networks it will be clear to the skilled practitioner that the invention can be employed in any wireless communications environment including wireless data networks wireless phone networks and wireless I O channels. All aspects of the invention may be implemented in either hardware or software. The preferred embodiment has been described as a software architecture because of its advantageous ease of portability between various hardware platforms.

It will be understood that each block of the flowchart illustrations and combinations of blocks in the flowchart illustrations can be implemented by computer program instructions. These computer program instructions may be loaded onto a computer embedded device microprocessor such as that found in an AP or STA or other programmable data processing apparatus to produce a machine such that the instructions which execute on the computer or other programmable data processing apparatus create means for implementing the functions specified in the flowchart block or blocks. These computer program instructions may also be stored in a computer readable memory that can direct a computer or other programmable data processing apparatus to function in a particular manner such that the instructions stored in the computer readable memory produce an article of manufacture including instruction means which implement the function specified in the flowchart block or blocks. The computer program instructions may also be loaded onto a computer or other programmable data processing apparatus to cause a series of operational steps to be performed on the computer or other programmable apparatus to produce a computer implemented process such that the instructions which execute on the computer or other programmable apparatus provide steps for implementing the functions specified in the flowchart block or blocks.

Those skilled in the art should readily appreciate that programs defining the functions of the present invention can be delivered to a computer in many forms including but not limited to a information permanently stored on non writable storage media e.g. read only memory devices within a computer such as ROM or CD ROM disks readable by a computer I O attachment b information alterably stored on writable storage media e.g. floppy disks and hard drives or c information conveyed to a computer through communication media for example using baseb and signaling or broadband signaling techniques including carrier wave signaling techniques such as over computer or telephone networks via a modem.

While the invention is described through the above exemplary embodiments it will be understood by those of ordinary skill in the art that modification to and variation of the illustrated embodiments may be made without departing from the inventive concepts herein disclosed. Moreover while the preferred embodiments are described in connection with various illustrative program command structures one skilled in the art will recognize that the system may be embodied using a variety of specific command structures. Accordingly the invention should not be viewed as limited except by the scope and spirit of the appended claims.

